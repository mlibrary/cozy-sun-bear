{"version":3,"file":"cozy-sun-bear.js","sources":["../node_modules/url-polyfill/url-polyfill.js","../node_modules/classlist-polyfill/src/index.js","../src/core/Util.js","../src/core/Class.js","../src/core/Events.js","../src/core/Browser.js","../src/geometry/Point.js","../src/dom/DomEvent.Pointer.js","../src/dom/DomEvent.DoubleTap.js","../src/dom/DomEvent.js","../src/dom/DomUtil.js","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../node_modules/lodash/isFunction.js","../node_modules/lodash/_coreJsData.js","../node_modules/lodash/_isMasked.js","../node_modules/lodash/_toSource.js","../node_modules/lodash/_baseIsNative.js","../node_modules/lodash/_getValue.js","../node_modules/lodash/_getNative.js","../node_modules/lodash/_defineProperty.js","../node_modules/lodash/_baseAssignValue.js","../node_modules/lodash/eq.js","../node_modules/lodash/_assignValue.js","../node_modules/lodash/_copyObject.js","../node_modules/lodash/identity.js","../node_modules/lodash/_apply.js","../node_modules/lodash/_overRest.js","../node_modules/lodash/constant.js","../node_modules/lodash/_baseSetToString.js","../node_modules/lodash/_shortOut.js","../node_modules/lodash/_setToString.js","../node_modules/lodash/_baseRest.js","../node_modules/lodash/isLength.js","../node_modules/lodash/isArrayLike.js","../node_modules/lodash/_isIndex.js","../node_modules/lodash/_isIterateeCall.js","../node_modules/lodash/_createAssigner.js","../node_modules/lodash/_isPrototype.js","../node_modules/lodash/_baseTimes.js","../node_modules/lodash/_baseIsArguments.js","../node_modules/lodash/isArguments.js","../node_modules/lodash/isArray.js","../node_modules/lodash/stubFalse.js","../node_modules/lodash/isBuffer.js","../node_modules/lodash/_baseIsTypedArray.js","../node_modules/lodash/_baseUnary.js","../node_modules/lodash/_nodeUtil.js","../node_modules/lodash/isTypedArray.js","../node_modules/lodash/_arrayLikeKeys.js","../node_modules/lodash/_overArg.js","../node_modules/lodash/_nativeKeys.js","../node_modules/lodash/_baseKeys.js","../node_modules/lodash/keys.js","../node_modules/lodash/assign.js","../src/screenfull.js","../src/reader/Reader.js","../src/control/Control.js","../src/control/Control.Paging.js","../src/control/Modal.js","../src/control/Control.Contents.js","../src/control/Control.Title.js","../src/control/Control.PublicationMetadata.js","../src/control/Control.Preferences.js","../src/control/Control.Widget.js","../src/control/Control.Citation.js","../src/control/Control.Search.js","../src/control/Control.BibliographicInformation.js","../src/control/Control.Download.js","../src/control/Control.Navigator.js","../src/control/index.js","../src/core/Bus.js","../src/core/index.js","../node_modules/epubjs/node_modules/es5-ext/object/assign/is-implemented.js","../node_modules/epubjs/node_modules/es5-ext/object/keys/is-implemented.js","../node_modules/epubjs/node_modules/es5-ext/function/noop.js","../node_modules/epubjs/node_modules/es5-ext/object/is-value.js","../node_modules/epubjs/node_modules/es5-ext/object/keys/shim.js","../node_modules/epubjs/node_modules/es5-ext/object/keys/index.js","../node_modules/epubjs/node_modules/es5-ext/object/valid-value.js","../node_modules/epubjs/node_modules/es5-ext/object/assign/shim.js","../node_modules/epubjs/node_modules/es5-ext/object/assign/index.js","../node_modules/epubjs/node_modules/es5-ext/object/normalize-options.js","../node_modules/epubjs/node_modules/es5-ext/object/is-callable.js","../node_modules/epubjs/node_modules/es5-ext/string/#/contains/is-implemented.js","../node_modules/epubjs/node_modules/es5-ext/string/#/contains/shim.js","../node_modules/epubjs/node_modules/es5-ext/string/#/contains/index.js","../node_modules/epubjs/node_modules/d/index.js","../node_modules/epubjs/node_modules/es5-ext/object/valid-callable.js","../node_modules/epubjs/node_modules/event-emitter/index.js","../node_modules/epubjs/src/utils/core.js","../node_modules/path-webpack/path.js","../node_modules/epubjs/src/utils/path.js","../node_modules/epubjs/src/utils/url.js","../node_modules/epubjs/src/epubcfi.js","../node_modules/epubjs/src/utils/hook.js","../node_modules/epubjs/src/utils/replacements.js","../node_modules/epubjs/src/section.js","../node_modules/epubjs/src/spine.js","../node_modules/epubjs/src/utils/queue.js","../node_modules/epubjs/src/utils/constants.js","../node_modules/epubjs/src/locations.js","../node_modules/epubjs/src/container.js","../node_modules/epubjs/src/packaging.js","../node_modules/epubjs/src/navigation.js","../node_modules/epubjs/libs/mime/mime.js","../node_modules/epubjs/src/resources.js","../node_modules/epubjs/src/pagelist.js","../node_modules/epubjs/src/layout.js","../node_modules/epubjs/src/themes.js","../node_modules/epubjs/src/mapping.js","../node_modules/epubjs/src/contents.js","../node_modules/epubjs/src/annotations.js","../node_modules/marks-pane/lib/svg.js","../node_modules/marks-pane/lib/events.js","../node_modules/marks-pane/lib/marks.js","../node_modules/epubjs/src/managers/views/iframe.js","../node_modules/epubjs/node_modules/lodash/isObject.js","../node_modules/epubjs/node_modules/lodash/_freeGlobal.js","../node_modules/epubjs/node_modules/lodash/_root.js","../node_modules/epubjs/node_modules/lodash/now.js","../node_modules/epubjs/node_modules/lodash/_Symbol.js","../node_modules/epubjs/node_modules/lodash/_getRawTag.js","../node_modules/epubjs/node_modules/lodash/_objectToString.js","../node_modules/epubjs/node_modules/lodash/_baseGetTag.js","../node_modules/epubjs/node_modules/lodash/isObjectLike.js","../node_modules/epubjs/node_modules/lodash/isSymbol.js","../node_modules/epubjs/node_modules/lodash/toNumber.js","../node_modules/epubjs/node_modules/lodash/debounce.js","../node_modules/epubjs/node_modules/lodash/throttle.js","../node_modules/epubjs/src/managers/helpers/stage.js","../node_modules/epubjs/src/managers/helpers/views.js","../node_modules/epubjs/src/managers/default/index.js","../node_modules/epubjs/src/managers/helpers/snap.js","../node_modules/epubjs/src/managers/continuous/index.js","../node_modules/epubjs/src/rendition.js","../node_modules/epubjs/src/utils/request.js","../node_modules/epubjs/src/archive.js","../node_modules/epubjs/src/store.js","../node_modules/epubjs/src/book.js","../node_modules/epubjs/libs/url/url-polyfill.js","../node_modules/epubjs/src/epub.js","../src/epubjs/managers/helpers/prefab.js","../src/epubjs/managers/continuous/prepaginated.js","../src/epubjs/managers/views/iframe.js","../node_modules/es5-ext/object/assign/is-implemented.js","../node_modules/es5-ext/object/keys/is-implemented.js","../node_modules/es5-ext/object/keys/shim.js","../node_modules/es5-ext/object/keys/index.js","../node_modules/es5-ext/object/valid-value.js","../node_modules/es5-ext/object/assign/shim.js","../node_modules/es5-ext/object/assign/index.js","../node_modules/es5-ext/object/normalize-options.js","../node_modules/es5-ext/object/is-callable.js","../node_modules/es5-ext/string/#/contains/is-implemented.js","../node_modules/es5-ext/string/#/contains/shim.js","../node_modules/es5-ext/string/#/contains/index.js","../node_modules/d/index.js","../node_modules/es5-ext/object/valid-callable.js","../node_modules/event-emitter/index.js","../node_modules/viewprt/dist/viewprt.esm.js","../node_modules/in-vp/index.js","../src/epubjs/managers/helpers/scrolling_views.js","../src/epubjs/managers/continuous/scrolling.js","../src/epubjs/managers/views/sticky.js","../src/reader/Reader.EpubJS.js","../src/reader/Reader.Mock.js","../src/reader/index.js"],"sourcesContent":["(function(global) {\r\n  /**\r\n   * Polyfill URLSearchParams\r\n   *\r\n   * Inspired from : https://github.com/WebReflection/url-search-params/blob/master/src/url-search-params.js\r\n   */\r\n\r\n  var checkIfIteratorIsSupported = function() {\r\n    try {\r\n      return !!Symbol.iterator;\r\n    } catch(error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  var iteratorSupported = checkIfIteratorIsSupported();\r\n\r\n  var createIterator = function(items) {\r\n    var iterator = {\r\n      next: function() {\r\n        var value = items.shift();\r\n        return { done: value === void 0, value: value };\r\n      }\r\n    };\r\n\r\n    if(iteratorSupported) {\r\n      iterator[Symbol.iterator] = function() {\r\n        return iterator;\r\n      };\r\n    }\r\n\r\n    return iterator;\r\n  };\r\n\r\n  /**\r\n   * Search param name and values should be encoded according to https://url.spec.whatwg.org/#urlencoded-serializing\r\n   * encodeURIComponent() produces the same result except encoding spaces as `%20` instead of `+`.\r\n   */\r\n  var serializeParam = function(value) {\r\n    return encodeURIComponent(value).replace(/%20/g, '+');\r\n  };\r\n\r\n  var deserializeParam = function(value) {\r\n    return decodeURIComponent(value).replace(/\\+/g, ' ');\r\n  };\r\n\r\n  var polyfillURLSearchParams= function() {\r\n\r\n    var URLSearchParams = function(searchString) {\r\n      Object.defineProperty(this, '_entries', { value: {} });\r\n\r\n      if(typeof searchString === 'string') {\r\n        if(searchString !== '') {\r\n          searchString = searchString.replace(/^\\?/, '');\r\n          var attributes = searchString.split('&');\r\n          var attribute;\r\n          for(var i = 0; i < attributes.length; i++) {\r\n            attribute = attributes[i].split('=');\r\n            this.append(\r\n              deserializeParam(attribute[0]),\r\n              (attribute.length > 1) ? deserializeParam(attribute[1]) : ''\r\n            );\r\n          }\r\n        }\r\n      } else if(searchString instanceof URLSearchParams) {\r\n        var _this = this;\r\n        searchString.forEach(function(value, name) {\r\n          _this.append(value, name);\r\n        });\r\n      }\r\n    };\r\n\r\n    var proto = URLSearchParams.prototype;\r\n\r\n    proto.append = function(name, value) {\r\n      if(name in this._entries) {\r\n        this._entries[name].push(value.toString());\r\n      } else {\r\n        this._entries[name] = [value.toString()];\r\n      }\r\n    };\r\n\r\n    proto.delete = function(name) {\r\n      delete this._entries[name];\r\n    };\r\n\r\n    proto.get = function(name) {\r\n      return (name in this._entries) ? this._entries[name][0] : null;\r\n    };\r\n\r\n    proto.getAll = function(name) {\r\n      return (name in this._entries) ? this._entries[name].slice(0) : [];\r\n    };\r\n\r\n    proto.has = function(name) {\r\n      return (name in this._entries);\r\n    };\r\n\r\n    proto.set = function(name, value) {\r\n      this._entries[name] = [value.toString()];\r\n    };\r\n\r\n    proto.forEach = function(callback, thisArg) {\r\n      var entries;\r\n      for(var name in this._entries) {\r\n        if(this._entries.hasOwnProperty(name)) {\r\n          entries = this._entries[name];\r\n          for(var i = 0; i < entries.length; i++) {\r\n            callback.call(thisArg, entries[i], name, this);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    proto.keys = function() {\r\n      var items = [];\r\n      this.forEach(function(value, name) { items.push(name); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    proto.values = function() {\r\n      var items = [];\r\n      this.forEach(function(value) { items.push(value); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    proto.entries = function() {\r\n      var items = [];\r\n      this.forEach(function(value, name) { items.push([name, value]); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    if(iteratorSupported) {\r\n      proto[Symbol.iterator] = proto.entries;\r\n    }\r\n\r\n    proto.toString = function() {\r\n      var searchString = '';\r\n      this.forEach(function(value, name) {\r\n        if(searchString.length > 0) searchString+= '&';\r\n        searchString += serializeParam(name) + '=' + serializeParam(value);\r\n      });\r\n      return searchString;\r\n    };\r\n\r\n    global.URLSearchParams = URLSearchParams;\r\n  };\r\n\r\n  if(!('URLSearchParams' in global) || (new URLSearchParams('?a=1').toString() !== 'a=1')) {\r\n    polyfillURLSearchParams();\r\n  }\r\n\r\n  // HTMLAnchorElement\r\n\r\n})(\r\n  (typeof global !== 'undefined') ? global\r\n    : ((typeof window !== 'undefined') ? window\r\n    : ((typeof self !== 'undefined') ? self : this))\r\n);\r\n\r\n(function(global) {\r\n  /**\r\n   * Polyfill URL\r\n   *\r\n   * Inspired from : https://github.com/arv/DOM-URL-Polyfill/blob/master/src/url.js\r\n   */\r\n\r\n  var checkIfURLIsSupported = function() {\r\n    try {\r\n      var u = new URL('b', 'http://a');\r\n      u.pathname = 'c%20d';\r\n      return (u.href === 'http://a/c%20d') && u.searchParams;\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  var polyfillURL = function() {\r\n    var _URL = global.URL;\r\n\r\n    var URL = function(url, base) {\r\n      if(typeof url !== 'string') url = String(url);\r\n\r\n      var doc = document.implementation.createHTMLDocument('');\r\n      window.doc = doc;\r\n      if(base) {\r\n        var baseElement = doc.createElement('base');\r\n        baseElement.href = base;\r\n        doc.head.appendChild(baseElement);\r\n      }\r\n\r\n      var anchorElement = doc.createElement('a');\r\n      anchorElement.href = url;\r\n      doc.body.appendChild(anchorElement);\r\n      anchorElement.href = anchorElement.href; // force href to refresh\r\n\r\n      if(anchorElement.protocol === ':' || !/:/.test(anchorElement.href)) {\r\n        throw new TypeError('Invalid URL');\r\n      }\r\n\r\n      Object.defineProperty(this, '_anchorElement', {\r\n        value: anchorElement\r\n      });\r\n    };\r\n\r\n    var proto = URL.prototype;\r\n\r\n    var linkURLWithAnchorAttribute = function(attributeName) {\r\n      Object.defineProperty(proto, attributeName, {\r\n        get: function() {\r\n          return this._anchorElement[attributeName];\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement[attributeName] = value;\r\n        },\r\n        enumerable: true\r\n      });\r\n    };\r\n\r\n    ['hash', 'host', 'hostname', 'port', 'protocol', 'search']\r\n    .forEach(function(attributeName) {\r\n      linkURLWithAnchorAttribute(attributeName);\r\n    });\r\n\r\n    Object.defineProperties(proto, {\r\n\r\n      'toString': {\r\n        get: function() {\r\n          var _this = this;\r\n          return function() {\r\n            return _this.href;\r\n          };\r\n        }\r\n      },\r\n\r\n      'href' : {\r\n        get: function() {\r\n          return this._anchorElement.href.replace(/\\?$/,'');\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement.href = value;\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'pathname' : {\r\n        get: function() {\r\n          return this._anchorElement.pathname.replace(/(^\\/?)/,'/');\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement.pathname = value;\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'origin': {\r\n        get: function() {\r\n          // get expected port from protocol\r\n          var expectedPort = {'http:': 80, 'https:': 443, 'ftp:': 21}[this._anchorElement.protocol];\r\n          // add port to origin if, expected port is different than actual port\r\n          // and it is not empty f.e http://foo:8080\r\n          // 8080 != 80 && 8080 != ''\r\n          var addPortToOrigin = this._anchorElement.port != expectedPort &&\r\n            this._anchorElement.port !== ''\r\n\r\n          return this._anchorElement.protocol +\r\n            '//' +\r\n            this._anchorElement.hostname +\r\n            (addPortToOrigin ? (':' + this._anchorElement.port) : '');\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'password': { // TODO\r\n        get: function() {\r\n          return '';\r\n        },\r\n        set: function(value) {\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'username': { // TODO\r\n        get: function() {\r\n          return '';\r\n        },\r\n        set: function(value) {\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'searchParams': {\r\n        get: function() {\r\n          var searchParams = new URLSearchParams(this.search);\r\n          var _this = this;\r\n          ['append', 'delete', 'set'].forEach(function(methodName) {\r\n            var method = searchParams[methodName];\r\n            searchParams[methodName] = function() {\r\n              method.apply(searchParams, arguments);\r\n              _this.search = searchParams.toString();\r\n            };\r\n          });\r\n          return searchParams;\r\n        },\r\n        enumerable: true\r\n      }\r\n    });\r\n\r\n    URL.createObjectURL = function(blob) {\r\n      return _URL.createObjectURL.apply(_URL, arguments);\r\n    };\r\n\r\n    URL.revokeObjectURL = function(url) {\r\n      return _URL.revokeObjectURL.apply(_URL, arguments);\r\n    };\r\n\r\n    global.URL = URL;\r\n\r\n  };\r\n\r\n  if(!checkIfURLIsSupported()) {\r\n    polyfillURL();\r\n  }\r\n\r\n  if((global.location !== void 0) && !('origin' in global.location)) {\r\n    var getOrigin = function() {\r\n      return global.location.protocol + '//' + global.location.hostname + (global.location.port ? (':' + global.location.port) : '');\r\n    };\r\n\r\n    try {\r\n      Object.defineProperty(global.location, 'origin', {\r\n        get: getOrigin,\r\n        enumerable: true\r\n      });\r\n    } catch(e) {\r\n      setInterval(function() {\r\n        global.location.origin = getOrigin();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n})(\r\n  (typeof global !== 'undefined') ? global\r\n    : ((typeof window !== 'undefined') ? window\r\n    : ((typeof self !== 'undefined') ? self : this))\r\n);\r\n","/*\n * classList.js: Cross-browser full element.classList implementation.\n * 1.1.20170427\n *\n * By Eli Grey, http://eligrey.com\n * License: Dedicated to the public domain.\n *   See https://github.com/eligrey/classList.js/blob/master/LICENSE.md\n */\n\n/*global self, document, DOMException */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */\n\nif (\"document\" in window.self) {\n\n// Full polyfill for browsers with no classList support\n// Including IE < Edge missing SVGElement.classList\nif (!(\"classList\" in document.createElement(\"_\")) \n\t|| document.createElementNS && !(\"classList\" in document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\"))) {\n\n(function (view) {\n\n\"use strict\";\n\nif (!('Element' in view)) return;\n\nvar\n\t  classListProp = \"classList\"\n\t, protoProp = \"prototype\"\n\t, elemCtrProto = view.Element[protoProp]\n\t, objCtr = Object\n\t, strTrim = String[protoProp].trim || function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, \"\");\n\t}\n\t, arrIndexOf = Array[protoProp].indexOf || function (item) {\n\t\tvar\n\t\t\t  i = 0\n\t\t\t, len = this.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\t// Vendors: please allow content code to instantiate DOMExceptions\n\t, DOMEx = function (type, message) {\n\t\tthis.name = type;\n\t\tthis.code = DOMException[type];\n\t\tthis.message = message;\n\t}\n\t, checkTokenAndGetIndex = function (classList, token) {\n\t\tif (token === \"\") {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"SYNTAX_ERR\"\n\t\t\t\t, \"An invalid or illegal string was specified\"\n\t\t\t);\n\t\t}\n\t\tif (/\\s/.test(token)) {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"INVALID_CHARACTER_ERR\"\n\t\t\t\t, \"String contains an invalid character\"\n\t\t\t);\n\t\t}\n\t\treturn arrIndexOf.call(classList, token);\n\t}\n\t, ClassList = function (elem) {\n\t\tvar\n\t\t\t  trimmedClasses = strTrim.call(elem.getAttribute(\"class\") || \"\")\n\t\t\t, classes = trimmedClasses ? trimmedClasses.split(/\\s+/) : []\n\t\t\t, i = 0\n\t\t\t, len = classes.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tthis.push(classes[i]);\n\t\t}\n\t\tthis._updateClassName = function () {\n\t\t\telem.setAttribute(\"class\", this.toString());\n\t\t};\n\t}\n\t, classListProto = ClassList[protoProp] = []\n\t, classListGetter = function () {\n\t\treturn new ClassList(this);\n\t}\n;\n// Most DOMException implementations don't allow calling DOMException's toString()\n// on non-DOMExceptions. Error's toString() is sufficient here.\nDOMEx[protoProp] = Error[protoProp];\nclassListProto.item = function (i) {\n\treturn this[i] || null;\n};\nclassListProto.contains = function (token) {\n\ttoken += \"\";\n\treturn checkTokenAndGetIndex(this, token) !== -1;\n};\nclassListProto.add = function () {\n\tvar\n\t\t  tokens = arguments\n\t\t, i = 0\n\t\t, l = tokens.length\n\t\t, token\n\t\t, updated = false\n\t;\n\tdo {\n\t\ttoken = tokens[i] + \"\";\n\t\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\t\tthis.push(token);\n\t\t\tupdated = true;\n\t\t}\n\t}\n\twhile (++i < l);\n\n\tif (updated) {\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.remove = function () {\n\tvar\n\t\t  tokens = arguments\n\t\t, i = 0\n\t\t, l = tokens.length\n\t\t, token\n\t\t, updated = false\n\t\t, index\n\t;\n\tdo {\n\t\ttoken = tokens[i] + \"\";\n\t\tindex = checkTokenAndGetIndex(this, token);\n\t\twhile (index !== -1) {\n\t\t\tthis.splice(index, 1);\n\t\t\tupdated = true;\n\t\t\tindex = checkTokenAndGetIndex(this, token);\n\t\t}\n\t}\n\twhile (++i < l);\n\n\tif (updated) {\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.toggle = function (token, force) {\n\ttoken += \"\";\n\n\tvar\n\t\t  result = this.contains(token)\n\t\t, method = result ?\n\t\t\tforce !== true && \"remove\"\n\t\t:\n\t\t\tforce !== false && \"add\"\n\t;\n\n\tif (method) {\n\t\tthis[method](token);\n\t}\n\n\tif (force === true || force === false) {\n\t\treturn force;\n\t} else {\n\t\treturn !result;\n\t}\n};\nclassListProto.toString = function () {\n\treturn this.join(\" \");\n};\n\nif (objCtr.defineProperty) {\n\tvar classListPropDesc = {\n\t\t  get: classListGetter\n\t\t, enumerable: true\n\t\t, configurable: true\n\t};\n\ttry {\n\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t} catch (ex) { // IE 8 doesn't support enumerable:true\n\t\t// adding undefined to fight this issue https://github.com/eligrey/classList.js/issues/36\n\t\t// modernie IE8-MSW7 machine has IE8 8.0.6001.18702 and is affected\n\t\tif (ex.number === undefined || ex.number === -0x7FF5EC54) {\n\t\t\tclassListPropDesc.enumerable = false;\n\t\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t\t}\n\t}\n} else if (objCtr[protoProp].__defineGetter__) {\n\telemCtrProto.__defineGetter__(classListProp, classListGetter);\n}\n\n}(window.self));\n\n}\n\n// There is full or partial native classList support, so just check if we need\n// to normalize the add/remove and toggle APIs.\n\n(function () {\n\t\"use strict\";\n\n\tvar testElement = document.createElement(\"_\");\n\n\ttestElement.classList.add(\"c1\", \"c2\");\n\n\t// Polyfill for IE 10/11 and Firefox <26, where classList.add and\n\t// classList.remove exist but support only one argument at a time.\n\tif (!testElement.classList.contains(\"c2\")) {\n\t\tvar createMethod = function(method) {\n\t\t\tvar original = DOMTokenList.prototype[method];\n\n\t\t\tDOMTokenList.prototype[method] = function(token) {\n\t\t\t\tvar i, len = arguments.length;\n\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\ttoken = arguments[i];\n\t\t\t\t\toriginal.call(this, token);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tcreateMethod('add');\n\t\tcreateMethod('remove');\n\t}\n\n\ttestElement.classList.toggle(\"c3\", false);\n\n\t// Polyfill for IE 10 and Firefox <24, where classList.toggle does not\n\t// support the second argument.\n\tif (testElement.classList.contains(\"c3\")) {\n\t\tvar _toggle = DOMTokenList.prototype.toggle;\n\n\t\tDOMTokenList.prototype.toggle = function(token, force) {\n\t\t\tif (1 in arguments && !this.contains(token) === !force) {\n\t\t\t\treturn force;\n\t\t\t} else {\n\t\t\t\treturn _toggle.call(this, token);\n\t\t\t}\n\t\t};\n\n\t}\n\n\ttestElement = null;\n}());\n\n}\n","/*\n * @namespace Util\n *\n * Various utility functions, used by Leaflet internally.\n */\n\n// @function extend(dest: Object, src?: Object): Object\n// Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.\nexport function extend(dest) {\n    var i, j, len, src;\n\n    for (j = 1, len = arguments.length; j < len; j++) {\n        src = arguments[j];\n        for (i in src) {\n            dest[i] = src[i];\n        }\n    }\n    return dest;\n}\n\n// @function create(proto: Object, properties?: Object): Object\n// Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\nexport var create = Object.create || (function () {\n    function F() {}\n    return function (proto) {\n        F.prototype = proto;\n        return new F();\n    };\n})();\n\n// @function bind(fn: Function, …): Function\n// Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n// Has a `L.bind()` shortcut.\nexport function bind(fn, obj) {\n    var slice = Array.prototype.slice;\n\n    if (fn.bind) {\n        return fn.bind.apply(fn, slice.call(arguments, 1));\n    }\n\n    var args = slice.call(arguments, 2);\n\n    return function () {\n        return fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\n    };\n}\n\n// @property lastId: Number\n// Last unique ID used by [`stamp()`](#util-stamp)\nexport var lastId = 0;\n\n// @function stamp(obj: Object): Number\n// Returns the unique ID of an object, assiging it one if it doesn't have it.\nexport function stamp(obj) {\n    /*eslint-disable */\n    obj._cozy_id = obj._cozy_id || ++lastId;\n    return obj._cozy_id; /* not leaflet */\n    /*eslint-enable */\n}\n\n// @function throttle(fn: Function, time: Number, context: Object): Function\n// Returns a function which executes function `fn` with the given scope `context`\n// (so that the `this` keyword refers to `context` inside `fn`'s code). The function\n// `fn` will be called no more than one time per given amount of `time`. The arguments\n// received by the bound function will be any arguments passed when binding the\n// function, followed by any arguments passed when invoking the bound function.\n// Has an `L.throttle` shortcut.\nexport function throttle(fn, time, context) {\n    var lock, args, wrapperFn, later;\n\n    later = function () {\n        // reset lock and call if queued\n        lock = false;\n        if (args) {\n            wrapperFn.apply(context, args);\n            args = false;\n        }\n    };\n\n    wrapperFn = function () {\n        if (lock) {\n            // called too soon, queue to call later\n            args = arguments;\n\n        } else {\n            // call and lock until later\n            fn.apply(context, arguments);\n            setTimeout(later, time);\n            lock = true;\n        }\n    };\n\n    return wrapperFn;\n}\n\n// @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number\n// Returns the number `num` modulo `range` in such a way so it lies within\n// `range[0]` and `range[1]`. The returned value will be always smaller than\n// `range[1]` unless `includeMax` is set to `true`.\nexport function wrapNum(x, range, includeMax) {\n    var max = range[1],\n        min = range[0],\n        d = max - min;\n    return x === max && includeMax ? x : ((x - min) % d + d) % d + min;\n}\n\n// @function falseFn(): Function\n// Returns a function which always returns `false`.\nexport function falseFn() { return false; }\n\n// @function formatNum(num: Number, digits?: Number): Number\n// Returns the number `num` rounded to `digits` decimals, or to 5 decimals by default.\nexport function formatNum(num, digits) {\n    var pow = Math.pow(10, digits || 5);\n    return Math.round(num * pow) / pow;\n}\n\n// @function isNumeric(num: Number): Boolean\n// Returns whether num is actually numeric\nexport function isNumeric(num) {\n  return !isNaN(parseFloat(num)) && isFinite(num);\n}\n\n// @function trim(str: String): String\n// Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)\nexport function trim(str) {\n    return str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\n}\n\n// @function splitWords(str: String): String[]\n// Trims and splits the string on whitespace and returns the array of parts.\nexport function splitWords(str) {\n    return trim(str).split(/\\s+/);\n}\n\n// @function setOptions(obj: Object, options: Object): Object\n// Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.\nexport function setOptions(obj, options) {\n    if (!obj.hasOwnProperty('options')) {\n        obj.options = obj.options ? create(obj.options) : {};\n    }\n    for (var i in options) {\n        obj.options[i] = options[i];\n    }\n    return obj.options;\n}\n\n// @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\n// Converts an object into a parameter URL string, e.g. `{a: \"foo\", b: \"bar\"}`\n// translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will\n// be appended at the end. If `uppercase` is `true`, the parameter names will\n// be uppercased (e.g. `'?A=foo&B=bar'`)\nexport function getParamString(obj, existingUrl, uppercase) {\n    var params = [];\n    for (var i in obj) {\n        params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\n    }\n    return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\n}\n\nvar templateRe = /\\{ *([\\w_\\-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values — they will be evaluated passing `data` as an argument.\nexport function template(str, data) {\n    return str.replace(templateRe, function (str, key) {\n        var value = data[key];\n\n        if (value === undefined) {\n            throw new Error('No value provided for variable ' + str);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n}\n\n// @function isArray(obj): Boolean\n// Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)\nexport var isArray = Array.isArray || function (obj) {\n    return (Object.prototype.toString.call(obj) === '[object Array]');\n};\n\n// @function indexOf(array: Array, el: Object): Number\n// Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)\nexport function indexOf(array, el) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i] === el) { return i; }\n    }\n    return -1;\n}\n\n// @property emptyImageUrl: String\n// Data URI string containing a base64-encoded empty GIF image.\n// Used as a hack to free memory from unused images on WebKit-powered\n// mobile devices (by setting image `src` to this string).\nexport var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n\nfunction getPrefixed(name) {\n    return window['webkit' + name] || window['moz' + name] || window['ms' + name];\n}\n\nvar lastTime = 0;\n\n// fallback for IE 7-8\nfunction timeoutDefer(fn) {\n    var time = +new Date(),\n        timeToCall = Math.max(0, 16 - (time - lastTime));\n\n    lastTime = time + timeToCall;\n    return window.setTimeout(fn, timeToCall);\n}\n\nexport var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\nexport var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\n        getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\n\n// @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number\n// Schedules `fn` to be executed when the browser repaints. `fn` is bound to\n// `context` if given. When `immediate` is set, `fn` is called immediately if\n// the browser doesn't have native support for\n// [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\n// otherwise it's delayed. Returns a request ID that can be used to cancel the request.\nexport function requestAnimFrame(fn, context, immediate) {\n    if (immediate && requestFn === timeoutDefer) {\n        fn.call(context);\n    } else {\n        return requestFn.call(window, bind(fn, context));\n    }\n}\n\n// @function cancelAnimFrame(id: Number): undefined\n// Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\nexport function cancelAnimFrame(id) {\n    if (id) {\n        cancelFn.call(window, id);\n    }\n}\n\nexport var loader = {\n    js: function(url) {\n        var handler = { _resolved: false };\n        handler.callbacks = [];\n        handler.error = [];\n        handler.then = function(cb) {\n            handler.callbacks.push(cb);\n            if ( handler._resolved ) { return handler.resolve(); }\n            return handler;\n        }\n        handler.catch = function(cb) {\n            handler.error.push(cb);\n            if ( handler._resolved ) { return handler.reject(); }\n            return handler;\n        }\n        handler.resolve = function(_argv) {\n            // var _argv;\n            handler._resolved = true;\n            while ( handler.callbacks.length ) {\n                var cb = handler.callbacks.shift();\n                var retval;\n                try {\n                    _argv = cb(_argv);\n                } catch(e) {\n                    console.log(e);\n                    handler.reject(e);\n                    break;\n                }\n            }\n            return handler;\n        }\n\n        handler.reject = function(e) {\n            while ( handler.error.length ) {\n                var cb = handler.error.shift();\n                cb(e);\n            }\n            console.log(e);\n            console.trace();\n            return handler;\n        }\n\n        if ( url == undefined ) {\n            handler._resolved = true;\n            return handler;\n        }\n\n        var element = document.createElement('script');\n\n        element.onload = function() {\n          handler.resolve(url);\n        };\n        element.onerror = function() {\n          handler.catch.apply(arguments);\n        };\n\n        element.async = true;\n        var parent = 'body';\n        var attr = 'src';\n        element[attr] = url;\n        document[parent].appendChild(element);\n\n        console.log(\"AHOY APPENDED\", url);\n\n        return handler;\n    }\n}","import * as Util from './Util';\r\n\r\n// @class Class\r\n// @aka L.Class\r\n\r\n// @section\r\n// @uninheritable\r\n\r\n// Thanks to John Resig and Dean Edwards for inspiration!\r\n\r\nexport function Class() {}\r\n\r\nClass.extend = function (props) {\r\n\r\n\t// @function extend(props: Object): Function\r\n\t// [Extends the current class](#class-inheritance) given the properties to be included.\r\n\t// Returns a Javascript function that is a class constructor (to be called with `new`).\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tthis.callInitHooks();\r\n\t};\r\n\r\n\tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n\tvar proto = Util.create(parentProto);\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t// inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tUtil.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tcheckDeprecatedMixinEvents(props.includes);\r\n\t\tUtil.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (proto.options) {\r\n\t\tprops.options = Util.extend(Util.create(proto.options), props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tUtil.extend(proto, props);\r\n\t\r\n\tproto._initHooks = [];\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parentProto.callInitHooks) {\r\n\t\t\tparentProto.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// @function include(properties: Object): this\r\n// [Includes a mixin](#class-includes) into the current class.\r\nClass.include = function (props) {\r\n\tUtil.extend(this.prototype, props);\r\n\treturn this;\r\n};\r\n\r\n// @function mergeOptions(options: Object): this\r\n// [Merges `options`](#class-options) into the defaults of the class.\r\nClass.mergeOptions = function (options) {\r\n\tUtil.extend(this.prototype.options, options);\r\n\treturn this;\r\n};\r\n\r\n// @function addInitHook(fn: Function): this\r\n// Adds a [constructor hook](#class-constructor-hooks) to the class.\r\nClass.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n\treturn this;\r\n};\r\n\r\nfunction checkDeprecatedMixinEvents(includes) {\r\n\tif (!cozy || !cozy.Mixin) { return; }\r\n\r\n\tincludes = cozy.Util.isArray(includes) ? includes : [includes];\r\n\r\n\t// for (var i = 0; i < includes.length; i++) {\r\n\t// \tif (includes[i] === cozy.Mixin.Events) {\r\n\t// \t\tconsole.warn('Deprecated include of cozy.Mixin.Events: ' +\r\n\t// \t\t\t'this property will be removed in future releases, ' +\r\n\t// \t\t\t'please inherit from cozy.Evented instead.', new Error().stack);\r\n\t// \t}\r\n\t// }\r\n}\r\n","import {Class} from './Class';\r\nimport * as Util from './Util';\r\n\r\n/*\r\n * @class Evented\r\n * @aka L.Evented\r\n * @inherits Class\r\n *\r\n * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * map.on('click', function(e) {\r\n * \talert(e.latlng);\r\n * } );\r\n * ```\r\n *\r\n * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:\r\n *\r\n * ```js\r\n * function onClick(e) { ... }\r\n *\r\n * map.on('click', onClick);\r\n * map.off('click', onClick);\r\n * ```\r\n */\r\n\r\nexport var Evented = Class.extend({\r\n\r\n\t/* @method on(type: String, fn: Function, context?: Object): this\r\n\t * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).\r\n\t *\r\n\t * @alternative\r\n\t * @method on(eventMap: Object): this\r\n\t * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\t */\r\n\ton: function (types, fn, context) {\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\t// we don't process space-separated events here for performance;\r\n\t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n\t\t\t\tthis._on(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._on(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/* @method off(type: String, fn?: Function, context?: Object): this\r\n\t * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.\r\n\t *\r\n\t * @alternative\r\n\t * @method off(eventMap: Object): this\r\n\t * Removes a set of type/listener pairs.\r\n\t *\r\n\t * @alternative\r\n\t * @method off: this\r\n\t * Removes all listeners to all events on the object.\r\n\t */\r\n\toff: function (types, fn, context) {\r\n\r\n\t\tif (!types) {\r\n\t\t\t// clear all listeners if called without arguments\r\n\t\t\tdelete this._events;\r\n\r\n\t\t} else if (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis._off(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._off(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// attach listener (without syntactic sugar now)\r\n\t_on: function (type, fn, context) {\r\n\t\tthis._events = this._events || {};\r\n\r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._events[type];\r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._events[type] = typeListeners;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\t// Less memory footprint.\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\t\tvar newListener = {fn: fn, ctx: context},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if fn already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].fn === fn && listeners[i].ctx === context) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlisteners.push(newListener);\r\n\t},\r\n\r\n\t_off: function (type, fn, context) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n\r\n\t\tif (!this._events) { return; }\r\n\r\n\t\tlisteners = this._events[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!fn) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].fn = Util.falseFn;\r\n\t\t\t}\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._events[type];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find fn and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.ctx !== context) { continue; }\r\n\t\t\t\tif (l.fn === fn) {\r\n\r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\tl.fn = Util.falseFn;\r\n\r\n\t\t\t\t\tif (this._firingCount) {\r\n\t\t\t\t\t\t/* copy array in case events are being fired */\r\n\t\t\t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners.splice(i, 1);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// @method fire(type: String, data?: Object, propagate?: Boolean): this\r\n\t// Fires an event of the specified type. You can optionally provide an data\r\n\t// object — the first argument of the listener function will contain its\r\n\t// properties. The event can optionally be propagated to event parents.\r\n\tfire: function (type, data, propagate) {\r\n\t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n\t\tvar event = Util.extend({}, data, {type: type, target: this});\r\n\r\n\t\tif (this._events) {\r\n\t\t\tvar listeners = this._events[type];\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n\t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tvar l = listeners[i];\r\n\t\t\t\t\tl.fn.call(l.ctx || this, event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._firingCount--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// propagate the event to parents (set with addEventParent)\r\n\t\t\tthis._propagateEvent(event);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method listens(type: String): Boolean\r\n\t// Returns `true` if a particular event type has any listeners attached to it.\r\n\tlistens: function (type, propagate) {\r\n\t\tvar listeners = this._events && this._events[type];\r\n\t\tif (listeners && listeners.length) { return true; }\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// also check parents for listeners if event propagates\r\n\t\t\tfor (var id in this._eventParents) {\r\n\t\t\t\tif (this._eventParents[id].listens(type, propagate)) { return true; }\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// @method once(…): this\r\n\t// Behaves as [`on(…)`](#evented-on), except the listener will only get fired once and then removed.\r\n\tonce: function (types, fn, context) {\r\n\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis.once(type, types[type], fn);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar handler = Util.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .off(types, fn, context)\r\n\t\t\t    .off(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\t// add a listener that's executed once and removed after that\r\n\t\treturn this\r\n\t\t    .on(types, fn, context)\r\n\t\t    .on(types, handler, context);\r\n\t},\r\n\r\n\t// @method addEventParent(obj: Evented): this\r\n\t// Adds an event parent - an `Evented` that will receive propagated events\r\n\taddEventParent: function (obj) {\r\n\t\tthis._eventParents = this._eventParents || {};\r\n\t\tthis._eventParents[Util.stamp(obj)] = obj;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method removeEventParent(obj: Evented): this\r\n\t// Removes an event parent, so it will stop receiving propagated events\r\n\tremoveEventParent: function (obj) {\r\n\t\tif (this._eventParents) {\r\n\t\t\tdelete this._eventParents[Util.stamp(obj)];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\tfor (var id in this._eventParents) {\r\n\t\t\tthis._eventParents[id].fire(e.type, Util.extend({layer: e.target}, e), true);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar proto = Evented.prototype;\r\n\r\n// aliases; we should ditch those eventually\r\n\r\n// @method addEventListener(…): this\r\n// Alias to [`on(…)`](#evented-on)\r\nproto.addEventListener = proto.on;\r\n\r\n// @method removeEventListener(…): this\r\n// Alias to [`off(…)`](#evented-off)\r\n\r\n// @method clearAllEventListeners(…): this\r\n// Alias to [`off()`](#evented-off)\r\nproto.removeEventListener = proto.clearAllEventListeners = proto.off;\r\n\r\n// @method addOneTimeEventListener(…): this\r\n// Alias to [`once(…)`](#evented-once)\r\nproto.addOneTimeEventListener = proto.once;\r\n\r\n// @method fireEvent(…): this\r\n// Alias to [`fire(…)`](#evented-fire)\r\nproto.fireEvent = proto.fire;\r\n\r\n// @method hasEventListeners(…): Boolean\r\n// Alias to [`listens(…)`](#evented-listens)\r\nproto.hasEventListeners = proto.listens;\r\n","\n/*\n * @namespace Browser\n * @aka L.Browser\n *\n * A namespace with static properties for browser/feature detection used by Leaflet internally.\n *\n * @example\n *\n * ```js\n * if (L.Browser.ielt9) {\n *   alert('Upgrade your browser, dude!');\n * }\n * ```\n */\n\nvar style = document.documentElement.style;\n\n// @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).\nexport var ie = 'ActiveXObject' in window;\n\n// @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.\nexport var ielt9 = ie && !document.addEventListener;\n\n// @property edge: Boolean; `true` for the Edge web browser.\nexport var edge = 'msLaunchUri' in navigator && !('documentMode' in document);\n\n// @property webkit: Boolean;\n// `true` for webkit-based browsers like Chrome and Safari (including mobile versions).\nexport var webkit = userAgentContains('webkit');\n\n// @property android: Boolean\n// `true` for any browser running on an Android platform.\nexport var android = userAgentContains('android');\n\n// @property android23: Boolean; `true` for browsers running on Android 2 or Android 3.\nexport var android23 = userAgentContains('android 2') || userAgentContains('android 3');\n\n// @property opera: Boolean; `true` for the Opera browser\nexport var opera = !!window.opera;\n\n// @property chrome: Boolean; `true` for the Chrome browser.\nexport var chrome = userAgentContains('chrome');\n\n// @property gecko: Boolean; `true` for gecko-based browsers like Firefox.\nexport var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;\n\n// @property safari: Boolean; `true` for the Safari browser.\nexport var safari = !chrome && userAgentContains('safari');\n\nexport var phantom = userAgentContains('phantom');\n\n// @property opera12: Boolean\n// `true` for the Opera browser supporting CSS transforms (version 12 or later).\nexport var opera12 = 'OTransition' in style;\n\n// @property win: Boolean; `true` when the browser is running in a Windows platform\nexport var win = navigator.platform.indexOf('Win') === 0;\n\n// @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.\nexport var ie3d = ie && ('transition' in style);\n\n// @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.\nexport var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;\n\n// @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.\nexport var gecko3d = 'MozPerspective' in style;\n\n// @property any3d: Boolean\n// `true` for all browsers supporting CSS transforms.\nexport var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;\n\n// @property mobile: Boolean; `true` for all browsers running in a mobile device.\nexport var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');\n\n// @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.\nexport var mobileWebkit = mobile && webkit;\n\n// @property mobileWebkit3d: Boolean\n// `true` for all webkit-based browsers in a mobile device supporting CSS transforms.\nexport var mobileWebkit3d = mobile && webkit3d;\n\n// @property msPointer: Boolean\n// `true` for browsers implementing the Microsoft touch events model (notably IE10).\nexport var msPointer = !window.PointerEvent && window.MSPointerEvent;\n\n// @property pointer: Boolean\n// `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\nexport var pointer = !!(window.PointerEvent || msPointer);\n\n// @property touch: Boolean\n// `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).\n// This does not necessarily mean that the browser is running in a computer with\n// a touchscreen, it only means that the browser is capable of understanding\n// touch events.\nexport var touch = !window.L_NO_TOUCH && (pointer || 'ontouchstart' in window ||\n        (window.DocumentTouch && document instanceof window.DocumentTouch));\n\n// @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.\nexport var mobileOpera = mobile && opera;\n\n// @property mobileGecko: Boolean\n// `true` for gecko-based browsers running in a mobile device.\nexport var mobileGecko = mobile && gecko;\n\n// @property retina: Boolean\n// `true` for browsers on a high-resolution \"retina\" screen.\nexport var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;\n\n\n// @property canvas: Boolean\n// `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\nexport var canvas = (function () {\n    return !!document.createElement('canvas').getContext;\n}());\n\n// @property svg: Boolean\n// `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).\n// export var svg = !!(document.createElementNS && svgCreate('svg').createSVGRect);\nexport var svg = true;\n\n// @property vml: Boolean\n// `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).\nexport var vml = !svg && (function () {\n    try {\n        var div = document.createElement('div');\n        div.innerHTML = '<v:shape adj=\"1\"/>';\n\n        var shape = div.firstChild;\n        shape.style.behavior = 'url(#default#VML)';\n\n        return shape && (typeof shape.adj === 'object');\n\n    } catch (e) {\n        return false;\n    }\n}());\n\nexport var columnCount = ( 'columnCount' in style );\nexport var classList = ( document.documentElement.classList !== undefined );\n\nfunction userAgentContains(str) {\n    return navigator.userAgent.toLowerCase().indexOf(str) >= 0;\n}\n","import {isArray, formatNum} from '../core/Util';\r\n\r\n/*\r\n * @class Point\r\n * @aka L.Point\r\n *\r\n * Represents a point with `x` and `y` coordinates in pixels.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * var point = L.point(200, 300);\r\n * ```\r\n *\r\n * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:\r\n *\r\n * ```js\r\n * map.panBy([200, 300]);\r\n * map.panBy(L.point(200, 300));\r\n * ```\r\n */\r\n\r\nexport function Point(x, y, round) {\r\n\t// @property x: Number; The `x` coordinate of the point\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\t// @property y: Number; The `y` coordinate of the point\r\n\tthis.y = (round ? Math.round(y) : y);\r\n}\r\n\r\nPoint.prototype = {\r\n\r\n\t// @method clone(): Point\r\n\t// Returns a copy of the current point.\r\n\tclone: function () {\r\n\t\treturn new Point(this.x, this.y);\r\n\t},\r\n\r\n\t// @method add(otherPoint: Point): Point\r\n\t// Returns the result of addition of the current and the given points.\r\n\tadd: function (point) {\r\n\t\t// non-destructive, returns a new point\r\n\t\treturn this.clone()._add(toPoint(point));\r\n\t},\r\n\r\n\t_add: function (point) {\r\n\t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method subtract(otherPoint: Point): Point\r\n\t// Returns the result of subtraction of the given point from the current.\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(toPoint(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method divideBy(num: Number): Point\r\n\t// Returns the result of division of the current point by the given number.\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method multiplyBy(num: Number): Point\r\n\t// Returns the result of multiplication of the current point by the given number.\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method scaleBy(scale: Point): Point\r\n\t// Multiply each coordinate of the current point by each coordinate of\r\n\t// `scale`. In linear algebra terms, multiply the point by the\r\n\t// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)\r\n\t// defined by `scale`.\r\n\tscaleBy: function (point) {\r\n\t\treturn new Point(this.x * point.x, this.y * point.y);\r\n\t},\r\n\r\n\t// @method unscaleBy(scale: Point): Point\r\n\t// Inverse of `scaleBy`. Divide each coordinate of the current point by\r\n\t// each coordinate of `scale`.\r\n\tunscaleBy: function (point) {\r\n\t\treturn new Point(this.x / point.x, this.y / point.y);\r\n\t},\r\n\r\n\t// @method round(): Point\r\n\t// Returns a copy of the current point with rounded coordinates.\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method floor(): Point\r\n\t// Returns a copy of the current point with floored coordinates (rounded down).\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method ceil(): Point\r\n\t// Returns a copy of the current point with ceiled coordinates (rounded up).\r\n\tceil: function () {\r\n\t\treturn this.clone()._ceil();\r\n\t},\r\n\r\n\t_ceil: function () {\r\n\t\tthis.x = Math.ceil(this.x);\r\n\t\tthis.y = Math.ceil(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method distanceTo(otherPoint: Point): Number\r\n\t// Returns the cartesian distance between the current and the given points.\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\t// @method equals(otherPoint: Point): Boolean\r\n\t// Returns `true` if the given point has the same coordinates.\r\n\tequals: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\t// @method contains(otherPoint: Point): Boolean\r\n\t// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).\r\n\tcontains: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// Returns a string representation of the point for debugging purposes.\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        formatNum(this.x) + ', ' +\r\n\t\t        formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\n// @factory L.point(x: Number, y: Number, round?: Boolean)\r\n// Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Number[])\r\n// Expects an array of the form `[x, y]` instead.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Object)\r\n// Expects a plain object of the form `{x: Number, y: Number}` instead.\r\nexport function toPoint(x, y, round) {\r\n\tif (x instanceof Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (isArray(x)) {\r\n\t\treturn new Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\tif (typeof x === 'object' && 'x' in x && 'y' in x) {\r\n\t\treturn new Point(x.x, x.y);\r\n\t}\r\n\treturn new Point(x, y, round);\r\n}\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport * as Browser from '../core/Browser';\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\n\nvar POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown',\n    POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove',\n    POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup',\n    POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n    TAG_WHITE_LIST = ['INPUT', 'SELECT', 'OPTION'],\n\n    _pointers = {},\n    _pointerDocListener = false;\n\n// DomEvent.DoubleTap needs to know about this\nexport var _pointersCount = 0;\n\n// Provides a touch events wrapper for (ms)pointer events.\n// ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\nexport function addPointerListener(obj, type, handler, id) {\n\tif (type === 'touchstart') {\n\t\t_addPointerStart(obj, handler, id);\n\n\t} else if (type === 'touchmove') {\n\t\t_addPointerMove(obj, handler, id);\n\n\t} else if (type === 'touchend') {\n\t\t_addPointerEnd(obj, handler, id);\n\t}\n\n\treturn this;\n}\n\nexport function removePointerListener(obj, type, id) {\n\tvar handler = obj['_leaflet_' + type + id];\n\n\tif (type === 'touchstart') {\n\t\tobj.removeEventListener(POINTER_DOWN, handler, false);\n\n\t} else if (type === 'touchmove') {\n\t\tobj.removeEventListener(POINTER_MOVE, handler, false);\n\n\t} else if (type === 'touchend') {\n\t\tobj.removeEventListener(POINTER_UP, handler, false);\n\t\tobj.removeEventListener(POINTER_CANCEL, handler, false);\n\t}\n\n\treturn this;\n}\n\nfunction _addPointerStart(obj, handler, id) {\n\tvar onDown = Util.bind(function (e) {\n\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\n\t\t\t// In IE11, some touch events needs to fire for form controls, or\n\t\t\t// the controls will stop working. We keep a whitelist of tag names that\n\t\t\t// need these events. For other target tags, we prevent default on the event.\n\t\t\tif (TAG_WHITE_LIST.indexOf(e.target.tagName) < 0) {\n\t\t\t\tDomEvent.preventDefault(e);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t_handlePointer(e, handler);\n\t});\n\n\tobj['_leaflet_touchstart' + id] = onDown;\n\tobj.addEventListener(POINTER_DOWN, onDown, false);\n\n\t// need to keep track of what pointers and how many are active to provide e.touches emulation\n\tif (!_pointerDocListener) {\n\t\t// we listen documentElement as any drags that end by moving the touch off the screen get fired there\n\t\tdocument.documentElement.addEventListener(POINTER_DOWN, _globalPointerDown, true);\n\t\tdocument.documentElement.addEventListener(POINTER_MOVE, _globalPointerMove, true);\n\t\tdocument.documentElement.addEventListener(POINTER_UP, _globalPointerUp, true);\n\t\tdocument.documentElement.addEventListener(POINTER_CANCEL, _globalPointerUp, true);\n\n\t\t_pointerDocListener = true;\n\t}\n}\n\nfunction _globalPointerDown(e) {\n\t_pointers[e.pointerId] = e;\n\t_pointersCount++;\n}\n\nfunction _globalPointerMove(e) {\n\tif (_pointers[e.pointerId]) {\n\t\t_pointers[e.pointerId] = e;\n\t}\n}\n\nfunction _globalPointerUp(e) {\n\tdelete _pointers[e.pointerId];\n\t_pointersCount--;\n}\n\nfunction _handlePointer(e, handler) {\n\te.touches = [];\n\tfor (var i in _pointers) {\n\t\te.touches.push(_pointers[i]);\n\t}\n\te.changedTouches = [e];\n\n\thandler(e);\n}\n\nfunction _addPointerMove(obj, handler, id) {\n\tvar onMove = function (e) {\n\t\t// don't fire touch moves when mouse isn't down\n\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchmove' + id] = onMove;\n\tobj.addEventListener(POINTER_MOVE, onMove, false);\n}\n\nfunction _addPointerEnd(obj, handler, id) {\n\tvar onUp = function (e) {\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchend' + id] = onUp;\n\tobj.addEventListener(POINTER_UP, onUp, false);\n\tobj.addEventListener(POINTER_CANCEL, onUp, false);\n}\n\n","import * as Browser from '../core/Browser';\r\nimport {_pointersCount} from './DomEvent.Pointer';\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nvar _touchstart = Browser.msPointer ? 'MSPointerDown' : Browser.pointer ? 'pointerdown' : 'touchstart',\r\n    _touchend = Browser.msPointer ? 'MSPointerUp' : Browser.pointer ? 'pointerup' : 'touchend',\r\n    _pre = '_leaflet_';\r\n\r\n// inspired by Zepto touch code by Thomas Fuchs\r\nexport function addDoubleTapListener(obj, handler, id) {\r\n\tvar last, touch,\r\n\t    doubleTap = false,\r\n\t    delay = 250;\r\n\r\n\tfunction onTouchStart(e) {\r\n\t\tvar count;\r\n\r\n\t\tif (Browser.pointer) {\r\n\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\tcount = _pointersCount;\r\n\t\t} else {\r\n\t\t\tcount = e.touches.length;\r\n\t\t}\r\n\r\n\t\tif (count > 1) { return; }\r\n\r\n\t\tvar now = Date.now(),\r\n\t\t    delta = now - (last || now);\r\n\r\n\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\tlast = now;\r\n\t}\r\n\r\n\tfunction onTouchEnd(e) {\r\n\t\tif (doubleTap && !touch.cancelBubble) {\r\n\t\t\tif (Browser.pointer) {\r\n\t\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\tvar newTouch = {},\r\n\t\t\t\t    prop, i;\r\n\r\n\t\t\t\tfor (i in touch) {\r\n\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\tnewTouch[i] = prop && prop.bind ? prop.bind(touch) : prop;\r\n\t\t\t\t}\r\n\t\t\t\ttouch = newTouch;\r\n\t\t\t}\r\n\t\t\ttouch.type = 'dblclick';\r\n\t\t\thandler(touch);\r\n\t\t\tlast = null;\r\n\t\t}\r\n\t}\r\n\r\n\tobj[_pre + _touchstart + id] = onTouchStart;\r\n\tobj[_pre + _touchend + id] = onTouchEnd;\r\n\tobj[_pre + 'dblclick' + id] = handler;\r\n\r\n\tobj.addEventListener(_touchstart, onTouchStart, false);\r\n\tobj.addEventListener(_touchend, onTouchEnd, false);\r\n\r\n\t// On some platforms (notably, chrome<55 on win10 + touchscreen + mouse),\r\n\t// the browser doesn't fire touchend/pointerup events but does fire\r\n\t// native dblclicks. See #4127.\r\n\t// Edge 14 also fires native dblclicks, but only for pointerType mouse, see #5180.\r\n\tobj.addEventListener('dblclick', handler, false);\r\n\r\n\treturn this;\r\n}\r\n\r\nexport function removeDoubleTapListener(obj, id) {\r\n\tvar touchstart = obj[_pre + _touchstart + id],\r\n\t    touchend = obj[_pre + _touchend + id],\r\n\t    dblclick = obj[_pre + 'dblclick' + id];\r\n\r\n\tobj.removeEventListener(_touchstart, touchstart, false);\r\n\tobj.removeEventListener(_touchend, touchend, false);\r\n\tif (!Browser.edge) {\r\n\t\tobj.removeEventListener('dblclick', dblclick, false);\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n","import {Point} from '../geometry/Point';\r\nimport * as Util from '../core/Util';\r\nimport * as Browser from '../core/Browser';\r\nimport {addPointerListener, removePointerListener} from './DomEvent.Pointer';\r\nimport {addDoubleTapListener, removeDoubleTapListener} from './DomEvent.DoubleTap';\r\n\r\n/*\r\n * @namespace DomEvent\r\n * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.\r\n */\r\n\r\n// Inspired by John Resig, Dean Edwards and YUI addEvent implementations.\r\n\r\n// @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Adds a listener function (`fn`) to a particular DOM event type of the\r\n// element `el`. You can optionally specify the context of the listener\r\n// (object the `this` keyword will point to). You can also pass several\r\n// space-separated types (e.g. `'click dblclick'`).\r\n\r\n// @alternative\r\n// @function on(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\nexport function on(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\taddOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\taddOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\n// @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Removes a previously added listener function. If no function is specified,\r\n// it will remove all the listeners of that particular DOM event from the element.\r\n// Note that if you passed a custom context to on, you must pass the same\r\n// context to `off` in order to remove the listener.\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement): this\r\n// Removes all known event listeners\r\nexport function off(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\tremoveOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else if (types) {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\tremoveOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var j in obj[eventsKey]) {\r\n\t\t\tremoveOne(obj, j, obj[eventsKey][j]);\r\n\t\t}\r\n\t\tdelete obj[eventsKey];\r\n\t}\r\n}\r\n\r\nfunction addOne(obj, type, fn, context) {\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : '');\r\n\r\n\tif (obj[eventsKey] && obj[eventsKey][id]) { return this; }\r\n\r\n\tvar handler = function (e) {\r\n\t\treturn fn.call(context || obj, e || window.event);\r\n\t};\r\n\r\n\tvar originalHandler = handler;\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t// Needs DomEvent.Pointer.js\r\n\t\taddPointerListener(obj, type, handler, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && addDoubleTapListener &&\r\n\t           !(Browser.pointer && Browser.chrome)) {\r\n\t\t// Chrome >55 does not need the synthetic dblclicks from addDoubleTapListener\r\n\t\t// See #5180\r\n\t\taddDoubleTapListener(obj, handler, id);\r\n\r\n\t} else if ('addEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.addEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\thandler = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif (isExternalTarget(obj, e)) {\r\n\t\t\t\t\toriginalHandler(e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tobj.addEventListener(type === 'mouseenter' ? 'mouseover' : 'mouseout', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tif (type === 'click' && Browser.android) {\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tfilterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('attachEvent' in obj) {\r\n\t\tobj.attachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey] = obj[eventsKey] || {};\r\n\tobj[eventsKey][id] = handler;\r\n}\r\n\r\nfunction removeOne(obj, type, fn, context) {\r\n\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : ''),\r\n\t    handler = obj[eventsKey] && obj[eventsKey][id];\r\n\r\n\tif (!handler) { return this; }\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\tremovePointerListener(obj, type, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && removeDoubleTapListener) {\r\n\t\tremoveDoubleTapListener(obj, id);\r\n\r\n\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.removeEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tobj.removeEventListener(\r\n\t\t\t\ttype === 'mouseenter' ? 'mouseover' :\r\n\t\t\t\ttype === 'mouseleave' ? 'mouseout' : type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('detachEvent' in obj) {\r\n\t\tobj.detachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey][id] = null;\r\n}\r\n\r\n// @function stopPropagation(ev: DOMEvent): this\r\n// Stop the given event from propagation to parent elements. Used inside the listener functions:\r\n// ```js\r\n// L.DomEvent.on(div, 'click', function (ev) {\r\n// \tL.DomEvent.stopPropagation(ev);\r\n// });\r\n// ```\r\nexport function stopPropagation(e) {\r\n\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else if (e.originalEvent) {  // In case of Leaflet event.\r\n\t\te.originalEvent._stopped = true;\r\n\t} else {\r\n\t\te.cancelBubble = true;\r\n\t}\r\n\tskipped(e);\r\n\r\n\treturn this;\r\n}\r\n\r\n// @function disableScrollPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'mousewheel'` events (plus browser variants).\r\nexport function disableScrollPropagation(el) {\r\n\treturn addOne(el, 'mousewheel', stopPropagation);\r\n}\r\n\r\n// @function disableClickPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'click'`, `'doubleclick'`,\r\n// `'mousedown'` and `'touchstart'` events (plus browser variants).\r\nexport function disableClickPropagation(el) {\r\n\ton(el, 'mousedown touchstart dblclick', stopPropagation);\r\n\taddOne(el, 'click', fakeStop);\r\n\treturn this;\r\n}\r\n\r\n// @function preventDefault(ev: DOMEvent): this\r\n// Prevents the default action of the DOM Event `ev` from happening (such as\r\n// following a link in the href of the a element, or doing a POST request\r\n// with page reload when a `<form>` is submitted).\r\n// Use it inside listener functions.\r\nexport function preventDefault(e) {\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// @function stop(ev): this\r\n// Does `stopPropagation` and `preventDefault` at the same time.\r\nexport function stop(e) {\r\n\tpreventDefault(e);\r\n\tstopPropagation(e);\r\n\treturn this;\r\n}\r\n\r\n// @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point\r\n// Gets normalized mouse position from a DOM event relative to the\r\n// `container` or to the whole page if not specified.\r\nexport function getMousePosition(e, container) {\r\n\tif (!container) {\r\n\t\treturn new Point(e.clientX, e.clientY);\r\n\t}\r\n\r\n\tvar rect = container.getBoundingClientRect();\r\n\r\n\treturn new Point(\r\n\t\te.clientX - rect.left - container.clientLeft,\r\n\t\te.clientY - rect.top - container.clientTop);\r\n}\r\n\r\n// Chrome on Win scrolls double the pixels as in other platforms (see #4538),\r\n// and Firefox scrolls device pixels, not CSS pixels\r\nvar wheelPxFactor =\r\n\t(Browser.win && Browser.chrome) ? 2 :\r\n\tBrowser.gecko ? window.devicePixelRatio : 1;\r\n\r\n// @function getWheelDelta(ev: DOMEvent): Number\r\n// Gets normalized wheel delta from a mousewheel DOM event, in vertical\r\n// pixels scrolled (negative if scrolling down).\r\n// Events from pointing devices without precise scrolling are mapped to\r\n// a best guess of 60 pixels.\r\nexport function getWheelDelta(e) {\r\n\treturn (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta\r\n\t       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels\r\n\t       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines\r\n\t       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages\r\n\t       (e.deltaX || e.deltaZ) ? 0 :\t// Skip horizontal/depth wheel events\r\n\t       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels\r\n\t       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines\r\n\t       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages\r\n\t       0;\r\n}\r\n\r\nvar skipEvents = {};\r\n\r\nexport function fakeStop(e) {\r\n\t// fakes stopPropagation by setting a special event flag, checked/reset with skipped(e)\r\n\tskipEvents[e.type] = true;\r\n}\r\n\r\nexport function skipped(e) {\r\n\tvar events = skipEvents[e.type];\r\n\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\tskipEvents[e.type] = false;\r\n\treturn events;\r\n}\r\n\r\n// check if element really left/entered the event target (for mouseenter/mouseleave)\r\nexport function isExternalTarget(el, e) {\r\n\r\n\tvar related = e.relatedTarget;\r\n\r\n\tif (!related) { return true; }\r\n\r\n\ttry {\r\n\t\twhile (related && (related !== el)) {\r\n\t\t\trelated = related.parentNode;\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn false;\r\n\t}\r\n\treturn (related !== el);\r\n}\r\n\r\nvar lastClick;\r\n\r\n// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\nfunction filterClick(e, handler) {\r\n\tvar timeStamp = (e.timeStamp || (e.originalEvent && e.originalEvent.timeStamp)),\r\n\t    elapsed = lastClick && (timeStamp - lastClick);\r\n\r\n\t// are they closer together than 500ms yet more than 100ms?\r\n\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t// on the same event should be triggered far faster;\r\n\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\tstop(e);\r\n\t\treturn;\r\n\t}\r\n\tlastClick = timeStamp;\r\n\r\n\thandler(e);\r\n}\r\n\r\n// @function addListener(…): this\r\n// Alias to [`L.DomEvent.on`](#domevent-on)\r\nexport {on as addListener};\r\n\r\n// @function removeListener(…): this\r\n// Alias to [`L.DomEvent.off`](#domevent-off)\r\nexport {off as removeListener};\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport {Point} from '../geometry/Point';\nimport * as Browser from '../core/Browser';\n\n/*\n * @namespace DomUtil\n *\n * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\n * tree, used by Leaflet internally.\n *\n * Most functions expecting or returning a `HTMLElement` also work for\n * SVG elements. The only difference is that classes refer to CSS classes\n * in HTML and SVG classes in SVG.\n */\n\n if (!Element.prototype.matches) {\n    var ep = Element.prototype;\n \n    if (ep.webkitMatchesSelector) // Chrome <34, SF<7.1, iOS<8\n      ep.matches = ep.webkitMatchesSelector;\n \n    if (ep.msMatchesSelector) // IE9/10/11 & Edge\n      ep.matches = ep.msMatchesSelector;\n \n    if (ep.mozMatchesSelector) // FF<34\n      ep.matches = ep.mozMatchesSelector;\n }\n\n// @property TRANSFORM: String\n// Vendor-prefixed fransform style name (e.g. `'webkitTransform'` for WebKit).\nexport var TRANSFORM = testProp(\n    ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\n\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\n// the same for the transitionend event, in particular the Android 4.1 stock browser\n\n// @property TRANSITION: String\n// Vendor-prefixed transform style name.\nexport var TRANSITION = testProp(\n    ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\n\nexport var TRANSITION_END =\n    TRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';\n\n\n// @function get(id: String|HTMLElement): HTMLElement\n// Returns an element given its DOM id, or returns the element itself\n// if it was passed directly.\nexport function get(id) {\n    return typeof id === 'string' ? document.getElementById(id) : id;\n}\n\n// @function getStyle(el: HTMLElement, styleAttrib: String): String\n// Returns the value for a certain style attribute on an element,\n// including computed values or values set through CSS.\nexport function getStyle(el, style) {\n    var value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\n\n    if ((!value || value === 'auto') && document.defaultView) {\n        var css = document.defaultView.getComputedStyle(el, null);\n        value = css ? css[style] : null;\n    }\n    return value === 'auto' ? null : value;\n}\n\n// @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\n// Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\nexport function create(tagName, className, container) {\n    var el = document.createElement(tagName);\n    el.className = className || '';\n\n    if (container) {\n        container.appendChild(el);\n    }\n    return el;\n}\n\n// @function remove(el: HTMLElement)\n// Removes `el` from its parent element\nexport function remove(el) {\n    var parent = el.parentNode;\n    if (parent) {\n        parent.removeChild(el);\n    }\n}\n\n// @function empty(el: HTMLElement)\n// Removes all of `el`'s children elements from `el`\nexport function empty(el) {\n    while (el.firstChild) {\n        el.removeChild(el.firstChild);\n    }\n}\n\n// @function toFront(el: HTMLElement)\n// Makes `el` the last child of its parent, so it renders in front of the other children.\nexport function toFront(el) {\n    el.parentNode.appendChild(el);\n}\n\n// @function toBack(el: HTMLElement)\n// Makes `el` the first child of its parent, so it renders behind the other children.\nexport function toBack(el) {\n    var parent = el.parentNode;\n    parent.insertBefore(el, parent.firstChild);\n}\n\n// @function hasClass(el: HTMLElement, name: String): Boolean\n// Returns `true` if the element's class attribute contains `name`.\nexport function hasClass(el, name) {\n    if (el.classList !== undefined) {\n        return el.classList.contains(name);\n    }\n    var className = getClass(el);\n    return className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\n}\n\n// @function addClass(el: HTMLElement, name: String)\n// Adds `name` to the element's class attribute.\nexport function addClass(el, name) {\n    if (el.classList !== undefined) {\n        var classes = Util.splitWords(name);\n        for (var i = 0, len = classes.length; i < len; i++) {\n            el.classList.add(classes[i]);\n        }\n    } else if (!hasClass(el, name)) {\n        var className = getClass(el);\n        setClass(el, (className ? className + ' ' : '') + name);\n    }\n}\n\n// @function removeClass(el: HTMLElement, name: String)\n// Removes `name` from the element's class attribute.\nexport function removeClass(el, name) {\n    if (el.classList !== undefined) {\n        el.classList.remove(name);\n    } else {\n        setClass(el, Util.trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\n    }\n}\n\n// @function setClass(el: HTMLElement, name: String)\n// Sets the element's class.\nexport function setClass(el, name) {\n    if (el.className.baseVal === undefined) {\n        el.className = name;\n    } else {\n        // in case of SVG element\n        el.className.baseVal = name;\n    }\n}\n\n// @function getClass(el: HTMLElement): String\n// Returns the element's class.\nexport function getClass(el) {\n    return el.className.baseVal === undefined ? el.className : el.className.baseVal;\n}\n\n// @function setOpacity(el: HTMLElement, opacity: Number)\n// Set the opacity of an element (including old IE support).\n// `opacity` must be a number from `0` to `1`.\nexport function setOpacity(el, value) {\n    if ('opacity' in el.style) {\n        el.style.opacity = value;\n    } else if ('filter' in el.style) {\n        _setOpacityIE(el, value);\n    }\n}\n\nfunction _setOpacityIE(el, value) {\n    var filter = false,\n        filterName = 'DXImageTransform.Microsoft.Alpha';\n\n    // filters collection throws an error if we try to retrieve a filter that doesn't exist\n    try {\n        filter = el.filters.item(filterName);\n    } catch (e) {\n        // don't set opacity to 1 if we haven't already set an opacity,\n        // it isn't needed and breaks transparent pngs.\n        if (value === 1) { return; }\n    }\n\n    value = Math.round(value * 100);\n\n    if (filter) {\n        filter.Enabled = (value !== 100);\n        filter.Opacity = value;\n    } else {\n        el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\n    }\n}\n\n// @function testProp(props: String[]): String|false\n// Goes through the array of style names and returns the first name\n// that is a valid style name for an element. If no such name is found,\n// it returns false. Useful for vendor-prefixed styles like `transform`.\nexport function testProp(props) {\n    var style = document.documentElement.style;\n\n    for (var i = 0; i < props.length; i++) {\n        if (props[i] in style) {\n            return props[i];\n        }\n    }\n    return false;\n}\n\nexport function isPropertySupported(prop) {\n    var style = document.documentElement.style;\n    return prop in style;\n}\n\n// @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\n// Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\n// and optionally scaled by `scale`. Does not have an effect if the\n// browser doesn't support 3D CSS transforms.\nexport function setTransform(el, offset, scale) {\n    var pos = offset || new Point(0, 0);\n\n    el.style[TRANSFORM] =\n        (Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n}\n\n// @function setPosition(el: HTMLElement, position: Point)\n// Sets the position of `el` to coordinates specified by `position`,\n// using CSS translate or top/left positioning depending on the browser\n// (used by Leaflet internally to position its layers).\nexport function setPosition(el, point) {\n\n    /*eslint-disable */\n    el._leaflet_pos = point;\n    /*eslint-enable */\n\n    if (Browser.any3d) {\n        setTransform(el, point);\n    } else {\n        el.style.left = point.x + 'px';\n        el.style.top = point.y + 'px';\n    }\n}\n\n// @function getPosition(el: HTMLElement): Point\n// Returns the coordinates of an element previously positioned with setPosition.\nexport function getPosition(el) {\n    // this method is only used for elements previously positioned using setPosition,\n    // so it's safe to cache the position for performance\n\n    return el._leaflet_pos || new Point(0, 0);\n}\n\n// @function disableTextSelection()\n// Prevents the user from generating `selectstart` DOM events, usually generated\n// when the user drags the mouse through a page with text. Used internally\n// by Leaflet to override the behaviour of any click-and-drag interaction on\n// the map. Affects drag interactions on the whole document.\n\n// @function enableTextSelection()\n// Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).\nexport var disableTextSelection;\nexport var enableTextSelection;\nvar _userSelect;\nif ('onselectstart' in document) {\n    disableTextSelection = function () {\n        DomEvent.on(window, 'selectstart', DomEvent.preventDefault);\n    };\n    enableTextSelection = function () {\n        DomEvent.off(window, 'selectstart', DomEvent.preventDefault);\n    };\n} else {\n    var userSelectProperty = testProp(\n        ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\n\n    disableTextSelection = function () {\n        if (userSelectProperty) {\n            var style = document.documentElement.style;\n            _userSelect = style[userSelectProperty];\n            style[userSelectProperty] = 'none';\n        }\n    };\n    enableTextSelection = function () {\n        if (userSelectProperty) {\n            document.documentElement.style[userSelectProperty] = _userSelect;\n            _userSelect = undefined;\n        }\n    };\n}\n\n// @function disableImageDrag()\n// As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\n// for `dragstart` DOM events, usually generated when the user drags an image.\nexport function disableImageDrag() {\n    DomEvent.on(window, 'dragstart', DomEvent.preventDefault);\n}\n\n// @function enableImageDrag()\n// Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).\nexport function enableImageDrag() {\n    DomEvent.off(window, 'dragstart', DomEvent.preventDefault);\n}\n\nvar _outlineElement, _outlineStyle;\n// @function preventOutline(el: HTMLElement)\n// Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\n// of the element `el` invisible. Used internally by Leaflet to prevent\n// focusable elements from displaying an outline when the user performs a\n// drag interaction on them.\nexport function preventOutline(element) {\n    while (element.tabIndex === -1) {\n        element = element.parentNode;\n    }\n    if (!element || !element.style) { return; }\n    restoreOutline();\n    _outlineElement = element;\n    _outlineStyle = element.style.outline;\n    element.style.outline = 'none';\n    DomEvent.on(window, 'keydown', restoreOutline);\n}\n\n// @function restoreOutline()\n// Cancels the effects of a previous [`L.DomUtil.preventOutline`]().\nexport function restoreOutline() {\n    if (!_outlineElement) { return; }\n    _outlineElement.style.outline = _outlineStyle;\n    _outlineElement = undefined;\n    _outlineStyle = undefined;\n    DomEvent.off(window, 'keydown', restoreOutline);\n}\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","var baseGetTag = require('./_baseGetTag'),\n    isObject = require('./isObject');\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nmodule.exports = isFunction;\n","var root = require('./_root');\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nmodule.exports = coreJsData;\n","var coreJsData = require('./_coreJsData');\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nmodule.exports = isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nmodule.exports = toSource;\n","var isFunction = require('./isFunction'),\n    isMasked = require('./_isMasked'),\n    isObject = require('./isObject'),\n    toSource = require('./_toSource');\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nmodule.exports = baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nmodule.exports = getValue;\n","var baseIsNative = require('./_baseIsNative'),\n    getValue = require('./_getValue');\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nmodule.exports = getNative;\n","var getNative = require('./_getNative');\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nmodule.exports = defineProperty;\n","var defineProperty = require('./_defineProperty');\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nmodule.exports = baseAssignValue;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nmodule.exports = eq;\n","var baseAssignValue = require('./_baseAssignValue'),\n    eq = require('./eq');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nmodule.exports = assignValue;\n","var assignValue = require('./_assignValue'),\n    baseAssignValue = require('./_baseAssignValue');\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nmodule.exports = copyObject;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nmodule.exports = identity;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nmodule.exports = apply;\n","var apply = require('./_apply');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nmodule.exports = overRest;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nmodule.exports = constant;\n","var constant = require('./constant'),\n    defineProperty = require('./_defineProperty'),\n    identity = require('./identity');\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nmodule.exports = baseSetToString;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nmodule.exports = shortOut;\n","var baseSetToString = require('./_baseSetToString'),\n    shortOut = require('./_shortOut');\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nmodule.exports = setToString;\n","var identity = require('./identity'),\n    overRest = require('./_overRest'),\n    setToString = require('./_setToString');\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nmodule.exports = baseRest;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nmodule.exports = isLength;\n","var isFunction = require('./isFunction'),\n    isLength = require('./isLength');\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nmodule.exports = isArrayLike;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\nmodule.exports = isIndex;\n","var eq = require('./eq'),\n    isArrayLike = require('./isArrayLike'),\n    isIndex = require('./_isIndex'),\n    isObject = require('./isObject');\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nmodule.exports = isIterateeCall;\n","var baseRest = require('./_baseRest'),\n    isIterateeCall = require('./_isIterateeCall');\n\n/**\n * Creates a function like `_.assign`.\n *\n * @private\n * @param {Function} assigner The function to assign values.\n * @returns {Function} Returns the new assigner function.\n */\nfunction createAssigner(assigner) {\n  return baseRest(function(object, sources) {\n    var index = -1,\n        length = sources.length,\n        customizer = length > 1 ? sources[length - 1] : undefined,\n        guard = length > 2 ? sources[2] : undefined;\n\n    customizer = (assigner.length > 3 && typeof customizer == 'function')\n      ? (length--, customizer)\n      : undefined;\n\n    if (guard && isIterateeCall(sources[0], sources[1], guard)) {\n      customizer = length < 3 ? undefined : customizer;\n      length = 1;\n    }\n    object = Object(object);\n    while (++index < length) {\n      var source = sources[index];\n      if (source) {\n        assigner(object, source, index, customizer);\n      }\n    }\n    return object;\n  });\n}\n\nmodule.exports = createAssigner;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nmodule.exports = isPrototype;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nmodule.exports = baseTimes;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nmodule.exports = baseIsArguments;\n","var baseIsArguments = require('./_baseIsArguments'),\n    isObjectLike = require('./isObjectLike');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nmodule.exports = isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nmodule.exports = isArray;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = stubFalse;\n","var root = require('./_root'),\n    stubFalse = require('./stubFalse');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nmodule.exports = isBuffer;\n","var baseGetTag = require('./_baseGetTag'),\n    isLength = require('./isLength'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nmodule.exports = baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nmodule.exports = baseUnary;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nmodule.exports = nodeUtil;\n","var baseIsTypedArray = require('./_baseIsTypedArray'),\n    baseUnary = require('./_baseUnary'),\n    nodeUtil = require('./_nodeUtil');\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nmodule.exports = isTypedArray;\n","var baseTimes = require('./_baseTimes'),\n    isArguments = require('./isArguments'),\n    isArray = require('./isArray'),\n    isBuffer = require('./isBuffer'),\n    isIndex = require('./_isIndex'),\n    isTypedArray = require('./isTypedArray');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = arrayLikeKeys;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nmodule.exports = overArg;\n","var overArg = require('./_overArg');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nmodule.exports = nativeKeys;\n","var isPrototype = require('./_isPrototype'),\n    nativeKeys = require('./_nativeKeys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseKeys;\n","var arrayLikeKeys = require('./_arrayLikeKeys'),\n    baseKeys = require('./_baseKeys'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nmodule.exports = keys;\n","var assignValue = require('./_assignValue'),\n    copyObject = require('./_copyObject'),\n    createAssigner = require('./_createAssigner'),\n    isArrayLike = require('./isArrayLike'),\n    isPrototype = require('./_isPrototype'),\n    keys = require('./keys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns own enumerable string keyed properties of source objects to the\n * destination object. Source objects are applied from left to right.\n * Subsequent sources overwrite property assignments of previous sources.\n *\n * **Note:** This method mutates `object` and is loosely based on\n * [`Object.assign`](https://mdn.io/Object/assign).\n *\n * @static\n * @memberOf _\n * @since 0.10.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @see _.assignIn\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * function Bar() {\n *   this.c = 3;\n * }\n *\n * Foo.prototype.b = 2;\n * Bar.prototype.d = 4;\n *\n * _.assign({ 'a': 0 }, new Foo, new Bar);\n * // => { 'a': 1, 'c': 3 }\n */\nvar assign = createAssigner(function(object, source) {\n  if (isPrototype(source) || isArrayLike(source)) {\n    copyObject(source, keys(source), object);\n    return;\n  }\n  for (var key in source) {\n    if (hasOwnProperty.call(source, key)) {\n      assignValue(object, key, source[key]);\n    }\n  }\n});\n\nmodule.exports = assign;\n","var document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\nvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\nvar fn = (function () {\n  var val;\n\n  var fnMap = [\n    [\n      'requestFullscreen',\n      'exitFullscreen',\n      'fullscreenElement',\n      'fullscreenEnabled',\n      'fullscreenchange',\n      'fullscreenerror'\n    ],\n    // New WebKit\n    [\n      'webkitRequestFullscreen',\n      'webkitExitFullscreen',\n      'webkitFullscreenElement',\n      'webkitFullscreenEnabled',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    // Old WebKit (Safari 5.1)\n    [\n      'webkitRequestFullScreen',\n      'webkitCancelFullScreen',\n      'webkitCurrentFullScreenElement',\n      'webkitCancelFullScreen',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    [\n      'mozRequestFullScreen',\n      'mozCancelFullScreen',\n      'mozFullScreenElement',\n      'mozFullScreenEnabled',\n      'mozfullscreenchange',\n      'mozfullscreenerror'\n    ],\n    [\n      'msRequestFullscreen',\n      'msExitFullscreen',\n      'msFullscreenElement',\n      'msFullscreenEnabled',\n      'MSFullscreenChange',\n      'MSFullscreenError'\n    ]\n  ];\n\n  var i = 0;\n  var l = fnMap.length;\n  var ret = {};\n\n  for (; i < l; i++) {\n    val = fnMap[i];\n    if (val && val[1] in document) {\n      for (i = 0; i < val.length; i++) {\n        ret[fnMap[0][i]] = val[i];\n      }\n      return ret;\n    }\n  }\n\n  return false;\n})();\n\nvar eventNameMap = {\n  change: fn.fullscreenchange,\n  error: fn.fullscreenerror\n};\n\nvar screenfull = {\n  request: function (elem) {\n    var request = fn.requestFullscreen;\n\n    elem = elem || document.documentElement;\n\n    // Work around Safari 5.1 bug: reports support for\n    // keyboard in fullscreen even though it doesn't.\n    // Browser sniffing, since the alternative with\n    // setTimeout is even worse.\n    if (/5\\.1[.\\d]* Safari/.test(navigator.userAgent)) {\n      elem[request]();\n    } else {\n      elem[request](keyboardAllowed && Element.ALLOW_KEYBOARD_INPUT);\n    }\n  },\n  exit: function () {\n    document[fn.exitFullscreen]();\n  },\n  toggle: function (elem) {\n    if (this.isFullscreen) {\n      this.exit();\n    } else {\n      this.request(elem);\n    }\n  },\n  onchange: function (callback) {\n    this.on('change', callback);\n  },\n  onerror: function (callback) {\n    this.on('error', callback);\n  },\n  on: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.addEventListener(eventName, callback, false);\n    }\n  },\n  off: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.removeEventListener(eventName, callback, false);\n    }\n  },\n  raw: fn\n};\n\nObject.defineProperties(screenfull, {\n  isFullscreen: {\n    get: function () {\n      return Boolean(document[fn.fullscreenElement]);\n    }\n  },\n  element: {\n    enumerable: true,\n    get: function () {\n      return document[fn.fullscreenElement];\n    }\n  },\n  enabled: {\n    enumerable: true,\n    get: function () {\n      // Coerce to boolean in case of old WebKit\n      return Boolean(document[fn.fullscreenEnabled]);\n    }\n  }\n});\n\nexport {screenfull};","import * as Util from '../core/Util';\nimport {Evented} from '../core/Events';\n// import {Class} from '../core/Class';\nimport * as Browser from '../core/Browser';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as DomUtil from '../dom/DomUtil';\n\nimport debounce from 'lodash/debounce';\nimport assign from 'lodash/assign';\n\nimport {screenfull} from '../screenfull';\n\n/*\n * @class Reader\n * @aka cozy.Map\n * @inherits Evented\n *\n * The central class of the API — it is used to create a book on a page and manipulate it.\n *\n * @example\n *\n * ```js\n * // initialize the map on the \"map\" div with a given center and zoom\n * var map = L.map('map', {\n *  center: [51.505, -0.09],\n *  zoom: 13\n * });\n * ```\n *\n */\n\nvar _padding = 1.0;\nexport var Reader = Evented.extend({\n  options: {\n    regions: [\n      'header',\n      'toolbar.top',\n      'toolbar.left',\n      'main',\n      'toolbar.right',\n      'toolbar.bottom',\n      'footer'\n    ],\n    metadata: {},\n    flow: 'auto',\n    engine: 'epubjs',\n    fontSizeLarge: '140%',\n    fontSizeSmall: '90%',\n    fontSizeDefault: '100%',\n    trackResize: true,\n    text_size: 100,\n    mobileMediaQuery: '(min-device-width : 300px) and (max-device-width : 600px)',\n    forceScrolledDocHeight: 1200,\n    theme: 'default',\n    rootfilePath: '',\n    themes: []\n  },\n\n  initialize: function(id, options) {\n    var self = this\n\n    self._original_document_title = document.title;\n\n    if ( localStorage.getItem('cozy.options') ) {\n      options = assign(options, JSON.parse(localStorage.getItem('cozy.options')));\n    }\n    options = Util.setOptions(this, options);\n\n    this._checkFeatureCompatibility();\n\n    this.metadata = this.options.metadata; // initial seed\n\n    this._initContainer(id);\n    this._initLayout();\n\n    if ( this.options.themes && this.options.themes.length > 0 ) {\n        this.options.themes.forEach(function(theme) {\n            if ( theme.href ) { return; }\n            var klass = theme.klass;\n            var rules = {};\n            for(var rule in theme.rules) {\n                var new_rule = '.' + klass;\n                if ( rule == 'body' ) { new_rule = 'body' + new_rule; }\n                else { new_rule += ' ' + rule ; }\n                rules[new_rule] = theme.rules[rule];\n            }\n            theme.rules = rules;\n        });\n    }\n\n    this._updateTheme();\n\n    // hack for https://github.com/Leaflet/Leaflet/issues/1980\n    // this._onResize = Util.bind(this._onResize, this);\n\n    this._initEvents();\n\n    this.callInitHooks();\n\n    this._mode = this.options.mode;\n  },\n\n  start: function(target, cb) {\n    var self = this;\n\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      cb = target;\n      target = undefined;\n    }\n\n    self._start(target, cb);\n\n    // Util.loader.js(this.options.engine_href).then(function() {\n    //   self._start(target, cb);\n    //   self._loaded = true;\n    // })\n  },\n\n  _start: function(target, cb) {\n    var self = this;\n    target = target || 0;\n\n    // self.open(function() {\n    //   self.draw(target, cb);\n    // });\n\n    self.open(target, cb);\n  },\n\n  reopen: function(options, target) {\n    /* NOP */\n  },\n\n  saveOptions: function(options) {\n    var saved_options = {};\n    assign(saved_options, options);\n    if ( saved_options.flow == 'auto' ) {\n      // do not save\n      delete saved_options.flow;\n    }\n    localStorage.setItem('cozy.options', JSON.stringify(saved_options));\n  },\n\n  _updateTheme: function() {\n    DomUtil.removeClass(this._container, 'cozy-theme-' + ( this._container.dataset.theme || 'default' ));\n    DomUtil.addClass(this._container, 'cozy-theme-' + this.options.theme);\n    this._container.dataset.theme = this.options.theme;\n  },\n\n  draw: function(target) {\n    // NOOP\n  },\n\n  next: function() {\n    // NOOP\n  },\n\n  prev: function() {\n    // NOOP\n  },\n\n  display: function(index) {\n    // NOOP\n  },\n\n  gotoPage: function(target) {\n    // NOOP\n  },\n\n  goBack: function() {\n    history.back();\n  },\n\n  goForward: function() {\n    history.forward();\n  },\n\n  requestFullscreen: function() {\n    if ( screenfull.enabled ) {\n      // this._preResize();\n      screenfull.toggle(this._container);\n    }\n  },\n\n  _preResize: function() {\n\n  },\n\n  _initContainer: function (id) {\n    var container = this._container = DomUtil.get(id);\n\n    if (!container) {\n      throw new Error('Reader container not found.');\n    } else if (container._cozy_id) {\n      throw new Error('Reader container is already initialized.');\n    }\n\n    DomEvent.on(container, 'scroll', this._onScroll, this);\n    this._containerId = Util.stamp(container);\n  },\n\n  _initLayout: function () {\n    var container = this._container;\n\n    this._fadeAnimated = this.options.fadeAnimation && Browser.any3d;\n\n    DomUtil.addClass(container, 'cozy-container' +\n      (Browser.touch ? ' cozy-touch' : '') +\n      (Browser.retina ? ' cozy-retina' : '') +\n      (Browser.ielt9 ? ' cozy-oldie' : '') +\n      (Browser.safari ? ' cozy-safari' : '') +\n      (this._fadeAnimated ? ' cozy-fade-anim' : '') +\n      ' cozy-engine-' + this.options.engine +\n      ' cozy-theme-' + this.options.theme);\n\n    var position = DomUtil.getStyle(container, 'position');\n\n    this._initPanes();\n\n    if ( ! Browser.columnCount ) {\n      this.options.flow = 'scrolled-doc';\n    }\n  },\n\n  _initPanes: function () {\n    var self = this;\n\n    var panes = this._panes = {};\n\n    var l = 'cozy-';\n    var container = this._container;\n\n    var prefix = 'cozy-module-';\n\n    DomUtil.addClass(container, 'cozy-container');\n    panes['top'] = DomUtil.create('div', prefix + 'top', container);\n    panes['main'] = DomUtil.create('div', prefix + 'main', container);\n    panes['bottom'] = DomUtil.create('div', prefix + 'bottom', container);\n\n    panes['left'] = DomUtil.create('div', prefix + 'left', panes['main']);\n    panes['book-cover'] = DomUtil.create('div', prefix + 'book-cover', panes['main']);\n    panes['right'] = DomUtil.create('div', prefix + 'right', panes['main']);\n    panes['book'] = DomUtil.create('div', prefix + 'book', panes['book-cover']);\n    panes['loader'] = DomUtil.create('div', prefix + 'book-loading', panes['book']);\n    panes['epub'] = DomUtil.create('div', prefix + 'book-epub', panes['book']);\n    this._initBookLoader();\n  },\n\n  _checkIfLoaded: function () {\n    if (!this._loaded) {\n      throw new Error('Set map center and zoom first.');\n    }\n  },\n\n  // DOM event handling\n\n  // @section Interaction events\n  _initEvents: function (remove) {\n    this._targets = {};\n    this._targets[Util.stamp(this._container)] = this;\n\n    this.tracking = function(reader) {\n      var _action = [];\n      var _last_location_start;\n      var _reader = reader;\n      return {\n        action: function(v) {\n          if ( v ) {\n            _action = [v];\n            this.event(v);\n            // _reader.fire('trackAction', { action: v })\n          } else {\n            return _action.pop();\n          }\n        },\n\n        event: function(action, data) {\n          if ( data == null ) { data = {}; }\n          data.action = action;\n          _reader.fire(\"trackAction\", data);\n        },\n\n        pageview: function(location) {\n          if ( location.start != _last_location_start ) {\n            _last_location_start = location.start;\n            // console.log(\"AHOY RELOCATED\", location, location.start, location.href, location.location, this.action());\n            _reader.fire('trackPageview', { cfi: location.start, href: location.href, action: this.action()})\n            return true;\n          }\n          return false;\n        }\n      }\n    }(this);\n\n    var onOff = remove ? DomEvent.off : DomEvent.on;\n\n    // @event click: MouseEvent\n    // Fired when the user clicks (or taps) the map.\n    // @event dblclick: MouseEvent\n    // Fired when the user double-clicks (or double-taps) the map.\n    // @event mousedown: MouseEvent\n    // Fired when the user pushes the mouse button on the map.\n    // @event mouseup: MouseEvent\n    // Fired when the user releases the mouse button on the map.\n    // @event mouseover: MouseEvent\n    // Fired when the mouse enters the map.\n    // @event mouseout: MouseEvent\n    // Fired when the mouse leaves the map.\n    // @event mousemove: MouseEvent\n    // Fired while the mouse moves over the map.\n    // @event contextmenu: MouseEvent\n    // Fired when the user pushes the right mouse button on the map, prevents\n    // default browser context menu from showing if there are listeners on\n    // this event. Also fired on mobile when the user holds a single touch\n    // for a second (also called long press).\n    // @event keypress: KeyboardEvent\n    // Fired when the user presses a key from the keyboard while the map is focused.\n    // onOff(this._container, 'click dblclick mousedown mouseup ' +\n    //   'mouseover mouseout mousemove contextmenu keypress', this._handleDOMEvent, this);\n\n    // if (this.options.trackResize) {\n    //   var self = this;\n    //   var fn = debounce(function(){ self.invalidateSize({}); }, 150);\n    //   onOff(window, 'resize', fn, this);\n    // }\n\n    if (Browser.any3d && this.options.transform3DLimit) {\n      (remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);\n    }\n\n    var self = this;\n    if (screenfull.enabled) {\n      screenfull.on('change', function() {\n        // setTimeout(function() {\n        //   self.invalidateSize({});\n        // }, 100);\n        console.log('AHOY: Am I fullscreen?', screenfull.isFullscreen ? 'YES' : 'NO');\n      });\n    }\n\n    self.on(\"updateLocation\", function(location) {\n      var location_href = location.start;\n\n      if ( self._ignoreHistory ) {\n        self._ignoreHistory = false;\n        return;\n      }\n\n      if ( self.tracking.pageview(location) ) {\n        var tmp_href = window.location.href.split(\"#\");\n        tmp_href[1] = location.start.substr(8, location.start.length - 8 - 1);\n        history.pushState({ cfi: location.start }, '', tmp_href.join('#'));\n\n        if ( location.percentage ) {\n          var p = Math.ceil(location.percentage * 100);\n          document.title = `${self._original_document_title} - ${p}%`;\n        }        \n      }\n    })\n\n    window.addEventListener('popstate', function(event) {\n      if ( event.isTrusted && event.state !== null ) {\n        self._ignoreHistory = true;\n        self.gotoPage(event.state.cfi);\n      }\n    })\n\n    document.addEventListener('keydown', function(event) {\n      var keyName = event.key;\n      var target = event.target;\n\n      // check if the activeElement is \".special-panel\"\n      var check = document.activeElement;\n      while ( check.localName != 'body' ) {\n        if ( check.classList.contains('special-panel') ) {\n          return;\n        }\n        check = check.parentElement;\n      }\n\n      var IGNORE_TARGETS = [ 'input', 'target' ];\n      if ( IGNORE_TARGETS.indexOf(target.localName) >= 0 ) {\n        return;\n      }\n\n      self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey });\n    });\n\n    self.on('keyDown', function(data) {\n      switch(data.keyName) {\n        case 'ArrowRight':\n        case 'PageDown':\n          self.next();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          self.prev();\n          break;\n        case 'Home':\n          self._scroll('HOME');\n          break;\n        case 'End':\n          self._scroll('END')\n          break;\n      }\n    });\n  },\n\n  // _onResize: function() {\n  //   if ( ! this._resizeRequest ) {\n  //     this._resizeRequest = Util.requestAnimFrame(function() {\n  //       this.invalidateSize({})\n  //     }, this);\n  //   }\n  // },\n\n  _onScroll: function () {\n    this._container.scrollTop  = 0;\n    this._container.scrollLeft = 0;\n  },\n\n  _handleDOMEvent: function (e) {\n    if (!this._loaded || DomEvent.skipped(e)) { return; }\n\n    var type = e.type === 'keypress' && e.keyCode === 13 ? 'click' : e.type;\n\n    if (type === 'mousedown') {\n      // prevents outline when clicking on keyboard-focusable element\n      DomUtil.preventOutline(e.target || e.srcElement);\n    }\n\n    this._fireDOMEvent(e, type);\n  },\n\n  _fireDOMEvent: function (e, type, targets) {\n\n    if (e.type === 'click') {\n      // Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).\n      // @event preclick: MouseEvent\n      // Fired before mouse click on the map (sometimes useful when you\n      // want something to happen on click before any existing click\n      // handlers start running).\n      var synth = Util.extend({}, e);\n      synth.type = 'preclick';\n      this._fireDOMEvent(synth, synth.type, targets);\n    }\n\n    if (e._stopped) { return; }\n\n    // Find the layer the event is propagating from and its parents.\n    targets = (targets || []).concat(this._findEventTargets(e, type));\n\n    if (!targets.length) { return; }\n\n    var target = targets[0];\n    if (type === 'contextmenu' && target.listens(type, true)) {\n      DomEvent.preventDefault(e);\n    }\n\n    var data = {\n      originalEvent: e\n    };\n\n    if (e.type !== 'keypress') {\n      var isMarker = (target.options && 'icon' in target.options);\n      data.containerPoint = isMarker ?\n          this.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\n      data.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\n      data.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);\n    }\n\n    for (var i = 0; i < targets.length; i++) {\n      targets[i].fire(type, data, true);\n      if (data.originalEvent._stopped ||\n        (targets[i].options.nonBubblingEvents && Util.indexOf(targets[i].options.nonBubblingEvents, type) !== -1)) { return; }\n    }\n  },\n\n  getFixedBookPanelSize: function() {\n    // have to make the book\n    var style = window.getComputedStyle(this._panes['book']);\n    var h = this._panes['book'].clientHeight - parseFloat(style.paddingTop) - parseFloat(style.paddingBottom);\n    var w = this._panes['book'].clientWidth - parseFloat(style.paddingRight) - parseFloat(style.paddingLeft);\n    return { height: Math.floor(h * 1.00), width: Math.floor(w * 1.00) };\n  },\n\n  invalidateSize: function(options) {\n    // TODO: IS THIS EVER USED?\n    var self = this;\n\n    if ( ! self._drawn ) { return; }\n\n    Util.cancelAnimFrame(this._resizeRequest);\n\n    if (! this._loaded) { return this; }\n\n    this.fire('resized');\n  },\n\n  _resizeBookPane: function() {\n\n  },\n\n  _setupHooks: function() {\n\n  },\n\n  _checkFeatureCompatibility: function() {\n    if ( ! DomUtil.isPropertySupported('columnCount') || this._checkMobileDevice() ) {\n      // force\n      this.options.flow = 'scrolled-doc';\n    }\n    if ( this._checkMobileDevice() ) {\n      // this.options.fontSizeLarge = '160%';\n      // this.options.fontSizeSmall ='100%';\n      // this.options.fontSizeDefault = '120%';\n      this.options.text_size = 120;\n    }\n  },\n\n  _checkMobileDevice: function() {\n    if ( this._isMobile === undefined ) {\n      this._isMobile = false;\n      if ( this.options.mobileMediaQuery ) {\n        this._isMobile = window.matchMedia(this.options.mobileMediaQuery).matches;\n      }\n    }\n    return this._isMobile;\n  },\n\n  _enableBookLoader: function(delay=0) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( delay < 0 ) {\n      delay = 0;\n      self._force_progress = true;\n    }\n    self._loader_timeout = setTimeout(function() {\n      self._panes['loader'].style.display = 'block';\n    }, delay);\n  },\n\n  _disableBookLoader: function(force=false) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( ! self._force_progress || force ) {\n      self._panes['loader'].style.display = 'none';\n      self._force_progress = false;\n      self._panes['loader-status'].innerHTML = '';\n    }\n  },\n\n  _clearBookLoaderTimeout: function() {\n    var self = this;\n    if ( self._loader_timeout ) {\n      clearTimeout(self._loader_timeout);\n      self._loader_timeout = null;\n    }\n  },\n\n  _initBookLoader: function() {\n    // is this not awesome?\n    var template = this.options.loader_template || this.loaderTemplate();\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      this._panes['loader'].appendChild(body.children[0]);\n    }\n    this._panes['loader-status'] = DomUtil.create('div', 'cozy-module-book-loading-status', this._panes['loader']);\n  },\n\n  loaderTemplate: function() {\n    return `<div class=\"cozy-loader-spinner\">\n    <div class=\"spinner-backdrop spinner-backdrop--1\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--2\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--3\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--4\"></div>\n    <div class=\"spinner-quarter spinner-quarter--1\"></div>\n    <div class=\"spinner-quarter spinner-quarter--2\"></div>\n    <div class=\"spinner-quarter spinner-quarter--3\"></div>\n    <div class=\"spinner-quarter spinner-quarter--4\"></div>\n  </div>`;\n  },\n\n  EOT: true\n});\n\nexport function createReader(id, options) {\n  return new Reader(id, options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\n\n/*\n * @class Control\n * @aka L.Control\n * @inherits Class\n *\n * L.Control is a base class for implementing reader controls. Handles regioning.\n * All other controls extend from this class.\n */\n\nexport var Control = Class.extend({\n    // @section\n    // @aka Control options\n    options: {\n        // @option region: String = 'topright'\n        // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n        // `'topright'`, `'bottomleft'` or `'bottomright'`\n    },\n\n    initialize: function (options) {\n        Util.setOptions(this, options);\n        if ( options.container ) {\n            this._container = options.container;\n            this._locked = true;\n        }\n        this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    },\n\n    /* @section\n     * Classes extending L.Control will inherit the following methods:\n     *\n     * @method getRegion: string\n     * Returns the region of the control.\n     */\n    getRegion: function () {\n        return this.options.region;\n    },\n\n    // @method setRegion(region: string): this\n    // Sets the region of the control.\n    setRegion: function (region) {\n        var reader = this._reader;\n\n        if (reader) {\n            reader.removeControl(this);\n        }\n\n        this.options.region = region;\n\n        if (reader) {\n            reader.addControl(this);\n        }\n\n        return this;\n    },\n\n    // @method getContainer: HTMLElement\n    // Returns the HTMLElement that contains the control.\n    getContainer: function () {\n        return this._container;\n    },\n\n    // @method addTo(reader: Map): this\n    // Adds the control to the given reader.\n    addTo: function (reader) {\n        this.remove();\n        this._reader = reader;\n\n        var container = this._container = this.onAdd(reader);\n\n        DomUtil.addClass(container, 'cozy-control');\n\n        if ( ! this._locked ) {\n            var region = this.getRegion();\n            var area = reader.getControlRegion(region);\n            area.appendChild(container);\n        }\n\n        return this;\n    },\n\n    // @method remove: this\n    // Removes the control from the reader it is currently active on.\n    remove: function () {\n        if (!this._reader) {\n            return this;\n        }\n\n        if (! this._container) {\n            return this;\n        }\n\n        if ( ! this._locked ) {\n            DomUtil.remove(this._container);\n        }\n\n        if (this.onRemove) {\n            this.onRemove(this._reader);\n        }\n\n        this._reader = null;\n\n        return this;\n    },\n\n    _refocusOnMap: function (e) {\n        // if reader exists and event is not a keyboard event\n        if (this._reader && e && e.screenX > 0 && e.screenY > 0) {\n            this._reader.getContainer().focus();\n        }\n    },\n\n    _className: function(widget) {\n        var className = [ 'cozy-control' ];\n        if ( this.options.direction ) {\n            className.push('cozy-control-' + this.options.direction);\n        }\n        if ( widget ) {\n            className.push('cozy-control-' + widget);\n        }\n        return className.join(' ');\n    }\n});\n\nexport var control = function (options) {\n    return new Control(options);\n};\n\n/* @section Extension methods\n * @uninheritable\n *\n * Every control should extend from `L.Control` and (re-)implement the following methods.\n *\n * @method onAdd(reader: Map): HTMLElement\n * Should return the container DOM element for the control and add listeners on relevant reader events. Called on [`control.addTo(reader)`](#control-addTo).\n *\n * @method onRemove(reader: Map)\n * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).\n */\n\n/* @namespace Map\n * @section Methods for Layers and Controls\n */\nReader.include({\n    // @method addControl(control: Control): this\n    // Adds the given control to the reader\n    addControl: function (control) {\n        control.addTo(this);\n        return this;\n    },\n\n    // @method removeControl(control: Control): this\n    // Removes the given control from the reader\n    removeControl: function (control) {\n        control.remove();\n        return this;\n    },\n\n    getControlContainer: function() {\n        var l = 'cozy-';\n        if ( ! this._controlContainer ) {\n            this._controlContainer =\n                DomUtil.create('div', l + 'control-container', this._container);\n        }\n        return this._controlContainer;\n    },\n\n    getControlRegion: function (target) {\n\n        if ( ! this._panes[target] ) {\n            // target is dot-delimited string\n            // first dot is the panel\n            var parts = target.split('.');\n            var tmp = [];\n            var parent = this._container;\n            var x = 0;\n            while ( parts.length ) {\n                var slug = parts.shift();\n                tmp.push(slug);\n                var panel = tmp.join(\".\");\n                var className = 'cozy-panel-' + slug;\n                if ( ! this._panes[panel] ) {\n                    this._panes[panel] = DomUtil.create('div', className, parent);\n                }\n                parent = this._panes[panel];\n                x += 1;\n                if ( x > 100 ) { break; }\n            }\n        }\n        return this._panes[target];\n    },\n\n    getControlRegion_1: function (target) {\n\n        var tmp = target.split('.');\n        var region = tmp.shift();\n        var slot = tmp.pop() || '-slot';\n\n        var container = this._panes[region];\n        if ( ! this._panes[target] ) {\n            var className = 'cozy-' + region + '--item cozy-slot-' + slot\n            if ( ! this._panes[region + '.' + slot] ) {\n                var div = DomUtil.create('div', className);\n                if ( slot == 'left' || slot == 'bottom' ) {\n                    var childElement = this._panes[region].firstChild;\n                    this._panes[region].insertBefore(div, childElement);\n                } else {\n                    this._panes[region].appendChild(div);\n                }\n                this._panes[region + '.' + slot] = div;\n            }\n            className = this._classify(tmp);\n            this._panes[target] = DomUtil.create('div', className, this._panes[region + '.' + slot]);\n        }\n\n        return this._panes[target];\n    },\n\n    _classify: function(tmp) {\n        var l = 'cozy-';\n        var className = [];\n        for(var i in tmp) {\n            className.push(l + tmp[i]);\n        }\n        className = className.join(' ');\n        return className;\n    },\n\n    _clearControlRegion: function () {\n        for (var i in this._controlRegions) {\n            DomUtil.remove(this._controlRegions[i]);\n        }\n        DomUtil.remove(this._controlContainer);\n        delete this._controlRegions;\n        delete this._controlContainer;\n    }\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nvar PageControl = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n      container = DomUtil.create('div', className),\n\n      this._control  = this._createButton(this._fill(options.html || options.label), this._fill(options.label),\n              className, container);\n    }\n    this._bindEvents();\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    return link;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    DomEvent.disableClickPropagation(this._control);\n    DomEvent.on(this._control, 'click', DomEvent.stop);\n    DomEvent.on(this._control, 'click', this._action, this);\n\n    this._reader.on('reopen', function(data) {\n      // update the button text / titles\n      var html = self.options.html || self.options.label;\n      self._control.innerHTML = self._fill(html);\n      self._control.setAttribute('title', self._fill(self.options.label));\n      self._control.setAttribute('aria-label', self._fill(self.options.label));\n    });\n\n  },\n\n  _unit: function() {\n    return ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  _fill: function(s) {\n    var unit = this._unit();\n    return s.replace(/\\$\\{unit\\}/g, unit);\n  },\n\n  _label: function() {\n    return this.options.label + \" \" + ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  EOT: true\n});\n\nexport var PagePrevious = PageControl.extend({\n  options: {\n    region: 'edge.left',\n    direction: 'previous',\n    label: 'Previous ${unit}',\n    html: '<i class=\"icon-chevron-left oi\" data-glyph=\"chevron-left\" title=\"Previous ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.prev();\n  }\n});\n\nexport var PageNext = PageControl.extend({\n  options: {\n    region: 'edge.right',\n    direction: 'next',\n    label: 'Next ${unit}',\n    html: '<i class=\"icon-chevron-right oi\" data-glyph=\"chevron-right\" title=\"Next ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.next();\n  }\n});\n\nexport var PageFirst = PageControl.extend({\n  options: {\n    direction: 'first',\n    label: 'First ${unit}'\n  },\n  _action: function(e) {\n      this._reader.first();\n  }\n});\n\nexport var PageLast = PageControl.extend({\n  options: {\n    direction: 'last',\n    label: 'Last ${unit}'\n  },\n  _action: function(e) {\n      this._reader.last();\n  }\n});\n\nexport var pageNext = function(options) {\n  return new PageNext(options);\n}\n\nexport var pagePrevious = function(options) {\n  return new PagePrevious(options);\n}\n\nexport var pageFirst = function(options) {\n  return new PageFirst(options);\n}\n\nexport var pageLast = function(options) {\n  return new PageLast(options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nimport assign from 'lodash/assign';\n\nvar activeModal;\nvar dismissModalListener = false;\n\n// from https://github.com/ghosh/micromodal/blob/master/src/index.js\nconst FOCUSABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'iframe',\n    'object',\n    'embed',\n    '[contenteditable]',\n    '[tabindex]:not([tabindex^=\"-\"])'\n  ];\n\nconst ACTIONABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input[type=\"submit\"]:not([disabled])',\n    'button:not([disabled])'\n  ];\n\nexport var Modal = Class.extend({\n  options: {\n    // @option region: String = 'topright'\n    // The region of the control (one of the reader edges). Possible values are `'left' ad 'right'`\n    region: 'left',\n    fraction: 0,\n    width: null,\n    className: {},\n    actions: null,\n    callbacks: { onShow: function() {}, onClose: function() {} },\n    handlers: {}\n  },\n\n  initialize: function (options) {\n    options = Util.setOptions(this, options);\n    this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    this._initializedEvents = false;\n    this.callbacks = assign({}, this.options.callbacks);\n    this.actions = this.options.actions ? assign({}, this.options.actions) : null;\n    this.handlers = assign({}, this.options.handlers);\n    if ( typeof(this.options.className) == 'string' ) {\n      this.options.className = { container: this.options.className };\n    }\n  },\n\n  addTo: function(reader) {\n    var self = this;\n    this._reader = reader;\n    var template = this.options.template;\n\n    var panelHTML = `<div class=\"cozy-modal modal-slide ${this.options.region || 'left'}\" id=\"modal-${this._id}\" aria-labelledby=\"modal-${this._id}-title\" role=\"dialog\" aria-describedby=\"modal-${this._id}-content\" aria-hidden=\"true\">\n      <div class=\"modal__overlay\" tabindex=\"-1\" data-modal-close>\n        <div class=\"modal__container ${this.options.className.container ? this.options.className.container : ''}\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-${this._id}-title\" aria-describedby=\"modal-${this._id}-content\" id=\"modal-${this._id}-container\">\n          <div role=\"document\">\n            <header class=\"modal__header\">\n              <h3 class=\"modal__title\" id=\"modal-${this._id}-title\">${this.options.title}</h3>\n              <button class=\"modal__close\" aria-label=\"Close modal\" aria-controls=\"modal-${this._id}-container\" data-modal-close></button>\n            </header>\n            <main class=\"modal__content ${this.options.className.main ? this.options.className.main : ''}\" id=\"modal-${this._id}-content\">\n              ${template}\n            </main>`;\n\n    if ( this.options.actions ) {\n      panelHTML += '<footer class=\"modal__footer\">'\n      for(var i in this.options.actions) {\n        var action = this.options.actions[i];\n        var button_cls = action.className || 'button--default';\n        panelHTML += `<button id=\"action-${this._id}-${i}\" class=\"button button--lg ${button_cls}\">${action.label}</button>`;\n      }\n      panelHTML += '</footer>';\n    }\n\n    panelHTML += '</div></div></div></div>';\n\n    var body = new DOMParser().parseFromString(panelHTML, \"text/html\").body;\n\n    this.modal = reader._container.appendChild(body.children[0]);\n    this._container = this.modal; // compatibility\n\n    this.container = this.modal.querySelector('.modal__container');\n    this._bindEvents();\n    return this;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    this.onClick = this.onClick.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n    this.onModalTransition = this.onModalTransition.bind(this);\n\n    this.modal.addEventListener('transitionend', function() {\n    }.bind(this));\n\n    // bind any actions\n    if ( this.actions ) {\n      for(var i in this.actions) {\n        let action = this.actions[i];\n        let button_id = '#action-' + this._id + '-' + i;\n        let button = this.modal.querySelector(button_id);\n        if ( button ) {\n          DomEvent.on(button, 'click', function(event) {\n            event.preventDefault();\n            action.callback(event);\n            if ( action.close ) {\n              self.closeModal();\n            }\n          })\n        }\n      }\n    }\n  },\n\n  deactivate: function() {\n    this.closeModal();\n  },\n\n  closeModal: function() {\n    var self = this;\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.removeEventListeners();\n    if ( this.activeElement ) {\n      this.activeElement.focus();\n    }\n    this.callbacks.onClose(this.modal);\n  },\n\n  showModal: function() {\n    this.activeElement = document.activeElement\n    this._resize();\n    this.modal.setAttribute('aria-hidden', 'false')\n    this.setFocusToFirstNode()\n    this.addEventListeners()\n    this.callbacks.onShow(this.modal)\n  },\n\n  activate: function() {\n    return this.showModal();\n    var self = this;\n    activeModal = this;\n    DomUtil.addClass(self._reader._container, 'st-modal-activating');\n    this._resize();\n    DomUtil.addClass(this._reader._container, 'st-modal-open');\n    setTimeout(function() {\n      DomUtil.addClass(self._container, 'active');\n      DomUtil.removeClass(self._reader._container, 'st-modal-activating');\n      self._container.setAttribute('aria-hidden', 'false');\n      self.setFocusToFirstNode();\n    }, 25);\n  },\n\n  addEventListeners: function () {\n    // --- do we need touch listeners?\n    // this.modal.addEventListener('touchstart', this.onClick)\n    // this.modal.addEventListener('touchend', this.onClick)\n    this.modal.addEventListener('click', this.onClick)\n    document.addEventListener('keydown', this.onKeydown)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.addEventListener(event, this.onModalTransition);\n    }.bind(this))\n  },\n\n  removeEventListeners: function () {\n    this.modal.removeEventListener('touchstart', this.onClick)\n    this.modal.removeEventListener('click', this.onClick)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.removeEventListener(event, this.onModalTransition);\n    }.bind(this))\n    document.removeEventListener('keydown', this.onKeydown)\n  },\n\n  _resize: function() {\n    var container = this._reader._container;\n    this.container.style.height = container.offsetHeight + 'px';\n    // console.log(\"AHOY MODAL\", this.container.style.height);\n    if ( ! this.options.className.container  ) {\n      this.container.style.width = this.options.width || parseInt(container.offsetWidth * this.options.fraction) + 'px';\n    }\n\n    var header = this.container.querySelector('header');\n    var footer = this.container.querySelector('footer');\n    var main = this.container.querySelector('main');\n    var height = this.container.clientHeight - header.clientHeight;\n    if ( footer ) {\n      height -= footer.clientHeight;\n    }\n    main.style.height = height + 'px';\n  },\n\n  getFocusableNodes: function() {\n    const nodes = this.modal.querySelectorAll(FOCUSABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  setFocusToFirstNode: function() {\n    var focusableNodes = this.getFocusableNodes();\n    if ( focusableNodes.length ) {\n      focusableNodes[0].focus();\n    } else {\n      activeModal._container.focus();\n    }\n  },\n\n  getActionableNodes: function() {\n    const nodes = this.modal.querySelectorAll(ACTIONABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  onKeydown: function(event) {\n    if ( event.keyCode == 27 ) { this.closeModal(); }\n    if ( event.keyCode == 9 ) {\n      this.maintainFocus(event);\n    }\n  },\n\n  onClick: function(event) {\n\n    var closeAfterAction = false;\n    var target = event.target;\n\n    // As far as I can tell, the code below isn't catching direct clicks on\n    // items with class='data-modal-close' as they're not ACTIONABLE_ELEMENTS.\n    // Adding them to ACTIONABLE_ELEMENTS causes undesirable behavior where\n    // their child items also close the modal thanks to the loop below.\n    // Children of .modal__overlay include the modal header, border area and\n    // padding. We don't want clicks on these closing the modal.\n    // Just close the modal now for direct clicks on a '.data-modal-close'.\n    if (target.hasAttribute('data-modal-close')) {\n      this.fire('closed');\n      this.closeModal();\n      return;\n    }\n\n    // if the target isn't an actionable type, walk the DOM until\n    // one is found\n    var actionableNodes = this.getActionableNodes();\n    while ( actionableNodes.indexOf(target) < 0 && target != this.modal ) {\n      target = target.parentElement;\n    }\n\n    // no target found, punt\n    if ( actionableNodes.indexOf(target) < 0 ) {\n      return;\n    }\n\n    if (this.handlers.click) {\n      var did_match = false;\n      for(var selector in this.handlers.click) {\n        if ( target.matches(selector) ) {\n          closeAfterAction = this.handlers.click[selector](this, target);\n          break;\n        }\n      }\n    }\n\n    if (closeAfterAction || target.hasAttribute('data-modal-close')) this.closeModal();\n\n    event.preventDefault();\n  },\n\n  onModalTransition: function(event) {\n    if ( this.modal.getAttribute('aria-hidden') == 'true' ) {\n      this._reader.fire('modal-closed');\n    } else {\n      this._reader.fire('modal-opened');\n    }\n  },\n\n  on: function(event, selector, handler) {\n    if (! this.handlers[event] ) {\n      this.handlers[event] = {};\n    }\n    if (typeof(selector) == 'function') {\n      handler = selector;\n      selector = '*';\n    }\n    this.handlers[event][selector] = handler;\n  },\n\n  fire: function(event) {\n    if ( this.handlers[event] && this.handlers[event]['*'] ) {\n      this.handlers[event]['*'](this);\n    }\n  },\n\n  maintainFocus: function(event) {\n    var focusableNodes = this.getFocusableNodes();\n    var focusedItemIndex = focusableNodes.indexOf(document.activeElement);\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableNodes[focusableNodes.length - 1].focus()\n      event.preventDefault()\n    }\n\n    if (!event.shiftKey && focusedItemIndex === focusableNodes.length - 1) {\n      focusableNodes[0].focus()\n      event.preventDefault()\n    }\n  },\n\n  EOT: true\n});\n\nReader.include({\n  modal: function (options) {\n    var modal = new Modal(options);\n    return modal.addTo(this);\n    // return this;\n  },\n\n  EOT: true\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport {Modal} from './Modal';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Contents = Control.extend({\n\n  defaultTemplate: `<button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Table of Contents\"><i class=\"icon-menu oi\" data-glyph=\"menu\" title=\"Table of Contents\" aria-hidden=\"true\"></i></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    this._control.setAttribute('id', 'action-' + this._id);\n    container.style.position = 'relative';\n\n    this._reader.on('updateContents', function(data) {\n\n      DomEvent.on(this._control, 'click', function(event) {\n        event.preventDefault();\n        self._reader.tracking.action('contents/open');\n        self._modal.activate();\n      }, this)\n\n      this._modal = this._reader.modal({\n        template: '<ul></ul>',\n        title: 'Contents',\n        region: 'left',\n        className: 'cozy-modal-contents'\n      });\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('data-href');\n        this._reader.tracking.action('contents/go');\n        this._reader.gotoPage(target);\n        return true;\n      }.bind(this))\n\n      this._modal.on('closed', function() {\n        self._reader.tracking.action('contents/close');\n      })\n\n      this._setupSkipLink();\n\n      var parent = self._modal._container.querySelector('ul');\n      // var s = data.toc.filter(function(value) { return value.parent == null }).map(function(value) { return [ value, 0, parent ] });\n      // while ( s.length ) {\n      //   var tuple = s.shift();\n      //   var chapter = tuple[0];\n      //   var tabindex = tuple[1];\n      //   var parent = tuple[2];\n\n      //   var option = self._createOption(chapter, tabindex, parent);\n      //   data.toc.filter(function(value) { return value.parent == chapter.id }).reverse().forEach(function(chapter_) {\n      //     s.unshift([chapter_, tabindex + 1, option]);\n      //   });\n      // }\n      var _process = function(items, tabindex, parent) {\n        items.forEach(function(item) {\n          var option = self._createOption(item, tabindex, parent);\n          if ( item.subitems && item.subitems.length ) {\n            _process(item.subitems, tabindex + 1, option);\n          }\n        })\n      }\n      _process(data.toc, 0, parent);\n    }.bind(this))\n\n    return container;\n  },\n\n  _createOption(chapter, tabindex, parent) {\n\n    function pad(value, length) {\n        return (value.toString().length < length) ? pad(\"-\"+value, length):value;\n    }\n    var option = DomUtil.create('li');\n    if ( chapter.href ) {\n      var anchor = DomUtil.create('a', null, option);\n      if ( chapter.html ) {\n        anchor.innerHTML = chapter.html;\n      } else {\n        anchor.textContent = chapter.label;\n      }\n      // var tab = pad('', tabindex); tab = tab.length ? tab + ' ' : '';\n      // option.textContent = tab + chapter.label;\n      anchor.setAttribute('href', chapter.href);\n      anchor.setAttribute('data-href', chapter.href);\n    } else {\n      var span = DomUtil.create('span', null, option);\n      span.textContent = chapter.label;\n    }\n\n    if ( parent.tagName == 'LI' ) {\n      // need to nest\n      var tmp = parent.querySelector('ul');\n      if ( ! tmp ) {\n        tmp = DomUtil.create('ul', null, parent);\n      }\n      parent = tmp;\n    }\n\n    parent.appendChild(option);\n    return option;\n  },\n\n  _setupSkipLink: function() {\n    if ( ! this.options.skipLink ) { return; }\n      \n    var target = document.querySelector(this.options.skipLink);\n    if ( ! target ) { return; }\n\n    var link = document.createElement('a');\n    link.textContent = 'Skip to contents';\n    link.setAttribute('href', '#action-' + this._id);\n\n    var ul = target.querySelector('ul');\n    if ( ul ) {\n      // add to list\n      target = document.createElement('li');\n      ul.appendChild(target);\n    }\n    target.appendChild(link);\n    link.addEventListener('click', function(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      this._control.click();\n    }.bind(this))\n\n  },\n\n  EOT: true\n});\n\nexport var contents = function(options) {\n  return new Contents(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var Title = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    var h1 = DomUtil.create('h1', 'cozy-h1', container);\n    DomUtil.setOpacity(h1, 0);\n    this._title = DomUtil.create('span', 'cozy-title', h1);\n    this._divider = DomUtil.create('span', 'cozy-divider', h1);\n    this._divider.textContent = \" · \";\n    this._section = DomUtil.create('span', 'cozy-section', h1);\n\n    // --- TODO: disable until we can work out how to \n    // --- more reliably match the current section to the contents\n    // this._reader.on('updateSection', function(data) {\n    //   if ( data && data.label ) {\n    //     self._section.textContent = data.label;\n    //     DomUtil.setOpacity(self._section, 1.0);\n    //     DomUtil.setOpacity(self._divider, 1.0);\n    //   } else {\n    //     DomUtil.setOpacity(self._section, 0);\n    //     DomUtil.setOpacity(self._divider, 0);\n    //   }\n    // })\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._title.textContent = data.title || data.bookTitle;\n        DomUtil.setOpacity(self._section, 0);\n        DomUtil.setOpacity(self._divider, 0);\n        DomUtil.setOpacity(h1, 1);\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var title = function(options) {\n  return new Title(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var PublicationMetadata = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    this._publisher = DomUtil.create('div', 'cozy-publisher', container);\n    this._rights = DomUtil.create('div', 'cozy-rights', container);\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._publisher.textContent = data.publisher;\n        self._rights.textContent = data.rights;\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var publicationMetadata = function(options) {\n  return new PublicationMetadata(options);\n}\n","import {Class} from '../core/Class';\nimport {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as Util from '../core/Util';\n\nimport assign from 'lodash/assign';\nimport keys from 'lodash/keys';\n\nexport var Preferences = Control.extend({\n  options: {\n    label: 'Preferences',\n    hasThemes: false,\n    html: '<i class=\"icon-cog oi\" data-glyph=\"cog\" title=\"Preferences and Settings\" aria-hidden=\"true\"></i>'\n  },\n\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className('preferences'),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    this._activated = false;\n    this._control = this._createButton(options.html || options.label, options.label,\n            className, container, this._action)\n\n    // self.initializeForm();\n    this._modal = this._reader.modal({\n      // template: '<form></form>',\n      title: 'Preferences',\n      className: 'cozy-modal-preferences',\n      actions: [\n        {\n          label: 'Save Changes',\n          callback: function(event) {\n            self.updatePreferences(event);\n          }\n        }\n      ],\n      region: 'right'\n    });\n\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self.initializeForm();\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n    if ( this._modal._container.querySelector('form') ) { return; }\n\n    var template = '';\n\n    var possible_fieldsets = [];\n    if ( this._reader.metadata.layout == 'pre-paginated' ) {\n      // different panel\n      possible_fieldsets.push('Scale');\n    } else {\n      possible_fieldsets.push('TextSize');\n    }\n    possible_fieldsets.push('Display');\n\n    if ( this._reader.rootfiles && this._reader.rootfiles.length > 1 ) {\n      // this.options.hasPackagePaths = true;\n      possible_fieldsets.push('Rendition');\n    }\n\n    if ( this._reader.options.themes && this._reader.options.themes.length > 0 ) {\n      this.options.hasThemes = true;\n      possible_fieldsets.push('Theme');\n    }\n\n    this._fieldsets = [];\n    possible_fieldsets.forEach(function(cls) {\n      var fieldset = new Preferences.fieldset[cls](this);\n      template += fieldset.template();\n      this._fieldsets.push(fieldset);\n    }.bind(this))\n\n    if ( this.options.fields ) {\n      this.options.hasFields = true;\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        template += `<fieldset class=\"custom-field\">\n          <legend>${field.label}</legend>\n        `;\n        for(var j in field.inputs) {\n          var input = field.inputs[j];\n          var checked = input.value == field.value ? ' checked=\"checked\"' : '';\n          template += `<label><input id=\"preferences-custom-${i}-${j}\" type=\"radio\" name=\"x${field.name}\" value=\"${input.value}\" ${checked}/>${input.label}</label>`;\n        }\n        if ( field.hint ) {\n          template += `<p class=\"hint\" style=\"font-size: 90%\">${field.hint}</p>`;\n        }\n      }\n    }\n\n    template = '<form>' + template + '</form>';\n\n    // this._modal = this._reader.modal({\n    //   template: template,\n    //   title: 'Preferences',\n    //   className: 'cozy-modal-preferences',\n    //   actions: [\n    //     {\n    //       label: 'Save Changes',\n    //       callback: function(event) {\n    //         self.updatePreferences(event);\n    //       }\n    //     }\n    //   ],\n    //   region: 'right'\n    // });\n\n    this._modal._container.querySelector('main').innerHTML = template;\n    this._form = this._modal._container.querySelector('form');\n  },\n\n  initializeForm: function() {\n    this._createPanel();\n    this._fieldsets.forEach(function(fieldset) {\n      fieldset.initializeForm(this._form);\n    }.bind(this));\n  },\n\n  updatePreferences: function(event) {\n    event.preventDefault();\n\n    var doUpdate = false;\n    var new_options = {};\n    var saveable_options = {};\n    this._fieldsets.forEach(function(fieldset) {\n      // doUpdate = doUpdate || fieldset.updateForm(this._form, new_options);\n      // assign(new_options, fieldset.updateForm(this._form));\n      fieldset.updateForm(this._form, new_options, saveable_options);\n    }.bind(this));\n\n    if ( this.options.hasFields ) {\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        var input = this._form.querySelector(`input[name=\"x${field.name}\"]:checked`);\n        if ( input.value != field.value ) {\n          field.value = input.value;\n          field.callback(field.value);\n        }\n      }\n    }\n\n    this._modal.deactivate();\n\n    setTimeout(function() {\n      this._reader.saveOptions(saveable_options);\n      this._reader.reopen(new_options);\n    }.bind(this), 100);\n  },\n\n  EOT: true\n});\n\nPreferences.fieldset = {};\n\nvar Fieldset = Class.extend({\n\n  options: {},\n\n  initialize: function (control, options) {\n      Util.setOptions(this, options);\n      this._control = control;\n      this._current = {};\n      this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n  },\n\n  template: function() {\n\n  },\n\n  EOT: true\n\n\n});\n\nPreferences.fieldset.TextSize = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var text_size = this._control._reader.options.text_size || 100;\n    if ( text_size == 'auto' ) { text_size = 100; }\n    this._current.text_size = text_size;\n    this._input.value = text_size;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.text_size = saveable.text_size = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Text Size</legend>\n        <div class=\"preview--text_size\" id=\"x${this._id}-preview\">\n          ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span>T-</span>\n          <input name=\"text_size\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span>T+</span>\n        </p>\n        <p>\n          <span>Text Size: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.fontSize = `${( parseInt(this._input.value, 10) / 100 )}em`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Display = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var flow = this._control._reader.options.flow || this._control._reader.metadata.flow || 'auto';\n    // if ( flow == 'auto' ) { flow = 'paginated'; }\n\n    var input = form.querySelector(`#x${this._id}-input-${flow}`);\n    input.checked = true;\n    this._current.flow = flow;\n\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-flow\"]:checked`);\n    options.flow = input.value;\n    if ( options.flow != 'auto' ) {\n      saveable.flow = options.flow;\n    }\n    // if ( input.value == 'auto' ) {\n    //   // we do NOT want to save flow as a preference\n    //   return {};\n    // }\n    // return { flow: input.value };\n  },\n\n  template: function() {\n    var scrolled_help = '';\n    if ( this._control._reader.metadata.layout != 'pre-paginated' ) {\n      scrolled_help = \"<br /><small>This is an experimental feature that may cause display and loading issues for the book when enabled.</small>\";\n    }\n    return `<fieldset>\n            <legend>Display</legend>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-auto\" value=\"auto\" /> Auto<br /><small>Let the reader determine display mode based on your browser dimensions and the type of content you're reading</small></label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-paginated\" value=\"paginated\" /> Page-by-Page</label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-scrolled-doc\" value=\"scrolled-doc\" /> Scroll${scrolled_help}</label>\n          </fieldset>`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Theme = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var theme = this._control._reader.options.theme || 'default';\n\n    var input = form.querySelector(`#x${this._id}-input-theme-${theme}`);\n    input.checked = true;\n    this._current.theme = theme;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-theme\"]:checked`);\n    options.theme = saveable.theme = input.value;\n    // return { theme: input.value };\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Theme</legend>\n            <label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-default\" value=\"default\" />Default</label>`;\n\n    this._control._reader.options.themes.forEach(function(theme) {\n      template += `<label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-${theme.klass}\" value=\"${theme.klass}\" />${theme.name}</label>`\n    }.bind(this));\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Rendition = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var rootfiles = this._control._reader.rootfiles;\n    var rootfilePath = this._control._reader.options.rootfilePath;\n    var expr = rootfilePath ? `[value=\"${rootfilePath}\"]` : \":first-child\";\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]${expr}`);\n    input.checked = true;\n    this._current.rootfilePath = rootfilePath || rootfiles[0].rootfilePath;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]:checked`);\n    if ( input.value != this._current.rootfilePath ) {\n      options.rootfilePath = input.value;\n      this._current.rootfilePath = input.value;\n    }\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Rendition</legend>\n    `;\n\n    this._control._reader.rootfiles.forEach(function(rootfile, i) {\n      template += `<label><input name=\"x${this._id}-rootfilePath\" type=\"radio\" id=\"x${this._id}-input-rootfilePath-${i}\" value=\"${rootfile.rootfilePath}\" />${rootfile.label || rootfile.accessMode || rootfile.rootfilePath}</label>`;\n    }.bind(this))\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Scale = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview > div`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var scale = this._control._reader.options.scale || 100;\n    if ( ! scale ) { scale = 100; }\n    this._current.scale = scale;\n    this._input.value = scale;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.scale = saveable.scale = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Zoom In/Out</legend>\n        <div class=\"preview--scale\" id=\"x${this._id}-preview\" style=\"overflow: hidden; height: 5rem\">\n          <div>\n            ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n          </div>\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span style=\"font-size: 150%\">⊖<span class=\"u-screenreader\"> Zoom Out</span></span>\n          <input name=\"scale\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span style=\"font-size: 150%\">⊕<span class=\"u-screenreader\">Zoom In </span></span>\n        </p>\n        <p>\n          <span>Scale: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.transform = `scale(${( parseInt(this._input.value, 10) / 100 )}) translate(0,0)`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nexport var preferences = function(options) {\n  return new Preferences(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Widget = Control.extend({\n\n\n  options: {\n      // @option region: String = 'topright'\n      // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n      // `'topright'`, `'bottomleft'` or `'bottomright'`\n  },\n\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      // NOOP\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n\n    }\n\n    this._onAddExtra(container);\n    this._updateTemplate(container);\n    this._updateClass(container);\n    this._bindEvents(container);\n\n    return container;\n  },\n\n  _updateTemplate: function(container) {\n    var data = this.data();\n    for(var slot in data) {\n      if ( data.hasOwnProperty(slot) ) {\n        var value = data[slot];\n        if ( typeof(value) == \"function\" ) { value = value(); }\n        var node = container.querySelector(`[data-slot=${slot}]`);\n        if ( node ) {\n          if ( node.hasAttribute('value') ) {\n            node.setAttribute('value', value);\n          } else {\n            node.innerHTML = value;\n          }\n        }\n      }\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this.options.className ) {\n      DomUtil.addClass(container, this.options.className);\n    }\n  },\n\n  _onAddExtra: function() { },\n\n  _bindEvents: function(container) {\n    var control = container.querySelector(\"[data-toggle=button]\");\n    if ( ! control ) { return ; }\n    DomEvent.disableClickPropagation(control);\n    DomEvent.on(control, 'click', DomEvent.stop);\n    DomEvent.on(control, 'click', this._action, this);\n  },\n\n  _action: function() {\n  },\n\n  data: function() {\n    return this.options.data || {};\n  },\n\n  EOT: true\n});\n\nWidget.Button = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _action: function() {\n    this.options.onClick(this, this._reader);\n  },\n\n  EOT: true\n});\n\nWidget.Panel = Widget.extend({\n  defaultTemplate: `<div><span data-slot=\"text\"></span></div>`,\n\n\n  EOT: true\n});\n\nWidget.Toggle = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _onAddExtra: function(container) {\n    this.state(this.options.states[0].stateName, container);\n\n    return container;\n  },\n\n  state: function(stateName, container) {\n    container = container || this._container;\n    this._resetState(container);\n    this._state = this.options.states.filter(function(s) { return s.stateName == stateName })[0];\n    this._updateClass(container);\n    this._updateTemplate(container);\n  },\n\n  _resetState: function(container) {\n    if ( ! this._state ) { return; }\n    if ( this._state.className ) {\n      DomUtil.removeClass(container, this._state.className);\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this._state.className ) {\n      DomUtil.addClass(container, this._state.className);\n    }\n  },\n\n  _action: function() {\n    this._state.onClick(this, this._reader);\n  },\n\n  data: function() {\n    return this._state.data || {};\n  },\n\n  EOT: true\n});\n\n// export var widget = function(options) {\n//   return new Widget(options);\n// }\n\nexport var widget = {\n  button: function(options) { return new Widget.Button(options); },\n  panel: function(options) { return new Widget.Panel(options); },\n  toggle: function(options) { return new Widget.Toggle(options); }\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Citation = Control.extend({\n  options: {\n    label: 'Citation',\n    html: '<span class=\"citation\" aria-label=\"Get Citation\"></span>'\n  },\n\n  defaultTemplate: '<button class=\"button--sm cozy-citation citation\" data-toggle=\"open\" aria-label=\"Get Citation\"></button>',\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Select Citation Format</legend>\n      </fieldset>\n    </form>\n    <blockquote id=\"formatted\" style=\"padding: 8px; border-left: 4px solid black; background-color: #fff\"></blockquote>\n    <div class=\"alert alert-info\" id=\"message\" style=\"display: none\"></div>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Copy Citation to Clipboard',\n      className: 'cozy-modal-citatation',\n      actions: [\n        {\n          label: 'Copy Citation',\n          callback: function(event) {\n            document.designMode = \"on\";\n            var formatted = self._modal._container.querySelector(\"#formatted\");\n\n            var range = document.createRange();\n            range.selectNode(formatted);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // formatted.select();\n\n            try {\n              var flag = document.execCommand('copy');\n            } catch(err) {\n              console.log(\"AHOY COPY FAILED\", err);\n            }\n\n            self._message.innerHTML = 'Success! Citation copied to your clipboard.';\n            self._message.style.display = 'block';\n            sel.removeAllRanges();\n            range.detach();\n            document.designMode = \"off\";\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    var fieldset = this._form.querySelector('fieldset');\n\n    var citations = this.options.citations || this._reader.metadata.citations;\n\n    citations.forEach(function(citation, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', citation.format);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = document.createTextNode(\" \" + citation.format);\n      label.appendChild(text);\n      input.setAttribute('data-text', citation.text);\n    });\n\n    this._formatted = this._modal._container.querySelector(\"#formatted\");\n    this._message = this._modal._container.querySelector(\"#message\");\n    DomEvent.on(this._form, 'change', function(event) {\n      var target = event.target;\n      if ( target.tagName == 'INPUT' ) {\n        this._initializeForm();\n      }\n    }, this);\n\n    this._initializeForm();\n  },\n\n  _initializeForm: function() {\n    var formatted = this._formatCitation();\n    this._formatted.innerHTML = formatted;\n    this._message.style.display = 'none';\n    this._message.innerHTML = '';\n  },\n\n  _formatCitation: function(format) {\n    if ( format == null ) {\n      var selected = this._form.querySelector(\"input:checked\");\n      format = selected.value;\n    }\n    var selected = this._form.querySelector(\"input[value=\" + format + \"]\");\n    return selected.getAttribute('data-text');\n    // return selected.dataset.text;\n  },\n\n  EOT: true\n});\n\nexport var citation = function(options) {\n  return new Citation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Search = Control.extend({\n  options: {\n    label: 'Search',\n    html: '<span>Search</span>'\n  },\n\n  defaultTemplate: `<form class=\"search\">\n    <label class=\"u-screenreader\" for=\"cozy-search-string\">Search in this text</label>\n    <input id=\"cozy-search-string\" name=\"search\" type=\"text\" placeholder=\"Search in this text...\"/>\n    <button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Search\"><i class=\"icon-magnifying-glass oi\" data-glyph=\"magnifying-glass\" title=\"Search\" aria-hidden=\"true\"></i></button>\n  </form>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    container.style.position = 'relative';\n\n    this._data = null;\n    this._canceled = false;\n    this._processing = false;\n\n    this._reader.on('ready', function() {\n\n      this._modal = this._reader.modal({\n        template: '<article></article>',\n        title: 'Search Results',\n        className: { container: 'cozy-modal-search' },\n        region: 'left',\n      });\n\n      this._modal.callbacks.onClose = function() {\n        if ( self._processing ) {\n          self._canceled = true;\n        }\n      };\n\n      this._article = this._modal._container.querySelector('article');\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('href');\n        this._reader.tracking.action('search/go');\n        this._reader.gotoPage(target);\n        return true;\n      }.bind(this));\n\n      this._modal.on('closed', function() {\n        this._reader.tracking.action('contents/close');\n      }.bind(this))\n\n    }.bind(this));\n\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n\n      var searchString = this._container.querySelector(\"#cozy-search-string\").value;\n      searchString = searchString.replace(/^\\s*/, '').replace(/\\s*$/, '');\n\n      if ( ! searchString ) {\n        // just punt\n        return;\n      }\n\n      if ( searchString == this.searchString ) {\n        // cached results\n        self.openModalResults();\n      } else {\n        this.searchString = searchString;\n        self.openModalWaiting();\n        self.submitQuery();\n      }\n    }, this);\n\n    return container;\n  },\n\n  openModalWaiting: function() {\n    this._processing = true;\n    this._emptyArticle();\n    var value = this.searchString;\n    this._article.innerHTML = '<p>Submitting query for <em>' + value + '</em>...</p>' + this._reader.loaderTemplate();\n    this._modal.activate();\n  },\n\n  openModalResults: function() {\n    if ( this._canceled ) {\n      this._canceled = false;\n      return;\n    }\n    this._buildResults();\n    this._modal.activate();\n    this._reader.tracking.action(\"search/open\");\n  },\n\n  submitQuery: function() {\n    var self = this;\n\n    var url = this.options.searchUrl + this.searchString;\n\n    var request = new XMLHttpRequest();\n    request.open('GET', url, true);\n\n    request.onload = function() {\n      if (this.status >= 200 && this.status < 400) {\n        // Success!\n        var data = JSON.parse(this.response);\n        console.log(\"SEARCH DATA\", data);\n\n        self._data = data;\n\n      } else {\n        // We reached our target server, but it returned an error\n\n        self._data = null;\n        console.log(this.response);\n      }\n\n      self._reader.tracking.action(\"search/submitQuery\");\n      self.openModalResults();\n\n    };\n\n    request.onerror = function() {\n      // There was a connection error of some sort\n      self._data = null;\n      self.openModalResults();\n    };\n\n    request.send();\n\n  },\n\n  _emptyArticle: function() {\n    while (this._article && this._article.hasChildNodes()) {\n      this._article.removeChild(this._article.lastChild);\n    }\n  },\n\n  _buildResults: function() {\n    var self = this;\n    var content;\n\n    this._processing = false;\n\n    self._emptyArticle();\n\n    var reader = this._reader;\n    reader.annotations.reset();\n\n    if ( this._data ) {\n      var highlight = true\n      if (this._data.highlight_off == \"yes\") {\n        highlight = false;\n      }\n      if ( this._data.search_results.length ) {\n        content = DomUtil.create('ul');\n\n        this._data.search_results.forEach(function(result) {\n          var option = DomUtil.create('li');\n          var anchor = DomUtil.create('a', null, option);\n          var cfiRange = \"epubcfi(\" + result.cfi + \")\";\n\n          if (result.snippet) {\n            if (result.title) {\n              var chapterTitle = DomUtil.create('i');\n              chapterTitle.textContent = result.title + \": \";\n              anchor.appendChild(chapterTitle);\n            }\n            anchor.appendChild(document.createTextNode(result.snippet));\n\n            anchor.setAttribute(\"href\", cfiRange);\n            content.appendChild(option);\n          }\n          if (highlight) {\n            reader.annotations.highlight(cfiRange);\n          }\n        });\n      } else {\n        content = DomUtil.create(\"p\")\n        content.textContent = 'No results found for \"' + self.searchString + '\"';\n      }\n    } else {\n      content = DomUtil.create(\"p\")\n      content.textContent = 'There was a problem processing this query.';\n    }\n\n    self._article.appendChild(content);\n  },\n\n  EOT: true\n});\n\nexport var search = function(options) {\n  return new Search(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var BibliographicInformation = Control.extend({\n  options: {\n    label: 'Info',\n    direction: 'left',\n    html: '<span class=\"oi\" data-glyph=\"info\">Info</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-bib-info oi\" data-glyph=\"info\" data-toggle=\"open\" aria-label=\"Bibliographic Information\"> Info</button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<dl>\n    </dl>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Info',\n      region: 'left',\n      fraction: 1.0\n    });\n\n    var dl = this._modal._container.querySelector('dl');\n\n    var metadata_fields = [\n      [ 'title', 'Title' ],\n      [ 'creator', 'Author' ],\n      [ 'pubdate', 'Publication Date' ],\n      [ 'modified_date', 'Modified Date' ],\n      [ 'publisher', 'Publisher' ],\n      [ 'rights', 'Rights' ],\n      [ 'doi', 'DOI' ],\n      [ 'description', 'Description' ],\n    ];\n\n    var metadata_fields_seen = {};\n\n    var metadata = this._reader.metadata;\n\n    for(var idx in metadata_fields) {\n      var key = metadata_fields[idx][0];\n      var label = metadata_fields[idx][1];\n      if ( metadata[key] ) {\n        var value = metadata[key];\n        if ( key == 'pubdate' || key == 'modified_date' ) {\n          value = this._formatDate(value);\n          if ( ! value ) { continue; }\n          // value = d.toISOString().slice(0,10); // for YYYY-MM-DD\n        }\n        metadata_fields_seen[key] = true;\n        var dt = DomUtil.create('dt', 'cozy-bib-info-label', dl);\n        dt.innerHTML = label;\n        var dd = DomUtil.create('dd', 'cozy-bib-info-value cozy-bib-info-value-' + key, dl);\n        dd.innerHTML = value;\n      }\n    }\n\n  },\n\n  _formatDate: function(value) {\n    var match = value.match(/\\d{4}/);\n    if ( match ) {\n      return match[0];\n    }\n    return null;\n  },\n\n  EOT: true\n});\n\nexport var bibliographicInformation = function(options) {\n  return new BibliographicInformation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Download = Control.extend({\n  options: {\n    label: 'Download Book',\n    html: '<span>Download Book</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-download oi\" data-toggle=\"open\" data-glyph=\"data-transfer-download\"> Download Book</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Choose File Format</legend>\n      </fieldset>\n    </form>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Download Book',\n      className: 'cozy-modal-download',\n      actions: [\n        {\n          label: 'Download',\n          callback: function(event) {\n            var selected = self._form.querySelector(\"input:checked\");\n            var href = selected.getAttribute('data-href');\n            self._configureDownloadForm(href);\n            self._form.submit();\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');    \n    var fieldset = this._form.querySelector('fieldset');\n    this._reader.options.download_links.forEach(function(link, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', link.format);\n      input.setAttribute('data-href', link.href);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = link.format;\n      if ( link.size ) {\n        text += \" (\" + link.size + \")\";\n      }\n      var text = document.createTextNode(\" \" + text);\n      label.appendChild(text);\n    });\n\n  },\n\n  _configureDownloadForm: function(href) {\n    var self = this;\n    self._form.setAttribute('method', 'GET');\n    self._form.setAttribute('action', href);\n    self._form.setAttribute('target', '_blank');\n  },\n\n\n  EOT: true\n});\n\nexport var download = function(options) {\n  return new Download(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Navigator = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n    } else {\n\n      var className = this._className('navigator'),\n          options = this.options;\n      \n      container = DomUtil.create('div', className);\n    }\n    this._setup(container);\n\n    this._reader.on('updateLocations', function(locations) {      \n      // if ( ! this._reader.currentLocation() || ! this._reader.currentLocation().start ) {\n      //   console.log(\"AHOY updateLocations NO START\", this._reader.currentLocation().then);\n      //   setTimeout(function() {\n      //     this._initializeNavigator(locations);\n      //   }.bind(this), 100);\n      //   return;\n      // }\n      this._initializeNavigator(locations);\n    }.bind(this));\n\n    return container;\n  },\n\n  _setup: function(container) {\n    this._control = container.querySelector(\"input[type=range]\");\n    if ( ! this._control ) {\n      this._createControl(container);\n    }\n    this._background = container.querySelector(\".cozy-navigator-range__background\");\n    this._status = container.querySelector(\".cozy-navigator-range__status\");\n    this._spanCurrentPercentage = container.querySelector(\".currentPercentage\");\n    this._spanCurrentLocation = container.querySelector(\".currentLocation\");\n    this._spanTotalLocations = container.querySelector(\".totalLocations\");\n\n    this._bindEvents();\n  },\n\n  _createControl: function (container) {\n    var template = `<div class=\"cozy-navigator-range\">\n        <label class=\"u-screenreader\" for=\"cozy-navigator-range-input\">Location: </label>\n        <input class=\"cozy-navigator-range__input\" id=\"cozy-navigator-range-input\" type=\"range\" name=\"locations-range-value\" min=\"0\" max=\"100\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\" aria-valuetext=\"0% • Location 0 of ?\" value=\"0\" data-background-position=\"0\" />\n        <div class=\"cozy-navigator-range__background\"></div>\n      </div>\n      <div class=\"cozy-navigator-range__status\"><span class=\"currentPercentage\">0%</span> • Location <span class=\"currentLocation\">0</span> of <span class=\"totalLocations\">?</span></div>\n    `;\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      container.appendChild(body.children[0]);\n    }\n\n    this._control = container.querySelector(\"input[type=range]\");\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    this._control.addEventListener(\"input\", function() {\n      self._update();\n    }, false);\n    this._control.addEventListener(\"change\", function() { self._action(); }, false);\n    this._control.addEventListener(\"mousedown\", function(){\n        self._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"mouseup\", function(){\n        self._mouseDown = false;\n    }, false);\n    this._control.addEventListener(\"keydown\", function(){\n      self._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"keyup\", function(){\n      self._mouseDown = false;\n    }, false);\n\n    this._reader.on('relocated', function(location) {\n      if ( ! self._initiated ) { return; }\n      if ( ! self._mouseDown ) {\n        self._control.value = Math.ceil(self._reader.locations.percentageFromCfi(self._reader.currentLocation().start.cfi) * 100);\n        self._update();\n      }\n    })\n\n  },\n\n  _action: function() {\n    var value = this._control.value;\n    var locations = this._reader.locations;\n    var cfi = locations.cfiFromPercentage(value / 100);\n    this._reader.tracking.action(\"navigator/go\");\n    this._reader.gotoPage(cfi);\n  },\n\n  _update: function() {\n    var self = this;\n\n    var current = this._reader.currentLocation();\n    if ( ! current || ! current.start ) {\n      setTimeout(function() {\n        this._update();\n      }.bind(this), 100);\n    }\n\n    var rangeBg = this._background;\n    var range = self._control;\n\n    var value = parseInt(range.value, 10);\n    var percentage = value;\n\n    rangeBg.setAttribute('style', 'background-position: ' + (-percentage) + '% 0%, left top;');\n    self._control.setAttribute('data-background-position', Math.ceil(percentage));\n\n    this._spanCurrentPercentage.innerHTML = percentage + '%';\n    if ( current && current.start ) {\n      var current_location = this._reader.locations.locationFromCfi(current.start.cfi);\n      this._spanCurrentLocation.innerHTML = ( current_location );\n    }\n    self._last_delta = self._last_value > value; self._last_value = value;\n  },\n\n  _initializeNavigator: function(locations) {\n    console.log(\"AHOY updateLocations PROCESSING LOCATION\");\n    this._initiated = true;\n    this._total = this._reader.locations.total;\n    if ( this._reader.currentLocation() && this._reader.currentLocation().start ) {\n      this._control.value = Math.ceil(this._reader.locations.percentageFromCfi(this._reader.currentLocation().start.cfi) * 100);\n      this._last_value = this._control.value;\n    } else {\n      this._last_value = this._control.value;\n    }\n\n    this._spanTotalLocations.innerHTML = this._total;\n\n    this._update();\n    setTimeout(function() {\n      DomUtil.addClass(this._container, 'initialized');\n    }.bind(this), 0);\n  },\n\n  EOT: true\n});\n\nexport var navigator = function(options) {\n  return new Navigator(options);\n}\n","import {Control, control} from './Control';\nimport {PageNext, PagePrevious, pageNext, pagePrevious, PageFirst, pageFirst, PageLast, pageLast} from './Control.Paging';\nimport {Contents, contents} from './Control.Contents';\nimport {Title, title} from './Control.Title';\nimport {PublicationMetadata, publicationMetadata} from './Control.PublicationMetadata';\nimport {Preferences, preferences} from './Control.Preferences';\nimport {Widget, widget} from './Control.Widget';\nimport {Citation, citation} from './Control.Citation';\nimport {Search, search} from './Control.Search';\nimport {BibliographicInformation, bibliographicInformation} from './Control.BibliographicInformation';\nimport {Download, download} from './Control.Download';\nimport {Navigator, navigator} from './Control.Navigator';\n\n// import {Zoom, zoom} from './Control.Zoom';\n// import {Attribution, attribution} from './Control.Attribution';\n\nControl.PageNext = PageNext;\nControl.PagePrevious = PagePrevious;\nControl.PageFirst = PageFirst;\nControl.PageLast = PageLast;\ncontrol.pagePrevious = pagePrevious;\ncontrol.pageNext = pageNext;\ncontrol.pageFirst = pageFirst;\ncontrol.pageLast = pageLast;\n\nControl.Contents = Contents;\ncontrol.contents = contents;\n\nControl.Title = Title;\ncontrol.title = title;\n\nControl.PublicationMetadata = PublicationMetadata;\ncontrol.publicationMetadata = publicationMetadata;\n\nControl.Preferences = Preferences;\ncontrol.preferences = preferences;\n\nControl.Widget = Widget;\ncontrol.widget = widget;\n\nControl.Citation = Citation;\ncontrol.citation = citation;\n\nControl.Search = Search;\ncontrol.search = search;\n\nControl.BibliographicInformation = BibliographicInformation;\ncontrol.bibliographicInformation = bibliographicInformation;\n\nControl.Download = Download;\ncontrol.download = download;\n\nControl.Navigator = Navigator;\ncontrol.navigator = navigator;\n\nexport {Control, control};\n","import {Evented} from './Events';\n\nvar Bus = Evented.extend({\n});\n\nvar instance;\nexport var bus = function() {\n  return instance || ( instance = new Bus() );\n}\n","import * as Browser from './Browser';\nexport {Browser};\n\nexport {Class} from './Class';\n\nimport {Evented} from './Events';\nexport {Evented};\nexport var Mixin = {Events: Evented.prototype};\n\nimport * as Util from './Util';\nexport {Util};\nexport {extend, bind, stamp, setOptions} from './Util';\nexport {bus} from './Bus';\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn (obj.foo + obj.bar + obj.trzy) === \"razdwatrzy\";\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) {\n return (val !== _undefined) && (val !== null);\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")()\n\t? Object.assign\n\t: require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","// Deprecated\n\n\"use strict\";\n\nmodule.exports = function (obj) {\n return typeof obj === \"function\";\n};\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn (str.contains(\"dwa\") === true) && (str.contains(\"foo\") === false);\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")()\n\t? String.prototype.contains\n\t: require(\"./shim\");\n","'use strict';\n\nvar assign        = require('es5-ext/object/assign')\n  , normalizeOpts = require('es5-ext/object/normalize-options')\n  , isCallable    = require('es5-ext/object/is-callable')\n  , contains      = require('es5-ext/string/#/contains')\n\n  , d;\n\nd = module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif ((arguments.length < 2) || (typeof dscr !== 'string')) {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (dscr == null) {\n\t\tc = w = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t\tw = contains.call(dscr, 'w');\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== 'string') {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (get == null) {\n\t\tget = undefined;\n\t} else if (!isCallable(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (set == null) {\n\t\tset = undefined;\n\t} else if (!isCallable(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (dscr == null) {\n\t\tc = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","/**\n * Core Utilities and Helpers\n * @module Core\n*/\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nexport const requestAnimationFrame = (typeof window != \"undefined\") ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\nconst _URL = typeof URL != \"undefined\" ? URL : (typeof window != \"undefined\" ? (window.URL || window.webkitURL || window.mozURL) : undefined);\n\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\nexport function uuid() {\n\tvar d = new Date().getTime();\n\tvar uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\td = Math.floor(d/16);\n\t\treturn (c==\"x\" ? r : (r&0x7|0x8)).toString(16);\n\t});\n\treturn uuid;\n}\n\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\nexport function documentHeight() {\n\treturn Math.max(\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight\n\t);\n}\n\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\nexport function isElement(obj) {\n\treturn !!(obj && obj.nodeType == 1);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isNumber(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isFloat(n) {\n\tlet f = parseFloat(n);\n\n\tif (isNumber(n) === false) {\n\t\treturn false;\n\t}\n\n\tif (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n\t\treturn true;\n\t}\n\n\treturn Math.floor(f) !== f;\n}\n\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\nexport function prefixed(unprefixed) {\n\tvar vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\" ];\n\tvar prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n\tvar upper = unprefixed[0].toUpperCase() + unprefixed.slice(1);\n\tvar length = vendors.length;\n\n\tif (typeof(document) === \"undefined\" || typeof(document.body.style[unprefixed]) != \"undefined\") {\n\t\treturn unprefixed;\n\t}\n\n\tfor ( var i=0; i < length; i++ ) {\n\t\tif (typeof(document.body.style[vendors[i] + upper]) != \"undefined\") {\n\t\t\treturn prefixes[i] + unprefixed;\n\t\t}\n\t}\n\n\treturn unprefixed;\n}\n\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\nexport function defaults(obj) {\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\n\t\tvar source = arguments[i];\n\t\tfor (var prop in source) {\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\n\t\t}\n\t}\n\treturn obj;\n}\n\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\nexport function extend(target) {\n\tvar sources = [].slice.call(arguments, 1);\n\tsources.forEach(function (source) {\n\t\tif(!source) return;\n\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\n\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n\t\t});\n\t});\n\treturn target;\n}\n\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function insert(item, array, compareFunction) {\n\tvar location = locationOf(item, array, compareFunction);\n\tarray.splice(location, 0, item);\n\n\treturn location;\n}\n\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function locationOf(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn pivot;\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared >= 0 ? pivot : pivot + 1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot;\n\t}\n\tif(compared === -1) {\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\n\t}\n}\n\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn -1; // Not found\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared === 0 ? pivot : -1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot; // Found\n\t}\n\tif(compared === -1) {\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\n\t}\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function bounds(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function borders(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\nexport function nodeBounds(node) {\n\tlet elPos;\n\tlet doc = node.ownerDocument;\n\tif(node.nodeType == Node.TEXT_NODE){\n\t\tlet elRange = doc.createRange();\n\t\telRange.selectNodeContents(node);\n\t\telPos = elRange.getBoundingClientRect();\n\t} else {\n\t\telPos = node.getBoundingClientRect();\n\t}\n\treturn elPos;\n}\n\n/**\n * Find the equivelent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\nexport function windowBounds() {\n\n\tvar width = window.innerWidth;\n\tvar height = window.innerHeight;\n\n\treturn {\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tright: width,\n\t\tbottom: height,\n\t\twidth: width,\n\t\theight: height\n\t};\n\n}\n\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\nexport function indexOfNode(node, typeId) {\n\tvar parent = node.parentNode;\n\tvar children = parent.childNodes;\n\tvar sib;\n\tvar index = -1;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tsib = children[i];\n\t\tif (sib.nodeType === typeId) {\n\t\t\tindex++;\n\t\t}\n\t\tif (sib == node) break;\n\t}\n\n\treturn index;\n}\n\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfTextNode(textNode) {\n\treturn indexOfNode(textNode, TEXT_NODE);\n}\n\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfElementNode(elementNode) {\n\treturn indexOfNode(elementNode, ELEMENT_NODE);\n}\n\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\nexport function isXml(ext) {\n\treturn [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\nexport function createBlob(content, mime){\n\treturn new Blob([content], {type : mime });\n}\n\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBlobUrl(content, mime){\n\tvar tempUrl;\n\tvar blob = createBlob(content, mime);\n\n\ttempUrl = _URL.createObjectURL(blob);\n\n\treturn tempUrl;\n}\n\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\nexport function revokeBlobUrl(url){\n\treturn _URL.revokeObjectURL(url);\n}\n\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBase64Url(content, mime){\n\tvar data;\n\tvar datauri;\n\n\tif (typeof(content) !== \"string\") {\n\t\t// Only handles strings\n\t\treturn;\n\t}\n\n\tdata = btoa(encodeURIComponent(content));\n\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\n\n\treturn datauri;\n}\n\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\nexport function type(obj){\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\n}\n\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\nexport function parse(markup, mime, forceXMLDom) {\n\tvar doc;\n\tvar Parser;\n\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\n\t\tParser = require(\"xmldom\").DOMParser;\n\t} else {\n\t\tParser = DOMParser;\n\t}\n\n\t// Remove byte order mark before parsing\n\t// https://www.w3.org/International/questions/qa-byte-order-mark\n\tif(markup.charCodeAt(0) === 0xFEFF) {\n\t\tmarkup = markup.slice(1);\n\t}\n\n\tdoc = new Parser().parseFromString(markup, mime);\n\n\treturn doc;\n}\n\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\nexport function qs(el, sel) {\n\tvar elements;\n\tif (!el) {\n\t\tthrow new Error(\"No Element Provided\");\n\t}\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\telements = el.getElementsByTagName(sel);\n\t\tif (elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\t}\n}\n\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsa(el, sel) {\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelectorAll(sel);\n\t} else {\n\t\treturn el.getElementsByTagName(sel);\n\t}\n}\n\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsp(el, sel, props) {\n\tvar q, filtered;\n\tif (typeof el.querySelector != \"undefined\") {\n\t\tsel += \"[\";\n\t\tfor (var prop in props) {\n\t\t\tsel += prop + \"~='\" + props[prop] + \"'\";\n\t\t}\n\t\tsel += \"]\";\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\tq = el.getElementsByTagName(sel);\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\n\t\t\tfor (var prop in props) {\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (filtered) {\n\t\t\treturn filtered[0];\n\t\t}\n\t}\n}\n\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n\tvar doc = root.ownerDocument || root;\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\n\t} else {\n\t\twalk(root, function(node) {\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\n\t\t\t\tfunc(node);\n\t\t\t}\n\t\t}, true);\n\t}\n}\n\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter funtion or object to filter with\n */\nexport function treeWalker(root, func, filter) {\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\n\tlet node;\n\twhile ((node = treeWalker.nextNode())) {\n\t\tfunc(node);\n\t}\n}\n\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\nexport function walk(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tnode = node.firstChild;\n\tif(node){\n\t\tdo{\n\t\t\tlet walked = walk(node,callback);\n\t\t\tif(walked){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tnode = node.nextSibling;\n\t\t} while(node);\n\t}\n}\n\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\nexport function blob2base64(blob) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar reader = new FileReader();\n\t\treader.readAsDataURL(blob);\n\t\treader.onloadend = function() {\n\t\t\tresolve(reader.result);\n\t\t};\n\t});\n}\n\n\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\nexport function defer() {\n\t/* A method to resolve the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} value : This value is used to resolve the promise\n\t * If the value is a Promise then the associated promise assumes the state\n\t * of Promise passed as value.\n\t */\n\tthis.resolve = null;\n\n\t/* A method to reject the assocaited Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} reason: The reason for the rejection of the Promise.\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\n\t * itself will be the reason for rejection no matter the state of the Promise.\n\t */\n\tthis.reject = null;\n\n\tthis.id = uuid();\n\n\t/* A newly created Pomise object.\n\t * Initially in pending state.\n\t */\n\tthis.promise = new Promise((resolve, reject) => {\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t});\n\tObject.freeze(this);\n}\n\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function querySelectorByType(html, element, type){\n\tvar query;\n\tif (typeof html.querySelector != \"undefined\") {\n\t\tquery = html.querySelector(`${element}[*|type=\"${type}\"]`);\n\t}\n\t// Handle IE not supporting namespaced epub:type in querySelector\n\tif(!query || query.length === 0) {\n\t\tquery = qsa(html, element);\n\t\tfor (var i = 0; i < query.length; i++) {\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type ||\n\t\t\t\t query[i].getAttribute(\"epub:type\") === type) {\n\t\t\t\treturn query[i];\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn query;\n\t}\n}\n\n/**\n * Find direct decendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\nexport function findChildren(el) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function parents(node) {\n\tvar nodes = [node];\n\tfor (; node; node = node.parentNode) {\n\t\tnodes.unshift(node);\n\t}\n\treturn nodes\n}\n\n/**\n * Find all direct decendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\nexport function filterChildren(el, nodeName, single) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n\t\t\tif (single) {\n\t\t\t\treturn node;\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t}\n\t}\n\tif (!single) {\n\t\treturn result;\n\t}\n}\n\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function getParentByTagName(node, tagname) {\n\tlet parent;\n\tif (node === null || tagname === '') return;\n\tparent = node.parentNode;\n\twhile (parent.nodeType === 1) {\n\t\tif (parent.tagName.toLowerCase() === tagname) {\n\t\t\treturn parent;\n\t\t}\n\t\tparent = parent.parentNode;\n\t}\n}\n\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\nexport class RangeObject {\n\tconstructor() {\n\t\tthis.collapsed = false;\n\t\tthis.commonAncestorContainer = undefined;\n\t\tthis.endContainer = undefined;\n\t\tthis.endOffset = undefined;\n\t\tthis.startContainer = undefined;\n\t\tthis.startOffset = undefined;\n\t}\n\n\tsetStart(startNode, startOffset) {\n\t\tthis.startContainer = startNode;\n\t\tthis.startOffset = startOffset;\n\n\t\tif (!this.endContainer) {\n\t\t\tthis.collapse(true);\n\t\t} else {\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tsetEnd(endNode, endOffset) {\n\t\tthis.endContainer = endNode;\n\t\tthis.endOffset = endOffset;\n\n\t\tif (!this.startContainer) {\n\t\t\tthis.collapse(false);\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tcollapse(toStart) {\n\t\tthis.collapsed = true;\n\t\tif (toStart) {\n\t\t\tthis.endContainer = this.startContainer;\n\t\t\tthis.endOffset = this.startOffset;\n\t\t\tthis.commonAncestorContainer = this.startContainer.parentNode;\n\t\t} else {\n\t\t\tthis.startContainer = this.endContainer;\n\t\t\tthis.startOffset = this.endOffset;\n\t\t\tthis.commonAncestorContainer = this.endOffset.parentNode;\n\t\t}\n\t}\n\n\tselectNode(referenceNode) {\n\t\tlet parent = referenceNode.parentNode;\n\t\tlet index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n\t\tthis.setStart(parent, index);\n\t\tthis.setEnd(parent, index + 1);\n\t}\n\n\tselectNodeContents(referenceNode) {\n\t\tlet end = referenceNode.childNodes[referenceNode.childNodes - 1];\n\t\tlet endIndex = (referenceNode.nodeType === 3) ?\n\t\t\t\treferenceNode.textContent.length : parent.childNodes.length;\n\t\tthis.setStart(referenceNode, 0);\n\t\tthis.setEnd(referenceNode, endIndex);\n\t}\n\n\t_commonAncestorContainer(startContainer, endContainer) {\n\t\tvar startParents = parents(startContainer || this.startContainer);\n\t\tvar endParents = parents(endContainer || this.endContainer);\n\n\t\tif (startParents[0] != endParents[0]) return undefined;\n\n\t\tfor (var i = 0; i < startParents.length; i++) {\n\t\t\tif (startParents[i] != endParents[i]) {\n\t\t\t\treturn startParents[i - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\t_checkCollapsed() {\n\t\tif (this.startContainer === this.endContainer &&\n\t\t\t\tthis.startOffset === this.endOffset) {\n\t\t\tthis.collapsed = true;\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t}\n\t}\n\n\ttoString() {\n\t\t// TODO: implement walking between start and end to find text\n\t}\n}\n","'use strict';\n\nif (!process) {\n  var process = {\n    \"cwd\" : function () { return '/' }\n  };\n}\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n","import path from \"path-webpack\";\n\n/**\n * Creates a Path object for parsing and manipulation of a path strings\n *\n * Uses a polyfill for Nodejs path: https://nodejs.org/api/path.html\n * @param\t{string} pathString\ta url string (relative or absolute)\n * @class\n */\nclass Path {\n\tconstructor(pathString) {\n\t\tvar protocol;\n\t\tvar parsed;\n\n\t\tprotocol = pathString.indexOf(\"://\");\n\t\tif (protocol > -1) {\n\t\t\tpathString = new URL(pathString).pathname;\n\t\t}\n\n\t\tparsed = this.parse(pathString);\n\n\t\tthis.path = pathString;\n\n\t\tif (this.isDirectory(pathString)) {\n\t\t\tthis.directory = pathString;\n\t\t} else {\n\t\t\tthis.directory = parsed.dir + \"/\";\n\t\t}\n\n\t\tthis.filename = parsed.base;\n\t\tthis.extension = parsed.ext.slice(1);\n\n\t}\n\n\t/**\n\t * Parse the path: https://nodejs.org/api/path.html#path_path_parse_path\n\t * @param\t{string} what\n\t * @returns {object}\n\t */\n\tparse (what) {\n\t\treturn path.parse(what);\n\t}\n\n\t/**\n\t * @param\t{string} what\n\t * @returns {boolean}\n\t */\n\tisAbsolute (what) {\n\t\treturn path.isAbsolute(what || this.path);\n\t}\n\n\t/**\n\t * Check if path ends with a directory\n\t * @param\t{string} what\n\t * @returns {boolean}\n\t */\n\tisDirectory (what) {\n\t\treturn (what.charAt(what.length-1) === \"/\");\n\t}\n\n\t/**\n\t * Resolve a path against the directory of the Path\n\t *\n\t * https://nodejs.org/api/path.html#path_path_resolve_paths\n\t * @param\t{string} what\n\t * @returns {string} resolved\n\t */\n\tresolve (what) {\n\t\treturn path.resolve(this.directory, what);\n\t}\n\n\t/**\n\t * Resolve a path relative to the directory of the Path\n\t *\n\t * https://nodejs.org/api/path.html#path_path_relative_from_to\n\t * @param\t{string} what\n\t * @returns {string} relative\n\t */\n\trelative (what) {\n\t\tvar isAbsolute = what && (what.indexOf(\"://\") > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\treturn path.relative(this.directory, what);\n\t}\n\n\tsplitPath(filename) {\n\t\treturn this.splitPathRe.exec(filename).slice(1);\n\t}\n\n\t/**\n\t * Return the path string\n\t * @returns {string} path\n\t */\n\ttoString () {\n\t\treturn this.path;\n\t}\n}\n\nexport default Path;\n","import Path from \"./path\";\nimport path from \"path-webpack\";\n\n/**\n * creates a Url object for parsing and manipulation of a url string\n * @param\t{string} urlString\ta url string (relative or absolute)\n * @param\t{string} [baseString] optional base for the url,\n * default to window.location.href\n */\nclass Url {\n\tconstructor(urlString, baseString) {\n\t\tvar absolute = (urlString.indexOf(\"://\") > -1);\n\t\tvar pathname = urlString;\n\t\tvar basePath;\n\n\t\tthis.Url = undefined;\n\t\tthis.href = urlString;\n\t\tthis.protocol = \"\";\n\t\tthis.origin = \"\";\n\t\tthis.hash = \"\";\n\t\tthis.hash = \"\";\n\t\tthis.search = \"\";\n\t\tthis.base = baseString;\n\n\t\tif (!absolute &&\n\t\t\t\tbaseString !== false &&\n\t\t\t\ttypeof(baseString) !== \"string\" &&\n\t\t\t\twindow && window.location) {\n\t\t\tthis.base = window.location.href;\n\t\t}\n\n\t\t// URL Polyfill doesn't throw an error if base is empty\n\t\tif (absolute || this.base) {\n\t\t\ttry {\n\t\t\t\tif (this.base) { // Safari doesn't like an undefined base\n\t\t\t\t\tthis.Url = new URL(urlString, this.base);\n\t\t\t\t} else {\n\t\t\t\t\tthis.Url = new URL(urlString);\n\t\t\t\t}\n\t\t\t\tthis.href = this.Url.href;\n\n\t\t\t\tthis.protocol = this.Url.protocol;\n\t\t\t\tthis.origin = this.Url.origin;\n\t\t\t\tthis.hash = this.Url.hash;\n\t\t\t\tthis.search = this.Url.search;\n\n\t\t\t\tpathname = this.Url.pathname;\n\t\t\t} catch (e) {\n\t\t\t\t// Skip URL parsing\n\t\t\t\tthis.Url = undefined;\n\t\t\t\t// resolve the pathname from the base\n\t\t\t\tif (this.base) {\n\t\t\t\t\tbasePath = new Path(this.base);\n\t\t\t\t\tpathname = basePath.resolve(pathname);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.Path = new Path(pathname);\n\n\t\tthis.directory = this.Path.directory;\n\t\tthis.filename = this.Path.filename;\n\t\tthis.extension = this.Path.extension;\n\n\t}\n\n\t/**\n\t * @returns {Path}\n\t */\n\tpath () {\n\t\treturn this.Path;\n\t}\n\n\t/**\n\t * Resolves a relative path to a absolute url\n\t * @param {string} what\n\t * @returns {string} url\n\t */\n\tresolve (what) {\n\t\tvar isAbsolute = (what.indexOf(\"://\") > -1);\n\t\tvar fullpath;\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\tfullpath = path.resolve(this.directory, what);\n\t\treturn this.origin + fullpath;\n\t}\n\n\t/**\n\t * Resolve a path relative to the url\n\t * @param {string} what\n\t * @returns {string} path\n\t */\n\trelative (what) {\n\t\treturn path.relative(what, this.directory);\n\t}\n\n\t/**\n\t * @returns {string}\n\t */\n\ttoString () {\n\t\treturn this.href;\n\t}\n}\n\nexport default Url;\n","import {extend, type, findChildren, RangeObject, isNumber} from \"./utils/core\";\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n\n/**\n\t* Parsing and creation of EpubCFIs: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\n\n\t* Implements:\n\t* - Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\n\t* - Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\n\n\t* Does Not Implement:\n\t* - Temporal Offset (~)\n\t* - Spatial Offset (@)\n\t* - Temporal-Spatial Offset (~ + @)\n\t* - Text Location Assertion ([)\n\t* @class\n\t@param {string | Range | Node } [cfiFrom]\n\t@param {string | object} [base]\n\t@param {string} [ignoreClass] class to ignore when parsing DOM\n*/\nclass EpubCFI {\n\tconstructor(cfiFrom, base, ignoreClass){\n\t\tvar type;\n\n\t\tthis.str = \"\";\n\n\t\tthis.base = {};\n\t\tthis.spinePos = 0; // For compatibility\n\n\t\tthis.range = false; // true || false;\n\n\t\tthis.path = {};\n\t\tthis.start = null;\n\t\tthis.end = null;\n\n\t\t// Allow instantiation without the \"new\" keyword\n\t\tif (!(this instanceof EpubCFI)) {\n\t\t\treturn new EpubCFI(cfiFrom, base, ignoreClass);\n\t\t}\n\n\t\tif(typeof base === \"string\") {\n\t\t\tthis.base = this.parseComponent(base);\n\t\t} else if(typeof base === \"object\" && base.steps) {\n\t\t\tthis.base = base;\n\t\t}\n\n\t\ttype = this.checkType(cfiFrom);\n\n\n\t\tif(type === \"string\") {\n\t\t\tthis.str = cfiFrom;\n\t\t\treturn extend(this, this.parse(cfiFrom));\n\t\t} else if (type === \"range\") {\n\t\t\treturn extend(this, this.fromRange(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === \"node\") {\n\t\t\treturn extend(this, this.fromNode(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === \"EpubCFI\" && cfiFrom.path) {\n\t\t\treturn cfiFrom;\n\t\t} else if (!cfiFrom) {\n\t\t\treturn this;\n\t\t} else {\n\t\t\tthrow new TypeError(\"not a valid argument for EpubCFI\");\n\t\t}\n\n\t}\n\n\t/**\n\t * Check the type of constructor input\n\t * @private\n\t */\n\tcheckType(cfi) {\n\n\t\tif (this.isCfiString(cfi)) {\n\t\t\treturn \"string\";\n\t\t// Is a range object\n\t\t} else if (cfi && typeof cfi === \"object\" && (type(cfi) === \"Range\" || typeof(cfi.startContainer) != \"undefined\")){\n\t\t\treturn \"range\";\n\t\t} else if (cfi && typeof cfi === \"object\" && typeof(cfi.nodeType) != \"undefined\" ){ // || typeof cfi === \"function\"\n\t\t\treturn \"node\";\n\t\t} else if (cfi && typeof cfi === \"object\" && cfi instanceof EpubCFI){\n\t\t\treturn \"EpubCFI\";\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Parse a cfi string to a CFI object representation\n\t * @param {string} cfiStr\n\t * @returns {object} cfi\n\t */\n\tparse(cfiStr) {\n\t\tvar cfi = {\n\t\t\tspinePos: -1,\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\t\tvar baseComponent, pathComponent, range;\n\n\t\tif(typeof cfiStr !== \"string\") {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tif(cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length-1] === \")\") {\n\t\t\t// Remove intial epubcfi( and ending )\n\t\t\tcfiStr = cfiStr.slice(8, cfiStr.length-1);\n\t\t}\n\n\t\tbaseComponent = this.getChapterComponent(cfiStr);\n\n\t\t// Make sure this is a valid cfi or return\n\t\tif(!baseComponent) {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tcfi.base = this.parseComponent(baseComponent);\n\n\t\tpathComponent = this.getPathComponent(cfiStr);\n\t\tcfi.path = this.parseComponent(pathComponent);\n\n\t\trange = this.getRange(cfiStr);\n\n\t\tif(range) {\n\t\t\tcfi.range = true;\n\t\t\tcfi.start = this.parseComponent(range[0]);\n\t\t\tcfi.end = this.parseComponent(range[1]);\n\t\t}\n\n\t\t// Get spine node position\n\t\t// cfi.spineSegment = cfi.base.steps[1];\n\n\t\t// Chapter segment is always the second step\n\t\tcfi.spinePos = cfi.base.steps[1].index;\n\n\t\treturn cfi;\n\t}\n\n\tparseComponent(componentStr){\n\t\tvar component = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar parts = componentStr.split(\":\");\n\t\tvar steps = parts[0].split(\"/\");\n\t\tvar terminal;\n\n\t\tif(parts.length > 1) {\n\t\t\tterminal = parts[1];\n\t\t\tcomponent.terminal = this.parseTerminal(terminal);\n\t\t}\n\n\t\tif (steps[0] === \"\") {\n\t\t\tsteps.shift(); // Ignore the first slash\n\t\t}\n\n\t\tcomponent.steps = steps.map(function(step){\n\t\t\treturn this.parseStep(step);\n\t\t}.bind(this));\n\n\t\treturn component;\n\t}\n\n\tparseStep(stepStr){\n\t\tvar type, num, index, has_brackets, id;\n\n\t\thas_brackets = stepStr.match(/\\[(.*)\\]/);\n\t\tif(has_brackets && has_brackets[1]){\n\t\t\tid = has_brackets[1];\n\t\t}\n\n\t\t//-- Check if step is a text node or element\n\t\tnum = parseInt(stepStr);\n\n\t\tif(isNaN(num)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(num % 2 === 0) { // Even = is an element\n\t\t\ttype = \"element\";\n\t\t\tindex = num / 2 - 1;\n\t\t} else {\n\t\t\ttype = \"text\";\n\t\t\tindex = (num - 1 ) / 2;\n\t\t}\n\n\t\treturn {\n\t\t\t\"type\" : type,\n\t\t\t\"index\" : index,\n\t\t\t\"id\" : id || null\n\t\t};\n\t}\n\n\tparseTerminal(termialStr){\n\t\tvar characterOffset, textLocationAssertion;\n\t\tvar assertion = termialStr.match(/\\[(.*)\\]/);\n\n\t\tif(assertion && assertion[1]){\n\t\t\tcharacterOffset = parseInt(termialStr.split(\"[\")[0]);\n\t\t\ttextLocationAssertion = assertion[1];\n\t\t} else {\n\t\t\tcharacterOffset = parseInt(termialStr);\n\t\t}\n\n\t\tif (!isNumber(characterOffset)) {\n\t\t\tcharacterOffset = null;\n\t\t}\n\n\t\treturn {\n\t\t\t\"offset\": characterOffset,\n\t\t\t\"assertion\": textLocationAssertion\n\t\t};\n\n\t}\n\n\tgetChapterComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\treturn indirection[0];\n\t}\n\n\tgetPathComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\tif(indirection[1]) {\n\t\t\tlet ranges = indirection[1].split(\",\");\n\t\t\treturn ranges[0];\n\t\t}\n\n\t}\n\n\tgetRange(cfiStr) {\n\n\t\tvar ranges = cfiStr.split(\",\");\n\n\t\tif(ranges.length === 3){\n\t\t\treturn [\n\t\t\t\tranges[1],\n\t\t\t\tranges[2]\n\t\t\t];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetCharecterOffsetComponent(cfiStr) {\n\t\tvar splitStr = cfiStr.split(\":\");\n\t\treturn splitStr[1] || \"\";\n\t}\n\n\tjoinSteps(steps) {\n\t\tif(!steps) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn steps.map(function(part){\n\t\t\tvar segment = \"\";\n\n\t\t\tif(part.type === \"element\") {\n\t\t\t\tsegment += (part.index + 1) * 2;\n\t\t\t}\n\n\t\t\tif(part.type === \"text\") {\n\t\t\t\tsegment += 1 + (2 * part.index); // TODO: double check that this is odd\n\t\t\t}\n\n\t\t\tif(part.id) {\n\t\t\t\tsegment += \"[\" + part.id + \"]\";\n\t\t\t}\n\n\t\t\treturn segment;\n\n\t\t}).join(\"/\");\n\n\t}\n\n\tsegmentString(segment) {\n\t\tvar segmentString = \"/\";\n\n\t\tsegmentString += this.joinSteps(segment.steps);\n\n\t\tif(segment.terminal && segment.terminal.offset != null){\n\t\t\tsegmentString += \":\" + segment.terminal.offset;\n\t\t}\n\n\t\tif(segment.terminal && segment.terminal.assertion != null){\n\t\t\tsegmentString += \"[\" + segment.terminal.assertion + \"]\";\n\t\t}\n\n\t\treturn segmentString;\n\t}\n\n\t/**\n\t * Convert CFI to a epubcfi(...) string\n\t * @returns {string} epubcfi\n\t */\n\ttoString() {\n\t\tvar cfiString = \"epubcfi(\";\n\n\t\tcfiString += this.segmentString(this.base);\n\n\t\tcfiString += \"!\";\n\t\tcfiString += this.segmentString(this.path);\n\n\t\t// Add Range, if present\n\t\tif(this.range && this.start) {\n\t\t\tcfiString += \",\";\n\t\t\tcfiString += this.segmentString(this.start);\n\t\t}\n\n\t\tif(this.range && this.end) {\n\t\t\tcfiString += \",\";\n\t\t\tcfiString += this.segmentString(this.end);\n\t\t}\n\n\t\tcfiString += \")\";\n\n\t\treturn cfiString;\n\t}\n\n\n\t/**\n\t * Compare which of two CFIs is earlier in the text\n\t * @returns {number} First is earlier = -1, Second is earlier = 1, They are equal = 0\n\t */\n\tcompare(cfiOne, cfiTwo) {\n\t\tvar stepsA, stepsB;\n\t\tvar terminalA, terminalB;\n\n\t\tvar rangeAStartSteps, rangeAEndSteps;\n\t\tvar rangeBEndSteps, rangeBEndSteps;\n\t\tvar rangeAStartTerminal, rangeAEndTerminal;\n\t\tvar rangeBStartTerminal, rangeBEndTerminal;\n\n\t\tif(typeof cfiOne === \"string\") {\n\t\t\tcfiOne = new EpubCFI(cfiOne);\n\t\t}\n\t\tif(typeof cfiTwo === \"string\") {\n\t\t\tcfiTwo = new EpubCFI(cfiTwo);\n\t\t}\n\t\t// Compare Spine Positions\n\t\tif(cfiOne.spinePos > cfiTwo.spinePos) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(cfiOne.spinePos < cfiTwo.spinePos) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (cfiOne.range) {\n\t\t\tstepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\n\t\t\tterminalA = cfiOne.start.terminal;\n\t\t} else {\n\t\t\tstepsA = cfiOne.path.steps;\n\t\t\tterminalA = cfiOne.path.terminal;\n\t\t}\n\n\t\tif (cfiTwo.range) {\n\t\t\tstepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\n\t\t\tterminalB = cfiTwo.start.terminal;\n\t\t} else {\n\t\t\tstepsB = cfiTwo.path.steps;\n\t\t\tterminalB = cfiTwo.path.terminal;\n\t\t}\n\n\t\t// Compare Each Step in the First item\n\t\tfor (var i = 0; i < stepsA.length; i++) {\n\t\t\tif(!stepsA[i]) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif(!stepsB[i]) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index > stepsB[i].index) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index < stepsB[i].index) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t// Otherwise continue checking\n\t\t}\n\n\t\t// All steps in First equal to Second and First is Less Specific\n\t\tif(stepsA.length < stepsB.length) {\n\t\t\treturn 1;\n\t\t}\n\n\t\t// Compare the charecter offset of the text node\n\t\tif(terminalA.offset > terminalB.offset) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(terminalA.offset < terminalB.offset) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// CFI's are equal\n\t\treturn 0;\n\t}\n\n\tstep(node) {\n\t\tvar nodeType = (node.nodeType === TEXT_NODE) ? \"text\" : \"element\";\n\n\t\treturn {\n\t\t\t\"id\" : node.id,\n\t\t\t\"tagName\" : node.tagName,\n\t\t\t\"type\" : nodeType,\n\t\t\t\"index\" : this.position(node)\n\t\t};\n\t}\n\n\tfilteredStep(node, ignoreClass) {\n\t\tvar filteredNode = this.filter(node, ignoreClass);\n\t\tvar nodeType;\n\n\t\t// Node filtered, so ignore\n\t\tif (!filteredNode) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise add the filter node in\n\t\tnodeType = (filteredNode.nodeType === TEXT_NODE) ? \"text\" : \"element\";\n\n\t\treturn {\n\t\t\t\"id\" : filteredNode.id,\n\t\t\t\"tagName\" : filteredNode.tagName,\n\t\t\t\"type\" : nodeType,\n\t\t\t\"index\" : this.filteredPosition(filteredNode, ignoreClass)\n\t\t};\n\t}\n\n\tpathTo(node, offset, ignoreClass) {\n\t\tvar segment = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar currentNode = node;\n\t\tvar step;\n\n\t\twhile(currentNode && currentNode.parentNode &&\n\t\t\t\t\tcurrentNode.parentNode.nodeType != DOCUMENT_NODE) {\n\n\t\t\tif (ignoreClass) {\n\t\t\t\tstep = this.filteredStep(currentNode, ignoreClass);\n\t\t\t} else {\n\t\t\t\tstep = this.step(currentNode);\n\t\t\t}\n\n\t\t\tif (step) {\n\t\t\t\tsegment.steps.unshift(step);\n\t\t\t}\n\n\t\t\tcurrentNode = currentNode.parentNode;\n\n\t\t}\n\n\t\tif (offset != null && offset >= 0) {\n\n\t\t\tsegment.terminal.offset = offset;\n\n\t\t\t// Make sure we are getting to a textNode if there is an offset\n\t\t\tif(segment.steps[segment.steps.length-1].type != \"text\") {\n\t\t\t\tsegment.steps.push({\n\t\t\t\t\t\"type\" : \"text\",\n\t\t\t\t\t\"index\" : 0\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\n\t\treturn segment;\n\t}\n\n\tequalStep(stepA, stepB) {\n\t\tif (!stepA || !stepB) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif(stepA.index === stepB.index &&\n\t\t\t stepA.id === stepB.id &&\n\t\t\t stepA.type === stepB.type) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Create a CFI object from a Range\n\t * @param {Range} range\n\t * @param {string | object} base\n\t * @param {string} [ignoreClass]\n\t * @returns {object} cfi\n\t */\n\tfromRange(range, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\n\t\tvar start = range.startContainer;\n\t\tvar end = range.endContainer;\n\n\t\tvar startOffset = range.startOffset;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar needsIgnoring = false;\n\n\t\tif (ignoreClass) {\n\t\t\t// Tell pathTo if / what to ignore\n\t\t\tneedsIgnoring = (start.ownerDocument.querySelector(\".\" + ignoreClass) != null);\n\t\t}\n\n\n\t\tif (typeof base === \"string\") {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === \"object\") {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\t\t\tcfi.path = this.pathTo(start, startOffset, ignoreClass);\n\t\t} else {\n\t\t\tcfi.range = true;\n\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.start = this.pathTo(start, startOffset, ignoreClass);\n\t\t\tif (needsIgnoring) {\n\t\t\t\tendOffset = this.patchOffset(end, endOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.end = this.pathTo(end, endOffset, ignoreClass);\n\n\t\t\t// Create a new empty path\n\t\t\tcfi.path = {\n\t\t\t\tsteps: [],\n\t\t\t\tterminal: null\n\t\t\t};\n\n\t\t\t// Push steps that are shared between start and end to the common path\n\t\t\tvar len = cfi.start.steps.length;\n\t\t\tvar i;\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\n\t\t\t\t\tif(i === len-1) {\n\t\t\t\t\t\t// Last step is equal, check terminals\n\t\t\t\t\t\tif(cfi.start.terminal === cfi.end.terminal) {\n\t\t\t\t\t\t\t// CFI's are equal\n\t\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t\t\t// Not a range\n\t\t\t\t\t\t\tcfi.range = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\n\t\t\tcfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length);\n\n\t\t\t// TODO: Add Sanity check to make sure that the end if greater than the start\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Create a CFI object from a Node\n\t * @param {Node} anchor\n\t * @param {string | object} base\n\t * @param {string} [ignoreClass]\n\t * @returns {object} cfi\n\t */\n\tfromNode(anchor, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\n\t\tif (typeof base === \"string\") {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === \"object\") {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tcfi.path = this.pathTo(anchor, null, ignoreClass);\n\n\t\treturn cfi;\n\t}\n\n\tfilter(anchor, ignoreClass) {\n\t\tvar needsIgnoring;\n\t\tvar sibling; // to join with\n\t\tvar parent, previousSibling, nextSibling;\n\t\tvar isText = false;\n\n\t\tif (anchor.nodeType === TEXT_NODE) {\n\t\t\tisText = true;\n\t\t\tparent = anchor.parentNode;\n\t\t\tneedsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\n\t\t} else {\n\t\t\tisText = false;\n\t\t\tneedsIgnoring = anchor.classList.contains(ignoreClass);\n\t\t}\n\n\t\tif (needsIgnoring && isText) {\n\t\t\tpreviousSibling = parent.previousSibling;\n\t\t\tnextSibling = parent.nextSibling;\n\n\t\t\t// If the sibling is a text node, join the nodes\n\t\t\tif (previousSibling && previousSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = previousSibling;\n\t\t\t} else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = nextSibling;\n\t\t\t}\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t} else {\n\t\t\t\t// Parent will be ignored on next step\n\t\t\t\treturn anchor;\n\t\t\t}\n\n\t\t} else if (needsIgnoring && !isText) {\n\t\t\t// Otherwise just skip the element node\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// No need to filter\n\t\t\treturn anchor;\n\t\t}\n\n\t}\n\n\tpatchOffset(anchor, offset, ignoreClass) {\n\t\tif (anchor.nodeType != TEXT_NODE) {\n\t\t\tthrow new Error(\"Anchor must be a text node\");\n\t\t}\n\n\t\tvar curr = anchor;\n\t\tvar totalOffset = offset;\n\n\t\t// If the parent is a ignored node, get offset from it's start\n\t\tif (anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\tcurr = anchor.parentNode;\n\t\t}\n\n\t\twhile (curr.previousSibling) {\n\t\t\tif(curr.previousSibling.nodeType === ELEMENT_NODE) {\n\t\t\t\t// Originally a text node, so join\n\t\t\t\tif(curr.previousSibling.classList.contains(ignoreClass)){\n\t\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t\t} else {\n\t\t\t\t\tbreak; // Normal node, dont join\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling is a text node, join the nodes\n\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t}\n\n\t\t\tcurr = curr.previousSibling;\n\t\t}\n\n\t\treturn totalOffset;\n\n\t}\n\n\tnormalizedMap(children, nodeType, ignoreClass) {\n\t\tvar output = {};\n\t\tvar prevIndex = -1;\n\t\tvar i, len = children.length;\n\t\tvar currNodeType;\n\t\tvar prevNodeType;\n\n\t\tfor (i = 0; i < len; i++) {\n\n\t\t\tcurrNodeType = children[i].nodeType;\n\n\t\t\t// Check if needs ignoring\n\t\t\tif (currNodeType === ELEMENT_NODE &&\n\t\t\t\t\tchildren[i].classList.contains(ignoreClass)) {\n\t\t\t\tcurrNodeType = TEXT_NODE;\n\t\t\t}\n\n\t\t\tif (i > 0 &&\n\t\t\t\t\tcurrNodeType === TEXT_NODE &&\n\t\t\t\t\tprevNodeType === TEXT_NODE) {\n\t\t\t\t// join text nodes\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t} else if (nodeType === currNodeType){\n\t\t\t\tprevIndex = prevIndex + 1;\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t}\n\n\t\t\tprevNodeType = currNodeType;\n\n\t\t}\n\n\t\treturn output;\n\t}\n\n\tposition(anchor) {\n\t\tvar children, index;\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tif (!children) {\n\t\t\t\tchildren = findChildren(anchor.parentNode);\n\t\t\t}\n\t\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\t\t} else {\n\t\t\tchildren = this.textNodes(anchor.parentNode);\n\t\t\tindex = children.indexOf(anchor);\n\t\t}\n\n\t\treturn index;\n\t}\n\n\tfilteredPosition(anchor, ignoreClass) {\n\t\tvar children, index, map;\n\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tmap = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\n\t\t} else {\n\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t// Inside an ignored node\n\t\t\tif(anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\t\tanchor = anchor.parentNode;\n\t\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t}\n\t\t\tmap = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\t}\n\n\n\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\n\t\treturn map[index];\n\t}\n\n\tstepsToXpath(steps) {\n\t\tvar xpath = [\".\", \"*\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\txpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\txpath.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\txpath.push(\"*[\" + position + \"]\");\n\t\t\t}\n\t\t});\n\n\t\treturn xpath.join(\"/\");\n\t}\n\n\n\t/*\n\n\tTo get the last step if needed:\n\n\t// Get the terminal step\n\tlastStep = steps[steps.length-1];\n\t// Get the query string\n\tquery = this.stepsToQuery(steps);\n\t// Find the containing element\n\tstartContainerParent = doc.querySelector(query);\n\t// Find the text node within that element\n\tif(startContainerParent && lastStep.type == \"text\") {\n\t\tcontainer = startContainerParent.childNodes[lastStep.index];\n\t}\n\t*/\n\tstepsToQuerySelector(steps) {\n\t\tvar query = [\"html\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\tquery.push(\"#\" + step.id);\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\t// unsupported in querySelector\n\t\t\t\t// query.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\tquery.push(\"*:nth-child(\" + position + \")\");\n\t\t\t}\n\t\t});\n\n\t\treturn query.join(\">\");\n\n\t}\n\n\ttextNodes(container, ignoreClass) {\n\t\treturn Array.prototype.slice.call(container.childNodes).\n\t\t\tfilter(function (node) {\n\t\t\t\tif (node.nodeType === TEXT_NODE) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (ignoreClass && node.classList.contains(ignoreClass)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t}\n\n\twalkToNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container = doc.documentElement;\n\t\tvar children;\n\t\tvar step;\n\t\tvar len = steps.length;\n\t\tvar i;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tstep = steps[i];\n\n\t\t\tif(step.type === \"element\") {\n\t\t\t\t//better to get a container using id as some times step.index may not be correct\n\t\t\t\t//For ex.https://github.com/futurepress/epub.js/issues/561\n\t\t\t\tif(step.id) {\n\t\t\t\t\tcontainer = doc.getElementById(step.id);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tchildren = container.children || findChildren(container);\n\t\t\t\t\tcontainer = children[step.index];\n\t\t\t\t}\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\tcontainer = this.textNodes(container, ignoreClass)[step.index];\n\t\t\t}\n\t\t\tif(!container) {\n\t\t\t\t//Break the for loop as due to incorrect index we can get error if\n\t\t\t\t//container is undefined so that other functionailties works fine\n\t\t\t\t//like navigation\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tfindNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container;\n\t\tvar xpath;\n\n\t\tif(!ignoreClass && typeof doc.evaluate != \"undefined\") {\n\t\t\txpath = this.stepsToXpath(steps);\n\t\t\tcontainer = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n\t\t} else if(ignoreClass) {\n\t\t\tcontainer = this.walkToNode(steps, doc, ignoreClass);\n\t\t} else {\n\t\t\tcontainer = this.walkToNode(steps, doc);\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tfixMiss(steps, offset, _doc, ignoreClass) {\n\t\tvar container = this.findNode(steps.slice(0,-1), _doc, ignoreClass);\n\t\tvar children = container.childNodes;\n\t\tvar map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\tvar child;\n\t\tvar len;\n\t\tvar lastStepIndex = steps[steps.length-1].index;\n\n\t\tfor (let childIndex in map) {\n\t\t\tif (!map.hasOwnProperty(childIndex)) return;\n\n\t\t\tif(map[childIndex] === lastStepIndex) {\n\t\t\t\tchild = children[childIndex];\n\t\t\t\tlen = child.textContent.length;\n\t\t\t\tif(offset > len) {\n\t\t\t\t\toffset = offset - len;\n\t\t\t\t} else {\n\t\t\t\t\tif (child.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tcontainer = child.childNodes[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainer = child;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tcontainer: container,\n\t\t\toffset: offset\n\t\t};\n\n\t}\n\n\t/**\n\t * Creates a DOM range representing a CFI\n\t * @param {document} _doc document referenced in the base\n\t * @param {string} [ignoreClass]\n\t * @return {Range}\n\t */\n\ttoRange(_doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar range;\n\t\tvar start, end, startContainer, endContainer;\n\t\tvar cfi = this;\n\t\tvar startSteps, endSteps;\n\t\tvar needsIgnoring = ignoreClass ? (doc.querySelector(\".\" + ignoreClass) != null) : false;\n\t\tvar missed;\n\n\t\tif (typeof(doc.createRange) !== \"undefined\") {\n\t\t\trange = doc.createRange();\n\t\t} else {\n\t\t\trange = new RangeObject();\n\t\t}\n\n\t\tif (cfi.range) {\n\t\t\tstart = cfi.start;\n\t\t\tstartSteps = cfi.path.steps.concat(start.steps);\n\t\t\tstartContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t\tend = cfi.end;\n\t\t\tendSteps = cfi.path.steps.concat(end.steps);\n\t\t\tendContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t} else {\n\t\t\tstart = cfi.path;\n\t\t\tstartSteps = cfi.path.steps;\n\t\t\tstartContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\n\t\t}\n\n\t\tif(startContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(start.terminal.offset != null) {\n\t\t\t\t\trange.setStart(startContainer, start.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setStart(startContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setStart(missed.container, missed.offset);\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(\"No startContainer found for\", this.toString());\n\t\t\t// No start found\n\t\t\treturn null;\n\t\t}\n\n\t\tif (endContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(end.terminal.offset != null) {\n\t\t\t\t\trange.setEnd(endContainer, end.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setEnd(endContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setEnd(missed.container, missed.offset);\n\t\t\t}\n\t\t}\n\n\n\t\t// doc.defaultView.getSelection().addRange(range);\n\t\treturn range;\n\t}\n\n\t/**\n\t * Check if a string is wrapped with \"epubcfi()\"\n\t * @param {string} str\n\t * @returns {boolean}\n\t */\n\tisCfiString(str) {\n\t\tif(typeof str === \"string\" &&\n\t\t\tstr.indexOf(\"epubcfi(\") === 0 &&\n\t\t\tstr[str.length-1] === \")\") {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgenerateChapterComponent(_spineNodeIndex, _pos, id) {\n\t\tvar pos = parseInt(_pos),\n\t\t\t\tspineNodeIndex = (_spineNodeIndex + 1) * 2,\n\t\t\t\tcfi = \"/\"+spineNodeIndex+\"/\";\n\n\t\tcfi += (pos + 1) * 2;\n\n\t\tif(id) {\n\t\t\tcfi += \"[\" + id + \"]\";\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Collapse a CFI Range to a single CFI Position\n\t * @param {boolean} [toStart=false]\n\t */\n\tcollapse(toStart) {\n\t\tif (!this.range) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.range = false;\n\n\t\tif (toStart) {\n\t\t\tthis.path.steps = this.path.steps.concat(this.start.steps);\n\t\t\tthis.path.terminal = this.start.terminal;\n\t\t} else {\n\t\t\tthis.path.steps = this.path.steps.concat(this.end.steps);\n\t\t\tthis.path.terminal = this.end.terminal;\n\t\t}\n\n\t}\n}\n\nexport default EpubCFI;\n","/**\n * Hooks allow for injecting functions that must all complete in order before finishing\n * They will execute in parallel but all must finish before continuing\n * Functions may return a promise if they are asycn.\n * @param {any} context scope of this\n * @example this.content = new EPUBJS.Hook(this);\n */\nclass Hook {\n\tconstructor(context){\n\t\tthis.context = context || this;\n\t\tthis.hooks = [];\n\t}\n\n\t/**\n\t * Adds a function to be run before a hook completes\n\t * @example this.content.register(function(){...});\n\t */\n\tregister(){\n\t\tfor(var i = 0; i < arguments.length; ++i) {\n\t\t\tif (typeof arguments[i]  === \"function\") {\n\t\t\t\tthis.hooks.push(arguments[i]);\n\t\t\t} else {\n\t\t\t\t// unpack array\n\t\t\t\tfor(var j = 0; j < arguments[i].length; ++j) {\n\t\t\t\t\tthis.hooks.push(arguments[i][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Removes a function\n\t * @example this.content.deregister(function(){...});\n\t */\n\tderegister(func){\n\t\tlet hook;\n\t\tfor (let i = 0; i < this.hooks.length; i++) {\n\t\t\thook = this.hooks[i];\n\t\t\tif (hook === func) {\n\t\t\t\tthis.hooks.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Triggers a hook to run all functions\n\t * @example this.content.trigger(args).then(function(){...});\n\t */\n\ttrigger(){\n\t\tvar args = arguments;\n\t\tvar context = this.context;\n\t\tvar promises = [];\n\n\t\tthis.hooks.forEach(function(task) {\n\t\t\tvar executing = task.apply(context, args);\n\n\t\t\tif(executing && typeof executing[\"then\"] === \"function\") {\n\t\t\t\t// Task is a function that returns a promise\n\t\t\t\tpromises.push(executing);\n\t\t\t}\n\t\t\t// Otherwise Task resolves immediately, continue\n\t\t});\n\n\n\t\treturn Promise.all(promises);\n\t}\n\n\t// Adds a function to be run before a hook completes\n\tlist(){\n\t\treturn this.hooks;\n\t}\n\n\tclear(){\n\t\treturn this.hooks = [];\n\t}\n}\nexport default Hook;\n","import { qs, qsa } from \"./core\";\nimport Url from \"./url\";\nimport Path from \"./path\";\n\nexport function replaceBase(doc, section){\n\tvar base;\n\tvar head;\n\tvar url = section.url;\n\tvar absolute = (url.indexOf(\"://\") > -1);\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tbase = qs(head, \"base\");\n\n\tif(!base) {\n\t\tbase = doc.createElement(\"base\");\n\t\thead.insertBefore(base, head.firstChild);\n\t}\n\n\t// Fix for Safari crashing if the url doesn't have an origin\n\tif (!absolute && window && window.location) {\n\t\turl = window.location.origin + url;\n\t}\n\n\tbase.setAttribute(\"href\", url);\n}\n\nexport function replaceCanonical(doc, section){\n\tvar head;\n\tvar link;\n\tvar url = section.canonical;\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tlink = qs(head, \"link[rel='canonical']\");\n\n\tif (link) {\n\t\tlink.setAttribute(\"href\", url);\n\t} else {\n\t\tlink = doc.createElement(\"link\");\n\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\tlink.setAttribute(\"href\", url);\n\t\thead.appendChild(link);\n\t}\n}\n\nexport function replaceMeta(doc, section){\n\tvar head;\n\tvar meta;\n\tvar id = section.idref;\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tmeta = qs(head, \"link[property='dc.identifier']\");\n\n\tif (meta) {\n\t\tmeta.setAttribute(\"content\", id);\n\t} else {\n\t\tmeta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.identifier\");\n\t\tmeta.setAttribute(\"content\", id);\n\t\thead.appendChild(meta);\n\t}\n}\n\n// TODO: move me to Contents\nexport function replaceLinks(contents, fn) {\n\n\tvar links = contents.querySelectorAll(\"a[href]\");\n\n\tif (!links.length) {\n\t\treturn;\n\t}\n\n\tvar base = qs(contents.ownerDocument, \"base\");\n\tvar location = base ? base.getAttribute(\"href\") : undefined;\n\tvar replaceLink = function(link){\n\t\tvar href = link.getAttribute(\"href\");\n\n\t\tif(href.indexOf(\"mailto:\") === 0){\n\t\t\treturn;\n\t\t}\n\n\t\tvar absolute = (href.indexOf(\"://\") > -1);\n\n\t\tif(absolute){\n\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\n\n\t\t}else{\n\t\t\tvar linkUrl;\n\t\t\ttry {\n\t\t\t\tlinkUrl = new Url(href, location);\t\n\t\t\t} catch(error) {\n\t\t\t\t// NOOP\n\t\t\t}\n\n\t\t\tlink.onclick = function(){\n\n\t\t\t\tif(linkUrl && linkUrl.hash) {\n\t\t\t\t\tfn(linkUrl.Path.path + linkUrl.hash);\n\t\t\t\t} else if(linkUrl){\n\t\t\t\t\tfn(linkUrl.Path.path);\n\t\t\t\t} else {\n\t\t\t\t\tfn(href);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t}.bind(this);\n\n\tfor (var i = 0; i < links.length; i++) {\n\t\treplaceLink(links[i]);\n\t}\n\n\n}\n\nexport function substitute(content, urls, replacements) {\n\turls.forEach(function(url, i){\n\t\tif (url && replacements[i]) {\n\t\t\tcontent = content.replace(new RegExp(url, \"g\"), replacements[i]);\n\t\t}\n\t});\n\treturn content;\n}\n","import { defer } from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Hook from \"./utils/hook\";\nimport { sprint } from \"./utils/core\";\nimport { replaceBase } from \"./utils/replacements\";\n\n/**\n * Represents a Section of the Book\n *\n * In most books this is equivelent to a Chapter\n * @param {object} item  The spine item representing the section\n * @param {object} hooks hooks for serialize and content\n */\nclass Section {\n\tconstructor(item, hooks){\n\t\tthis.idref = item.idref;\n\t\tthis.linear = item.linear === \"yes\";\n\t\tthis.properties = item.properties;\n\t\tthis.index = item.index;\n\t\tthis.href = item.href;\n\t\tthis.url = item.url;\n\t\tthis.canonical = item.canonical;\n\t\tthis.next = item.next;\n\t\tthis.prev = item.prev;\n\n\t\tthis.cfiBase = item.cfiBase;\n\n\t\tif (hooks) {\n\t\t\tthis.hooks = hooks;\n\t\t} else {\n\t\t\tthis.hooks = {};\n\t\t\tthis.hooks.serialize = new Hook(this);\n\t\t\tthis.hooks.content = new Hook(this);\n\t\t}\n\n\t\tthis.document = undefined;\n\t\tthis.contents = undefined;\n\t\tthis.output = undefined;\n\t}\n\n\t/**\n\t * Load the section from its url\n\t * @param  {method} [_request] a request method to use for loading\n\t * @return {document} a promise with the xml document\n\t */\n\tload(_request){\n\t\tvar request = _request || this.request || require(\"./utils/request\");\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(this.contents) {\n\t\t\tloading.resolve(this.contents);\n\t\t} else {\n\t\t\trequest(this.url)\n\t\t\t\t.then(function(xml){\n\t\t\t\t\t// var directory = new Url(this.url).directory;\n\n\t\t\t\t\tthis.document = xml;\n\t\t\t\t\tthis.contents = xml.documentElement;\n\n\t\t\t\t\treturn this.hooks.content.trigger(this.document, this);\n\t\t\t\t}.bind(this))\n\t\t\t\t.then(function(){\n\t\t\t\t\tloading.resolve(this.contents);\n\t\t\t\t}.bind(this))\n\t\t\t\t.catch(function(error){\n\t\t\t\t\tloading.reject(error);\n\t\t\t\t});\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\t/**\n\t * Adds a base tag for resolving urls in the section\n\t * @private\n\t */\n\tbase(){\n\t\treturn replaceBase(this.document, this);\n\t}\n\n\t/**\n\t * Render the contents of a section\n\t * @param  {method} [_request] a request method to use for loading\n\t * @return {string} output a serialized XML Document\n\t */\n\trender(_request){\n\t\tvar rendering = new defer();\n\t\tvar rendered = rendering.promise;\n\t\tthis.output; // TODO: better way to return this from hooks?\n\n\t\tthis.load(_request).\n\t\t\tthen(function(contents){\n\t\t\t\tvar userAgent = (typeof navigator !== 'undefined' && navigator.userAgent) || '';\n\t\t\t\tvar isIE = userAgent.indexOf('Trident') >= 0;\n\t\t\t\tvar Serializer;\n\t\t\t\tif (false && ( typeof XMLSerializer === \"undefined\" || isIE)) {\n\t\t\t\t\tSerializer = require(\"xmldom/dom-parser\").XMLSerializer;\n\t\t\t\t} else {\n\t\t\t\t\tSerializer = XMLSerializer;\n\t\t\t\t}\n\t\t\t\tvar serializer = new Serializer();\n\t\t\t\tthis.output = serializer.serializeToString(contents);\n\t\t\t\treturn this.output;\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\treturn this.hooks.serialize.trigger(this.output, this);\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\trendering.resolve(this.output);\n\t\t\t}.bind(this))\n\t\t\t.catch(function(error){\n\t\t\t\trendering.reject(error);\n\t\t\t});\n\n\t\treturn rendered;\n\t}\n\n\t/**\n\t * Find a string in a section\n\t * @param  {string} _query The query string to find\n\t * @return {object[]} A list of matches, with form {cfi, excerpt}\n\t */\n\tfind(_query){\n\t\tvar section = this;\n\t\tvar matches = [];\n\t\tvar query = _query.toLowerCase();\n\t\tvar find = function(node){\n\t\t\tvar text = node.textContent.toLowerCase();\n\t\t\tvar range = section.document.createRange();\n\t\t\tvar cfi;\n\t\t\tvar pos;\n\t\t\tvar last = -1;\n\t\t\tvar excerpt;\n\t\t\tvar limit = 150;\n\n\t\t\twhile (pos != -1) {\n\t\t\t\t// Search for the query\n\t\t\t\tpos = text.indexOf(query, last + 1);\n\n\t\t\t\tif (pos != -1) {\n\t\t\t\t\t// We found it! Generate a CFI\n\t\t\t\t\trange = section.document.createRange();\n\t\t\t\t\trange.setStart(node, pos);\n\t\t\t\t\trange.setEnd(node, pos + query.length);\n\n\t\t\t\t\tcfi = section.cfiFromRange(range);\n\n\t\t\t\t\t// Generate the excerpt\n\t\t\t\t\tif (node.textContent.length < limit) {\n\t\t\t\t\t\texcerpt = node.textContent;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\texcerpt = node.textContent.substring(pos - limit/2, pos + limit/2);\n\t\t\t\t\t\texcerpt = \"...\" + excerpt + \"...\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add the CFI to the matches list\n\t\t\t\t\tmatches.push({\n\t\t\t\t\t\tcfi: cfi,\n\t\t\t\t\t\texcerpt: excerpt\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlast = pos;\n\t\t\t}\n\t\t};\n\n\t\tsprint(section.document, function(node) {\n\t\t\tfind(node);\n\t\t});\n\n\t\treturn matches;\n\t};\n\n\t/**\n\t* Reconciles the current chapters layout properies with\n\t* the global layout properities.\n\t* @param {object} globalLayout  The global layout settings object, chapter properties string\n\t* @return {object} layoutProperties Object with layout properties\n\t*/\n\treconcileLayoutSettings(globalLayout){\n\t\t//-- Get the global defaults\n\t\tvar settings = {\n\t\t\tlayout : globalLayout.layout,\n\t\t\tspread : globalLayout.spread,\n\t\t\torientation : globalLayout.orientation\n\t\t};\n\n\t\t//-- Get the chapter's display type\n\t\tthis.properties.forEach(function(prop){\n\t\t\tvar rendition = prop.replace(\"rendition:\", \"\");\n\t\t\tvar split = rendition.indexOf(\"-\");\n\t\t\tvar property, value;\n\n\t\t\tif(split != -1){\n\t\t\t\tproperty = rendition.slice(0, split);\n\t\t\t\tvalue = rendition.slice(split+1);\n\n\t\t\t\tsettings[property] = value;\n\t\t\t}\n\t\t});\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Get a CFI from a Range in the Section\n\t * @param  {range} _range\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromRange(_range) {\n\t\treturn new EpubCFI(_range, this.cfiBase).toString();\n\t}\n\n\t/**\n\t * Get a CFI from an Element in the Section\n\t * @param  {element} el\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromElement(el) {\n\t\treturn new EpubCFI(el, this.cfiBase).toString();\n\t}\n\n\t/**\n\t * Unload the section document\n\t */\n\tunload() {\n\t\tthis.document = undefined;\n\t\tthis.contents = undefined;\n\t\tthis.output = undefined;\n\t}\n\n\tdestroy() {\n\t\tthis.unload();\n\t\tthis.hooks.serialize.clear();\n\t\tthis.hooks.content.clear();\n\n\t\tthis.hooks = undefined;\n\t\tthis.idref = undefined;\n\t\tthis.linear = undefined;\n\t\tthis.properties = undefined;\n\t\tthis.index = undefined;\n\t\tthis.href = undefined;\n\t\tthis.url = undefined;\n\t\tthis.next = undefined;\n\t\tthis.prev = undefined;\n\n\t\tthis.cfiBase = undefined;\n\t}\n}\n\nexport default Section;\n","import EpubCFI from \"./epubcfi\";\nimport Hook from \"./utils/hook\";\nimport Section from \"./section\";\nimport {replaceBase, replaceCanonical, replaceMeta} from \"./utils/replacements\";\n\n/**\n * A collection of Spine Items\n */\nclass Spine {\n\tconstructor() {\n\t\tthis.spineItems = [];\n\t\tthis.spineByHref = {};\n\t\tthis.spineById = {};\n\n\t\tthis.hooks = {};\n\t\tthis.hooks.serialize = new Hook();\n\t\tthis.hooks.content = new Hook();\n\n\t\t// Register replacements\n\t\tthis.hooks.content.register(replaceBase);\n\t\tthis.hooks.content.register(replaceCanonical);\n\t\tthis.hooks.content.register(replaceMeta);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.loaded = false;\n\n\t\tthis.items = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.baseUrl = undefined;\n\t\tthis.length = undefined;\n\t}\n\n\t/**\n\t * Unpack items from a opf into spine items\n\t * @param  {Packaging} _package\n\t * @param  {method} resolver URL resolver\n\t * @param  {method} canonical Resolve canonical url\n\t */\n\tunpack(_package, resolver, canonical) {\n\n\t\tthis.items = _package.spine;\n\t\tthis.manifest = _package.manifest;\n\t\tthis.spineNodeIndex = _package.spineNodeIndex;\n\t\tthis.baseUrl = _package.baseUrl || _package.basePath || \"\";\n\t\tthis.length = this.items.length;\n\n\t\tthis.items.forEach( (item, index) => {\n\t\t\tvar manifestItem = this.manifest[item.idref];\n\t\t\tvar spineItem;\n\n\t\t\titem.index = index;\n\t\t\titem.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\n\n\t\t\tif (item.href) {\n\t\t\t\titem.url = resolver(item.href, true);\n\t\t\t\titem.canonical = canonical(item.href);\n\t\t\t}\n\n\t\t\tif(manifestItem) {\n\t\t\t\titem.href = manifestItem.href;\n\t\t\t\titem.url = resolver(item.href, true);\n\t\t\t\titem.canonical = canonical(item.href);\n\n\t\t\t\tif(manifestItem.properties.length){\n\t\t\t\t\titem.properties.push.apply(item.properties, manifestItem.properties);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.linear === \"yes\") {\n\t\t\t\titem.prev = function() {\n\t\t\t\t\tlet prevIndex = item.index;\n\t\t\t\t\twhile (prevIndex > 0) {\n\t\t\t\t\t\tlet prev = this.get(prevIndex-1);\n\t\t\t\t\t\tif (prev && prev.linear) {\n\t\t\t\t\t\t\treturn prev;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprevIndex -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}.bind(this);\n\t\t\t\titem.next = function() {\n\t\t\t\t\tlet nextIndex = item.index;\n\t\t\t\t\twhile (nextIndex < this.spineItems.length-1) {\n\t\t\t\t\t\tlet next = this.get(nextIndex+1);\n\t\t\t\t\t\tif (next && next.linear) {\n\t\t\t\t\t\t\treturn next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}.bind(this);\n\t\t\t} else {\n\t\t\t\titem.prev = function() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\titem.next = function() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tspineItem = new Section(item, this.hooks);\n\n\t\t\tthis.append(spineItem);\n\n\n\t\t});\n\n\t\tthis.loaded = true;\n\t}\n\n\t/**\n\t * Get an item from the spine\n\t * @param  {string|number} [target]\n\t * @return {Section} section\n\t * @example spine.get();\n\t * @example spine.get(1);\n\t * @example spine.get(\"chap1.html\");\n\t * @example spine.get(\"#id1234\");\n\t */\n\tget(target) {\n\t\tvar index = 0;\n\n\t\tif (typeof target === \"undefined\") {\n\t\t\twhile (index < this.spineItems.length) {\n\t\t\t\tlet next = this.spineItems[index];\n\t\t\t\tif (next && next.linear) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tindex += 1;\n\t\t\t}\n\t\t} else if(this.epubcfi.isCfiString(target)) {\n\t\t\tlet cfi = new EpubCFI(target);\n\t\t\tindex = cfi.spinePos;\n\t\t} else if(typeof target === \"number\" || isNaN(target) === false){\n\t\t\tindex = target;\n\t\t} else if(typeof target === \"string\" && target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.spineById[target.substring(1)];\n\t\t} else if(typeof target === \"string\") {\n\t\t\t// Remove fragments\n\t\t\ttarget = target.split(\"#\")[0];\n\t\t\tindex = this.spineByHref[target] || this.spineByHref[encodeURI(target)];\n\t\t}\n\n\t\treturn this.spineItems[index] || null;\n\t}\n\n\t/**\n\t * Append a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tappend(section) {\n\t\tvar index = this.spineItems.length;\n\t\tsection.index = index;\n\n\t\tthis.spineItems.push(section);\n\n\t\t// Encode and Decode href lookups\n\t\t// see pr for details: https://github.com/futurepress/epub.js/pull/358\n\t\tthis.spineByHref[decodeURI(section.href)] = index;\n\t\tthis.spineByHref[encodeURI(section.href)] = index;\n\t\tthis.spineByHref[section.href] = index;\n\n\t\tthis.spineById[section.idref] = index;\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Prepend a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tprepend(section) {\n\t\t// var index = this.spineItems.unshift(section);\n\t\tthis.spineByHref[section.href] = 0;\n\t\tthis.spineById[section.idref] = 0;\n\n\t\t// Re-index\n\t\tthis.spineItems.forEach(function(item, index){\n\t\t\titem.index = index;\n\t\t});\n\n\t\treturn 0;\n\t}\n\n\t// insert(section, index) {\n\t//\n\t// };\n\n\t/**\n\t * Remove a Section from the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tremove(section) {\n\t\tvar index = this.spineItems.indexOf(section);\n\n\t\tif(index > -1) {\n\t\t\tdelete this.spineByHref[section.href];\n\t\t\tdelete this.spineById[section.idref];\n\n\t\t\treturn this.spineItems.splice(index, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Loop over the Sections in the Spine\n\t * @return {method} forEach\n\t */\n\teach() {\n\t\treturn this.spineItems.forEach.apply(this.spineItems, arguments);\n\t}\n\n\t/**\n\t * Find the first Section in the Spine\n\t * @return {Section} first section\n\t */\n\tfirst() {\n\t\tlet index = 0;\n\n\t\tdo {\n\t\t\tlet next = this.get(index);\n\n\t\t\tif (next && next.linear) {\n\t\t\t\treturn next;\n\t\t\t}\n\t\t\tindex += 1;\n\t\t} while (index < this.spineItems.length) ;\n\t}\n\n\t/**\n\t * Find the last Section in the Spine\n\t * @return {Section} last section\n\t */\n\tlast() {\n\t\tlet index = this.spineItems.length-1;\n\n\t\tdo {\n\t\t\tlet prev = this.get(index);\n\t\t\tif (prev && prev.linear) {\n\t\t\t\treturn prev;\n\t\t\t}\n\t\t\tindex -= 1;\n\t\t} while (index >= 0);\n\t}\n\n\tdestroy() {\n\t\tthis.each((section) => section.destroy());\n\n\t\tthis.spineItems = undefined\n\t\tthis.spineByHref = undefined\n\t\tthis.spineById = undefined\n\n\t\tthis.hooks.serialize.clear();\n\t\tthis.hooks.content.clear();\n\t\tthis.hooks = undefined;\n\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.loaded = false;\n\n\t\tthis.items = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.baseUrl = undefined;\n\t\tthis.length = undefined;\n\t}\n}\n\nexport default Spine;\n","import {defer, requestAnimationFrame} from \"./core\";\n\n/**\n * Queue for handling tasks one at a time\n * @class\n * @param {scope} context what this will resolve to in the tasks\n */\nclass Queue {\n\tconstructor(context){\n\t\tthis._q = [];\n\t\tthis.context = context;\n\t\tthis.tick = requestAnimationFrame;\n\t\tthis.running = false;\n\t\tthis.paused = false;\n\t}\n\n\t/**\n\t * Add an item to the queue\n\t * @return {Promise}\n\t */\n\tenqueue() {\n\t\tvar deferred, promise;\n\t\tvar queued;\n\t\tvar task = [].shift.call(arguments);\n\t\tvar args = arguments;\n\n\t\t// Handle single args without context\n\t\t// if(args && !Array.isArray(args)) {\n\t\t//   args = [args];\n\t\t// }\n\t\tif(!task) {\n\t\t\tthrow new Error(\"No Task Provided\");\n\t\t}\n\n\t\tif(typeof task === \"function\"){\n\n\t\t\tdeferred = new defer();\n\t\t\tpromise = deferred.promise;\n\n\t\t\tqueued = {\n\t\t\t\t\"task\" : task,\n\t\t\t\t\"args\"     : args,\n\t\t\t\t//\"context\"  : context,\n\t\t\t\t\"deferred\" : deferred,\n\t\t\t\t\"promise\" : promise\n\t\t\t};\n\n\t\t} else {\n\t\t\t// Task is a promise\n\t\t\tqueued = {\n\t\t\t\t\"promise\" : task\n\t\t\t};\n\n\t\t}\n\n\t\tthis._q.push(queued);\n\n\t\t// Wait to start queue flush\n\t\tif (this.paused == false && !this.running) {\n\t\t\t// setTimeout(this.flush.bind(this), 0);\n\t\t\t// this.tick.call(window, this.run.bind(this));\n\t\t\tthis.run();\n\t\t}\n\n\t\treturn queued.promise;\n\t}\n\n\t/**\n\t * Run one item\n\t * @return {Promise}\n\t */\n\tdequeue(){\n\t\tvar inwait, task, result;\n\n\t\tif(this._q.length && !this.paused) {\n\t\t\tinwait = this._q.shift();\n\t\t\ttask = inwait.task;\n\t\t\tif(task){\n\t\t\t\t// console.log(task)\n\n\t\t\t\tresult = task.apply(this.context, inwait.args);\n\n\t\t\t\tif(result && typeof result[\"then\"] === \"function\") {\n\t\t\t\t\t// Task is a function that returns a promise\n\t\t\t\t\treturn result.then(function(){\n\t\t\t\t\t\tinwait.deferred.resolve.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this), function() {\n\t\t\t\t\t\tinwait.deferred.reject.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else {\n\t\t\t\t\t// Task resolves immediately\n\t\t\t\t\tinwait.deferred.resolve.apply(this.context, result);\n\t\t\t\t\treturn inwait.promise;\n\t\t\t\t}\n\n\n\n\t\t\t} else if(inwait.promise) {\n\t\t\t\t// Task is a promise\n\t\t\t\treturn inwait.promise;\n\t\t\t}\n\n\t\t} else {\n\t\t\tinwait = new defer();\n\t\t\tinwait.deferred.resolve();\n\t\t\treturn inwait.promise;\n\t\t}\n\n\t}\n\n\t// Run All Immediately\n\tdump(){\n\t\twhile(this._q.length) {\n\t\t\tthis.dequeue();\n\t\t}\n\t}\n\n\t/**\n\t * Run all tasks sequentially, at convince\n\t * @return {Promise}\n\t */\n\trun(){\n\n\t\tif(!this.running){\n\t\t\tthis.running = true;\n\t\t\tthis.defered = new defer();\n\t\t}\n\n\t\tthis.tick.call(window, () => {\n\n\t\t\tif(this._q.length) {\n\n\t\t\t\tthis.dequeue()\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tthis.run();\n\t\t\t\t\t}.bind(this));\n\n\t\t\t} else {\n\t\t\t\tthis.defered.resolve();\n\t\t\t\tthis.running = undefined;\n\t\t\t}\n\n\t\t});\n\n\t\t// Unpause\n\t\tif(this.paused == true) {\n\t\t\tthis.paused = false;\n\t\t}\n\n\t\treturn this.defered.promise;\n\t}\n\n\t/**\n\t * Flush all, as quickly as possible\n\t * @return {Promise}\n\t */\n\tflush(){\n\n\t\tif(this.running){\n\t\t\treturn this.running;\n\t\t}\n\n\t\tif(this._q.length) {\n\t\t\tthis.running = this.dequeue()\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.running = undefined;\n\t\t\t\t\treturn this.flush();\n\t\t\t\t}.bind(this));\n\n\t\t\treturn this.running;\n\t\t}\n\n\t}\n\n\t/**\n\t * Clear all items in wait\n\t */\n\tclear(){\n\t\tthis._q = [];\n\t}\n\n\t/**\n\t * Get the number of tasks in the queue\n\t * @return {number} tasks\n\t */\n\tlength(){\n\t\treturn this._q.length;\n\t}\n\n\t/**\n\t * Pause a running queue\n\t */\n\tpause(){\n\t\tthis.paused = true;\n\t}\n\n\t/**\n\t * End the queue\n\t */\n\tstop(){\n\t\tthis._q = [];\n\t\tthis.running = false;\n\t\tthis.paused = true;\n\t}\n}\n\n\n/**\n * Create a new task from a callback\n * @class\n * @private\n * @param {function} task\n * @param {array} args\n * @param {scope} context\n * @return {function} task\n */\nclass Task {\n\tconstructor(task, args, context){\n\n\t\treturn function(){\n\t\t\tvar toApply = arguments || [];\n\n\t\t\treturn new Promise( (resolve, reject) => {\n\t\t\t\tvar callback = function(value, err){\n\t\t\t\t\tif (!value && err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t// Add the callback to the arguments list\n\t\t\t\ttoApply.push(callback);\n\n\t\t\t\t// Apply all arguments to the functions\n\t\t\t\ttask.apply(context || this, toApply);\n\n\t\t\t});\n\n\t\t};\n\n\t}\n}\n\n\nexport default Queue;\nexport { Task };\n","export const EPUBJS_VERSION = \"0.3\";\n\n// Dom events to listen for\nexport const DOM_EVENTS = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\", \"touchmove\"];\n\nexport const EVENTS = {\n  BOOK : {\n    OPEN_FAILED : \"openFailed\"\n  },\n  CONTENTS : {\n    EXPAND : \"expand\",\n    RESIZE : \"resize\",\n    SELECTED : \"selected\",\n    SELECTED_RANGE : \"selectedRange\",\n    LINK_CLICKED : \"linkClicked\"\n  },\n  LOCATIONS : {\n    CHANGED : \"changed\"\n  },\n  MANAGERS : {\n    RESIZE : \"resize\",\n    RESIZED : \"resized\",\n    ORIENTATION_CHANGE : \"orientationchange\",\n    ADDED : \"added\",\n    SCROLL : \"scroll\",\n    SCROLLED : \"scrolled\",\n    REMOVED : \"removed\",\n  },\n  VIEWS : {\n    AXIS : \"axis\",\n    LOAD_ERROR : \"loaderror\",\n    RENDERED : \"rendered\",\n    RESIZED : \"resized\",\n    DISPLAYED : \"displayed\",\n    SHOWN : \"shown\",\n    HIDDEN : \"hidden\",\n    MARK_CLICKED : \"markClicked\"\n  },\n  RENDITION : {\n    STARTED : \"started\",\n    ATTACHED : \"attached\",\n    DISPLAYED : \"displayed\",\n    DISPLAY_ERROR : \"displayerror\",\n    RENDERED : \"rendered\",\n    REMOVED : \"removed\",\n    RESIZED : \"resized\",\n    ORIENTATION_CHANGE : \"orientationchange\",\n    LOCATION_CHANGED : \"locationChanged\",\n    RELOCATED : \"relocated\",\n    MARK_CLICKED : \"markClicked\",\n    SELECTED : \"selected\",\n    LAYOUT: \"layout\"\n  },\n  LAYOUT : {\n    UPDATED : \"updated\"\n  }\n}\n","import {qs, sprint, locationOf, defer} from \"./utils/core\";\nimport Queue from \"./utils/queue\";\nimport EpubCFI from \"./epubcfi\";\nimport { EVENTS } from \"./utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Find Locations for a Book\n * @param {Spine} spine\n * @param {request} request\n * @param {number} [pause=100]\n */\nclass Locations {\n\tconstructor(spine, request, pause) {\n\t\tthis.spine = spine;\n\t\tthis.request = request;\n\t\tthis.pause = pause || 100;\n\n\t\tthis.q = new Queue(this);\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis._locations = [];\n\t\tthis.total = 0;\n\n\t\tthis.break = 150;\n\n\t\tthis._current = 0;\n\n\t\tthis.currentLocation = '';\n\t\tthis._currentCfi ='';\n\t\tthis.processingTimeout = undefined;\n\t}\n\n\t/**\n\t * Load all of sections in the book to generate locations\n\t * @param  {int} chars how many chars to split on\n\t * @return {object} locations\n\t */\n\tgenerate(chars) {\n\n\t\tif (chars) {\n\t\t\tthis.break = chars;\n\t\t}\n\n\t\tthis.q.pause();\n\n\t\tthis.spine.each(function(section) {\n\t\t\tif (section.linear) {\n\t\t\t\tthis.q.enqueue(this.process.bind(this), section);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn this.q.run().then(function() {\n\t\t\tthis.total = this._locations.length - 1;\n\n\t\t\tif (this._currentCfi) {\n\t\t\t\tthis.currentLocation = this._currentCfi;\n\t\t\t}\n\n\t\t\treturn this._locations;\n\t\t\t// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\n\t\t}.bind(this));\n\n\t}\n\n\tcreateRange () {\n\t\treturn {\n\t\t\tstartContainer: undefined,\n\t\t\tstartOffset: undefined,\n\t\t\tendContainer: undefined,\n\t\t\tendOffset: undefined\n\t\t};\n\t}\n\n\tprocess(section) {\n\n\t\treturn section.load(this.request)\n\t\t\t.then(function(contents) {\n\t\t\t\tvar completed = new defer();\n\t\t\t\tvar locations = this.parse(contents, section.cfiBase);\n\t\t\t\tthis._locations = this._locations.concat(locations);\n\n\t\t\t\tsection.unload();\n\n\t\t\t\tthis.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\n\t\t\t\treturn completed.promise;\n\t\t\t}.bind(this));\n\n\t}\n\n\tparse(contents, cfiBase, chars) {\n\t\tvar locations = [];\n\t\tvar range;\n\t\tvar doc = contents.ownerDocument;\n\t\tvar body = qs(doc, \"body\");\n\t\tvar counter = 0;\n\t\tvar prev;\n\t\tvar _break = chars || this.break;\n\t\tvar parser = function(node) {\n\t\t\tvar len = node.length;\n\t\t\tvar dist;\n\t\t\tvar pos = 0;\n\n\t\t\tif (node.textContent.trim().length === 0) {\n\t\t\t\treturn false; // continue\n\t\t\t}\n\n\t\t\t// Start range\n\t\t\tif (counter == 0) {\n\t\t\t\trange = this.createRange();\n\t\t\t\trange.startContainer = node;\n\t\t\t\trange.startOffset = 0;\n\t\t\t}\n\n\t\t\tdist = _break - counter;\n\n\t\t\t// Node is smaller than a break,\n\t\t\t// skip over it\n\t\t\tif(dist > len){\n\t\t\t\tcounter += len;\n\t\t\t\tpos = len;\n\t\t\t}\n\n\n\t\t\twhile (pos < len) {\n\t\t\t\tdist = _break - counter;\n\n\t\t\t\tif (counter === 0) {\n\t\t\t\t\t// Start new range\n\t\t\t\t\tpos += 1;\n\t\t\t\t\trange = this.createRange();\n\t\t\t\t\trange.startContainer = node;\n\t\t\t\t\trange.startOffset = pos;\n\t\t\t\t}\n\n\t\t\t\t// pos += dist;\n\n\t\t\t\t// Gone over\n\t\t\t\tif(pos + dist >= len){\n\t\t\t\t\t// Continue counter for next node\n\t\t\t\t\tcounter += len - pos;\n\t\t\t\t\t// break\n\t\t\t\t\tpos = len;\n\t\t\t\t// At End\n\t\t\t\t} else {\n\t\t\t\t\t// Advance pos\n\t\t\t\t\tpos += dist;\n\n\t\t\t\t\t// End the previous range\n\t\t\t\t\trange.endContainer = node;\n\t\t\t\t\trange.endOffset = pos;\n\t\t\t\t\t// cfi = section.cfiFromRange(range);\n\t\t\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\t\t\tlocations.push(cfi);\n\t\t\t\t\tcounter = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprev = node;\n\t\t};\n\n\t\tsprint(body, parser.bind(this));\n\n\t\t// Close remaining\n\t\tif (range && range.startContainer && prev) {\n\t\t\trange.endContainer = prev;\n\t\t\trange.endOffset = prev.length;\n\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\tlocations.push(cfi);\n\t\t\tcounter = 0;\n\t\t}\n\n\t\treturn locations;\n\t}\n\n\t/**\n\t * Get a location from an EpubCFI\n\t * @param {EpubCFI} cfi\n\t * @return {number}\n\t */\n\tlocationFromCfi(cfi){\n\t\tlet loc;\n\t\tif (EpubCFI.prototype.isCfiString(cfi)) {\n\t\t\tcfi = new EpubCFI(cfi);\n\t\t}\n\t\t// Check if the location has not been set yet\n\t\tif(this._locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tloc = locationOf(cfi, this._locations, this.epubcfi.compare);\n\n\t\tif (loc > this.total) {\n\t\t\treturn this.total;\n\t\t}\n\n\t\treturn loc;\n\t}\n\n\t/**\n\t * Get a percentage position in locations from an EpubCFI\n\t * @param {EpubCFI} cfi\n\t * @return {number}\n\t */\n\tpercentageFromCfi(cfi) {\n\t\tif(this._locations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\t\t// Find closest cfi\n\t\tvar loc = this.locationFromCfi(cfi);\n\t\t// Get percentage in total\n\t\treturn this.percentageFromLocation(loc);\n\t}\n\n\t/**\n\t * Get a percentage position from a location index\n\t * @param {number} location\n\t * @return {number}\n\t */\n\tpercentageFromLocation(loc) {\n\t\tif (!loc || !this.total) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn (loc / this.total);\n\t}\n\n\t/**\n\t * Get an EpubCFI from location index\n\t * @param {number} loc\n\t * @return {EpubCFI} cfi\n\t */\n\tcfiFromLocation(loc){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof loc != \"number\"){\n\t\t\tloc = parseInt(loc);\n\t\t}\n\n\t\tif(loc >= 0 && loc < this._locations.length) {\n\t\t\tcfi = this._locations[loc];\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Get an EpubCFI from location percentage\n\t * @param {number} percentage\n\t * @return {EpubCFI} cfi\n\t */\n\tcfiFromPercentage(percentage){\n\t\tlet loc;\n\t\tif (percentage > 1) {\n\t\t\tconsole.warn(\"Normalize cfiFromPercentage value to between 0 - 1\");\n\t\t}\n\n\t\t// Make sure 1 goes to very end\n\t\tif (percentage >= 1) {\n\t\t\tlet cfi = new EpubCFI(this._locations[this.total]);\n\t\t\tcfi.collapse();\n\t\t\treturn cfi.toString();\n\t\t}\n\n\t\tloc = Math.ceil(this.total * percentage);\n\t\treturn this.cfiFromLocation(loc);\n\t}\n\n\t/**\n\t * Load locations from JSON\n\t * @param {json} locations\n\t */\n\tload(locations){\n\t\tif (typeof locations === \"string\") {\n\t\t\tthis._locations = JSON.parse(locations);\n\t\t} else {\n\t\t\tthis._locations = locations;\n\t\t}\n\t\tthis.total = this._locations.length - 1;\n\t\treturn this._locations;\n\t}\n\n\t/**\n\t * Save locations to JSON\n\t * @return {json}\n\t */\n\tsave(){\n\t\treturn JSON.stringify(this._locations);\n\t}\n\n\tgetCurrent(){\n\t\treturn this._current;\n\t}\n\n\tsetCurrent(curr){\n\t\tvar loc;\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tthis._currentCfi = curr;\n\t\t} else if (typeof curr == \"number\") {\n\t\t\tthis._current = curr;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._locations.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tloc = this.locationFromCfi(curr);\n\t\t\tthis._current = loc;\n\t\t} else {\n\t\t\tloc = curr;\n\t\t}\n\n\t\tthis.emit(EVENTS.LOCATIONS.CHANGED, {\n\t\t\tpercentage: this.percentageFromLocation(loc)\n\t\t});\n\t}\n\n\t/**\n\t * Get the current location\n\t */\n\tget currentLocation() {\n\t\treturn this._current;\n\t}\n\n\t/**\n\t * Set the current location\n\t */\n\tset currentLocation(curr) {\n\t\tthis.setCurrent(curr);\n\t}\n\n\t/**\n\t * Locations length\n\t */\n\tlength () {\n\t\treturn this._locations.length;\n\t}\n\n\tdestroy () {\n\t\tthis.spine = undefined;\n\t\tthis.request = undefined;\n\t\tthis.pause = undefined;\n\n\t\tthis.q.stop();\n\t\tthis.q = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis._locations = undefined\n\t\tthis.total = undefined;\n\n\t\tthis.break = undefined;\n\t\tthis._current = undefined;\n\n\t\tthis.currentLocation = undefined;\n\t\tthis._currentCfi = undefined;\n\t\tclearTimeout(this.processingTimeout);\n\t}\n}\n\nEventEmitter(Locations.prototype);\n\nexport default Locations;\n","import path from \"path-webpack\";\nimport {qs} from \"./utils/core\";\n\n/**\n * Handles Parsing and Accessing an Epub Container\n * @class\n * @param {document} [containerDocument] xml document\n */\nclass Container {\n\tconstructor(containerDocument) {\n\t\tthis.packagePath = '';\n\t\tthis.directory = '';\n\t\tthis.encoding = '';\n\n\t\tif (containerDocument) {\n\t\t\tthis.parse(containerDocument);\n\t\t}\n\t}\n\n\t/**\n\t * Parse the Container XML\n\t * @param  {document} containerDocument\n\t */\n\tparse(containerDocument){\n\t\t//-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\n\t\tvar rootfile;\n\n\t\tif(!containerDocument) {\n\t\t\tthrow new Error(\"Container File Not Found\");\n\t\t}\n\n\t\trootfile = qs(containerDocument, \"rootfile\");\n\n\t\tif(!rootfile) {\n\t\t\tthrow new Error(\"No RootFile Found\");\n\t\t}\n\n\t\tthis.packagePath = rootfile.getAttribute(\"full-path\");\n\t\tthis.directory = path.dirname(this.packagePath);\n\t\tthis.encoding = containerDocument.xmlEncoding;\n\t}\n\n\tdestroy() {\n\t\tthis.packagePath = undefined;\n\t\tthis.directory = undefined;\n\t\tthis.encoding = undefined;\n\t}\n}\n\nexport default Container;\n","import {qs, qsa, qsp, indexOfElementNode} from \"./utils/core\";\n\n/**\n * Open Packaging Format Parser\n * @class\n * @param {document} packageDocument OPF XML\n */\nclass Packaging {\n\tconstructor(packageDocument) {\n\t\tthis.manifest = {};\n\t\tthis.navPath = '';\n\t\tthis.ncxPath = '';\n\t\tthis.coverPath = '';\n\t\tthis.spineNodeIndex = 0;\n\t\tthis.spine = [];\n\t\tthis.metadata = {};\n\n\t\tif (packageDocument) {\n\t\t\tthis.parse(packageDocument);\n\t\t}\n\t}\n\n\t/**\n\t * Parse OPF XML\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tparse(packageDocument){\n\t\tvar metadataNode, manifestNode, spineNode;\n\n\t\tif(!packageDocument) {\n\t\t\tthrow new Error(\"Package File Not Found\");\n\t\t}\n\n\t\tmetadataNode = qs(packageDocument, \"metadata\");\n\t\tif(!metadataNode) {\n\t\t\tthrow new Error(\"No Metadata Found\");\n\t\t}\n\n\t\tmanifestNode = qs(packageDocument, \"manifest\");\n\t\tif(!manifestNode) {\n\t\t\tthrow new Error(\"No Manifest Found\");\n\t\t}\n\n\t\tspineNode = qs(packageDocument, \"spine\");\n\t\tif(!spineNode) {\n\t\t\tthrow new Error(\"No Spine Found\");\n\t\t}\n\n\t\tthis.manifest = this.parseManifest(manifestNode);\n\t\tthis.navPath = this.findNavPath(manifestNode);\n\t\tthis.ncxPath = this.findNcxPath(manifestNode, spineNode);\n\t\tthis.coverPath = this.findCoverPath(packageDocument);\n\n\t\tthis.spineNodeIndex = indexOfElementNode(spineNode);\n\n\t\tthis.spine = this.parseSpine(spineNode, this.manifest);\n\n\t\tthis.uniqueIdentifier = this.findUniqueIdentifier(packageDocument);\n\t\tthis.metadata = this.parseMetadata(metadataNode);\n\n\t\tthis.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\n\n\n\t\treturn {\n\t\t\t\"metadata\" : this.metadata,\n\t\t\t\"spine\"    : this.spine,\n\t\t\t\"manifest\" : this.manifest,\n\t\t\t\"navPath\"  : this.navPath,\n\t\t\t\"ncxPath\"  : this.ncxPath,\n\t\t\t\"coverPath\": this.coverPath,\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex\n\t\t};\n\t}\n\n\t/**\n\t * Parse Metadata\n\t * @private\n\t * @param  {node} xml\n\t * @return {object} metadata\n\t */\n\tparseMetadata(xml){\n\t\tvar metadata = {};\n\n\t\tmetadata.title = this.getElementText(xml, \"title\");\n\t\tmetadata.creator = this.getElementText(xml, \"creator\");\n\t\tmetadata.description = this.getElementText(xml, \"description\");\n\n\t\tmetadata.pubdate = this.getElementText(xml, \"date\");\n\n\t\tmetadata.publisher = this.getElementText(xml, \"publisher\");\n\n\t\tmetadata.identifier = this.getElementText(xml, \"identifier\");\n\t\tmetadata.language = this.getElementText(xml, \"language\");\n\t\tmetadata.rights = this.getElementText(xml, \"rights\");\n\n\t\tmetadata.modified_date = this.getPropertyText(xml, \"dcterms:modified\");\n\n\t\tmetadata.layout = this.getPropertyText(xml, \"rendition:layout\");\n\t\tmetadata.orientation = this.getPropertyText(xml, \"rendition:orientation\");\n\t\tmetadata.flow = this.getPropertyText(xml, \"rendition:flow\");\n\t\tmetadata.viewport = this.getPropertyText(xml, \"rendition:viewport\");\n\t\tmetadata.media_active_class = this.getPropertyText(xml, \"media:active-class\");\n\t\t// metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\n\n\t\treturn metadata;\n\t}\n\n\t/**\n\t * Parse Manifest\n\t * @private\n\t * @param  {node} manifestXml\n\t * @return {object} manifest\n\t */\n\tparseManifest(manifestXml){\n\t\tvar manifest = {};\n\n\t\t//-- Turn items into an array\n\t\t// var selected = manifestXml.querySelectorAll(\"item\");\n\t\tvar selected = qsa(manifestXml, \"item\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t//-- Create an object with the id as key\n\t\titems.forEach(function(item){\n\t\t\tvar id = item.getAttribute(\"id\"),\n\t\t\t\t\thref = item.getAttribute(\"href\") || \"\",\n\t\t\t\t\ttype = item.getAttribute(\"media-type\") || \"\",\n\t\t\t\t\toverlay = item.getAttribute(\"media-overlay\") || \"\",\n\t\t\t\t\tproperties = item.getAttribute(\"properties\") || \"\";\n\n\t\t\tmanifest[id] = {\n\t\t\t\t\"href\" : href,\n\t\t\t\t// \"url\" : href,\n\t\t\t\t\"type\" : type,\n\t\t\t\t\"overlay\" : overlay,\n\t\t\t\t\"properties\" : properties.length ? properties.split(\" \") : []\n\t\t\t};\n\n\t\t});\n\n\t\treturn manifest;\n\n\t}\n\n\t/**\n\t * Parse Spine\n\t * @private\n\t * @param  {node} spineXml\n\t * @param  {Packaging.manifest} manifest\n\t * @return {object} spine\n\t */\n\tparseSpine(spineXml, manifest){\n\t\tvar spine = [];\n\n\t\tvar selected = qsa(spineXml, \"itemref\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t// var epubcfi = new EpubCFI();\n\n\t\t//-- Add to array to mantain ordering and cross reference with manifest\n\t\titems.forEach(function(item, index){\n\t\t\tvar idref = item.getAttribute(\"idref\");\n\t\t\t// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\n\t\t\tvar props = item.getAttribute(\"properties\") || \"\";\n\t\t\tvar propArray = props.length ? props.split(\" \") : [];\n\t\t\t// var manifestProps = manifest[Id].properties;\n\t\t\t// var manifestPropArray = manifestProps.length ? manifestProps.split(\" \") : [];\n\n\t\t\tvar itemref = {\n\t\t\t\t\"idref\" : idref,\n\t\t\t\t\"linear\" : item.getAttribute(\"linear\") || \"yes\",\n\t\t\t\t\"properties\" : propArray,\n\t\t\t\t// \"href\" : manifest[Id].href,\n\t\t\t\t// \"url\" :  manifest[Id].url,\n\t\t\t\t\"index\" : index\n\t\t\t\t// \"cfiBase\" : cfiBase\n\t\t\t};\n\t\t\tspine.push(itemref);\n\t\t});\n\n\t\treturn spine;\n\t}\n\n\t/**\n\t * Find Unique Identifier\n\t * @private\n\t * @param  {node} packageXml\n\t * @return {string} Unique Identifier text\n\t */\n\tfindUniqueIdentifier(packageXml){\n\t\tvar uniqueIdentifierId = packageXml.documentElement.getAttribute(\"unique-identifier\");\n\t\tif (! uniqueIdentifierId) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar identifier = packageXml.getElementById(uniqueIdentifierId);\n\t\tif (! identifier) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (identifier.localName === \"identifier\" && identifier.namespaceURI === \"http://purl.org/dc/elements/1.1/\") {\n\t\t\treturn identifier.childNodes[0].nodeValue.trim();\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Find TOC NAV\n\t * @private\n\t * @param {element} manifestNode\n\t * @return {string}\n\t */\n\tfindNavPath(manifestNode){\n\t\t// Find item with property \"nav\"\n\t\t// Should catch nav irregardless of order\n\t\t// var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"properties\":\"nav\"});\n\t\treturn node ? node.getAttribute(\"href\") : false;\n\t}\n\n\t/**\n\t * Find TOC NCX\n\t * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\n\t * @private\n\t * @param {element} manifestNode\n\t * @param {element} spineNode\n\t * @return {string}\n\t */\n\tfindNcxPath(manifestNode, spineNode){\n\t\t// var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"media-type\":\"application/x-dtbncx+xml\"});\n\t\tvar tocId;\n\n\t\t// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\n\t\t// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\n\t\t// \"The item that describes the NCX must be referenced by the spine toc attribute.\"\n\t\tif (!node) {\n\t\t\ttocId = spineNode.getAttribute(\"toc\");\n\t\t\tif(tocId) {\n\t\t\t\t// node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\n\t\t\t\tnode = manifestNode.querySelector(`#${tocId}`);\n\t\t\t}\n\t\t}\n\n\t\treturn node ? node.getAttribute(\"href\") : false;\n\t}\n\n\t/**\n\t * Find the Cover Path\n\t * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\n\t * Fallback for Epub 2.0\n\t * @private\n\t * @param  {node} packageXml\n\t * @return {string} href\n\t */\n\tfindCoverPath(packageXml){\n\t\tvar pkg = qs(packageXml, \"package\");\n\t\tvar epubVersion = pkg.getAttribute(\"version\");\n\n\t\tif (epubVersion === \"2.0\") {\n\t\t\tvar metaCover = qsp(packageXml, \"meta\", {\"name\":\"cover\"});\n\t\t\tif (metaCover) {\n\t\t\t\tvar coverId = metaCover.getAttribute(\"content\");\n\t\t\t\t// var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\n\t\t\t\tvar cover = packageXml.getElementById(coverId);\n\t\t\t\treturn cover ? cover.getAttribute(\"href\") : \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// var node = packageXml.querySelector(\"item[properties='cover-image']\");\n\t\t\tvar node = qsp(packageXml, \"item\", {\"properties\":\"cover-image\"});\n\t\t\treturn node ? node.getAttribute(\"href\") : \"\";\n\t\t}\n\t}\n\n\t/**\n\t * Get text of a namespaced element\n\t * @private\n\t * @param  {node} xml\n\t * @param  {string} tag\n\t * @return {string} text\n\t */\n\tgetElementText(xml, tag){\n\t\tvar found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag);\n\t\tvar el;\n\n\t\tif(!found || found.length === 0) return \"\";\n\n\t\tel = found[0];\n\n\t\tif(el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn \"\";\n\n\t}\n\n\t/**\n\t * Get text by property\n\t * @private\n\t * @param  {node} xml\n\t * @param  {string} property\n\t * @return {string} text\n\t */\n\tgetPropertyText(xml, property){\n\t\tvar el = qsp(xml, \"meta\", {\"property\":property});\n\n\t\tif(el && el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Load JSON Manifest\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tload(json) {\n\t\tthis.metadata = json.metadata;\n\n\t\tlet spine = json.readingOrder || json.spine;\n\t\tthis.spine = spine.map((item, index) =>{\n\t\t\titem.index = index;\n\t\t\treturn item;\n\t\t});\n\n\t\tjson.resources.forEach((item, index) => {\n\t\t\tthis.manifest[index] = item;\n\n\t\t\tif (item.rel && item.rel[0] === \"cover\") {\n\t\t\t\tthis.coverPath = item.href;\n\t\t\t}\n\t\t});\n\n\t\tthis.spineNodeIndex = 0;\n\n\t\tthis.toc = json.toc.map((item, index) =>{\n\t\t\titem.label = item.title;\n\t\t\treturn item;\n\t\t});\n\n\t\treturn {\n\t\t\t\"metadata\" : this.metadata,\n\t\t\t\"spine\"    : this.spine,\n\t\t\t\"manifest\" : this.manifest,\n\t\t\t\"navPath\"  : this.navPath,\n\t\t\t\"ncxPath\"  : this.ncxPath,\n\t\t\t\"coverPath\": this.coverPath,\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex,\n\t\t\t\"toc\" : this.toc\n\t\t};\n\t}\n\n\tdestroy() {\n\t\tthis.manifest = undefined;\n\t\tthis.navPath = undefined;\n\t\tthis.ncxPath = undefined;\n\t\tthis.coverPath = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.spine = undefined;\n\t\tthis.metadata = undefined;\n\t}\n}\n\nexport default Packaging;\n","import {qs, qsa, querySelectorByType, filterChildren, getParentByTagName} from \"./utils/core\";\n\n/**\n * Navigation Parser\n * @param {document} xml navigation html / xhtml / ncx\n */\nclass Navigation {\n\tconstructor(xml) {\n\t\tthis.toc = [];\n\t\tthis.tocByHref = {};\n\t\tthis.tocById = {};\n\n\t\tthis.landmarks = [];\n\t\tthis.landmarksByType = {};\n\n\t\tthis.length = 0;\n\t\tif (xml) {\n\t\t\tthis.parse(xml);\n\t\t}\n\t}\n\n\t/**\n\t * Parse out the navigation items\n\t * @param {document} xml navigation html / xhtml / ncx\n\t */\n\tparse(xml) {\n\t\tlet isXml = xml.nodeType;\n\t\tlet html;\n\t\tlet ncx;\n\n\t\tif (isXml) {\n\t\t\thtml = qs(xml, \"html\");\n\t\t\tncx = qs(xml, \"ncx\");\n\t\t}\n\n\t\tif (!isXml) {\n\t\t\tthis.toc = this.load(xml);\n\t\t} else if(html) {\n\t\t\tthis.toc = this.parseNav(xml);\n\t\t\tthis.landmarks = this.parseLandmarks(xml);\n\t\t} else if(ncx){\n\t\t\tthis.toc = this.parseNcx(xml);\n\t\t}\n\n\t\tthis.length = 0;\n\n\t\tthis.unpack(this.toc);\n\t}\n\n\t/**\n\t * Unpack navigation items\n\t * @private\n\t * @param  {array} toc\n\t */\n\tunpack(toc) {\n\t\tvar item;\n\n\t\tfor (var i = 0; i < toc.length; i++) {\n\t\t\titem = toc[i];\n\n\t\t\tif (item.href) {\n\t\t\t\tthis.tocByHref[item.href] = i;\n\t\t\t}\n\n\t\t\tif (item.id) {\n\t\t\t\tthis.tocById[item.id] = i;\n\t\t\t}\n\n\t\t\tthis.length++;\n\n\t\t\tif (item.subitems.length) {\n\t\t\t\tthis.unpack(item.subitems);\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/**\n\t * Get an item from the navigation\n\t * @param  {string} target\n\t * @return {object} navItem\n\t */\n\tget(target) {\n\t\tvar index;\n\n\t\tif(!target) {\n\t\t\treturn this.toc;\n\t\t}\n\n\t\tif(target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.tocById[target.substring(1)];\n\t\t} else if(target in this.tocByHref){\n\t\t\tindex = this.tocByHref[target];\n\t\t}\n\n\t\treturn this.toc[index];\n\t}\n\n\t/**\n\t * Get a landmark by type\n\t * List of types: https://idpf.github.io/epub-vocabs/structure/\n\t * @param  {string} type\n\t * @return {object} landmarkItem\n\t */\n\tlandmark(type) {\n\t\tvar index;\n\n\t\tif(!type) {\n\t\t\treturn this.landmarks;\n\t\t}\n\n\t\tindex = this.landmarksByType[type];\n\n\t\treturn this.landmarks[index];\n\t}\n\n\t/**\n\t * Parse toc from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"toc\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.navItem(navItems[i]);\n\t\t\tif (item) {\n\t\t\t\ttoc[item.id] = item;\n\t\t\t\tif(!item.parent) {\n\t\t\t\t\tlist.push(item);\n\t\t\t\t} else {\n\t\t\t\t\tparent = toc[item.parent];\n\t\t\t\t\tparent.subitems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a navItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} navItem\n\t */\n\tnavItem(item){\n\t\tlet id = item.getAttribute(\"id\") || undefined;\n\t\tlet content = filterChildren(item, \"a\", true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet src = content.getAttribute(\"href\") || \"\";\n\t\t\n\t\tif (!id) {\n\t\t\tid = src;\n\t\t}\n\t\tlet text = content.textContent || \"\";\n\t\tlet html = content.innerHTML;\n\t\tlet subitems = [];\n\t\tlet parentItem = getParentByTagName(item, \"li\");\n\t\tlet parent;\n\n\t\tif (parentItem) {\n\t\t\tparent = parentItem.getAttribute(\"id\");\n\t\t\tif (!parent) {\n\t\t\t\tconst parentContent = filterChildren(parentItem, \"a\", true);\n\t\t\t\tparent = parentContent && parentContent.getAttribute(\"href\");\n      \t\t\t}\n\t\t}\n\n\t\twhile (!parent && parentItem) {\n\t\t\tparentItem = getParentByTagName(parentItem, \"li\");\n\t\t\tif (parentItem) {\n\t\t\t\tparent = parentItem.getAttribute(\"id\");\n\t\t\t\tif (!parent) {\n\t\t\t\t\tconst parentContent = filterChildren(parentItem, \"a\", true);\n          \t\t\t\tparent = parentContent && parentContent.getAttribute(\"href\");\n        \t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"html\": html,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t}\n\n\t/**\n\t * Parse landmarks from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} landmarks list\n\t */\n\tparseLandmarks(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"landmarks\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.landmarkItem(navItems[i]);\n\t\t\tif (item) {\n\t\t\t\tlist.push(item);\n\t\t\t\tthis.landmarksByType[item.type] = i;\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a landmarkItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} landmarkItem\n\t */\n\tlandmarkItem(item){\n\t\tlet content = filterChildren(item, \"a\", true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet type = content.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") || undefined;\n\t\tlet href = content.getAttribute(\"href\") || \"\";\n\t\tlet text = content.textContent || \"\";\n\n\t\treturn {\n\t\t\t\"href\": href,\n\t\t\t\"label\": text,\n\t\t\t\"type\" : type\n\t\t};\n\t}\n\n\t/**\n\t * Parse from a Epub > 3.0 NC\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNcx(tocXml){\n\t\tvar navPoints = qsa(tocXml, \"navPoint\");\n\t\tvar length = navPoints.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navPoints || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.ncxItem(navPoints[i]);\n\t\t\ttoc[item.id] = item;\n\t\t\tif(!item.parent) {\n\t\t\t\tlist.push(item);\n\t\t\t} else {\n\t\t\t\tparent = toc[item.parent];\n\t\t\t\tparent.subitems.push(item);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a ncxItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} ncxItem\n\t */\n\tncxItem(item){\n\t\tvar id = item.getAttribute(\"id\") || false,\n\t\t\t\tcontent = qs(item, \"content\"),\n\t\t\t\tsrc = content.getAttribute(\"src\"),\n\t\t\t\tnavLabel = qs(item, \"navLabel\"),\n\t\t\t\ttext = navLabel.textContent ? navLabel.textContent : \"\",\n\t\t\t\tsubitems = [],\n\t\t\t\tparentNode = item.parentNode,\n\t\t\t\tparent;\n\n\t\tif(parentNode && (parentNode.nodeName === \"navPoint\" || parentNode.nodeName.split(':').slice(-1)[0] === \"navPoint\")) {\n\t\t\tparent = parentNode.getAttribute(\"id\");\n\t\t}\n\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t}\n\n\t/**\n\t * Load Spine Items\n\t * @param  {object} json the items to be loaded\n\t * @return {Array} navItems\n\t */\n\tload(json) {\n\t\treturn json.map(item => {\n\t\t\titem.label = item.title;\n\t\t\titem.subitems = item.children ? this.load(item.children) : [];\n\t\t\treturn item;\n\t\t});\n\t}\n\n\t/**\n\t * forEach pass through\n\t * @param  {Function} fn function to run on each item\n\t * @return {method} forEach loop\n\t */\n\tforEach(fn) {\n\t\treturn this.toc.forEach(fn);\n\t}\n}\n\nexport default Navigation;\n","/*\n From Zip.js, by Gildas Lormeau\nedited down\n */\n\nvar table = {\n\t\"application\" : {\n\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\n\t\t\"javascript\" : \"js\",\n\t\t\"ogg\" : \"ogx\",\n\t\t\"pdf\" : \"pdf\",\n\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\n\t\t\"rdf+xml\" : \"rdf\",\n\t\t\"smil\" : [ \"smi\", \"smil\" ],\n\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\n\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\" ],\n\t\t\"zip\" : \"zip\",\n\t\t\"x-httpd-eruby\" : \"rhtml\",\n\t\t\"x-latex\" : \"latex\",\n\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\n\t\t\"x-object\" : \"o\",\n\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\n\t\t\"x-silverlight\" : \"scr\",\n\t\t\"epub+zip\" : \"epub\",\n\t\t\"font-tdpfr\" : \"pfr\",\n\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\n\t\t\"json\" : \"json\",\n\t\t\"jsonml+json\" : \"jsonml\",\n\t\t\"mathml+xml\" : \"mathml\",\n\t\t\"metalink+xml\" : \"metalink\",\n\t\t\"mp4\" : \"mp4s\",\n\t\t// \"oebps-package+xml\" : \"opf\",\n\t\t\"omdoc+xml\" : \"omdoc\",\n\t\t\"oxps\" : \"oxps\",\n\t\t\"vnd.amazon.ebook\" : \"azw\",\n\t\t\"widget\" : \"wgt\",\n\t\t// \"x-dtbncx+xml\" : \"ncx\",\n\t\t\"x-dtbook+xml\" : \"dtb\",\n\t\t\"x-dtbresource+xml\" : \"res\",\n\t\t\"x-font-bdf\" : \"bdf\",\n\t\t\"x-font-ghostscript\" : \"gsf\",\n\t\t\"x-font-linux-psf\" : \"psf\",\n\t\t\"x-font-otf\" : \"otf\",\n\t\t\"x-font-pcf\" : \"pcf\",\n\t\t\"x-font-snf\" : \"snf\",\n\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\n\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\n\t\t\"x-font-woff\" : \"woff\",\n\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\n\t\t\"x-mspublisher\" : \"pub\",\n\t\t\"x-nzb\" : \"nzb\",\n\t\t\"x-tgif\" : \"obj\",\n\t\t\"xaml+xml\" : \"xaml\",\n\t\t\"xml-dtd\" : \"dtd\",\n\t\t\"xproc+xml\" : \"xpl\",\n\t\t\"xslt+xml\" : \"xslt\",\n\t\t\"internet-property-stream\" : \"acx\",\n\t\t\"x-compress\" : \"z\",\n\t\t\"x-compressed\" : \"tgz\",\n\t\t\"x-gzip\" : \"gz\",\n\t},\n\t\"audio\" : {\n\t\t\"flac\" : \"flac\",\n\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\n\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\n\t\t\"mpegurl\" : \"m3u\",\n\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\n\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\n\t\t\"x-ms-wma\" : \"wma\",\n\t\t\"x-wav\" : \"wav\",\n\t\t\"adpcm\" : \"adp\",\n\t\t\"mp4\" : \"mp4a\",\n\t\t\"webm\" : \"weba\",\n\t\t\"x-aac\" : \"aac\",\n\t\t\"x-caf\" : \"caf\",\n\t\t\"x-matroska\" : \"mka\",\n\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\n\t\t\"xm\" : \"xm\",\n\t\t\"mid\" : [ \"mid\", \"rmi\" ]\n\t},\n\t\"image\" : {\n\t\t\"gif\" : \"gif\",\n\t\t\"ief\" : \"ief\",\n\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\n\t\t\"pcx\" : \"pcx\",\n\t\t\"png\" : \"png\",\n\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\n\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\n\t\t\"x-icon\" : \"ico\",\n\t\t\"bmp\" : \"bmp\",\n\t\t\"webp\" : \"webp\",\n\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\n\t\t\"x-tga\" : \"tga\",\n\t\t\"cis-cod\" : \"cod\"\n\t},\n\t\"text\" : {\n\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\n\t\t\"css\" : \"css\",\n\t\t\"csv\" : \"csv\",\n\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\n\t\t\"mathml\" : \"mml\",\n\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\n\t\t\"richtext\" : \"rtx\",\n\t\t\"tab-separated-values\" : \"tsv\",\n\t\t\"x-bibtex\" : \"bib\"\n\t},\n\t\"video\" : {\n\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\n\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\n\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\n\t\t\"ogg\" : \"ogv\",\n\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\n\t\t\"x-flv\" : \"flv\",\n\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\n\t\t\"x-mng\" : \"mng\",\n\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\n\t\t\"x-ms-wm\" : \"wm\",\n\t\t\"x-ms-wmv\" : \"wmv\",\n\t\t\"x-ms-wmx\" : \"wmx\",\n\t\t\"x-ms-wvx\" : \"wvx\",\n\t\t\"x-msvideo\" : \"avi\",\n\t\t\"x-sgi-movie\" : \"movie\",\n\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\n\t\t\"3gpp2\" : \"3g2\",\n\t\t\"h261\" : \"h261\",\n\t\t\"h263\" : \"h263\",\n\t\t\"h264\" : \"h264\",\n\t\t\"jpeg\" : \"jpgv\",\n\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\n\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\n\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\n\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\n\t\t\"vnd.vivo\" : \"viv\",\n\t\t\"webm\" : \"webm\",\n\t\t\"x-f4v\" : \"f4v\",\n\t\t\"x-m4v\" : \"m4v\",\n\t\t\"x-ms-vob\" : \"vob\",\n\t\t\"x-smv\" : \"smv\"\n\t}\n};\n\nvar mimeTypes = (function() {\n\tvar type, subtype, val, index, mimeTypes = {};\n\tfor (type in table) {\n\t\tif (table.hasOwnProperty(type)) {\n\t\t\tfor (subtype in table[type]) {\n\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\n\t\t\t\t\tval = table[type][subtype];\n\t\t\t\t\tif (typeof val == \"string\") {\n\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\n\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn mimeTypes;\n})();\n\nvar defaultValue = \"text/plain\";//\"application/octet-stream\";\n\nfunction lookup(filename) {\n\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\n};\n\nmodule.exports = {\n\t'lookup': lookup\n}\n","import {substitute} from \"./utils/replacements\";\nimport {createBase64Url, createBlobUrl, blob2base64} from \"./utils/core\";\nimport Url from \"./utils/url\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\nimport path from \"path-webpack\";\n\n/**\n * Handle Package Resources\n * @class\n * @param {Manifest} manifest\n * @param {object} [options]\n * @param {string} [options.replacements=\"base64\"]\n * @param {Archive} [options.archive]\n * @param {method} [options.resolver]\n */\nclass Resources {\n\tconstructor(manifest, options) {\n\t\tthis.settings = {\n\t\t\treplacements: (options && options.replacements) || \"base64\",\n\t\t\tarchive: (options && options.archive),\n\t\t\tresolver: (options && options.resolver),\n\t\t\trequest: (options && options.request)\n\t\t};\n\n\t\tthis.process(manifest);\n\t}\n\n\t/**\n\t * Process resources\n\t * @param {Manifest} manifest\n\t */\n\tprocess(manifest){\n\t\tthis.manifest = manifest;\n\t\tthis.resources = Object.keys(manifest).\n\t\t\tmap(function (key){\n\t\t\t\treturn manifest[key];\n\t\t\t});\n\n\t\tthis.replacementUrls = [];\n\n\t\tthis.html = [];\n\t\tthis.assets = [];\n\t\tthis.css = [];\n\n\t\tthis.urls = [];\n\t\tthis.cssUrls = [];\n\n\t\tthis.split();\n\t\tthis.splitUrls();\n\t}\n\n\t/**\n\t * Split resources by type\n\t * @private\n\t */\n\tsplit(){\n\n\t\t// HTML\n\t\tthis.html = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"application/xhtml+xml\" ||\n\t\t\t\t\t\titem.type === \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Exclude HTML\n\t\tthis.assets = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type !== \"application/xhtml+xml\" &&\n\t\t\t\t\t\titem.type !== \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Only CSS\n\t\tthis.css = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"text/css\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Convert split resources into Urls\n\t * @private\n\t */\n\tsplitUrls(){\n\n\t\t// All Assets Urls\n\t\tthis.urls = this.assets.\n\t\t\tmap(function(item) {\n\t\t\t\treturn item.href;\n\t\t\t}.bind(this));\n\n\t\t// Css Urls\n\t\tthis.cssUrls = this.css.map(function(item) {\n\t\t\treturn item.href;\n\t\t});\n\n\t}\n\n\t/**\n\t * Create a url to a resource\n\t * @param {string} url\n\t * @return {Promise<string>} Promise resolves with url string\n\t */\n\tcreateUrl (url) {\n\t\tvar parsedUrl = new Url(url);\n\t\tvar mimeType = mime.lookup(parsedUrl.filename);\n\n\t\tif (this.settings.archive) {\n\t\t\treturn this.settings.archive.createUrl(url, {\"base64\": (this.settings.replacements === \"base64\")});\n\t\t} else {\n\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\treturn this.settings.request(url, 'blob')\n\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\treturn blob2base64(blob);\n\t\t\t\t\t})\n\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\treturn createBase64Url(blob, mimeType);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn this.settings.request(url, 'blob').then((blob) => {\n\t\t\t\t\treturn createBlobUrl(blob, mimeType);\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Create blob urls for all the assets\n\t * @return {Promise}         returns replacement urls\n\t */\n\treplacements(){\n\t\tif (this.settings.replacements === \"none\") {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve(this.urls);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tvar replacements = this.urls.\n\t\t\tmap( (url) => {\n\t\t\t\tvar absolute = this.settings.resolver(url);\n\n\t\t\t\treturn this.createUrl(absolute).\n\t\t\t\t\tcatch((err) => {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t});\n\n\t\treturn Promise.all(replacements)\n\t\t\t.then( (replacementUrls) => {\n\t\t\t\tthis.replacementUrls = replacementUrls.filter((url) => {\n\t\t\t\t\treturn (typeof(url) === \"string\");\n\t\t\t\t});\n\t\t\t\treturn replacementUrls;\n\t\t\t});\n\t}\n\n\t/**\n\t * Replace URLs in CSS resources\n\t * @private\n\t * @param  {Archive} [archive]\n\t * @param  {method} [resolver]\n\t * @return {Promise}\n\t */\n\treplaceCss(archive, resolver){\n\t\tvar replaced = [];\n\t\tarchive = archive || this.settings.archive;\n\t\tresolver = resolver || this.settings.resolver;\n\t\tthis.cssUrls.forEach(function(href) {\n\t\t\tvar replacement = this.createCssFile(href, archive, resolver)\n\t\t\t\t.then(function (replacementUrl) {\n\t\t\t\t\t// switch the url in the replacementUrls\n\t\t\t\t\tvar indexInUrls = this.urls.indexOf(href);\n\t\t\t\t\tif (indexInUrls > -1) {\n\t\t\t\t\t\tthis.replacementUrls[indexInUrls] = replacementUrl;\n\t\t\t\t\t}\n\t\t\t\t}.bind(this))\n\n\n\t\t\treplaced.push(replacement);\n\t\t}.bind(this));\n\t\treturn Promise.all(replaced);\n\t}\n\n\t/**\n\t * Create a new CSS file with the replaced URLs\n\t * @private\n\t * @param  {string} href the original css file\n\t * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\n\t */\n\tcreateCssFile(href){\n\t\tvar newUrl;\n\n\t\tif (path.isAbsolute(href)) {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tvar absolute = this.settings.resolver(href);\n\n\t\t// Get the text of the css file from the archive\n\t\tvar textResponse;\n\n\t\tif (this.settings.archive) {\n\t\t\ttextResponse = this.settings.archive.getText(absolute);\n\t\t} else {\n\t\t\ttextResponse = this.settings.request(absolute, \"text\");\n\t\t}\n\n\t\t// Get asset links relative to css file\n\t\tvar relUrls = this.urls.map( (assetHref) => {\n\t\t\tvar resolved = this.settings.resolver(assetHref);\n\t\t\tvar relative = new Path(absolute).relative(resolved);\n\n\t\t\treturn relative;\n\t\t});\n\n\t\tif (!textResponse) {\n\t\t\t// file not found, don't replace\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\treturn textResponse.then( (text) => {\n\t\t\t// Replacements in the css text\n\t\t\ttext = substitute(text, relUrls, this.replacementUrls);\n\n\t\t\t// Get the new url\n\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\tnewUrl = createBase64Url(text, \"text/css\");\n\t\t\t} else {\n\t\t\t\tnewUrl = createBlobUrl(text, \"text/css\");\n\t\t\t}\n\n\t\t\treturn newUrl;\n\t\t}, (err) => {\n\t\t\t// handle response errors\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t}\n\n\t/**\n\t * Resolve all resources URLs relative to an absolute URL\n\t * @param  {string} absolute to be resolved to\n\t * @param  {resolver} [resolver]\n\t * @return {string[]} array with relative Urls\n\t */\n\trelativeTo(absolute, resolver){\n\t\tresolver = resolver || this.settings.resolver;\n\n\t\t// Get Urls relative to current sections\n\t\treturn this.urls.\n\t\t\tmap(function(href) {\n\t\t\t\tvar resolved = resolver(href);\n\t\t\t\tvar relative = new Path(absolute).relative(resolved);\n\t\t\t\treturn relative;\n\t\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get a URL for a resource\n\t * @param  {string} path\n\t * @return {string} url\n\t */\n\tget(path) {\n\t\tvar indexInUrls = this.urls.indexOf(path);\n\t\tif (indexInUrls === -1) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.replacementUrls.length) {\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tresolve(this.replacementUrls[indexInUrls]);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\treturn this.createUrl(path);\n\t\t}\n\t}\n\n\t/**\n\t * Substitute urls in content, with replacements,\n\t * relative to a url if provided\n\t * @param  {string} content\n\t * @param  {string} [url]   url to resolve to\n\t * @return {string}         content with urls substituted\n\t */\n\tsubstitute(content, url) {\n\t\tvar relUrls;\n\t\tif (url) {\n\t\t\trelUrls = this.relativeTo(url);\n\t\t} else {\n\t\t\trelUrls = this.urls;\n\t\t}\n\t\treturn substitute(content, relUrls, this.replacementUrls);\n\t}\n\n\tdestroy() {\n\t\tthis.settings = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.resources = undefined;\n\t\tthis.replacementUrls = undefined;\n\t\tthis.html = undefined;\n\t\tthis.assets = undefined;\n\t\tthis.css = undefined;\n\n\t\tthis.urls = undefined;\n\t\tthis.cssUrls = undefined;\n\t}\n}\n\nexport default Resources;\n","import EpubCFI from \"./epubcfi\";\nimport {\n\tqs,\n\tqsa,\n\tquerySelectorByType,\n\tindexOfSorted,\n\tlocationOf\n} from \"./utils/core\";\n\n/**\n * Page List Parser\n * @param {document} [xml]\n */\nclass PageList {\n\tconstructor(xml) {\n\t\tthis.pages = [];\n\t\tthis.locations = [];\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.firstPage = 0;\n\t\tthis.lastPage = 0;\n\t\tthis.totalPages = 0;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\n\t\tif (xml) {\n\t\t\tthis.pageList = this.parse(xml);\n\t\t}\n\n\t\tif(this.pageList && this.pageList.length) {\n\t\t\tthis.process(this.pageList);\n\t\t}\n\t}\n\n\t/**\n\t * Parse PageList Xml\n\t * @param  {document} xml\n\t */\n\tparse(xml) {\n\t\tvar html = qs(xml, \"html\");\n\t\tvar ncx = qs(xml, \"ncx\");\n\n\t\tif(html) {\n\t\t\treturn this.parseNav(xml);\n\t\t} else if(ncx){ // Not supported\n\t\t\t// return this.parseNcx(xml);\n\t\t\treturn;\n\t\t}\n\n\t}\n\n\t/**\n\t * Parse a Nav PageList\n\t * @private\n\t * @param  {node} navHtml\n\t * @return {PageList.item[]} list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"page-list\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.item(navItems[i]);\n\t\t\tlist.push(item);\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Page List Item\n\t * @private\n\t * @param  {node} item\n\t * @return {object} pageListItem\n\t */\n\titem(item){\n\t\tvar content = qs(item, \"a\"),\n\t\t\t\thref = content.getAttribute(\"href\") || \"\",\n\t\t\t\ttext = content.textContent || \"\",\n\t\t\t\tpage = parseInt(text),\n\t\t\t\tisCfi = href.indexOf(\"epubcfi\"),\n\t\t\t\tsplit,\n\t\t\t\tpackageUrl,\n\t\t\t\tcfi;\n\n\t\tif(isCfi != -1) {\n\t\t\tsplit = href.split(\"#\");\n\t\t\tpackageUrl = split[0];\n\t\t\tcfi = split.length > 1 ? split[1] : false;\n\t\t\treturn {\n\t\t\t\t\"cfi\" : cfi,\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"packageUrl\" : packageUrl,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Process pageList items\n\t * @private\n\t * @param  {array} pageList\n\t */\n\tprocess(pageList){\n\t\tpageList.forEach(function(item){\n\t\t\tthis.pages.push(item.page);\n\t\t\tif (item.cfi) {\n\t\t\t\tthis.locations.push(item.cfi);\n\t\t\t}\n\t\t}, this);\n\t\tthis.firstPage = parseInt(this.pages[0]);\n\t\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\n\t\tthis.totalPages = this.lastPage - this.firstPage;\n\t}\n\n\t/**\n\t * Get a PageList result from a EpubCFI\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} page\n\t */\n\tpageFromCfi(cfi){\n\t\tvar pg = -1;\n\n\t\t// Check if the pageList has not been set yet\n\t\tif(this.locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// TODO: check if CFI is valid?\n\n\t\t// check if the cfi is in the location list\n\t\t// var index = this.locations.indexOf(cfi);\n\t\tvar index = indexOfSorted(cfi, this.locations, this.epubcfi.compare);\n\t\tif(index != -1) {\n\t\t\tpg = this.pages[index];\n\t\t} else {\n\t\t\t// Otherwise add it to the list of locations\n\t\t\t// Insert it in the correct position in the locations page\n\t\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\n\t\t\tindex = locationOf(cfi, this.locations, this.epubcfi.compare);\n\t\t\t// Get the page at the location just before the new one, or return the first\n\t\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\n\t\t\tif(pg !== undefined) {\n\t\t\t\t// Add the new page in so that the locations and page array match up\n\t\t\t\t//this.pages.splice(index, 0, pg);\n\t\t\t} else {\n\t\t\t\tpg = -1;\n\t\t\t}\n\n\t\t}\n\t\treturn pg;\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Page List Item\n\t * @param  {string | number} pg\n\t * @return {string} cfi\n\t */\n\tcfiFromPage(pg){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof pg != \"number\"){\n\t\t\tpg = parseInt(pg);\n\t\t}\n\n\t\t// check if the cfi is in the page list\n\t\t// Pages could be unsorted.\n\t\tvar index = this.pages.indexOf(pg);\n\t\tif(index != -1) {\n\t\t\tcfi = this.locations[index];\n\t\t}\n\t\t// TODO: handle pages not in the list\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Get a Page from Book percentage\n\t * @param  {number} percent\n\t * @return {number} page\n\t */\n\tpageFromPercentage(percent){\n\t\tvar pg = Math.round(this.totalPages * percent);\n\t\treturn pg;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a page\n\t * @param  {number} pg the page\n\t * @return {number} percentage\n\t */\n\tpercentageFromPage(pg){\n\t\tvar percentage = (pg - this.firstPage) / this.totalPages;\n\t\treturn Math.round(percentage * 1000) / 1000;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a cfi\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} percentage\n\t */\n\tpercentageFromCfi(cfi){\n\t\tvar pg = this.pageFromCfi(cfi);\n\t\tvar percentage = this.percentageFromPage(pg);\n\t\treturn percentage;\n\t}\n\n\t/**\n\t * Destroy\n\t */\n\tdestroy() {\n\t\tthis.pages = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.pageList = undefined;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\t}\n}\n\nexport default PageList;\n","import { extend } from \"./utils/core\";\nimport { EVENTS } from \"./utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Figures out the CSS values to apply for a layout\n * @class\n * @param {object} settings\n * @param {string} [settings.layout='reflowable']\n * @param {string} [settings.spread]\n * @param {number} [settings.minSpreadWidth=800]\n * @param {boolean} [settings.evenSpreads=false]\n */\nclass Layout {\n\tconstructor(settings) {\n\t\tthis.settings = settings;\n\t\tthis.name = settings.layout || \"reflowable\";\n\t\tthis._spread = (settings.spread === \"none\") ? false : true;\n\t\tthis._minSpreadWidth = settings.minSpreadWidth || 800;\n\t\tthis._evenSpreads = settings.evenSpreads || false;\n\n\t\tif (settings.flow === \"scrolled\" ||\n\t\t\t\tsettings.flow === \"scrolled-continuous\" ||\n\t\t\t\tsettings.flow === \"scrolled-doc\") {\n\t\t\tthis._flow = \"scrolled\";\n\t\t} else {\n\t\t\tthis._flow = \"paginated\";\n\t\t}\n\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.spreadWidth = 0;\n\t\tthis.delta = 0;\n\n\t\tthis.columnWidth = 0;\n\t\tthis.gap = 0;\n\t\tthis.divisor = 1;\n\n\t\tthis.props = {\n\t\t\tname: this.name,\n\t\t\tspread: this._spread,\n\t\t\tflow: this._flow,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tspreadWidth: 0,\n\t\t\tdelta: 0,\n\t\t\tcolumnWidth: 0,\n\t\t\tgap: 0,\n\t\t\tdivisor: 1\n\t\t};\n\n\t}\n\n\t/**\n\t * Switch the flow between paginated and scrolled\n\t * @param  {string} flow paginated | scrolled\n\t * @return {string} simplified flow\n\t */\n\tflow(flow) {\n\t\tif (typeof(flow) != \"undefined\") {\n\t\t\tif (flow === \"scrolled\" ||\n\t\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\t\tflow === \"scrolled-doc\") {\n\t\t\t\tthis._flow = \"scrolled\";\n\t\t\t} else {\n\t\t\t\tthis._flow = \"paginated\";\n\t\t\t}\n\t\t\t// this.props.flow = this._flow;\n\t\t\tthis.update({flow: this._flow});\n\t\t}\n\t\treturn this._flow;\n\t}\n\n\t/**\n\t * Switch between using spreads or not, and set the\n\t * width at which they switch to single.\n\t * @param  {string} spread \"none\" | \"always\" | \"auto\"\n\t * @param  {number} min integer in pixels\n\t * @return {boolean} spread true | false\n\t */\n\tspread(spread, min) {\n\n\t\tif (spread) {\n\t\t\tthis._spread = (spread === \"none\") ? false : true;\n\t\t\t// this.props.spread = this._spread;\n\t\t\tthis.update({spread: this._spread});\n\t\t}\n\n\t\tif (min >= 0) {\n\t\t\tthis._minSpreadWidth = min;\n\t\t}\n\n\t\treturn this._spread;\n\t}\n\n\t/**\n\t * Calculate the dimensions of the pagination\n\t * @param  {number} _width  width of the rendering\n\t * @param  {number} _height height of the rendering\n\t * @param  {number} _gap    width of the gap between columns\n\t */\n\tcalculate(_width, _height, _gap){\n\n\t\tvar divisor = 1;\n\t\tvar gap = _gap || 0;\n\n\t\t//-- Check the width and create even width columns\n\t\t// var fullWidth = Math.floor(_width);\n\t\tvar width = _width;\n\t\tvar height = _height;\n\n\t\tvar section = Math.floor(width / 12);\n\n\t\tvar columnWidth;\n\t\tvar spreadWidth;\n\t\tvar pageWidth;\n\t\tvar delta;\n\n\t\tif (this._spread && width >= this._minSpreadWidth) {\n\t\t\tdivisor = 2;\n\t\t} else {\n\t\t\tdivisor = 1;\n\t\t}\n\n\t\tif (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\n\t\t\tgap = ((section % 2 === 0) ? section : section - 1);\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" ) {\n\t\t\tgap = 0;\n\t\t}\n\n\t\t//-- Double Page\n\t\tif(divisor > 1) {\n\t\t\t// width = width - gap;\n\t\t\t// columnWidth = (width - gap) / divisor;\n\t\t\t// gap = gap / divisor;\n\t\t\tcolumnWidth = (width / divisor) - gap;\n\t\t\tpageWidth = columnWidth + gap;\n\t\t} else {\n\t\t\tcolumnWidth = width;\n\t\t\tpageWidth = width;\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" && divisor > 1) {\n\t\t\twidth = columnWidth;\n\t\t}\n\n\t\tspreadWidth = (columnWidth * divisor) + gap;\n\n\t\tdelta = Math.ceil(width);\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.spreadWidth = spreadWidth;\n\t\tthis.pageWidth = pageWidth;\n\t\tthis.delta = delta;\n\n\t\tthis.columnWidth = columnWidth;\n\t\tthis.gap = gap;\n\t\tthis.divisor = divisor;\n\n\t\t// this.props.width = width;\n\t\t// this.props.height = _height;\n\t\t// this.props.spreadWidth = spreadWidth;\n\t\t// this.props.pageWidth = pageWidth;\n\t\t// this.props.delta = delta;\n\t\t//\n\t\t// this.props.columnWidth = colWidth;\n\t\t// this.props.gap = gap;\n\t\t// this.props.divisor = divisor;\n\n\t\tthis.update({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tspreadWidth,\n\t\t\tpageWidth,\n\t\t\tdelta,\n\t\t\tcolumnWidth,\n\t\t\tgap,\n\t\t\tdivisor\n\t\t});\n\n\t}\n\n\t/**\n\t * Apply Css to a Document\n\t * @param  {Contents} contents\n\t * @return {Promise}\n\t */\n\tformat(contents){\n\t\tvar formating;\n\n\t\tif (this.name === \"pre-paginated\") {\n\t\t\tformating = contents.fit(this.columnWidth, this.height);\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tformating = contents.columns(this.width, this.height, this.columnWidth, this.gap);\n\t\t} else { // scrolled\n\t\t\tformating = contents.size(this.width, null);\n\t\t}\n\n\t\treturn formating; // might be a promise in some View Managers\n\t}\n\n\t/**\n\t * Count number of pages\n\t * @param  {number} totalLength\n\t * @param  {number} pageLength\n\t * @return {{spreads: Number, pages: Number}}\n\t */\n\tcount(totalLength, pageLength) {\n\n\t\tlet spreads, pages;\n\n\t\tif (this.name === \"pre-paginated\") {\n\t\t\tspreads = 1;\n\t\t\tpages = 1;\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tpageLength = pageLength || this.delta;\n\t\t\tspreads = Math.ceil( totalLength / pageLength);\n\t\t\tpages = spreads * this.divisor;\n\t\t} else { // scrolled\n\t\t\tpageLength = pageLength || this.height;\n\t\t\tspreads = Math.ceil( totalLength / pageLength);\n\t\t\tpages = spreads;\n\t\t}\n\n\t\treturn {\n\t\t\tspreads,\n\t\t\tpages\n\t\t};\n\n\t}\n\n\t/**\n\t * Update props that have changed\n\t * @private\n\t * @param  {object} props\n\t */\n\tupdate(props) {\n\t\t// Remove props that haven't changed\n\t\tObject.keys(props).forEach((propName) => {\n\t\t\tif (this.props[propName] === props[propName]) {\n\t\t\t\tdelete props[propName];\n\t\t\t}\n\t\t});\n\n\t\tif(Object.keys(props).length > 0) {\n\t\t\tlet newProps = extend(this.props, props);\n\t\t\tthis.emit(EVENTS.LAYOUT.UPDATED, newProps, props);\n\t\t}\n\t}\n}\n\nEventEmitter(Layout.prototype);\n\nexport default Layout;\n","import Url from \"./utils/url\";\n\n/**\n * Themes to apply to displayed content\n * @class\n * @param {Rendition} rendition\n */\nclass Themes {\n\tconstructor(rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis._themes = {\n\t\t\t\"default\" : {\n\t\t\t\t\"rules\" : {},\n\t\t\t\t\"url\" : \"\",\n\t\t\t\t\"serialized\" : \"\"\n\t\t\t}\n\t\t};\n\t\tthis._overrides = {};\n\t\tthis._current = \"default\";\n\t\tthis._injected = [];\n\t\tthis.rendition.hooks.content.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.content.register(this.overrides.bind(this));\n\n\t}\n\n\t/**\n\t * Add themes to be used by a rendition\n\t * @param {object | Array<object> | string}\n\t * @example themes.register(\"light\", \"http://example.com/light.css\")\n\t * @example themes.register(\"light\", { \"body\": { \"color\": \"purple\"}})\n\t * @example themes.register({ \"light\" : {...}, \"dark\" : {...}})\n\t */\n\tregister () {\n\t\tif (arguments.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"object\") {\n\t\t\treturn this.registerThemes(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"string\") {\n\t\t\treturn this.default(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"string\") {\n\t\t\treturn this.registerUrl(arguments[0], arguments[1]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"object\") {\n\t\t\treturn this.registerRules(arguments[0], arguments[1]);\n\t\t}\n\t}\n\n\t/**\n\t * Add a default theme to be used by a rendition\n\t * @param {object | string} theme\n\t * @example themes.register(\"http://example.com/default.css\")\n\t * @example themes.register({ \"body\": { \"color\": \"purple\"}})\n\t */\n\tdefault (theme) {\n\t\tif (!theme) {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof(theme) === \"string\") {\n\t\t\treturn this.registerUrl(\"default\", theme);\n\t\t}\n\t\tif (typeof(theme) === \"object\") {\n\t\t\treturn this.registerRules(\"default\", theme);\n\t\t}\n\t}\n\n\t/**\n\t * Register themes object\n\t * @param {object} themes\n\t */\n\tregisterThemes (themes) {\n\t\tfor (var theme in themes) {\n\t\t\tif (themes.hasOwnProperty(theme)) {\n\t\t\t\tif (typeof(themes[theme]) === \"string\") {\n\t\t\t\t\tthis.registerUrl(theme, themes[theme]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.registerRules(theme, themes[theme]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Register a url\n\t * @param {string} name\n\t * @param {string} input\n\t */\n\tregisterUrl (name, input) {\n\t\tvar url = new Url(input);\n\t\tthis._themes[name] = { \"url\": url.toString() };\n\t\tif (this._injected[name]) {\n\t\t\tthis.update(name);\n\t\t}\n\t}\n\n\t/**\n\t * Register rule\n\t * @param {string} name\n\t * @param {object} rules\n\t */\n\tregisterRules (name, rules) {\n\t\tthis._themes[name] = { \"rules\": rules };\n\t\t// TODO: serialize css rules\n\t\tif (this._injected[name]) {\n\t\t\tthis.update(name);\n\t\t}\n\t}\n\n\t/**\n\t * Select a theme\n\t * @param {string} name\n\t */\n\tselect (name) {\n\t\tvar prev = this._current;\n\t\tvar contents;\n\n\t\tthis._current = name;\n\t\tthis.update(name);\n\n\t\tcontents = this.rendition.getContents();\n\t\tcontents.forEach( (content) => {\n\t\t\tcontent.removeClass(prev);\n\t\t\tcontent.addClass(name);\n\t\t});\n\t}\n\n\t/**\n\t * Update a theme\n\t * @param {string} name\n\t */\n\tupdate (name) {\n\t\tvar contents = this.rendition.getContents();\n\t\tcontents.forEach( (content) => {\n\t\t\tthis.add(name, content);\n\t\t});\n\t}\n\n\t/**\n\t * Inject all themes into contents\n\t * @param {Contents} contents\n\t */\n\tinject (contents) {\n\t\tvar links = [];\n\t\tvar themes = this._themes;\n\t\tvar theme;\n\n\t\tfor (var name in themes) {\n\t\t\tif (themes.hasOwnProperty(name) && (name === this._current || name === \"default\")) {\n\t\t\t\ttheme = themes[name];\n\t\t\t\tif((theme.rules && Object.keys(theme.rules).length > 0) || (theme.url && links.indexOf(theme.url) === -1)) {\n\t\t\t\t\tthis.add(name, contents);\n\t\t\t\t}\n\t\t\t\tthis._injected.push(name);\n\t\t\t}\n\t\t}\n\n\t\tif(this._current != \"default\") {\n\t\t\tcontents.addClass(this._current);\n\t\t}\n\t}\n\n\t/**\n\t * Add Theme to contents\n\t * @param {string} name\n\t * @param {Contents} contents\n\t */\n\tadd (name, contents) {\n\t\tvar theme = this._themes[name];\n\n\t\tif (!theme || !contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (theme.url) {\n\t\t\tcontents.addStylesheet(theme.url);\n\t\t} else if (theme.serialized) {\n\t\t\t// TODO: handle serialized\n\t\t} else if (theme.rules) {\n\t\t\tcontents.addStylesheetRules(theme.rules);\n\t\t\ttheme.injected = true;\n\t\t}\n\t}\n\n\t/**\n\t * Add override\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {boolean} priority\n\t */\n\toverride (name, value, priority) {\n\t\tvar contents = this.rendition.getContents();\n\n\t\tthis._overrides[name] = {\n\t\t\tvalue: value,\n\t\t\tpriority: priority === true\n\t\t};\n\n\t\tcontents.forEach( (content) => {\n\t\t\tcontent.css(name, this._overrides[name].value, this._overrides[name].priority);\n\t\t});\n\t}\n\n\t/**\n\t * Add all overrides\n\t * @param {Content} content\n\t */\n\toverrides (contents) {\n\t\tvar overrides = this._overrides;\n\n\t\tfor (var rule in overrides) {\n\t\t\tif (overrides.hasOwnProperty(rule)) {\n\t\t\t\tcontents.css(rule, overrides[rule].value, overrides[rule].priority);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the font size of a rendition\n\t * @param {number} size\n\t */\n\tfontSize (size) {\n\t\tthis.override(\"font-size\", size);\n\t}\n\n\t/**\n\t * Adjust the font-family of a rendition\n\t * @param {string} f\n\t */\n\tfont (f) {\n\t\tthis.override(\"font-family\", f, true);\n\t}\n\n\tdestroy() {\n\t\tthis.rendition = undefined;\n\t\tthis._themes = undefined;\n\t\tthis._overrides = undefined;\n\t\tthis._current = undefined;\n\t\tthis._injected = undefined;\n\t}\n\n}\n\nexport default Themes;\n","import EpubCFI from \"./epubcfi\";\nimport { nodeBounds } from \"./utils/core\";\n\n/**\n * Map text locations to CFI ranges\n * @class\n * @param {Layout} layout Layout to apply\n * @param {string} [direction=\"ltr\"] Text direction\n * @param {string} [axis=\"horizontal\"] vertical or horizontal axis\n * @param {boolean} [dev] toggle developer highlighting\n */\nclass Mapping {\n\tconstructor(layout, direction, axis, dev) {\n\t\tthis.layout = layout;\n\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\n\t\tthis.direction = direction || \"ltr\";\n\t\tthis._dev = dev;\n\t}\n\n\t/**\n\t * Find CFI pairs for entire section at once\n\t */\n\tsection(view) {\n\t\tvar ranges = this.findRanges(view);\n\t\tvar map = this.rangeListToCfiList(view.section.cfiBase, ranges);\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Find CFI pairs for a page\n\t * @param {Contents} contents Contents from view\n\t * @param {string} cfiBase string of the base for a cfi\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t */\n\tpage(contents, cfiBase, start, end) {\n\t\tvar root = contents && contents.document ? contents.document.body : false;\n\t\tvar result;\n\n\t\tif (!root) {\n\t\t\treturn;\n\t\t}\n\n\t\tresult = this.rangePairToCfiPair(cfiBase, {\n\t\t\tstart: this.findStart(root, start, end),\n\t\t\tend: this.findEnd(root, start, end)\n\t\t});\n\n\t\tif (this._dev === true) {\n\t\t\tlet doc = contents.document;\n\t\t\tlet startRange = new EpubCFI(result.start).toRange(doc);\n\t\t\tlet endRange = new EpubCFI(result.end).toRange(doc);\n\n\t\t\tlet selection = doc.defaultView.getSelection();\n\t\t\tlet r = doc.createRange();\n\t\t\tselection.removeAllRanges();\n\t\t\tr.setStart(startRange.startContainer, startRange.startOffset);\n\t\t\tr.setEnd(endRange.endContainer, endRange.endOffset);\n\t\t\tselection.addRange(r);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Walk a node, preforming a function on each node it finds\n\t * @private\n\t * @param {Node} root Node to walkToNode\n\t * @param {function} func walk function\n\t * @return {*} returns the result of the walk function\n\t */\n\twalk(root, func) {\n\t\t// IE11 has strange issue, if root is text node IE throws exception on\n\t\t// calling treeWalker.nextNode(), saying\n\t\t// Unexpected call to method or property access instead of returing null value\n\t\tif(root && root.nodeType === Node.TEXT_NODE) {\n\t\t\treturn;\n\t\t}\n\t\t// safeFilter is required so that it can work in IE as filter is a function for IE\n\t\t// and for other browser filter is an object.\n\t\tvar filter = {\n\t\t\tacceptNode: function(node) {\n\t\t\t\tif (node.data.trim().length > 0) {\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\n\t\t\t\t} else {\n\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tvar safeFilter = filter.acceptNode;\n\t\tsafeFilter.acceptNode = filter.acceptNode;\n\n\t\tvar treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, safeFilter, false);\n\t\tvar node;\n\t\tvar result;\n\t\twhile ((node = treeWalker.nextNode())) {\n\t\t\tresult = func(node);\n\t\t\tif(result) break;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfindRanges(view){\n\t\tvar columns = [];\n\t\tvar scrollWidth = view.contents.scrollWidth();\n\t\tvar spreads = Math.ceil( scrollWidth / this.layout.spreadWidth);\n\t\tvar count = spreads * this.layout.divisor;\n\t\tvar columnWidth = this.layout.columnWidth;\n\t\tvar gap = this.layout.gap;\n\t\tvar start, end;\n\n\t\tfor (var i = 0; i < count.pages; i++) {\n\t\t\tstart = (columnWidth + gap) * i;\n\t\t\tend = (columnWidth * (i+1)) + (gap * i);\n\t\t\tcolumns.push({\n\t\t\t\tstart: this.findStart(view.document.body, start, end),\n\t\t\t\tend: this.findEnd(view.document.body, start, end)\n\t\t\t});\n\t\t}\n\n\t\treturn columns;\n\t}\n\n\t/**\n\t * Find Start Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindStart(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar found;\n\t\tvar $prev = root;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, (node) => {\n\t\t\t\tvar left, right, top, bottom;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\n\t\t\t\telPos = nodeBounds(node);\n\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\t\tleft = this.horizontal ? elPos.left : elPos.top;\n\t\t\t\t\tright = this.horizontal ? elPos.right : elPos.bottom;\n\n\t\t\t\t\tif( left >= start && left <= end ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (right > start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\t\tleft = elPos.left;\n\t\t\t\t\tright = elPos.right;\n\n\t\t\t\t\tif( right <= end && right >= start ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (left < end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttop = elPos.top;\n\t\t\t\t\tbottom = elPos.bottom;\n\n\t\t\t\t\tif( top >= start && top <= end ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (bottom > start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\n\t\t\t});\n\n\t\t\tif(found) {\n\t\t\t\treturn this.findTextStartRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// Return last element\n\t\treturn this.findTextStartRange($prev, start, end);\n\t}\n\n\t/**\n\t * Find End Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindEnd(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar $prev = root;\n\t\tvar found;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, (node) => {\n\n\t\t\t\tvar left, right, top, bottom;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\t\t\t\telPos = nodeBounds(node);\n\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\t\tleft = Math.round(elPos.left);\n\t\t\t\t\tright = Math.round(elPos.right);\n\n\t\t\t\t\tif(left > end && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(right > end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\t\tleft = Math.round(this.horizontal ? elPos.left : elPos.top);\n\t\t\t\t\tright = Math.round(this.horizontal ? elPos.right : elPos.bottom);\n\n\t\t\t\t\tif(right < start && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(left < start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttop = Math.round(elPos.top);\n\t\t\t\t\tbottom = Math.round(elPos.bottom);\n\n\t\t\t\t\tif(top > end && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(bottom > end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t});\n\n\n\t\t\tif(found){\n\t\t\t\treturn this.findTextEndRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// end of chapter\n\t\treturn this.findTextEndRange($prev, start, end);\n\t}\n\n\t/**\n\t * Find Text Start Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindTextStartRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar range;\n\t\tvar pos;\n\t\tvar left, top, right;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\tleft = pos.left;\n\t\t\t\tif( left >= start ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\tright = pos.right;\n\t\t\t\tif( right <= end ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\ttop = pos.top;\n\t\t\t\tif( top >= start ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// prev = range;\n\n\t\t}\n\n\t\treturn ranges[0];\n\t}\n\n\t/**\n\t * Find Text End Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindTextEndRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar prev;\n\t\tvar range;\n\t\tvar pos;\n\t\tvar left, right, top, bottom;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\tleft = pos.left;\n\t\t\t\tright = pos.right;\n\n\t\t\t\tif(left > end && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(right > end) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\tleft = pos.left\n\t\t\t\tright = pos.right;\n\n\t\t\t\tif(right < start && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(left < start) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\ttop = pos.top;\n\t\t\t\tbottom = pos.bottom;\n\n\t\t\t\tif(top > end && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(bottom > end) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t}\n\n\n\t\t\tprev = range;\n\n\t\t}\n\n\t\t// Ends before limit\n\t\treturn ranges[ranges.length-1];\n\n\t}\n\n\t/**\n\t * Split up a text node into ranges for each word\n\t * @private\n\t * @param {Node} root root node\n\t * @param {string} [_splitter] what to split on\n\t * @return {Range[]}\n\t */\n\tsplitTextNodeIntoRanges(node, _splitter){\n\t\tvar ranges = [];\n\t\tvar textContent = node.textContent || \"\";\n\t\tvar text = textContent.trim();\n\t\tvar range;\n\t\tvar doc = node.ownerDocument;\n\t\tvar splitter = _splitter || \" \";\n\n\t\tvar pos = text.indexOf(splitter);\n\n\t\tif(pos === -1 || node.nodeType != Node.TEXT_NODE) {\n\t\t\trange = doc.createRange();\n\t\t\trange.selectNodeContents(node);\n\t\t\treturn [range];\n\t\t}\n\n\t\trange = doc.createRange();\n\t\trange.setStart(node, 0);\n\t\trange.setEnd(node, pos);\n\t\tranges.push(range);\n\t\trange = false;\n\n\t\twhile ( pos != -1 ) {\n\n\t\t\tpos = text.indexOf(splitter, pos + 1);\n\t\t\tif(pos > 0) {\n\n\t\t\t\tif(range) {\n\t\t\t\t\trange.setEnd(node, pos);\n\t\t\t\t\tranges.push(range);\n\t\t\t\t}\n\n\t\t\t\trange = doc.createRange();\n\t\t\t\trange.setStart(node, pos+1);\n\t\t\t}\n\t\t}\n\n\t\tif(range) {\n\t\t\trange.setEnd(node, text.length);\n\t\t\tranges.push(range);\n\t\t}\n\n\t\treturn ranges;\n\t}\n\n\n\t/**\n\t * Turn a pair of ranges into a pair of CFIs\n\t * @private\n\t * @param {string} cfiBase base string for an EpubCFI\n\t * @param {object} rangePair { start: Range, end: Range }\n\t * @return {object} { start: \"epubcfi(...)\", end: \"epubcfi(...)\" }\n\t */\n\trangePairToCfiPair(cfiBase, rangePair){\n\n\t\tvar startRange = rangePair.start;\n\t\tvar endRange = rangePair.end;\n\n\t\tstartRange.collapse(true);\n\t\tendRange.collapse(false);\n\n\t\tlet startCfi = new EpubCFI(startRange, cfiBase).toString();\n\t\tlet endCfi = new EpubCFI(endRange, cfiBase).toString();\n\n\t\treturn {\n\t\t\tstart: startCfi,\n\t\t\tend: endCfi\n\t\t};\n\n\t}\n\n\trangeListToCfiList(cfiBase, columns){\n\t\tvar map = [];\n\t\tvar cifPair;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tcifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\n\n\t\t\tmap.push(cifPair);\n\n\t\t}\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Set the axis for mapping\n\t * @param {string} axis horizontal | vertical\n\t * @return {boolean} is it horizontal?\n\t */\n\taxis(axis) {\n\t\tif (axis) {\n\t\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\n\t\t}\n\t\treturn this.horizontal;\n\t}\n}\n\nexport default Mapping;\n","import EventEmitter from \"event-emitter\";\nimport {isNumber, prefixed, borders, defaults} from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport {replaceLinks} from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\nconst hasNavigator = typeof (navigator) !== \"undefined\";\n\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nclass Contents {\n\tconstructor(doc, content, cfiBase, sectionIndex) {\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.document = doc;\n\t\tthis.documentElement =  this.document.documentElement;\n\t\tthis.content = content || this.document.body;\n\t\tthis.window = this.document.defaultView;\n\n\t\tthis._size = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\tthis.sectionIndex = sectionIndex || 0;\n\t\tthis.cfiBase = cfiBase || \"\";\n\n\t\tthis.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n\n\t\tthis.listeners();\n\t}\n\n\t/**\n\t\t* Get DOM events that are listened for and passed along\n\t\t*/\n\tstatic get listenedEvents() {\n\t\treturn DOM_EVENTS;\n\t}\n\n\t/**\n\t\t* Get or Set width\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\twidth(w) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tframe.style.width = w;\n\t\t\t// this.content.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)[\"width\"];\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\theight(h) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tframe.style.height = h;\n\t\t\t// this.content.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)[\"height\"];\n\n\t}\n\n\t/**\n\t\t* Get or Set width of the contents\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\tcontentWidth(w) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tcontent.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[\"width\"];\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height of the contents\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\tcontentHeight(h) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tcontent.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[\"height\"];\n\n\t}\n\n\t/**\n\t\t* Get the width of the text using Range\n\t\t* @returns {number} width\n\t\t*/\n\ttextWidth() {\n\t\tlet rect;\n\t\tlet width;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\t// Select the contents of frame\n\t\trange.selectNodeContents(content);\n\n\t\t// get the width of the text content\n\t\trect = range.getBoundingClientRect();\n\t\twidth = rect.width;\n\n\t\tif (border && border.width) {\n\t\t\twidth += border.width;\n\t\t}\n\n\t\treturn Math.round(width);\n\t}\n\n\t/**\n\t\t* Get the height of the text using Range\n\t\t* @returns {number} height\n\t\t*/\n\ttextHeight() {\n\t\tlet rect;\n\t\tlet height;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\trange.selectNodeContents(content);\n\n\t\trect = range.getBoundingClientRect();\n\t\theight = rect.height;\n\n\t\tif (height && border.height) {\n\t\t\theight += border.height;\n\t\t}\n\n\t\tif (height && rect.top) {\n\t\t\theight += rect.top;\n\t\t}\n\n\t\treturn Math.round(height);\n\t}\n\n\t/**\n\t\t* Get documentElement scrollWidth\n\t\t* @returns {number} width\n\t\t*/\n\tscrollWidth() {\n\t\tvar width = this.documentElement.scrollWidth;\n\n\t\treturn width;\n\t}\n\n\t/**\n\t\t* Get documentElement scrollHeight\n\t\t* @returns {number} height\n\t\t*/\n\tscrollHeight() {\n\t\tvar height = this.documentElement.scrollHeight;\n\n\t\treturn height;\n\t}\n\n\t/**\n\t\t* Set overflow css style of the contents\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflow(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflow = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n\t}\n\n\t/**\n\t\t* Set overflowX css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowX(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowX = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n\t}\n\n\t/**\n\t\t* Set overflowY css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowY(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowY = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n\t}\n\n\t/**\n\t\t* Set Css styles on the contents element (typically Body)\n\t\t* @param {string} property\n\t\t* @param {string} value\n\t\t* @param {boolean} [priority] set as \"important\"\n\t\t*/\n\tcss(property, value, priority) {\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (value) {\n\t\t\tcontent.style.setProperty(property, value, priority ? \"important\" : \"\");\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[property];\n\t}\n\n\t/**\n\t\t* Get or Set the viewport element\n\t\t* @param {object} [options]\n\t\t* @param {string} [options.width]\n\t\t* @param {string} [options.height]\n\t\t* @param {string} [options.scale]\n\t\t* @param {string} [options.minimum]\n\t\t* @param {string} [options.maximum]\n\t\t* @param {string} [options.scalable]\n\t\t*/\n\tviewport(options) {\n\t\tvar _width, _height, _scale, _minimum, _maximum, _scalable;\n\t\t// var width, height, scale, minimum, maximum, scalable;\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar parsed = {\n\t\t\t\"width\": undefined,\n\t\t\t\"height\": undefined,\n\t\t\t\"scale\": undefined,\n\t\t\t\"minimum\": undefined,\n\t\t\t\"maximum\": undefined,\n\t\t\t\"scalable\": undefined\n\t\t};\n\t\tvar newContent = [];\n\t\tvar settings = {};\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tlet content = $viewport.getAttribute(\"content\");\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\n\t\t\t\tparsed.width = _width[1];\n\t\t\t}\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\n\t\t\t\tparsed.height = _height[1];\n\t\t\t}\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\n\t\t\t\tparsed.scale = _scale[1];\n\t\t\t}\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\n\t\t\t\tparsed.minimum = _minimum[1];\n\t\t\t}\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\n\t\t\t\tparsed.maximum = _maximum[1];\n\t\t\t}\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\n\t\t\t\tparsed.scalable = _scalable[1];\n\t\t\t}\n\t\t}\n\n\t\tsettings = defaults(options || {}, parsed);\n\n\t\tif (options) {\n\t\t\tif (settings.width) {\n\t\t\t\tnewContent.push(\"width=\" + settings.width);\n\t\t\t}\n\n\t\t\tif (settings.height) {\n\t\t\t\tnewContent.push(\"height=\" + settings.height);\n\t\t\t}\n\n\t\t\tif (settings.scale) {\n\t\t\t\tnewContent.push(\"initial-scale=\" + settings.scale);\n\t\t\t}\n\n\t\t\tif (settings.scalable === \"no\") {\n\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"maximum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t} else {\n\n\t\t\t\tif (settings.scalable) {\n\t\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t\t}\n\n\t\t\t\tif (settings.minimum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.minimum);\n\t\t\t\t}\n\n\t\t\t\tif (settings.maximum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.maximum);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!$viewport) {\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\n\t\t\t\tthis.document.querySelector(\"head\").appendChild($viewport);\n\t\t\t}\n\n\t\t\t$viewport.setAttribute(\"content\", newContent.join(\", \"));\n\n\t\t\tthis.window.scrollTo(0, 0);\n\t\t}\n\n\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Event emitter for when the contents has expanded\n\t * @private\n\t */\n\texpand() {\n\t\tthis.emit(EVENTS.CONTENTS.EXPAND);\n\t}\n\n\t/**\n\t * Add DOM listeners\n\t * @private\n\t */\n\tlisteners() {\n\n\t\tthis.imageLoadListeners();\n\n\t\tthis.mediaQueryListeners();\n\n\t\t// this.fontLoadListeners();\n\n\t\tthis.addEventListeners();\n\n\t\tthis.addSelectionListeners();\n\n\t\t// this.transitionListeners();\n\n\t\tthis.resizeListeners();\n\n\t\t// this.resizeObservers();\n\n\t\tthis.linksHandler();\n\t}\n\n\t/**\n\t * Remove DOM listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.removeSelectionListeners();\n\n\t\tclearTimeout(this.expanding);\n\t}\n\n\t/**\n\t * Check if size of contents has changed and\n\t * emit 'resize' event if it has.\n\t * @private\n\t */\n\tresizeCheck() {\n\t\tlet width = this.textWidth();\n\t\tlet height = this.textHeight();\n\n\t\tif (width != this._size.width || height != this._size.height) {\n\n\t\t\tthis._size = {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\n\t\t\tthis.onResize && this.onResize(this._size);\n\t\t\tthis.emit(EVENTS.CONTENTS.RESIZE, this._size);\n\t\t}\n\t}\n\n\t/**\n\t * Poll for resize detection\n\t * @private\n\t */\n\tresizeListeners() {\n\t\tvar width, height;\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\n\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n\t}\n\n\t/**\n\t * Use css transitions to detect resize\n\t * @private\n\t */\n\ttransitionListeners() {\n\t\tlet body = this.content;\n\n\t\tbody.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n\t\tbody.style['transitionDuration'] = \"0.001ms\";\n\t\tbody.style['transitionTimingFunction'] = \"linear\";\n\t\tbody.style['transitionDelay'] = \"0\";\n\n\t\tthis._resizeCheck = this.resizeCheck.bind(this);\n\t\tthis.document.addEventListener('transitionend', this._resizeCheck);\n\t}\n\n\t/**\n\t * Listen for media query changes and emit 'expand' event\n\t * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n\t * @private\n\t */\n\tmediaQueryListeners() {\n\t\tvar sheets = this.document.styleSheets;\n\t\tvar mediaChangeHandler = function(m){\n\t\t\tif(m.matches && !this._expanding) {\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\n\t\t\tvar rules;\n\t\t\t// Firefox errors if we access cssRules cross-domain\n\t\t\ttry {\n\t\t\t\trules = sheets[i].cssRules;\n\t\t\t} catch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(!rules) return; // Stylesheets changed\n\t\t\tfor (var j = 0; j < rules.length; j += 1) {\n\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\n\t\t\t\tif(rules[j].media){\n\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\n\t\t\t\t\tmql.addListener(mediaChangeHandler);\n\t\t\t\t\t//mql.onchange = mediaChangeHandler;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Use MutationObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tresizeObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new MutationObserver((mutations) => {\n\t\t\tthis.resizeCheck();\n\t\t});\n\n\t\t// configuration of the observer:\n\t\tlet config = { attributes: true, childList: true, characterData: true, subtree: true };\n\n\t\t// pass in the target node, as well as the observer options\n\t\tthis.observer.observe(this.document, config);\n\t}\n\n\t/**\n\t * Test if images are loaded or add listener for when they load\n\t * @private\n\t */\n\timageLoadListeners() {\n\t\tvar images = this.document.querySelectorAll(\"img\");\n\t\tvar img;\n\t\tfor (var i = 0; i < images.length; i++) {\n\t\t\timg = images[i];\n\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\n\t\t\t\t\timg.naturalWidth === 0) {\n\t\t\t\timg.onload = this.expand.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Listen for font load and check for resize when loaded\n\t * @private\n\t */\n\tfontLoadListeners() {\n\t\tif (!this.document || !this.document.fonts) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.document.fonts.ready.then(function () {\n\t\t\tthis.resizeCheck();\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Get the documentElement\n\t * @returns {element} documentElement\n\t */\n\troot() {\n\t\tif(!this.document) return null;\n\t\treturn this.document.documentElement;\n\t}\n\n\t/**\n\t * Get the location offset of a EpubCFI or an #id\n\t * @param {string | EpubCFI} target\n\t * @param {string} [ignoreClass] for the cfi\n\t * @returns { {left: Number, top: Number }\n\t */\n\tlocationOf(target, ignoreClass) {\n\t\tvar position;\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\n\n\t\tif(!this.document) return targetPos;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\tlet range = new EpubCFI(target).toRange(this.document, ignoreClass);\n\n\t\t\tif(range) {\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t} else {\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\n\n\t\t\t\t\t// Construct a new non-collapsed range\n\t\t\t\t\tif (isWebkit) {\n\t\t\t\t\t\tlet container = range.startContainer;\n\t\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (container.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\t\t\tposition = container.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset + 2 < container.length) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset + 2);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset - 2 > 0) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset - 2);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else { // empty, return the parent element\n\t\t\t\t\t\t\t\tposition = container.parentNode.getBoundingClientRect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if(typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\n\t\t\tlet id = target.substring(target.indexOf(\"#\")+1);\n\t\t\tlet el = this.document.getElementById(id);\n\n\t\t\tif(el) {\n\t\t\t\tposition = el.getBoundingClientRect();\n\t\t\t}\n\t\t}\n\n\t\tif (position) {\n\t\t\ttargetPos.left = position.left;\n\t\t\ttargetPos.top = position.top;\n\t\t}\n\n\t\treturn targetPos;\n\t}\n\n\t/**\n\t * Append a stylesheet link to the document head\n\t * @param {string} src url\n\t */\n\taddStylesheet(src) {\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $stylesheet;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if link already exists\n\t\t\t$stylesheet = this.document.querySelector(\"link[href='\"+src+\"']\");\n\t\t\tif ($stylesheet) {\n\t\t\t\tresolve(true);\n\t\t\t\treturn; // already present\n\t\t\t}\n\n\t\t\t$stylesheet = this.document.createElement(\"link\");\n\t\t\t$stylesheet.type = \"text/css\";\n\t\t\t$stylesheet.rel = \"stylesheet\";\n\t\t\t$stylesheet.href = src;\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\t// Let apply\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($stylesheet);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Append stylesheet rules to a generate stylesheet\n\t * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n\t * Object: https://github.com/desirable-objects/json-to-css\n\t * @param {array | object} rules\n\t */\n\taddStylesheetRules(rules) {\n\t\tvar styleEl;\n\t\tvar styleSheet;\n\t\tvar key = \"epubjs-inserted-css\";\n\n\t\tif(!this.document || !rules || rules.length === 0) return;\n\n\t\t// Check if link already exists\n\t\tstyleEl = this.document.getElementById(key);\n\t\tif (!styleEl) {\n\t\t\tstyleEl = this.document.createElement(\"style\");\n\t\t\tstyleEl.id = key;\n\t\t}\n\n\t\t// Append style element to head\n\t\tthis.document.head.appendChild(styleEl);\n\n\t\t// Grab style sheet\n\t\tstyleSheet = styleEl.sheet;\n\n\t\tif (Object.prototype.toString.call(rules) === \"[object Array]\") {\n\t\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\n\t\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = \"\";\n\t\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\n\t\t\t\tif (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n\t\t\t\t\trule = rule[1];\n\t\t\t\t\tj = 0;\n\t\t\t\t}\n\n\t\t\t\tfor (var pl = rule.length; j < pl; j++) {\n\t\t\t\t\tvar prop = rule[j];\n\t\t\t\t\tpropStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n\t\t\t\t}\n\n\t\t\t\t// Insert CSS Rule\n\t\t\t\tstyleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n\t\t\t}\n\t\t} else {\n\t\t\tconst selectors = Object.keys(rules);\n\t\t\tselectors.forEach((selector) => {\n\t\t\t\tconst definition = rules[selector];\n\t\t\t\tif (Array.isArray(definition)) {\n\t\t\t\t\tdefinition.forEach((item) => {\n\t\t\t\t\t\tconst _rules = Object.keys(item);\n\t\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\t\treturn `${rule}:${item[rule]}`;\n\t\t\t\t\t\t}).join(';');\n\t\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst _rules = Object.keys(definition);\n\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\treturn `${rule}:${definition[rule]}`;\n\t\t\t\t\t}).join(';');\n\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Append a script tag to the document head\n\t * @param {string} src url\n\t * @returns {Promise} loaded\n\t */\n\taddScript(src) {\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $script;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$script = this.document.createElement(\"script\");\n\t\t\t$script.type = \"text/javascript\";\n\t\t\t$script.async = true;\n\t\t\t$script.src = src;\n\t\t\t$script.onload = $script.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($script);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Add a class to the contents container\n\t * @param {string} className\n\t */\n\taddClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.add(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Remove a class from the contents container\n\t * @param {string} removeClass\n\t */\n\tremoveClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.remove(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Add DOM event listeners\n\t * @private\n\t */\n\taddEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._triggerEvent = this.triggerEvent.bind(this);\n\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.addEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\n\t}\n\n\t/**\n\t * Remove DOM event listeners\n\t * @private\n\t */\n\tremoveEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.removeEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\t\tthis._triggerEvent = undefined;\n\t}\n\n\t/**\n\t * Emit passed browser events\n\t * @private\n\t */\n\ttriggerEvent(e){\n\t\tthis.emit(e.type, e);\n\t}\n\n\t/**\n\t * Add listener for text selection\n\t * @private\n\t */\n\taddSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectionChange = this.onSelectionChange.bind(this);\n\t\tthis.document.addEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t}\n\n\t/**\n\t * Remove listener for text selection\n\t * @private\n\t */\n\tremoveSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.removeEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t\tthis._onSelectionChange = undefined;\n\t}\n\n\t/**\n\t * Handle getting text on selection\n\t * @private\n\t */\n\tonSelectionChange(e){\n\t\tif (this.selectionEndTimeout) {\n\t\t\tclearTimeout(this.selectionEndTimeout);\n\t\t}\n\t\tthis.selectionEndTimeout = setTimeout(function() {\n\t\t\tvar selection = this.window.getSelection();\n\t\t\tthis.triggerSelectedEvent(selection);\n\t\t}.bind(this), 250);\n\t}\n\n\t/**\n\t * Emit event on text selection\n\t * @private\n\t */\n\ttriggerSelectedEvent(selection){\n\t\tvar range, cfirange;\n\n\t\tif (selection && selection.rangeCount > 0) {\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed) {\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get a Dom Range from EpubCFI\n\t * @param {EpubCFI} _cfi\n\t * @param {string} [ignoreClass]\n\t * @returns {Range} range\n\t */\n\trange(_cfi, ignoreClass){\n\t\tvar cfi = new EpubCFI(_cfi);\n\t\treturn cfi.toRange(this.document, ignoreClass);\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom Range\n\t * @param {Range} range\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromRange(range, ignoreClass){\n\t\treturn new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom node\n\t * @param {node} node\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromNode(node, ignoreClass){\n\t\treturn new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t// TODO: find where this is used - remove?\n\tmap(layout){\n\t\tvar map = new Mapping(layout);\n\t\treturn map.section();\n\t}\n\n\t/**\n\t * Size the contents to a given width and height\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tsize(width, height){\n\t\tvar viewport = { scale: 1.0, scalable: \"no\" };\n\n\t\tthis.layoutStyle(\"scrolling\");\n\n\t\tif (width >= 0) {\n\t\t\tthis.width(width);\n\t\t\tviewport.width = width;\n\t\t\tthis.css(\"padding\", \"0 \"+(width/12)+\"px\");\n\t\t}\n\n\t\tif (height >= 0) {\n\t\t\tthis.height(height);\n\t\t\tviewport.height = height;\n\t\t}\n\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\n\n\t\tthis.viewport(viewport);\n\t}\n\n\t/**\n\t * Apply columns to the contents for pagination\n\t * @param {number} width\n\t * @param {number} height\n\t * @param {number} columnWidth\n\t * @param {number} gap\n\t */\n\tcolumns(width, height, columnWidth, gap){\n\t\tlet COLUMN_AXIS = prefixed(\"column-axis\");\n\t\tlet COLUMN_GAP = prefixed(\"column-gap\");\n\t\tlet COLUMN_WIDTH = prefixed(\"column-width\");\n\t\tlet COLUMN_FILL = prefixed(\"column-fill\");\n\n\t\tlet writingMode = this.writingMode();\n\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// Fix body width issues if rtl is only set on body element\n\t\tif (this.content.dir === \"rtl\") {\n\t\t\tthis.direction(\"rtl\");\n\t\t}\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ width: width, height: height, scale: 1.0, scalable: \"no\" });\n\n\t\t// TODO: inline-block needs more testing\n\t\t// Fixes Safari column cut offs, but causes RTL issues\n\t\t// this.css(\"display\", \"inline-block\");\n\n\t\tthis.css(\"overflow-y\", \"hidden\");\n\t\tthis.css(\"margin\", \"0\", true);\n\n\t\tif (axis === \"vertical\") {\n\t\t\tthis.css(\"padding-top\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-bottom\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-left\", \"20px\");\n\t\t\tthis.css(\"padding-right\", \"20px\");\n\t\t} else {\n\t\t\tthis.css(\"padding-top\", \"20px\");\n\t\t\tthis.css(\"padding-bottom\", \"20px\");\n\t\t\tthis.css(\"padding-left\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-right\", (gap / 2) + \"px\", true);\n\t\t}\n\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\t\tthis.css(\"max-width\", \"inherit\");\n\n\t\tthis.css(COLUMN_AXIS, \"horizontal\");\n\t\tthis.css(COLUMN_FILL, \"auto\");\n\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\n\t}\n\n\t/**\n\t * Scale contents from center\n\t * @param {number} scale\n\t * @param {number} offsetX\n\t * @param {number} offsetY\n\t */\n\tscaler(scale, offsetX, offsetY){\n\t\tvar scaleStr = \"scale(\" + scale + \")\";\n\t\tvar translateStr = \"\";\n\t\t// this.css(\"position\", \"absolute\"));\n\t\tthis.css(\"transform-origin\", \"top left\");\n\n\t\tif (offsetX >= 0 || offsetY >= 0) {\n\t\t\ttranslateStr = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\n\t\t}\n\n\t\tthis.css(\"transform\", scaleStr + translateStr);\n\t}\n\n\t/**\n\t * Fit contents into a fixed width and height\n\t * @param {number} width\n\t * @param {number} height\n\t */\n\tfit(width, height){\n\t\tvar viewport = this.viewport();\n\t\tvar viewportWidth = parseInt(viewport.width);\n\t\tvar viewportHeight = parseInt(viewport.height);\n\t\tvar widthScale = width / viewportWidth;\n\t\tvar heightScale = height / viewportHeight;\n\t\tvar scale = widthScale < heightScale ? widthScale : heightScale;\n\n\t\t// the translate does not work as intended, elements can end up unaligned\n\t\t// var offsetY = (height - (viewportHeight * scale)) / 2;\n\t\t// var offsetX = 0;\n\t\t// if (this.sectionIndex % 2 === 1) {\n\t\t// \toffsetX = width - (viewportWidth * scale);\n\t\t// }\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// scale needs width and height to be set\n\t\tthis.width(viewportWidth);\n\t\tthis.height(viewportHeight);\n\t\tthis.overflow(\"hidden\");\n\n\t\tif ( viewport.width == 'auto' || viewport.height == 'auto' ) {\n\t\t\tthis.content.style.overflow = 'auto';\n\t\t\tthis.addStylesheetRules({\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"margin\": 0,\n\t\t\t\t\t\"padding\": \"1em\",\n\t\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\t// Scale to the correct size\n\t\tthis.scaler(scale, 0, 0);\n\t\t// this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n\n\t\t// background images are not scaled by transform\n\t\tthis.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n\n\t\tthis.css(\"background-color\", \"transparent\");\n\t}\n\n\t/**\n\t * Set the direction of the text\n\t * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n\t */\n\tdirection(dir) {\n\t\tif (this.documentElement) {\n\t\t\tthis.documentElement.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\tmapPage(cfiBase, layout, start, end, dev) {\n\t\tvar mapping = new Mapping(layout, dev);\n\n\t\treturn mapping.page(this, cfiBase, start, end);\n\t}\n\n\t/**\n\t * Emit event when link in content is clicked\n\t * @private\n\t */\n\tlinksHandler() {\n\t\treplaceLinks(this.content, (href) => {\n\t\t\tthis.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n\t\t});\n\t}\n\n\t/**\n\t * Set the writingMode of the text\n\t * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n\t */\n\twritingMode(mode) {\n\t\tlet WRITING_MODE = prefixed(\"writing-mode\");\n\n\t\tif (mode && this.documentElement) {\n\t\t\tthis.documentElement.style[WRITING_MODE] = mode;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n\t}\n\n\t/**\n\t * Set the layoutStyle of the content\n\t * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n\t * @private\n\t */\n\tlayoutStyle(style) {\n\n\t\tif (style) {\n\t\t\tthis._layoutStyle = style;\n\t\t\tnavigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n\t\t}\n\n\t\treturn this._layoutStyle || \"paginated\";\n\t}\n\n\t/**\n\t * Add the epubReadingSystem object to the navigator\n\t * @param {string} name\n\t * @param {string} version\n\t * @private\n\t */\n\tepubReadingSystem(name, version) {\n\t\tnavigator.epubReadingSystem = {\n\t\t\tname: name,\n\t\t\tversion: version,\n\t\t\tlayoutStyle: this.layoutStyle(),\n\t\t\thasFeature: function (feature) {\n\t\t\t\tswitch (feature) {\n\t\t\t\t\tcase \"dom-manipulation\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"layout-changes\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"touch-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"mouse-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"keyboard-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"spine-scripting\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn navigator.epubReadingSystem;\n\t}\n\n\tdestroy() {\n\t\t// Stop observing\n\t\tif(this.observer) {\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tthis.document.removeEventListener('transitionend', this._resizeCheck);\n\n\t\tthis.removeListeners();\n\n\t}\n}\n\nEventEmitter(Contents.prototype);\n\nexport default Contents;\n","import EventEmitter from \"event-emitter\";\nimport EpubCFI from \"./epubcfi\";\n\n/**\n\t* Handles managing adding & removing Annotations\n\t* @param {Rendition} rendition\n\t* @class\n\t*/\nclass Annotations {\n\n\tconstructor (rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis.highlights = [];\n\t\tthis.underlines = [];\n\t\tthis.marks = [];\n\t\tthis._annotations = {};\n\t\tthis._annotationsBySectionIndex = {};\n\n\t\tthis.rendition.hooks.render.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.unloaded.register(this.clear.bind(this));\n\t}\n\n\t/**\n\t * Add an annotation to store\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} [cb] Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t * @returns {Annotation} annotation\n\t */\n\tadd (type, cfiRange, data, cb, className, styles) {\n\t\tlet hash = encodeURI(cfiRange);\n\t\tlet cfi = new EpubCFI(cfiRange);\n\t\tlet sectionIndex = cfi.spinePos;\n\t\tlet annotation = new Annotation({\n\t\t\ttype,\n\t\t\tcfiRange,\n\t\t\tdata,\n\t\t\tsectionIndex,\n\t\t\tcb,\n\t\t\tclassName,\n\t\t\tstyles\n\t\t});\n\n\t\tthis._annotations[hash] = annotation;\n\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tthis._annotationsBySectionIndex[sectionIndex].push(hash);\n\t\t} else {\n\t\t\tthis._annotationsBySectionIndex[sectionIndex] = [hash];\n\t\t}\n\n\t\tlet views = this.rendition.views();\n\n\t\tviews.forEach( (view) => {\n\t\t\tif (annotation.sectionIndex === view.index) {\n\t\t\t\tannotation.attach(view);\n\t\t\t}\n\t\t});\n\n\t\treturn annotation;\n\t}\n\n\t/**\n\t * Remove an annotation from store\n\t * @param {EpubCFI} cfiRange EpubCFI range the annotation is attached to\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n\t */\n\tremove (cfiRange, type) {\n\t\tlet hash = encodeURI(cfiRange);\n\n\t\tif (hash in this._annotations) {\n\t\t\tlet annotation = this._annotations[hash];\n\n\t\t\tif (type && annotation.type !== type) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet views = this.rendition.views();\n\t\t\tviews.forEach( (view) => {\n\t\t\t\tthis._removeFromAnnotationBySectionIndex(annotation.sectionIndex, hash);\n\t\t\t\tif (annotation.sectionIndex === view.index) {\n\t\t\t\t\tannotation.detach(view);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete this._annotations[hash];\n\t\t}\n\t}\n\n\t/**\n\t * Remove an annotations by Section Index\n\t * @private\n\t */\n\t_removeFromAnnotationBySectionIndex (sectionIndex, hash) {\n\t\tthis._annotationsBySectionIndex[sectionIndex] = this._annotationsAt(sectionIndex).filter(h => h !== hash);\n\t}\n\n\t/**\n\t * Get annotations by Section Index\n\t * @private\n\t */\n\t_annotationsAt (index) {\n\t\treturn this._annotationsBySectionIndex[index];\n\t}\n\n\n\t/**\n\t * Add a highlight to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t */\n\thighlight (cfiRange, data, cb, className, styles) {\n\t\tthis.add(\"highlight\", cfiRange, data, cb, className, styles);\n\t}\n\n\t/**\n\t * Add a underline to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t */\n\tunderline (cfiRange, data, cb, className, styles) {\n\t\tthis.add(\"underline\", cfiRange, data, cb, className, styles);\n\t}\n\n\t/**\n\t * Add a mark to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t */\n\tmark (cfiRange, data, cb) {\n\t\tthis.add(\"mark\", cfiRange, data, cb);\n\t}\n\n\t/**\n\t * iterate over annotations in the store\n\t */\n\teach () {\n\t\treturn this._annotations.forEach.apply(this._annotations, arguments);\n\t}\n\n\t/**\n\t * Hook for injecting annotation into a view\n\t * @param {View} view\n\t * @private\n\t */\n\tinject (view) {\n\t\tlet sectionIndex = view.index;\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\n\t\t\tannotations.forEach((hash) => {\n\t\t\t\tlet annotation = this._annotations[hash];\n\t\t\t\tannotation.attach(view);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook for removing annotation from a view\n\t * @param {View} view\n\t * @private\n\t */\n\tclear (view) {\n\t\tlet sectionIndex = view.index;\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\n\t\t\tannotations.forEach((hash) => {\n\t\t\t\tlet annotation = this._annotations[hash];\n\t\t\t\tannotation.detach(view);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * [Not Implemented] Show annotations\n\t * @TODO: needs implementation in View\n\t */\n\tshow () {\n\n\t}\n\n\t/**\n\t * [Not Implemented] Hide annotations\n\t * @TODO: needs implementation in View\n\t */\n\thide () {\n\n\t}\n\n}\n\n/**\n * Annotation object\n * @class\n * @param {object} options\n * @param {string} options.type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n * @param {EpubCFI} options.cfiRange EpubCFI range to attach annotation to\n * @param {object} options.data Data to assign to annotation\n * @param {int} options.sectionIndex Index in the Spine of the Section annotation belongs to\n * @param {function} [options.cb] Callback after annotation is added\n * @param {string} className CSS class to assign to annotation\n * @param {object} styles CSS styles to assign to annotation\n * @returns {Annotation} annotation\n */\nclass Annotation {\n\n\tconstructor ({\n\t\ttype,\n\t\tcfiRange,\n\t\tdata,\n\t\tsectionIndex,\n\t\tcb,\n\t\tclassName,\n\t\tstyles\n\t}) {\n\t\tthis.type = type;\n\t\tthis.cfiRange = cfiRange;\n\t\tthis.data = data;\n\t\tthis.sectionIndex = sectionIndex;\n\t\tthis.mark = undefined;\n\t\tthis.cb = cb;\n\t\tthis.className = className;\n\t\tthis.styles = styles;\n\t}\n\n\t/**\n\t * Update stored data\n\t * @param {object} data\n\t */\n\tupdate (data) {\n\t\tthis.data = data;\n\t}\n\n\t/**\n\t * Add to a view\n\t * @param {View} view\n\t */\n\tattach (view) {\n\t\tlet {cfiRange, data, type, mark, cb, className, styles} = this;\n\t\tlet result;\n\n\t\tif (type === \"highlight\") {\n\t\t\tresult = view.highlight(cfiRange, data, cb, className, styles);\n\t\t} else if (type === \"underline\") {\n\t\t\tresult = view.underline(cfiRange, data, cb, className, styles);\n\t\t} else if (type === \"mark\") {\n\t\t\tresult = view.mark(cfiRange, data, cb);\n\t\t}\n\n\t\tthis.mark = result;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Remove from a view\n\t * @param {View} view\n\t */\n\tdetach (view) {\n\t\tlet {cfiRange, type} = this;\n\t\tlet result;\n\n\t\tif (view) {\n\t\t\tif (type === \"highlight\") {\n\t\t\t\tresult = view.unhighlight(cfiRange);\n\t\t\t} else if (type === \"underline\") {\n\t\t\t\tresult = view.ununderline(cfiRange);\n\t\t\t} else if (type === \"mark\") {\n\t\t\t\tresult = view.unmark(cfiRange);\n\t\t\t}\n\t\t}\n\n\t\tthis.mark = undefined;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * [Not Implemented] Get text of an annotation\n\t * @TODO: needs implementation in contents\n\t */\n\ttext () {\n\n\t}\n\n}\n\nEventEmitter(Annotation.prototype);\n\n\nexport default Annotations\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.createElement = createElement;\nfunction createElement(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nexports.default = {\n    createElement: createElement\n};\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.proxyMouse = proxyMouse;\nexports.clone = clone;\n// import 'babelify/polyfill'; // needed for Object.assign\n\nexports.default = {\n    proxyMouse: proxyMouse\n};\n\n/**\n * Start proxying all mouse events that occur on the target node to each node in\n * a set of tracked nodes.\n *\n * The items in tracked do not strictly have to be DOM Nodes, but they do have\n * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.\n *\n * @param target {Node} The node on which to listen for mouse events.\n * @param tracked {Node[]} A (possibly mutable) array of nodes to which to proxy\n *                         events.\n */\n\nfunction proxyMouse(target, tracked) {\n    function dispatch(e) {\n        // We walk through the set of tracked elements in reverse order so that\n        // events are sent to those most recently added first.\n        //\n        // This is the least surprising behaviour as it simulates the way the\n        // browser would work if items added later were drawn \"on top of\"\n        // earlier ones.\n        for (var i = tracked.length - 1; i >= 0; i--) {\n            var t = tracked[i];\n            var x = e.clientX;\n            var y = e.clientY;\n\n            if (e.touches && e.touches.length) {\n                x = e.touches[0].clientX;\n                y = e.touches[0].clientY;\n            }\n\n            if (!contains(t, target, x, y)) {\n                continue;\n            }\n\n            // The event targets this mark, so dispatch a cloned event:\n            t.dispatchEvent(clone(e));\n            // We only dispatch the cloned event to the first matching mark.\n            break;\n        }\n    }\n\n    if (target.nodeName === \"iframe\" || target.nodeName === \"IFRAME\") {\n\n        try {\n            // Try to get the contents if same domain\n            this.target = target.contentDocument;\n        } catch (err) {\n            this.target = target;\n        }\n    } else {\n        this.target = target;\n    }\n\n    var _arr = ['mouseup', 'mousedown', 'click', 'touchstart'];\n    for (var _i = 0; _i < _arr.length; _i++) {\n        var ev = _arr[_i];\n        this.target.addEventListener(ev, function (e) {\n            return dispatch(e);\n        }, false);\n    }\n}\n\n/**\n * Clone a mouse event object.\n *\n * @param e {MouseEvent} A mouse event object to clone.\n * @returns {MouseEvent}\n */\nfunction clone(e) {\n    var opts = Object.assign({}, e, { bubbles: false });\n    try {\n        return new MouseEvent(e.type, opts);\n    } catch (err) {\n        // compat: webkit\n        var copy = document.createEvent('MouseEvents');\n        copy.initMouseEvent(e.type, false, opts.cancelable, opts.view, opts.detail, opts.screenX, opts.screenY, opts.clientX, opts.clientY, opts.ctrlKey, opts.altKey, opts.shiftKey, opts.metaKey, opts.button, opts.relatedTarget);\n        return copy;\n    }\n}\n\n/**\n * Check if the item contains the point denoted by the passed coordinates\n * @param item {Object} An object with getBoundingClientRect and getClientRects\n *                      methods.\n * @param x {Number}\n * @param y {Number}\n * @returns {Boolean}\n */\nfunction contains(item, target, x, y) {\n    // offset\n    var offset = target.getBoundingClientRect();\n\n    function rectContains(r, x, y) {\n        var top = r.top - offset.top;\n        var left = r.left - offset.left;\n        var bottom = top + r.height;\n        var right = left + r.width;\n        return top <= y && left <= x && bottom > y && right > x;\n    }\n\n    // Check overall bounding box first\n    var rect = item.getBoundingClientRect();\n    if (!rectContains(rect, x, y)) {\n        return false;\n    }\n\n    // Then continue to check each child rect\n    var rects = item.getClientRects();\n    for (var i = 0, len = rects.length; i < len; i++) {\n        if (rectContains(rects[i], x, y)) {\n            return true;\n        }\n    }\n    return false;\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Underline = exports.Highlight = exports.Mark = exports.Pane = undefined;\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _svg = require('./svg');\n\nvar _svg2 = _interopRequireDefault(_svg);\n\nvar _events = require('./events');\n\nvar _events2 = _interopRequireDefault(_events);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Pane = exports.Pane = function () {\n    function Pane(target) {\n        var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n\n        _classCallCheck(this, Pane);\n\n        this.target = target;\n        this.element = _svg2.default.createElement('svg');\n        this.marks = [];\n\n        // Match the coordinates of the target element\n        this.element.style.position = 'absolute';\n        // Disable pointer events\n        this.element.setAttribute('pointer-events', 'none');\n\n        // Set up mouse event proxying between the target element and the marks\n        _events2.default.proxyMouse(this.target, this.marks);\n\n        this.container = container;\n        this.container.appendChild(this.element);\n\n        this.render();\n    }\n\n    _createClass(Pane, [{\n        key: 'addMark',\n        value: function addMark(mark) {\n            var g = _svg2.default.createElement('g');\n            this.element.appendChild(g);\n            mark.bind(g, this.container);\n\n            this.marks.push(mark);\n\n            mark.render();\n            return mark;\n        }\n    }, {\n        key: 'removeMark',\n        value: function removeMark(mark) {\n            var idx = this.marks.indexOf(mark);\n            if (idx === -1) {\n                return;\n            }\n            var el = mark.unbind();\n            this.element.removeChild(el);\n            this.marks.splice(idx, 1);\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            setCoords(this.element, coords(this.target, this.container));\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = this.marks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var m = _step.value;\n\n                    m.render();\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n        }\n    }]);\n\n    return Pane;\n}();\n\nvar Mark = exports.Mark = function () {\n    function Mark() {\n        _classCallCheck(this, Mark);\n\n        this.element = null;\n    }\n\n    _createClass(Mark, [{\n        key: 'bind',\n        value: function bind(element, container) {\n            this.element = element;\n            this.container = container;\n        }\n    }, {\n        key: 'unbind',\n        value: function unbind() {\n            var el = this.element;\n            this.element = null;\n            return el;\n        }\n    }, {\n        key: 'render',\n        value: function render() {}\n    }, {\n        key: 'dispatchEvent',\n        value: function dispatchEvent(e) {\n            if (!this.element) return;\n            this.element.dispatchEvent(e);\n        }\n    }, {\n        key: 'getBoundingClientRect',\n        value: function getBoundingClientRect() {\n            return this.element.getBoundingClientRect();\n        }\n    }, {\n        key: 'getClientRects',\n        value: function getClientRects() {\n            var rects = [];\n            var el = this.element.firstChild;\n            while (el) {\n                rects.push(el.getBoundingClientRect());\n                el = el.nextSibling;\n            }\n            return rects;\n        }\n    }, {\n        key: 'filteredRanges',\n        value: function filteredRanges() {\n            var rects = Array.from(this.range.getClientRects());\n\n            // De-duplicate the boxes\n            return rects.filter(function (box) {\n                for (var i = 0; i < rects.length; i++) {\n                    if (rects[i] === box) {\n                        return true;\n                    }\n                    var contained = contains(rects[i], box);\n                    if (contained) {\n                        return false;\n                    }\n                }\n                return true;\n            });\n        }\n    }]);\n\n    return Mark;\n}();\n\nvar Highlight = exports.Highlight = function (_Mark) {\n    _inherits(Highlight, _Mark);\n\n    function Highlight(range, className, data, attributes) {\n        _classCallCheck(this, Highlight);\n\n        var _this = _possibleConstructorReturn(this, (Highlight.__proto__ || Object.getPrototypeOf(Highlight)).call(this));\n\n        _this.range = range;\n        _this.className = className;\n        _this.data = data || {};\n        _this.attributes = attributes || {};\n        return _this;\n    }\n\n    _createClass(Highlight, [{\n        key: 'bind',\n        value: function bind(element, container) {\n            _get(Highlight.prototype.__proto__ || Object.getPrototypeOf(Highlight.prototype), 'bind', this).call(this, element, container);\n\n            for (var attr in this.data) {\n                if (this.data.hasOwnProperty(attr)) {\n                    this.element.dataset[attr] = this.data[attr];\n                }\n            }\n\n            for (var attr in this.attributes) {\n                if (this.attributes.hasOwnProperty(attr)) {\n                    this.element.setAttribute(attr, this.attributes[attr]);\n                }\n            }\n\n            if (this.className) {\n                this.element.classList.add(this.className);\n            }\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            // Empty element\n            while (this.element.firstChild) {\n                this.element.removeChild(this.element.firstChild);\n            }\n\n            var docFrag = this.element.ownerDocument.createDocumentFragment();\n            var filtered = this.filteredRanges();\n            var offset = this.element.getBoundingClientRect();\n            var container = this.container.getBoundingClientRect();\n\n            for (var i = 0, len = filtered.length; i < len; i++) {\n                var r = filtered[i];\n                var el = _svg2.default.createElement('rect');\n                el.setAttribute('x', r.left - offset.left + container.left);\n                el.setAttribute('y', r.top - offset.top + container.top);\n                el.setAttribute('height', r.height);\n                el.setAttribute('width', r.width);\n                docFrag.appendChild(el);\n            }\n\n            this.element.appendChild(docFrag);\n        }\n    }]);\n\n    return Highlight;\n}(Mark);\n\nvar Underline = exports.Underline = function (_Highlight) {\n    _inherits(Underline, _Highlight);\n\n    function Underline(range, className, data, attributes) {\n        _classCallCheck(this, Underline);\n\n        return _possibleConstructorReturn(this, (Underline.__proto__ || Object.getPrototypeOf(Underline)).call(this, range, className, data, attributes));\n    }\n\n    _createClass(Underline, [{\n        key: 'render',\n        value: function render() {\n            // Empty element\n            while (this.element.firstChild) {\n                this.element.removeChild(this.element.firstChild);\n            }\n\n            var docFrag = this.element.ownerDocument.createDocumentFragment();\n            var filtered = this.filteredRanges();\n            var offset = this.element.getBoundingClientRect();\n            var container = this.container.getBoundingClientRect();\n\n            for (var i = 0, len = filtered.length; i < len; i++) {\n                var r = filtered[i];\n\n                var rect = _svg2.default.createElement('rect');\n                rect.setAttribute('x', r.left - offset.left + container.left);\n                rect.setAttribute('y', r.top - offset.top + container.top);\n                rect.setAttribute('height', r.height);\n                rect.setAttribute('width', r.width);\n                rect.setAttribute('fill', 'none');\n\n                var line = _svg2.default.createElement('line');\n                line.setAttribute('x1', r.left - offset.left + container.left);\n                line.setAttribute('x2', r.left - offset.left + container.left + r.width);\n                line.setAttribute('y1', r.top - offset.top + container.top + r.height - 1);\n                line.setAttribute('y2', r.top - offset.top + container.top + r.height - 1);\n\n                line.setAttribute('stroke-width', 1);\n                line.setAttribute('stroke', 'black'); //TODO: match text color?\n                line.setAttribute('stroke-linecap', 'square');\n\n                docFrag.appendChild(rect);\n\n                docFrag.appendChild(line);\n            }\n\n            this.element.appendChild(docFrag);\n        }\n    }]);\n\n    return Underline;\n}(Highlight);\n\nfunction coords(el, container) {\n    var offset = container.getBoundingClientRect();\n    var rect = el.getBoundingClientRect();\n\n    return {\n        top: rect.top - offset.top,\n        left: rect.left - offset.left,\n        height: el.scrollHeight,\n        width: el.scrollWidth\n    };\n}\n\nfunction setCoords(el, coords) {\n    el.style.setProperty('top', coords.top + 'px', 'important');\n    el.style.setProperty('left', coords.left + 'px', 'important');\n    el.style.setProperty('height', coords.height + 'px', 'important');\n    el.style.setProperty('width', coords.width + 'px', 'important');\n}\n\nfunction contains(rect1, rect2) {\n    return rect2.right <= rect1.right && rect2.left >= rect1.left && rect2.top >= rect1.top && rect2.bottom <= rect1.bottom;\n}\n","import EventEmitter from \"event-emitter\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : \"\",\n\t\t\taxis: options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n\t\t\tdirection: undefined,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t\tmethod: undefined\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\t// this.width  = this.settings.width;\n\t\t// this.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis.pane = undefined;\n\t\tthis.highlights = {};\n\t\tthis.underlines = {};\n\t\tthis.marks = {};\n\n\t}\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement(\"div\");\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\t\telement.style.position = \"relative\";\n\t\telement.style.display = \"block\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.flex = \"none\";\n\t\t} else {\n\t\t\telement.style.flex = \"initial\";\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement(\"iframe\");\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.setAttribute(\"ref\", this.index);\n\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\n\t\tif((\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\tif (!this.settings.method) {\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n\t\t}\n\n\t\treturn this.iframe;\n\t}\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\tthis.layout.format(this.contents);\n\n\t\t\t\t// find and report the writingMode axis\n\t\t\t\tlet writingMode = this.contents.writingMode();\n\t\t\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\t\t\tthis.setAxis(axis);\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\n\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\t\tthis.expand();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t}.bind(this), function(e){\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.then(function() {\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\n\t\t\t}.bind(this));\n\n\t}\n\n\treset () {\n\t\tif (this.iframe) {\n\t\t\tthis.iframe.style.width = \"0\";\n\t\t\tthis.iframe.style.height = \"0\";\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._textWidth = undefined;\n\t\t\tthis._contentWidth = undefined;\n\t\t\tthis._textHeight = undefined;\n\t\t\tthis._contentHeight = undefined;\n\t\t}\n\t\tthis._needsReframe = true;\n\t}\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t\tthis.settings.width = width;\n\t\tthis.settings.height = height;\n\t}\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t// this.contents.layout();\n\t\t\tthis.expand();\n\t\t}\n\n\n\n\t}\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\twidth = this.layout.columnWidth;\n\t\t\theight = this.layout.height;\n\t\t}\n\t\t// Expand Horizontally\n\t\telse if(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\twidth = this.contents.textWidth();\n\n\t\t\tif (width % this.layout.pageWidth > 0) {\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n\t\t\t}\n\n\t\t\tif (this.settings.forceEvenPages) {\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\n\t\t\t\tif ( this.layout.divisor > 1 &&\n\t\t\t\t\t\t this.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t// add a blank page\n\t\t\t\t\twidth += this.layout.pageWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\theight = this.contents.textHeight();\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.reframe(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t}\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n\t\tsize = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\twidthDelta: widthDelta,\n\t\t\theightDelta: heightDelta,\n\t\t};\n\n\t\tthis.pane && this.pane.render();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tlet mark;\n\t\t\tfor (let m in this.marks) {\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\n\t\t\t\t\tmark = this.marks[m];\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\n\n\t\tthis.prevBounds = size;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t}\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif (this.settings.method === \"blobUrl\") {\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n\t\t\tthis.iframe.src = this.blobUrl;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else if(this.settings.method === \"srcdoc\"){\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else {\n\n\t\t\tthis.element.appendChild(this.iframe);\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\tonLoad(event, promise) {\n\n\t\tthis.window = this.iframe.contentWindow;\n\t\tthis.document = this.iframe.contentDocument;\n\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n\n\t\tthis.rendering = false;\n\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\tif (link) {\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t} else {\n\t\t\tlink = this.document.createElement(\"link\");\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t}\n\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpromise.resolve(this.contents);\n\t}\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\n\t\tif (this.contents) {\n\t\t\tthis.layout.format(this.contents);\n\t\t\tthis.expand();\n\t\t}\n\t}\n\n\tsetAxis(axis) {\n\n\t\t// Force vertical for scrolled\n\t\tif (this.layout.props.flow === \"scrolled\") {\n\t\t\taxis = \"vertical\";\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tif(axis == \"horizontal\"){\n\t\t\tthis.element.style.flex = \"none\";\n\t\t} else {\n\t\t\tthis.element.style.flex = \"initial\";\n\t\t}\n\n\t\tthis.size();\n\n\t}\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t}\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t}\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\n\t\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\t\tthis.displayed = true;\n\t\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t\t}.bind(this), function (err) {\n\t\t\t\t\tdisplayed.reject(err, this);\n\t\t\t\t});\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t}\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\n\t\t\t// Remind Safari to redraw the iframe\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\n\t\t\tthis.iframe.offsetWidth;\n\t\t\tthis.iframe.style.transform = null;\n\t\t}\n\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\n\t}\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\n\t}\n\n\toffset() {\n\t\treturn {\n\t\t\ttop: this.element.offsetTop,\n\t\t\tleft: this.element.offsetLeft\n\t\t}\n\t}\n\n\twidth() {\n\t\treturn this._width;\n\t}\n\n\theight() {\n\t\treturn this._height;\n\t}\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t}\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": targetPos.left,\n\t\t\t\"top\": targetPos.top\n\t\t};\n\t}\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tbounds(force) {\n\t\tif(force || !this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\n\t\treturn this.elementBounds;\n\t}\n\n\thighlight(cfiRange, data={}, cb, className = \"epubjs-hl\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"fill\": \"yellow\", \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Highlight(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tunderline(cfiRange, data={}, cb, className = \"epubjs-ul\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Underline(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tmark(cfiRange, data={}, cb) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cfiRange in this.marks) {\n\t\t\tlet item = this.marks[cfiRange];\n\t\t\treturn item;\n\t\t}\n\n\t\tlet range = this.contents.range(cfiRange);\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = range.commonAncestorContainer;\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\n\n\t\tlet emitter = (e) => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tif (range.collapsed && container.nodeType === 1) {\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(container);\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(parent);\n\t\t}\n\n\t\tlet mark = this.document.createElement(\"a\");\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\n\t\tmark.style.position = \"absolute\";\n\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\n\n\t\tif (data) {\n\t\t\tObject.keys(data).forEach((key) => {\n\t\t\t\tmark.dataset[key] = data[key];\n\t\t\t});\n\t\t}\n\n\t\tif (cb) {\n\t\t\tmark.addEventListener(\"click\", cb);\n\t\t\tmark.addEventListener(\"touchstart\", cb);\n\t\t}\n\n\t\tmark.addEventListener(\"click\", emitter);\n\t\tmark.addEventListener(\"touchstart\", emitter);\n\n\t\tthis.placeMark(mark, range);\n\n\t\tthis.element.appendChild(mark);\n\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\n\n\t\treturn parent;\n\t}\n\n\tplaceMark(element, range) {\n\t\tlet top, right, left;\n\n\t\tif(this.layout.name === \"pre-paginated\" ||\n\t\t\tthis.settings.axis !== \"horizontal\") {\n\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\ttop = pos.top;\n\t\t\tright = pos.right;\n\t\t} else {\n\t\t\t// Element might break columns, so find the left most element\n\t\t\tlet rects = range.getClientRects();\n\n\t\t\tlet rect;\n\t\t\tfor (var i = 0; i != rects.length; i++) {\n\t\t\t\trect = rects[i];\n\t\t\t\tif (!left || rect.left < left) {\n\t\t\t\t\tleft = rect.left;\n\t\t\t\t\t// right = rect.right;\n\t\t\t\t\tright = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - (this.layout.gap / 2);\n\t\t\t\t\ttop = rect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.style.top = `${top}px`;\n\t\telement.style.left = `${right}px`;\n\t}\n\n\tunhighlight(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.highlights) {\n\t\t\titem = this.highlights[cfiRange];\n\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.highlights[cfiRange];\n\t\t}\n\t}\n\n\tununderline(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.underlines) {\n\t\t\titem = this.underlines[cfiRange];\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.underlines[cfiRange];\n\t\t}\n\t}\n\n\tunmark(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.marks) {\n\t\t\titem = this.marks[cfiRange];\n\t\t\tthis.element.removeChild(item.element);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.marks[cfiRange];\n\t\t}\n\t}\n\n\tdestroy() {\n\n\t\tfor (let cfiRange in this.highlights) {\n\t\t\tthis.unhighlight(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.underlines) {\n\t\t\tthis.ununderline(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.marks) {\n\t\t\tthis.unmark(cfiRange);\n\t\t}\n\n\t\tif (this.blobUrl) {\n\t\t\trevokeBlobUrl(this.blobUrl);\n\t\t}\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\n\t\t\tthis.iframe = undefined;\n\t\t\tthis.contents = undefined;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t}\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","var debounce = require('./debounce'),\n    isObject = require('./isObject');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nmodule.exports = throttle;\n","import {uuid, isNumber, isElement, windowBounds} from \"../../utils/core\";\nimport throttle from 'lodash/throttle'\n\nclass Stage {\n\tconstructor(_options) {\n\t\tthis.settings = _options || {};\n\t\tthis.id = \"epubjs-container-\" + uuid();\n\n\t\tthis.container = this.create(this.settings);\n\n\t\tif(this.settings.hidden) {\n\t\t\tthis.wrapper = this.wrap(this.container);\n\t\t}\n\n\t}\n\n\t/*\n\t* Creates an element to render to.\n\t* Resizes to passed width and height or to the elements size\n\t*/\n\tcreate(options){\n\t\tlet height  = options.height;// !== false ? options.height : \"100%\";\n\t\tlet width   = options.width;// !== false ? options.width : \"100%\";\n\t\tlet overflow  = options.overflow || false;\n\t\tlet axis = options.axis || \"vertical\";\n\t\tlet direction = options.direction;\n\t\tlet scale = options.scale || 1.0;\n\n\t\tif(options.height && isNumber(options.height)) {\n\t\t\theight = options.height + \"px\";\n\t\t}\n\n\t\tif(options.width && isNumber(options.width)) {\n\t\t\twidth = options.width + \"px\";\n\t\t}\n\n\t\t// Create new container element\n\t\tlet container = document.createElement(\"div\");\n\n\t\tcontainer.id = this.id;\n\t\tcontainer.classList.add(\"epub-container\");\n\n\t\t// Style Element\n\t\t// container.style.fontSize = \"0\";\n\t\tcontainer.style.wordSpacing = \"0\";\n\t\tcontainer.style.lineHeight = \"0\";\n\t\tcontainer.style.verticalAlign = \"top\";\n\t\tcontainer.style.position = \"relative\";\n\n\t\tif(axis === \"horizontal\") {\n\t\t\t// container.style.whiteSpace = \"nowrap\";\n\t\t\tcontainer.style.display = \"flex\";\n\t\t\tcontainer.style.flexDirection = \"row\";\n\t\t\tcontainer.style.flexWrap = \"nowrap\";\n\t\t}\n\n\t\tif(width){\n\t\t\tcontainer.style.width = width;\n\t\t}\n\n\t\tif(height){\n\t\t\tcontainer.style.height = height;\n\t\t}\n\n\t\tif (overflow) {\n\t\t\tcontainer.style.overflow = overflow;\n\t\t}\n\n\t\tif (direction) {\n\t\t\tcontainer.dir = direction;\n\t\t\tcontainer.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (direction && this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (scale && scale > 1.0) {\n\t\t\tcontainer.style[\"transform-origin\"] = \"top left\";\n\t\t\tcontainer.style[\"transform\"] = \"scale(\" + scale + \")\";\n\t\t\tcontainer.style.overflow = \"visible\";\n\t\t} else {\n\t\t\tcontainer.style[\"transform-origin\"] = null;\n\t\t\tcontainer.style[\"transform\"] = null;\n\t\t}\n\n\t\treturn container;\n\t}\n\n\twrap(container) {\n\t\tvar wrapper = document.createElement(\"div\");\n\n\t\twrapper.style.visibility = \"hidden\";\n\t\twrapper.style.overflow = \"hidden\";\n\t\twrapper.style.width = \"0\";\n\t\twrapper.style.height = \"0\";\n\n\t\twrapper.appendChild(container);\n\t\treturn wrapper;\n\t}\n\n\n\tgetElement(_element){\n\t\tvar element;\n\n\t\tif(isElement(_element)) {\n\t\t\telement = _element;\n\t\t} else if (typeof _element === \"string\") {\n\t\t\telement = document.getElementById(_element);\n\t\t}\n\n\t\tif(!element){\n\t\t\tthrow new Error(\"Not an Element\");\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tattachTo(what){\n\n\t\tvar element = this.getElement(what);\n\t\tvar base;\n\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.hidden) {\n\t\t\tbase = this.wrapper;\n\t\t} else {\n\t\t\tbase = this.container;\n\t\t}\n\n\t\telement.appendChild(base);\n\n\t\tthis.element = element;\n\n\t\treturn element;\n\n\t}\n\n\tgetContainer() {\n\t\treturn this.container;\n\t}\n\n\tonResize(func){\n\t\t// Only listen to window for resize event if width and height are not fixed.\n\t\t// This applies if it is set to a percent or auto.\n\t\tif(!isNumber(this.settings.width) ||\n\t\t\t !isNumber(this.settings.height) ) {\n\t\t\tthis.resizeFunc = throttle(func, 50);\n\t\t\twindow.addEventListener(\"resize\", this.resizeFunc, false);\n\t\t}\n\n\t}\n\n\tonOrientationChange(func){\n\t\tthis.orientationChangeFunc = func;\n\t\twindow.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\n\t}\n\n\tsize(width, height){\n\t\tvar bounds;\n\t\tlet _width = width || this.settings.width;\n\t\tlet _height = height || this.settings.height;\n\n\t\t// If width or height are set to false, inherit them from containing element\n\t\tif(width === null) {\n\t\t\tbounds = this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.width) {\n\t\t\t\twidth = Math.floor(bounds.width);\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.width = width;\n\t\t\t}\n\t\t}\n\n\t\tif(height === null) {\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.height) {\n\t\t\t\theight = bounds.height;\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.height = height;\n\t\t\t}\n\t\t}\n\n\t\tif(!isNumber(width)) {\n\t\t\tbounds = this.container.getBoundingClientRect();\n\t\t\twidth = Math.floor(bounds.width);\n\t\t\t//height = bounds.height;\n\t\t}\n\n\t\tif(!isNumber(height)) {\n\t\t\tbounds = bounds || this.container.getBoundingClientRect();\n\t\t\t//width = bounds.width;\n\t\t\theight = bounds.height;\n\t\t}\n\n\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\n\n\t\tthis.containerPadding = {\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\t// Bounds not set, get them from window\n\t\tlet _windowBounds = windowBounds();\n\t\tlet bodyStyles = window.getComputedStyle(document.body);\n\t\tlet bodyPadding = {\n\t\t\tleft: parseFloat(bodyStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(bodyStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(bodyStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\tif (!_width) {\n\t\t\twidth = _windowBounds.width -\n\t\t\t\t\t\t\t\tbodyPadding.left -\n\t\t\t\t\t\t\t\tbodyPadding.right;\n\t\t}\n\n\t\tif ((this.settings.fullsize && !_height) || !_height) {\n\t\t\theight = _windowBounds.height -\n\t\t\t\t\t\t\t\tbodyPadding.top -\n\t\t\t\t\t\t\t\tbodyPadding.bottom;\n\t\t}\n\n\t\treturn {\n\t\t\twidth: width -\n\t\t\t\t\t\t\tthis.containerPadding.left -\n\t\t\t\t\t\t\tthis.containerPadding.right,\n\t\t\theight: height -\n\t\t\t\t\t\t\tthis.containerPadding.top -\n\t\t\t\t\t\t\tthis.containerPadding.bottom\n\t\t};\n\n\t}\n\n\tbounds(){\n\t\tlet box;\n\t\tif (this.container.style.overflow !== \"visible\") {\n\t\t\tbox = this.container && this.container.getBoundingClientRect();\n\t\t}\n\n\t\tif(!box || !box.width || !box.height) {\n\t\t\treturn windowBounds();\n\t\t} else {\n\t\t\treturn box;\n\t\t}\n\n\t}\n\n\tgetSheet(){\n\t\tvar style = document.createElement(\"style\");\n\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\t\tstyle.appendChild(document.createTextNode(\"\"));\n\n\t\tdocument.head.appendChild(style);\n\n\t\treturn style.sheet;\n\t}\n\n\taddStyleRules(selector, rulesArray){\n\t\tvar scope = \"#\" + this.id + \" \";\n\t\tvar rules = \"\";\n\n\t\tif(!this.sheet){\n\t\t\tthis.sheet = this.getSheet();\n\t\t}\n\n\t\trulesArray.forEach(function(set) {\n\t\t\tfor (var prop in set) {\n\t\t\t\tif(set.hasOwnProperty(prop)) {\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n\t}\n\n\taxis(axis) {\n\t\tif(axis === \"horizontal\") {\n\t\t\tthis.container.style.display = \"flex\";\n\t\t\tthis.container.style.flexDirection = \"row\";\n\t\t\tthis.container.style.flexWrap = \"nowrap\";\n\t\t} else {\n\t\t\tthis.container.style.display = \"block\";\n\t\t}\n\t}\n\n\t// orientation(orientation) {\n\t// \tif (orientation === \"landscape\") {\n\t//\n\t// \t} else {\n\t//\n\t// \t}\n\t//\n\t// \tthis.orientation = orientation;\n\t// }\n\n\tdirection(dir) {\n\t\tif (this.container) {\n\t\t\tthis.container.dir = dir;\n\t\t\tthis.container.style[\"direction\"] = dir;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\toverflow(overflow) {\n\t\tif (this.container) {\n\t\t\tthis.container.style[\"overflow\"] = overflow;\n\t\t}\n\t}\n\n\tscale(s) {\n\t\tif (this.container) {\n\t\t\tif ( s > 1.0 ) {\n\t\t\t\tthis.container.style[\"transform-origin\"] = \"top left\";\n\t\t\t\tthis.container.style[\"transform\"] = \"scale(\" + s + \")\";\n\t\t\t\tthis.container.style.overflow = \"visible\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.overflow = null;\n\t\t\t\tthis.container.style[\"transform-origin\"] = null;\n\t\t\t\tthis.container.style[\"transform\"] = null;\n\t\t\t}\n\t\t\tthis.settings.scale = s;\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tvar base;\n\n\t\tif (this.element) {\n\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tbase = this.wrapper;\n\t\t\t} else {\n\t\t\t\tbase = this.container;\n\t\t\t}\n\n\t\t\tif(this.element.contains(this.container)) {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\n\t\t\twindow.removeEventListener(\"resize\", this.resizeFunc);\n\t\t\twindow.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\n\n\t\t}\n\t}\n}\n\nexport default Stage;\n","class Views {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t}\n\n\tall() {\n\t\treturn this._views;\n\t}\n\n\tfirst() {\n\t\treturn this._views[0];\n\t}\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t}\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t}\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t}\n\n\tget(i) {\n\t\treturn this._views[i];\n\t}\n\n\tappend(view){\n\t\tthis._views.push(view);\n\t\tif(this.container){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t}\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\tif(this.container){\n\t\t\t this.container.removeChild(view.element);\n\t\t}\n\t\tview = null;\n\t}\n\n\t// Iterators\n\n\tforEach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t}\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t}\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t}\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t}\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t}\n}\n\nexport default Views;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber} from \"../../utils/core\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.optsSettings = options.settings;\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\taxis: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\tignoreClass: \"\",\n\t\t\tfullsize: undefined\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: true\n\t\t};\n\n\t\tthis.rendered = false;\n\n\t}\n\n\trender(element, size){\n\t\tlet tag = element.tagName;\n\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\n\t\t\t\ttag && (tag.toLowerCase() == \"body\" ||\n\t\t\t\ttag.toLowerCase() == \"html\")) {\n\t\t\t\tthis.settings.fullsize = true;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tthis.settings.overflow = \"visible\";\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.settings.size = size;\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis,\n\t\t\tfullsize: this.settings.fullsize,\n\t\t\tdirection: this.settings.direction,\n\t\t\tscale: this.settings.scale\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\n\t\tthis.rendered = true;\n\n\t}\n\n\taddEventListeners(){\n\t\tvar scroller;\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tdestroy(){\n\t\tclearTimeout(this.orientationTimeout);\n\t\tclearTimeout(this.resizeTimeout);\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.clear();\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.stage.destroy();\n\n\t\tthis.rendered = false;\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t}\n\n\tonOrientationChange(e) {\n\t\tlet {orientation} = window;\n\n\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\tthis.resize();\n\t\t}\n\n\t\t// Per ampproject:\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\n\t\t// element size depends on window size directly and the measurement\n\t\t// happens in window.resize event. Adding a timeout for correct\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\n\t\tclearTimeout(this.orientationTimeout);\n\t\tthis.orientationTimeout = setTimeout(function(){\n\t\t\tthis.orientationTimeout = undefined;\n\n\t\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\t\tthis.resize();\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n\t\t}.bind(this), 500);\n\n\t}\n\n\tonResized(e) {\n\t\tthis.resize();\n\t}\n\n\tresize(width, height){\n\t\tlet stageSize = this.stage.size(width, height);\n\n\t\t// For Safari, wait for orientation to catch up\n\t\t// if the window is a square\n\t\tthis.winBounds = windowBounds();\n\t\tif (this.orientationTimeout &&\n\t\t\t\tthis.winBounds.width === this.winBounds.height) {\n\t\t\t// reset the stage size for next resize\n\t\t\tthis._stageSize = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._stageSize &&\n\t\t\t\tthis._stageSize.width === stageSize.width &&\n\t\t\t\tthis._stageSize.height === stageSize.height ) {\n\t\t\t// Size is the same, no need to resize\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = stageSize;\n\n\t\tthis._bounds = this.bounds();\n\n\t\t// Clear current views\n\t\tthis.clear();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\n\t\t\twidth: this._stageSize.width,\n\t\t\theight: this._stageSize.height\n\t\t});\n\t}\n\n\tcreateView(section) {\n\t\treturn new this.View(section, this.viewSettings);\n\t}\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check if moving to target is needed\n\t\tif (target === section.href || isNumber(target)) {\n\t\t\ttarget = undefined;\n\t\t}\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location in view\n\t\tif(visible && section) {\n\t\t\tlet offset = visible.offset();\n\n\t\t\tif (this.settings.direction === \"ltr\") {\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\n\t\t\t} else {\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\n\t\t\t}\n\n\t\t\tif(target) {\n\t\t\t\tlet offset = visible.locationOf(target);\n\t\t\t\tthis.moveTo(offset);\n\t\t\t}\n\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.clear();\n\n\t\tthis.add(section)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\tlet offset = view.locationOf(target);\n\t\t\t\t\tthis.moveTo(offset);\n\t\t\t\t}\n\n\t\t\t}.bind(this), (err) => {\n\t\t\t\tdisplaying.reject(err);\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tvar next;\n\t\t\t\tif (this.layout.name === \"pre-paginated\" &&\n\t\t\t\t\t\tthis.layout.divisor > 1 && section.index > 0) {\n\t\t\t\t\t// First page (cover) should stand alone for pre-paginated books\n\t\t\t\t\tnext = section.next();\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\treturn this.add(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this));\n\t\t// .then(function(){\n\t\t// \treturn this.hooks.display.trigger(view);\n\t\t// }.bind(this))\n\t\t// .then(function(){\n\t\t// \tthis.views.show();\n\t\t// }.bind(this));\n\t\treturn displayed;\n\t}\n\n\tafterDisplayed(view){\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\tmoveTo(offset){\n\t\tvar distX = 0,\n\t\t\t  distY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\t\t}\n\t\tthis.scrollTo(distX, distY, true);\n\t}\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\n\t}\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar left;\n\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top  = this.container.scrollTop + this.container.offsetHeight;\n\n\t\t\tif(top < this.container.scrollHeight) {\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else {\n\t\t\tnext = this.views.last().section.next();\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.clear();\n\n\t\t\treturn this.append(next)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar right;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tright = next.next();\n\t\t\t\t\t\tif (right) {\n\t\t\t\t\t\t\treturn this.append(right);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t}\n\n\tprev(){\n\t\tvar prev;\n\t\tvar left;\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top = this.container.scrollTop;\n\n\t\t\tif(top > 0) {\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.clear();\n\n\t\t\treturn this.prepend(prev)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear () {\n\n\t\t// this.q.clear();\n\n\t\tif (this.views) {\n\t\t\tthis.views.hide();\n\t\t\tthis.scrollTo(0,0, true);\n\t\t\tthis.views.clear();\n\t\t}\n\t}\n\n\tcurrentLocation(){\n\n\t\tif (this.settings.axis === \"vertical\") {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t} else {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t}\n\t\treturn this.location;\n\t}\n\n\tscrolledLocation() {\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\t\tlet pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\n\t\tlet offset = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\toffset = window.scrollY;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet position = view.position();\n\t\t\tlet height = view.height();\n\n\t\t\tlet startPos = offset + container.top - position.top + used;\n\t\t\tlet endPos = startPos + pageHeight - used;\n\t\t\tif (endPos > height) {\n\t\t\t\tendPos = height;\n\t\t\t\tused = (endPos - startPos);\n\t\t\t}\n\n\t\t\tlet totalPages = this.layout.count(height, pageHeight).pages;\n\n\t\t\tlet currPage = Math.ceil(startPos / pageHeight);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.ceil(endPos / pageHeight);\n\n\t\t\tpages = [];\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\n\t\t\t\tlet pg = i + 1;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tpaginatedLocation(){\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\n\t\tlet left = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\tleft = window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet offset = view.offset().left;\n\t\t\tlet position = view.position().left;\n\t\t\tlet width = view.width();\n\n\t\t\t// Find mapping\n\t\t\tlet start = left + container.left - position + used;\n\t\t\tlet end = start + this.layout.width - used;\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n\n\t\t\t// Find displayed pages\n\t\t\t//console.log(\"pre\", end, offset + width);\n\t\t\t// if (end > offset + width) {\n\t\t\t// \tend = offset + width;\n\t\t\t// \tused = this.layout.pageWidth;\n\t\t\t// }\n\t\t\t// console.log(\"post\", end);\n\n\t\t\tlet totalPages = this.layout.count(width).pages;\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\n\n\t\t\t// start page should not be negative\n\t\t\tif (startPage < 0) {\n\t\t\t\tstartPage = 0;\n\t\t\t\tendPage = endPage + 1;\n\t\t\t}\n\n\t\t\t// Reverse page counts for rtl\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\tlet tempStartPage = startPage;\n\t\t\t\tstartPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\n\t\t\t\tlet pg = i;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvisible(){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t}\n\n\tscrollBy(x, y, silent){\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tif(x) this.container.scrollLeft += x * dir;\n\t\t\tif(y) this.container.scrollTop += y;\n\t\t} else {\n\t\t\twindow.scrollBy(x * dir, y * dir);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY;\n\t\t\tscrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\t\ttop: scrollTop,\n\t\t\t\tleft: scrollLeft\n\t\t\t});\n\n\t\t\tclearTimeout(this.afterScrolled);\n\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t});\n\t\t\t}.bind(this), 20);\n\n\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t}\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t}\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\t\t // this.manager.layout(this.layout.format);\n\t}\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(!this.isPaginated) {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta;\n\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\t}\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.forEach(function(view){\n\t\t\t\tif (view) {\n\t\t\t\t\tview.setLayout(layout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tupdateAxis(axis, forceUpdate){\n\n\t\tif (!this.isPaginated) {\n\t\t\taxis = \"vertical\";\n\t\t}\n\n\t\tif (!forceUpdate && axis === this.settings.axis) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.stage && this.stage.axis(axis);\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tif (this.mapping) {\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n\t\t}\n\n\t\tif (this.layout) {\n\t\t\tif (axis === \"vertical\") {\n\t\t\t\tthis.layout.spread(\"none\");\n\t\t\t} else {\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFlow(flow){\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\n\n\t\tthis.isPaginated = isPaginated;\n\n\t\tif (flow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\tflow === \"scrolled\") {\n\t\t\tthis.updateAxis(\"vertical\");\n\t\t} else {\n\t\t\tthis.updateAxis(\"horizontal\");\n\t\t}\n\n\t\tthis.viewSettings.flow = flow;\n\n\t\tif (!this.settings.overflow) {\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : \"auto\";\n\t\t} else {\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.stage && this.stage.overflow(this.overflow);\n\n\t\tthis.updateLayout();\n\n\t}\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tif (!this.views) {\n\t\t\treturn contents;\n\t\t}\n\t\tthis.views.forEach(function(view){\n\t\t\tconst viewContents = view && view.contents;\n\t\t\tif (viewContents) {\n\t\t\t\tcontents.push(viewContents);\n\t\t\t}\n\t\t});\n\t\treturn contents;\n\t}\n\n\tdirection(dir=\"ltr\") {\n\t\tthis.settings.direction = dir;\n\n\t\tthis.stage && this.stage.direction(dir);\n\n\t\tthis.viewSettings.direction = dir;\n\n\t\tthis.updateLayout();\n\t}\n\n\tisRendered() {\n\t\treturn this.rendered;\n\t}\n\n\tscale(s) {\n\t\tif ( s == null ) { s = 1.0; }\n\t\tthis.settings.scale = s;\n\n\t\tif (this.stage) {\n\t\t\tthis.stage.scale(s);\n\t\t}\n\t}\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n","import {extend, defer, requestAnimationFrame, prefixed} from \"../../utils/core\";\nimport { EVENTS, DOM_EVENTS } from \"../../utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n// easing equations from https://github.com/danro/easing-js/blob/master/easing.js\nconst PI_D2 = (Math.PI / 2);\nconst EASING_EQUATIONS = {\n\t\teaseOutSine: function (pos) {\n\t\t\t\treturn Math.sin(pos * PI_D2);\n\t\t},\n\t\teaseInOutSine: function (pos) {\n\t\t\t\treturn (-0.5 * (Math.cos(Math.PI * pos) - 1));\n\t\t},\n\t\teaseInOutQuint: function (pos) {\n\t\t\t\tif ((pos /= 0.5) < 1) {\n\t\t\t\t\t\treturn 0.5 * Math.pow(pos, 5);\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (Math.pow((pos - 2), 5) + 2);\n\t\t},\n\t\teaseInCubic: function(pos) {\n\t\t\treturn Math.pow(pos, 3);\n  \t}\n};\n\nclass Snap {\n\tconstructor(manager, options) {\n\n\t\tthis.settings = extend({\n\t\t\tduration: 80,\n\t\t\tminVelocity: 0.2,\n\t\t\tminDistance: 10,\n\t\t\teasing: EASING_EQUATIONS['easeInCubic']\n\t\t}, options || {});\n\n\t\tthis.supportsTouch = this.supportsTouch();\n\n\t\tif (this.supportsTouch) {\n\t\t\tthis.setup(manager);\n\t\t}\n\t}\n\n\tsetup(manager) {\n\t\tthis.manager = manager;\n\n\t\tthis.layout = this.manager.layout;\n\n\t\tthis.fullsize = this.manager.settings.fullsize;\n\t\tif (this.fullsize) {\n\t\t\tthis.element = this.manager.stage.element;\n\t\t\tthis.scroller = window;\n\t\t\tthis.disableScroll();\n\t\t} else {\n\t\t\tthis.element = this.manager.stage.container;\n\t\t\tthis.scroller = this.element;\n\t\t\tthis.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\n\t\t}\n\n\t\t// this.overflow = this.manager.overflow;\n\n\t\t// set lookahead offset to page width\n\t\tthis.manager.settings.offset = this.layout.width;\n\t\tthis.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\n\n\t\tthis.isVertical = this.manager.settings.axis === \"vertical\";\n\n\t\t// disable snapping if not paginated or axis in not horizontal\n\t\tif (!this.manager.isPaginated || this.isVertical) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.touchCanceler = false;\n\t\tthis.resizeCanceler = false;\n\t\tthis.snapping = false;\n\n\n\t\tthis.scrollLeft;\n\t\tthis.scrollTop;\n\n\t\tthis.startTouchX = undefined;\n\t\tthis.startTouchY = undefined;\n\t\tthis.startTime = undefined;\n\t\tthis.endTouchX = undefined;\n\t\tthis.endTouchY = undefined;\n\t\tthis.endTime = undefined;\n\n\t\tthis.addListeners();\n\t}\n\n\tsupportsTouch() {\n\t\tif (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tdisableScroll() {\n\t\tthis.element.style.overflow = \"hidden\";\n\t}\n\n\tenableScroll() {\n\t\tthis.element.style.overflow = \"\";\n\t}\n\n\taddListeners() {\n\t\tthis._onResize = this.onResize.bind(this);\n\t\twindow.addEventListener('resize', this._onResize);\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tthis.scroller.addEventListener('scroll', this._onScroll);\n\n\t\tthis._onTouchStart = this.onTouchStart.bind(this);\n\t\tthis.scroller.addEventListener('touchstart', this._onTouchStart, { passive: true });\n\t\tthis.on('touchstart', this._onTouchStart);\n\n\t\tthis._onTouchMove = this.onTouchMove.bind(this);\n\t\tthis.scroller.addEventListener('touchmove', this._onTouchMove, { passive: true });\n\t\tthis.on('touchmove', this._onTouchMove);\n\n\t\tthis._onTouchEnd = this.onTouchEnd.bind(this);\n\t\tthis.scroller.addEventListener('touchend', this._onTouchEnd, { passive: true });\n\t\tthis.on('touchend', this._onTouchEnd);\n\n\t\tthis._afterDisplayed = this.afterDisplayed.bind(this);\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n\t}\n\n\tremoveListeners() {\n\t\twindow.removeEventListener('resize', this._onResize);\n\t\tthis._onResize = undefined;\n\n\t\tthis.scroller.removeEventListener('scroll', this._onScroll);\n\t\tthis._onScroll = undefined;\n\n\t\tthis.scroller.removeEventListener('touchstart', this._onTouchStart, { passive: true });\n\t\tthis.off('touchstart', this._onTouchStart);\n\t\tthis._onTouchStart = undefined;\n\n\t\tthis.scroller.removeEventListener('touchmove', this._onTouchMove, { passive: true });\n\t\tthis.off('touchmove', this._onTouchMove);\n\t\tthis._onTouchMove = undefined;\n\n\t\tthis.scroller.removeEventListener('touchend', this._onTouchEnd, { passive: true });\n\t\tthis.off('touchend', this._onTouchEnd);\n\t\tthis._onTouchEnd = undefined;\n\n\t\tthis.manager.off(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n\t\tthis._afterDisplayed = undefined;\n\t}\n\n\tafterDisplayed(view) {\n\t\tlet contents = view.contents;\n\t\t[\"touchstart\", \"touchmove\", \"touchend\"].forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\t}\n\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\tonScroll(e) {\n\t\tthis.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\n\t\tthis.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\n\t}\n\n\tonResize(e) {\n\t\tthis.resizeCanceler = true;\n\t}\n\n\tonTouchStart(e) {\n\t\tlet { screenX, screenY } = e.touches[0];\n\n\t\tif (this.fullsize) {\n\t\t\tthis.enableScroll();\n\t\t}\n\n\t\tthis.touchCanceler = true;\n\n\t\tif (!this.startTouchX) {\n\t\t\tthis.startTouchX = screenX;\n\t\t\tthis.startTouchY = screenY;\n\t\t\tthis.startTime = this.now();\n\t\t}\n\n\t\tthis.endTouchX = screenX;\n\t\tthis.endTouchY = screenY;\n\t\tthis.endTime = this.now();\n\t}\n\n\tonTouchMove(e) {\n\t\tlet { screenX, screenY } = e.touches[0];\n\t\tlet deltaY = Math.abs(screenY - this.endTouchY);\n\n\t\tthis.touchCanceler = true;\n\n\n\t\tif (!this.fullsize && deltaY < 10) {\n\t\t\tthis.element.scrollLeft -= screenX - this.endTouchX;\n\t\t}\n\n\t\tthis.endTouchX = screenX;\n\t\tthis.endTouchY = screenY;\n\t\tthis.endTime = this.now();\n\t}\n\n\tonTouchEnd(e) {\n\t\tif (this.fullsize) {\n\t\t\tthis.disableScroll();\n\t\t}\n\n\t\tthis.touchCanceler = false;\n\n\t\tlet swipped = this.wasSwiped();\n\n\t\tif (swipped !== 0) {\n\t\t\tthis.snap(swipped);\n\t\t} else {\n\t\t\tthis.snap();\n\t\t}\n\n\t\tthis.startTouchX = undefined;\n\t\tthis.startTouchY = undefined;\n\t\tthis.startTime = undefined;\n\t\tthis.endTouchX = undefined;\n\t\tthis.endTouchY = undefined;\n\t\tthis.endTime = undefined;\n\t}\n\n\twasSwiped() {\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\tlet distance = (this.endTouchX - this.startTouchX);\n\t\tlet absolute = Math.abs(distance);\n\t\tlet time = this.endTime - this.startTime;\n\t\tlet velocity = (distance / time);\n\t\tlet minVelocity = this.settings.minVelocity;\n\n\t\tif (absolute <= this.settings.minDistance || absolute >= snapWidth) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (velocity > minVelocity) {\n\t\t\t// previous\n\t\t\treturn -1;\n\t\t} else if (velocity < -minVelocity) {\n\t\t\t// next\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\tneedsSnap() {\n\t\tlet left = this.scrollLeft;\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\treturn (left % snapWidth) !== 0;\n\t}\n\n\tsnap(howMany=0) {\n\t\tlet left = this.scrollLeft;\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\tlet snapTo = Math.round(left / snapWidth) * snapWidth;\n\n\t\tif (howMany) {\n\t\t\tsnapTo += (howMany * snapWidth);\n\t\t}\n\n\t\treturn this.smoothScrollTo(snapTo);\n\t}\n\n\tsmoothScrollTo(destination) {\n\t\tconst deferred = new defer();\n\t\tconst start = this.scrollLeft;\n\t\tconst startTime = this.now();\n\n\t\tconst duration = this.settings.duration;\n\t\tconst easing = this.settings.easing;\n\n\t\tthis.snapping = true;\n\n\t\t// add animation loop\n\t\tfunction tick() {\n\t\t\tconst now = this.now();\n\t\t\tconst time = Math.min(1, ((now - startTime) / duration));\n\t\t\tconst timeFunction = easing(time);\n\n\n\t\t\tif (this.touchCanceler || this.resizeCanceler) {\n\t\t\t\tthis.resizeCanceler = false;\n\t\t\t\tthis.snapping = false;\n\t\t\t\tdeferred.resolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (time < 1) {\n\t\t\t\t\twindow.requestAnimationFrame(tick.bind(this));\n\t\t\t\t\tthis.scrollTo(start + ((destination - start) * time), 0);\n\t\t\t} else {\n\t\t\t\t\tthis.scrollTo(destination, 0);\n\t\t\t\t\tthis.snapping = false;\n\t\t\t\t\tdeferred.resolve();\n\t\t\t}\n\t\t}\n\n\t\ttick.call(this);\n\n\t\treturn deferred.promise;\n\t}\n\n\tscrollTo(left=0, top=0) {\n\t\tif (this.fullsize) {\n\t\t\twindow.scroll(left, top);\n\t\t} else {\n\t\t\tthis.scroller.scrollLeft = left;\n\t\t\tthis.scroller.scrollTop = top;\n\t\t}\n\t}\n\n\tnow() {\n\t\treturn ('now' in window.performance) ? performance.now() : new Date().getTime();\n\t}\n\n\tdestroy() {\n\t\tif (!this.scroller) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.fullsize) {\n\t\t\tthis.enableScroll();\n\t\t}\n\n\t\tthis.removeListeners();\n\n\t\tthis.scroller = undefined;\n\t}\n}\n\nEventEmitter(Snap.prototype);\n\nexport default Snap;\n","import {extend, defer, requestAnimationFrame} from \"../../utils/core\";\nimport DefaultViewManager from \"../default\";\nimport Snap from \"../helpers/snap\";\nimport { EVENTS } from \"../../utils/constants\";\nimport debounce from \"lodash/debounce\";\n\nclass ContinuousViewManager extends DefaultViewManager {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.name = \"continuous\";\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\toverflow: undefined,\n\t\t\taxis: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\toffset: 500,\n\t\t\toffsetDelta: 250,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsnap: false,\n\t\t\tafterScrolledTimeout: 10\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\t// Gap can be 0, but defaults doesn't handle that\n\t\tif (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\n\t\t\tthis.settings.gap = options.settings.gap;\n\t\t}\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: false\n\t\t};\n\n\t\tthis.scrollTop = 0;\n\t\tthis.scrollLeft = 0;\n\t}\n\n\tdisplay(section, target){\n\t\treturn DefaultViewManager.prototype.display.call(this, section, target)\n\t\t\t.then(function () {\n\t\t\t\treturn this.fill();\n\t\t\t}.bind(this));\n\t}\n\n\tfill(_full){\n\t\tvar full = _full || new defer();\n\n\t\tthis.q.enqueue(() => {\n\t\t\treturn this.check();\n\t\t}).then((result) => {\n\t\t\tif (result) {\n\t\t\t\tthis.fill(full);\n\t\t\t} else {\n\t\t\t\tfull.resolve();\n\t\t\t}\n\t\t});\n\n\t\treturn full.promise;\n\t}\n\n\tmoveTo(offset){\n\t\t// var bounds = this.stage.bounds();\n\t\t// var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tvar offsetX = 0,\n\t\t\t\toffsetY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t\toffsetY = offset.top+this.settings.offsetDelta;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\t\t\toffsetX = distX+this.settings.offsetDelta;\n\t\t}\n\n\t\tif (distX > 0 || distY > 0) {\n\t\t\tthis.scrollBy(distX, distY, true);\n\t\t}\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\t// Remove Previous Listeners if present\n\tremoveShownListeners(view){\n\n\t\t// view.off(\"shown\", this.afterDisplayed);\n\t\t// view.off(\"shown\", this.afterDisplayedAbove);\n\t\tview.onDisplayed = function(){};\n\n\t}\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\treturn view.display(this.request);\n\t}\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\n\t\treturn view;\n\t}\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\n\t\treturn view;\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\tupdate(_offset){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.all();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tvar updating = new defer();\n\t\tvar promises = [];\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\n\t\t\tisVisible = this.isVisible(view, offset, offset, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\t// console.log(\"visible \" + view.index);\n\n\t\t\t\tif (!view.displayed) {\n\t\t\t\t\tlet displayed = view.display(this.request)\n\t\t\t\t\t\t.then(function (view) {\n\t\t\t\t\t\t\tview.show();\n\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\tview.hide();\n\t\t\t\t\t\t});\n\t\t\t\t\tpromises.push(displayed);\n\t\t\t\t} else {\n\t\t\t\t\tview.show();\n\t\t\t\t}\n\t\t\t\tvisible.push(view);\n\t\t\t} else {\n\t\t\t\tthis.q.enqueue(view.destroy.bind(view));\n\t\t\t\t// console.log(\"hidden \" + view.index);\n\n\t\t\t\tclearTimeout(this.trimTimeout);\n\t\t\t\tthis.trimTimeout = setTimeout(function(){\n\t\t\t\t\tthis.q.enqueue(this.trim.bind(this));\n\t\t\t\t}.bind(this), 250);\n\t\t\t}\n\n\t\t}\n\n\t\tif(promises.length){\n\t\t\treturn Promise.all(promises)\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tupdating.reject(err);\n\t\t\t\t});\n\t\t} else {\n\t\t\tupdating.resolve();\n\t\t\treturn updating.promise;\n\t\t}\n\n\t}\n\n\tcheck(_offsetLeft, _offsetTop){\n\t\tvar checking = new defer();\n\t\tvar newViews = [];\n\n\t\tvar horizontal = (this.settings.axis === \"horizontal\");\n\t\tvar delta = this.settings.offset || 0;\n\n\t\tif (_offsetLeft && horizontal) {\n\t\t\tdelta = _offsetLeft;\n\t\t}\n\n\t\tif (_offsetTop && !horizontal) {\n\t\t\tdelta = _offsetTop;\n\t\t}\n\n\t\tvar bounds = this._bounds; // bounds saved this until resize\n\n\t\tlet rtl = this.settings.direction === \"rtl\";\n\t\tlet dir = horizontal && rtl ? -1 : 1; //RTL reverses scrollTop\n\n\t\tvar offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n\t\tvar visibleLength = horizontal ? Math.floor(bounds.width) : bounds.height;\n\t\tvar contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n\t\tlet prepend = () => {\n\t\t\tlet first = this.views.first();\n\t\t\tlet prev = first && first.section.prev();\n\n\t\t\tif(prev) {\n\t\t\t\tnewViews.push(this.prepend(prev));\n\t\t\t}\n\t\t};\n\n\t\tlet append = () => {\n\t\t\tlet last = this.views.last();\n\t\t\tlet next = last && last.section.next();\n\n\t\t\tif(next) {\n\t\t\t\tnewViews.push(this.append(next));\n\t\t\t}\n\n\t\t};\n\n\t\tif (offset + visibleLength + delta >= contentLength) {\n\t\t\tif (horizontal && rtl) {\n\t\t\t\tprepend();\n\t\t\t} else {\n\t\t\t\tappend();\n\t\t\t}\n\t\t}\n\n\t\tif (offset - delta < 0 ) {\n\t\t\tif (horizontal && rtl) {\n\t\t\t\tappend();\n\t\t\t} else {\n\t\t\t\tprepend();\n\t\t\t}\n\t\t}\n\n\t\tlet promises = newViews.map((view) => {\n\t\t\treturn view.displayed;\n\t\t});\n\n\t\tif(newViews.length){\n\t\t\treturn Promise.all(promises)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.props.spread) {\n\t\t\t\t\t\treturn this.check();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\t// Check to see if anything new is on screen after rendering\n\t\t\t\t\treturn this.update(delta);\n\t\t\t\t}, (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.q.enqueue(function(){\n\t\t\t\tthis.update();\n\t\t\t}.bind(this));\n\t\t\tchecking.resolve(false);\n\t\t\treturn checking.promise;\n\t\t}\n\n\n\t}\n\n\ttrim(){\n\t\tvar task = new defer();\n\t\tvar displayed = this.views.displayed();\n\t\tvar first = displayed[0];\n\t\tvar last = displayed[displayed.length-1];\n\t\tvar firstIndex = this.views.indexOf(first);\n\t\tvar lastIndex = this.views.indexOf(last);\n\t\tvar above = this.views.slice(0, firstIndex);\n\t\tvar below = this.views.slice(lastIndex+1);\n\n\t\t// Erase all but last above\n\t\tfor (var i = 0; i < above.length-1; i++) {\n\t\t\tthis.erase(above[i], above);\n\t\t}\n\n\t\t// Erase all except first below\n\t\tfor (var j = 1; j < below.length; j++) {\n\t\t\tthis.erase(below[j]);\n\t\t}\n\n\t\ttask.resolve();\n\t\treturn task.promise;\n\t}\n\n\terase(view, above){ //Trim\n\n\t\tvar prevTop;\n\t\tvar prevLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tprevTop = this.container.scrollTop;\n\t\t\tprevLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tprevTop = window.scrollY;\n\t\t\tprevLeft = window.scrollX;\n\t\t}\n\n\t\tvar bounds = view.bounds();\n\n\t\tthis.views.remove(view);\n\n\t\tif(above) {\n\t\t\tif(this.settings.axis === \"vertical\") {\n\t\t\t\tthis.scrollTo(0, prevTop - bounds.height, true);\n\t\t\t} else {\n\t\t\t\tthis.scrollTo(prevLeft - Math.floor(bounds.width), 0, true);\n\t\t\t}\n\t\t}\n\n\t}\n\n\taddEventListeners(stage){\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.ignore = true;\n\t\t\t// this.scrollTo(0,0);\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tthis.addScrollListeners();\n\n\t\tif (this.isPaginated && this.settings.snap) {\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\n\t\t}\n\t}\n\n\taddScrollListeners() {\n\t\tvar scroller;\n\n\t\tthis.tick = requestAnimationFrame;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.prevScrollTop = this.container.scrollTop;\n\t\t\tthis.prevScrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tthis.prevScrollTop = window.scrollY;\n\t\t\tthis.prevScrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollDeltaVert = 0;\n\t\tthis.scrollDeltaHorz = 0;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t\tthis.scrollTop = window.scrollY;\n\t\t\tthis.scrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t\tthis._scrolled = debounce(this.scrolled.bind(this), 30);\n\t\t// this.tick.call(window, this.onScroll.bind(this));\n\n\t\tthis.didScroll = false;\n\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY * dir;\n\t\t\tscrollLeft = window.scrollX * dir;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\n\t\t\tthis._scrolled();\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t\tthis.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n\t\tthis.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n\t\tthis.prevScrollTop = scrollTop;\n\t\tthis.prevScrollLeft = scrollLeft;\n\n\t\tclearTimeout(this.scrollTimeout);\n\t\tthis.scrollTimeout = setTimeout(function(){\n\t\t\tthis.scrollDeltaVert = 0;\n\t\t\tthis.scrollDeltaHorz = 0;\n\t\t}.bind(this), 150);\n\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.didScroll = false;\n\n\t}\n\n\tscrolled() {\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\n\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\ttop: this.scrollTop,\n\t\t\tleft: this.scrollLeft\n\t\t});\n\n\t\tclearTimeout(this.afterScrolled);\n\t\tthis.afterScrolled = setTimeout(function () {\n\n\t\t\t// Don't report scroll if we are about the snap\n\t\t\tif (this.snapper && this.snapper.supportsTouch && this.snapper.needsSnap()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\ttop: this.scrollTop,\n\t\t\t\tleft: this.scrollLeft\n\t\t\t});\n\n\t\t}.bind(this), this.settings.afterScrolledTimeout);\n\t}\n\n\tnext(){\n\n\t\tlet dir = this.settings.direction;\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\n\t\t\t\t\t\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollBy(delta, 0, true);\n\n\t\t} else {\n\n\t\t\tthis.scrollBy(0, this.layout.height, true);\n\n\t\t}\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\t}\n\n\tprev(){\n\n\t\tlet dir = this.settings.direction;\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\n\t\t\t\t\t\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollBy(-delta, 0, true);\n\n\t\t} else {\n\n\t\t\tthis.scrollBy(0, -this.layout.height, true);\n\n\t\t}\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\t}\n\n\t// updateAxis(axis, forceUpdate){\n\t//\n\t// \tsuper.updateAxis(axis, forceUpdate);\n\t//\n\t// \tif (axis === \"vertical\") {\n\t// \t\tthis.settings.infinite = true;\n\t// \t} else {\n\t// \t\tthis.settings.infinite = false;\n\t// \t}\n\t// }\n\n\tupdateFlow(flow){\n\t\tif (this.rendered && this.snapper) {\n\t\t\tthis.snapper.destroy();\n\t\t\tthis.snapper = undefined;\n\t\t}\n\n\t\tsuper.updateFlow(flow);\n\n\t\tif (this.rendered && this.isPaginated && this.settings.snap) {\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\n\t\t}\n\t}\n\n\tdestroy(){\n\t\tsuper.destroy();\n\n\t\tif (this.snapper) {\n\t\t\tthis.snapper.destroy();\n\t\t}\n\t}\n\n}\n\nexport default ContinuousViewManager;\n","import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: \"\",\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800,\n\t\t\tstylesheet: null,\n\t\t\tresizeOnOrientationChange: true,\n\t\t\tscript: null,\n\t\t\tsnap: false\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.book = book;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @member {object} hooks\n\t\t * @property {Hook} hooks.content\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.unloaded = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\n\n\t\tthis.injected = {};\n\t\tthis.injected['identifier'] = this.injectIdentifier.bind(this);\n\t\tthis.book.spine.hooks.content.register(this.injected['identifier']);\n\n\t\tif (this.settings.stylesheet) {\n\t\t\tthis.injected['stylesheet'] = this.injectStylesheet.bind(this);\n\t\t\tthis.book.spine.hooks.content.register(this.injected['stylesheet']);\n\t\t}\n\n\t\tif (this.settings.script) {\n\t\t\tthis.injected['script'] = this.injectScript.bind(this);\n\t\t\tthis.book.spine.hooks.content.register(this.injected['script']);\n\t\t}\n\n\t\t/**\n\t\t * @member {Themes} themes\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.themes = new Themes(this);\n\n\t\t/**\n\t\t * @member {Annotations} annotations\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.annotations = new Annotations(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\t/**\n\t\t * A Rendered Location Range\n\t\t * @typedef location\n\t\t * @type {Object}\n\t\t * @property {object} start\n\t\t * @property {string} start.index\n\t\t * @property {string} start.href\n\t\t * @property {object} start.displayed\n\t\t * @property {EpubCFI} start.cfi\n\t\t * @property {number} start.location\n\t\t * @property {number} start.percentage\n\t\t * @property {number} start.displayed.page\n\t\t * @property {number} start.displayed.total\n\t\t * @property {object} end\n\t\t * @property {string} end.index\n\t\t * @property {string} end.href\n\t\t * @property {object} end.displayed\n\t\t * @property {EpubCFI} end.cfi\n\t\t * @property {number} end.location\n\t\t * @property {number} end.percentage\n\t\t * @property {number} end.displayed.page\n\t\t * @property {number} end.displayed.total\n\t\t * @property {boolean} atStart\n\t\t * @property {boolean} atEnd\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.location = undefined;\n\n\t\t// Hold queue until book is opened\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\tthis.starting = new defer();\n\t\t/**\n\t\t * @member {promise} started returns after the rendition has started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.started = this.starting.promise;\n\t\t// Block the queue until rendering is started\n\t\tthis.q.enqueue(this.start);\n\t}\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t}\n\n\t/**\n\t * Require the manager from passed string, or as a class function\n\t * @param  {string|object} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from imported managers\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\n\t\t\tviewManager = DefaultViewManager;\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\n\t\t\tviewManager = ContinuousViewManager;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tviewManager = manager;\n\t\t}\n\n\t\treturn viewManager;\n\t}\n\n\t/**\n\t * Require the view from passed string, or as a class function\n\t * @param  {string|object} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\t// If view is a string, try to load from imported views,\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\n\t\t\tView = IframeView;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tView = view;\n\t\t}\n\n\t\treturn View;\n\t}\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\tthis.direction(this.book.package.metadata.direction);\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n\t\t// Listen for rotation\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n\t\t/**\n\t\t * Emit that rendering has started\n\t\t * @event started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t}\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Emit that rendering has attached to an element\n\t\t\t * @event attached\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\n\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\t\tif (this.displaying) {\n\t\t\tthis.displaying.resolve();\n\t\t}\n\t\treturn this.q.enqueue(this._display, target);\n\t}\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tif (!this.book) {\n\t\t\treturn;\n\t\t}\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\tthis.displaying = displaying;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length() && isFloat(target)) {\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\tthis.manager.display(section, target)\n\t\t\t.then(() => {\n\t\t\t\tdisplaying.resolve(section);\n\t\t\t\tthis.displaying = undefined;\n\n\t\t\t\t/**\n\t\t\t\t * Emit that a section has been displayed\n\t\t\t\t * @event displayed\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\n\t\t\t\tthis.reportLocation();\n\t\t\t}, (err) => {\n\t\t\t\t/**\n\t\t\t\t * Emit that has been an error displaying\n\t\t\t\t * @event displayError\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n\t\t\t});\n\n\t\treturn displayed;\n\t}\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t}\n\t*/\n\n\t/**\n\t * Report what section has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view));\n\n\t\tthis.hooks.render.trigger(view, this)\n\t\t\t.then(() => {\n\t\t\t\tif (view.contents) {\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Emit that a section has been rendered\n\t\t\t\t\t\t * @event rendered\n\t\t\t\t\t\t * @param {Section} section\n\t\t\t\t\t\t * @param {View} view\n\t\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t\t */\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Report what has been removed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterRemoved(view){\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\n\t\t\t/**\n\t\t\t * Emit that a section has been removed\n\t\t\t * @event removed\n\t\t\t * @param {Section} section\n\t\t\t * @param {View} view\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n\t\t});\n\t}\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size){\n\n\t\t/**\n\t\t * Emit that the rendition has been resized\n\t\t * @event resized\n\t\t * @param {number} width\n\t\t * @param {height} height\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t});\n\n\t\tif (this.location && this.location.start) {\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\n\t}\n\n\t/**\n\t * Report orientation events and display the last seen location\n\t * @private\n\t */\n\tonOrientationChange(orientation){\n\t\t/**\n\t\t * Emit that the rendition has been rotated\n\t\t * @event orientationchange\n\t\t * @param {string} orientation\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n\t}\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t}\n\n\t/**\n\t * Trigger a resize of the views\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tresize(width, height){\n\t\tif (width) {\n\t\t\tthis.settings.width = width;\n\t\t}\n\t\tif (height) {\n\t\t\tthis.settings.height = height;\n\t\t}\n\t\tthis.manager.resize(width, height);\n\t}\n\n\t/**\n\t * Clear all rendered views\n\t */\n\tclear(){\n\t\tthis.manager.clear();\n\t}\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\n\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\n\t\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth,\n\t\t\tdirection: direction\n\t\t};\n\n\t\treturn properties;\n\t}\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled\" ||\n\t\t\t\tflow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tthis.settings.flow = flow;\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\t// this.mapping = new Mapping(this._layout.props);\n\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n\t\t\t})\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t}\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} [min] min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis.settings.spread = spread;\n\n\t\tif (min) {\n\t\t\tthis.settings.minSpreadWidth = min;\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.spread(spread, min);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the direction of the rendition\n\t * @param  {string} dir\n\t */\n\tdirection(dir){\n\n\t\tthis.settings.direction = dir || \"ltr\";\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.direction(this.settings.direction);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Report the current location\n\t * @fires relocated\n\t * @fires locationChanged\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function reportedLocation(){\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\n\t\t\t\tvar location = this.manager.currentLocation();\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\t\tlet located = this.located(result);\n\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else if (location) {\n\t\t\t\t\tlet located = this.located(location);\n\n\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event locationChanged\n\t\t\t\t\t * @deprecated\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t * @property {number} index\n\t\t\t\t\t * @property {string} href\n\t\t\t\t\t * @property {EpubCFI} start\n\t\t\t\t\t * @property {EpubCFI} end\n\t\t\t\t\t * @property {number} percentage\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t});\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event relocated\n\t\t\t\t\t * @type {displayedLocation}\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get the Current Location object\n\t * @return {displayedLocation | promise} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tlet located = this.located(result);\n\t\t\t\treturn located;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tlet located = this.located(location);\n\t\t\treturn located;\n\t\t}\n\t}\n\n\t/**\n\t * Creates a Rendition#locationRange from location\n\t * passed by the Manager\n\t * @returns {displayedLocation}\n\t * @private\n\t */\n\tlocated(location){\n\t\tif (!location.length) {\n\t\t\treturn {};\n\t\t}\n\t\tlet start = location[0];\n\t\tlet end = location[location.length-1];\n\n\t\tlet located = {\n\t\t\tstart: {\n\t\t\t\tindex: start.index,\n\t\t\t\thref: start.href,\n\t\t\t\tcfi: start.mapping.start,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: start.pages[0] || 1,\n\t\t\t\t\ttotal: start.totalPages\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tindex: end.index,\n\t\t\t\thref: end.href,\n\t\t\t\tcfi: end.mapping.end,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: end.pages[end.pages.length-1] || 1,\n\t\t\t\t\ttotal: end.totalPages\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n\t\tif (locationStart != null) {\n\t\t\tlocated.start.location = locationStart;\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n\t\t}\n\t\tif (locationEnd != null) {\n\t\t\tlocated.end.location = locationEnd;\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n\t\t}\n\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n\t\tif (pageStart != -1) {\n\t\t\tlocated.start.page = pageStart;\n\t\t}\n\t\tif (pageEnd != -1) {\n\t\t\tlocated.end.page = pageEnd;\n\t\t}\n\n\t\tif (end.index === this.book.spine.last().index &&\n\t\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\n\t\t\tlocated.atEnd = true;\n\t\t}\n\n\t\tif (start.index === this.book.spine.first().index &&\n\t\t\t\tlocated.start.displayed.page === 1) {\n\t\t\tlocated.atStart = true;\n\t\t}\n\n\t\treturn located;\n\t}\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\t// this.q.clear();\n\t\t// this.q = undefined;\n\n\t\tthis.manager && this.manager.destroy();\n\t\tthis.book.spine.hooks.content.deregister(this.injected['identifier']);\n\t\tthis.book.spine.hooks.content.deregister(this.injected['script']);\n\t\tthis.book.spine.hooks.content.deregister(this.injected['stylesheet']);\n\n\t\tthis.book = undefined;\n\n\t\t// this.views = null;\n\n\t\t// this.hooks.display.clear();\n\t\t// this.hooks.serialize.clear();\n\t\t// this.hooks.content.clear();\n\t\t// this.hooks.layout.clear();\n\t\t// this.hooks.render.clear();\n\t\t// this.hooks.show.clear();\n\t\t// this.hooks = {};\n\n\t\t// this.themes.destroy();\n\t\t// this.themes = undefined;\n\n\t\t// this.epubcfi = undefined;\n\n\t\t// this.starting = undefined;\n\t\t// this.started = undefined;\n\n\n\t}\n\n\t/**\n\t * Pass the events from a view's Contents\n\t * @private\n\t * @param  {Contents} view contents\n\t */\n\tpassEvents(contents){\n\t\tDOM_EVENTS.forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\n\t}\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange, contents){\n\t\t/**\n\t\t * Emit that a text selection has occured\n\t\t * @event selected\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n\t}\n\n\t/**\n\t * Emit a markClicked event with the cfiRange and data from a mark\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerMarkEvent(cfiRange, data, contents){\n\t\t/**\n\t\t * Emit that a mark was clicked\n\t\t * @event markClicked\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {object} data\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n\t}\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\tgetRange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.manager.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\n\t\t}\n\t}\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\tadjustImages(contents) {\n\n\t\tif (this._layout.name === \"pre-paginated\") {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n\t\tlet verticalPadding = parseFloat(computed.verticalPadding);\n\n\t\tcontents.addStylesheetRules({\n\t\t\t\"img\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - verticalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"object-fit\": \"contain\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\",\n\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t},\n\t\t\t\"svg\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - verticalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\"\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Get the Contents object of each rendered view\n\t * @returns {Contents[]}\n\t */\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t}\n\n\t/**\n\t * Get the views member from the manager\n\t * @returns {Views}\n\t */\n\tviews () {\n\t\tlet views = this.manager ? this.manager.views : undefined;\n\t\treturn views || [];\n\t}\n\n\t/**\n\t * Hook to handle link clicks in rendered content\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\thandleLinks(contents) {\n\t\tif (contents) {\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\n\t\t\t\tlet relative = this.book.path.relative(href);\n\t\t\t\tthis.display(relative);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook to handle injecting stylesheet before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectStylesheet(doc, section) {\n\t\tlet style = doc.createElement(\"link\");\n\t\tstyle.setAttribute(\"type\", \"text/css\");\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\n\t}\n\n\t/**\n\t * Hook to handle injecting scripts before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectScript(doc, section) {\n\t\tlet script = doc.createElement(\"script\");\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", this.settings.script);\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n\t/**\n\t * Hook to handle the document identifier before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectIdentifier(doc, section) {\n\t\tlet ident = this.book.packaging.metadata.identifier;\n\t\tlet meta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\t\tif (ident) {\n\t\t\tmeta.setAttribute(\"content\", ident);\n\t\t}\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\n\t}\n\n\tscale(s) {\n\t\treturn this.manager && this.manager.scale(s);\n\t}\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n","import {defer, isXml, parse} from \"./core\";\nimport Path from \"./path\";\n\nfunction request(url, type, withCredentials, headers) {\n\tvar supportsURL = (typeof window != \"undefined\") ? window.URL : false; // TODO: fallback for url if window isn't defined\n\tvar BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\n\n\tvar deferred = new defer();\n\n\tvar xhr = new XMLHttpRequest();\n\n\t//-- Check from PDF.js:\n\t//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\n\tvar xhrPrototype = XMLHttpRequest.prototype;\n\n\tvar header;\n\n\tif (!(\"overrideMimeType\" in xhrPrototype)) {\n\t\t// IE10 might have response, but not overrideMimeType\n\t\tObject.defineProperty(xhrPrototype, \"overrideMimeType\", {\n\t\t\tvalue: function xmlHttpRequestOverrideMimeType() {}\n\t\t});\n\t}\n\n\tif(withCredentials) {\n\t\txhr.withCredentials = true;\n\t}\n\n\txhr.onreadystatechange = handler;\n\txhr.onerror = err;\n\n\txhr.open(\"GET\", url, true);\n\n\tfor(header in headers) {\n\t\txhr.setRequestHeader(header, headers[header]);\n\t}\n\n\tif(type == \"json\") {\n\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\n\t}\n\n\t// If type isn\"t set, determine it from the file extension\n\tif(!type) {\n\t\ttype = new Path(url).extension;\n\t}\n\n\tif(type == \"blob\"){\n\t\txhr.responseType = BLOB_RESPONSE;\n\t}\n\n\n\tif(isXml(type)) {\n\t\t// xhr.responseType = \"document\";\n\t\txhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n\t}\n\n\tif(type == \"xhtml\") {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == \"html\" || type == \"htm\") {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == \"binary\") {\n\t\txhr.responseType = \"arraybuffer\";\n\t}\n\n\txhr.send();\n\n\tfunction err(e) {\n\t\tdeferred.reject(e);\n\t}\n\n\tfunction handler() {\n\t\tif (this.readyState === XMLHttpRequest.DONE) {\n\t\t\tvar responseXML = false;\n\n\t\t\tif(this.responseType === \"\" || this.responseType === \"document\") {\n\t\t\t\tresponseXML = this.responseXML;\n\t\t\t}\n\n\t\t\tif (this.status === 200 || this.status === 0 || responseXML) { //-- Firefox is reporting 0 for blob urls\n\t\t\t\tvar r;\n\n\t\t\t\tif (!this.response && !responseXML) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tmessage : \"Empty Response\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tif (this.status === 403) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tresponse: this.response,\n\t\t\t\t\t\tmessage : \"Forbidden\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\t\t\t\tif(responseXML){\n\t\t\t\t\tr = this.responseXML;\n\t\t\t\t} else\n\t\t\t\tif(isXml(type)){\n\t\t\t\t\t// xhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n\t\t\t\t\t// If this.responseXML wasn't set, try to parse using a DOMParser from text\n\t\t\t\t\tr = parse(this.response, \"text/xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"xhtml\"){\n\t\t\t\t\tr = parse(this.response, \"application/xhtml+xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"html\" || type == \"htm\"){\n\t\t\t\t\tr = parse(this.response, \"text/html\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"json\"){\n\t\t\t\t\tr = JSON.parse(this.response);\n\t\t\t\t}else\n\t\t\t\tif(type == \"blob\"){\n\n\t\t\t\t\tif(supportsURL) {\n\t\t\t\t\t\tr = this.response;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//-- Safari doesn't support responseType blob, so create a blob from arraybuffer\n\t\t\t\t\t\tr = new Blob([this.response]);\n\t\t\t\t\t}\n\n\t\t\t\t}else{\n\t\t\t\t\tr = this.response;\n\t\t\t\t}\n\n\t\t\t\tdeferred.resolve(r);\n\t\t\t} else {\n\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tstatus: this.status,\n\t\t\t\t\tmessage : this.response,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t}\n\n\treturn deferred.promise;\n}\n\nexport default request;\n","import {defer, isXml, parse} from \"./utils/core\";\nimport request from \"./utils/request\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\n\n/**\n * Handles Unzipping a requesting files from an Epub Archive\n * @class\n */\nclass Archive {\n\n\tconstructor() {\n\t\tthis.zip = undefined;\n\t\tthis.urlCache = {};\n\n\t\tthis.checkRequirements();\n\n\t}\n\n\t/**\n\t * Checks to see if JSZip exists in global namspace,\n\t * Requires JSZip if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tif (typeof JSZip === \"undefined\") {\n\t\t\t\tlet JSZip = require(\"jszip\");\n\t\t\t\tthis.zip = new JSZip();\n\t\t\t} else {\n\t\t\t\tthis.zip = new JSZip();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"JSZip lib not loaded\");\n\t\t}\n\t}\n\n\t/**\n\t * Open an archive\n\t * @param  {binary} input\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topen(input, isBase64){\n\t\treturn this.zip.loadAsync(input, {\"base64\": isBase64});\n\t}\n\n\t/**\n\t * Load and Open an archive\n\t * @param  {string} zipUrl\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topenUrl(zipUrl, isBase64){\n\t\treturn request(zipUrl, \"binary\")\n\t\t\t.then(function(data){\n\t\t\t\treturn this.zip.loadAsync(data, {\"base64\": isBase64});\n\t\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Request a url from the archive\n\t * @param  {string} url  a url to request from the archive\n\t * @param  {string} [type] specify the type of the returned result\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\trequest(url, type){\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == \"blob\"){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\t\tif (response) {\n\t\t\tresponse.then(function (r) {\n\t\t\t\tlet result = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {string} [type]\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"xhtml\") {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"html\" || type == \"htm\") {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t}\n\n\t/**\n\t * Get a Blob from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"uint8array\").then(function(uint8array) {\n\t\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get Text from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [encoding]\n\t * @return {string}\n\t */\n\tgetText(url, encoding){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\treturn entry.async(\"string\").then(function(text) {\n\t\t\t\treturn text;\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get a base64 encoded result from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"base64\").then(function(data) {\n\t\t\t\treturn \"data:\" + mimeType + \";base64,\" + data;\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Create a Url from an unarchived item\n\t * @param  {string} url\n\t * @param  {object} [options.base64] use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the archive\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t}\n\n\tdestroy() {\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tfor (let fromCache in this.urlCache) {\n\t\t\t_URL.revokeObjectURL(fromCache);\n\t\t}\n\t\tthis.zip = undefined;\n\t\tthis.urlCache = {};\n\t}\n}\n\nexport default Archive;\n","import {defer, isXml, parse} from \"./utils/core\";\nimport httpRequest from \"./utils/request\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Handles saving and requesting files from local storage\n * @class\n * @param {string} name This should be the name of the application for modals\n * @param {function} [requester]\n * @param {function} [resolver]\n */\nclass Store {\n\n\tconstructor(name, requester, resolver) {\n\t\tthis.urlCache = {};\n\n\t\tthis.storage = undefined;\n\n\t\tthis.name = name;\n\t\tthis.requester = requester || httpRequest;\n\t\tthis.resolver = resolver;\n\n\t\tthis.online = true;\n\n\t\tthis.checkRequirements();\n\n\t\tthis.addListeners();\n\t}\n\n\t/**\n\t * Checks to see if localForage exists in global namspace,\n\t * Requires localForage if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tlet store;\n\t\t\tif (typeof localforage === \"undefined\") {\n\t\t\t\tstore = require(\"localforage\");\n\t\t\t} else {\n\t\t\t\tstore = localforage;\n\t\t\t}\n\t\t\tthis.storage = store.createInstance({\n\t\t\t\t\tname: this.name\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"localForage lib not loaded\");\n\t\t}\n\t}\n\n\t/**\n\t * Add online and offline event listeners\n\t * @private\n\t */\n\taddListeners() {\n\t\tthis._status = this.status.bind(this);\n\t\twindow.addEventListener('online',  this._status);\n\t  window.addEventListener('offline', this._status);\n\t}\n\n\t/**\n\t * Remove online and offline event listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\t\twindow.removeEventListener('online',  this._status);\n\t  window.removeEventListener('offline', this._status);\n\t\tthis._status = undefined;\n\t}\n\n\t/**\n\t * Update the online / offline status\n\t * @private\n\t */\n\tstatus(event) {\n\t\tlet online = navigator.onLine;\n\t\tthis.online = online;\n\t\tif (online) {\n\t\t\tthis.emit(\"online\", this);\n\t\t} else {\n\t\t\tthis.emit(\"offline\", this);\n\t\t}\n\t}\n\n\t/**\n\t * Add all of a book resources to the store\n\t * @param  {Resources} resources  book resources\n\t * @param  {boolean} [force] force resaving resources\n\t * @return {Promise<object>} store objects\n\t */\n\tadd(resources, force) {\n\t\tlet mapped = resources.resources.map((item) => {\n\t\t\tlet { href } = item;\n\t\t\tlet url = this.resolver(href);\n\t\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\t\treturn this.storage.getItem(encodedUrl).then((item) => {\n\t\t\t\tif (!item || force) {\n\t\t\t\t\treturn this.requester(url, \"binary\")\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t\treturn Promise.all(mapped);\n\t}\n\n\t/**\n\t * Put binary data from a url to storage\n\t * @param  {string} url  a url to request from storage\n\t * @param  {boolean} [withCredentials]\n\t * @param  {object} [headers]\n\t * @return {Promise<Blob>}\n\t */\n\tput(url, withCredentials, headers) {\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then((result) => {\n\t\t\tif (!result) {\n\t\t\t\treturn this.requester(url, \"binary\", withCredentials, headers).then((data) => {\n\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t/**\n\t * Request a url\n\t * @param  {string} url  a url to request from storage\n\t * @param  {string} [type] specify the type of the returned result\n\t * @param  {boolean} [withCredentials]\n\t * @param  {object} [headers]\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\trequest(url, type, withCredentials, headers){\n\t\tif (this.online) {\n\t\t\t// From network\n\t\t\treturn this.requester(url, type, withCredentials, headers).then((data) => {\n\t\t\t\t// save to store if not present\n\t\t\t\tthis.put(url);\n\t\t\t\treturn data;\n\t\t\t})\n\t\t} else {\n\t\t\t// From store\n\t\t\treturn this.retrieve(url, type);\n\t\t}\n\n\t}\n\n\t/**\n\t * Request a url from storage\n\t * @param  {string} url  a url to request from storage\n\t * @param  {string} [type] specify the type of the returned result\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\tretrieve(url, type) {\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == \"blob\"){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\n\t\treturn response.then((r) => {\n\t\t\tvar deferred = new defer();\n\t\t\tvar result;\n\t\t\tif (r) {\n\t\t\t\tresult = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t} else {\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tmessage : \"File not found in storage: \" + url,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {string} [type]\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"xhtml\") {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"html\" || type == \"htm\") {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t}\n\n\t/**\n\t * Get a Blob from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\n\t\t\tif(!uint8array) return;\n\n\t\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t});\n\n\t}\n\n\t/**\n\t * Get Text from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string}\n\t */\n\tgetText(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\n\t\t\tvar deferred = new defer();\n\t\t\tvar reader = new FileReader();\n\t\t\tvar blob;\n\n\t\t\tif(!uint8array) return;\n\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\n\n\t\t\treader.addEventListener(\"loadend\", () => {\n\t\t\t\tdeferred.resolve(reader.result);\n\t\t\t});\n\n\t\t\treader.readAsText(blob, mimeType);\n\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Get a base64 encoded result from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then((uint8array) => {\n\t\t\tvar deferred = new defer();\n\t\t\tvar reader = new FileReader();\n\t\t\tvar blob;\n\n\t\t\tif(!uint8array) return;\n\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\n\n\t\t\treader.addEventListener(\"loadend\", () => {\n\t\t\t\tdeferred.resolve(reader.result);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob, mimeType);\n\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Create a Url from a stored item\n\t * @param  {string} url\n\t * @param  {object} [options.base64] use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in storage: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the store\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t}\n\n\tdestroy() {\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tfor (let fromCache in this.urlCache) {\n\t\t\t_URL.revokeObjectURL(fromCache);\n\t\t}\n\t\tthis.urlCache = {};\n\t\tthis.removeListeners();\n\t}\n}\n\nEventEmitter(Store.prototype);\n\nexport default Store;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer} from \"./utils/core\";\nimport Url from \"./utils/url\";\nimport Path from \"./utils/path\";\nimport Spine from \"./spine\";\nimport Locations from \"./locations\";\nimport Container from \"./container\";\nimport Packaging from \"./packaging\";\nimport Navigation from \"./navigation\";\nimport Resources from \"./resources\";\nimport PageList from \"./pagelist\";\nimport Rendition from \"./rendition\";\nimport Archive from \"./archive\";\nimport request from \"./utils/request\";\nimport EpubCFI from \"./epubcfi\";\nimport Store from \"./store\";\nimport { EPUBJS_VERSION, EVENTS } from \"./utils/constants\";\n\nconst CONTAINER_PATH = \"META-INF/container.xml\";\n\nconst INPUT_TYPE = {\n\tBINARY: \"binary\",\n\tBASE64: \"base64\",\n\tEPUB: \"epub\",\n\tOPF: \"opf\",\n\tMANIFEST: \"json\",\n\tDIRECTORY: \"directory\"\n};\n\n/**\n * An Epub representation with methods for the loading, parsing and manipulation\n * of its contents.\n * @class\n * @param {string} [url]\n * @param {object} [options]\n * @param {method} [options.requestMethod] a request function to use instead of the default\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\n * @param {string} [options.replacements=none] use base64, blobUrl, or none for replacing assets in archived Epubs\n * @param {method} [options.canonical] optional function to determine canonical urls for a path\n * @param {string} [options.openAs] optional string to determine the input type\n * @param {string} [options.store=false] cache the contents in local storage, value should be the name of the reader\n * @returns {Book}\n * @example new Book(\"/path/to/book.epub\", {})\n * @example new Book({ replacements: \"blobUrl\" })\n */\nclass Book {\n\tconstructor(url, options) {\n\t\t// Allow passing just options to the Book\n\t\tif (typeof(options) === \"undefined\" &&\n\t\t\t  typeof(url) !== \"string\" &&\n\t\t    url instanceof Blob === false) {\n\t\t\toptions = url;\n\t\t\turl = undefined;\n\t\t}\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\trequestMethod: undefined,\n\t\t\trequestCredentials: undefined,\n\t\t\trequestHeaders: undefined,\n\t\t\tencoding: undefined,\n\t\t\treplacements: undefined,\n\t\t\tcanonical: undefined,\n\t\t\topenAs: undefined,\n\t\t\tstore: undefined\n\t\t});\n\n\t\textend(this.settings, options);\n\n\n\t\t// Promises\n\t\tthis.opening = new defer();\n\t\t/**\n\t\t * @member {promise} opened returns after the book is loaded\n\t\t * @memberof Book\n\t\t */\n\t\tthis.opened = this.opening.promise;\n\t\tthis.isOpen = false;\n\n\t\tthis.loading = {\n\t\t\tmanifest: new defer(),\n\t\t\tspine: new defer(),\n\t\t\tmetadata: new defer(),\n\t\t\tcover: new defer(),\n\t\t\tnavigation: new defer(),\n\t\t\tpageList: new defer(),\n\t\t\tresources: new defer()\n\t\t};\n\n\t\tthis.loaded = {\n\t\t\tmanifest: this.loading.manifest.promise,\n\t\t\tspine: this.loading.spine.promise,\n\t\t\tmetadata: this.loading.metadata.promise,\n\t\t\tcover: this.loading.cover.promise,\n\t\t\tnavigation: this.loading.navigation.promise,\n\t\t\tpageList: this.loading.pageList.promise,\n\t\t\tresources: this.loading.resources.promise\n\t\t};\n\n\t\t/**\n\t\t * @member {promise} ready returns after the book is loaded and parsed\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.ready = Promise.all([\n\t\t\tthis.loaded.manifest,\n\t\t\tthis.loaded.spine,\n\t\t\tthis.loaded.metadata,\n\t\t\tthis.loaded.cover,\n\t\t\tthis.loaded.navigation,\n\t\t\tthis.loaded.resources\n\t\t]);\n\n\n\t\t// Queue for methods used before opening\n\t\tthis.isRendered = false;\n\t\t// this._q = queue(this);\n\n\t\t/**\n\t\t * @member {method} request\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.request = this.settings.requestMethod || request;\n\n\t\t/**\n\t\t * @member {Spine} spine\n\t\t * @memberof Book\n\t\t */\n\t\tthis.spine = new Spine();\n\n\t\t/**\n\t\t * @member {Locations} locations\n\t\t * @memberof Book\n\t\t */\n\t\tthis.locations = new Locations(this.spine, this.load.bind(this));\n\n\t\t/**\n\t\t * @member {Navigation} navigation\n\t\t * @memberof Book\n\t\t */\n\t\tthis.navigation = undefined;\n\n\t\t/**\n\t\t * @member {PageList} pagelist\n\t\t * @memberof Book\n\t\t */\n\t\tthis.pageList = undefined;\n\n\t\t/**\n\t\t * @member {Url} url\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.url = undefined;\n\n\t\t/**\n\t\t * @member {Path} path\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.path = undefined;\n\n\t\t/**\n\t\t * @member {boolean} archived\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.archived = false;\n\n\t\t/**\n\t\t * @member {Archive} archive\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.archive = undefined;\n\n\t\t/**\n\t\t * @member {Store} storage\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.storage = undefined;\n\n\t\t/**\n\t\t * @member {Resources} resources\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.resources = undefined;\n\n\t\t/**\n\t\t * @member {Rendition} rendition\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.rendition = undefined;\n\n\t\t/**\n\t\t * @member {Container} container\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.container = undefined;\n\n\t\t/**\n\t\t * @member {Packaging} packaging\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.packaging = undefined;\n\n\t\t// this.toc = undefined;\n\t\tif (this.settings.store) {\n\t\t\tthis.store(this.settings.store);\n\t\t}\n\n\t\tif(url) {\n\t\t\tthis.open(url, this.settings.openAs).catch((error) => {\n\t\t\t\tvar err = new Error(\"Cannot load book at \"+ url );\n\t\t\t\tthis.emit(EVENTS.BOOK.OPEN_FAILED, err);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Open a epub or url\n\t * @param {string | ArrayBuffer} input Url, Path or ArrayBuffer\n\t * @param {string} [what=\"binary\", \"base64\", \"epub\", \"opf\", \"json\", \"directory\"] force opening as a certain type\n\t * @returns {Promise} of when the book has been loaded\n\t * @example book.open(\"/path/to/book.epub\")\n\t */\n\topen(input, what) {\n\t\tvar opening;\n\t\tvar type = what || this.determineType(input);\n\n\t\tif (type === INPUT_TYPE.BINARY) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input);\n\t\t} else if (type === INPUT_TYPE.BASE64) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input, type);\n\t\t} else if (type === INPUT_TYPE.EPUB) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.request(input, \"binary\", this.settings.requestCredentials)\n\t\t\t\t.then(this.openEpub.bind(this));\n\t\t} else if(type == INPUT_TYPE.OPF) {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openPackaging(this.url.Path.toString());\n\t\t} else if(type == INPUT_TYPE.MANIFEST) {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openManifest(this.url.Path.toString());\n\t\t} else {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openContainer(CONTAINER_PATH)\n\t\t\t\t.then(this.openPackaging.bind(this));\n\t\t}\n\n\t\treturn opening;\n\t}\n\n\t/**\n\t * Open an archived epub\n\t * @private\n\t * @param  {binary} data\n\t * @param  {string} [encoding]\n\t * @return {Promise}\n\t */\n\topenEpub(data, encoding) {\n\t\treturn this.unarchive(data, encoding || this.settings.encoding)\n\t\t\t.then(() => {\n\t\t\t\treturn this.openContainer(CONTAINER_PATH);\n\t\t\t})\n\t\t\t.then((packagePath) => {\n\t\t\t\treturn this.openPackaging(packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the epub container\n\t * @private\n\t * @param  {string} url\n\t * @return {string} packagePath\n\t */\n\topenContainer(url) {\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.container = new Container(xml);\n\t\t\t\treturn this.resolve(this.container.packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the Open Packaging Format Xml\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenPackaging(url) {\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.packaging = new Packaging(xml);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the manifest JSON\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenManifest(url) {\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((json) => {\n\t\t\t\tthis.packaging = new Packaging();\n\t\t\t\tthis.packaging.load(json);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Load a resource from the Book\n\t * @param  {string} path path to the resource to load\n\t * @return {Promise}     returns a promise with the requested resource\n\t */\n\tload(path) {\n\t\tvar resolved = this.resolve(path);\n\t\tif(this.archived) {\n\t\t\treturn this.archive.request(resolved);\n\t\t} else {\n\t\t\treturn this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\n\t\t}\n\t}\n\n\t/**\n\t * Resolve a path to it's absolute position in the Book\n\t * @param  {string} path\n\t * @param  {boolean} [absolute] force resolving the full URL\n\t * @return {string}          the resolved path string\n\t */\n\tresolve(path, absolute) {\n\t\tif (!path) {\n\t\t\treturn;\n\t\t}\n\t\tvar resolved = path;\n\t\tvar isAbsolute = (path.indexOf(\"://\") > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (this.path) {\n\t\t\tresolved = this.path.resolve(path);\n\t\t}\n\n\t\tif(absolute != false && this.url) {\n\t\t\tresolved = this.url.resolve(resolved);\n\t\t}\n\n\t\treturn resolved;\n\t}\n\n\t/**\n\t * Get a canonical link to a path\n\t * @param  {string} path\n\t * @return {string} the canonical path string\n\t */\n\tcanonical(path) {\n\t\tvar url = path;\n\n\t\tif (!path) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (this.settings.canonical) {\n\t\t\turl = this.settings.canonical(path);\n\t\t} else {\n\t\t\turl = this.resolve(path, true);\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t/**\n\t * Determine the type of they input passed to open\n\t * @private\n\t * @param  {string} input\n\t * @return {string}  binary | directory | epub | opf\n\t */\n\tdetermineType(input) {\n\t\tvar url;\n\t\tvar path;\n\t\tvar extension;\n\n\t\tif (this.settings.encoding === \"base64\") {\n\t\t\treturn INPUT_TYPE.BASE64;\n\t\t}\n\n\t\tif(typeof(input) != \"string\") {\n\t\t\treturn INPUT_TYPE.BINARY;\n\t\t}\n\n\t\turl = new Url(input);\n\t\tpath = url.path();\n\t\textension = path.extension;\n\n\t\tif (!extension) {\n\t\t\treturn INPUT_TYPE.DIRECTORY;\n\t\t}\n\n\t\tif(extension === \"epub\"){\n\t\t\treturn INPUT_TYPE.EPUB;\n\t\t}\n\n\t\tif(extension === \"opf\"){\n\t\t\treturn INPUT_TYPE.OPF;\n\t\t}\n\n\t\tif(extension === \"json\"){\n\t\t\treturn INPUT_TYPE.MANIFEST;\n\t\t}\n\t}\n\n\n\t/**\n\t * unpack the contents of the Books packaging\n\t * @private\n\t * @param {Packaging} packaging object\n\t */\n\tunpack(packaging) {\n\t\tthis.package = packaging; //TODO: deprecated this\n\n\t\tthis.spine.unpack(this.packaging, this.resolve.bind(this), this.canonical.bind(this));\n\n\t\tthis.resources = new Resources(this.packaging.manifest, {\n\t\t\tarchive: this.archive,\n\t\t\tresolver: this.resolve.bind(this),\n\t\t\trequest: this.request.bind(this),\n\t\t\treplacements: this.settings.replacements || (this.archived ? \"blobUrl\" : \"base64\")\n\t\t});\n\n\t\tthis.loadNavigation(this.packaging).then(() => {\n\t\t\t// this.toc = this.navigation.toc;\n\t\t\tthis.loading.navigation.resolve(this.navigation);\n\t\t});\n\n\t\tif (this.packaging.coverPath) {\n\t\t\tthis.cover = this.resolve(this.packaging.coverPath);\n\t\t}\n\t\t// Resolve promises\n\t\tthis.loading.manifest.resolve(this.packaging.manifest);\n\t\tthis.loading.metadata.resolve(this.packaging.metadata);\n\t\tthis.loading.spine.resolve(this.spine);\n\t\tthis.loading.cover.resolve(this.cover);\n\t\tthis.loading.resources.resolve(this.resources);\n\t\tthis.loading.pageList.resolve(this.pageList);\n\n\t\tthis.isOpen = true;\n\n\t\tif(this.archived || this.settings.replacements && this.settings.replacements != \"none\") {\n\t\t\tthis.replacements().then(() => {\n\t\t\t\tthis.opening.resolve(this);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\t} else {\n\t\t\t// Resolve book opened promise\n\t\t\tthis.opening.resolve(this);\n\t\t}\n\n\t}\n\n\t/**\n\t * Load Navigation and PageList from package\n\t * @private\n\t * @param {Packaging} packaging\n\t */\n\tloadNavigation(packaging) {\n\t\tlet navPath = packaging.navPath || packaging.ncxPath;\n\t\tlet toc = packaging.toc;\n\n\t\t// From json manifest\n\t\tif (toc) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.navigation = new Navigation(toc);\n\n\t\t\t\tif (packaging.pageList) {\n\t\t\t\t\tthis.pageList = new PageList(packaging.pageList); // TODO: handle page lists from Manifest\n\t\t\t\t}\n\n\t\t\t\tresolve(this.navigation);\n\t\t\t});\n\t\t}\n\n\t\tif (!navPath) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.navigation = new Navigation();\n\t\t\t\tthis.pageList = new PageList();\n\n\t\t\t\tresolve(this.navigation);\n\t\t\t});\n\t\t}\n\n\t\treturn this.load(navPath, \"xml\")\n\t\t\t.then((xml) => {\n\t\t\t\tthis.navigation = new Navigation(xml);\n\t\t\t\tthis.pageList = new PageList(xml);\n\t\t\t\treturn this.navigation;\n\t\t\t});\n\t}\n\n\t/**\n\t * Gets a Section of the Book from the Spine\n\t * Alias for `book.spine.get`\n\t * @param {string} target\n\t * @return {Section}\n\t */\n\tsection(target) {\n\t\treturn this.spine.get(target);\n\t}\n\n\t/**\n\t * Sugar to render a book to an element\n\t * @param  {element | string} element element or string to add a rendition to\n\t * @param  {object} [options]\n\t * @return {Rendition}\n\t */\n\trenderTo(element, options) {\n\t\tthis.rendition = new Rendition(this, options);\n\t\tthis.rendition.attachTo(element);\n\n\t\treturn this.rendition;\n\t}\n\n\t/**\n\t * Set if request should use withCredentials\n\t * @param {boolean} credentials\n\t */\n\tsetRequestCredentials(credentials) {\n\t\tthis.settings.requestCredentials = credentials;\n\t}\n\n\t/**\n\t * Set headers request should use\n\t * @param {object} headers\n\t */\n\tsetRequestHeaders(headers) {\n\t\tthis.settings.requestHeaders = headers;\n\t}\n\n\t/**\n\t * Unarchive a zipped epub\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {string} [encoding]\n\t * @return {Archive}\n\t */\n\tunarchive(input, encoding) {\n\t\tthis.archive = new Archive();\n\t\treturn this.archive.open(input, encoding);\n\t}\n\n\t/**\n\t * Store the epubs contents\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {string} [encoding]\n\t * @return {Store}\n\t */\n\tstore(name) {\n\t\t// Use \"blobUrl\" or \"base64\" for replacements\n\t\tlet replacementsSetting = this.settings.replacements && this.settings.replacements !== \"none\";\n\t\t// Save original url\n\t\tlet originalUrl = this.url;\n\t\t// Save original request method\n\t\tlet requester = this.settings.requestMethod || request.bind(this);\n\t\t// Create new Store\n\t\tthis.storage = new Store(name, requester, this.resolve.bind(this));\n\t\t// Replace request method to go through store\n\t\tthis.request = this.storage.request.bind(this.storage);\n\n\t\tthis.opened.then(() => {\n\t\t\tif (this.archived) {\n\t\t\t\tthis.storage.requester = this.archive.request.bind(this.archive);\n\t\t\t}\n\t\t\t// Substitute hook\n\t\t\tlet substituteResources = (output, section) => {\n\t\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t\t};\n\n\t\t\t// Set to use replacements\n\t\t\tthis.resources.settings.replacements = replacementsSetting || \"blobUrl\";\n\t\t\t// Create replacement urls\n\t\t\tthis.resources.replacements().\n\t\t\t\tthen(() => {\n\t\t\t\t\treturn this.resources.replaceCss();\n\t\t\t\t});\n\n\t\t\tthis.storage.on(\"offline\", () => {\n\t\t\t\t// Remove url to use relative resolving for hrefs\n\t\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\t\t// Add hook to replace resources in contents\n\t\t\t\tthis.spine.hooks.serialize.register(substituteResources);\n\t\t\t});\n\n\t\t\tthis.storage.on(\"online\", () => {\n\t\t\t\t// Restore original url\n\t\t\t\tthis.url = originalUrl;\n\t\t\t\t// Remove hook\n\t\t\t\tthis.spine.hooks.serialize.deregister(substituteResources);\n\t\t\t});\n\n\t\t});\n\n\t\treturn this.storage;\n\t}\n\n\t/**\n\t * Get the cover url\n\t * @return {string} coverUrl\n\t */\n\tcoverUrl() {\n\t\tvar retrieved = this.loaded.cover.\n\t\t\tthen((url) => {\n\t\t\t\tif(this.archived) {\n\t\t\t\t\t// return this.archive.createUrl(this.cover);\n\t\t\t\t\treturn this.resources.get(this.cover);\n\t\t\t\t}else{\n\t\t\t\t\treturn this.cover;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn retrieved;\n\t}\n\n\t/**\n\t * Load replacement urls\n\t * @private\n\t * @return {Promise} completed loading urls\n\t */\n\treplacements() {\n\t\tthis.spine.hooks.serialize.register((output, section) => {\n\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t});\n\n\t\treturn this.resources.replacements().\n\t\t\tthen(() => {\n\t\t\t\treturn this.resources.replaceCss();\n\t\t\t});\n\t}\n\n\t/**\n\t * Find a DOM Range for a given CFI Range\n\t * @param  {EpubCFI} cfiRange a epub cfi range\n\t * @return {Range}\n\t */\n\tgetRange(cfiRange) {\n\t\tvar cfi = new EpubCFI(cfiRange);\n\t\tvar item = this.spine.get(cfi.spinePos);\n\t\tvar _request = this.load.bind(this);\n\t\tif (!item) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\treject(\"CFI could not be found\");\n\t\t\t});\n\t\t}\n\t\treturn item.load(_request).then(function (contents) {\n\t\t\tvar range = cfi.toRange(item.document);\n\t\t\treturn range;\n\t\t});\n\t}\n\n\t/**\n\t * Generates the Book Key using the identifer in the manifest or other string provided\n\t * @param  {string} [identifier] to use instead of metadata identifier\n\t * @return {string} key\n\t */\n\tkey(identifier) {\n\t\tvar ident = identifier || this.packaging.metadata.identifier || this.url.filename;\n\t\treturn `epubjs:${EPUBJS_VERSION}:${ident}`;\n\t}\n\n\t/**\n\t * Destroy the Book and all associated objects\n\t */\n\tdestroy() {\n\t\tthis.opened = undefined;\n\t\tthis.loading = undefined;\n\t\tthis.loaded = undefined;\n\t\tthis.ready = undefined;\n\n\t\tthis.isOpen = false;\n\t\tthis.isRendered = false;\n\n\t\tthis.spine && this.spine.destroy();\n\t\tthis.locations && this.locations.destroy();\n\t\tthis.pageList && this.pageList.destroy();\n\t\tthis.archive && this.archive.destroy();\n\t\tthis.resources && this.resources.destroy();\n\t\tthis.container && this.container.destroy();\n\t\tthis.packaging && this.packaging.destroy();\n\t\tthis.rendition && this.rendition.destroy();\n\n\t\tthis.spine = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.pageList = undefined;\n\t\tthis.archive = undefined;\n\t\tthis.resources = undefined;\n\t\tthis.container = undefined;\n\t\tthis.packaging = undefined;\n\t\tthis.rendition = undefined;\n\n\t\tthis.navigation = undefined;\n\t\tthis.url = undefined;\n\t\tthis.path = undefined;\n\t\tthis.archived = false;\n\t}\n\n}\n\n//-- Enable binding events to book\nEventEmitter(Book.prototype);\n\nexport default Book;\n","/* From https://github.com/webcomponents/URL/blob/master/url.js\n * Added UMD, file link handling */\n\n/* Any copyright is dedicated to the Public Domain.\n * http://creativecommons.org/publicdomain/zero/1.0/ */\n'use strict';\n(function (root, factory) {\n    // Fix for this being undefined in modules\n    if (!root) {\n      root = window || global;\n    }\n    if (typeof module === 'object' && module.exports) {\n        // Node\n        module.exports = factory(root);\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else {\n        // Browser globals (root is window)\n        root.URL = factory(root);\n  }\n}(this, function (scope) {\n  // feature detect for URL constructor\n  var hasWorkingUrl = false;\n  if (!scope.forceJURL) {\n    try {\n      var u = new URL('b', 'http://a');\n      u.pathname = 'c%20d';\n      hasWorkingUrl = u.href === 'http://a/c%20d';\n    } catch(e) {}\n  }\n\n  if (hasWorkingUrl)\n    return scope.URL;\n\n  var relative = Object.create(null);\n  relative['ftp'] = 21;\n  relative['file'] = 0;\n  relative['gopher'] = 70;\n  relative['http'] = 80;\n  relative['https'] = 443;\n  relative['ws'] = 80;\n  relative['wss'] = 443;\n\n  var relativePathDotMapping = Object.create(null);\n  relativePathDotMapping['%2e'] = '.';\n  relativePathDotMapping['.%2e'] = '..';\n  relativePathDotMapping['%2e.'] = '..';\n  relativePathDotMapping['%2e%2e'] = '..';\n\n  function isRelativeScheme(scheme) {\n    return relative[scheme] !== undefined;\n  }\n\n  function invalid() {\n    clear.call(this);\n    this._isInvalid = true;\n  }\n\n  function IDNAToASCII(h) {\n    if ('' == h) {\n      invalid.call(this)\n    }\n    // XXX\n    return h.toLowerCase()\n  }\n\n  function percentEscape(c) {\n    var unicode = c.charCodeAt(0);\n    if (unicode > 0x20 &&\n       unicode < 0x7F &&\n       // \" # < > ? `\n       [0x22, 0x23, 0x3C, 0x3E, 0x3F, 0x60].indexOf(unicode) == -1\n      ) {\n      return c;\n    }\n    return encodeURIComponent(c);\n  }\n\n  function percentEscapeQuery(c) {\n    // XXX This actually needs to encode c using encoding and then\n    // convert the bytes one-by-one.\n\n    var unicode = c.charCodeAt(0);\n    if (unicode > 0x20 &&\n       unicode < 0x7F &&\n       // \" # < > ` (do not escape '?')\n       [0x22, 0x23, 0x3C, 0x3E, 0x60].indexOf(unicode) == -1\n      ) {\n      return c;\n    }\n    return encodeURIComponent(c);\n  }\n\n  var EOF = undefined,\n      ALPHA = /[a-zA-Z]/,\n      ALPHANUMERIC = /[a-zA-Z0-9\\+\\-\\.]/;\n\n  function parse(input, stateOverride, base) {\n    function err(message) {\n      errors.push(message)\n    }\n\n    var state = stateOverride || 'scheme start',\n        cursor = 0,\n        buffer = '',\n        seenAt = false,\n        seenBracket = false,\n        errors = [];\n\n    loop: while ((input[cursor - 1] != EOF || cursor == 0) && !this._isInvalid) {\n      var c = input[cursor];\n      switch (state) {\n        case 'scheme start':\n          if (c && ALPHA.test(c)) {\n            buffer += c.toLowerCase(); // ASCII-safe\n            state = 'scheme';\n          } else if (!stateOverride) {\n            buffer = '';\n            state = 'no scheme';\n            continue;\n          } else {\n            err('Invalid scheme.');\n            break loop;\n          }\n          break;\n\n        case 'scheme':\n          if (c && ALPHANUMERIC.test(c)) {\n            buffer += c.toLowerCase(); // ASCII-safe\n          } else if (':' == c) {\n            this._scheme = buffer;\n            buffer = '';\n            if (stateOverride) {\n              break loop;\n            }\n            if (isRelativeScheme(this._scheme)) {\n              this._isRelative = true;\n            }\n            if ('file' == this._scheme) {\n              state = 'relative';\n            } else if (this._isRelative && base && base._scheme == this._scheme) {\n              state = 'relative or authority';\n            } else if (this._isRelative) {\n              state = 'authority first slash';\n            } else {\n              state = 'scheme data';\n            }\n          } else if (!stateOverride) {\n            buffer = '';\n            cursor = 0;\n            state = 'no scheme';\n            continue;\n          } else if (EOF == c) {\n            break loop;\n          } else {\n            err('Code point not allowed in scheme: ' + c)\n            break loop;\n          }\n          break;\n\n        case 'scheme data':\n          if ('?' == c) {\n            this._query = '?';\n            state = 'query';\n          } else if ('#' == c) {\n            this._fragment = '#';\n            state = 'fragment';\n          } else {\n            // XXX error handling\n            if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n              this._schemeData += percentEscape(c);\n            }\n          }\n          break;\n\n        case 'no scheme':\n          if (!base || !(isRelativeScheme(base._scheme))) {\n            err('Missing scheme.');\n            invalid.call(this);\n          } else {\n            state = 'relative';\n            continue;\n          }\n          break;\n\n        case 'relative or authority':\n          if ('/' == c && '/' == input[cursor+1]) {\n            state = 'authority ignore slashes';\n          } else {\n            err('Expected /, got: ' + c);\n            state = 'relative';\n            continue\n          }\n          break;\n\n        case 'relative':\n          this._isRelative = true;\n          if ('file' != this._scheme)\n            this._scheme = base._scheme;\n          if (EOF == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = base._query;\n            this._username = base._username;\n            this._password = base._password;\n            break loop;\n          } else if ('/' == c || '\\\\' == c) {\n            if ('\\\\' == c)\n              err('\\\\ is an invalid code point.');\n            state = 'relative slash';\n          } else if ('?' == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = '?';\n            this._username = base._username;\n            this._password = base._password;\n            state = 'query';\n          } else if ('#' == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = base._query;\n            this._fragment = '#';\n            this._username = base._username;\n            this._password = base._password;\n            state = 'fragment';\n          } else {\n            var nextC = input[cursor+1]\n            var nextNextC = input[cursor+2]\n            if (\n              'file' != this._scheme || !ALPHA.test(c) ||\n              (nextC != ':' && nextC != '|') ||\n              (EOF != nextNextC && '/' != nextNextC && '\\\\' != nextNextC && '?' != nextNextC && '#' != nextNextC)) {\n              this._host = base._host;\n              this._port = base._port;\n              this._username = base._username;\n              this._password = base._password;\n              this._path = base._path.slice();\n              this._path.pop();\n            }\n            state = 'relative path';\n            continue;\n          }\n          break;\n\n        case 'relative slash':\n          if ('/' == c || '\\\\' == c) {\n            if ('\\\\' == c) {\n              err('\\\\ is an invalid code point.');\n            }\n            if ('file' == this._scheme) {\n              state = 'file host';\n            } else {\n              state = 'authority ignore slashes';\n            }\n          } else {\n            if ('file' != this._scheme) {\n              this._host = base._host;\n              this._port = base._port;\n              this._username = base._username;\n              this._password = base._password;\n            }\n            state = 'relative path';\n            continue;\n          }\n          break;\n\n        case 'authority first slash':\n          if ('/' == c) {\n            state = 'authority second slash';\n          } else {\n            err(\"Expected '/', got: \" + c);\n            state = 'authority ignore slashes';\n            continue;\n          }\n          break;\n\n        case 'authority second slash':\n          state = 'authority ignore slashes';\n          if ('/' != c) {\n            err(\"Expected '/', got: \" + c);\n            continue;\n          }\n          break;\n\n        case 'authority ignore slashes':\n          if ('/' != c && '\\\\' != c) {\n            state = 'authority';\n            continue;\n          } else {\n            err('Expected authority, got: ' + c);\n          }\n          break;\n\n        case 'authority':\n          if ('@' == c) {\n            if (seenAt) {\n              err('@ already seen.');\n              buffer += '%40';\n            }\n            seenAt = true;\n            for (var i = 0; i < buffer.length; i++) {\n              var cp = buffer[i];\n              if ('\\t' == cp || '\\n' == cp || '\\r' == cp) {\n                err('Invalid whitespace in authority.');\n                continue;\n              }\n              // XXX check URL code points\n              if (':' == cp && null === this._password) {\n                this._password = '';\n                continue;\n              }\n              var tempC = percentEscape(cp);\n              (null !== this._password) ? this._password += tempC : this._username += tempC;\n            }\n            buffer = '';\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            cursor -= buffer.length;\n            buffer = '';\n            state = 'host';\n            continue;\n          } else {\n            buffer += c;\n          }\n          break;\n\n        case 'file host':\n          if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            if (buffer.length == 2 && ALPHA.test(buffer[0]) && (buffer[1] == ':' || buffer[1] == '|')) {\n              state = 'relative path';\n            } else if (buffer.length == 0) {\n              state = 'relative path start';\n            } else {\n              this._host = IDNAToASCII.call(this, buffer);\n              buffer = '';\n              state = 'relative path start';\n            }\n            continue;\n          } else if ('\\t' == c || '\\n' == c || '\\r' == c) {\n            err('Invalid whitespace in file host.');\n          } else {\n            buffer += c;\n          }\n          break;\n\n        case 'host':\n        case 'hostname':\n          if (':' == c && !seenBracket) {\n            // XXX host parsing\n            this._host = IDNAToASCII.call(this, buffer);\n            buffer = '';\n            state = 'port';\n            if ('hostname' == stateOverride) {\n              break loop;\n            }\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            this._host = IDNAToASCII.call(this, buffer);\n            buffer = '';\n            state = 'relative path start';\n            if (stateOverride) {\n              break loop;\n            }\n            continue;\n          } else if ('\\t' != c && '\\n' != c && '\\r' != c) {\n            if ('[' == c) {\n              seenBracket = true;\n            } else if (']' == c) {\n              seenBracket = false;\n            }\n            buffer += c;\n          } else {\n            err('Invalid code point in host/hostname: ' + c);\n          }\n          break;\n\n        case 'port':\n          if (/[0-9]/.test(c)) {\n            buffer += c;\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c || stateOverride) {\n            if ('' != buffer) {\n              var temp = parseInt(buffer, 10);\n              if (temp != relative[this._scheme]) {\n                this._port = temp + '';\n              }\n              buffer = '';\n            }\n            if (stateOverride) {\n              break loop;\n            }\n            state = 'relative path start';\n            continue;\n          } else if ('\\t' == c || '\\n' == c || '\\r' == c) {\n            err('Invalid code point in port: ' + c);\n          } else {\n            invalid.call(this);\n          }\n          break;\n\n        case 'relative path start':\n          if ('\\\\' == c)\n            err(\"'\\\\' not allowed in path.\");\n          state = 'relative path';\n          if ('/' != c && '\\\\' != c) {\n            continue;\n          }\n          break;\n\n        case 'relative path':\n          if (EOF == c || '/' == c || '\\\\' == c || (!stateOverride && ('?' == c || '#' == c))) {\n            if ('\\\\' == c) {\n              err('\\\\ not allowed in relative path.');\n            }\n            var tmp;\n            if (tmp = relativePathDotMapping[buffer.toLowerCase()]) {\n              buffer = tmp;\n            }\n            if ('..' == buffer) {\n              this._path.pop();\n              if ('/' != c && '\\\\' != c) {\n                this._path.push('');\n              }\n            } else if ('.' == buffer && '/' != c && '\\\\' != c) {\n              this._path.push('');\n            } else if ('.' != buffer) {\n              if ('file' == this._scheme && this._path.length == 0 && buffer.length == 2 && ALPHA.test(buffer[0]) && buffer[1] == '|') {\n                buffer = buffer[0] + ':';\n              }\n              this._path.push(buffer);\n            }\n            buffer = '';\n            if ('?' == c) {\n              this._query = '?';\n              state = 'query';\n            } else if ('#' == c) {\n              this._fragment = '#';\n              state = 'fragment';\n            }\n          } else if ('\\t' != c && '\\n' != c && '\\r' != c) {\n            buffer += percentEscape(c);\n          }\n          break;\n\n        case 'query':\n          if (!stateOverride && '#' == c) {\n            this._fragment = '#';\n            state = 'fragment';\n          } else if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n            this._query += percentEscapeQuery(c);\n          }\n          break;\n\n        case 'fragment':\n          if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n            this._fragment += c;\n          }\n          break;\n      }\n\n      cursor++;\n    }\n  }\n\n  function clear() {\n    this._scheme = '';\n    this._schemeData = '';\n    this._username = '';\n    this._password = null;\n    this._host = '';\n    this._port = '';\n    this._path = [];\n    this._query = '';\n    this._fragment = '';\n    this._isInvalid = false;\n    this._isRelative = false;\n  }\n\n  // Does not process domain names or IP addresses.\n  // Does not handle encoding for the query parameter.\n  function jURL(url, base /* , encoding */) {\n    if (base !== undefined && !(base instanceof jURL))\n      base = new jURL(String(base));\n\n    this._url = url;\n    clear.call(this);\n\n    var input = url.replace(/^[ \\t\\r\\n\\f]+|[ \\t\\r\\n\\f]+$/g, '');\n    // encoding = encoding || 'utf-8'\n\n    parse.call(this, input, null, base);\n  }\n\n  jURL.prototype = {\n    toString: function() {\n      return this.href;\n    },\n    get href() {\n      if (this._isInvalid)\n        return this._url;\n\n      var authority = '';\n      if ('' != this._username || null != this._password) {\n        authority = this._username +\n            (null != this._password ? ':' + this._password : '') + '@';\n      }\n\n      return this.protocol +\n          (this._isRelative ? '//' + authority + this.host : '') +\n          this.pathname + this._query + this._fragment;\n    },\n    set href(href) {\n      clear.call(this);\n      parse.call(this, href);\n    },\n\n    get protocol() {\n      return this._scheme + ':';\n    },\n    set protocol(protocol) {\n      if (this._isInvalid)\n        return;\n      parse.call(this, protocol + ':', 'scheme start');\n    },\n\n    get host() {\n      return this._isInvalid ? '' : this._port ?\n          this._host + ':' + this._port : this._host;\n    },\n    set host(host) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, host, 'host');\n    },\n\n    get hostname() {\n      return this._host;\n    },\n    set hostname(hostname) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, hostname, 'hostname');\n    },\n\n    get port() {\n      return this._port;\n    },\n    set port(port) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, port, 'port');\n    },\n\n    get pathname() {\n      return this._isInvalid ? '' : this._isRelative ?\n          '/' + this._path.join('/') : this._schemeData;\n    },\n    set pathname(pathname) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      this._path = [];\n      parse.call(this, pathname, 'relative path start');\n    },\n\n    get search() {\n      return this._isInvalid || !this._query || '?' == this._query ?\n          '' : this._query;\n    },\n    set search(search) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      this._query = '?';\n      if ('?' == search[0])\n        search = search.slice(1);\n      parse.call(this, search, 'query');\n    },\n\n    get hash() {\n      return this._isInvalid || !this._fragment || '#' == this._fragment ?\n          '' : this._fragment;\n    },\n    set hash(hash) {\n      if (this._isInvalid)\n        return;\n      this._fragment = '#';\n      if ('#' == hash[0])\n        hash = hash.slice(1);\n      parse.call(this, hash, 'fragment');\n    },\n\n    get origin() {\n      var host;\n      if (this._isInvalid || !this._scheme) {\n        return '';\n      }\n      // javascript: Gecko returns String(\"\"), WebKit/Blink String(\"null\")\n      // Gecko throws error for \"data://\"\n      // data: Gecko returns \"\", Blink returns \"data://\", WebKit returns \"null\"\n      // Gecko returns String(\"\") for file: mailto:\n      // WebKit/Blink returns String(\"SCHEME://\") for file: mailto:\n      switch (this._scheme) {\n        case 'file':\n          return 'file://' // EPUBJS Added\n        case 'data':\n        case 'javascript':\n        case 'mailto':\n          return 'null';\n      }\n      host = this.host;\n      if (!host) {\n        return '';\n      }\n      return this._scheme + '://' + host;\n    }\n  };\n\n  // Copy over the static methods\n  var OriginalURL = scope.URL;\n  if (OriginalURL) {\n    jURL.createObjectURL = function(blob) {\n      // IE extension allows a second optional options argument.\n      // http://msdn.microsoft.com/en-us/library/ie/hh772302(v=vs.85).aspx\n      return OriginalURL.createObjectURL.apply(OriginalURL, arguments);\n    };\n    jURL.revokeObjectURL = function(url) {\n      OriginalURL.revokeObjectURL(url);\n    };\n  }\n\n  return jURL;\n}));\n","import Book from \"./book\";\nimport Rendition from \"./rendition\";\nimport CFI from \"./epubcfi\";\nimport Contents from \"./contents\";\nimport * as utils from \"./utils/core\";\nimport { EPUBJS_VERSION } from \"./utils/constants\";\nimport '../libs/url/url-polyfill'\n\nimport IframeView from \"./managers/views/iframe\";\nimport DefaultViewManager from \"./managers/default\";\nimport ContinuousViewManager from \"./managers/continuous\";\n\n/**\n * Creates a new Book\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\n * @param {object} options to pass to the book\n * @returns {Book} a new Book object\n * @example ePub(\"/path/to/book.epub\", {})\n */\nfunction ePub(url, options) {\n\treturn new Book(url, options);\n}\n\nePub.VERSION = EPUBJS_VERSION;\n\nif (typeof(global) !== \"undefined\") {\n\tglobal.EPUBJS_VERSION = EPUBJS_VERSION;\n}\n\nePub.Book = Book;\nePub.Rendition = Rendition;\nePub.Contents = Contents;\nePub.CFI = CFI;\nePub.utils = utils;\n\nexport default ePub;\n","class PrefabViews {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t}\n\n\tall() {\n\t\treturn this._views;\n\t}\n\n\tfirst() {\n\t\treturn this._views[0];\n\t}\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t}\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t}\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t}\n\n\tget(i) {\n\t\treturn this._views[i];\n\t}\n\n\tappend(view){\n\t\tvar check = false;\n\t\tthis.forEach(function(v) {\n\t\t\tif ( v.section.href == view.section.href ) { check = true; }\n\t\t})\n\t\tif ( check ) { return view; }\n\t\t// if ( check ) { console.log(\"AHOY views.append WUT\", view.section.href)}\n\t\tthis._views.push(view);\n\t\tthis._views.sort(function(a,b) {return (a.section.href > b.section.href) ? 1 : ((b.section.href > a.section.href) ? -1 : 0);});\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tdump() {\n\t\treturn this._views.map(function(v) { return v.section.href });\n\t}\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t}\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\t// if(this.container && view.element.dataset.reused != 'true'){\n\t\t// \t this.container.removeChild(view.element);\n\t\t// }\n\t\tview = null;\n\t}\n\n\t// Iterators\n\n\tforEach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t}\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t}\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t}\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t}\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t}\n}\n\nexport default PrefabViews;\n","import {extend, defer, requestAnimationFrame} from \"epubjs/src/utils/core\";\nimport DefaultViewManager from \"epubjs/src/managers/default\";\nimport ContinuousViewManager from \"epubjs/src/managers/continuous/index\" ;\nimport PrefabViews from \"../helpers/prefab\";\n\nimport { EVENTS } from \"epubjs/src/utils/constants\";\nimport debounce from \"lodash/debounce\";\n\nclass PrePaginatedContinuousViewManager extends ContinuousViewManager {\n    constructor(options) {\n    super(options);\n\n    this.name = \"prepaginated\";\n\n    this._manifest = null;\n    this._spine = [];\n    this.settings.scale = this.settings.scale || 1.0;\n  }\n\n  render(element, size){\n    var scale = this.settings.scale;\n    this.settings.scale = null; // we don't want the stage to scale\n    ContinuousViewManager.prototype.render.call(this, element, size);\n    // Views array methods\n    // use prefab views\n    this.settings.scale = scale;\n    this.views = new PrefabViews(this.container);\n  }\n\n  onResized(e) {\n    if (this.resizeTimeout) {\n      clearTimeout(this.resizeTimeout);\n    }\n    console.log(\"AHOY PREPAGINATED onResized queued\");\n    this.resizeTimeout = setTimeout(function() {\n      this.resize();\n      console.log(\"AHOY PREPAGINATED onResized actual\");\n      this.resizeTimeout = null;\n    }.bind(this), 500);\n    // this.resize();\n  }\n\n  resize(width, height) {\n    var self = this;\n\n    ContinuousViewManager.prototype.resize.call(this, width, height);\n    this._redrawViews();\n  }\n\n  _redrawViews() {\n    var self = this;\n    for(var i = 0; i < self._spine.length; i++) {\n      var href = self._spine[i];\n      // // console.log(\"AHOY DRAWING\", href);\n      var section_ = self._manifest[href];\n      // // var r = self.container.offsetWidth / section_.viewport.width;\n      // // var h = Math.floor(dim.height * r);\n      // var w = self.layout.columnWidth + ( self.layout.columnWidth * 0.10 );\n      // var r = w / section_.viewport.width;\n      // var h = Math.floor(section_.viewport.height * r);\n\n      var h, w;\n      [ w, h ] = self.sizeToViewport(section_);\n\n      var div = self.container.querySelector(`div.epub-view[ref=\"${section_.index}\"]`);\n      div.style.width = `${w}px`;\n      div.style.height = `${h}px`;\n      div.setAttribute('original-height', h);\n      div.setAttribute('layout-height', h);\n\n      var view = this.views.find(section_);\n      if ( view ) {\n          view.size(w, h);\n      }\n    }\n  }\n\n  // RRE - debugging\n  createView(section) {\n\n    var view = this.views.find(section);\n    if ( view ) {\n      return view;\n    }\n\n    var w, h;\n    [ w, h ] = this.sizeToViewport(section);\n    var viewSettings = Object.assign({}, this.viewSettings);\n    viewSettings.layout = Object.assign( Object.create( Object.getPrototypeOf(this.viewSettings.layout)), this.viewSettings.layout);\n    viewSettings.layout.height = h;\n    viewSettings.layout.columnWidth = w;\n    var view = new this.View(section, viewSettings);\n    return view;\n  }\n\n  display(section, target){\n    var self = this;\n    var promises = [];\n\n    this.q.clear();\n    var display = new defer();\n    var promises = [];\n    this.faking = {};\n\n    if ( ! this._manifest ) {\n      this.emit(\"building\");\n      self._manifest = {};\n      var _buildManifest = function(section_) {\n        self._manifest[section_.href] = false;\n        if ( self.settings.viewports && self.settings.viewports[section_.href] ) {\n          section_.viewport = self.settings.viewports[section_.href];\n          self._manifest[section_.href] = section_;\n        } else {\n          self.q.enqueue(() => {\n            section_.load(self.request).then(function(contents) {\n              var meta = contents.querySelector('meta[name=\"viewport\"]');\n              var value = meta.getAttribute('content');\n              var tmp = value.split(\",\");\n              var key = section_.href;\n              var idx = self._spine.indexOf(key);\n              self.emit(\"building\", { index: idx + 1, total: self._spine.length });\n              section_.viewport = {};\n              self._manifest[key] = section_;\n              // self._manifest[key] = { viewport : {} };\n              // self._manifest[key].index = section_.index;\n              // self._manifest[key].href = section_.href;\n              var viewport_width = tmp[0].replace('width=','');\n              var viewport_height = tmp[1].replace('height=','');\n              if ( ! viewport_height.match(/^\\d+$/) ) {\n                viewport_width = viewport_height = 'auto';\n              } else {\n                viewport_width = parseInt(viewport_width, 10);\n                viewport_height = parseInt(viewport_height, 10);\n              }\n              self._manifest[key].viewport.width = viewport_width;\n              self._manifest[key].viewport.height = viewport_height;\n              self.faking[key] = self._manifest[key].viewport;\n            })\n          });\n        }\n      }\n\n      // can we build a manifest here?\n      var prev_ = section.prev();\n      while ( prev_ ) {\n        self._spine.unshift(prev_.href);\n        _buildManifest(prev_);\n        prev_ = prev_.prev();\n      }\n\n      self._spine.push(section.href);\n      _buildManifest(section);\n\n      var next_ = section.next();\n      while ( next_ ) {\n        self._spine.push(next_.href);\n        _buildManifest(next_);\n        next_ = next_.next();\n      }\n\n      console.log(\"AHOY PRE-PAGINATED\", promises.length);\n    }\n\n    var _display = function() {\n\n      var check = document.querySelector('.epub-view');\n      if ( ! check ) {\n        self._max_height = self._max_viewport_height = 0;\n        self._max_width = self._max_viewport_width = 0;\n        console.log(\"AHOY DRAWING\", self._spine.length);\n        for(var i = 0; i < self._spine.length; i++) {\n          var href = self._spine[i];\n          var section_ = self._manifest[href];\n          var w, h;\n          [w, h] = self.sizeToViewport(section_);\n\n          self.container.innerHTML += `<div class=\"epub-view\" ref=\"${section_.index}\" data-href=\"${section_.href}\" style=\"width: ${w}px; height: ${h}px; text-align: center; margin-left: auto; margin-right: auto\"></div>`;\n          var div = self.container.querySelector(`div.epub-view[ref=\"${section_.index}\"]`);\n          // div.setAttribute('use-')\n          div.setAttribute('original-height', h);\n          div.setAttribute('layout-height', h);\n\n          if ( window.debugManager ) {\n            div.style.backgroundImage = `url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 32' width='300' height='32'%3e%3cstyle%3e.small %7b fill: rgba(0,0,0,0.3);%7d%3c/style%3e%3ctext x='0' y='25' class='small'%3e${section_.href}%3c/text%3e%3c/svg%3e\")`;\n            var colorR = Math.floor(Math.random() * 100).toString();\n            var colorG = Math.floor(Math.random() * 100).toString();\n            var colorB = Math.floor(Math.random() * 100).toString();\n            div.style.backgroundColor = `#${colorR}${colorG}${colorB}`;\n          }\n        }\n      }\n\n      // find the <div> with this section\n      // console.log(\"AHOY continuous.display START\", section.href);\n      var div = self.container.querySelector(`div.epub-view[ref=\"${section.index}\"]`);\n      div.scrollIntoView();\n\n      // this.q.clear();\n      // return check ? this.update() : this.check();\n      // var retval = check ? this.update() : this.check();\n      var retval = this.check();\n            console.log(\"AHOY DISPLAY\", check ? \"UPDATE\" : \"CHECK\", retval);\n      retval.then(function() {\n        this.q.clear();\n                console.log(\"AHOY MANAGER BUILT\");\n        this.emit(\"built\");\n        return display.resolve();\n      }.bind(this));\n\n      // return DefaultViewManager.prototype.display.call(this, section, target)\n      //  .then(function () {\n      //    return this.fill();\n      //  }.bind(this));\n\n            return retval;\n    }.bind(this);\n\n    // // promises.push(_display);\n    // while(promises.length) {\n    //  this.q.enqueue(promises.shift);\n    // }\n\n    // console.log(\"AHOY PREPAGINATED\", this.q._q.length);\n    // this.q.enqueue().then((result) => {\n    //  display.resolve();\n    // })\n\n    var q = function() {\n      return this.q.enqueue((result) => {\n        var waiting = 0;\n        for(var i = 0; i < self._spine.length; i++) {\n          var href = self._spine[i];\n          var has_section = self._manifest[href];\n          if ( has_section == false ) { waiting += 1; }\n        }\n        // console.log(\"AHOY PRE-PAGINATED WAITING\", waiting);\n        if ( waiting == 0 ) {\n          return _display();\n        } else {\n          q();\n        }\n      })\n    }.bind(this);\n\n    return q();\n\n    return display.promise;\n\n  }\n\n  _checkStillLoading() {\n    this.q.enqueue((result) => {\n      var waiting = 0;\n      for(var i = 0; i < self._spine.length; i++) {\n        var href = self._spine[i];\n        var has_section = self._manifest[href];\n        if ( has_section == false ) { waiting += 1; }\n      }\n      console.log(\"AHOY PRE-PAGINATED WAITING\", waiting);\n      if ( waiting == 0 ) {\n        return _display();\n      } else {\n        q();\n      }\n    })\n  }\n\n  fill(_full) {\n    var full = _full || new defer();\n\n    this.q.enqueue(() => {\n      return this._checkStillLoading();\n    }).then((result) => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n\n    return full.promise;\n  }\n\n  fillXX(_full){\n    var full = _full || new defer();\n\n    this.q.enqueue(() => {\n      return this.check();\n    }).then((result) => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n\n    return full.promise;\n  }\n\n  moveTo(offset){\n    // var bounds = this.stage.bounds();\n    // var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n    var distX = 0,\n        distY = 0;\n\n    var offsetX = 0,\n        offsetY = 0;\n\n    if(!this.isPaginated) {\n      distY = offset.top;\n      offsetY = offset.top+this.settings.offset;\n    } else {\n      distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n      offsetX = distX+this.settings.offset;\n    }\n\n    if (distX > 0 || distY > 0) {\n      this.scrollBy(distX, distY, true);\n    }\n  }\n\n  afterResized(view){\n    this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n  }\n\n  // Remove Previous Listeners if present\n  removeShownListeners(view){\n\n    // view.off(\"shown\", this.afterDisplayed);\n    // view.off(\"shown\", this.afterDisplayedAbove);\n    view.onDisplayed = function(){};\n\n  }\n\n  add(section){\n    var view = this.createView(section);\n\n    this.views.append(view);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      view.expanded = true;\n    });\n\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n\n    // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n\n    return view.display(this.request);\n  }\n\n  append(section){\n\n    var view = this.createView(section);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      view.expanded = true;\n      // do not do this\n      // this.counter(bounds); // RRE\n    });\n\n    /*\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n    */\n\n    this.views.append(view);\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n\n    return view;\n  }\n\n  prepend(section){\n    var view = this.createView(section);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      this.counter(bounds);\n      view.expanded = true;\n    });\n\n    /*\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n    */\n\n    this.views.prepend(view);\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n\n    return view;\n  }\n\n  counter(bounds){\n    // return;\n    if(this.settings.axis === \"vertical\") {\n      // if ( ! this._timer ) {\n      //  this._timer = setTimeout(function() {\n      //    this._timer = null;\n      //    console.log(\"AHOY USING counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      //    this.scrollBy(0, bounds.heightDelta, true);\n      //    this.x1(`COUNTER ${bounds.heightDelta}`);\n      //  }.bind(this), 500);\n      // } else {\n      //  console.log(\"AHOY SKIPPING counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      // }\n      // console.log(\"AHOY counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      this.scrollBy(0, bounds.heightDelta, true);\n    } else {\n      this.scrollBy(bounds.widthDelta, 0, true);\n    }\n\n  }\n\n  updateXXX(_offset) {\n    var offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n    var visibleLength = horizontal ? bounds.width : bounds.height;\n    var contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n    var divs = document.querySelectorAll('.epub-view');\n    var visible = [];\n    for(var i = 0; i < divs.length; i++) {\n      var div = divs[i];\n      var rect = div.getBoundingClientRect();\n      var marker = '';\n      // if ( rect.top > offset + bounds.height && ( rect.top + rect.height ) <= offset ) {\n      // if ( adjusted_top < ( div.offsetTop + rect.height ) && adjusted_end > div.offsetTop ) {\n      if ( offset < ( div.offsetTop + rect.height ) && ( offset + bounds.height ) > div.offsetTop ) {\n        marker = '**';\n        var section = this._manifest[div.dataset.href];\n        visible.push(section);\n        // if ( ! div.querySelector('iframe') ) {\n        //  newViews.push(this.append(section))\n        // }\n        // var idx = this._spine.indexOf(section.href);\n        // if ( idx > 0 ) {\n        //  visible.push(this._manifest[this._spine[idx - 1]]);\n        // }\n        // if ( idx < this._spine.length - 1 ) {\n        //  visible.push(this._manifest[this._spine[idx + 1]]);\n        // }\n      }\n      // console.log(\"AHOY\", div.dataset.href, rect.top, rect.height, \"/\", div.offsetTop, div.offsetHeight, \"/\", offset, bounds.height, marker);\n    }\n\n  }\n\n  update(_offset){\n    var container = this.bounds();\n    var views = this.views.all();\n    var viewsLength = views.length;\n    var visible = [];\n    var offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n    var isVisible;\n    var view;\n\n    var updating = new defer();\n    var promises = [];\n    var queued = {};\n    for (var i = 0; i < viewsLength; i++) {\n      view = views[i];\n\n      isVisible = this.isVisible(view, offset, offset, container);\n      if ( isVisible === true ) {\n        queued[i] = true;\n      }\n    }\n\n    for(var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      var isVisible = queued[i];\n      if(isVisible === true) {\n        // console.log(\"visible \" + view.index);\n\n        if (!view.displayed) {\n          // console.log(\"AHOY continuous.update !displayed\", view.section.href);\n          let displayed = view.display(this.request)\n            .then(function (view) {\n              view.show();\n            }, (err) => {\n              // console.log(\"AHOY continuous.update ERROR\", err);\n              view.hide();\n            });\n          promises.push(displayed);\n        } else {\n          // console.log(\"AHOY continuous.update show\", view.section.href);\n          view.show();\n        }\n        visible.push(view);\n      } else {\n        this.q.enqueue(view.destroy.bind(view));\n        // console.log(\"hidden \" + view.index);\n\n        clearTimeout(this.trimTimeout);\n        this.trimTimeout = setTimeout(function(){\n          this.q.enqueue(this.trim.bind(this));\n        }.bind(this), 250);\n      }\n\n    }\n\n    if(promises.length){\n      return Promise.all(promises)\n        .catch((err) => {\n          updating.reject(err);\n        });\n    } else {\n      updating.resolve();\n      return updating.promise;\n    }\n\n  }\n\n  check(_offsetLeft, _offsetTop){\n    var checking = new defer();\n    var newViews = [];\n\n    var horizontal = (this.settings.axis === \"horizontal\");\n    var delta = this.settings.offset || 0;\n\n    if (_offsetLeft && horizontal) {\n      delta = _offsetLeft;\n    }\n\n    if (_offsetTop && !horizontal) {\n      delta = _offsetTop;\n    }\n\n    var bounds = this._bounds; // bounds saved this until resize\n\n    let rtl = this.settings.direction === \"rtl\";\n    let dir = horizontal && rtl ? -1 : 1; //RTL reverses scrollTop\n\n    var offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n    var visibleLength = horizontal ? bounds.width : bounds.height;\n    var contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n    var prePaginated = this.layout.props.name == 'pre-paginated';\n\n    // console.log(\"continuous.check prePaginated =\", prePaginated, \"offset=\",\n    //  offset, \"visibleLength =\", visibleLength, \"delta=\", delta, ` (${offset + visibleLength + delta})`, \" >= contentLength =\", contentLength,\n    //  \" == \", offset + visibleLength + delta >= contentLength,\n    //  \" || \", offset - delta, \"<\", 0, \" == \", offset - delta < 0 );\n\n    let prepend = () => {\n      let first = this.views.first();\n      let prev = first && first.section.prev();\n\n      if(prev) {\n        newViews.push(this.prepend(prev));\n      }\n    };\n\n    let append = () => {\n      let last = this.views.last();\n      let next = last && last.section.next();\n\n      if(next) {\n        newViews.push(this.append(next));\n      }\n\n    };\n\n    var adjusted_top = offset - ( bounds.height * 8 );\n    var adjusted_end = offset + ( bounds.height * 8 );\n    // console.log(\"AHOY check\", offset, \"-\", offset + bounds.height, \"/\", adjusted_top, \"-\", adjusted_end);\n\n    // need to figure out which divs are viewable\n    var divs = document.querySelectorAll('.epub-view');\n    var visible = [];\n    for(var i = 0; i < divs.length; i++) {\n      var div = divs[i];\n      var rect = div.getBoundingClientRect();\n      var marker = '';\n      // if ( rect.top > offset + bounds.height && ( rect.top + rect.height ) <= offset ) {\n      // if ( adjusted_top < ( div.offsetTop + rect.height ) && adjusted_end > div.offsetTop ) {\n      if ( offset < ( div.offsetTop + rect.height ) && ( offset + bounds.height ) > div.offsetTop ) {\n        marker = '**';\n        var section = this._manifest[div.dataset.href];\n        visible.push(section);\n        // if ( ! div.querySelector('iframe') ) {\n        //  newViews.push(this.append(section))\n        // }\n        // var idx = this._spine.indexOf(section.href);\n        // if ( idx > 0 ) {\n        //  visible.push(this._manifest[this._spine[idx - 1]]);\n        // }\n        // if ( idx < this._spine.length - 1 ) {\n        //  visible.push(this._manifest[this._spine[idx + 1]]);\n        // }\n      }\n      // console.log(\"AHOY\", div.dataset.href, rect.top, rect.height, \"/\", div.offsetTop, div.offsetHeight, \"/\", offset, bounds.height, marker);\n    }\n\n    this.__check_visible = visible;\n\n    var section = visible[0];\n    if ( section && section.index > 0 ) {\n      visible.unshift(this._manifest[this._spine[section.index - 1]]);\n    }\n    if ( section ) {\n      var tmp = this._spine[section.index + 1];\n      if ( tmp ) {\n        visible.push(this._manifest[tmp]);\n      }\n    }\n    // if ( section && section.prev() ) {\n    //  visible.unshift(section.prev());\n    // }\n    // section = visible[visible.length - 1];\n    // if (section && section.next() ) {\n    //  visible.push(section.next());\n    // }\n\n    for(var i = 0; i < visible.length; i++) {\n      var section = visible[i];\n      // var div = document.querySelector(`.epub-view[ref=\"${section.index}\"]`);\n      // if ( div.querySelector('iframe') ) {\n      //  continue;\n      // }\n      newViews.push(this.append(section));\n    }\n\n    // let promises = newViews.map((view) => {\n    //  return view.displayed;\n    // });\n\n    var promises = [];\n    for(var i = 0; i < newViews.length; i++) {\n      if ( newViews[i] ) {\n        promises.push(newViews[i]);\n      }\n    }\n\n    if(newViews.length){\n      return Promise.all(promises)\n        .then(() => {\n          // return this.check();\n          // if (this.layout.name === \"pre-paginated\" && this.layout.props.spread && this.layout.flow() != 'scrolled') {\n          //   // console.log(\"AHOY check again\");\n          //   return this.check();\n          // }\n        })\n        .then(() => {\n          // Check to see if anything new is on screen after rendering\n          // console.log(\"AHOY update again\");\n          return this.update(delta);\n        }, (err) => {\n          return err;\n        });\n    } else {\n      this.q.enqueue(function(){\n        this.update();\n      }.bind(this));\n      checking.resolve(false);\n      return checking.promise;\n    }\n\n\n  }\n\n  trim(){\n    var task = new defer();\n    var displayed = this.views.displayed();\n    var first = displayed[0];\n    var last = displayed[displayed.length-1];\n    var firstIndex = this.views.indexOf(first);\n    var lastIndex = this.views.indexOf(last);\n    var above = this.views.slice(0, firstIndex);\n    var below = this.views.slice(lastIndex+1);\n\n    // Erase all but last above\n    for (var i = 0; i < above.length-3; i++) {\n      if ( above[i] ) {\n        // console.log(\"AHOY trim > above\", first.section.href, \":\", above[i].section.href);\n        this.erase(above[i], above);\n      }\n    }\n\n    // Erase all except first below\n    for (var j = 3; j < below.length; j++) {\n      if ( below[j] ) {\n        // console.log(\"AHOY trim > below\", last.section.href, \":\", below[j].section.href);\n        this.erase(below[j]);\n      }\n    }\n\n    task.resolve();\n    return task.promise;\n  }\n\n  erase(view, above){ //Trim\n\n    var prevTop;\n    var prevLeft;\n\n    if(this.settings.height) {\n      prevTop = this.container.scrollTop;\n      prevLeft = this.container.scrollLeft;\n    } else {\n      prevTop = window.scrollY;\n      prevLeft = window.scrollX;\n    }\n\n    var bounds = view.bounds();\n\n    // console.log(\"AHOY erase\", view.section.href, above);\n    this.views.remove(view);\n\n    if(above) {\n      if(this.settings.axis === \"vertical\") {\n        // this.scrollTo(0, prevTop - bounds.height, true);\n      } else {\n        this.scrollTo(prevLeft - bounds.width, 0, true);\n      }\n    }\n\n  }\n\n  addEventListeners(stage){\n\n    window.addEventListener(\"unload\", function(e){\n      this.ignore = true;\n      // this.scrollTo(0,0);\n      this.destroy();\n    }.bind(this));\n\n    this.addScrollListeners();\n  }\n\n  addScrollListeners() {\n    var scroller;\n\n    this.tick = requestAnimationFrame;\n\n    if(this.settings.height) {\n      this.prevScrollTop = this.container.scrollTop;\n      this.prevScrollLeft = this.container.scrollLeft;\n    } else {\n      this.prevScrollTop = window.scrollY;\n      this.prevScrollLeft = window.scrollX;\n    }\n\n    this.scrollDeltaVert = 0;\n    this.scrollDeltaHorz = 0;\n\n    if(this.settings.height) {\n      scroller = this.container;\n      this.scrollTop = this.container.scrollTop;\n      this.scrollLeft = this.container.scrollLeft;\n    } else {\n      scroller = window;\n      this.scrollTop = window.scrollY;\n      this.scrollLeft = window.scrollX;\n    }\n\n    scroller.addEventListener(\"scroll\", this.onScroll.bind(this));\n    this._scrolled = debounce(this.scrolled.bind(this), 30);\n    // this.tick.call(window, this.onScroll.bind(this));\n\n    this.didScroll = false;\n\n  }\n\n  removeEventListeners(){\n    var scroller;\n\n    if(this.settings.height) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this.onScroll.bind(this));\n  }\n\n  onScroll(){\n    let scrollTop;\n    let scrollLeft;\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n    if(this.settings.height) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY * dir;\n      scrollLeft = window.scrollX * dir;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if(!this.ignore) {\n\n      this._scrolled();\n\n    } else {\n      this.ignore = false;\n    }\n\n    this.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n    this.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n    this.prevScrollTop = scrollTop;\n    this.prevScrollLeft = scrollLeft;\n\n    clearTimeout(this.scrollTimeout);\n    this.scrollTimeout = setTimeout(function(){\n      this.scrollDeltaVert = 0;\n      this.scrollDeltaHorz = 0;\n    }.bind(this), 150);\n\n\n    this.didScroll = false;\n\n  }\n\n  scrolled() {\n    this.q.enqueue(function() {\n      this.check();\n      this.recenter();\n      setTimeout(function() {\n        this.emit(EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 500);\n    }.bind(this));\n\n    this.emit(EVENTS.MANAGERS.SCROLL, {\n      top: this.scrollTop,\n      left: this.scrollLeft\n    });\n\n    clearTimeout(this.afterScrolled);\n    this.afterScrolled = setTimeout(function () {\n      this.emit(EVENTS.MANAGERS.SCROLLED, {\n        top: this.scrollTop,\n        left: this.scrollLeft\n      });\n    }.bind(this));\n  }\n\n  next(){\n\n    let dir = this.settings.direction;\n    let delta = this.layout.props.name === \"pre-paginated\" &&\n                this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n    delta = this.container.offsetHeight / this.settings.scale;\n\n    if(!this.views.length) return;\n\n    if(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n      this.scrollBy(delta, 0, true);\n\n    } else {\n\n      // this.scrollBy(0, this.layout.height, true);\n      this.scrollBy(0, delta, true);\n\n    }\n\n    this.q.enqueue(function() {\n      this.check();\n    }.bind(this));\n  }\n\n  prev(){\n\n    let dir = this.settings.direction;\n    let delta = this.layout.props.name === \"pre-paginated\" &&\n                this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n    if(!this.views.length) return;\n\n    if(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n      this.scrollBy(-delta, 0, true);\n\n    } else {\n\n      this.scrollBy(0, -this.layout.height, true);\n\n    }\n\n    this.q.enqueue(function() {\n      this.check();\n    }.bind(this));\n  }\n\n  updateAxis(axis, forceUpdate){\n\n    if (!this.isPaginated) {\n      axis = \"vertical\";\n    }\n\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n\n    this.settings.axis = axis;\n\n    this.stage && this.stage.axis(axis);\n\n    this.viewSettings.axis = axis;\n\n    if (this.mapping) {\n      this.mapping.axis(axis);\n    }\n\n    if (this.layout) {\n      if (axis === \"vertical\") {\n        this.layout.spread(\"none\");\n      } else {\n        this.layout.spread(this.layout.settings.spread);\n      }\n    }\n\n    if (axis === \"vertical\") {\n      this.settings.infinite = true;\n    } else {\n      this.settings.infinite = false;\n    }\n  }\n\n  recenter() {\n    var wrapper = this.container.parentElement;\n    var w3 = ( wrapper.scrollWidth / 2 ) - ( wrapper.offsetWidth / 2 );\n    wrapper.scrollLeft = w3;\n  }\n\n  sizeToViewport(section) {\n    var h = this.layout.height;\n    // reduce to 80% to avoid hacking epubjs/layout.js\n    var w = this.layout.columnWidth * 0.8 * this.settings.scale;\n    if ( section.viewport.height != 'auto' ) {\n      if ( this.layout.columnWidth > section.viewport.width ) {\n        w = section.viewport.width * this.settings.scale;\n      }\n      var r = w / section.viewport.width;\n      h = Math.floor(section.viewport.height * r);\n    }\n    return [w, h];\n  }\n\n  sizeToViewport_X(section) {\n    var h = this.layout.height;\n    var w = this.layout.columnWidth * 0.80;\n\n    if ( section.viewport.height != 'auto' ) {\n\n      var r = w / section.viewport.width;\n      h = section.viewport.height * r;\n      var f = 1 / 0.60;\n      var m = Math.min(( f * this.layout.height ) / h, 1.0);\n      console.log(\"AHOY SHRINKING\", `( ${f} * ${this.layout.height} ) / ${h} = ${m} :: ${h * m}`);\n      h *= m;\n\n      h *= this.settings.scale;\n      if ( h > section.viewport.height ) {\n        h = section.viewport.height;\n      }\n\n      r = h / section.viewport.height;\n      w = section.viewport.width * r;\n\n      h = Math.floor(h);\n      w = Math.floor(w);\n    }\n    return [w, h];\n  }\n\n  scale(scale) {\n    var self = this;\n    this.settings.scale = scale;\n    var current = this.currentLocation();\n    var index = -1;\n    if ( current[0] ) {\n      index = current[0].index; \n    }\n\n    this.views.hide();\n    this.views.clear();\n    this._redrawViews();\n    this.views.show();\n    setTimeout(function() {\n      console.log(\"AHOY JUMPING TO\", index);\n      if ( index > -1 ) {\n        var div = self.container.querySelector(`div.epub-view[ref=\"${index}\"]`);\n        div.scrollIntoView(true);\n      }\n      this.check().then(function() {\n        this.onScroll();\n      }.bind(this))\n    }.bind(this), 0);\n  }\n\n  resetScale() {\n    // NOOP\n  }\n\n}\n\nPrePaginatedContinuousViewManager.toString = function() { return 'prepaginated'; }\n\nexport default PrePaginatedContinuousViewManager;\n\n","import IframeView from \"epubjs/src/managers/views/iframe\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"epubjs/src/utils/core\";\n\nclass ReusableIframeView extends IframeView {\n    constructor(section, options) {\n        super(section, options);\n        // this._layout.height = null;\n    }\n\n    container(axis) {\n        var check = document.querySelector(`div[ref='${this.index}']`);\n        if ( check ) {\n            check.dataset.reused = 'true';\n            return check;\n        }\n\n        var element = document.createElement(\"div\");\n\n        element.classList.add(\"epub-view\");\n\n        // this.element.style.minHeight = \"100px\";\n        element.style.height = \"0px\";\n        element.style.width = \"0px\";\n        element.style.overflow = \"hidden\";\n        element.style.position = \"relative\";\n        element.style.display = \"block\";\n\n        if(axis && axis == \"horizontal\"){\n            element.style.flex = \"none\";\n        } else {\n            element.style.flex = \"initial\";\n        }\n\n        return element;\n    }\n\n    create() {\n\n        if(this.iframe) {\n            return this.iframe;\n        }\n\n        if(!this.element) {\n            this.element = this.createContainer();\n        }\n\n        if ( this.element.hasAttribute('layout-height') ) {\n            var height = parseInt(this.element.getAttribute('layout-height'), 10);\n            this._layout_height = height;\n        }\n\n        this.iframe = this.element.querySelector(\"iframe\");\n        if ( this.iframe ) {\n            return this.iframe;\n        }\n\n        this.iframe = document.createElement(\"iframe\");\n        this.iframe.id = this.id;\n        this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n        this.iframe.style.overflow = \"hidden\";\n        this.iframe.seamless = \"seamless\";\n        // Back up if seamless isn't supported\n        this.iframe.style.border = \"none\";\n\n        this.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n        this.resizing = true;\n\n        // this.iframe.style.display = \"none\";\n        this.element.style.visibility = \"hidden\";\n        this.iframe.style.visibility = \"hidden\";\n\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n\n        this.element.setAttribute(\"ref\", this.index);\n        this.element.setAttribute(\"data-href\", this.section.href);\n\n        // this.element.appendChild(this.iframe);\n        this.added = true;\n\n        this.elementBounds = bounds(this.element);\n\n        // if(width || height){\n        //   this.resize(width, height);\n        // } else if(this.width && this.height){\n        //   this.resize(this.width, this.height);\n        // } else {\n        //   this.iframeBounds = bounds(this.iframe);\n        // }\n\n\n        if((\"srcdoc\" in this.iframe)) {\n            this.supportsSrcdoc = true;\n        } else {\n            this.supportsSrcdoc = false;\n        }\n\n        if (!this.settings.method) {\n            this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n        }\n\n        return this.iframe;\n    }\n\n}\n\nexport default ReusableIframeView;\n","'use strict';\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== 'function') return false;\n\tobj = { foo: 'raz' };\n\tassign(obj, { bar: 'dwa' }, { trzy: 'trzy' });\n\treturn (obj.foo + obj.bar + obj.trzy) === 'razdwatrzy';\n};\n","'use strict';\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys('primitive');\n\t\treturn true;\n\t} catch (e) { return false; }\n};\n","'use strict';\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) {\n\treturn keys(object == null ? object : Object(object));\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.keys\n\t: require('./shim');\n","'use strict';\n\nmodule.exports = function (value) {\n\tif (value == null) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","'use strict';\n\nvar keys  = require('../keys')\n  , value = require('../valid-value')\n\n  , max = Math.max;\n\nmodule.exports = function (dest, src/*, …srcn*/) {\n\tvar error, i, l = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry { dest[key] = src[key]; } catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < l; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.assign\n\t: require('./shim');\n","'use strict';\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\nmodule.exports = function (options/*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (options == null) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","// Deprecated\n\n'use strict';\n\nmodule.exports = function (obj) { return typeof obj === 'function'; };\n","'use strict';\n\nvar str = 'razdwatrzy';\n\nmodule.exports = function () {\n\tif (typeof str.contains !== 'function') return false;\n\treturn ((str.contains('dwa') === true) && (str.contains('foo') === false));\n};\n","'use strict';\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? String.prototype.contains\n\t: require('./shim');\n","'use strict';\n\nvar assign        = require('es5-ext/object/assign')\n  , normalizeOpts = require('es5-ext/object/normalize-options')\n  , isCallable    = require('es5-ext/object/is-callable')\n  , contains      = require('es5-ext/string/#/contains')\n\n  , d;\n\nd = module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif ((arguments.length < 2) || (typeof dscr !== 'string')) {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (dscr == null) {\n\t\tc = w = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t\tw = contains.call(dscr, 'w');\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== 'string') {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (get == null) {\n\t\tget = undefined;\n\t} else if (!isCallable(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (set == null) {\n\t\tset = undefined;\n\t} else if (!isCallable(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (dscr == null) {\n\t\tc = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","'use strict';\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","function Viewport(t,e){var i=this;this.container=t,this.observers=[],this.lastX=0,this.lastY=0;var o=!1,n=function(){o||(o=!0,requestAnimationFrame(function(){for(var t=i.observers,e=i.getState(),n=t.length;n--;)t[n].check(e);i.lastX=e.positionX,i.lastY=e.positionY,o=!1}))},r=e.handleScrollResize,s=this.handler=r?r(n):n;addEventListener(\"scroll\",s,!0),addEventListener(\"resize\",s,!0),addEventListener(\"DOMContentLoaded\",function(){(i.mutationObserver=new MutationObserver(n)).observe(document,{attributes:!0,childList:!0,subtree:!0})})}function Observer(t){return this.offset=~~t.offset||0,this.container=t.container||document.body,this.once=Boolean(t.once),this.observerCollection=t.observerCollection||defaultObserverCollection,this.activate()}function ObserverCollection(t){for(var e=arguments.length,i=Array(e);e--;)i[e]=arguments[e];if(void 0===t&&(t={}),!(this instanceof ObserverCollection))return new(Function.prototype.bind.apply(ObserverCollection,[null].concat(i)));this.viewports=new Map,this.handleScrollResize=t.handleScrollResize}Viewport.prototype={getState:function(){var t,e,i,o,n=this.container,r=this.lastX,s=this.lastY;return n===document.body?(t=window.innerWidth,e=window.innerHeight,i=window.pageXOffset,o=window.pageYOffset):(t=n.offsetWidth,e=n.offsetHeight,i=n.scrollLeft,o=n.scrollTop),{width:t,height:e,positionX:i,positionY:o,directionX:r<i?\"right\":r>i?\"left\":\"none\",directionY:s<o?\"down\":s>o?\"up\":\"none\"}},destroy:function(){var t=this.handler,e=this.mutationObserver;removeEventListener(\"scroll\",t),removeEventListener(\"resize\",t),e&&e.disconnect()}},Observer.prototype={activate:function(){var t=this.container,e=this.observerCollection,i=e.viewports,o=i.get(t);o||(o=new Viewport(t,e),i.set(t,o));var n=o.observers;return n.indexOf(this)<0&&n.push(this),o},destroy:function(){var t=this.container,e=this.observerCollection.viewports,i=e.get(t);if(i){var o=i.observers,n=o.indexOf(this);n>-1&&o.splice(n,1),o.length||(i.destroy(),e.delete(t))}}};var defaultObserverCollection=new ObserverCollection;function PositionObserver(t){for(var e=arguments.length,i=Array(e);e--;)i[e]=arguments[e];if(void 0===t&&(t={}),!(this instanceof PositionObserver))return new(Function.prototype.bind.apply(PositionObserver,[null].concat(i)));this.onTop=t.onTop,this.onBottom=t.onBottom,this.onLeft=t.onLeft,this.onRight=t.onRight,this.onMaximized=t.onMaximized,this._wasTop=!0,this._wasBottom=!1,this._wasLeft=!0,this._wasRight=!1;var o=Observer.call(this,t);this.check(o.getState())}function ElementObserver(t,e){for(var i=arguments.length,o=Array(i);i--;)o[i]=arguments[i];if(void 0===e&&(e={}),!(this instanceof ElementObserver))return new(Function.prototype.bind.apply(ElementObserver,[null].concat(o)));this.element=t,this.onEnter=e.onEnter,this.onExit=e.onExit,this._didEnter=!1;var n=Observer.call(this,e);isElementInDOM(t)&&this.check(n.getState())}function isElementInViewport(t,e,i,o){var n,r,s,h,l=t.getBoundingClientRect();if(!l.width||!l.height)return!1;var a=window.innerWidth,c=window.innerHeight,v=a;if(o===document.body)n=c,r=0,s=v,h=0;else{if(!(l.top<c&&l.bottom>0&&l.left<v&&l.right>0))return!1;var d=o.getBoundingClientRect();n=d.bottom,r=d.top,s=d.right,h=d.left}return l.top<n+e&&l.bottom>r-e&&l.left<s+e&&l.right>h-e}function isElementInDOM(t){return t&&t.parentNode}PositionObserver.prototype=Object.create(Observer.prototype),PositionObserver.prototype.constructor=PositionObserver,PositionObserver.prototype.check=function(t){var e=this,i=e.onTop,o=e.onBottom,n=e.onLeft,r=e.onRight,s=e.onMaximized,h=e._wasTop,l=e._wasBottom,a=e._wasLeft,c=e._wasRight,v=e.container,d=e.offset,p=e.once,f=v.scrollHeight,b=v.scrollWidth,u=t.width,w=t.height,O=t.positionX,m=t.positionY,g=m-d<=0,y=f>w&&w+m+d>=f,E=O-d<=0,_=b>u&&u+O+d>=b,C=!1;o&&!l&&y?o.call(this,v,t):i&&!h&&g?i.call(this,v,t):r&&!c&&_?r.call(this,v,t):n&&!a&&E?n.call(this,v,t):s&&f===w?s.call(this,v,t):C=!0,p&&!C&&this.destroy(),this._wasTop=g,this._wasBottom=y,this._wasLeft=E,this._wasRight=_},ElementObserver.prototype=Object.create(Observer.prototype),ElementObserver.prototype.constructor=ElementObserver,ElementObserver.prototype.check=function(t){var e=this.container,i=this.onEnter,o=this.onExit,n=this.element,r=this.offset,s=this.once,h=this._didEnter;if(!isElementInDOM(n))return this.destroy();var l=isElementInViewport(n,r,t,e);!h&&l?(this._didEnter=!0,i&&(i.call(this,n,t),s&&this.destroy())):h&&!l&&(this._didEnter=!1,o&&(o.call(this,n,t),s&&this.destroy()))};export{PositionObserver,ElementObserver,ObserverCollection};\n//# sourceMappingURL=viewprt.esm.js.map\n","'use_strict'\n\nmodule.exports = (elem, treshold = {}) => {\n  treshold = Object.assign({ top: 0, right: 0, bottom: 0, left: 0} , treshold);\n\n  // Get the viewport dimensions\n  const vp = {\n    width: document.documentElement.clientWidth,\n    height: document.documentElement.clientHeight\n  };\n\n  // Get the viewport offset and size of the element.\n  // Normailze right and bottom to show offset from their\n  // respective edges istead of the top-left edges.\n  const box = elem.getBoundingClientRect();\n  const { top, left, width, height } = box;\n  const right = vp.width - box.right;\n  const bottom = vp.height - box.bottom;\n\n  // Calculate which sides of the element are cut-off\n  // by the viewport.\n  const cutOff = {\n    top: top < treshold.top,\n    left: left < treshold.left,\n    bottom: bottom < treshold.bottom,\n    right: right < treshold.right\n  };\n\n  // Calculate which sides of the element are partially shown\n  const partial = {\n    top: cutOff.top && top > -height + treshold.top,\n    left: cutOff.left && left > -width + treshold.left,\n    bottom: cutOff.bottom && bottom > -height + treshold.bottom,\n    right: cutOff.right && right > -width + treshold.right\n  };\n\n  const isFullyVisible = top >= treshold.top\n                      && right >= treshold.right\n                      && bottom >= treshold.bottom\n                      && left >= treshold.left;\n\n  const isPartiallyVisible = partial.top\n                          || partial.right\n                          || partial.bottom\n                          || partial.left;\n\n  // var eTop = elem.offsetTop;\n  // var eBottom = eTop + elem.offsetHeight;\n  // var wTop = elem.offsetParent.scrollTop;\n  // var wBottom = wTop + elem.offsetHeight;\n  // var totalH = Math.max(eBottom, wBottom) - Math.min(eTop, wTop);\n  // var wComp = totalH - elem.offsetHeight;\n  // var eIn = elem.offsetHeight - wComp;\n  // const percentage = (eIn <= 0 ? 0 : eIn / elem.offsetHeight * 100);\n\n  // var offsetParent = elem.offsetParent;\n  // var viewportHeight = offsetParent.offsetHeight;\n  // var scrollTop = offsetParent.scrollTop;\n  // var elemOffsetTop = elem.offsetTop;\n  // var elemHeight = elem.offsetHeight;\n\n  // var distance = ( scrollTop + viewportHeight ) - elemOffsetTop;\n  // var percentage = distance / ((viewportHeight + elemHeight ) / 100);\n  // percentage = Math.round(percentage);\n\n         // var elH = $(el).outerHeight(),\n         //     H = $(win).height(),\n         //     r = el.getBoundingClientRect(), t=r.top, b=r.bottom;\n\n  var elH = elem.offsetHeight;\n  var H = elem.offsetParent.offsetHeight;\n  var percentage = Math.max(0, top>0? Math.min(elH, H-top) : (box.bottom<H?box.bottom:H));\n\n  // Calculate which edge of the element are visible.\n  // Every edge can have three states:\n  // - 'fully':     The edge is completely visible.\n  // - 'partially': Some part of the edge can be seen.\n  // - false:       The edge is not visible at all.\n  const edges = {\n    top: !isFullyVisible && !isPartiallyVisible ? false :\n      ((!cutOff.top && !cutOff.left && !cutOff.right) && 'fully')\n      || (!cutOff.top && 'partially')\n      || false,\n    right: !isFullyVisible && !isPartiallyVisible ? false :\n        ((!cutOff.right && !cutOff.top && !cutOff.bottom) && 'fully')\n        || (!cutOff.right && 'partially')\n        || false,\n    bottom: !isFullyVisible && !isPartiallyVisible ? false :\n         ((!cutOff.bottom && !cutOff.left && !cutOff.right) && 'fully')\n         || (!cutOff.bottom && 'partially')\n         || false,\n    left: !isFullyVisible && !isPartiallyVisible ? false :\n       ((!cutOff.left && !cutOff.top && !cutOff.bottom) && 'fully')\n       || (!cutOff.left && 'partially')\n       || false,\n    percentage: percentage\n  };\n\n  return {\n    fully: isFullyVisible,\n    partially: isPartiallyVisible,\n    edges\n  };\n}\n","import EventEmitter from \"event-emitter\";\n\nimport {\n  ElementObserver,\n  PositionObserver,\n  ObserverCollection // Advanced: Used for grouping custom viewport handling\n} from \"viewprt\";\n\nimport inVp from \"in-vp\";\n\nclass Views {\n    constructor(container) {\n        this.container = container;\n        this._views = [];\n        this.length = 0;\n        this.hidden = false;\n    }\n\n    all() {\n        return this._views;\n    }\n\n    first() {\n        // return this._views[0];\n        return this.displayed()[0];\n    }\n\n    last() {\n        var d = this.displayed();\n        return d[d.length - 1];\n        // return this._views[this._views.length-1];\n    }\n\n    indexOf(view) {\n        return this._views.indexOf(view);\n    }\n\n    slice() {\n        return this._views.slice.apply(this._views, arguments);\n    }\n\n    get(i) {\n        return this._views[i];\n    }\n\n    append(view){\n        this._views.push(view);\n        if(this.container){\n        this.container.appendChild(view.element);\n            view.observer = ElementObserver(view.element, {\n                container: this.container,\n                onEnter: this.onEnter.bind(this, view), // callback when the element enters the viewport\n                onExit: this.onExit.bind(this, view), // callback when the element exits the viewport\n                offset: 0, // offset from the edges of the viewport in pixels\n                once: false, // if true, observer is detroyed after first callback is triggered\n                observerCollection: new ObserverCollection() // Advanced: Used for grouping custom viewport handling\n            })\n            const { fully, partially, edges } = inVp(view.element);\n            if ( edges.percentage > 0 ) {\n                this.onEnter(view);\n            }\n        }\n        this.length++;\n        return view;\n    }\n\n    prepend(view){\n        this._views.unshift(view);\n        if(this.container){\n            this.container.insertBefore(view.element, this.container.firstChild);\n        }\n        this.length++;\n        return view;\n    }\n\n    // insert(view, index) {\n    //     this._views.splice(index, 0, view);\n\n    //     if(this.container){\n    //         if(index < this.container.children.length){\n    //             this.container.insertBefore(view.element, this.container.children[index]);\n    //         } else {\n    //             this.container.appendChild(view.element);\n    //         }\n    //     }\n\n    //     this.length++;\n    //     return view;\n    // }\n\n    // remove(view) {\n    //     var index = this._views.indexOf(view);\n\n    //     if(index > -1) {\n    //         this._views.splice(index, 1);\n    //     }\n\n\n    //     this.destroy(view);\n\n    //     this.length--;\n    // }\n\n    destroy(view) {\n        // if(view.displayed){\n        //     view.destroy();\n        // }\n        view.destroy();\n\n        if(this.container){\n             this.container.removeChild(view.element);\n        }\n        view = null;\n    }\n\n    // Iterators\n\n    forEach() {\n        // return this._views.forEach.apply(this._views, arguments);\n        return this.displayed().forEach.apply(this._views, arguments);\n    }\n\n    clear(){\n        // Remove all views\n        var view;\n        var len = this.length;\n\n        if(!this.length) return;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            this.destroy(view);\n        }\n\n        this._views = [];\n        this.length = 0;\n    }\n\n    updateLayout(options) {\n        var width = options.width;\n        var height = options.height;\n        this._views.forEach(function(view) {\n            view.size(width, height);\n            if ( view.contents ) {\n                view.contents.size(width, height);\n            }\n        })\n    }\n\n    find(section){\n\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            // view.displayed\n            if(view.section.index == section.index) {\n                return view;\n            }\n        }\n\n    }\n\n    displayed(){\n        var displayed = [];\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            const { fully, partially, edges } = inVp(view.element);\n            if ( ( fully || partially ) && view.displayed ) {\n                displayed.push(view);\n            }\n            // if(view.displayed){\n            //     displayed.push(view);\n            // }\n        }\n        return displayed;\n    }\n\n    show(){\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            if(view.displayed){\n                view.show();\n            }\n        }\n        this.hidden = false;\n    }\n\n    hide(){\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            if(view.displayed){\n                view.hide();\n            }\n        }\n        this.hidden = true;\n    }\n\n    onEnter(view, el, viewportState) {\n        console.log(\"AHOY VIEWS ONENTER\", view, viewportState);\n        if ( ! view.displayed ) {\n            console.log(\"AHOY SHOULD BE SHOWING\", view);\n            this.emit(\"view.display\", { view: view, viewportState: viewportState });\n        }\n    }\n\n    onExit(view, el, viewportState) {\n        console.log(\"AHOY VIEWS ONEXIT\", view, viewportState);\n        view.unload();\n    }\n}\n\nEventEmitter(Views.prototype);\nexport default Views;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber, requestAnimationFrame} from \"epubjs/src/utils/core\";\nimport Mapping from \"epubjs/src/mapping\";\nimport Queue from \"epubjs/src/utils/queue\";\nimport Stage from \"epubjs/src/managers/helpers/stage\";\nimport Views from \"../helpers/scrolling_views\";\nimport { EVENTS } from \"epubjs/src/utils/constants\";\n\nimport {\n  ElementObserver,\n  PositionObserver,\n  ObserverCollection // Advanced: Used for grouping custom viewport handling\n} from \"viewprt\";\n\nimport inVp from \"in-vp\";\n\nclass ScrollingContinuousViewManager {\n  constructor(options) {\n\n    this.name = \"default\";\n    this.optsSettings = options.settings;\n    this.View = options.view;\n    this.request = options.request;\n    this.renditionQueue = options.queue;\n    this.q = new Queue(this);\n\n    this.settings = extend(this.settings || {}, {\n      infinite: true,\n      hidden: false,\n      width: undefined,\n      height: undefined,\n      axis: undefined,\n      flow: \"scrolled\",\n      ignoreClass: \"\",\n      fullsize: undefined\n    });\n\n    extend(this.settings, options.settings || {});\n\n    this.viewSettings = {\n      ignoreClass: this.settings.ignoreClass,\n      axis: this.settings.axis,\n      flow: this.settings.flow,\n      layout: this.layout,\n      method: this.settings.method, // srcdoc, blobUrl, write\n      width: 0,\n      height: 0,\n      forceEvenPages: true\n    };\n\n    this.rendered = false;\n\n  }\n\n  render(element, size){\n    let tag = element.tagName;\n\n    if (typeof this.settings.fullsize === \"undefined\" &&\n        tag && (tag.toLowerCase() == \"body\" ||\n        tag.toLowerCase() == \"html\")) {\n        this.settings.fullsize = true;\n    }\n\n    if (this.settings.fullsize) {\n      this.settings.overflow = \"visible\";\n      this.overflow = this.settings.overflow;\n    }\n\n    this.settings.size = size;\n\n    // Save the stage\n    this.stage = new Stage({\n      width: size.width,\n      height: size.height,\n      overflow: this.overflow,\n      hidden: this.settings.hidden,\n      axis: this.settings.axis,\n      fullsize: this.settings.fullsize,\n      direction: this.settings.direction,\n      scale: this.settings.scale\n    });\n\n    this.stage.attachTo(element);\n\n    // Get this stage container div\n    this.container = this.stage.getContainer();\n\n    // Views array methods\n    this.views = new Views(this.container);\n\n    // Calculate Stage Size\n    this._bounds = this.bounds();\n    this._stageSize = this.stage.size();\n\n    // Set the dimensions for views\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n\n    // Function to handle a resize event.\n    // Will only attach if width and height are both fixed.\n    this.stage.onResize(this.onResized.bind(this));\n\n    this.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n    // Add Event Listeners\n    this.addEventListeners();\n\n    // Add Layout method\n    // this.applyLayoutMethod();\n    if (this.layout) {\n      this.updateLayout();\n    }\n\n    this.rendered = true;\n    this._spine = [];\n\n    this.views.on(\"view.display\", function({ view, viewportState }) {\n      console.log(\"AHOY VIEW DISPLAY REDUX\", view, viewportState);\n      var old_h = view.element.offsetHeight;\n      var scroll_y = this.container.scrollTop;\n      view.display(this.request).then(function() {\n        view.show();\n        var new_h = view.element.offsetHeight;\n        if ( viewportState && viewportState.directionY == 'up' && ! view.resized ) {\n          var delta = new_h - old_h;\n          console.log(\"AHOY VIEW DISPLAY ADJUST\", this.container.scrollTop, old_h, new_h, delta);\n          this.container.scrollTop += delta;\n        }\n        view.resized = true;\n\n        this.gotoTarget(view);\n\n      }.bind(this));\n    }.bind(this));\n\n    // we cannot do anything about the displays because we don't have\n    // any data\n  }\n\n  display(section, target) {\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    if ( ! this.views.length ) {\n      this.initializeViews(section);\n    }\n\n    // Check if moving to target is needed\n    if (target === section.href || isNumber(target)) {\n      target = undefined;\n    }\n\n    var current = this.current();\n\n    this.ignore = false;\n    var visible = this.views.find(section);\n\n    console.log(\"AHOY scrolling display\", section, visible, current, current == visible);\n\n    if(target) {\n      this._target = [ visible, target ];\n    }\n\n    visible.element.scrollIntoView();\n\n    if ( visible == current ) {\n      this.gotoTarget(visible);\n    }\n\n    displaying.resolve();\n    return displayed;\n  }\n\n  gotoTarget(view) {\n    if ( this._target && this._target[0] == view ) {\n      let offset = view.locationOf(this._target[1]);\n\n      // -- this does not work; top varies.\n      // offset.top += view.element.getBoundingClientRect().top;\n\n      var prev; var style;\n      for(var i = 0; i < view.index; i++) {\n        prev = this.views.get(i);\n        style = window.getComputedStyle(prev.element);\n        offset.top += parseInt(style.height) + parseInt(style.marginBottom) + parseInt(style.marginTop);\n        // offset.top += prev.height() || prev.element.offsetHeight;\n      }\n      this.moveTo(offset);\n      this._target = null;\n    }\n  }\n\n  afterDisplayed(view){\n    // if ( this._target && this._target[0] == view ) {\n    //   let offset = view.locationOf(this._target[1]);\n    //   this.moveTo(offset);\n    //   this._target = null;\n    // }\n    this.emit(EVENTS.MANAGERS.ADDED, view);\n  }\n\n  afterResized(view){\n    this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n  }\n\n  moveTo(offset) {\n    var distX = 0, distY = 0;\n    distY = offset.top;\n    // this.scrollTo(distX, this.container.scrollTop + distY, true);\n    this.scrollTo(distX, distY, false);\n  }\n\n  initializeViews(section) {\n    var self = this;\n\n    this.ignore = true;\n\n    // if ( self._spine.length == 0 ) {\n    //   console.time(\"AHOY initializeViews CRAWL\");\n    //   // can we build a manifest here?\n    //   var prev_ = section.prev();\n    //   while ( prev_ ) {\n    //     // self._spine.unshift(prev_.href);\n    //     self._spine.unshift(prev_);\n    //     prev_ = prev_.prev();\n    //   }\n\n    //   self._spine.push(section);\n\n    //   var next_ = section.next();\n    //   while ( next_ ) {\n    //     // self._spine.push(next_.href);\n    //     self._spine.push(next_);\n    //     next_ = next_.next();\n    //   }\n\n    //   console.timeEnd(\"AHOY initializeViews CRAWL\");\n    // }\n\n    // this._spine.forEach(function (section) {\n    this.settings.spine.each(function (section) {\n      var view = new this.View(section, this.viewSettings);\n      view.onDisplayed = this.afterDisplayed.bind(this);\n      view.onResize = this.afterResized.bind(this);\n      view.on(EVENTS.VIEWS.AXIS, (axis) => {\n        this.updateAxis(axis);\n      });\n      this.views.append(view);\n    }.bind(this));\n\n    this.ignore = false;\n  }\n\n  direction(dir=\"ltr\") {\n    this.settings.direction = dir;\n\n    this.stage && this.stage.direction(dir);\n\n    this.viewSettings.direction = dir;\n\n    this.updateLayout();\n  }\n\n  onOrientationChange(e) {\n\n  }\n\n  onResized(e) {\n    // if ( this.resizeTimeout ) {\n    //   clearTimeout(this.resizeTimeout);\n    // } else {\n    //   // this._current = this.current() && this.current().section;\n    //   // this._current = { view: this.current(), location: this.currentLocation() };\n    // }\n    // this.resizeTimeout = setTimeout(this.resize.bind(this), 100);\n    this.resize();\n  }\n\n  resize(width, height){\n    let stageSize = this.stage.size(width, height);\n    if ( this.resizeTimeout ) {\n      clearTimeout(this.resizeTimeout);\n      this.resizeTimeout = null;\n    }\n\n    this.ignore = true;\n\n    // For Safari, wait for orientation to catch up\n    // if the window is a square\n    this.winBounds = windowBounds();\n    if (this.orientationTimeout &&\n        this.winBounds.width === this.winBounds.height) {\n      // reset the stage size for next resize\n      this._stageSize = undefined;\n      return;\n    }\n\n    if (this._stageSize &&\n        this._stageSize.width === stageSize.width &&\n        this._stageSize.height === stageSize.height ) {\n      // Size is the same, no need to resize\n      return;\n    }\n\n    this._stageSize = stageSize;\n\n    this._bounds = this.bounds();\n\n    // if ( ! this._resizeTarget ) {\n    //   var current = this.current();\n    //   if ( current ) {\n    //     this._resizeTarget = current.section;\n    //   }\n    // }\n\n    this.clear();\n\n    // Update for new views\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n\n    this.updateLayout();\n\n    // var section; var target;\n    // if ( this._current ) {\n    //   section = this._current.view.section;\n    //   target = this._current.location[0].mapping.start;\n    //   this._current = null;\n    // } else {\n    //   section = this._spine[0];\n    // }\n    // this.initializeViews(section);\n    // this.display(section, target);\n\n    // this.views.updateLayout(this.viewSettings);\n\n    this.emit(EVENTS.MANAGERS.RESIZED, {\n      width: this._stageSize.width,\n      height: this._stageSize.height\n    });\n  }\n\n  updateAxis(axis, forceUpdate) {\n    if (!this.isPaginated) {\n      axis = \"vertical\";\n    }\n\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n\n    this.settings.axis = axis;\n\n    this.stage && this.stage.axis(axis);\n\n    this.viewSettings.axis = axis;\n\n    if (this.mapping) {\n      this.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n    }\n\n    if (this.layout) {\n      this.layout.spread(\"none\");\n    }\n\n  }\n\n  updateFlow(flow) {\n    this.isPaginated = false;\n    this.updateAxis(\"vertical\");\n\n    this.viewSettings.flow = flow;\n\n    if (!this.settings.overflow) {\n      this.overflow = this.isPaginated ? \"hidden\" : \"auto\";\n    } else {\n      this.overflow = this.settings.overflow;\n    }\n\n    this.stage && this.stage.overflow(this.overflow);\n\n    this.updateLayout();\n  }\n\n  getContents() {\n    return [];\n  }\n\n  current(){\n    var visible = this.visible();\n    var view;\n    if(visible.length){\n      // Current is the last visible view\n      var current = null;\n      for(var i = 0; i < visible.length; i++) {\n        view = visible[i];\n        const { fully, partially, edges } = inVp(view.element);\n        if ( ! current ) { current = view; current.percentage = edges.percentage; }\n        else if ( edges.percentage > current.percentage ) {\n          current = view;\n          current.percentage = edges.percentage;\n        }\n      }\n      if ( current ) { return current; }\n      return visible[visible.length-1];\n    }\n    return null;\n  }\n\n  visible() {\n    var visible = [];\n    var views = this.views.displayed();\n    var viewsLength = views.length;\n    var visible = [];\n    var isVisible;\n    var view;\n\n    return this.views.displayed();\n\n    for(var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      // const { fully, partially, edges } = inVp(view.element);\n      // if ( fully && view.displayed ) { visible.push(view); }\n      if ( view.displayed ) {\n        visible.push(view);\n      }\n    }\n\n    return visible;\n  }\n\n  scrollBy(x, y, silent){\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n    if(silent) {\n      this.ignore = true;\n    }\n\n    if(!this.settings.fullsize) {\n      if(x) this.container.scrollLeft += x * dir;\n      if(y) this.container.scrollTop += y;\n    } else {\n      window.scrollBy(x * dir, y * dir);\n    }\n    this.scrolled = true;\n  }\n\n  scrollTo(x, y, silent) {\n    if(silent) {\n      this.ignore = true;\n    }\n\n    if(!this.settings.fullsize) {\n      this.container.scrollLeft = x;\n      this.container.scrollTop = y;\n    } else {\n      window.scrollTo(x,y);\n    }\n    this.scrolled = true;\n  }\n\n  onScroll() {\n    let scrollTop;\n    let scrollLeft;\n\n    if(!this.settings.fullsize) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY;\n      scrollLeft = window.scrollX;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if(!this.ignore) {\n      this.emit(EVENTS.MANAGERS.SCROLL, {\n        top: scrollTop,\n        left: scrollLeft\n      });\n\n      clearTimeout(this.afterScrolled);\n      this.afterScrolled = setTimeout(function () {\n        this.emit(EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 20);\n\n    } else {\n      this.ignore = false;\n    }\n  }\n\n  bounds() {\n    var bounds;\n\n    bounds = this.stage.bounds();\n\n    return bounds;\n  }\n\n  applyLayout(layout) {\n    this.layout = layout;\n    this.updateLayout();\n  }\n\n  updateLayout() {\n    if (!this.stage) {\n      return;\n    }\n\n    this._stageSize = this.stage.size();\n    this.layout.calculate(this._stageSize.width, this._stageSize.height);\n    // this.layout.width = this.container.offsetWidth * 0.80;\n\n    // Set the dimensions for views\n    this.viewSettings.width = this.layout.width;\n    this.viewSettings.height = this.layout.height;\n    this.viewSettings.minHeight = this.viewSettings.height;\n\n    this.setLayout(this.layout);\n  }\n\n  setLayout(layout){\n\n    this.viewSettings.layout = layout;\n\n    this.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n    if(this.views) {\n\n      this.views._views.forEach(function(view) {\n        view.size(layout.width, layout.height);\n        view.reframe(layout.width, layout.height);\n        view.setLayout(layout);\n      })\n\n      // this.views.forEach(function(view){\n      //   if (view) {\n      //     view.reframe(layout.width, layout.height);\n      //     view.setLayout(layout);\n      //   }\n      // });\n\n    }\n\n  }\n\n  addEventListeners() {\n    var scroller;\n\n    window.addEventListener(\"unload\", function(e){\n      this.destroy();\n    }.bind(this));\n\n    if(!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    this._onScroll = this.onScroll.bind(this);\n    scroller.addEventListener(\"scroll\", this._onScroll);\n  }\n\n  removeEventListeners(){\n    var scroller;\n\n    if(!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this._onScroll);\n    this._onScroll = undefined;\n  }\n\n  destroy(){\n    clearTimeout(this.orientationTimeout);\n    clearTimeout(this.resizeTimeout);\n    clearTimeout(this.afterScrolled);\n\n    this.clear();\n\n    this.removeEventListeners();\n\n    this.stage.destroy();\n\n    this.rendered = false;\n\n    /*\n\n      clearTimeout(this.trimTimeout);\n      if(this.settings.hidden) {\n        this.element.removeChild(this.wrapper);\n      } else {\n        this.element.removeChild(this.container);\n      }\n    */\n  }\n\n  next() {\n    var next;\n    var left;\n\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    let dir = this.settings.direction;\n\n    if(!this.views.length) return;\n\n    this.scrollTop = this.container.scrollTop;\n\n    let top  = this.container.scrollTop + this.container.offsetHeight;\n\n    this.scrollBy(0, this.layout.height, false);\n\n    this.q.enqueue(function() {\n      displaying.resolve();\n      return displayed;\n    })\n  }\n\n  prev() {\n    var next;\n    var left;\n\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    let dir = this.settings.direction;\n\n    if(!this.views.length) return;\n\n    this.scrollTop = this.container.scrollTop;\n\n    let top  = this.container.scrollTop - this.container.offsetHeight;\n    this.scrollBy(0, -this.layout.height, false);\n\n    this.q.enqueue(function() {\n      displaying.resolve();\n      return displayed;\n    })\n  }\n\n  clear () {\n\n    // // this.q.clear();\n\n    if (this.views) {\n      this.views.hide();\n      this.scrollTo(0,0, true);\n      this.views.clear();\n    }\n  }\n\n  currentLocation() {\n    let visible = this.visible();\n    let container = this.container.getBoundingClientRect();\n    let pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\n    let offset = 0;\n    let used = 0;\n\n    if(this.settings.fullsize) {\n      offset = window.scrollY;\n    }\n\n    let sections = visible.map((view) => {\n      let {index, href} = view.section;\n      let position = view.position();\n      let height = view.height();\n\n      let startPos = offset + container.top - position.top + used;\n      let endPos = startPos + pageHeight - used;\n      if (endPos > height) {\n        endPos = height;\n        used = (endPos - startPos);\n      }\n\n      let totalPages = this.layout.count(height, pageHeight).pages;\n\n      let currPage = Math.ceil(startPos / pageHeight);\n      let pages = [];\n      let endPage = Math.ceil(endPos / pageHeight);\n\n      pages = [];\n      for (var i = currPage; i <= endPage; i++) {\n        let pg = i + 1;\n        pages.push(pg);\n      }\n\n      let mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n      return {\n        index,\n        href,\n        pages,\n        totalPages,\n        mapping\n      };\n    });\n\n    return sections;\n  }\n\n  isRendered() {\n    return this.rendered;\n  }\n\n\n}\n\nScrollingContinuousViewManager.toString = function() { return 'continuous'; }\n\n//-- Enable binding events to Manager\nEventEmitter(ScrollingContinuousViewManager.prototype);\n\nexport default ScrollingContinuousViewManager;\n\n","import IframeView from \"epubjs/src/managers/views/iframe\";\nimport { EVENTS } from \"epubjs/src/utils/constants\";\n\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"epubjs/src/utils/core\";\n\nimport {\n  ElementObserver,\n  PositionObserver,\n  ObserverCollection // Advanced: Used for grouping custom viewport handling\n} from \"viewprt\";\n\nimport inVp from \"in-vp\";\n\nclass StickyIframeView extends IframeView {\n    constructor(section, options) {\n        super(section, options);\n\n        this.element.style.height = `${this.layout.height}px`;\n        this.element.style.width = `${this.layout.width}px`;\n    }\n\n    container(axis) {\n        var check = document.querySelector(`div[ref='${this.index}']`);\n        if ( check ) {\n            check.dataset.reused = 'true';\n            return check;\n        }\n\n        var element = document.createElement(\"div\");\n\n        element.classList.add(\"epub-view\");\n\n        // this.element.style.minHeight = \"100px\";\n        element.style.height = \"0px\";\n        element.style.width = \"0px\";\n        element.style.overflow = \"hidden\";\n        element.style.position = \"relative\";\n        element.style.display = \"block\";\n\n        if(axis && axis == \"horizontal\"){\n            element.style.flex = \"none\";\n        } else {\n            element.style.flex = \"initial\";\n        }\n\n        return element;\n    }\n\n    create() {\n\n        if(this.iframe) {\n            return this.iframe;\n        }\n\n        if(!this.element) {\n            this.element = this.createContainer();\n        }\n\n        if ( this.element.hasAttribute('layout-height') ) {\n            var height = parseInt(this.element.getAttribute('layout-height'), 10);\n            this._layout_height = height;\n        }\n\n        this.iframe = this.element.querySelector(\"iframe\");\n        if ( this.iframe ) {\n            return this.iframe;\n        }\n\n        this.iframe = document.createElement(\"iframe\");\n        this.iframe.id = this.id;\n        this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n        this.iframe.style.overflow = \"hidden\";\n        this.iframe.seamless = \"seamless\";\n        // Back up if seamless isn't supported\n        this.iframe.style.border = \"none\";\n\n        this.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n        this.resizing = true;\n\n        // this.iframe.style.display = \"none\";\n        this.element.style.visibility = \"hidden\";\n        this.iframe.style.visibility = \"hidden\";\n\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n\n        this.element.setAttribute(\"ref\", this.index);\n        this.element.setAttribute(\"data-href\", this.section.href);\n\n        // this.element.appendChild(this.iframe);\n        this.added = true;\n\n        this.elementBounds = bounds(this.element);\n\n        // if(width || height){\n        //   this.resize(width, height);\n        // } else if(this.width && this.height){\n        //   this.resize(this.width, this.height);\n        // } else {\n        //   this.iframeBounds = bounds(this.iframe);\n        // }\n\n\n        if((\"srcdoc\" in this.iframe)) {\n            this.supportsSrcdoc = true;\n        } else {\n            this.supportsSrcdoc = false;\n        }\n\n        if (!this.settings.method) {\n            this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n        }\n\n        return this.iframe;\n    }\n\n    reframe(width, height) {\n        var size;\n\n        var minHeight = this.settings.minHeight || 0;\n\n        if(isNumber(width)){\n            this.element.style.width = width + \"px\";\n            if ( this.iframe ) {\n                this.iframe.style.width = width + \"px\";\n            }\n            this._width = width;\n        }\n\n        // this.element.style.width = '80%';\n        // this.iframe.style.width = '100%';\n\n        if(isNumber(height)){\n            height = height > minHeight ? height : minHeight;\n            this.element.style.height = ( height + 80 ) + \"px\";\n            if ( this.iframe ) {\n                this.iframe.style.height = height + \"px\";\n            }\n            console.log(\"AHOY REFRAME\", this.index, this.element.style.height, this.iframe && this.iframe.style.height);\n            this._height = height;\n        }\n\n        let widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n        let heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n        size = {\n            width: width,\n            height: height,\n            widthDelta: widthDelta,\n            heightDelta: heightDelta,\n        };\n\n        this.pane && this.pane.render();\n\n        requestAnimationFrame(() => {\n            let mark;\n            for (let m in this.marks) {\n                if (this.marks.hasOwnProperty(m)) {\n                    mark = this.marks[m];\n                    this.placeMark(mark.element, mark.range);\n                }\n            }\n        });\n\n        this.onResize(this, size);\n\n        this.emit(EVENTS.VIEWS.RESIZED, size);\n\n        this.prevBounds = size;\n\n        this.elementBounds = bounds(this.element);\n\n    }\n\n    display(request) {\n        var displayed = new defer();\n\n        if (!this.displayed) {\n\n            this.render(request)\n                .then(function () {\n\n                    this.emit(EVENTS.VIEWS.DISPLAYED, this);\n                    this.onDisplayed(this);\n\n                    this.displayed = true;\n                    displayed.resolve(this);\n\n                }.bind(this), function (err) {\n                    displayed.reject(err, this);\n                });\n\n        } else {\n            displayed.resolve(this);\n        }\n\n\n        return displayed.promise;\n    }\n\n    unload() {\n\n        for (let cfiRange in this.highlights) {\n            this.unhighlight(cfiRange);\n        }\n\n        for (let cfiRange in this.underlines) {\n            this.ununderline(cfiRange);\n        }\n\n        for (let cfiRange in this.marks) {\n            this.unmark(cfiRange);\n        }\n\n        if (this.pane) {\n            this.element.removeChild(this.pane.element);\n            this.pane = undefined;\n        }\n\n        if (this.blobUrl) {\n            revokeBlobUrl(this.blobUrl);\n        }\n\n        if(this.displayed){\n            this.displayed = false;\n\n            this.removeListeners();\n\n            this.stopExpanding = true;\n            this.element.removeChild(this.iframe);\n\n            this.iframe = undefined;\n            this.contents = undefined;\n\n            // this._textWidth = null;\n            // this._textHeight = null;\n            // this._width = null;\n            // this._height = null;\n        }\n\n        // this.element.style.height = \"0px\";\n        // this.element.style.width = \"0px\";\n    }\n\n}\n\nexport default StickyIframeView;\n\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport ePub from 'epubjs';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as Browser from '../core/Browser';\n\nimport path from \"path-webpack\";\n\nimport PrePaginatedContinuousViewManager from '../epubjs/managers/continuous/prepaginated';\nimport ReusableIframeView from '../epubjs/managers/views/iframe';\n\nimport ScrollingContinuousViewManager from '../epubjs/managers/continuous/scrolling';\nimport StickyIframeView from '../epubjs/managers/views/sticky';\n\nReader.EpubJS = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n    this._epubjs_ready = false;\n    window.xpath = path;\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    if ( typeof(target) == 'function' ) {\n      callback = target;\n      target = undefined;\n    }\n    if ( callback == null ) {\n      callback = function() { };\n    }\n\n    self.rootfiles = [];\n\n    this.options.rootfilePath = this.options.rootfilePath || sessionStorage.getItem('rootfilePath');\n\n    var book_href = this.options.href;\n    var book_options = { packagePath: this.options.rootfilePath };\n    if ( this.options.useArchive ) {\n      book_href = book_href.replace(/\\/(\\w+)\\/$/, '/$1/$1.sm.epub');\n      book_options.openAs = 'epub';\n    }\n    this._book = ePub(book_href, book_options);\n    sessionStorage.removeItem('rootfilePath');\n\n    this._book.loaded.navigation.then(function(toc) {\n      self._contents = toc;\n      self.metadata = self._book.packaging.metadata;\n      self.fire('updateContents', toc);\n      self.fire('updateTitle', self._book.packaging.metadata);\n    })\n    this._book.ready.then(function() {\n      self.parseRootfiles();\n\n      self.draw(target, callback);\n\n      if ( self.metadata.layout == 'pre-paginated' ) {\n        // fake it with the spine\n        var locations = [];\n        self._book.spine.each(function(item) {\n          locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n          self.locations._locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n        });\n        self.locations.total = locations.length;\n        var t;\n        var f = function() {\n          if ( self._rendition && self._rendition.manager && self._rendition.manager.stage ) {\n            var location = self._rendition.currentLocation();\n            if ( location && location.start) {\n              self.fire('updateLocations', locations);\n              clearTimeout(t);\n              return;\n            }\n          }\n          t = setTimeout(f, 100);\n        }\n\n        t = setTimeout(f, 100);\n      } else {\n        self._book.locations.generate(1600).then(function(locations) {\n          // console.log(\"AHOY WUT\", locations);\n          self.fire('updateLocations', locations);\n        })\n      }\n    })\n    // .then(callback);\n  },\n\n  parseRootfiles: function() {\n    var self = this;\n    self._book.load(self._book.url.resolve(\"META-INF/container.xml\")).then(function(containerDoc) {\n        var rootfiles = containerDoc.querySelectorAll(\"rootfile\");\n        if ( rootfiles.length > 1 ) {\n          for(var i = 0; i < rootfiles.length; i++) {\n            var rootfile = rootfiles[i];\n            var rootfilePath = rootfile.getAttribute('full-path');\n            var label = rootfile.getAttribute('rendition:label');\n            var layout = rootfile.getAttribute('rendition:layout');\n            self.rootfiles.push({\n              rootfilePath: rootfilePath,\n              label: label,\n              layout: layout\n            })\n          }\n        }\n    })\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n\n    if ( self._rendition ) {\n      // self._unbindEvents();\n      var container = self._rendition.manager.container;\n      Object.keys(self._rendition.hooks).forEach(function(key) {\n        self._rendition.hooks[key].clear();\n      })\n      self._rendition.destroy();\n      self._rendition = null;\n    }\n\n    this.settings = { flow: this.options.flow };\n    this.settings.manager = this.options.manager || 'default';\n\n    if ( this.settings.flow == 'auto' && this.metadata.layout == 'pre-paginated' ) {\n      // dumb check to see if the window is _tall_ enough to put\n      // two pages side by side\n      if ( this._container.offsetHeight <= this.options.forceScrolledDocHeight ) {\n        this.settings.flow = 'scrolled-doc';\n        this.settings.manager = PrePaginatedContinuousViewManager;\n        this.settings.view = ReusableIframeView;\n      }\n    }\n\n    if ( this.settings.flow == 'auto' || this.settings.flow == 'paginated' ) {\n      this._panes['epub'].style.overflow = this.metadata.layout == 'pre-paginated' ? 'auto' : 'hidden';\n      this.settings.manager = 'default';\n    } else {\n      this._panes['epub'].style.overflow = 'auto';\n      if ( this.settings.manager == 'default' ) {\n        // this.settings.manager = 'continuous';\n        this.settings.manager = ScrollingContinuousViewManager;\n        this.settings.view = StickyIframeView;\n        this.settings.width = '100%'; // 100%?\n        this.settings.spine = this._book.spine;\n      }\n    }\n\n    if ( ! callback ) {\n      callback = function() { };\n    }\n\n    self.settings.height = '100%';\n    self.settings.width = '100%';\n    self.settings['ignoreClass'] = 'annotator-hl';\n\n    if ( this.metadata.layout == 'pre-paginated' && this.settings.manager == 'continuous' ) {\n        // this.settings.manager = 'prepaginated';\n        this.settings.manager = PrePaginatedContinuousViewManager;\n        this.settings.view = ReusableIframeView;\n    }\n\n    if ( this.settings.manager == PrePaginatedContinuousViewManager ) {\n      this.settings.spread = 'none';\n    }\n\n    // would pre-paginated work better if we scaled the default view from the start? maybe?\n    if ( false && this.metadata.layout == 'pre-paginated' && this.settings.manager == 'default' ) {\n      this.settings.spread = 'none';\n      this._panes['epub'].style.overflow = 'auto';\n    }\n\n    if ( self.options.scale != '100' ) {\n      self.settings.scale = parseInt(self.options.scale, 10) / 100;\n    }\n\n    self._panes['book'].dataset.manager = this.settings.manager + ( this.settings.spread ? `-${this.settings.spread}` : '');\n    self._panes['book'].dataset.layout = this.metadata.layout || 'reflowable';\n\n    self._drawRendition(target, callback);\n  },\n\n  _drawRendition: function(target, callback) {\n    var self = this;\n\n    self._rendition = self._book.renderTo(self._panes['epub'], self.settings);\n    self._updateFontSize();\n    self._bindEvents();\n    self._drawn = true;\n\n    if ( target && target.start ) { target = target.start; }\n    if ( ! target && window.location.hash ) {\n      if ( window.location.hash.substr(1, 3) == '/6/' ) {\n        target = decodeURIComponent(window.location.hash.substr(1));\n        // if ( target.match(/\\]$/ ) ) {\n        //   // target += '/2';\n        //   target += '/1:0';\n        // }\n        target = \"epubcfi(\" + target + \")\";\n      } else {\n        target = window.location.hash.substr(2);\n        target = self._book.url.path().resolve(target);\n      }\n    }\n\n    var status_index = 0;\n    self._rendition.on('started', function() {\n      self._manager = self._rendition.manager;\n\n      self._rendition.manager.on(\"building\", function(status) {\n        if ( status ) {\n          status_index += 1;\n          self._panes['loader-status'].innerHTML = `<span>${Math.round((status_index / status.total) * 100.0)}%</span>`;\n        } else {\n          self._enableBookLoader(-1);\n        }\n      })\n      self._rendition.manager.on(\"built\", function() {\n        self._disableBookLoader(true);\n      })\n    })\n\n    self._rendition.hooks.content.register(function(contents) {\n      self.fire('ready:contents', contents);\n      self.fire('readyContents', contents);\n      contents.document.addEventListener('keydown', (event) => {\n        const keyName = event.key;\n        self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey, inner: true });\n      });\n    })\n\n    self.gotoPage(target, function() {\n      window._loaded = true;\n      self._initializeReaderStyles();\n\n      if ( callback ) { callback(); }\n\n      self._epubjs_ready = true;\n\n      self.gotoPage(target, function() {\n        setTimeout(function() {\n          self.fire('opened');\n          self.fire('ready');\n          self._disableBookLoader();\n          clearTimeout(self._queueTimeout);\n          self.tracking.event(\"openBook\", {\n            rootFilePath: self.options.rootFilePath,\n            flow: self.settings.flow,\n            manager: self.settings.manager\n          });\n        }, 100);\n      })\n\n    })\n  },\n\n  _scroll: function(delta) {\n    var self = this;\n    if ( self.options.flow == 'XXscrolled-doc' ) {\n      var container = self._rendition.manager.container;\n      var rect = container.getBoundingClientRect();\n      var scrollTop = container.scrollTop;\n      var newScrollTop = scrollTop;\n      var scrollBy = ( rect.height * 0.98 );\n      switch(delta) {\n        case 'PREV':\n          newScrollTop = -( scrollTop + scrollBy );\n          break;\n        case 'NEXT':\n          newScrollTop = ( scrollTop + scrollBy );\n          break;\n        case 'HOME':\n          newScrollTop = 0;\n          break;\n        case 'END':\n          newScrollTop = container.scrollHeight - scrollBy;\n          break;\n      }\n      container.scrollTop = newScrollTop;\n      return ( Math.floor(container.scrollTop) != Math.floor(scrollTop) );\n    }\n    return false;\n  },\n\n  _navigate: function(promise, callback) {\n    var self = this;\n    self._enableBookLoader(100);\n    promise.then(function() {\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n    }).catch(function(e) {\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n      console.log(\"AHOY NAVIGATE ERROR\", e);\n      throw(e);\n    })\n  },\n\n  next: function() {\n    var self = this;\n    this.tracking.action('reader/go/next');\n    self._scroll('NEXT') || self._navigate(this._rendition.next());\n  },\n\n  prev: function() {\n    this.tracking.action('reader/go/previous');\n    this._scroll('PREV') || this._navigate(this._rendition.prev());\n  },\n\n  first: function() {\n    this.tracking.action('reader/go/first');\n    this._navigate(this._rendition.display(0), undefined);\n  },\n\n  last: function() {\n    var self = this;\n    this.tracking.action('reader/go/last');\n    var target = this._book.spine.length - 1;\n    this._navigate(this._rendition.display(target), undefined);\n  },\n\n  gotoPage: function(target, callback) {\n    var hash;\n    if ( target != null ) {\n      var section = this._book.spine.get(target);\n      if ( ! section) {\n        // maybe it needs to be resolved\n        var guessed = target;\n        if ( guessed.indexOf(\"://\") < 0 ) {\n          var path1 = path.resolve(this._book.path.directory, this._book.packaging.navPath);\n          var path2 = path.resolve(path.dirname(path1), target);\n          guessed = this._book.canonical(path2);\n        }\n        if ( guessed.indexOf(\"#\") !== 0 ) {\n          hash = guessed.split('#')[1];\n          guessed = guessed.split('#')[0];\n        }\n\n        this._book.spine.each(function(item) {\n          if ( item.canonical == guessed ) {\n            section = item;\n            target = section.href;\n            return;\n          }\n        })\n\n        if ( hash ) {\n          target = target + '#' + hash;\n        }\n\n        // console.log(\"AHOY GUESSED\", target);\n      } else if ( target.toString().match(/^\\d+$/) ) {\n        // console.log(\"AHOY USING\", section.href);\n        target = section.href;\n      }\n\n      if ( ! section ) {\n        if ( ! this._epubjs_ready ) {\n          target = 0;\n        } else {\n          return;\n        }\n      }\n    }\n\n    // this.__hash = hash;\n    var navigating = this._rendition.display(target).then(function() {\n      this._rendition.display(target);\n    }.bind(this));\n    this._navigate(navigating, callback);\n  },\n\n  percentageFromCfi: function(cfi) {\n    return this._book.percentageFromCfi(cfi);\n  },\n\n  destroy: function() {\n    if ( this._rendition ) {\n      try {\n        this._rendition.destroy();\n      } catch(e) {}\n    }\n    this._rendition = null;\n    this._drawn = false;\n  },\n\n  reopen: function(options, target) {\n    // different per reader?\n    var target = target || this.currentLocation();\n    if( target.start ) { target = target.start ; }\n    if ( target.cfi ) { target = target.cfi ; }\n\n    var doUpdate = false;\n    if ( options === true ) { doUpdate = true; options = {}; }\n    var changed = {};\n    Object.keys(options).forEach(function(key) {\n      if ( options[key] != this.options[key] ) {\n        doUpdate = true;\n        changed[key] = true;\n      }\n      // doUpdate = doUpdate || ( options[key] != this.options[key] );\n    }.bind(this));\n\n    if ( ! doUpdate ) {\n      return;\n    }\n\n    // performance hack\n    if ( Object.keys(changed).length == 1 && changed.scale ) {\n      reader.options.scale = options.scale;\n      this._updateScale();\n      return;\n    }\n\n    if ( options.rootfilePath && options.rootfilePath != this.options.rootfilePath ) {\n      // we need to REOPEN THE DANG BOOK\n      sessionStorage.setItem('rootfilePath', options.rootfilePath);\n      location.reload();\n      return;\n    }\n\n    Util.extend(this.options, options);\n\n    this.draw(target, function() {\n      this._updateFontSize();\n      this._updateScale();\n      this._updateTheme();\n      this._selectTheme(true);\n    }.bind(this))\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) {\n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    // add a stylesheet to stop images from breaking their columns\n    var add_max_img_styles = false;\n    if ( this._book.packaging.metadata.layout == 'pre-paginated' ) {\n      // NOOP\n    } else if ( this.options.flow == 'auto' || this.options.flow == 'paginated' ) {\n      add_max_img_styles = true;\n    }\n\n    var custom_stylesheet_rules = [];\n\n    // force 90% height instead of default 60%\n    if ( this.metadata.layout != 'pre-paginated' ) {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n            \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n            \"object-fit\": \"contain\",\n            \"page-break-inside\": \"avoid\"\n          },\n          \"svg\" : {\n            \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n            \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n            \"page-break-inside\": \"avoid\"\n          },\n          \"body\": {\n            \"overflow\": \"hidden\"\n          }\n        });\n      }.bind(this._rendition))\n    } else {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            // \"border\": \"64px solid black !important\",\n            \"box-sizing\": \"border-box !important\"\n          },\n          \"figure\": {\n            \"box-sizing\": \"border-box !important\",\n            \"margin\": \"0 !important\"\n          },\n          \"body\": {\n            \"margin\": \"0\",\n            \"overflow\": \"hidden\"\n          }\n        });\n      }.bind(this._rendition));\n    }\n\n    this._updateFontSize();\n\n    if ( custom_stylesheet_rules.length ) {\n      this._rendition.hooks.content.register(function(view) {\n        view.addStylesheetRules(custom_stylesheet_rules);\n      })\n    }\n\n    this._rendition.on('resized', function(box) {\n      self.fire('resized', box);\n    })\n\n    this._rendition.on('relocated', function(location) {\n      if ( self._fired ) { self._fired = false; return ; }\n      self.fire('relocated', location);\n      if ( Browser.safari && self._last_location_start && self._last_location_start != location.start.href ) {\n        self._fired = true;\n        setTimeout(function() {\n          // self._rendition.display(location.start.cfi);\n        }, 0);\n      }\n      self._last_location_start = location.start.href;\n    })\n\n    this._rendition.on('displayerror', function(err) {\n      console.log(\"AHOY RENDITION DISPLAY ERROR\", err);\n    })\n\n    this._rendition.on(\"locationChanged\", function(location) {\n      var view = this.manager.current();\n      var section = view.section;\n      var current = this.book.navigation.get(section.href);\n\n      // if ( self.__hash && view.contents ) {\n      //   var check = section.contents.querySelector(`#${self.__hash}`);\n      //   if ( check ) {\n      //     var new_target = section.cfiFromElement(check);\n      //     this.display(new_target);\n      //     self.__hash = null;\n      //     return;\n      //   }\n      // }\n\n      self.fire(\"updateSection\", current);\n      self.fire(\"updateLocation\", location);\n      // self.fire(\"relocated\", location);\n    });\n\n    this._rendition.on(\"rendered\", function(section, view) {\n\n      self.on('keyDown', function(data) {\n        if ( data.keyName == 'Tab' && data.inner ) {\n          var container = self._rendition.manager.container;\n          var mod;\n          var delta;\n          var x; var xyz;\n          setTimeout(function() {\n            var scrollLeft = container.scrollLeft;\n            mod = scrollLeft % parseInt(self._rendition.manager.layout.delta, 10);\n            if ( mod > 0 && ( mod / self._rendition.manager.layout.delta ) < 0.99 ) {\n              // var x = Math.floor(event.target.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10)) + 1;\n              // var delta = ( x * self._rendition.manager.layout.delta) - event.target.scrollLeft;\n              x = Math.floor(container.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10));\n              if ( data.shiftKey ) { x -= 0 ; }\n              else { x += 1; }\n              var y = container.scrollLeft;\n              delta = ( x * self._rendition.manager.layout.delta ) - y;\n              xyz = ( x * self._rendition.manager.layout.delta );\n              // if ( data.shiftKey ) { delta *= -1 ; }\n              if ( true || ! data.shiftKey ) {\n                self._rendition.manager.scrollBy(delta);\n              }\n            }\n            // console.log(\"AHOY DOING THE SCROLLING\", data.shiftKey, scrollLeft, mod, x, xyz, delta);\n          }, 0);\n        }\n      })\n\n\n    })\n  },\n\n  _initializeReaderStyles: function() {\n    var self = this;\n    var themes = this.options.themes;\n    if ( themes ) {\n      themes.forEach(function(theme) {\n        self._rendition.themes.register(theme['klass'], theme.href ? theme.href : theme.rules);\n      })\n    }\n\n    // base for highlights\n    this._rendition.themes.override('.epubjs-hl', \"fill: yellow; fill-opacity: 0.3; mix-blend-mode: multiply;\");\n  },\n\n  _selectTheme: function(refresh) {\n    var theme = this.options.theme || 'default';\n    this._rendition.themes.select(theme);\n    if ( 0 && refresh ) {\n      var cfi = this.currentLocation().end.cfi;\n      this._rendition.manager.clear();\n      this._rendition.display(cfi);\n    }\n  },\n\n  _updateFontSize: function() {\n    if ( this.metadata.layout == 'pre-paginated') {\n      // we're not doing font changes for pre-paginted\n      return;\n    }\n\n    var text_size = this.options.text_size == 'auto' ? 100 : this.options.text_size;\n    this._rendition.themes.fontSize(`${text_size}%`);\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    var scale = this.options.scale;\n    if ( scale ) {\n      this.settings.scale = parseInt(scale, 10) / 100.0;\n      this._queueScale();\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        this._rendition.scale(this.settings.scale);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    var scale = this.options.scale;\n    if ( scale ) {\n      scale = parseInt(scale, 10) / 100.0;\n      this._rendition.scale(scale);\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        this._rendition.scale(this.settings.scale);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.EpubJS.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'annotations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    if ( Browser.ie ) {\n      return {\n        reset: function() { /* NOOP */ },\n        highlight: function(cfiRange) { /* NOOP */ }\n      }\n    }\n    if ( ! this._rendition.annotations.reset ) {\n      this._rendition.annotations.reset = function(){\n        for(var hash in this._annotations) {\n            var cfiRange = decodeURI(hash);\n            this.remove(cfiRange);\n        }\n        this._annotationsBySectionIndex = {};\n      }.bind(this._rendition.annotations);\n    }\n    return this._rendition.annotations;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._book.locations;\n  }\n});\n\nwindow.Reader = Reader;\n\nexport function createReader(id, options) {\n  return new Reader.EpubJS(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.Mock = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    this._book = {\n      metadata: {\n        title: 'The Mock Life',\n        creator: 'Alex Mock',\n        publisher: 'University Press',\n        location: 'Ann Arbor, MI',\n        pubdate: '2017-05-23'\n      },\n      contents: {\n        toc: [\n          {id: 1, href: \"/epubs/mock/ops/xhtml/TitlePage.xhtml\", label: \"Title\", parent: null},\n          {id: 2, href: \"/epubs/mock/ops/xhtml/Chapter01.xhtml\", label: \"Chapter 1\", parent: null},\n          {id: 3, href: \"/epubs/mock/ops/xhtml/Chapter02.xhtml\", label: \"Chapter 2\", parent: null},\n          {id: 4, href: \"/epubs/mock/ops/xhtml/Chapter03.xhtml\", label: \"Chapter 3\", parent: null},\n          {id: 5, href: \"/epubs/mock/ops/xhtml/Chapter04.xhtml\", label: \"Chapter 4\", parent: null},\n          {id: 6, href: \"/epubs/mock/ops/xhtml/Chapter05.xhtml\", label: \"Chapter 5\", parent: null},\n          {id: 7, href: \"/epubs/mock/ops/xhtml/Chapter06.xhtml\", label: \"Chapter 6\", parent: null},\n          {id: 8, href: \"/epubs/mock/ops/xhtml/Chapter07.xhtml\", label: \"Chapter 7\", parent: null},\n          {id: 9, href: \"/epubs/mock/ops/xhtml/Index.xhtml\", label: \"Index\", parent: null},\n        ]\n      }\n    };\n\n    this._locations = [\n      'epubcfi(/6/4[TitlePage.xhtml])',\n      'epubcfi(/6/4[Chapter01.xhtml])',\n      'epubcfi(/6/4[Chapter02.xhtml])',\n      'epubcfi(/6/4[Chapter03.xhtml])',\n      'epubcfi(/6/4[Chapter04.xhtml])',\n      'epubcfi(/6/4[Chapter05.xhtml])',\n      'epubcfi(/6/4[Chapter06.xhtml])',\n      'epubcfi(/6/4[Chapter07.xhtml])',\n      'epubcfi(/6/4[Chapter08.xhtml])',\n      'epubcfi(/6/4[Index.xhtml])',\n    ];\n\n    this.__currentIndex = 0;\n\n    this.metadata = this._book.metadata;\n    this.fire('updateContents', this._book.contents);\n    this.fire('updateTitle', this._metadata);\n    this.fire('updateLocations', this._locations);\n    this.draw(target, callback);\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n    this.settings = { flow: this.options.flow };\n    this.settings.height = '100%';\n    this.settings.width = '99%';\n    // this.settings.width = '100%';\n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      callback = target;\n      target = undefined;\n    }\n    callback();\n    self.fire('ready');\n  },\n\n  next: function() {\n    // this._rendition.next();\n  },\n\n  prev: function() {\n    // this._rendition.prev();\n  },\n\n  first: function() {\n    // this._rendition.display(0);\n  },\n\n  last: function() {\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" ) {\n      this.__currentIndex = this._locations.indexOf(target);\n    } else {\n      this.__currentIndex = target;\n    }\n    this.fire(\"relocated\", this.currentLocation());\n  },\n\n  destroy: function() {\n    // if ( this._rendition ) {\n    //   this._rendition.destroy();\n    // }\n    // this._rendition = null;\n  },\n\n  currentLocation: function() {\n    var cfi = this._locations[this.__currentIndex];\n    return {\n      start: { cfi: cfi, href: cfi },\n      end: { cfi: cfi, href: cfi }\n    }\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n  },\n\n  _updateTheme: function() {\n\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.Mock.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    var self = this;\n    return {\n      total: self._locations.length,\n      locationFromCfi: function(cfi) {\n        return self._locations.indexOf(cfi);\n      },\n      percentageFromCfi: function(cfi) {\n        var index = self.locations.locationFromCfi(cfi);\n        return ( index / self.locations.total );\n      },\n      cfiFromPercentage: function(percentage) {\n        var index = Math.ceil(percentage * 10);\n        return self._locations[index];\n      }\n    }\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'annotations', {\n  get: function() {\n    return {\n      reset: function() {},\n      highlight: function() {}\n    }\n  }\n})\n\nexport function createReader(id, options) {\n  return new Reader.Mock(id, options);\n}\n","import {Reader} from './Reader';\nimport * as EpubJS from './Reader.EpubJS';\nimport * as Mock from './Reader.Mock';\n\nvar engines = {\n  epubjs: EpubJS.createReader,\n  mock: Mock.createReader\n}\n\nexport var reader = function(id, options) {\n  options = options || {};\n  var engine = options.engine || window.COZY_EPUB_ENGINE || 'epubjs';\n  var engine_href = options.engine_href || window.COZY_EPUB_ENGINE_HREF;\n  var _this = this;\n  var _arguments = arguments;\n\n  options.engine = engine;\n  options.engine_href = engine_href;\n\n  return engines[engine].apply(_this, [id, options]);\n}"],"names":["global","checkIfIteratorIsSupported","Symbol","iterator","error","iteratorSupported","createIterator","items","value","shift","done","serializeParam","encodeURIComponent","replace","deserializeParam","decodeURIComponent","polyfillURLSearchParams","URLSearchParams","searchString","defineProperty","attributes","split","attribute","i","length","append","_this","forEach","name","proto","prototype","_entries","push","toString","delete","get","getAll","slice","has","set","callback","thisArg","entries","hasOwnProperty","call","keys","values","window","self","this","checkIfURLIsSupported","u","URL","pathname","href","searchParams","e","polyfillURL","_URL","url","base","String","doc","document","implementation","createHTMLDocument","baseElement","createElement","head","appendChild","anchorElement","body","protocol","test","TypeError","linkURLWithAnchorAttribute","attributeName","_anchorElement","defineProperties","expectedPort","addPortToOrigin","port","hostname","search","methodName","method","apply","arguments","createObjectURL","blob","revokeObjectURL","location","getOrigin","origin","createElementNS","view","classListProp","protoProp","elemCtrProto","Element","objCtr","Object","strTrim","trim","arrIndexOf","Array","indexOf","item","len","DOMEx","type","message","code","DOMException","checkTokenAndGetIndex","classList","token","ClassList","elem","trimmedClasses","getAttribute","classes","_updateClassName","setAttribute","classListProto","classListGetter","Error","contains","add","tokens","l","updated","remove","index","splice","toggle","force","result","join","classListPropDesc","enumerable","configurable","ex","number","undefined","__defineGetter__","testElement","createMethod","original","DOMTokenList","_toggle","extend","dest","j","src","create","F","bind","fn","obj","args","concat","lastId","stamp","_cozy_id","throttle","time","context","lock","wrapperFn","later","setTimeout","wrapNum","x","range","includeMax","max","min","d","falseFn","formatNum","num","digits","pow","Math","round","isNumeric","isNaN","parseFloat","isFinite","str","splitWords","setOptions","options","getParamString","existingUrl","uppercase","params","toUpperCase","templateRe","template","data","key","isArray","array","el","emptyImageUrl","getPrefixed","lastTime","timeoutDefer","Date","timeToCall","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","id","clearTimeout","requestAnimFrame","immediate","cancelAnimFrame","loader","js","handler","_resolved","callbacks","then","cb","resolve","catch","reject","_argv","console","log","trace","element","onload","onerror","async","parent","attr","Class","props","NewClass","initialize","callInitHooks","parentProto","__super__","Util","constructor","statics","includes","checkDeprecatedMixinEvents","_initHooks","_initHooksCalled","include","mergeOptions","addInitHook","init","cozy","Mixin","Evented","on","types","_on","off","_events","_off","typeListeners","newListener","ctx","listeners","_firingCount","fire","propagate","listens","event","target","_propagateEvent","_eventParents","once","addEventParent","removeEventParent","layer","addEventListener","removeEventListener","clearAllEventListeners","addOneTimeEventListener","fireEvent","hasEventListeners","style","documentElement","ie","ielt9","edge","navigator","webkit","userAgentContains","android","android23","opera","chrome","gecko","safari","phantom","opera12","win","platform","ie3d","webkit3d","WebKitCSSMatrix","gecko3d","any3d","L_DISABLE_3D","mobile","orientation","mobileWebkit","mobileWebkit3d","msPointer","PointerEvent","MSPointerEvent","pointer","touch","L_NO_TOUCH","DocumentTouch","mobileOpera","mobileGecko","retina","devicePixelRatio","screen","deviceXDPI","logicalXDPI","canvas","getContext","svg","vml","div","innerHTML","shape","firstChild","behavior","_typeof","adj","columnCount","userAgent","toLowerCase","Point","y","clone","point","_add","toPoint","subtract","_subtract","divideBy","_divideBy","multiplyBy","_multiplyBy","scaleBy","unscaleBy","_round","floor","_floor","ceil","_ceil","distanceTo","sqrt","equals","abs","POINTER_DOWN","Browser","POINTER_MOVE","POINTER_UP","POINTER_CANCEL","TAG_WHITE_LIST","_pointers","_pointerDocListener","_pointersCount","addPointerListener","_addPointerStart","_addPointerMove","_addPointerEnd","removePointerListener","onDown","pointerType","MSPOINTER_TYPE_MOUSE","tagName","DomEvent","_handlePointer","_globalPointerDown","_globalPointerMove","_globalPointerUp","pointerId","touches","changedTouches","onMove","buttons","onUp","_touchstart","_touchend","_pre","addDoubleTapListener","last","doubleTap","delay","onTouchStart","count","now","delta","onTouchEnd","cancelBubble","newTouch","prop","removeDoubleTapListener","touchstart","touchend","dblclick","addOne","eventsKey","removeOne","originalHandler","isExternalTarget","filterClick","attachEvent","detachEvent","stopPropagation","originalEvent","_stopped","skipped","disableScrollPropagation","disableClickPropagation","fakeStop","preventDefault","returnValue","stop","getMousePosition","container","clientX","clientY","rect","getBoundingClientRect","left","clientLeft","top","clientTop","wheelPxFactor","getWheelDelta","wheelDeltaY","deltaY","deltaMode","deltaX","deltaZ","wheelDelta","detail","skipEvents","events","related","relatedTarget","parentNode","err","lastClick","timeStamp","elapsed","_simulatedClick","_simulated","matches","ep","webkitMatchesSelector","msMatchesSelector","mozMatchesSelector","TRANSFORM","testProp","TRANSITION","TRANSITION_END","getElementById","getStyle","currentStyle","defaultView","css","getComputedStyle","className","removeChild","empty","toFront","toBack","insertBefore","hasClass","getClass","RegExp","addClass","setClass","removeClass","baseVal","setOpacity","opacity","_setOpacityIE","filter","filterName","filters","Enabled","Opacity","isPropertySupported","setTransform","offset","scale","pos","setPosition","_leaflet_pos","getPosition","disableTextSelection","enableTextSelection","_userSelect","userSelectProperty","disableImageDrag","enableImageDrag","_outlineElement","_outlineStyle","preventOutline","tabIndex","restoreOutline","outline","isObject","module","freeGlobal","freeSelf","root","Function","objectProto","nativeObjectToString","symToStringTag","toStringTag","getRawTag","isOwn","tag","objectToString","nullTag","undefinedTag","baseGetTag","isObjectLike","symbolTag","isSymbol","NAN","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","toNumber","other","valueOf","isBinary","FUNC_ERROR_TEXT","nativeMax","nativeMin","debounce","func","wait","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","leadingEdge","timerExpired","remainingWait","timeSinceLastCall","timeSinceLastInvoke","shouldInvoke","trailingEdge","cancel","flush","debounced","isInvoking","asyncTag","funcTag","genTag","proxyTag","isFunction","coreJsData","maskSrcKey","uid","exec","IE_PROTO","isMasked","funcProto","funcToString","toSource","reRegExpChar","reIsHostCtor","reIsNative","baseIsNative","pattern","getValue","object","getNative","baseAssignValue","eq","assignValue","objValue","copyObject","source","customizer","isNew","newValue","identity","overRest","start","transform","otherArgs","constant","baseSetToString","string","HOT_COUNT","HOT_SPAN","nativeNow","shortOut","lastCalled","remaining","setToString","baseRest","MAX_SAFE_INTEGER","isLength","isArrayLike","reIsUint","isIndex","isIterateeCall","createAssigner","assigner","sources","guard","isPrototype","Ctor","baseTimes","n","iteratee","argsTag","baseIsArguments","propertyIsEnumerable","isArguments","stubFalse","freeExports","exports","nodeType","freeModule","moduleExports","Buffer","nativeIsBuffer","isBuffer","arrayTag","boolTag","dateTag","errorTag","mapTag","numberTag","objectTag","regexpTag","setTag","stringTag","weakMapTag","arrayBufferTag","dataViewTag","float32Tag","float64Tag","int8Tag","int16Tag","int32Tag","uint8Tag","uint8ClampedTag","uint16Tag","uint32Tag","typedArrayTags","baseIsTypedArray","baseUnary","freeProcess","process","nodeUtil","binding","nodeIsTypedArray","isTypedArray","arrayLikeKeys","inherited","isArr","isArg","isBuff","isType","skipIndexes","overArg","arg","nativeKeys","baseKeys","assign","keyboardAllowed","val","fnMap","ret","eventNameMap","change","fullscreenchange","fullscreenerror","screenfull","request","requestFullscreen","ALLOW_KEYBOARD_INPUT","exit","exitFullscreen","isFullscreen","onchange","eventName","raw","Boolean","fullscreenElement","enabled","fullscreenEnabled","Reader","regions","metadata","flow","engine","fontSizeLarge","fontSizeSmall","fontSizeDefault","trackResize","text_size","mobileMediaQuery","forceScrolledDocHeight","theme","rootfilePath","themes","_original_document_title","title","localStorage","getItem","JSON","parse","_checkFeatureCompatibility","_initContainer","_initLayout","klass","rules","rule","new_rule","_updateTheme","_initEvents","_mode","mode","_start","open","reopen","saveOptions","saved_options","setItem","stringify","DomUtil","_container","dataset","draw","next","prev","display","gotoPage","goBack","history","back","goForward","forward","_preResize","_onScroll","_containerId","_fadeAnimated","fadeAnimation","position","_initPanes","panes","_panes","prefix","_initBookLoader","_checkIfLoaded","_loaded","_targets","tracking","reader","_action","_last_location_start","_reader","action","v","pop","pageview","cfi","transform3DLimit","_onMoveEnd","location_href","_ignoreHistory","tmp_href","substr","pushState","percentage","p","isTrusted","state","keyName","check","activeElement","localName","parentElement","IGNORE_TARGETS","shiftKey","_scroll","scrollTop","scrollLeft","_handleDOMEvent","keyCode","srcElement","_fireDOMEvent","targets","synth","_findEventTargets","isMarker","containerPoint","latLngToContainerPoint","getLatLng","mouseEventToContainerPoint","layerPoint","containerPointToLayerPoint","latlng","layerPointToLatLng","nonBubblingEvents","getFixedBookPanelSize","h","clientHeight","paddingTop","paddingBottom","w","clientWidth","paddingRight","paddingLeft","height","width","invalidateSize","_drawn","_resizeRequest","_resizeBookPane","_setupHooks","_checkMobileDevice","_isMobile","matchMedia","_enableBookLoader","_clearBookLoaderTimeout","_force_progress","_loader_timeout","_disableBookLoader","loader_template","loaderTemplate","DOMParser","parseFromString","children","EOT","Control","_locked","_id","getTime","random","getRegion","region","setRegion","removeControl","addControl","getContainer","addTo","onAdd","area","getControlRegion","onRemove","_refocusOnMap","screenX","screenY","focus","_className","widget","direction","control","getControlContainer","_controlContainer","parts","tmp","slug","panel","getControlRegion_1","slot","childElement","_classify","_clearControlRegion","_controlRegions","PageControl","_control","querySelector","_createButton","_fill","html","label","_bindEvents","link","_unit","s","unit","_label","PagePrevious","PageNext","PageFirst","first","PageLast","pageNext","pagePrevious","pageFirst","pageLast","activeModal","FOCUSABLE_ELEMENTS","ACTIONABLE_ELEMENTS","Modal","fraction","actions","onShow","onClose","handlers","_initializedEvents","panelHTML","main","button_cls","modal","onClick","onKeydown","onModalTransition","button_id","button","close","closeModal","deactivate","removeEventListeners","showModal","_resize","setFocusToFirstNode","addEventListeners","activate","offsetHeight","offsetWidth","header","footer","getFocusableNodes","nodes","querySelectorAll","map","focusableNodes","getActionableNodes","maintainFocus","closeAfterAction","hasAttribute","actionableNodes","click","selector","focusedItemIndex","Contents","defaultTemplate","_modal","_setupSkipLink","_process","tabindex","option","_createOption","subitems","toc","chapter","anchor","textContent","span","skipLink","ul","contents","Title","h1","_title","_divider","_section","bookTitle","PublicationMetadata","_publisher","_rights","publisher","rights","publicationMetadata","Preferences","hasThemes","_activated","updatePreferences","initializeForm","_createPanel","possible_fieldsets","layout","rootfiles","_fieldsets","cls","fieldset","fields","hasFields","field","inputs","input","checked","hint","_form","new_options","saveable_options","updateForm","Fieldset","_current","TextSize","form","_input","_output","_preview","_actionReset","_updatePreview","saveable","fontSize","Display","scrolled_help","Theme","Rendition","expr","rootfile","accessMode","Scale","preferences","Widget","_onAddExtra","_updateTemplate","_updateClass","node","Button","Panel","Toggle","states","stateName","_resetState","_state","Citation","designMode","formatted","createRange","selectNode","sel","getSelection","removeAllRanges","addRange","flag","execCommand","_message","detach","citations","citation","format","text","createTextNode","_formatted","_initializeForm","_formatCitation","selected","Search","_data","_canceled","_processing","_article","openModalResults","openModalWaiting","submitQuery","_emptyArticle","_buildResults","searchUrl","XMLHttpRequest","status","response","send","hasChildNodes","lastChild","content","annotations","reset","highlight","highlight_off","search_results","cfiRange","snippet","chapterTitle","BibliographicInformation","dl","metadata_fields","idx","_formatDate","metadata_fields_seen","dt","dd","match","bibliographicInformation","Download","_configureDownloadForm","submit","download_links","size","download","Navigator","_setup","locations","_initializeNavigator","_createControl","_background","_status","_spanCurrentPercentage","_spanCurrentLocation","_spanTotalLocations","_update","_mouseDown","_initiated","percentageFromCfi","currentLocation","cfiFromPercentage","current","rangeBg","current_location","locationFromCfi","_last_delta","_last_value","_total","total","Bus","instance","bus","Events","foo","bar","trzy","_undefined","require","isValue","opts1","dscr","c","desc","writable","normalizeOpts","gs","isCallable","descriptor","emit","methods","descriptors","listener","__ee__","__eeOnceListener__","candidate","o","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","ELEMENT_NODE","TEXT_NODE","webkitURL","mozURL","uuid","r","documentHeight","scrollHeight","isElement","isNumber","isFloat","f","prefixed","unprefixed","vendors","prefixes","upper","defaults","getOwnPropertyNames","propName","getOwnPropertyDescriptor","insert","compareFunction","locationOf","_end","end","pivot","compared","a","b","indexOfSorted","bounds","widthProps","heightProps","borders","nodeBounds","elPos","ownerDocument","Node","elRange","selectNodeContents","windowBounds","innerWidth","innerHeight","right","bottom","indexOfNode","typeId","childNodes","sib","indexOfTextNode","textNode","indexOfElementNode","elementNode","isXml","ext","createBlob","mime","Blob","createBlobUrl","tempUrl","revokeBlobUrl","createBase64Url","datauri","btoa","markup","forceXMLDom","Parser","charCodeAt","qs","elements","getElementsByTagName","qsa","qsp","q","filtered","sprint","createTreeWalker","treeWalker","NodeFilter","SHOW_TEXT","walk","nextNode","walked","nextSibling","blob2base64","Promise","FileReader","readAsDataURL","onloadend","defer","promise","freeze","querySelectorByType","query","getAttributeNS","findChildren","parents","unshift","filterChildren","nodeName","single","getParentByTagName","tagname","RangeObject","collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset","startNode","collapse","_commonAncestorContainer","_checkCollapsed","endNode","toStart","referenceNode","setStart","setEnd","endIndex","startParents","endParents","assertPath","path","normalizeStringPosix","allowAboveRoot","res","lastSlash","dots","_format","sep","pathObject","dir","posix","resolvedPath","resolvedAbsolute","cwd","normalize","isAbsolute","trailingSeparator","joined","relative","from","to","fromStart","fromEnd","fromLen","toEnd","toLen","lastCommonSep","fromCode","toCode","out","_makeLong","dirname","hasRoot","matchedSlash","basename","extIdx","firstNonSlashEnd","extname","startDot","startPart","preDotState","Path","pathString","parsed","isDirectory","directory","filename","extension","what","charAt","splitPathRe","Url","urlString","baseString","absolute","basePath","hash","fullpath","DOCUMENT_NODE","EpubCFI","cfiFrom","ignoreClass","spinePos","parseComponent","steps","checkType","fromRange","fromNode","isCfiString","cfiStr","baseComponent","pathComponent","getChapterComponent","getPathComponent","getRange","componentStr","component","terminal","assertion","parseTerminal","step","parseStep","stepStr","has_brackets","termialStr","characterOffset","textLocationAssertion","indirection","ranges","splitStr","part","segment","segmentString","joinSteps","cfiString","cfiOne","cfiTwo","stepsA","stepsB","terminalA","terminalB","filteredNode","filteredPosition","currentNode","filteredStep","stepA","stepB","needsIgnoring","patchOffset","pathTo","equalStep","sibling","previousSibling","isText","curr","totalOffset","output","prevIndex","currNodeType","prevNodeType","textNodes","normalizedMap","xpath","_doc","evaluate","stepsToXpath","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","walkToNode","findNode","child","lastStepIndex","childIndex","startSteps","endSteps","missed","fixMiss","_spineNodeIndex","_pos","spineNodeIndex","Hook","hooks","hook","promises","task","executing","all","replaceBase","section","replaceCanonical","canonical","replaceMeta","meta","idref","replaceLinks","links","replaceLink","linkUrl","onclick","substitute","urls","replacements","Section","linear","properties","cfiBase","serialize","_request","loading","loaded","xml","trigger","rendering","rendered","load","isIE","Serializer","XMLSerializer","serializer","serializeToString","_query","find","excerpt","limit","cfiFromRange","substring","globalLayout","settings","spread","rendition","property","_range","unload","clear","Spine","spineItems","spineByHref","spineById","register","epubcfi","manifest","baseUrl","_package","resolver","spine","manifestItem","spineItem","generateChapterComponent","nextIndex","encodeURI","decodeURI","each","destroy","Queue","_q","tick","running","paused","deferred","queued","run","inwait","dequeue","defered","EPUBJS_VERSION","DOM_EVENTS","EVENTS","BOOK","OPEN_FAILED","CONTENTS","EXPAND","RESIZE","SELECTED","SELECTED_RANGE","LINK_CLICKED","LOCATIONS","CHANGED","MANAGERS","RESIZED","ORIENTATION_CHANGE","ADDED","SCROLL","SCROLLED","REMOVED","VIEWS","AXIS","LOAD_ERROR","RENDERED","DISPLAYED","SHOWN","HIDDEN","MARK_CLICKED","RENDITION","STARTED","ATTACHED","DISPLAY_ERROR","LOCATION_CHANGED","RELOCATED","LAYOUT","UPDATED","Locations","pause","_locations","break","_currentCfi","processingTimeout","chars","enqueue","completed","counter","_break","parser","dist","loc","compare","percentageFromLocation","warn","cfiFromLocation","setCurrent","EventEmitter","Container","containerDocument","packagePath","encoding","xmlEncoding","Packaging","packageDocument","navPath","ncxPath","coverPath","metadataNode","manifestNode","spineNode","parseManifest","findNavPath","findNcxPath","findCoverPath","parseSpine","uniqueIdentifier","findUniqueIdentifier","parseMetadata","getElementText","creator","description","pubdate","identifier","language","modified_date","getPropertyText","viewport","media_active_class","manifestXml","overlay","spineXml","propArray","itemref","packageXml","uniqueIdentifierId","namespaceURI","nodeValue","tocId","pkg","epubVersion","metaCover","coverId","cover","found","getElementsByTagNameNS","json","readingOrder","resources","rel","Navigation","tocByHref","tocById","landmarks","landmarksByType","ncx","parseNav","parseLandmarks","parseNcx","unpack","navHtml","navElement","navItems","list","navItem","parentItem","parentContent","landmarkItem","tocXml","navPoints","ncxItem","navLabel","table","mimeTypes","subtype","defaultValue","lookup","Resources","archive","replacementUrls","assets","cssUrls","splitUrls","parsedUrl","mimeType","createUrl","replaced","replacement","createCssFile","replacementUrl","indexInUrls","newUrl","textResponse","getText","relUrls","assetHref","resolved","relativeTo","PageList","pages","firstPage","lastPage","totalPages","pageList","page","isCfi","packageUrl","pg","percent","pageFromCfi","percentageFromPage","Layout","_spread","_minSpreadWidth","minSpreadWidth","_evenSpreads","evenSpreads","_flow","spreadWidth","columnWidth","gap","divisor","update","_width","_height","_gap","pageWidth","formating","fit","columns","totalLength","pageLength","spreads","newProps","Themes","_themes","_overrides","_injected","inject","overrides","registerThemes","default","registerUrl","registerRules","getContents","addStylesheet","serialized","addStylesheetRules","injected","priority","override","Mapping","axis","dev","horizontal","_dev","findRanges","rangeListToCfiList","rangePairToCfiPair","findStart","findEnd","startRange","toRange","endRange","selection","acceptNode","FILTER_ACCEPT","FILTER_REJECT","safeFilter","scrollWidth","stack","$el","$prev","findTextStartRange","findTextEndRange","splitTextNodeIntoRanges","_splitter","splitter","rangePair","startCfi","endCfi","cifPair","hasNavigator","isChrome","isWebkit","sectionIndex","_size","epubReadingSystem","frame","border","overflow","overflowX","overflowY","setProperty","$viewport","newContent","_scale","_minimum","_maximum","_scalable","minimum","maximum","scalable","scrollTo","imageLoadListeners","mediaQueryListeners","addSelectionListeners","resizeListeners","linksHandler","removeSelectionListeners","expanding","textWidth","textHeight","onResize","resizeCheck","_resizeCheck","sheets","styleSheets","mediaChangeHandler","m","_expanding","expand","cssRules","media","mql","mediaText","addListener","observer","MutationObserver","mutations","config","childList","characterData","subtree","observe","images","img","naturalWidth","fonts","ready","targetPos","newRange","Range","$stylesheet","onreadystatechange","readyState","styleEl","styleSheet","sheet","rl","propStr","pl","insertRule","selectors","definition","_rules","$script","_triggerEvent","triggerEvent","passive","_onSelectionChange","onSelectionChange","selectionEndTimeout","triggerSelectedEvent","cfirange","rangeCount","getRangeAt","_cfi","layoutStyle","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","writingMode","offsetX","offsetY","scaleStr","translateStr","viewportWidth","viewportHeight","widthScale","heightScale","scaler","mapping","WRITING_MODE","_layoutStyle","version","hasFeature","feature","disconnect","removeListeners","Annotations","highlights","underlines","marks","_annotations","_annotationsBySectionIndex","render","unloaded","styles","annotation","Annotation","views","attach","_removeFromAnnotationBySectionIndex","_annotationsAt","mark","underline","unhighlight","ununderline","unmark","proxyMouse","tracked","dispatch","t","dispatchEvent","contentDocument","_arr","_i","ev","opts","bubbles","MouseEvent","copy","createEvent","initMouseEvent","cancelable","ctrlKey","altKey","metaKey","rectContains","rects","getClientRects","_get","receiver","getPrototypeOf","getter","_createClass","Constructor","protoProps","staticProps","_svg2","_interopRequireDefault","_svg","_events2","__esModule","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","setPrototypeOf","__proto__","_classCallCheck","Pane","addMark","g","removeMark","unbind","coords","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","return","Mark","filteredRanges","box","contained","Highlight","_Mark","docFrag","createDocumentFragment","Underline","_Highlight","line","setCoords","rect1","rect2","IframeView","globalLayoutProperties","added","displayed","fixedWidth","fixedHeight","pane","flex","iframe","createContainer","scrolling","seamless","resizing","visibility","elementBounds","supportsSrcdoc","show","sectionRender","setAxis","addListeners","_textWidth","_contentWidth","_textHeight","_contentHeight","_needsReframe","elBorders","iframeBorders","lockedWidth","lockedHeight","forceEvenPages","reframe","widthDelta","prevBounds","heightDelta","placeMark","onLoad","blobUrl","srcdoc","write","contentWindow","layoutFunc","onDisplayed","stopExpanding","offsetTop","offsetLeft","parentPos","emitter","timeWaiting","Stage","_options","hidden","wrapper","wrap","wordSpacing","lineHeight","verticalAlign","flexDirection","flexWrap","fullsize","_element","getElement","resizeFunc","orientationChangeFunc","containerStyles","containerPadding","_windowBounds","bodyStyles","bodyPadding","rulesArray","scope","getSheet","Views","_views","hide","DefaultViewManager","optsSettings","View","renditionQueue","queue","infinite","viewSettings","stage","attachTo","_bounds","_stageSize","onResized","onOrientationChange","updateLayout","scroller","onScroll","orientationTimeout","resizeTimeout","afterScrolled","resizeOnOrientationChange","resize","stageSize","winBounds","displaying","visible","moveTo","distX","distY","isPaginated","createView","afterDisplayed","afterResized","updateAxis","prepend","scrollBy","scrolledLocation","paginatedLocation","pageHeight","used","scrollY","sections","startPos","endPos","currPage","endPage","scrollX","startPage","tempStartPage","offsetPrev","offsetNext","viewsLength","isVisible","silent","ignore","scrolled","calculate","setLayout","forceUpdate","viewContents","PI_D2","PI","EASING_EQUATIONS","easeOutSine","sin","easeInOutSine","cos","easeInOutQuint","easeInCubic","Snap","manager","duration","minVelocity","minDistance","easing","supportsTouch","setup","disableScroll","afterScrolledTimeout","isVertical","touchCanceler","resizeCanceler","snapping","startTouchX","startTouchY","startTime","endTouchX","endTouchY","endTime","_onResize","_onTouchStart","_onTouchMove","onTouchMove","_onTouchEnd","_afterDisplayed","triggerViewEvent","enableScroll","swipped","wasSwiped","snap","snapWidth","distance","velocity","howMany","snapTo","smoothScrollTo","destination","timeFunction","scroll","performance","ContinuousViewManager","offsetDelta","fill","_full","full","expanded","_offset","updating","trimTimeout","_offsetLeft","_offsetTop","checking","newViews","rtl","visibleLength","contentLength","firstIndex","lastIndex","above","below","erase","prevTop","prevLeft","addScrollListeners","snapper","prevScrollTop","prevScrollLeft","scrollDeltaVert","scrollDeltaHorz","_scrolled","didScroll","scrollTimeout","needsSnap","book","stylesheet","script","handleLinks","passEvents","adjustImages","injectIdentifier","injectStylesheet","injectScript","opened","starting","started","viewManager","ViewManager","requireManager","requireView","package","determineLayoutProperties","afterRemoved","reportLocation","_display","triggerMarkEvent","_layout","applyLayout","updateFlow","isRendered","changed","reportedLocation","reportedLocationAfterRAF","located","locationStart","locationEnd","pageStart","pageEnd","atEnd","atStart","deregister","computed","verticalPadding","ident","packaging","withCredentials","headers","supportsURL","BLOB_RESPONSE","xhr","xhrPrototype","xmlHttpRequestOverrideMimeType","setRequestHeader","responseType","overrideMimeType","DONE","responseXML","Archive","zip","urlCache","checkRequirements","JSZip","isBase64","loadAsync","zipUrl","getBlob","handleResponse","decodededUrl","entry","file","uint8array","useBase64","base64","getBase64","fromCache","Store","requester","storage","httpRequest","online","store","localforage","createInstance","onLine","mapped","encodedUrl","put","retrieve","readAsText","CONTAINER_PATH","INPUT_TYPE","BINARY","BASE64","EPUB","OPF","MANIFEST","DIRECTORY","Book","requestMethod","requestCredentials","requestHeaders","openAs","opening","isOpen","navigation","archived","determineType","openEpub","openPackaging","openManifest","openContainer","unarchive","loadNavigation","credentials","replacementsSetting","originalUrl","substituteResources","replaceCss","retrieved","factory","hasWorkingUrl","forceJURL","relativePathDotMapping","isRelativeScheme","scheme","invalid","_isInvalid","IDNAToASCII","percentEscape","unicode","percentEscapeQuery","EOF","ALPHA","ALPHANUMERIC","stateOverride","cursor","buffer","seenAt","seenBracket","loop","_scheme","_isRelative","_fragment","_schemeData","_host","_port","_path","_username","_password","nextC","nextNextC","cp","tempC","temp","jURL","_url","authority","host","OriginalURL","ePub","VERSION","CFI","utils","PrefabViews","sort","reused","PrePaginatedContinuousViewManager","_manifest","_spine","_redrawViews","section_","sizeToViewport","faking","_buildManifest","viewports","viewport_width","viewport_height","prev_","next_","_max_height","_max_viewport_height","_max_width","_max_viewport_width","debugManager","backgroundImage","colorR","colorG","colorB","backgroundColor","scrollIntoView","retval","waiting","has_section","_checkStillLoading","divs","marker","prePaginated","adjusted_top","adjusted_end","__check_visible","recenter","w3","ReusableIframeView","_layout_height","Viewport","observers","lastX","lastY","getState","positionX","positionY","handleScrollResize","mutationObserver","Observer","observerCollection","defaultObserverCollection","ObserverCollection","Map","pageXOffset","pageYOffset","directionX","directionY","PositionObserver","onTop","onBottom","onLeft","onRight","onMaximized","_wasTop","_wasBottom","_wasLeft","_wasRight","ElementObserver","onEnter","onExit","_didEnter","isElementInDOM","isElementInViewport","O","E","_","C","treshold","vp","cutOff","partial","isFullyVisible","isPartiallyVisible","elH","H","offsetParent","edges","inVp","fully","partially","viewportState","ScrollingContinuousViewManager","old_h","scroll_y","new_h","resized","gotoTarget","initializeViews","_target","marginBottom","marginTop","minHeight","StickyIframeView","EpubJS","_epubjs_ready","sessionStorage","book_href","book_options","useArchive","_book","removeItem","_contents","parseRootfiles","_rendition","generate","containerDoc","_drawRendition","renderTo","_updateFontSize","status_index","_manager","inner","_initializeReaderStyles","_queueTimeout","rootFilePath","newScrollTop","_navigate","guessed","path1","path2","navigating","doUpdate","_updateScale","reload","_selectTheme","_cached_location","custom_stylesheet_rules","_fired","mod","xyz","refresh","select","_queueScale","_metadata","createReader","Mock","__currentIndex","engines","epubjs","mock","COZY_EPUB_ENGINE","engine_href","COZY_EPUB_ENGINE_HREF"],"mappings":"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"}