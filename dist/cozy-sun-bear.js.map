{"version":3,"file":"cozy-sun-bear.js","mappings":"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A;;AAEA,kBAAkB,yBAAI;;AAEtB;AACA;AACA;;AAEA;;AAEA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,sBAAY;AACzB;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA,SAAS,uBAAa;AACtB;;AAEA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;;AAEA,gDAAe,GAAG,EAAC;;;AC3G4D;;AAE/E;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,wBAAwB;AACjC,SAAS,iBAAiB;AAC1B,SAAS,QAAQ;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,qBAAqB;;AAErB,sBAAsB;;AAEtB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;;AAGA;AACA;AACA,UAAU,eAAM;AAChB,IAAI;AACJ,UAAU,eAAM;AAChB,IAAI;AACJ,UAAU,eAAM;AAChB,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI,4CAA4C,aAAI;AACpD;AACA,IAAI,kFAAkF;AACtF;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA,WAAW;AACX;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW;AACX;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;AAClB;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,sBAAsB;AACtB;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA,OAAO,iBAAQ;AACf;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,qCAAqC;AACrC;;AAEA;AACA;AACA;;AAEA;;AAEA,GAAG;;AAEH;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,cAAc,QAAQ;AACtB;AACA;AACA,iBAAiB;AACjB;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA,cAAc,QAAQ;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA,kBAAkB,mBAAmB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,iBAAiB;AAC7B,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA,WAAW;AACX,WAAW;AACX;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAe,SAAS;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,MAAM;AACN;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,iBAAiB;AAC7B,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA,WAAW;AACX,WAAW;AACX;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,eAAe;AACf;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,YAAY;AACZ;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,cAAc,SAAS;;AAEvB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,qBAAY;AAC3B;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;AACA;;;AAGA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,cAAc,SAAS;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,qBAAY;AAClD;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ,eAAe,gBAAW;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAM;AACN;AACA;;AAEA,KAAK;AACL;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAM;AACN;AACA;;AAEA,KAAK;AACL;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA,8CAAe,OAAO,EAAC;;;ACxhCvB;AACA;AACA;AACA;AACA,WAAW,KAAK;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8CAA8C,IAAI;AAClD;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA,KAAK;AACL;AACA,mBAAmB,yBAAyB;AAC5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gDAAgD,IAAI;AACpD;AACA;AACA;AACA,kBAAkB,uBAAuB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,wDAAwD,IAAI;AAC5D;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,2CAAe,IAAI,EAAC;;;AC7Ea;AACT;AACE;;AAEnB;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,QAAQ,WAAE;AACV,QAAQ,WAAE;;AAEV;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA,QAAQ,WAAE;AACV,QAAQ,WAAE;;AAEV;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAQ,WAAE;AACV,QAAQ,WAAE;;AAEV;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACO;;AAEP;;AAEA;AACA;AACA;;AAEA,YAAY,WAAE;AACd;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA,GAAG;AACH;AACA;AACA,kBAAkB,SAAG;AACrB,KAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF,iBAAiB,kBAAkB;AACnC;AACA;;;AAGA;;AAEO;AACP;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;;ACtIqC;AACL;AACA;AACM;AACa;;AAEnD;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA,8BAA8B,IAAI;AAClC,4BAA4B,IAAI;AAChC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,UAAU;AACvB;AACA;AACA,4CAA4C,mBAAO,CAAC,IAAiB;AACrE,oBAAoB,UAAK;AACzB;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS,WAAW;AACpB;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA,sBAAsB,UAAK;AAC3B;AACA,eAAe;;AAEf;AACA;AACA;AACA;AACA;AACA,QAAQ,KAAwD,EAAE,EAE7D,CAAC;AACN;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,UAAU,8BAA8B;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;;AAEA;AACA;AACA;;AAEA,EAAE,eAAM;AACR;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,QAAQ;AACrB;AACA;AACA,aAAa,OAAO;AACpB;;AAEA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,QAAQ;AACrB;AACA;AACA,aAAa,OAAO;AACpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,8CAAe,OAAO,EAAC;;;AC3PS;AACA;AACA;AACgD;;AAEhF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,IAAI;AACjC,2BAA2B,IAAI;;AAE/B;AACA,8BAA8B,WAAW;AACzC,8BAA8B,gBAAgB;AAC9C,8BAA8B,WAAW;;AAEzC,qBAAqB,OAAO;;AAE5B;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,WAAW;AACxB,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,mBAAmB,OAAO;;AAE1B;;;AAGA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,aAAa,eAAe;AAC5B,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,iBAAiB,OAAO;AACxB;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,mBAAmB,4BAA4B;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4CAAe,KAAK,EAAC;;;AC9R+B;;AAEpD;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA,cAAc,0BAAqB;AACnC;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,kBAAkB,UAAK;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN,MAAM;AACN;AACA;AACA;AACA;;;;AAIA,KAAK;AACL;AACA;AACA;;AAEA,IAAI;AACJ,gBAAgB,UAAK;AACrB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,sBAAsB,UAAK;AAC3B;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,MAAM;;AAEN,KAAK;AACL;AACA;AACA;;AAEA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,UAAU;AACtB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,IAAI;;AAEJ;;AAEA;AACA;;;AAGA,4CAAe,KAAK,EAAC;AACL;;;ACrPT;;AAEP;AACO;;AAEA;AACP;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;ACxD2D;AACzB;AACF;AACW;AACF;;AAEzC;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,KAAK;AACpB,qBAAqB,OAAO;;AAE5B;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;AAEA;AACA;AACA,aAAa,KAAK;AAClB,aAAa,QAAQ;AACrB;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,wBAAwB,UAAK;AAC7B;AACA;;AAEA;;AAEA,8EAA8E;;AAE9E;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;;AAEA;;AAEA;AACA;AACA,IAAI;;AAEJ;;AAEA;AACA;AACA;AACA;AACA,aAAa,WAAE;AACf;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;AAClB;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAE,eAAM;;AAER;AACA;AACA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,aAAa;AACb;AACA;AACA;AACA,MAAM,OAAO;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA,QAAQ,mBAAU;;AAElB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA,YAAY,MAAM;AAClB;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,uBAAY;;AAEZ,gDAAe,SAAS,EAAC;;;ACrZO;AACA;;AAEhC;AACA;AACA;AACA,WAAW,UAAU;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,WAAE;;AAEf;AACA;AACA;;AAEA;AACA,mBAAmB,sBAAY;AAC/B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,gDAAe,SAAS,EAAC;;;ACjDqC;;AAE9D;AACA;AACA;AACA,WAAW,UAAU;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iBAAiB,WAAE;AACnB;AACA;AACA;;AAEA,iBAAiB,WAAE;AACnB;AACA;AACA;;AAEA,cAAc,WAAE;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,wBAAwB,2BAAkB;;AAE1C;;AAEA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,YAAG;AACpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAG;;AAEH;;AAEA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,oBAAoB;AACjC,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA,iBAAiB,YAAG;AACpB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,aAAa,YAAG,wBAAwB,mBAAmB;AAC3D;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,SAAS;AACrB,aAAa;AACb;AACA;AACA;AACA,aAAa,YAAG,wBAAwB,wCAAwC;AAChF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,MAAM;AAChD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB;AACA;AACA,YAAY,WAAE;AACd;;AAEA;AACA,mBAAmB,YAAG,sBAAsB,eAAe;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,YAAG,sBAAsB,2BAA2B;AAClE;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA,WAAW,YAAG,eAAe,oBAAoB;;AAEjD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gDAAe,SAAS,EAAC;;;AClXqE;;AAE9F;AACA;AACA,WAAW,UAAU;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,UAAU;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU,WAAE;AACZ,SAAS,WAAE;AACX;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;;AAEA,kBAAkB,gBAAgB;AAClC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,OAAO;AACpB;AACA;AACA,mBAAmB,4BAAmB;AACtC,8BAA8B,YAAG;AACjC;AACA;AACA;AACA;AACA;;AAEA;;AAEA,cAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,QAAQ;AACrB;AACA;AACA;AACA,gBAAgB,uBAAc;;AAE9B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,2BAAkB;AACrC;;AAEA;AACA;AACA;AACA,0BAA0B,uBAAc;AACxC;AACA;AACA;;AAEA;AACA,gBAAgB,2BAAkB;AAClC;AACA;AACA;AACA,2BAA2B,uBAAc;AACzC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,OAAO;AACpB;AACA;AACA,mBAAmB,4BAAmB;AACtC,8BAA8B,YAAG;AACjC;AACA;AACA;AACA;;AAEA;;AAEA,cAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,QAAQ;AACrB;AACA;AACA,gBAAgB,uBAAc;;AAE9B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,OAAO;AACpB;AACA;AACA,kBAAkB,YAAG;AACrB;AACA;AACA;AACA;AACA;;AAEA;;AAEA,cAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,QAAQ;AACrB;AACA;AACA;AACA,cAAc,WAAE;AAChB;AACA,eAAe,WAAE;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA,iDAAe,UAAU,EAAC;;;;;;ACxVsB;AACyB;AAC3C;AACO;AACL;AACA;;AAEhC;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,UAAU;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,aAAa,iBAAiB;AAC9B;AACA;AACA,sBAAsB,SAAG;AACzB,iBAAiB,qBAAW;;AAE5B;AACA,gDAAgD,oDAAoD;AACpG,IAAI;AACJ;AACA;AACA;AACA,aAAa,oBAAW;AACxB,MAAM;AACN;AACA,aAAa,wBAAe;AAC5B,MAAM;AACN,KAAK;AACL;AACA,YAAY,sBAAa;AACzB,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,aAAa,iBAAiB;AAC9B;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN,IAAI;;AAEJ;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;;AAGL;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,UAAU;AACvB;AACA;AACA;;AAEA,MAAM,yBAAe;AACrB;AACA;AACA,IAAI;AACJ;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA,sBAAsB,yBAAI;;AAE1B;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA,UAAU,UAAU;;AAEpB;AACA;AACA,aAAa,wBAAe;AAC5B,KAAK;AACL,aAAa,sBAAa;AAC1B;;AAEA;AACA,GAAG;AACH;AACA;AACA;AACA,IAAI;AACJ,GAAG;;AAEH;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,UAAU;AACvB,aAAa,UAAU;AACvB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uBAAuB,yBAAI;AAC3B;AACA,IAAI;AACJ;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa,gBAAgB;AAC7B;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,SAAS,UAAU;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,gDAAe,SAAS,EAAC;;;AChUO;AAOV;;AAEtB;AACA;AACA,WAAW,UAAU;AACrB;AACA;AACA;AACA;AACA;AACA,qBAAqB,OAAO;;AAE5B;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA,aAAa,WAAE;AACf,YAAY,WAAE;;AAEd;AACA;AACA,IAAI,cAAc;AAClB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,iBAAiB;AAC9B;AACA;AACA,mBAAmB,4BAAmB;AACtC,8BAA8B,YAAG;AACjC;AACA;AACA;AACA;;AAEA;;AAEA,cAAc,YAAY;AAC1B;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,QAAQ;AACrB;AACA;AACA,gBAAgB,WAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,cAAc,sBAAa;AAC3B;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,WAAW,mBAAU;AACrB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,gCAAgC,KAAK;AACrC;AACA;AACA;;AAEA;AACA;AACA,aAAa,iBAAiB;AAC9B,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,+CAAe,QAAQ,EAAC;;;AC5Sc;AACK;AACF;;AAEzC;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,gBAAgB,iBAAiB;AACjC;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa,SAAS;AACtB;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,qBAAqB;AACrC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA,aAAa,UAAU;AACvB,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,IAAI,OAAO;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,oBAAoB;AACpB;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,cAAc;AACd;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI,OAAO;AACX;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,kBAAkB,eAAM;AACxB,aAAa,MAAM;AACnB;AACA;AACA;;AAEA,uBAAY;;AAEZ,6CAAe,MAAM,EAAC;;;AC9QQ;;AAE9B;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,YAAY;AACZ;AACA,wCAAwC,UAAU,mBAAmB;AACrE,+BAA+B,WAAW,IAAI,YAAY,KAAK;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,iBAAiB;AAC7B;AACA,+BAA+B,UAAU,mBAAmB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA,gBAAgB,SAAG;AACnB,yBAAyB;AACzB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,UAAU;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,UAAU;AACtB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,SAAS;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,6CAAe,MAAM,EAAC;;;ACpPU;AACU;;AAE1C;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,wBAAwB,OAAO;AAC/B,sBAAsB,OAAO;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,UAAU;AACtB,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,iBAAiB;AACnC;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA,YAAY,mBAAU;;AAEtB;;AAEA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA,MAAM;;AAEN;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA,MAAM;;AAEN;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA;;;AAGA,IAAI;;AAEJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA,YAAY,mBAAU;;AAEtB;;AAEA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA,MAAM;;AAEN;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA,MAAM;;AAEN;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA,IAAI;;;AAGJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,mBAAmB;AACrC;;AAEA;;AAEA;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EA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,SAAS;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAAa,iBAAQ,cAAc;;AAEnC;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;;AAEA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,aAAa,MAAM;AACnB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,kBAAkB,mBAAmB;AACrC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,sBAAsB;AACtB,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,iBAAiB;;AAEjB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,mBAAmB;AACrC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA,cAAc,SAAS;AACvB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,kBAAkB;AAC9B,YAAY,QAAQ;AACpB,gBAAgB;AAChB;AACA;AACA;AACA,mBAAmB;;AAEnB;;AAEA;AACA,mBAAmB,OAAO;;AAE1B;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kCAAkC,qBAAY;AAC9C;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS,OAAO;AAChB;AACA;AACA,QAAQ;AACR;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA,IAAI;AACJ;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;;AAEA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,YAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,QAAQ;AACvC;AACA,6EAA6E;AAC7E;;AAEA;AACA,uCAAuC,gBAAgB;AACvD;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,KAAK,GAAG,WAAW;AACpC,OAAO,SAAS;AAChB,+BAA+B,UAAU,EAAE,QAAQ;AACnD,MAAM;AACN,MAAM;AACN;AACA;AACA,gBAAgB,KAAK,GAAG,iBAAiB;AACzC,MAAM,SAAS;AACf,8BAA8B,UAAU,EAAE,QAAQ;AAClD;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc,SAAS;AACvB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;;AAEA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAE,UAAU;AACZ,mEAAmE,eAAe;AAClF,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,UAAU;AACZ,sEAAsE,eAAe;AACrF,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+EAA+E,eAAe;AAC9F;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kFAAkF,eAAe;AACjG;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B,cAAc,MAAM;AACpB,cAAc,MAAM;AACpB;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB,cAAc,OAAO;AACrB;AACA;AACA,gBAAgB,OAAO;AACvB;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB,cAAc,SAAS;AACvB;AACA;AACA,aAAa,OAAO;AACpB;;AAEA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,QAAQ;AACpB,cAAc,SAAS;AACvB;AACA;AACA,aAAa,OAAO;AACpB;;AAEA;AACA;AACA,gBAAgB,WAAO;AACvB;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA,mBAAmB;;AAEnB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA,oBAAoB,iBAAQ;AAC5B,mBAAmB,iBAAQ;AAC3B,qBAAqB,iBAAQ;AAC7B,oBAAoB,iBAAQ;;AAE5B;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,kBAAkB,0DAA0D;;AAE5E;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,4BAA4B,sBAAsB;AAClD;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB,WAAO;;AAE3B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE,YAAY;AACd,aAAa,MAAM;AACnB,GAAG;AACH;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA,qBAAqB,iBAAQ;;AAE7B;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,uBAAY;;AAEZ,+CAAe,QAAQ,EAAC;;;ACjwCiB;AACT;;AAEhC;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB,cAAc,YAAY;AAC1B;AACA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB,YAAY,UAAU;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,WAAW,KAAK;AAChB,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,aAAa,YAAY;AACzB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA,OAAO,mDAAmD;AAC1D;;AAEA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA,OAAO,gBAAgB;AACvB;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,uBAAY;;;AAGZ,kDAAe,WAAW;;;AC3SnB;AACP;AACA;;AAEA,0CAAe;AACf;AACA,CAAC,EAAC;;;ACNF,+BAA+B;;AAE/B,6CAAe;AACf;AACA,CAAC,EAAC;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,MAAM;AACxB,mBAAmB,QAAQ;AAC3B;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,QAAQ;AACjD;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA,MAAM;AACN;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA,aAAa,YAAY;AACzB,aAAa;AACb;AACO;AACP,+BAA+B,MAAM,eAAe;AACpD;AACA;AACA,MAAM,aAAa;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,gBAAgB,QAAQ;AACxB;AACA,aAAa;AACb,aAAa;AACb,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,wCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;;;AC3HwB;AACM;;AAEvB;AACP;AACA;AACA,uBAAuB,iBAAiB;AACxC;;AAEA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,iBAAiB;;AAEzB;AACA;;AAEA;AACA;;AAEA;AACA,gBAAgB,iBAAiB;AACjC;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,wBAAwB,kBAAkB;AAC1C;AACA;AACA;AACA,0BAA0B,cAAQ;AAClC;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;;AAEO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;;AAEA,+CAA+C,SAAS;AACxD;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,+CAA+C,SAAS;AACxD;;AAEA,uBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;;;AAGA,uBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;;AAEA;AACA,kDAAkD;AAClD;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA,mCAAmC,WAAW;AAC9C,oCAAoC,YAAY;AAChD,sCAAsC,cAAc;AACpD,qCAAqC,aAAa;AAClD;;AAEA,SAAS,cAAQ;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;;;ACrPyC;AACqE;AAC1E;AACE;AACS;AACS;;AAExD,MAAM,iBAAU;AAChB;AACA,kBAAkB,eAAM;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,GAAG,eAAe;;AAElB,6BAA6B,aAAI;AACjC;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,qBAAqB,OAAO;;AAE5B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,gCAAgC;AAChC;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,uBAAuB,eAAM;;AAE7B;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;;;AAGA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,cAAc,MAAM;;;AAGpB;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL,IAAI;AACJ,cAAc,MAAM;AACpB;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA,cAAc,MAAM;AACpB,IAAI;;AAEJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,gBAAO;AACzB;;AAEA;AACA,mBAAmB,gBAAO;AAC1B,IAAI;AACJ,oBAAoB;AACpB;;AAEA,wBAAwB,iBAAQ;AAChC;AACA,4CAA4C;AAC5C;;AAEA,yBAAyB,iBAAQ;AACjC;AACA;AACA;;AAEA;AACA,IAAI,iBAAQ;AACZ,IAAI,iBAAQ;;AAEZ;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;;AAIA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,KAAK,iBAAQ;AACb;AACA;AACA;AACA;;AAEA,KAAK,iBAAQ;AACb;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA,YAAY,MAAM;;AAElB;;AAEA,uBAAuB,eAAM;;AAE7B;;;AAGA;AACA,oBAAoB,UAAK;AACzB;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,GAAG;;AAEH;AACA,kBAAkB,sBAAa;AAC/B;AACA;AACA,IAAI;AACJ,6FAA6F,EAAE;AAC/F;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,IAAI;;AAEJ;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA,sBAAsB,QAAQ;;AAE9B;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,sBAAsB,UAAK;;AAE3B;;AAEA;AACA;;AAEA,eAAe,MAAM;AACrB;;AAEA;AACA;;AAEA,KAAK;AACL;AACA,KAAK;;AAEL,IAAI;AACJ;AACA;;;AAGA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,wBAAwB,eAAM;AAC9B;;AAEA;AACA;;AAEA,4BAA4B,0CAA0C;AACtE;AACA;AACA;AACA,oCAAoC,sEAAsE;AAC1G;;AAEA;AACA,aAAa,MAAM;AACnB;;AAEA;;AAEA;AACA,mBAAmB,IAAI;AACvB;;AAEA,cAAc,SAAS;AACvB;;AAEA,gCAAgC;;AAEhC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,0CAA0C;AACtE;AACA;AACA;AACA,oCAAoC,yEAAyE;AAC7G;AACA;AACA,aAAa,MAAM;AACnB;;AAEA;;AAEA;AACA,mBAAmB,IAAI;AACvB;;AAEA,cAAc,SAAS;AACvB;;AAEA,gCAAgC;;AAEhC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa,MAAM;AACnB;;AAEA;AACA;AACA;AACA,IAAI,4BAA4B;AAChC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,2BAA2B;;AAE3B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,IAAI;AAC7B,0BAA0B,MAAM;AAChC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG,sBAAa;AAChB;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,uBAAY,CAAC,iBAAU;;AAEvB,6CAAe,iBAAU,EAAC;;;;;;ACvzB+C;AACnC;;AAEtC;AACA;AACA;AACA,kCAAkC,aAAI;;AAEtC;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,8BAA8B;AAC9B;AACA;AACA;AACA;;AAEA,uBAAuB,iBAAQ;AAC/B;AACA;;AAEA,sBAAsB,iBAAQ;AAC9B;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC;AACtC,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA,KAAK,kBAAS;AACd;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM,iBAAQ;AACd,KAAK,iBAAQ;AACb,qBAAqB,kBAAQ;AAC7B;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ,OAAO,iBAAQ;AACf;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,IAAI;AACJ,OAAO,iBAAQ;AACf;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM,iBAAQ;AACd;AACA,iCAAiC;AACjC;AACA;;AAEA,MAAM,iBAAQ;AACd;AACA;AACA,mCAAmC;AACnC;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sBAAsB,qBAAY;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU,qBAAY;AACtB,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA,GAAG;;AAEH,8CAA8C,cAAc;AAC5D;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,4CAAe,KAAK,EAAC;;;ACpYrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,kBAAkB,SAAS;AAC3B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,kBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,kBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4CAAe,KAAK,EAAC;;;ACtKoB;AAC8B;AACnC;AACE;AACD;AACA;AACU;;AAE/C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,KAAK;;AAEpB,kBAAkB,eAAM,oBAAoB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,EAAE,eAAM,sCAAsC;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,mBAAmB,KAAK;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA,mBAAmB,KAAK;;AAExB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA,OAAO,aAAa;;AAEpB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,MAAM;AACnB,GAAG;;AAEH;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,mBAAmB,qBAAY;AAC/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,YAAY,MAAM;AAClB;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;;AAEA,uBAAuB,UAAK;AAC5B;;AAEA;AACA,iCAAiC,iBAAQ;AACzC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;;AAEA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;;AAEA,IAAI;AACJ;AACA;AACA,MAAM;AACN;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,IAAI;;AAEJ;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA,IAAI;;AAEJ;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;;AAGA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA,IAAI;;AAEJ;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA,IAAI;;AAEJ;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA,IAAI;;AAEJ;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,QAAQ,aAAa;AACrB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,0BAA0B,cAAc;AACxC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,QAAQ,aAAa;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA,+BAA+B,cAAc;AAC7C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,iBAAiB;AACnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA,aAAa,MAAM;AACnB;AACA;AACA,IAAI;;AAEJ;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA,KAAK;AACL,IAAI;;;;AAIJ,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,2CAA2C,wCAAwC;;AAEnF;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,qBAAqB,WAAO;;AAE5B;;AAEA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,sBAAsB,WAAO;AAC7B;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,qBAAqB;AACrB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAY;;AAEZ,uDAAe,kBAAkB,EAAC;;;AC98B8C;AACrB;AAClB;;AAEzC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA,kBAAkB,eAAM;AACxB;AACA;AACA;AACA;AACA,GAAG,eAAe;;AAElB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,qEAAqE,eAAe;AACpF;;AAEA;AACA,mEAAmE,eAAe;AAClF;;AAEA;AACA,iEAAiE,eAAe;AAChF;;AAEA;AACA,kBAAkB,MAAM;AACxB;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,wEAAwE,eAAe;AACvF;AACA;;AAEA,sEAAsE,eAAe;AACrF;AACA;;AAEA,oEAAoE,eAAe;AACnF;AACA;;AAEA,mBAAmB,MAAM;AACzB;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,QAAQ,mBAAmB;;AAE3B;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,mBAAmB;AAC3B;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,uBAAuB,UAAK;AAC5B;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,uBAAY;;AAEZ,2CAAe,IAAI,EAAC;;;;;;ACjVkD;AAC1B;AACT;AACY;AACR;;AAEvC,oCAAoC,gBAAkB;AACtD;AACA;;AAEA;;AAEA,kBAAkB,eAAM,oBAAoB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,EAAE,eAAM,sCAAsC;;AAE9C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,SAAS,gBAAkB;AAC3B;AACA;AACA,IAAI;AACJ;;AAEA;AACA,0BAA0B,UAAK;;AAE/B;AACA;AACA,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA,UAAU,MAAM;AAChB;AACA;AACA,GAAG;;AAEH,UAAU,MAAM;AAChB;AACA,GAAG;;AAEH;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,UAAK;AAC1B;AACA,kBAAkB,iBAAiB;AACnC;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,MAAM;AACN;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;;AAEA;;AAEA;AACA,qBAAqB,UAAK;AAC1B;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,6BAA6B;;AAE7B;AACA,wCAAwC;;AAExC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;;AAEA;AACA,iBAAiB,UAAK;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB,oBAAoB;AACtC;AACA;;AAEA;AACA,kBAAkB,kBAAkB;AACpC;AACA;;AAEA;AACA;AACA;;AAEA,qBAAqB;;AAErB;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA,sBAAsB,IAAI;AAC1B;AACA;;AAEA;AACA;;AAEA,cAAc,0BAAqB;;AAEnC;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,kBAAQ;AAC3B;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,IAAI;AACJ;AACA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AEA;AACA,kBAAkB,MAAM;AACxB,kBAAkB,MAAM;;AAExB;AACA,kBAAkB,MAAM;;AAExB;AACA,kBAAkB,MAAM;;AAExB;AACA,kBAAkB,MAAM;;AAExB;AACA;AACA;AACA;AACA;AACA,YAAY,MAAM;;AAElB;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa;AACb;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA,aAAa,MAAM;;AAEnB,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,UAAK;AAC5B;AACA;AACA;;AAEA;;AAEA;AACA,sCAAsC,gBAAO;AAC7C;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA,cAAc,MAAM;AACpB;AACA,IAAI;AACJ;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA,cAAc,MAAM;AACpB,IAAI;;AAEJ;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;;AAEA,IAAI;AACJ;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;AACA,aAAa,GAAG;AAChB;AACA;;AAEA,UAAU,MAAM;;AAEhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,SAAS;AAC1B,iBAAiB,MAAM;AACvB;AACA;AACA,gBAAgB,MAAM;AACtB,MAAM;AACN,MAAM;AACN,eAAe,MAAM;AACrB;AACA,IAAI;;AAEJ;;AAEA;AACA;AACA;AACA,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS;AACvB,cAAc,MAAM;AACpB;AACA;AACA,aAAa,MAAM;AACnB,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA,sBAAsB,MAAM;AAC5B;;AAEA;;AAEA,mBAAmB,MAAM;AACzB,cAAc,MAAM;AACpB,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,KAAK;AAClB;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,gBAAgB,MAAM;AACtB;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP,gBAAgB,MAAM;AACtB,MAAM;AACN,MAAM;AACN;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,eAAe;AACf,mBAAmB,QAAQ;AAC3B,mBAAmB,QAAQ;AAC3B,mBAAmB,SAAS;AAC5B,mBAAmB,SAAS;AAC5B,mBAAmB,QAAQ;AAC3B;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA,MAAM;;AAEN;AACA;AACA,eAAe;AACf;AACA;AACA,eAAe,MAAM;AACrB;AACA,IAAI;AACJ,GAAG;AACH;;AAEA;AACA;AACA,aAAa,6BAA6B;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA,EAAE,UAAU;AACZ;AACA,GAAG;;AAEH,cAAc,MAAM;AACpB;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,UAAU;AACvB;AACA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB,aAAa,QAAQ;AACrB,aAAa,UAAU;AACvB;AACA;AACA,YAAY,MAAM;AAClB;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;;AAEA;AACA;AACA;AACA,aAAa,UAAU;AACvB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,uBAAY;;AAEZ,gDAAe,SAAS,EAAC;;;;;ACliCwB;AACX;AACD;AACL;;AAEhC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mBAAO,CAAC,IAAO;AAC/B;AACA,KAAK;AACL;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,SAAS;AACtB,aAAa,SAAS;AACtB;AACA;AACA,oCAAoC,mBAAmB;AACvD;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,SAAS;AACtB,aAAa,SAAS;AACtB;AACA;AACA,SAAS,sBAAO;AAChB;AACA,qCAAqC,mBAAmB;AACxD,IAAI;AACJ;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,qBAAqB,UAAK;AAC1B;AACA,iBAAiB,yBAAI;;AAErB;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,KAAK;AAClB,aAAa,QAAQ;AACrB,aAAa,KAAK;AAClB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK,cAAK;AACV,OAAO,cAAK;AACZ;AACA;AACA;AACA,OAAO,cAAK;AACZ;AACA;AACA;AACA,OAAO,cAAK;AACZ,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,+DAA+D;AAC/D;;AAEA;AACA,0BAA0B,qBAAW;AACrC;AACA,mCAAmC,gBAAgB;AACnD,IAAI;AACJ;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,+DAA+D;AAC/D;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA,+DAA+D;AAC/D;;AAEA;AACA,0BAA0B,qBAAW;AACrC;AACA,kCAAkC;AAClC,IAAI;AACJ;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa,SAAS;AACtB;AACA;AACA,qBAAqB,UAAK;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,KAAK;;AAEL;;AAEA,IAAI;;AAEJ;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,KAAK;;AAEL;AACA;;;AAGA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8CAAe,OAAO,EAAC;;;AClQ0B;AACP;AACL;AACL;AACS;;AAEzC;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA,gCAAgC,kBAAW;AAC3C;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,mBAAO,CAAC,IAAa;AACjC,KAAK;AACL;AACA;AACA;AACA;AACA,IAAI;AACJ,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,aAAa,WAAW;AACxB,aAAa,SAAS;AACtB,aAAa,iBAAiB;AAC9B;AACA;AACA;AACA,SAAS,OAAO;AAChB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA,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,UAAK;AACtB,cAAc,UAAK;AACnB,mBAAmB,UAAK;AACxB,iBAAiB,UAAK;AACtB,kBAAkB,UAAK;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAc,SAAS;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA,cAAc,QAAQ;AACtB;AACA;AACA;AACA,gDAAgD,kBAAO;;AAEvD;AACA,cAAc,OAAO;AACrB;AACA;AACA,mBAAmB,KAAK;;AAExB;AACA,cAAc,WAAW;AACzB;AACA;AACA,uBAAuB,SAAS;;AAEhC;AACA,cAAc,YAAY;AAC1B;AACA;AACA;;AAEA;AACA,cAAc,UAAU;AACxB;AACA;AACA;;AAEA;AACA,cAAc,KAAK;AACnB;AACA;AACA;AACA;;AAEA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;;AAEA;AACA,cAAc,SAAS;AACvB;AACA;AACA;AACA;;AAEA;AACA,cAAc,SAAS;AACvB;AACA;AACA;AACA;;AAEA;AACA,cAAc,OAAO;AACrB;AACA;AACA;AACA;;AAEA;AACA,cAAc,WAAW;AACzB;AACA;AACA;AACA;;AAEA;AACA,cAAc,WAAW;AACzB;AACA;AACA;AACA;;AAEA;AACA,cAAc,WAAW;AACzB;AACA;AACA;AACA;;AAEA;AACA,cAAc,WAAW;AACzB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,MAAM;AACpB,IAAI;AACJ;AACA;;AAEA;AACA;AACA,YAAY,sBAAsB;AAClC,YAAY,QAAQ;AACpB,cAAc,SAAS;AACvB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,SAAG;AACrB;AACA,IAAI;AACJ;AACA,kBAAkB,SAAG;AACrB;AACA,IAAI;AACJ;AACA,kBAAkB,SAAG;AACrB;AACA;AACA,IAAI;AACJ,kBAAkB,SAAG;AACrB;AACA,IAAI;AACJ,kBAAkB,SAAG;AACrB;AACA,IAAI;AACJ,kBAAkB,SAAG;AACrB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA,yBAAyB,SAAS;AAClC;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,kBAAkB,yBAAI;AACtB;AACA;AACA,yBAAyB,SAAS;AAClC;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,kBAAkB,yBAAI;AACtB;AACA;AACA,yBAAyB,SAAS;AAClC;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,SAAS;AACtB,aAAa,iBAAiB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,YAAY,SAAG;AACf;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,WAAW;AACvB;AACA;AACA,4BAA4B;;AAE5B;;AAEA,uBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ,IAAI;AACJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,YAAY,WAAW;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B,UAAU;;AAEpC;AACA,yBAAyB,QAAQ,sBAAsB;AACvD;;AAEA;AACA,IAAI;AACJ;;AAEA;AACA;AACA,0BAA0B,UAAU;AACpC,wBAAwB,QAAQ;;AAEhC;AACA,IAAI;AACJ;;AAEA,gBAAgB,yBAAI;AACpB;AACA;AACA,0BAA0B,UAAU;AACpC,wBAAwB,QAAQ;AAChC;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,kBAAkB;AAC/B,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,uBAAuB,SAAS;AAChC;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA,qBAAqB,OAAO;AAC5B;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB,aAAa,QAAQ;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,kBAAO;AACxD;AACA,qBAAqB,KAAK;AAC1B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,mBAAmB,SAAG;AACtB;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,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,IAAI02B,MAAM,GAAG12B,OAAO,CAAC02B,MAAR,IAAkB3gB,MAAM,CAACwkC,gBAAzB,IAA6C,QAA1D;EACA,IAAIC,WAAW,GAAGx6C,OAAO,CAACw6C,WAAR,IAAuBzkC,MAAM,CAAC0kC,qBAAhD;;EACA,IAAIC,KAAK,GAAG,IAAZ;;EACA,IAAIC,UAAU,GAAG53B,SAAjB;EAEA/iB,OAAO,CAAC02B,MAAR,GAAiBA,MAAjB;EACA12B,OAAO,CAACw6C,WAAR,GAAsBA,WAAtB;EAEA,OAAOJ,OAAO,CAAC1jB,MAAD,CAAP,CAAgB5T,KAAhB,CAAsB43B,KAAtB,EAA6B,CAACvoC,EAAD,EAAKnS,OAAL,CAA7B,CAAP;AACD,CAXM;;;;;;;;ACXM;;AAEb,sBAAsB,mBAAO,CAAC,IAAe;AAC7C,sBAAsB,mBAAO,CAAC,IAAwB;AACtD,sBAAsB,mBAAO,CAAC,IAAuB;AACrD,sBAAsB,mBAAO,CAAC,GAAkC;AAChE,sBAAsB,mBAAO,CAAC,GAA2B;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,UAAU;AACV;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,UAAU;AACV;AACA;;;;;;;;AC7DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,sBAAsB,oBAAoB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,gCAAgC;;AAEhC;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;AC1KA;AACA;;AAEA;AACA;AACa;AACb;AACA;AACA;AACA,uBAAuB,qBAAM;AAC7B;AACA,QAAQ,KAA0B;AAClC;AACA;AACA,MAAM,SAAS,IAA0C;AACzD;AACA,QAAQ,iCAAO,EAAE,oCAAE,OAAO;AAAA;AAAA;AAAA,kGAAC;AAC3B,MAAM,KAAK,EAGR;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA,YAAY;AACZ;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA,uCAAuC;AACvC,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,mBAAmB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA,cAAc;AACd;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvnBD;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACO;AACP;AACA;;AAEA;AACA,WAAW,KAAK;AAChB,aAAa;AACb;AACA;AACO;AACP;AACA;;AAEA;AACA,WAAW,KAAK;AAChB,aAAa;AACb;AACA;AACO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,gBAAgB,YAAY;AAC5B;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACO;AACP,4CAA4C,YAAY;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,eAAe;AACf;AACA;AACO;;AAEP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB,eAAe;AACf;AACA;AACO;;AAEP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,WAAW,MAAM;AACjB,aAAa;AACb;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;AACf;AACA;AACO;;AAEP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,MAAM;AACjB,WAAW,QAAQ;AACnB,YAAY,QAAQ;AACpB;AACA;AACO;AACP;AACA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,MAAM;AACjB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACO;AACP,6BAA6B,aAAa;AAC1C;;AAEA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,QAAQ;AACnB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,QAAQ;AACnB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,8BAA8B;;AAE9B;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa,QAAQ;AACrB;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,aAAa,UAAU;AACvB;AACA;AACO;AACP;AACA;;AAEA;AACA,WAAW,qCAA2B;AACtC,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,aAAa,SAAS;AACtB;AACA;AACO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,aAAa,WAAW;AACxB;AACA;AACO;;AAEP;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,aAAa,WAAW;AACxB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,UAAU;AACtB;AACO;AACP;AACA;AACA;AACA,GAAG;AACH;AACA,sCAAsC;AACtC;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,UAAU;AACtB,YAAY,mBAAmB;AAC/B;AACO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,MAAM;AACjB,WAAW,UAAU;AACrB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA,WAAW,MAAM;AACjB,aAAa;AACb;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;;;AAGA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA,YAAY,UAAU;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,UAAU;AACtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,aAAa,WAAW;AACxB;AACA;AACO;AACP;AACA;AACA,gCAAgC,QAAQ,WAAW,KAAK;AACxD;AACA;AACA;AACA;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,aAAa,WAAW;AACxB;AACA;AACO;AACP;AACA;AACA,iBAAiB,uBAAuB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,aAAa,WAAW;AACxB;AACA;AACO;AACP;AACA,QAAQ,MAAM;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,aAAa,WAAW;AACxB;AACA;AACO;AACP;AACA;AACA,iBAAiB,uBAAuB;AACxC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,aAAa,WAAW;AACxB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,kBAAkB,yBAAyB;AAC3C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;AC12BgC;;AAEhC;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc;AACd;AACA;AACA,SAAS,yDAAU;AACnB;;AAEA;AACA,YAAY,QAAQ;AACpB,cAAc;AACd;AACA;AACA,SAAS,8DAAe;AACxB;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA,SAAS,2DAAY;AACrB;;AAEA;AACA;AACA;AACA;AACA,YAAY,QAAQ;AACpB,cAAc,QAAQ;AACtB;AACA;AACA;;AAEA;AACA;AACA;;AAEA,SAAS,4DAAa;AACtB;;AAEA;AACA;AACA;;AAEA;AACA;AACA,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;;AAEA,iEAAe,IAAI,EAAC;;;;;;;;;;;;;;;ACrGuB;AACjB;;AAE1B;AACA,wEAAwE;AACxE;;AAEA,oBAAoB,wCAAK;;AAEzB;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,aAAa,sDAAI;AACjB;;AAEA;AACA;AACA;;;AAGA,IAAI,4CAAK;AACT;AACA,oCAAoC;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kEAAkE;AAClE;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,MAAM;AACN,OAAO,4CAAK;AACZ,0CAA0C;AAC1C;AACA,SAAS,4CAAK;AACd,KAAK;AACL;AACA,SAAS,4CAAK;AACd,KAAK;AACL;AACA,SAAS,4CAAK;AACd,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,KAAK;AACL;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA,iEAAe,OA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;AACA;AACA;;AAEA,CAAC,mBAAmB,qBAAM,mBAAmB,qBAAM,mFAAmF;AACtI,CAAC,GAAG;AACJ;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,CAAC,EAAE,MAAM;AACT;AACA;AACA;AACA;AACA;;AAEA,CAAC,mBAAmB,qBAAM,mBAAmB,qBAAM,mFAAmF;AACtI,CAAC,EAAE,MAAM;AACT;;AAEA,qGAAqG,qBAAqB,mBAAmB;;AAE7I,kDAAkD,0CAA0C;;AAE5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;;AAEA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,wBAAwB,kBAAkB;AAC1C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,sBAAsB;AACtB,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,qCAAqC,wBAAwB;AAC7D;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,oBAAoB,oBAAoB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,wBAAwB,oBAAoB;AAC5C;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,8BAA8B;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,wBAAwB,oBAAoB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;;AAEA;AACA;AACA;AACA;AACA,4BAA4B,oBAAoB;AAChD;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gCAAgC,oBAAoB;AACpD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA,oCAAoC,oBAAoB;AACxD;AACA;AACA;AACA,iBAAiB;AACjB,mGAAmG;AACnG;AACA,iBAAiB;AACjB,aAAa;AACb,UAAU;AACV;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,gCAAgC,oBAAoB;AACpD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA,oCAAoC,oBAAoB;AACxD;AACA;AACA;AACA;AACA,iBAAiB;AACjB,mGAAmG;AACnG;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,kBAAkB;AAClC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;;AAEA;AACA;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA,cAAc;AACd;AACA;AACA;;AAEA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,MAAM;AACN;AACA;AACA,UAAU;AACV;;AAEA;AACA;AACA;AACA;;AAEA;AACA,6DAA6D;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,gBAAgB;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,kBAAkB;AAClB;AACA;AACA,aAAa;AACb,UAAU;AACV;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,oCAAoC,YAAY;AAChD;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA,yBAAyB;AACzB;AACA,yBAAyB;AACzB,qBAAqB;AACrB,mDAAmD;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,oCAAoC,yBAAyB;AAC7D;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gCAAgC,yBAAyB;AACzD;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT;AACA,SAAS;AACT,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;;AAEA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,6BAA6B;AAC7B,yBAAyB;AACzB;;AAEA;AACA,2EAA2E,SAAS;AACpF;AACA;;AAEA;AACA;AACA,qBAAqB;AACrB;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,8CAA8C,QAAQ;AACtD;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,wBAAwB,YAAY;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,wBAAwB,YAAY;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT,kDAAkD,QAAQ;AAC1D;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA,oBAAoB,sBAAsB;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uCAAuC;AACvC,gCAAgC;AAChC;AACA;AACA;AACA;;AAEA;AACA,mEAAmE;AACnE;;AAEA,8CAA8C;AAC9C;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,8EAA8E;;AAE9E;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4DAA4D,SAAS;AACrE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0EAA0E,WAAW;AACrF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA,kBAAkB;AAClB;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,qDAAqD,SAAS;AAC9D;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;;AAED;AACA;;;AAGA;;AAEA;;AAEA,CAAC,EAAE,MAAM,EAAE,GAAG;AACd,CAAC;;;;;;;;AC/vFD,WAAW,mBAAO,CAAC,IAAS;;AAE5B;AACA;;AAEA;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,GAAG;AACd,WAAW,OAAO;AAClB,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACpBA,gBAAgB,mBAAO,CAAC,IAAc;AACtC,kBAAkB,mBAAO,CAAC,IAAe;AACzC,cAAc,mBAAO,CAAC,IAAW;AACjC,eAAe,mBAAO,CAAC,IAAY;AACnC,cAAc,mBAAO,CAAC,GAAY;AAClC,mBAAmB,mBAAO,CAAC,IAAgB;;AAE3C;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,SAAS;AACpB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AChDA,sBAAsB,mBAAO,CAAC,IAAoB;AAClD,SAAS,mBAAO,CAAC,IAAM;;AAEvB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,GAAG;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC3BA,qBAAqB,mBAAO,CAAC,IAAmB;;AAEhD;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,GAAG;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;;AAEA;;;;;;;;ACxBA,aAAa,mBAAO,CAAC,IAAW;AAChC,gBAAgB,mBAAO,CAAC,GAAc;AACtC,qBAAqB,mBAAO,CAAC,IAAmB;;AAEhD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC3BA,iBAAiB,mBAAO,CAAC,IAAe;AACxC,mBAAmB,mBAAO,CAAC,GAAgB;;AAE3C;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;;;;;;;;ACjBA,iBAAiB,mBAAO,CAAC,IAAc;AACvC,eAAe,mBAAO,CAAC,IAAa;AACpC,eAAe,mBAAO,CAAC,IAAY;AACnC,eAAe,mBAAO,CAAC,IAAa;;AAEpC;AACA;AACA;AACA;AACA,oCAAoC;;AAEpC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC9CA,iBAAiB,mBAAO,CAAC,IAAe;AACxC,eAAe,mBAAO,CAAC,GAAY;AACnC,mBAAmB,mBAAO,CAAC,GAAgB;;AAE3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC3DA,kBAAkB,mBAAO,CAAC,IAAgB;AAC1C,iBAAiB,mBAAO,CAAC,IAAe;;AAExC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC7BA,eAAe,mBAAO,CAAC,IAAY;AACnC,eAAe,mBAAO,CAAC,IAAa;AACpC,kBAAkB,mBAAO,CAAC,IAAgB;;AAE1C;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,aAAa,UAAU;AACvB;AACA;AACA;AACA;;AAEA;;;;;;;;AChBA,eAAe,mBAAO,CAAC,IAAY;AACnC,qBAAqB,mBAAO,CAAC,IAAmB;AAChD,eAAe,mBAAO,CAAC,IAAY;;AAEnC;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACnBA,sBAAsB,mBAAO,CAAC,IAAoB;;AAElD;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AClBA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACbA,kBAAkB,mBAAO,CAAC,IAAgB;AAC1C,sBAAsB,mBAAO,CAAC,IAAoB;;AAElD;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,OAAO;AAClB,WAAW,QAAQ,UAAU;AAC7B,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA,wBAAwB;;AAExB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACvCA,WAAW,mBAAO,CAAC,IAAS;;AAE5B;AACA;;AAEA;;;;;;;;ACLA,eAAe,mBAAO,CAAC,IAAa;AACpC,qBAAqB,mBAAO,CAAC,IAAmB;;AAEhD;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;;;;;;;;ACpCA,gBAAgB,mBAAO,CAAC,IAAc;;AAEtC;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA,IAAI;AACJ,CAAC;;AAED;;;;;;;;ACVA;AACA,wBAAwB,qBAAM,gBAAgB,qBAAM,IAAI,qBAAM,sBAAsB,qBAAM;;AAE1F;;;;;;;;ACHA,mBAAmB,mBAAO,CAAC,IAAiB;AAC5C,eAAe,mBAAO,CAAC,GAAa;;AAEpC;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AChBA,aAAa,mBAAO,CAAC,IAAW;;AAEhC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC7CA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,aAAa,GAAG;AAChB;AACA;AACA;AACA;;AAEA;;;;;;;;ACZA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,QAAQ;AACnB,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACxBA,SAAS,mBAAO,CAAC,IAAM;AACvB,kBAAkB,mBAAO,CAAC,IAAe;AACzC,cAAc,mBAAO,CAAC,GAAY;AAClC,eAAe,mBAAO,CAAC,IAAY;;AAEnC;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,GAAG;AACd,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC7BA,iBAAiB,mBAAO,CAAC,IAAe;;AAExC;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;;;;;;;;ACnBA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;ACjBA,cAAc,mBAAO,CAAC,IAAY;;AAElC;AACA;;AAEA;;;;;;;;;ACLA,iBAAiB,mBAAO,CAAC,IAAe;;AAExC;AACA,kBAAkB,KAA0B;;AAE5C;AACA,gCAAgC,QAAa;;AAE7C;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ,CAAC;;AAED;;;;;;;;AC7BA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;;;;;;;ACrBA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACdA,YAAY,mBAAO,CAAC,IAAU;;AAE9B;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACnCA,iBAAiB,mBAAO,CAAC,IAAe;;AAExC;AACA;;AAEA;AACA;;AAEA;;;;;;;;ACRA,sBAAsB,mBAAO,CAAC,IAAoB;AAClD,eAAe,mBAAO,CAAC,IAAa;;AAEpC;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;;AAEA;;;;;;;;ACbA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,aAAa,UAAU;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACpCA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;;;;;;;;ACzBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa,QAAQ;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;;AClBA,kBAAkB,mBAAO,CAAC,IAAgB;AAC1C,iBAAiB,mBAAO,CAAC,IAAe;AACxC,qBAAqB,mBAAO,CAAC,GAAmB;AAChD,kBAAkB,mBAAO,CAAC,IAAe;AACzC,kBAAkB,mBAAO,CAAC,IAAgB;AAC1C,WAAW,mBAAO,CAAC,IAAQ;;AAE3B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,WAAW;AACtB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,QAAQ;AACtB,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;;;;;;;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,UAAU;AACvB;AACA;AACA,yCAAyC,QAAQ;AACjD;AACA;AACA,YAAY,QAAQ,IAAI,QAAQ;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACzBA,eAAe,mBAAO,CAAC,IAAY;AACnC,UAAU,mBAAO,CAAC,GAAO;AACzB,eAAe,mBAAO,CAAC,IAAY;;AAEnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,WAAW,QAAQ,WAAW;AAC9B,WAAW,SAAS;AACpB;AACA,WAAW,QAAQ;AACnB;AACA,WAAW,SAAS;AACpB;AACA,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,+CAA+C,iBAAiB;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC9LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,kBAAkB;AAClB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,GAAG;AAChB;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACpBA,sBAAsB,mBAAO,CAAC,IAAoB;AAClD,mBAAmB,mBAAO,CAAC,GAAgB;;AAE3C;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA,8BAA8B,mBAAmB;AACjD;AACA;AACA;AACA;AACA;AACA,+CAA+C,mBAAmB;AAClE;AACA;AACA;;AAEA;;;;;;;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACzBA,iBAAiB,mBAAO,CAAC,IAAc;AACvC,eAAe,mBAAO,CAAC,GAAY;;AAEnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;AChCA,WAAW,mBAAO,CAAC,IAAS;AAC5B,gBAAgB,mBAAO,CAAC,IAAa;;AAErC;AACA,kBAAkB,KAA0B;;AAE5C;AACA,gCAAgC,QAAa;;AAE7C;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACrCA,iBAAiB,mBAAO,CAAC,IAAe;AACxC,eAAe,mBAAO,CAAC,IAAY;;AAEnC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACpCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC5BA,iBAAiB,mBAAO,CAAC,IAAe;AACxC,mBAAmB,mBAAO,CAAC,GAAgB;;AAE3C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC5BA,uBAAuB,mBAAO,CAAC,IAAqB;AACpD,gBAAgB,mBAAO,CAAC,IAAc;AACtC,eAAe,mBAAO,CAAC,IAAa;;AAEpC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC1BA,oBAAoB,mBAAO,CAAC,GAAkB;AAC9C,eAAe,mBAAO,CAAC,IAAa;AACpC,kBAAkB,mBAAO,CAAC,IAAe;;AAEzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACpCA,WAAW,mBAAO,CAAC,IAAS;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACjBA,eAAe,mBAAO,CAAC,IAAY;AACnC,eAAe,mBAAO,CAAC,IAAY;;AAEnC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,WAAW,QAAQ,WAAW;AAC9B,WAAW,SAAS;AACpB;AACA,WAAW,SAAS;AACpB;AACA,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,mBAAmB;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;;;;;;;;ACpEA,eAAe,mBAAO,CAAC,IAAa;AACpC,eAAe,mBAAO,CAAC,IAAY;AACnC,eAAe,mBAAO,CAAC,IAAY;;AAEnC;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;AC/Da;;AAEb;AACA;AACA,0BAA0B;AAC1B;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,QAAQ;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,uCAAuC,8BAA8B;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA,oBAAoB,sBAAsB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,yBAAyB;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,qBAAqB;AAChC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,aAAa;AACxB;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,YAAY;AACZ;AACA,sCAAsC;AACtC;AACA;AACA,UAAU;AACV;AACA;AACA,iDAAiD;AACjD;AACA,YAAY;AACZ;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,4CAA4C,cAAc;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,QAAQ;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gCAAgC,QAAQ;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,gCAAgC,QAAQ;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,QAAQ;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;;AAGA;;;;;;;;;ACziBa;;AAEb,kBAAkB,mBAAO,CAAC,IAAiB;;AAE3C;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;;;;;;;;AClBa;;AAEb,cAAc,mBAAO,CAAC,IAAa;;AAEnC;AACA,sBAAsB;;AAEtB;AACA;AACA;AACA;;;;;;;;;ACVa;;AAEb,iBAAiB,mBAAO,CAAC,IAAgB;;AAEzC,4BAA4B,EAAE;;AAE9B;AACA;AACA;AACA;AACA;;;;;;;;;ACVa;;AAEb,eAAe,mBAAO,CAAC,GAAc;;AAErC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;;ACZa;;AAEb;AACA;;AAEA,oCAAoC;;;;;;;;;ACLpC;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCzBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;WCNA;WACA;WACA;WACA;WACA;;;;;;;;;;;;;;;;;;;ACHA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA,IAAI46C,OAAO,GAAG7kC,MAAM,CAACoO,IAArB;AACO,SAAS02B,UAAT,GAAsB;EAC3B9kC,MAAM,CAACoO,IAAP,GAAcy2B,OAAd;EACA,OAAO,IAAP;AACD;AAID,IAAIz2B,SAAI,GAAG,EAAX,EACA;;AAEA;;AACA,IAAI5hB,OAAO,GAAGw4C,mBAAO,CAAC,IAAD,CAArB;;AACA,IAAIC,IAAI,GAAGD,mBAAO,CAAC,IAAD,CAAlB;;AACA,IAAIE,GAAG,GAAGF,mBAAO,CAAC,IAAD,CAAjB;;AACA,IAAIh6C,WAAM,GAAGg6C,mBAAO,CAAC,IAAD,CAApB;;AAEA,CAAEx4C,OAAF,EAAWy4C,IAAX,EAAiBC,GAAjB,EAAsBl6C,WAAtB,EAA+B0I,OAA/B,CAAuC,UAACy9B,CAAD,EAAO;EAC5C78B,MAAM,CAACC,IAAP,CAAY48B,CAAZ,EAAez9B,OAAf,CAAuB,UAACe,GAAD,EAAS;IAC9B2Z,SAAI,CAAC3Z,GAAD,CAAJ,GAAY08B,CAAC,CAAC18B,GAAD,CAAb;EACD,CAFD;AAGD,CAJD;AAMA,+CAAe2Z,SAAf,E","sources":["webpack://cozy/webpack/universalModuleDefinition","webpack://cozy/./src/control/Control.js","webpack://cozy/./src/control/Control.Paging.js","webpack://cozy/./src/control/Modal.js","webpack://cozy/./src/control/Control.Contents.js","webpack://cozy/./src/control/Control.Title.js","webpack://cozy/./src/control/Control.PublicationMetadata.js","webpack://cozy/./src/control/Control.Preferences.js","webpack://cozy/./src/control/Control.Widget.js","webpack://cozy/./src/control/Control.Citation.js","webpack://cozy/./src/control/Control.Search.js","webpack://cozy/./src/control/Control.BibliographicInformation.js","webpack://cozy/./src/control/Control.Download.js","webpack://cozy/./src/control/Control.Navigator.js","webpack://cozy/./src/control/Control.Fullscreen.js","webpack://cozy/./src/control/index.js","webpack://cozy/./src/core/Browser.js","webpack://cozy/./src/core/Class.js","webpack://cozy/./src/core/Events.js","webpack://cozy/./src/core/Util.js","webpack://cozy/./src/core/Bus.js","webpack://cozy/./src/core/index.js","webpack://cozy/./src/dom/DomEvent.Pointer.js","webpack://cozy/./src/dom/DomEvent.DoubleTap.js","webpack://cozy/./src/dom/DomEvent.js","webpack://cozy/./src/dom/DomUtil.js","webpack://cozy/./src/dom/index.js","webpack://cozy/./src/geometry/Point.js","webpack://cozy/./src/screenfull.js","webpack://cozy/./src/reader/Reader.js","webpack://cozy/./node_modules/epubjs/src/utils/url.js","webpack://cozy/./node_modules/epubjs/src/epubcfi.js","webpack://cozy/./node_modules/epubjs/src/utils/hook.js","webpack://cozy/./node_modules/epubjs/src/utils/replacements.js","webpack://cozy/./node_modules/epubjs/src/section.js","webpack://cozy/./node_modules/epubjs/src/spine.js","webpack://cozy/./node_modules/epubjs/src/utils/queue.js","webpack://cozy/./node_modules/epubjs/src/utils/constants.js","webpack://cozy/./node_modules/epubjs/src/locations.js","webpack://cozy/./node_modules/epubjs/src/container.js","webpack://cozy/./node_modules/epubjs/src/packaging.js","webpack://cozy/./node_modules/epubjs/src/navigation.js","webpack://cozy/./node_modules/epubjs/src/resources.js","webpack://cozy/./node_modules/epubjs/src/pagelist.js","webpack://cozy/./node_modules/epubjs/src/layout.js","webpack://cozy/./node_modules/epubjs/src/themes.js","webpack://cozy/./node_modules/epubjs/src/mapping.js","webpack://cozy/./node_modules/epubjs/src/contents.js","webpack://cozy/./node_modules/epubjs/src/annotations.js","webpack://cozy/./node_modules/marks-pane/src/svg.js","webpack://cozy/./node_modules/marks-pane/src/events.js","webpack://cozy/./node_modules/marks-pane/src/marks.js","webpack://cozy/./node_modules/epubjs/src/managers/views/iframe.js","webpack://cozy/./node_modules/epubjs/src/managers/helpers/stage.js","webpack://cozy/./node_modules/epubjs/src/managers/helpers/views.js","webpack://cozy/./node_modules/epubjs/src/managers/default/index.js","webpack://cozy/./node_modules/epubjs/src/managers/helpers/snap.js","webpack://cozy/./node_modules/epubjs/src/managers/continuous/index.js","webpack://cozy/./node_modules/epubjs/src/rendition.js","webpack://cozy/./node_modules/epubjs/src/archive.js","webpack://cozy/./node_modules/epubjs/src/store.js","webpack://cozy/./node_modules/epubjs/src/book.js","webpack://cozy/./node_modules/epubjs/src/epub.js","webpack://cozy/./node_modules/epubjs/src/index.js","webpack://cozy/./src/epubjs/managers/helpers/prefab.js","webpack://cozy/./src/epubjs/managers/continuous/prepaginated.js","webpack://cozy/./src/epubjs/managers/views/iframe.js","webpack://cozy/./src/epubjs/managers/helpers/scrolling_views.js","webpack://cozy/./src/epubjs/managers/continuous/scrolling.js","webpack://cozy/./src/epubjs/managers/views/sticky.js","webpack://cozy/./src/utils/manglers.js","webpack://cozy/./src/utils/focus.js","webpack://cozy/./src/reader/Reader.EpubJS.js","webpack://cozy/./src/reader/Reader.Mock.js","webpack://cozy/./src/reader/index.js","webpack://cozy/./node_modules/d/index.js","webpack://cozy/./node_modules/epubjs/libs/mime/mime.js","webpack://cozy/./node_modules/epubjs/libs/url/url-polyfill.js","webpack://cozy/./node_modules/epubjs/src/utils/core.js","webpack://cozy/./node_modules/epubjs/src/utils/path.js","webpack://cozy/./node_modules/epubjs/src/utils/request.js","webpack://cozy/./node_modules/es5-ext/function/noop.js","webpack://cozy/./node_modules/es5-ext/object/assign/index.js","webpack://cozy/./node_modules/es5-ext/object/assign/is-implemented.js","webpack://cozy/./node_modules/es5-ext/object/assign/shim.js","webpack://cozy/./node_modules/es5-ext/object/is-value.js","webpack://cozy/./node_modules/es5-ext/object/keys/index.js","webpack://cozy/./node_modules/es5-ext/object/keys/is-implemented.js","webpack://cozy/./node_modules/es5-ext/object/keys/shim.js","webpack://cozy/./node_modules/es5-ext/object/normalize-options.js","webpack://cozy/./node_modules/es5-ext/object/valid-callable.js","webpack://cozy/./node_modules/es5-ext/object/valid-value.js","webpack://cozy/./node_modules/es5-ext/string/\u0000#/contains/index.js","webpack://cozy/./node_modules/es5-ext/string/\u0000#/contains/is-implemented.js","webpack://cozy/./node_modules/es5-ext/string/\u0000#/contains/shim.js","webpack://cozy/./node_modules/event-emitter/index.js","webpack://cozy/./node_modules/jszip/dist/jszip.min.js","webpack://cozy/./node_modules/localforage/dist/localforage.js","webpack://cozy/./node_modules/lodash/_Symbol.js","webpack://cozy/./node_modules/lodash/_apply.js","webpack://cozy/./node_modules/lodash/_arrayLikeKeys.js","webpack://cozy/./node_modules/lodash/_assignValue.js","webpack://cozy/./node_modules/lodash/_baseAssignValue.js","webpack://cozy/./node_modules/lodash/_baseGetTag.js","webpack://cozy/./node_modules/lodash/_baseIsArguments.js","webpack://cozy/./node_modules/lodash/_baseIsNative.js","webpack://cozy/./node_modules/lodash/_baseIsTypedArray.js","webpack://cozy/./node_modules/lodash/_baseKeys.js","webpack://cozy/./node_modules/lodash/_baseRest.js","webpack://cozy/./node_modules/lodash/_baseSetToString.js","webpack://cozy/./node_modules/lodash/_baseTimes.js","webpack://cozy/./node_modules/lodash/_baseTrim.js","webpack://cozy/./node_modules/lodash/_baseUnary.js","webpack://cozy/./node_modules/lodash/_copyObject.js","webpack://cozy/./node_modules/lodash/_coreJsData.js","webpack://cozy/./node_modules/lodash/_createAssigner.js","webpack://cozy/./node_modules/lodash/_defineProperty.js","webpack://cozy/./node_modules/lodash/_freeGlobal.js","webpack://cozy/./node_modules/lodash/_getNative.js","webpack://cozy/./node_modules/lodash/_getRawTag.js","webpack://cozy/./node_modules/lodash/_getValue.js","webpack://cozy/./node_modules/lodash/_isIndex.js","webpack://cozy/./node_modules/lodash/_isIterateeCall.js","webpack://cozy/./node_modules/lodash/_isMasked.js","webpack://cozy/./node_modules/lodash/_isPrototype.js","webpack://cozy/./node_modules/lodash/_nativeKeys.js","webpack://cozy/./node_modules/lodash/_nodeUtil.js","webpack://cozy/./node_modules/lodash/_objectToString.js","webpack://cozy/./node_modules/lodash/_overArg.js","webpack://cozy/./node_modules/lodash/_overRest.js","webpack://cozy/./node_modules/lodash/_root.js","webpack://cozy/./node_modules/lodash/_setToString.js","webpack://cozy/./node_modules/lodash/_shortOut.js","webpack://cozy/./node_modules/lodash/_toSource.js","webpack://cozy/./node_modules/lodash/_trimmedEndIndex.js","webpack://cozy/./node_modules/lodash/assign.js","webpack://cozy/./node_modules/lodash/constant.js","webpack://cozy/./node_modules/lodash/debounce.js","webpack://cozy/./node_modules/lodash/eq.js","webpack://cozy/./node_modules/lodash/identity.js","webpack://cozy/./node_modules/lodash/isArguments.js","webpack://cozy/./node_modules/lodash/isArray.js","webpack://cozy/./node_modules/lodash/isArrayLike.js","webpack://cozy/./node_modules/lodash/isBuffer.js","webpack://cozy/./node_modules/lodash/isFunction.js","webpack://cozy/./node_modules/lodash/isLength.js","webpack://cozy/./node_modules/lodash/isObject.js","webpack://cozy/./node_modules/lodash/isObjectLike.js","webpack://cozy/./node_modules/lodash/isSymbol.js","webpack://cozy/./node_modules/lodash/isTypedArray.js","webpack://cozy/./node_modules/lodash/keys.js","webpack://cozy/./node_modules/lodash/now.js","webpack://cozy/./node_modules/lodash/stubFalse.js","webpack://cozy/./node_modules/lodash/throttle.js","webpack://cozy/./node_modules/lodash/toNumber.js","webpack://cozy/./node_modules/path-webpack/path.js","webpack://cozy/./node_modules/type/function/is.js","webpack://cozy/./node_modules/type/object/is.js","webpack://cozy/./node_modules/type/plain-function/is.js","webpack://cozy/./node_modules/type/prototype/is.js","webpack://cozy/./node_modules/type/value/is.js","webpack://cozy/external umd \"xmldom\"","webpack://cozy/webpack/bootstrap","webpack://cozy/webpack/runtime/compat get default export","webpack://cozy/webpack/runtime/define property getters","webpack://cozy/webpack/runtime/global","webpack://cozy/webpack/runtime/hasOwnProperty shorthand","webpack://cozy/webpack/runtime/make namespace object","webpack://cozy/webpack/runtime/node module decorator","webpack://cozy/./src/cozy.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"xmldom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"xmldom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cozy\"] = factory(require(\"xmldom\"));\n\telse\n\t\troot[\"cozy\"] = factory(root[\"xmldom\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__3787__) => {\nreturn ","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\n\n/*\n * @class Control\n * @aka L.Control\n * @inherits Class\n *\n * L.Control is a base class for implementing reader controls. Handles regioning.\n * All other controls extend from this class.\n */\n\nexport var Control = Class.extend({\n    // @section\n    // @aka Control options\n    options: {\n        // @option region: String = 'topright'\n        // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n        // `'topright'`, `'bottomleft'` or `'bottomright'`\n    },\n\n    initialize: function (options) {\n        Util.setOptions(this, options);\n        if ( options.container ) {\n            this._container = options.container;\n            this._locked = true;\n        }\n        this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    },\n\n    /* @section\n     * Classes extending L.Control will inherit the following methods:\n     *\n     * @method getRegion: string\n     * Returns the region of the control.\n     */\n    getRegion: function () {\n        return this.options.region;\n    },\n\n    // @method setRegion(region: string): this\n    // Sets the region of the control.\n    setRegion: function (region) {\n        var reader = this._reader;\n\n        if (reader) {\n            reader.removeControl(this);\n        }\n\n        this.options.region = region;\n\n        if (reader) {\n            reader.addControl(this);\n        }\n\n        return this;\n    },\n\n    // @method getContainer: HTMLElement\n    // Returns the HTMLElement that contains the control.\n    getContainer: function () {\n        return this._container;\n    },\n\n    // @method addTo(reader: Map): this\n    // Adds the control to the given reader.\n    addTo: function (reader) {\n        this.remove();\n        this._reader = reader;\n\n        var container = this._container = this.onAdd(reader);\n\n        DomUtil.addClass(container, 'cozy-control');\n\n        if ( ! this._locked ) {\n            var region = this.getRegion();\n            var area = reader.getControlRegion(region);\n            area.appendChild(container);\n        }\n\n        return this;\n    },\n\n    // @method remove: this\n    // Removes the control from the reader it is currently active on.\n    remove: function () {\n        if (!this._reader) {\n            return this;\n        }\n\n        if (! this._container) {\n            return this;\n        }\n\n        if ( ! this._locked ) {\n            DomUtil.remove(this._container);\n        }\n\n        if (this.onRemove) {\n            this.onRemove(this._reader);\n        }\n\n        this._reader = null;\n\n        return this;\n    },\n\n    _refocusOnMap: function (e) {\n        // if reader exists and event is not a keyboard event\n        if (this._reader && e && e.screenX > 0 && e.screenY > 0) {\n            this._reader.getContainer().focus();\n        }\n    },\n\n    _className: function(widget) {\n        var className = [ 'cozy-control' ];\n        if ( this.options.direction ) {\n            className.push('cozy-control-' + this.options.direction);\n        }\n        if ( widget ) {\n            className.push('cozy-control-' + widget);\n        }\n        return className.join(' ');\n    }\n});\n\nexport var control = function (options) {\n    return new Control(options);\n};\n\n/* @section Extension methods\n * @uninheritable\n *\n * Every control should extend from `L.Control` and (re-)implement the following methods.\n *\n * @method onAdd(reader: Map): HTMLElement\n * Should return the container DOM element for the control and add listeners on relevant reader events. Called on [`control.addTo(reader)`](#control-addTo).\n *\n * @method onRemove(reader: Map)\n * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).\n */\n\n/* @namespace Map\n * @section Methods for Layers and Controls\n */\nReader.include({\n    // @method addControl(control: Control): this\n    // Adds the given control to the reader\n    addControl: function (control) {\n        control.addTo(this);\n        return this;\n    },\n\n    // @method removeControl(control: Control): this\n    // Removes the given control from the reader\n    removeControl: function (control) {\n        control.remove();\n        return this;\n    },\n\n    getControlContainer: function() {\n        var l = 'cozy-';\n        if ( ! this._controlContainer ) {\n            this._controlContainer =\n                DomUtil.create('div', l + 'control-container', this._container);\n        }\n        return this._controlContainer;\n    },\n\n    getControlRegion: function (target) {\n\n        if ( ! this._panes[target] ) {\n            // target is dot-delimited string\n            // first dot is the panel\n            var parts = target.split('.');\n            var tmp = [];\n            var parent = this._container;\n            var x = 0;\n            while ( parts.length ) {\n                var slug = parts.shift();\n                tmp.push(slug);\n                var panel = tmp.join(\".\");\n                var className = 'cozy-panel-' + slug;\n                if ( ! this._panes[panel] ) {\n                    this._panes[panel] = DomUtil.create('div', className, parent);\n                }\n                parent = this._panes[panel];\n                x += 1;\n                if ( x > 100 ) { break; }\n            }\n        }\n        return this._panes[target];\n    },\n\n    getControlRegion_1: function (target) {\n\n        var tmp = target.split('.');\n        var region = tmp.shift();\n        var slot = tmp.pop() || '-slot';\n\n        var container = this._panes[region];\n        if ( ! this._panes[target] ) {\n            var className = 'cozy-' + region + '--item cozy-slot-' + slot\n            if ( ! this._panes[region + '.' + slot] ) {\n                var div = DomUtil.create('div', className);\n                if ( slot == 'left' || slot == 'bottom' ) {\n                    var childElement = this._panes[region].firstChild;\n                    this._panes[region].insertBefore(div, childElement);\n                } else {\n                    this._panes[region].appendChild(div);\n                }\n                this._panes[region + '.' + slot] = div;\n            }\n            className = this._classify(tmp);\n            this._panes[target] = DomUtil.create('div', className, this._panes[region + '.' + slot]);\n        }\n\n        return this._panes[target];\n    },\n\n    _classify: function(tmp) {\n        var l = 'cozy-';\n        var className = [];\n        for(var i in tmp) {\n            className.push(l + tmp[i]);\n        }\n        className = className.join(' ');\n        return className;\n    },\n\n    _clearControlRegion: function () {\n        for (var i in this._controlRegions) {\n            DomUtil.remove(this._controlRegions[i]);\n        }\n        DomUtil.remove(this._controlContainer);\n        delete this._controlRegions;\n        delete this._controlContainer;\n    }\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nvar PageControl = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n      container = DomUtil.create('div', className),\n\n      this._control  = this._createButton(this._fill(options.html || options.label), this._fill(options.label),\n              className, container);\n    }\n    this._bindEvents();\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    return link;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    DomEvent.disableClickPropagation(this._control);\n    DomEvent.on(this._control, 'click', DomEvent.stop);\n    DomEvent.on(this._control, 'click', this._action, this);\n\n    this._reader.on('reopen', function(data) {\n      // update the button text / titles\n      var html = self.options.html || self.options.label;\n      self._control.innerHTML = self._fill(html);\n      self._control.setAttribute('title', self._fill(self.options.label));\n      self._control.setAttribute('aria-label', self._fill(self.options.label));\n    });\n\n  },\n\n  _unit: function() {\n    return ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  _fill: function(s) {\n    var unit = this._unit();\n    return s.replace(/\\$\\{unit\\}/g, unit);\n  },\n\n  _label: function() {\n    return this.options.label + \" \" + ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  EOT: true\n});\n\nexport var PagePrevious = PageControl.extend({\n  options: {\n    region: 'edge.left',\n    direction: 'previous',\n    label: 'Previous ${unit}',\n    html: '<i class=\"icon-chevron-left oi\" data-glyph=\"chevron-left\" title=\"Previous ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.prev();\n  }\n});\n\nexport var PageNext = PageControl.extend({\n  options: {\n    region: 'edge.right',\n    direction: 'next',\n    label: 'Next ${unit}',\n    html: '<i class=\"icon-chevron-right oi\" data-glyph=\"chevron-right\" title=\"Next ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.next();\n  }\n});\n\nexport var PageFirst = PageControl.extend({\n  options: {\n    direction: 'first',\n    label: 'First ${unit}'\n  },\n  _action: function(e) {\n      this._reader.first();\n  }\n});\n\nexport var PageLast = PageControl.extend({\n  options: {\n    direction: 'last',\n    label: 'Last ${unit}'\n  },\n  _action: function(e) {\n      this._reader.last();\n  }\n});\n\nexport var pageNext = function(options) {\n  return new PageNext(options);\n}\n\nexport var pagePrevious = function(options) {\n  return new PagePrevious(options);\n}\n\nexport var pageFirst = function(options) {\n  return new PageFirst(options);\n}\n\nexport var pageLast = function(options) {\n  return new PageLast(options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nimport assign from 'lodash/assign';\n\nvar activeModal;\nvar dismissModalListener = false;\n\n// from https://github.com/ghosh/micromodal/blob/master/src/index.js\nconst FOCUSABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'iframe',\n    'object',\n    'embed',\n    '[contenteditable]',\n    '[tabindex]:not([tabindex^=\"-\"])'\n  ];\n\nconst ACTIONABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input[type=\"submit\"]:not([disabled])',\n    'button:not([disabled])'\n  ];\n\nexport var Modal = Class.extend({\n  options: {\n    // @option region: String = 'topright'\n    // The region of the control (one of the reader edges). Possible values are `'left' ad 'right'`\n    region: 'left',\n    fraction: 0,\n    width: null,\n    className: {},\n    actions: null,\n    callbacks: { onShow: function() {}, onClose: function() {} },\n    handlers: {}\n  },\n\n  initialize: function (options) {\n    options = Util.setOptions(this, options);\n    this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    this._initializedEvents = false;\n    this.callbacks = assign({}, this.options.callbacks);\n    this.actions = this.options.actions ? assign({}, this.options.actions) : null;\n    this.handlers = assign({}, this.options.handlers);\n    if ( typeof(this.options.className) == 'string' ) {\n      this.options.className = { container: this.options.className };\n    }\n  },\n\n  addTo: function(reader) {\n    var self = this;\n    this._reader = reader;\n    var template = this.options.template;\n\n    var panelHTML = `<div class=\"cozy-modal modal-slide ${this.options.region || 'left'}\" id=\"modal-${this._id}\" aria-labelledby=\"modal-${this._id}-title\" role=\"dialog\" aria-describedby=\"modal-${this._id}-content\" aria-hidden=\"true\">\n      <div class=\"modal__overlay\" tabindex=\"-1\" data-modal-close>\n        <div class=\"modal__container ${this.options.className.container ? this.options.className.container : ''}\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-${this._id}-title\" aria-describedby=\"modal-${this._id}-content\" id=\"modal-${this._id}-container\">\n          <div role=\"document\">\n            <header class=\"modal__header\">\n              <h3 class=\"modal__title\" id=\"modal-${this._id}-title\">${this.options.title}</h3>\n              <button class=\"modal__close\" aria-label=\"Close modal\" aria-controls=\"modal-${this._id}-container\" data-modal-close></button>\n            </header>\n            <main class=\"modal__content ${this.options.className.main ? this.options.className.main : ''}\" id=\"modal-${this._id}-content\">\n              ${template}\n            </main>`;\n\n    if ( this.options.actions ) {\n      panelHTML += '<footer class=\"modal__footer\">'\n      for(var i in this.options.actions) {\n        var action = this.options.actions[i];\n        var button_cls = action.className || 'button--default';\n        panelHTML += `<button id=\"action-${this._id}-${i}\" class=\"button button--inline ${button_cls}\">${action.label}</button>`;\n      }\n      panelHTML += '</footer>';\n    }\n\n    panelHTML += '</div></div></div></div>';\n\n    var body = new DOMParser().parseFromString(panelHTML, \"text/html\").body;\n\n    this.modal = reader._container.appendChild(body.children[0]);\n    this._container = this.modal; // compatibility\n\n    this.container = this.modal.querySelector('.modal__container');\n    this._bindEvents();\n    return this;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    this.onClick = this.onClick.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n    this.onModalTransition = this.onModalTransition.bind(this);\n\n    this.modal.addEventListener('transitionend', function() {\n    }.bind(this));\n\n    // bind any actions\n    if ( this.actions ) {\n      for(var i in this.actions) {\n        let action = this.actions[i];\n        let button_id = '#action-' + this._id + '-' + i;\n        let button = this.modal.querySelector(button_id);\n        if ( button ) {\n          DomEvent.on(button, 'click', function(event) {\n            event.preventDefault();\n            action.callback(event);\n            if ( action.close ) {\n              self.closeModal();\n            }\n          })\n        }\n      }\n    }\n  },\n\n  deactivate: function() {\n    this.closeModal();\n  },\n\n  closeModal: function() {\n    var self = this;\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.removeEventListeners();\n    if ( this.activeElement ) {\n      this.activeElement.focus();\n    }\n    this.callbacks.onClose(this.modal);\n  },\n\n  showModal: function() {\n    this.activeElement = document.activeElement\n    this._resize();\n    this.modal.setAttribute('aria-hidden', 'false')\n    this.setFocusToFirstNode()\n    this.addEventListeners()\n    this.callbacks.onShow(this.modal)\n  },\n\n  activate: function() {\n    return this.showModal();\n    var self = this;\n    activeModal = this;\n    DomUtil.addClass(self._reader._container, 'st-modal-activating');\n    this._resize();\n    DomUtil.addClass(this._reader._container, 'st-modal-open');\n    setTimeout(function() {\n      DomUtil.addClass(self._container, 'active');\n      DomUtil.removeClass(self._reader._container, 'st-modal-activating');\n      self._container.setAttribute('aria-hidden', 'false');\n      self.setFocusToFirstNode();\n    }, 25);\n  },\n\n  addEventListeners: function () {\n    // --- do we need touch listeners?\n    // this.modal.addEventListener('touchstart', this.onClick)\n    // this.modal.addEventListener('touchend', this.onClick)\n    this.modal.addEventListener('click', this.onClick)\n    document.addEventListener('keydown', this.onKeydown)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.addEventListener(event, this.onModalTransition);\n    }.bind(this))\n  },\n\n  removeEventListeners: function () {\n    this.modal.removeEventListener('touchstart', this.onClick)\n    this.modal.removeEventListener('click', this.onClick)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.removeEventListener(event, this.onModalTransition);\n    }.bind(this))\n    document.removeEventListener('keydown', this.onKeydown)\n  },\n\n  _resize: function() {\n    var container = this._reader._container;\n    this.container.style.height = container.offsetHeight + 'px';\n    // console.log(\"AHOY MODAL\", this.container.style.height);\n    if ( ! this.options.className.container  ) {\n      this.container.style.width = this.options.width || parseInt(container.offsetWidth * this.options.fraction) + 'px';\n    }\n\n    var header = this.container.querySelector('header');\n    var footer = this.container.querySelector('footer');\n    var main = this.container.querySelector('main');\n    var height = this.container.clientHeight - header.clientHeight;\n    if ( footer ) {\n      height -= footer.clientHeight;\n    }\n    main.style.height = height + 'px';\n  },\n\n  getFocusableNodes: function() {\n    const nodes = this.modal.querySelectorAll(FOCUSABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  setFocusToFirstNode: function() {\n    var focusableNodes = this.getFocusableNodes();\n    if ( focusableNodes.length ) {\n      focusableNodes[0].focus();\n    } else {\n      activeModal._container.focus();\n    }\n  },\n\n  getActionableNodes: function() {\n    const nodes = this.modal.querySelectorAll(ACTIONABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  onKeydown: function(event) {\n    if ( event.keyCode == 27 ) { this.closeModal(); }\n    if ( event.keyCode == 9 ) {\n      this.maintainFocus(event);\n    }\n  },\n\n  onClick: function(event) {\n\n    var closeAfterAction = false;\n    var target = event.target;\n\n    // As far as I can tell, the code below isn't catching direct clicks on\n    // items with class='data-modal-close' as they're not ACTIONABLE_ELEMENTS.\n    // Adding them to ACTIONABLE_ELEMENTS causes undesirable behavior where\n    // their child items also close the modal thanks to the loop below.\n    // Children of .modal__overlay include the modal header, border area and\n    // padding. We don't want clicks on these closing the modal.\n    // Just close the modal now for direct clicks on a '.data-modal-close'.\n    if (target.hasAttribute('data-modal-close')) {\n      this.fire('closed');\n      this.closeModal();\n      return;\n    }\n\n    // if the target isn't an actionable type, walk the DOM until\n    // one is found\n    var actionableNodes = this.getActionableNodes();\n    while ( actionableNodes.indexOf(target) < 0 && target != this.modal ) {\n      target = target.parentElement;\n    }\n\n    // no target found, punt\n    if ( actionableNodes.indexOf(target) < 0 ) {\n      return;\n    }\n\n    if (this.handlers.click) {\n      var did_match = false;\n      for(var selector in this.handlers.click) {\n        if ( target.matches(selector) ) {\n          closeAfterAction = this.handlers.click[selector](this, target);\n          break;\n        }\n      }\n    }\n\n    if (closeAfterAction || target.hasAttribute('data-modal-close')) this.closeModal();\n\n    event.preventDefault();\n  },\n\n  onModalTransition: function(event) {\n    if ( this.modal.getAttribute('aria-hidden') == 'true' ) {\n      this._reader.fire('modal-closed');\n    } else {\n      this._reader.fire('modal-opened');\n    }\n  },\n\n  on: function(event, selector, handler) {\n    if (! this.handlers[event] ) {\n      this.handlers[event] = {};\n    }\n    if (typeof(selector) == 'function') {\n      handler = selector;\n      selector = '*';\n    }\n    this.handlers[event][selector] = handler;\n  },\n\n  fire: function(event) {\n    if ( this.handlers[event] && this.handlers[event]['*'] ) {\n      this.handlers[event]['*'](this);\n    }\n  },\n\n  maintainFocus: function(event) {\n    var focusableNodes = this.getFocusableNodes();\n    var focusedItemIndex = focusableNodes.indexOf(document.activeElement);\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableNodes[focusableNodes.length - 1].focus()\n      event.preventDefault()\n    }\n\n    if (!event.shiftKey && focusedItemIndex === focusableNodes.length - 1) {\n      focusableNodes[0].focus()\n      event.preventDefault()\n    }\n  },\n\n  update: function(options) {\n    if ( options.title ) {\n      this.options.title = options.title;\n      var titleEl = this.container.querySelector('.modal__title');\n      titleEl.innerText = options.title;\n    }\n\n    if (options.fraction) {\n      this.options.fraction = options.fraction;\n      this.container.style.width = parseInt(this.container.offsetWidth * this.options.fraction) + 'px';\n    }\n  },\n\n  EOT: true\n});\n\nReader.include({\n  modal: function (options) {\n    var modal = new Modal(options);\n    return modal.addTo(this);\n    // return this;\n  },\n\n  popup: function(options) {\n    options = assign({title: 'Info', fraction: 1.0}, options);\n\n    if ( ! this._popupModal ) {\n      this._popupModal = this.modal({\n        title: options.title,\n        region: 'full',\n        template: '<div style=\"height: 100%; width: 100%\"></div>',\n        fraction: options.fraction || 1.0,\n        actions: [\n            { label: 'Close', callback: function(event) { }, close: true },\n        ]\n      })\n    } else {\n      this._popupModal.update({ title: options.title, fraction: options.fraction });\n    }\n\n    var iframe;\n    var modalDiv = this._popupModal.container.querySelector('main > div');\n    var iframe = modalDiv.querySelector('iframe');\n    if ( iframe ) {\n      modalDiv.removeChild(iframe);\n    }\n    iframe = document.createElement('iframe');\n    iframe.style.width = '100%';\n    iframe.style.height = '100%';\n    iframe.setAttribute('title', options.title);\n    iframe = modalDiv.appendChild(iframe);\n\n    if ( options.onLoad ) {\n      iframe.addEventListener('load', function() {\n        options.onLoad(iframe.contentDocument, this._popupModal);\n      }.bind(this));\n    }\n\n    if ( options.srcdoc ) {\n      if (\"srcdoc\" in iframe) {\n        iframe.srcdoc = options.srcdoc;\n      } else {\n        iframe.contentDocument.open();\n        iframe.contentDocument.write(options.srcdoc);\n        iframe.contentDocument.close();\n      }\n    } else if ( options.href ) {\n      iframe.setAttribute('src', options.href);\n    }\n\n    this._popupModal.activate();\n\n  },\n\n  EOT: true\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport {Modal} from './Modal';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Contents = Control.extend({\n\n  defaultTemplate: `<button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Table of Contents\"><i class=\"icon-menu oi\" data-glyph=\"menu\" title=\"Table of Contents\" aria-hidden=\"true\"></i></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    this._control.setAttribute('id', 'action-' + this._id);\n    container.style.position = 'relative';\n\n    this._bindEvents();\n\n    return container;\n  },\n\n  _bindEvents() {\n    var self = this;\n    \n    this._reader.on('updateContents', function(data) {\n\n      DomEvent.on(this._control, 'click', function(event) {\n        event.preventDefault();\n        self._goto_interval = false;\n        self._reader.tracking.action('contents/open');\n        self._modal.activate();\n      }, this);\n\n      this._modal = this._reader.modal({\n        template: `\n<div class=\"cozy-contents-toolbar button-group\" aria-hidden=\"true\">\n  <button class=\"cozy-control button--lg toggled\" data-toggle=\"contentlist\">Table of Contents</button>\n  <button class=\"cozy-control button--lg\" data-toggle=\"pagelist\">Page List</button>\n</div>\n<div class=\"cozy-contents-main\">\n  <div class=\"cozy-contents-contentlist\">\n    <ul></ul>\n  </div>\n  <div class=\"cozy-contents-pagelist\" style=\"display: none\">\n    <form>\n      <label for=\"cozy-contents-pagelist-pagenum\">Page Number</label>\n      <input type=\"text\" size=\"5\" id=\"cozy-contents-pagelist-pagenum\" />\n      <button class=\"button--sm\">Go</button>\n      <p class=\"pagelist-error oi\" data-glyph=\"target\" role=\"alert\"></p>\n    </form>\n    <ul></ul>\n  </div>\n</div>`.trim(),\n        title: 'Contents',\n        region: 'left',\n        className: 'cozy-modal-contents',\n        callbacks: {\n          onShow: function() {},\n          onClose: function (modal) {\n          if (self._goto_interval) {\n            self._reader.rendition.manager.container.setAttribute(\"tabindex\", 0);\n            self._reader.rendition.manager.container.focus();\n          }\n        }\n      }});\n\n      this._display = {};\n      this._display.contentlist = this._modal._container.querySelector('.cozy-contents-contentlist');\n      this._display.pagelist = this._modal._container.querySelector('.cozy-contents-pagelist');\n      this._toolbar = this._modal._container.querySelector('.cozy-contents-toolbar');\n      this._pageListError = this._modal.container.querySelector('.pagelist-error');\n\n      this._toolbar.addEventListener('click', (event) => {\n        if ( event.target.dataset.toggle ) {\n          var target = event.target.dataset.toggle;\n          var current = this._toolbar.querySelector('[data-toggle].toggled');\n          if ( current ) {\n            current.classList.remove('toggled');\n            this._display[current.dataset.toggle].style.display = 'none';\n          }\n          event.target.classList.add('toggled');\n          this._display[event.target.dataset.toggle].style.display = 'block';\n          this._reader.updateLiveStatus(`Displaying ${event.target.innerText}`);\n        }\n      });\n\n      this._modal.on('click', '.cozy-contents-pagelist form button', function(modal, target) {\n        var form = target.parentNode;\n        var input = form.querySelector('input[type=\"text\"]');\n        var value = input.value.trim();\n        if ( value ) {\n          var pageList = this._reader.pageList;\n          var page = pageList.pageList.find((p) => { return ( p.pageLabel == value ) }) || false;\n          if ( page ) {\n            target = pageList.cfiFromPage(page.page);\n            this._goto_interval = true;\n            this._reader.tracking.action('contents/go/link');\n            this._reader.display(target);\n            return true;\n          } else {\n            var p = this._pageListError; // form.querySelector('.pagelist-error');\n            var p1 = pageList.firstPageLabel;\n            var p2 = pageList.lastPageLabel;\n            p.innerHTML = `Please enter a page number between <strong>${p1}-${p2}</strong>.`;\n          }\n        }        \n      }.bind(this));\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('data-href');\n        this._goto_interval = true;\n        this._reader.tracking.action('contents/go/link');\n        this._reader.display(target);\n        return true;\n      }.bind(this));\n\n      this._modal.on('closed', function() {\n        self._pageListError.innerHTML = '';\n        self._reader.tracking.action('contents/close');\n      });\n\n      this._setupSkipLink();\n\n      var parent = self._modal._container.querySelector('.cozy-contents-contentlist ul');\n      var _process = function(items, tabindex, parent) {\n        items.forEach(function(item) {\n          var option = self._createOption(item, tabindex, parent);\n          if ( item.subitems && item.subitems.length ) {\n            _process(item.subitems, tabindex + 1, option);\n          }\n        })\n      };\n      _process(data.toc, 0, parent);\n\n    }.bind(this))\n\n    this._reader.on('updateLocations', (data) => {\n\n      if ( this._reader.pageList ) {\n        // this._toolbar.style.display = 'flex';\n        this._toolbar.setAttribute('aria-hidden', 'false');\n      }\n\n      if ( self._reader.pageList ) {\n        var parent = self._modal._container.querySelector('.cozy-contents-pagelist ul');\n        for(var i = 0; i < self._reader.pageList.pages.length; i++) {\n          var pg = self._reader.pageList.pages[i];\n          var info = self._reader.pageList.pageList[i];\n          var cfi = self._reader.pageList.locations[i];\n          var item = { \n            label: ( info.pageLabel || info.page ),\n            href: cfi\n          };\n          var option = self._createOption(item, 0, parent);\n        }\n      }\n    })\n  },\n\n  _createOption(chapter, tabindex, parent) {\n\n    function pad(value, length) {\n        return (value.toString().length < length) ? pad(\"-\"+value, length):value;\n    }\n    var option = DomUtil.create('li');\n    if ( chapter.href ) {\n      var anchor = DomUtil.create('a', null, option);\n      if ( chapter.html ) {\n        anchor.innerHTML = chapter.html;\n      } else {\n        anchor.textContent = chapter.label;\n      }\n      // var tab = pad('', tabindex); tab = tab.length ? tab + ' ' : '';\n      // option.textContent = tab + chapter.label;\n      anchor.setAttribute('href', chapter.href);\n      anchor.setAttribute('data-href', chapter.href);\n    } else {\n      var span = DomUtil.create('span', null, option);\n      span.textContent = chapter.label;\n    }\n\n    if ( parent.tagName === 'LI' ) {\n      // need to nest\n      var tmp = parent.querySelector('ul');\n      if ( ! tmp ) {\n        tmp = DomUtil.create('ul', null, parent);\n      }\n      parent = tmp;\n    }\n\n    parent.appendChild(option);\n    return option;\n  },\n\n  _setupSkipLink: function() {\n    if ( ! this.options.skipLink ) { return; }\n      \n    var target = document.querySelector(this.options.skipLink);\n    if ( ! target ) { return; }\n\n    var link = document.createElement('a');\n    link.textContent = 'Skip to contents';\n    link.setAttribute('href', '#action-' + this._id);\n\n    var ul = target.querySelector('ul');\n    if ( ul ) {\n      // add to list\n      target = document.createElement('li');\n      ul.appendChild(target);\n    }\n    target.appendChild(link);\n    link.addEventListener('click', function(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      this._control.click();\n    }.bind(this))\n\n  },\n\n  EOT: true\n});\n\nexport var contents = function(options) {\n  return new Contents(options);\n};\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var Title = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    var h1 = DomUtil.create('h1', 'cozy-h1', container);\n    DomUtil.setOpacity(h1, 0);\n    this._title = DomUtil.create('span', 'cozy-title', h1);\n    this._divider = DomUtil.create('span', 'cozy-divider', h1);\n    this._divider.textContent = \" · \";\n    this._section = DomUtil.create('span', 'cozy-section', h1);\n\n    // --- TODO: disable until we can work out how to \n    // --- more reliably match the current section to the contents\n    // this._reader.on('updateSection', function(data) {\n    //   if ( data && data.label ) {\n    //     self._section.textContent = data.label;\n    //     DomUtil.setOpacity(self._section, 1.0);\n    //     DomUtil.setOpacity(self._divider, 1.0);\n    //   } else {\n    //     DomUtil.setOpacity(self._section, 0);\n    //     DomUtil.setOpacity(self._divider, 0);\n    //   }\n    // })\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._title.textContent = data.title || data.bookTitle;\n        DomUtil.setOpacity(self._section, 0);\n        DomUtil.setOpacity(self._divider, 0);\n        DomUtil.setOpacity(h1, 1);\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var title = function(options) {\n  return new Title(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var PublicationMetadata = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    this._publisher = DomUtil.create('div', 'cozy-publisher', container);\n    this._rights = DomUtil.create('div', 'cozy-rights', container);\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._publisher.textContent = data.publisher;\n        self._rights.textContent = data.rights;\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var publicationMetadata = function(options) {\n  return new PublicationMetadata(options);\n}\n","import {Class} from '../core/Class';\nimport {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as Util from '../core/Util';\n\nimport assign from 'lodash/assign';\nimport keys from 'lodash/keys';\n\nexport var Preferences = Control.extend({\n  options: {\n    label: 'Preferences',\n    hasThemes: false\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-preferences oi\" data-toggle=\"open\" data-glyph=\"cog\" aria-label=\"Preferences and Settings\"></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className();\n    var container = DomUtil.create('div', className);\n    var template = this.options.template || this.defaultTemplate;\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      container.appendChild(body.children[0]);\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self.activate();\n    }, this);\n\n    // self.initializeForm();\n    this._modal = this._reader.modal({\n      // template: '<form></form>',\n      title: 'Preferences',\n      className: 'cozy-modal-preferences',\n      actions: [\n        {\n          label: 'Save Changes',\n          callback: function(event) {\n            self.updatePreferences(event);\n          }\n        }\n      ],\n      region: 'right'\n    });\n\n    return container;\n  },\n\n  activate: function() {\n    var self = this;\n    self.initializeForm();\n    self._modal.activate();\n  },\n\n  _createPanel: function() {\n    var self = this;\n    if ( this._modal._container.querySelector('form') ) { return; }\n\n    var template = '';\n\n    var possible_fieldsets = [];\n    if ( this._reader.metadata.layout == 'pre-paginated' ) {\n      // different panel\n      possible_fieldsets.push('Scale');\n    } else {\n      possible_fieldsets.push('TextSize');\n    }\n    possible_fieldsets.push('Display');\n\n    if ( this._reader.rootfiles && this._reader.rootfiles.length > 1 ) {\n      // this.options.hasPackagePaths = true;\n      possible_fieldsets.push('Rendition');\n    }\n\n    if ( this._reader.options.themes && this._reader.options.themes.length > 0 ) {\n      this.options.hasThemes = true;\n      possible_fieldsets.push('Theme');\n    }\n\n    this._fieldsets = [];\n    possible_fieldsets.forEach(function(cls) {\n      var fieldset = new Preferences.fieldset[cls](this);\n      template += fieldset.template();\n      this._fieldsets.push(fieldset);\n    }.bind(this))\n\n    if ( this.options.fields ) {\n      this.options.hasFields = true;\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        template += `<fieldset class=\"custom-field\">\n          <legend>${field.label}</legend>\n        `;\n        for(var j in field.inputs) {\n          var input = field.inputs[j];\n          var checked = input.value == field.value ? ' checked=\"checked\"' : '';\n          template += `<label><input id=\"preferences-custom-${i}-${j}\" type=\"radio\" name=\"x${field.name}\" value=\"${input.value}\" ${checked}/>${input.label}</label>`;\n        }\n        if ( field.hint ) {\n          template += `<p class=\"hint\" style=\"font-size: 90%\">${field.hint}</p>`;\n        }\n      }\n    }\n\n    template = '<form>' + template + '</form>';\n\n    // this._modal = this._reader.modal({\n    //   template: template,\n    //   title: 'Preferences',\n    //   className: 'cozy-modal-preferences',\n    //   actions: [\n    //     {\n    //       label: 'Save Changes',\n    //       callback: function(event) {\n    //         self.updatePreferences(event);\n    //       }\n    //     }\n    //   ],\n    //   region: 'right'\n    // });\n\n    this._modal._container.querySelector('main').innerHTML = template;\n    this._form = this._modal._container.querySelector('form');\n  },\n\n  initializeForm: function() {\n    this._createPanel();\n    this._fieldsets.forEach(function(fieldset) {\n      fieldset.initializeForm(this._form);\n    }.bind(this));\n  },\n\n  updatePreferences: function(event) {\n    event.preventDefault();\n\n    var doUpdate = false;\n    var new_options = {};\n    var saveable_options = {};\n    this._fieldsets.forEach(function(fieldset) {\n      // doUpdate = doUpdate || fieldset.updateForm(this._form, new_options);\n      // assign(new_options, fieldset.updateForm(this._form));\n      fieldset.updateForm(this._form, new_options, saveable_options);\n    }.bind(this));\n\n    if ( this.options.hasFields ) {\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        var input = this._form.querySelector(`input[name=\"x${field.name}\"]:checked`);\n        if ( input.value != field.value ) {\n          field.value = input.value;\n          field.callback(field.value);\n        }\n      }\n    }\n\n    this._modal.deactivate();\n\n    setTimeout(function() {\n      this._reader.saveOptions(saveable_options);\n      this._reader.reopen(new_options);\n    }.bind(this), 100);\n  },\n\n  EOT: true\n});\n\nPreferences.fieldset = {};\n\nvar Fieldset = Class.extend({\n\n  options: {},\n\n  initialize: function (control, options) {\n      Util.setOptions(this, options);\n      this._control = control;\n      this._current = {};\n      this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n  },\n\n  template: function() {\n\n  },\n\n  EOT: true\n\n\n});\n\nPreferences.fieldset.TextSize = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var text_size = this._control._reader.options.text_size || 100;\n    if ( text_size == 'auto' ) { text_size = 100; }\n    this._current.text_size = text_size;\n    this._input.value = text_size;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.text_size = saveable.text_size = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Text Size</legend>\n        <div class=\"preview--text_size\" id=\"x${this._id}-preview\">\n          ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span>T-</span>\n          <input name=\"text_size\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" aria-valuemin=\"50\" aria-valuemax=\"400\" style=\"width: 75%; display: inline-block\" />\n          <span>T+</span>\n        </p>\n        <p>\n          <span>Text Size: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--lg\" style=\"margin-left: 8px\">Reset to 100%</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.fontSize = `${( parseInt(this._input.value, 10) / 100 )}em`;\n    this._output.innerHTML = `${this._input.value}%`;\n    this._input.setAttribute('aria-valuenow',`${this._input.value}`);\n    this._input.setAttribute('aria-valuetext',`${this._input.value} percent`);\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Display = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var flow = this._control._reader.options.flow || this._control._reader.metadata.flow || 'auto';\n    // if ( flow == 'auto' ) { flow = 'paginated'; }\n\n    var input = form.querySelector(`#x${this._id}-input-${flow}`);\n    input.checked = true;\n    this._current.flow = flow;\n\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-flow\"]:checked`);\n    options.flow = input.value;\n    if ( options.flow != 'auto' ) {\n      saveable.flow = options.flow;\n    }\n    // if ( input.value == 'auto' ) {\n    //   // we do NOT want to save flow as a preference\n    //   return {};\n    // }\n    // return { flow: input.value };\n  },\n\n  template: function() {\n    var scrolled_help = '';\n    if ( this._control._reader.metadata.layout != 'pre-paginated' ) {\n      scrolled_help = \"<br /><small>This is an experimental feature that may cause display and loading issues for the book when enabled.</small>\";\n    }\n    return `<fieldset>\n            <legend>Display</legend>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-auto\" value=\"auto\" /> Auto<br /><small>Let the reader determine display mode based on your browser dimensions and the type of content you're reading</small></label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-paginated\" value=\"paginated\" /> Page-by-Page</label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-scrolled-doc\" value=\"scrolled-doc\" /> Scroll${scrolled_help}</label>\n          </fieldset>`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Theme = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var theme = this._control._reader.options.theme || 'default';\n\n    var input = form.querySelector(`#x${this._id}-input-theme-${theme}`);\n    input.checked = true;\n    this._current.theme = theme;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-theme\"]:checked`);\n    options.theme = saveable.theme = input.value;\n    // return { theme: input.value };\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Theme</legend>\n            <label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-default\" value=\"default\" />Default</label>`;\n\n    this._control._reader.options.themes.forEach(function(theme) {\n      template += `<label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-${theme.klass}\" value=\"${theme.klass}\" />${theme.name}</label>`\n    }.bind(this));\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Rendition = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var rootfiles = this._control._reader.rootfiles;\n    var rootfilePath = this._control._reader.options.rootfilePath;\n    var expr = rootfilePath ? `[value=\"${rootfilePath}\"]` : \":first-child\";\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]${expr}`);\n    input.checked = true;\n    this._current.rootfilePath = rootfilePath || rootfiles[0].rootfilePath;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]:checked`);\n    if ( input.value != this._current.rootfilePath ) {\n      options.rootfilePath = input.value;\n      this._current.rootfilePath = input.value;\n    }\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Rendition</legend>\n    `;\n\n    this._control._reader.rootfiles.forEach(function(rootfile, i) {\n      template += `<label><input name=\"x${this._id}-rootfilePath\" type=\"radio\" id=\"x${this._id}-input-rootfilePath-${i}\" value=\"${rootfile.rootfilePath}\" />${rootfile.label || rootfile.accessMode || rootfile.rootfilePath}</label>`;\n    }.bind(this))\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Scale = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview > div`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var scale = this._control._reader.options.scale || 100;\n    if ( ! scale ) { scale = 100; }\n    this._current.scale = scale;\n    this._input.value = scale;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.scale = saveable.scale = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Zoom In/Out</legend>\n        <div class=\"preview--scale\" id=\"x${this._id}-preview\" style=\"overflow: hidden; height: 5rem\">\n          <div>\n            ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n          </div>\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span style=\"font-size: 150%\">⊖<span class=\"u-screenreader\"> Zoom Out</span></span>\n          <input name=\"scale\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span style=\"font-size: 150%\">⊕<span class=\"u-screenreader\">Zoom In </span></span>\n        </p>\n        <p>\n          <span>Scale: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.transform = `scale(${( parseInt(this._input.value, 10) / 100 )}) translate(0,0)`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nexport var preferences = function(options) {\n  return new Preferences(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Widget = Control.extend({\n\n\n  options: {\n      // @option region: String = 'topright'\n      // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n      // `'topright'`, `'bottomleft'` or `'bottomright'`\n  },\n\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      // NOOP\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n\n    }\n\n    this._onAddExtra(container);\n    this._updateTemplate(container);\n    this._updateClass(container);\n    this._bindEvents(container);\n\n    return container;\n  },\n\n  _updateTemplate: function(container) {\n    var data = this.data();\n    for(var slot in data) {\n      if ( data.hasOwnProperty(slot) ) {\n        var value = data[slot];\n        if ( typeof(value) == \"function\" ) { value = value(); }\n        var node = container.querySelector(`[data-slot=${slot}]`);\n        if ( node ) {\n          if ( node.hasAttribute('value') ) {\n            node.setAttribute('value', value);\n          } else {\n            node.innerHTML = value;\n          }\n        }\n      }\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this.options.className ) {\n      DomUtil.addClass(container, this.options.className);\n    }\n  },\n\n  _onAddExtra: function() { },\n\n  _bindEvents: function(container) {\n    var control = container.querySelector(\"[data-toggle=button]\");\n    if ( ! control ) { return ; }\n    DomEvent.disableClickPropagation(control);\n    DomEvent.on(control, 'click', DomEvent.stop);\n    DomEvent.on(control, 'click', this._action, this);\n  },\n\n  _action: function() {\n  },\n\n  data: function() {\n    return this.options.data || {};\n  },\n\n  EOT: true\n});\n\nWidget.Button = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _action: function() {\n    this.options.onClick(this, this._reader);\n  },\n\n  EOT: true\n});\n\nWidget.Panel = Widget.extend({\n  defaultTemplate: `<div><span data-slot=\"text\"></span></div>`,\n\n\n  EOT: true\n});\n\nWidget.Toggle = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _onAddExtra: function(container) {\n    this.state(this.options.states[0].stateName, container);\n\n    return container;\n  },\n\n  state: function(stateName, container) {\n    container = container || this._container;\n    this._resetState(container);\n    this._state = this.options.states.filter(function(s) { return s.stateName == stateName })[0];\n    this._updateClass(container);\n    this._updateTemplate(container);\n  },\n\n  _resetState: function(container) {\n    if ( ! this._state ) { return; }\n    if ( this._state.className ) {\n      DomUtil.removeClass(container, this._state.className);\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this._state.className ) {\n      DomUtil.addClass(container, this._state.className);\n    }\n  },\n\n  _action: function() {\n    this._state.onClick(this, this._reader);\n  },\n\n  data: function() {\n    return this._state.data || {};\n  },\n\n  EOT: true\n});\n\n// export var widget = function(options) {\n//   return new Widget(options);\n// }\n\nexport var widget = {\n  button: function(options) { return new Widget.Button(options); },\n  panel: function(options) { return new Widget.Panel(options); },\n  toggle: function(options) { return new Widget.Toggle(options); }\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Citation = Control.extend({\n  options: {\n    label: 'Citation',\n    html: '<span class=\"citation\" aria-label=\"Get Citation\"></span>'\n  },\n\n  defaultTemplate: '<button class=\"button--sm cozy-citation citation\" data-toggle=\"open\" aria-label=\"Get Citation\"></button>',\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Select Citation Format</legend>\n      </fieldset>\n    </form>\n    <blockquote id=\"formatted\" style=\"padding: 8px; border-left: 4px solid black; background-color: #fff\"></blockquote>\n    <div class=\"alert alert-info\" id=\"message\" style=\"display: none\"></div>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Copy Citation to Clipboard',\n      className: 'cozy-modal-citation',\n      actions: [\n        {\n          label: 'Copy Citation',\n          close: true,\n          callback: function(event) {\n            document.designMode = \"on\";\n            var formatted = self._modal._container.querySelector(\"#formatted\");\n\n            var range = document.createRange();\n            range.selectNode(formatted);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // formatted.select();\n\n            try {\n              var flag = document.execCommand('copy');\n            } catch(err) {\n              console.log(\"AHOY COPY FAILED\", err);\n            }\n\n            self._message.innerHTML = 'Success! Citation copied to your clipboard.';\n            self._message.style.display = 'block';\n            sel.removeAllRanges();\n            range.detach();\n            document.designMode = \"off\";\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    var fieldset = this._form.querySelector('fieldset');\n\n    var citations = this.options.citations || this._reader.metadata.citations;\n\n    citations.forEach(function(citation, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', citation.format);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = document.createTextNode(\" \" + citation.format);\n      label.appendChild(text);\n      input.setAttribute('data-text', citation.text);\n    });\n\n    this._formatted = this._modal._container.querySelector(\"#formatted\");\n    this._message = this._modal._container.querySelector(\"#message\");\n    DomEvent.on(this._form, 'change', function(event) {\n      var target = event.target;\n      if ( target.tagName == 'INPUT' ) {\n        this._initializeForm();\n      }\n    }, this);\n\n    this._initializeForm();\n  },\n\n  _initializeForm: function() {\n    var formatted = this._formatCitation();\n    this._formatted.innerHTML = formatted;\n    this._message.style.display = 'none';\n    this._message.innerHTML = '';\n  },\n\n  _formatCitation: function(format) {\n    if ( format == null ) {\n      var selected = this._form.querySelector(\"input:checked\");\n      format = selected.value;\n    }\n    var selected = this._form.querySelector(\"input[value=\" + format + \"]\");\n    return selected.getAttribute('data-text');\n    // return selected.dataset.text;\n  },\n\n  EOT: true\n});\n\nexport var citation = function(options) {\n  return new Citation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Search = Control.extend({\n  options: {\n    label: 'Search',\n    html: '<span>Search</span>'\n  },\n\n  defaultTemplate: `<form class=\"search\">\n    <label class=\"u-screenreader\" for=\"cozy-search-string\">Search in this text</label>\n    <input id=\"cozy-search-string\" name=\"search\" type=\"text\" placeholder=\"Search in this text...\" data-hj-allow=\"true\" />\n    <button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Search\"><i class=\"icon-magnifying-glass oi\" data-glyph=\"magnifying-glass\" title=\"Search\" aria-hidden=\"true\"></i></button>\n  </form>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    container.style.position = 'relative';\n\n    this._data = null;\n    this._canceled = false;\n    this._processing = false;\n    this._addLocation = false;\n\n    this._reader.on('ready', function() {\n\n      this._modal = this._reader.modal({\n        template: '<article></article>',\n        title: 'Search Results',\n        className: { container: 'cozy-modal-search' },\n        region: 'left',\n      });\n\n      this._modal.callbacks.onClose = function() {\n        if ( self._processing ) {\n          self._canceled = true;\n        }\n      };\n\n      this._article = this._modal._container.querySelector('article');\n\n      this._modal.on('click', 'a[class=\"search-result\"]', function(modal, target) {\n        target = target.getAttribute('href');\n        this._reader.tracking.action('search/go/link');\n        this._reader.display(target, function() {\n          // return focus to epub iframe, CSB-259\n          document.getElementsByTagName(\"iframe\")[0].focus();\n        });\n        return true;\n      }.bind(this));\n\n      this._modal.on('click', 'a[class=\"feedback-link\"]', function(modal, target) {\n        window.open(target.href, '_blank');\n      }.bind(this));\n\n      this._modal.on('closed', function() {\n        this._reader.tracking.action('contents/close');\n      }.bind(this))\n\n    }.bind(this));\n\n    // only add locations when they've been processed\n    this._reader.on('updateLocations', function() {\n      this._addLocation = true;\n    }.bind(this));\n\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n\n      var searchString = this._container.querySelector(\"#cozy-search-string\").value;\n      searchString = searchString.replace(/^\\s*/, '').replace(/\\s*$/, '');\n\n      if ( ! searchString ) {\n        // just punt\n        return;\n      }\n\n      if ( searchString == this.searchString ) {\n        // cached results\n        self.openModalResults();\n      } else {\n        this.searchString = searchString;\n        self.openModalWaiting();\n        self.submitQuery();\n      }\n    }, this);\n\n    window.addEventListener('keydown', function(evt) {\n      let cmd = (evt.ctrlKey ? 1 : 0) |\n                (evt.altKey ? 2 : 0) |\n                (evt.shiftKey ? 4 : 0) |\n                (evt.metaKey ? 8 : 0);\n\n      if (cmd === 1 || cmd === 8 || cmd === 5 || cmd === 12) {\n        if ( evt.keyCode == '70' ) {\n          // command/control-F\n          evt.preventDefault();\n          this._container.querySelector(\"#cozy-search-string\").focus();\n        }\n      }\n    }.bind(this));\n\n    return container;\n  },\n\n  openModalWaiting: function() {\n    this._processing = true;\n    this._emptyArticle();\n    var value = this.searchString;\n    this._article.innerHTML = '<p>Submitting query for <em>' + value + '</em>...</p>' + this._reader.loaderTemplate();\n    this._modal.activate();\n  },\n\n  openModalResults: function() {\n    if ( this._canceled ) {\n      this._canceled = false;\n      return;\n    }\n    this._buildResults();\n    this._modal.activate();\n    this._reader.tracking.action(\"search/open\");\n  },\n\n  submitQuery: function() {\n    var self = this;\n\n    var url = this.options.searchUrl + encodeURIComponent(this.searchString);\n\n    var request = new XMLHttpRequest();\n    request.open('GET', url, true);\n\n    request.onload = function() {\n      if (this.status >= 200 && this.status < 400) {\n        // Success!\n        var data = JSON.parse(this.response);\n        console.log(\"SEARCH DATA\", data);\n\n        self._data = data;\n\n      } else {\n        // We reached our target server, but it returned an error\n\n        self._data = null;\n        console.log(this.response);\n      }\n\n      self._reader.tracking.action(\"search/submitQuery\");\n      self.openModalResults();\n\n    };\n\n    request.onerror = function() {\n      // There was a connection error of some sort\n      self._data = null;\n      self.openModalResults();\n    };\n\n    request.send();\n\n  },\n\n  _emptyArticle: function() {\n    while (this._article && this._article.hasChildNodes()) {\n      this._article.removeChild(this._article.lastChild);\n    }\n  },\n\n  _buildResults: function() {\n    var self = this;\n    var content;\n    var no_results;\n    var feedback;\n    var results_list;\n    var feedback_link = document.createElement('a');\n    feedback_link.target = '_blank';\n    feedback_link.href = 'https://umich.qualtrics.com/jfe/form/SV_3KSLynPij0fqrD7?publisher=' + self._reader.metadata.press_subdomain + '&noid=' + self._reader.metadata.noid + '&title=' + self._reader.metadata.title + '&search_location=ereader&q=' + self.searchString + '&url=' + window.location.href;\n    feedback_link.innerText = 'Share your feedback.';\n    feedback_link.setAttribute(\"class\", \"feedback-link\");\n    var feedback_text = 'Not finding what you\\'re looking for? '\n    feedback = DomUtil.create(\"p\")\n    feedback.textContent = feedback_text;\n    feedback.appendChild(feedback_link); \n    \n    this._processing = false;\n\n    self._emptyArticle();\n\n    var reader = this._reader;\n    reader.annotations.reset();\n\n    if ( this._data ) {\n      var highlight = true\n      if (this._data.highlight_off == \"yes\") {\n        highlight = false;\n      }\n      content = DomUtil.create('div');\n      if ( this._data.search_results.length == 0) {\n        no_results = DomUtil.create(\"p\")\n        no_results.textContent = 'No results found for \"' + self.searchString + '\"';\n        content.appendChild(no_results);\n        content.appendChild(feedback);\n      } else {\n        content.appendChild(feedback);\n\n        results_list = DomUtil.create('ol'); \n        this._data.search_results.forEach(function(result) {\n          var option = DomUtil.create('li');\n          var anchor = DomUtil.create('a', null, option);\n          var cfiRange = \"epubcfi(\" + result.cfi + \")\";\n\n          if (result.snippet) {\n            // results for epubs\n            if ( self._addLocation ) {\n              var loc = reader.locations.locationFromCfi(cfiRange);\n              var locText = \"Location \" + loc + \" • \";\n              if (cfiRange.match(/^epubcfi\\(page/)) {\n                // results for pdfs\n                // see heliotrope: app/views/e_pubs/show_pdf.html.erb, _gatherResults()\n                loc = cfiRange.split(\"=\")[1]\n                locText = \"Page \" + loc.slice(0, -1) + \" • \";\n              }\n              var locElement = DomUtil.create('i');\n              locElement.textContent = locText;\n              anchor.appendChild(locElement);\n            }\n            anchor.appendChild(document.createTextNode(result.snippet));\n\n            anchor.setAttribute(\"href\", cfiRange);\n            anchor.setAttribute(\"class\", 'search-result');\n            results_list.appendChild(option);\n          }\n          if (highlight) {\n            reader.annotations.highlight(cfiRange, {}, null, 'epubjs-search-hl');\n          }\n        });\n        content.appendChild(results_list);\n      } \n    } else {\n      content = DomUtil.create(\"p\")\n      content.textContent = 'There was a problem processing this query.';\n    }\n    \n    self._article.appendChild(content);\n  },\n\n  EOT: true\n});\n\nexport var search = function(options) {\n  return new Search(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var BibliographicInformation = Control.extend({\n  options: {\n    label: 'Info',\n    direction: 'left',\n    html: '<span class=\"oi\" data-glyph=\"info\">Info</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-bib-info oi\" data-glyph=\"info\" data-toggle=\"open\" aria-label=\"Bibliographic Information\"> Info</button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<dl>\n    </dl>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Info',\n      region: 'left',\n      fraction: 1.0\n    });\n\n    var dl = this._modal._container.querySelector('dl');\n\n    var metadata_fields = [\n      [ 'title', 'Title' ],\n      [ 'creator', 'Author' ],\n      [ 'pubdate', 'Publication Date' ],\n      [ 'modified_date', 'Modified Date' ],\n      [ 'publisher', 'Publisher' ],\n      [ 'rights', 'Rights' ],\n      [ 'doi', 'DOI' ],\n      [ 'description', 'Description' ],\n    ];\n\n    var metadata_fields_seen = {};\n\n    var metadata = this._reader.metadata;\n\n    for(var idx in metadata_fields) {\n      var key = metadata_fields[idx][0];\n      var label = metadata_fields[idx][1];\n      if ( metadata[key] ) {\n        var value = metadata[key];\n        if ( key == 'pubdate' || key == 'modified_date' ) {\n          value = this._formatDate(value);\n          if ( ! value ) { continue; }\n          // value = d.toISOString().slice(0,10); // for YYYY-MM-DD\n        }\n        metadata_fields_seen[key] = true;\n        var dt = DomUtil.create('dt', 'cozy-bib-info-label', dl);\n        dt.innerHTML = label;\n        var dd = DomUtil.create('dd', 'cozy-bib-info-value cozy-bib-info-value-' + key, dl);\n        dd.innerHTML = value;\n      }\n    }\n\n  },\n\n  _formatDate: function(value) {\n    var match = value.match(/\\d{4}/);\n    if ( match ) {\n      return match[0];\n    }\n    return null;\n  },\n\n  EOT: true\n});\n\nexport var bibliographicInformation = function(options) {\n  return new BibliographicInformation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Download = Control.extend({\n  options: {\n    label: 'Download Book',\n    html: '<span>Download Book</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-download oi\" data-toggle=\"open\" data-glyph=\"data-transfer-download\"> Download Book</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Choose File Format</legend>\n      </fieldset>\n    </form>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Download Book',\n      className: 'cozy-modal-download',\n      actions: [\n        {\n          label: 'Download',\n          callback: function(event) {\n            var selected = self._form.querySelector(\"input:checked\");\n            var href = selected.getAttribute('data-href');\n            self._configureDownloadForm(href);\n            self._form.submit();\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');    \n    var fieldset = this._form.querySelector('fieldset');\n    this._reader.options.download_links.forEach(function(link, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', link.format);\n      input.setAttribute('data-href', link.href);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = link.format;\n      if ( link.size ) {\n        text += \" (\" + link.size + \")\";\n      }\n      var text = document.createTextNode(\" \" + text);\n      label.appendChild(text);\n    });\n\n  },\n\n  _configureDownloadForm: function(href) {\n    var self = this;\n    self._form.setAttribute('method', 'GET');\n    self._form.setAttribute('action', href);\n    self._form.setAttribute('target', '_blank');\n  },\n\n\n  EOT: true\n});\n\nexport var download = function(options) {\n  return new Download(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Navigator = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n    } else {\n\n      var className = this._className('navigator'),\n          options = this.options;\n      \n      container = DomUtil.create('div', className);\n    }\n    this._setup(container);\n\n    this._reader.on('updateLocations', function(locations) {      \n      this._initializeNavigator(locations);\n    }.bind(this));\n\n    return container;\n  },\n\n  _setup: function(container) {\n    this._control = container.querySelector(\"input[type=range]\");\n    if ( ! this._control ) {\n      this._createControl(container);\n    }\n    this._background = container.querySelector(\".cozy-navigator-range__background\");\n    this._status = container.querySelector(\".cozy-navigator-range__status\");\n    this._spanCurrentPercentage = container.querySelector(\".currentPercentage\");\n    this._spanCurrentLocation = container.querySelector(\".currentLocation\");\n    this._spanTotalLocations = container.querySelector(\".totalLocations\");\n    this._spanCurrentPageLabel = container.querySelector('.currentPageLabel');\n\n    this._bindEvents();\n  },\n\n  _createControl: function (container) {\n    var template = `<div class=\"cozy-navigator-range\">\n        <label class=\"u-screenreader\" for=\"cozy-navigator-range-input\">Location: </label>\n        <input class=\"cozy-navigator-range__input\" id=\"cozy-navigator-range-input\" type=\"range\" name=\"locations-range-value\" min=\"0\" max=\"100\" step=\"1\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\" aria-valuetext=\"0% • Location 0 of ?\" value=\"0\" data-background-position=\"0\" />\n        <div class=\"cozy-navigator-range__background\"></div>\n      </div>\n      <div class=\"cozy-navigator-range__status\"><span class=\"currentPercentage\">0%</span><span> • </span><span>Location <span class=\"currentLocation\">0</span> of <span class=\"totalLocations\">?</span><span class=\"currentPageLabel\"></span></span></div>\n    `;\n\n    template = `<div class=\"cozy-navigator-range\">\n      <form>\n        <label class=\"u-screenreader\" for=\"cozy-navigator-range-input\">Location: </label>\n        <div class=\"cozy-navigator-range__background\">\n          <input class=\"cozy-navigator-range__input\" id=\"cozy-navigator-range-input\" type=\"range\" name=\"locations-range-value\" min=\"0\" max=\"100\" step=\"1\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\" aria-valuetext=\"0% • Location 0 of ?\" value=\"0\" data-background-position=\"0\" />\n        </div>\n      </form>\n      </div>\n      <div class=\"cozy-navigator-range__status\"><span class=\"currentPercentage\">0%</span><span> • </span><span>Location <span class=\"currentLocation\">0</span> of <span class=\"totalLocations\">?</span><span class=\"currentPageLabel\"></span></span></div>`;\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      container.appendChild(body.children[0]);\n    }\n\n    this._control = container.querySelector(\"input[type=range]\");\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    var isIE = window.navigator.userAgent.indexOf(\"Trident/\") > -1;\n\n    this._control.addEventListener(\"input\", function() {\n      if ( self._keyDown ) { self._keyDown = false; return; }\n      self._update(false);\n    }, false);\n    this._control.addEventListener(\"change\", function(event) { \n      if ( self._mouseDown ) { \n        if ( isIE ) { self._update(false); }\n        return;\n      }\n      self._action(); \n    }, false);\n    this._control.addEventListener(\"mousedown\", function(event){\n        self._mouseDown = true;\n        self._container.classList.add('updating');\n    }, false);\n    this._control.addEventListener(\"mouseup\", function(){\n        self._mouseDown = false;\n        self._container.classList.remove('updating');\n        if ( isIE ) { self._action(); return; }\n        self._update();\n    }, false);\n    this._control.addEventListener(\"keydown\", function(event) {\n      if ( event.key == 'ArrowLeft' || event.key == 'ArrowRight' ) {\n        // do not fire input events if we're just keying around\n        self._keyDown = true;\n      }\n    }, false);\n    this._control.addEventListener(\"keyup\", function(){\n      // self._mouseDown = false;\n    }, false);\n  },\n\n  _action: function() {\n    var value = parseInt(this._control.value, 10);\n    var cfi;\n    var locations = this._reader.locations;\n    if ( locations.cfiFromLocation ) {\n      cfi = locations.cfiFromLocation(value);\n    } else {\n      // hopefully short-term compatibility\n      var percent = value / this._total;\n      cfi = locations.cfiFromPercentage(percent);\n    }\n    this._reader.tracking.action(\"navigator/go\");\n    // this._ignore = true;\n    if ( this._watching == 'updateLocation' ) {\n      setTimeout(() => {\n        this._update();\n      }, 100);\n    }\n    this._reader.gotoPage(cfi);\n  },\n\n  _update: function(current) {\n    var self = this;\n\n    var value = parseFloat(this._control.value, 10);\n    var current_location = value;\n\n    var max = parseFloat(this._control.max, 10);\n    var percentage = (( value / max ) * 100.0)\n\n    // this._background.setAttribute('style', 'background-position: ' + (-percentage) + '% 0%, left top;');\n    var fill = this._fill; // '#2497e3';\n    var end = this._end; // '#ffffff';\n    this._control.style.background = `linear-gradient(to right, ${fill} 0%, ${fill} ${percentage}%, ${end} ${percentage}%, ${end} 100%)`;\n    percentage = Math.ceil(percentage);\n    this._spanCurrentPercentage.innerHTML = percentage + '%';\n\n    this._control.setAttribute('data-background-position', percentage);\n    this._spanCurrentLocation.innerHTML = ( current_location );\n\n    var current_page = '';\n    if ( this._reader.pageList ) { // && current !== false\n      var pages;\n      if ( typeof(current) != 'object' ) {\n        var cfi = this._reader.locations.cfiFromLocation(current_location);\n        pages = [ this._reader.pageList.pageFromCfi(cfi) ];\n      } else {\n        pages = this._reader.pageList.pagesFromLocation(current); \n      }\n      var pageLabels = [];\n      var label = 'p.';\n      if ( pages.length ) {\n        var p1 = pages.shift();\n        pageLabels.push(this._reader.pageList.pageLabel(p1));\n        if ( pages.length ) {\n          var p2 = pages.pop();\n          pageLabels.push(this._reader.pageList.pageLabel(p2));\n          label = 'pp.';\n        }\n      }\n      if ( pageLabels.length ) {\n        current_page = ` (${label} ${pageLabels.join('-')})`;\n      }\n      this._spanCurrentPageLabel.innerHTML = current_page;\n    }\n\n    this._control.setAttribute('aria-valuenow', value);\n    this._control.setAttribute('aria-valuetext', `${percentage}% • Location ${current_location} of ${this._total}${current_page}`);\n\n    // var message = `Location ${current_location}; ${percentage}%${current_page}`;\n    // this._reader.updateLiveStatus(message);\n  },\n\n  _initializeNavigator: function(locations) {\n    var self = this;\n\n    this._initiated = true;\n\n    this._fill = window.getComputedStyle(this._background, ':before').getPropertyValue('background-color');\n    this._end = window.getComputedStyle(this._background, ':after').getPropertyValue('background-color');\n\n    if ( ! this._reader.pageList ) {\n      this._spanCurrentPageLabel.style.display = 'none';\n    }\n\n    this._total = this._reader.locations.total;\n    var max = this._total; var min = 1;\n    if ( this._reader.locations.spine ) { max -= 1; min -= 1; }\n    this._control.max = max;\n    this._control.min = min;\n\n    var current = this._reader.currentLocation();\n    var value = this._parseLocation(current);\n    this._control.value = value;\n    this._last_value = this._control.value\n    this._update(current);\n\n    this._spanTotalLocations.innerHTML = this._total;\n\n    if ( this._reader.locations.cfiFromLocation ) {\n      this._watching = 'relocated';\n      this._reader.on('relocated', function(location) {\n        self._handle_relocated(location);\n      });\n    } else {\n      // BACK COMPATIBILITY\n      this._watching = 'updateLocation';\n      this._reader.on('updateLocation', function(location) {\n        console.log(\"AHOY NAVIGATOR updateLocation\", location);\n        self._handle_relocated(location);\n      });\n    }\n\n    setTimeout(function() {\n      DomUtil.addClass(this._container, 'initialized');\n    }.bind(this), 0);\n  },\n\n  _handle_relocated: function(location) {\n    var self = this;\n\n    var value; var percentage;\n    if ( ! self._initiated ) { return ; }\n    if ( ! ( location && location.start ) ) { return ; }\n\n    var value;\n    if ( location.start && location.end ) {\n      // EPUB\n      value = parseInt(self._control.value, 10);\n      var start = parseInt(location.start.location, 10);\n      var end = parseInt(location.end.location, 10);\n\n      if ( start == this._last_location_start && end == this._last_location_end ) {\n        return;\n      }\n\n      this._last_location_start = start; this._last_location_end = end;\n\n      // console.log(\"AHOY NAVIGATOR relocated\", value, start, end, value < start, value > end);\n      if ( value < start || value > end ) {\n        self._last_value = value;\n        self._control.value = ( value < start ) ? start : end;\n      }\n    } else {\n      value = self._parseLocation(location);\n\n      if ( value == this._last_value ) { return ; }\n\n      self._last_value = value;\n      self._control.value = value;\n    }\n\n    self._update(location);\n    // var message = `Location ${current_location}; ${percentage}%${current_page}`;\n    var message = this._control.getAttribute('aria-valuetext');\n    this._reader.updateLiveStatus(message);\n  },\n\n  _parseLocation: function(location) {\n    var self = this;\n    var value;\n\n    function handle_possible_pdf_location(location) {\n      var start = location.start.cfi ? location.start.cfi : location.start;\n      if ( typeof(start) == 'string' && start.indexOf('page=') > -1 ) {\n        // dumb\n        start = start.replace('epubcfi(page=','').replace(')', '');\n      }\n      return start;\n    }\n\n    if ( typeof(location.start) == 'undefined' ) {\n        // If the window is being resized while the reader is still loading an EPUB chapter, then...\n        // `location.start` will be undefined here. This causes the reader to appear to load forever.\n        // I _think_ this is going to be a rarity in the wild, although clicking the full screen...\n        // button too soon will also cause it. Also, it's actually very likely to happen when a ...\n        // developer opens a \"docked\" dev tools dialog while CSB is loading a complex chapter.\n        // In this event starting from scratch with a page reload seems like the best move.\n        // Anything else causes a recursive, asynchronous mess.\n        console.log(\"AHOY NAVIGATOR location lost. Window resized while loading? Reloading page.\");\n        window.location.reload(); // errors may still appear in the console before the reload occurs\n    }\n    else if ( typeof(location.start) == 'object' ) {\n      if ( location.start.location != null ) {\n        value = location.start.location;\n      } else {\n        var start_cfi = handle_possible_pdf_location(location);\n        var percentage = self._reader.locations.percentageFromCfi(start_cfi);\n        value = Math.ceil(self._total * percentage);\n      }\n    } else {\n      // PDF bug\n      var start = handle_possible_pdf_location(location);\n      value = parseInt(start, 10);\n    }\n\n    return value;\n  },\n\n  EOT: true\n});\n\nexport var navigator = function(options) {\n  return new Navigator(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Fullscreen = Control.extend({\n  options: {\n    label: 'View Fullscreen',\n    html: '<span>View Fullscreen</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-fullscreen oi\" data-toggle=\"open\" data-glyph=\"fullscreen-enter\" aria-label=\"Enter Fullscreen\"></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self.activate();\n    }, this)\n\n    // // fullscreenchange is not standard across all browsers\n    // document.addEventListener('fullscreenchange', (event) => {\n    //   // document.fullscreenElement will point to the element that\n    //   // is in fullscreen mode if there is one. If there isn't one,\n    //   // the value of the property is null.    \n    //   this._fullscreenchangeHandler();\n    // });\n\n    this._reader.on('fullscreenchange', (data) => {\n      this._fullscreenchangeHandler(data.isFullscreen);\n    })\n\n    return container;\n  },\n\n  activate: function() {\n    if ( ! document.fullscreenElement ) {\n      this._reader.requestFullscreen();\n    } else {\n      if ( document.exitFullscreen ) {\n        document.exitFullscreen();\n      }\n    }\n  },\n\n  _fullscreenchangeHandler: function(isFullscreen) {\n    if (isFullscreen) {\n      this._control.dataset.glyph = 'fullscreen-exit';\n      this._control.setAttribute('aria-label', 'Exit Fullscreen');\n    } else {\n      this._control.dataset.glyph = 'fullscreen-enter';\n      this._control.setAttribute('aria-label', 'Enter Fullscreen');\n    }    \n  },\n\n  EOT: true\n});\n\nexport var fullscreen = function(options) {\n  return new Fullscreen(options);\n}\n","import {Control, control} from './Control';\nimport {PageNext, PagePrevious, pageNext, pagePrevious, PageFirst, pageFirst, PageLast, pageLast} from './Control.Paging';\nimport {Contents, contents} from './Control.Contents';\nimport {Title, title} from './Control.Title';\nimport {PublicationMetadata, publicationMetadata} from './Control.PublicationMetadata';\nimport {Preferences, preferences} from './Control.Preferences';\nimport {Widget, widget} from './Control.Widget';\nimport {Citation, citation} from './Control.Citation';\nimport {Search, search} from './Control.Search';\nimport {BibliographicInformation, bibliographicInformation} from './Control.BibliographicInformation';\nimport {Download, download} from './Control.Download';\nimport {Navigator, navigator} from './Control.Navigator';\nimport {Fullscreen, fullscreen} from './Control.Fullscreen';\n\n// import {Zoom, zoom} from './Control.Zoom';\n// import {Attribution, attribution} from './Control.Attribution';\n\nControl.PageNext = PageNext;\nControl.PagePrevious = PagePrevious;\nControl.PageFirst = PageFirst;\nControl.PageLast = PageLast;\ncontrol.pagePrevious = pagePrevious;\ncontrol.pageNext = pageNext;\ncontrol.pageFirst = pageFirst;\ncontrol.pageLast = pageLast;\n\nControl.Contents = Contents;\ncontrol.contents = contents;\n\nControl.Title = Title;\ncontrol.title = title;\n\nControl.PublicationMetadata = PublicationMetadata;\ncontrol.publicationMetadata = publicationMetadata;\n\nControl.Preferences = Preferences;\ncontrol.preferences = preferences;\n\nControl.Widget = Widget;\ncontrol.widget = widget;\n\nControl.Citation = Citation;\ncontrol.citation = citation;\n\nControl.Search = Search;\ncontrol.search = search;\n\nControl.BibliographicInformation = BibliographicInformation;\ncontrol.bibliographicInformation = bibliographicInformation;\n\nControl.Download = Download;\ncontrol.download = download;\n\nControl.Navigator = Navigator;\ncontrol.navigator = navigator;\n\nControl.Fullscreen = Fullscreen;\ncontrol.fullscreen = fullscreen;\n\nexport {Control, control};\n","\n/*\n * @namespace Browser\n * @aka L.Browser\n *\n * A namespace with static properties for browser/feature detection used by Leaflet internally.\n *\n * @example\n *\n * ```js\n * if (L.Browser.ielt9) {\n *   alert('Upgrade your browser, dude!');\n * }\n * ```\n */\n\nvar style = document.documentElement.style;\n\n// @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).\nexport var ie = 'ActiveXObject' in window;\n\n// @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.\nexport var ielt9 = ie && !document.addEventListener;\n\n// @property edge: Boolean; `true` for the Edge web browser.\nexport var edge = 'msLaunchUri' in navigator && !('documentMode' in document);\n\n// @property webkit: Boolean;\n// `true` for webkit-based browsers like Chrome and Safari (including mobile versions).\nexport var webkit = userAgentContains('webkit');\n\n// @property android: Boolean\n// `true` for any browser running on an Android platform.\nexport var android = userAgentContains('android');\n\n// @property android23: Boolean; `true` for browsers running on Android 2 or Android 3.\nexport var android23 = userAgentContains('android 2') || userAgentContains('android 3');\n\n// @property opera: Boolean; `true` for the Opera browser\nexport var opera = !!window.opera;\n\n// @property chrome: Boolean; `true` for the Chrome browser.\nexport var chrome = userAgentContains('chrome');\n\n// @property gecko: Boolean; `true` for gecko-based browsers like Firefox.\nexport var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;\n\n// @property safari: Boolean; `true` for the Safari browser.\nexport var safari = !chrome && userAgentContains('safari');\n\nexport var phantom = userAgentContains('phantom');\n\n// @property opera12: Boolean\n// `true` for the Opera browser supporting CSS transforms (version 12 or later).\nexport var opera12 = 'OTransition' in style;\n\n// @property win: Boolean; `true` when the browser is running in a Windows platform\nexport var win = navigator.platform.indexOf('Win') === 0;\n\n// @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.\nexport var ie3d = ie && ('transition' in style);\n\n// @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.\nexport var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;\n\n// @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.\nexport var gecko3d = 'MozPerspective' in style;\n\n// @property any3d: Boolean\n// `true` for all browsers supporting CSS transforms.\nexport var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;\n\n// @property mobile: Boolean; `true` for all browsers running in a mobile device.\nexport var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');\n\n// @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.\nexport var mobileWebkit = mobile && webkit;\n\n// @property mobileWebkit3d: Boolean\n// `true` for all webkit-based browsers in a mobile device supporting CSS transforms.\nexport var mobileWebkit3d = mobile && webkit3d;\n\n// @property msPointer: Boolean\n// `true` for browsers implementing the Microsoft touch events model (notably IE10).\nexport var msPointer = !window.PointerEvent && window.MSPointerEvent;\n\n// @property pointer: Boolean\n// `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\nexport var pointer = !!(window.PointerEvent || msPointer);\n\n// @property touch: Boolean\n// `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).\n// This does not necessarily mean that the browser is running in a computer with\n// a touchscreen, it only means that the browser is capable of understanding\n// touch events.\nexport var touch = !window.L_NO_TOUCH && (pointer || 'ontouchstart' in window ||\n        (window.DocumentTouch && document instanceof window.DocumentTouch));\n\n// @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.\nexport var mobileOpera = mobile && opera;\n\n// @property mobileGecko: Boolean\n// `true` for gecko-based browsers running in a mobile device.\nexport var mobileGecko = mobile && gecko;\n\n// @property retina: Boolean\n// `true` for browsers on a high-resolution \"retina\" screen.\nexport var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;\n\n\n// @property canvas: Boolean\n// `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\nexport var canvas = (function () {\n    return !!document.createElement('canvas').getContext;\n}());\n\n// @property svg: Boolean\n// `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).\n// export var svg = !!(document.createElementNS && svgCreate('svg').createSVGRect);\nexport var svg = true;\n\n// @property vml: Boolean\n// `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).\nexport var vml = !svg && (function () {\n    try {\n        var div = document.createElement('div');\n        div.innerHTML = '<v:shape adj=\"1\"/>';\n\n        var shape = div.firstChild;\n        shape.style.behavior = 'url(#default#VML)';\n\n        return shape && (typeof shape.adj === 'object');\n\n    } catch (e) {\n        return false;\n    }\n}());\n\nexport var columnCount = ( 'columnCount' in style );\nexport var classList = ( document.documentElement.classList !== undefined );\n\nfunction userAgentContains(str) {\n    return navigator.userAgent.toLowerCase().indexOf(str) >= 0;\n}\n","import * as Util from './Util';\r\n\r\n// @class Class\r\n// @aka L.Class\r\n\r\n// @section\r\n// @uninheritable\r\n\r\n// Thanks to John Resig and Dean Edwards for inspiration!\r\n\r\nexport function Class() {}\r\n\r\nClass.extend = function (props) {\r\n\r\n\t// @function extend(props: Object): Function\r\n\t// [Extends the current class](#class-inheritance) given the properties to be included.\r\n\t// Returns a Javascript function that is a class constructor (to be called with `new`).\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tthis.callInitHooks();\r\n\t};\r\n\r\n\tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n\tvar proto = Util.create(parentProto);\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t// inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tUtil.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tcheckDeprecatedMixinEvents(props.includes);\r\n\t\tUtil.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (proto.options) {\r\n\t\tprops.options = Util.extend(Util.create(proto.options), props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tUtil.extend(proto, props);\r\n\t\r\n\tproto._initHooks = [];\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parentProto.callInitHooks) {\r\n\t\t\tparentProto.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// @function include(properties: Object): this\r\n// [Includes a mixin](#class-includes) into the current class.\r\nClass.include = function (props) {\r\n\tUtil.extend(this.prototype, props);\r\n\treturn this;\r\n};\r\n\r\n// @function mergeOptions(options: Object): this\r\n// [Merges `options`](#class-options) into the defaults of the class.\r\nClass.mergeOptions = function (options) {\r\n\tUtil.extend(this.prototype.options, options);\r\n\treturn this;\r\n};\r\n\r\n// @function addInitHook(fn: Function): this\r\n// Adds a [constructor hook](#class-constructor-hooks) to the class.\r\nClass.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n\treturn this;\r\n};\r\n\r\nfunction checkDeprecatedMixinEvents(includes) {\r\n\tif (!cozy || !cozy.Mixin) { return; }\r\n\r\n\tincludes = cozy.Util.isArray(includes) ? includes : [includes];\r\n\r\n\t// for (var i = 0; i < includes.length; i++) {\r\n\t// \tif (includes[i] === cozy.Mixin.Events) {\r\n\t// \t\tconsole.warn('Deprecated include of cozy.Mixin.Events: ' +\r\n\t// \t\t\t'this property will be removed in future releases, ' +\r\n\t// \t\t\t'please inherit from cozy.Evented instead.', new Error().stack);\r\n\t// \t}\r\n\t// }\r\n}\r\n","import {Class} from './Class';\r\nimport * as Util from './Util';\r\n\r\n/*\r\n * @class Evented\r\n * @aka L.Evented\r\n * @inherits Class\r\n *\r\n * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * map.on('click', function(e) {\r\n * \talert(e.latlng);\r\n * } );\r\n * ```\r\n *\r\n * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:\r\n *\r\n * ```js\r\n * function onClick(e) { ... }\r\n *\r\n * map.on('click', onClick);\r\n * map.off('click', onClick);\r\n * ```\r\n */\r\n\r\nexport var Evented = Class.extend({\r\n\r\n\t/* @method on(type: String, fn: Function, context?: Object): this\r\n\t * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).\r\n\t *\r\n\t * @alternative\r\n\t * @method on(eventMap: Object): this\r\n\t * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\t */\r\n\ton: function (types, fn, context) {\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\t// we don't process space-separated events here for performance;\r\n\t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n\t\t\t\tthis._on(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._on(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/* @method off(type: String, fn?: Function, context?: Object): this\r\n\t * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.\r\n\t *\r\n\t * @alternative\r\n\t * @method off(eventMap: Object): this\r\n\t * Removes a set of type/listener pairs.\r\n\t *\r\n\t * @alternative\r\n\t * @method off: this\r\n\t * Removes all listeners to all events on the object.\r\n\t */\r\n\toff: function (types, fn, context) {\r\n\r\n\t\tif (!types) {\r\n\t\t\t// clear all listeners if called without arguments\r\n\t\t\tdelete this._events;\r\n\r\n\t\t} else if (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis._off(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._off(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// attach listener (without syntactic sugar now)\r\n\t_on: function (type, fn, context) {\r\n\t\tthis._events = this._events || {};\r\n\r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._events[type];\r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._events[type] = typeListeners;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\t// Less memory footprint.\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\t\tvar newListener = {fn: fn, ctx: context},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if fn already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].fn === fn && listeners[i].ctx === context) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlisteners.push(newListener);\r\n\t},\r\n\r\n\t_off: function (type, fn, context) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n\r\n\t\tif (!this._events) { return; }\r\n\r\n\t\tlisteners = this._events[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!fn) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].fn = Util.falseFn;\r\n\t\t\t}\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._events[type];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find fn and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.ctx !== context) { continue; }\r\n\t\t\t\tif (l.fn === fn) {\r\n\r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\tl.fn = Util.falseFn;\r\n\r\n\t\t\t\t\tif (this._firingCount) {\r\n\t\t\t\t\t\t/* copy array in case events are being fired */\r\n\t\t\t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners.splice(i, 1);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// @method fire(type: String, data?: Object, propagate?: Boolean): this\r\n\t// Fires an event of the specified type. You can optionally provide an data\r\n\t// object — the first argument of the listener function will contain its\r\n\t// properties. The event can optionally be propagated to event parents.\r\n\tfire: function (type, data, propagate) {\r\n\t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n\t\tvar event = Util.extend({}, data, {type: type, target: this});\r\n\r\n\t\tif (this._events) {\r\n\t\t\tvar listeners = this._events[type];\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n\t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tvar l = listeners[i];\r\n\t\t\t\t\tl.fn.call(l.ctx || this, event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._firingCount--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// propagate the event to parents (set with addEventParent)\r\n\t\t\tthis._propagateEvent(event);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method listens(type: String): Boolean\r\n\t// Returns `true` if a particular event type has any listeners attached to it.\r\n\tlistens: function (type, propagate) {\r\n\t\tvar listeners = this._events && this._events[type];\r\n\t\tif (listeners && listeners.length) { return true; }\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// also check parents for listeners if event propagates\r\n\t\t\tfor (var id in this._eventParents) {\r\n\t\t\t\tif (this._eventParents[id].listens(type, propagate)) { return true; }\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// @method once(…): this\r\n\t// Behaves as [`on(…)`](#evented-on), except the listener will only get fired once and then removed.\r\n\tonce: function (types, fn, context) {\r\n\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis.once(type, types[type], fn);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar handler = Util.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .off(types, fn, context)\r\n\t\t\t    .off(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\t// add a listener that's executed once and removed after that\r\n\t\treturn this\r\n\t\t    .on(types, fn, context)\r\n\t\t    .on(types, handler, context);\r\n\t},\r\n\r\n\t// @method addEventParent(obj: Evented): this\r\n\t// Adds an event parent - an `Evented` that will receive propagated events\r\n\taddEventParent: function (obj) {\r\n\t\tthis._eventParents = this._eventParents || {};\r\n\t\tthis._eventParents[Util.stamp(obj)] = obj;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method removeEventParent(obj: Evented): this\r\n\t// Removes an event parent, so it will stop receiving propagated events\r\n\tremoveEventParent: function (obj) {\r\n\t\tif (this._eventParents) {\r\n\t\t\tdelete this._eventParents[Util.stamp(obj)];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\tfor (var id in this._eventParents) {\r\n\t\t\tthis._eventParents[id].fire(e.type, Util.extend({layer: e.target}, e), true);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar proto = Evented.prototype;\r\n\r\n// aliases; we should ditch those eventually\r\n\r\n// @method addEventListener(…): this\r\n// Alias to [`on(…)`](#evented-on)\r\nproto.addEventListener = proto.on;\r\n\r\n// @method removeEventListener(…): this\r\n// Alias to [`off(…)`](#evented-off)\r\n\r\n// @method clearAllEventListeners(…): this\r\n// Alias to [`off()`](#evented-off)\r\nproto.removeEventListener = proto.clearAllEventListeners = proto.off;\r\n\r\n// @method addOneTimeEventListener(…): this\r\n// Alias to [`once(…)`](#evented-once)\r\nproto.addOneTimeEventListener = proto.once;\r\n\r\n// @method fireEvent(…): this\r\n// Alias to [`fire(…)`](#evented-fire)\r\nproto.fireEvent = proto.fire;\r\n\r\n// @method hasEventListeners(…): Boolean\r\n// Alias to [`listens(…)`](#evented-listens)\r\nproto.hasEventListeners = proto.listens;\r\n","/*\n * @namespace Util\n *\n * Various utility functions, used by Leaflet internally.\n */\n\n// @function extend(dest: Object, src?: Object): Object\n// Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.\nexport function extend(dest) {\n    var i, j, len, src;\n\n    for (j = 1, len = arguments.length; j < len; j++) {\n        src = arguments[j];\n        for (i in src) {\n            dest[i] = src[i];\n        }\n    }\n    return dest;\n}\n\n// @function create(proto: Object, properties?: Object): Object\n// Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\nexport var create = Object.create || (function () {\n    function F() {}\n    return function (proto) {\n        F.prototype = proto;\n        return new F();\n    };\n})();\n\n// @function bind(fn: Function, …): Function\n// Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n// Has a `L.bind()` shortcut.\nexport function bind(fn, obj) {\n    var slice = Array.prototype.slice;\n\n    if (fn.bind) {\n        return fn.bind.apply(fn, slice.call(arguments, 1));\n    }\n\n    var args = slice.call(arguments, 2);\n\n    return function () {\n        return fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\n    };\n}\n\n// @property lastId: Number\n// Last unique ID used by [`stamp()`](#util-stamp)\nexport var lastId = 0;\n\n// @function stamp(obj: Object): Number\n// Returns the unique ID of an object, assiging it one if it doesn't have it.\nexport function stamp(obj) {\n    /*eslint-disable */\n    obj._cozy_id = obj._cozy_id || ++lastId;\n    return obj._cozy_id; /* not leaflet */\n    /*eslint-enable */\n}\n\n// @function throttle(fn: Function, time: Number, context: Object): Function\n// Returns a function which executes function `fn` with the given scope `context`\n// (so that the `this` keyword refers to `context` inside `fn`'s code). The function\n// `fn` will be called no more than one time per given amount of `time`. The arguments\n// received by the bound function will be any arguments passed when binding the\n// function, followed by any arguments passed when invoking the bound function.\n// Has an `L.throttle` shortcut.\nexport function throttle(fn, time, context) {\n    var lock, args, wrapperFn, later;\n\n    later = function () {\n        // reset lock and call if queued\n        lock = false;\n        if (args) {\n            wrapperFn.apply(context, args);\n            args = false;\n        }\n    };\n\n    wrapperFn = function () {\n        if (lock) {\n            // called too soon, queue to call later\n            args = arguments;\n\n        } else {\n            // call and lock until later\n            fn.apply(context, arguments);\n            setTimeout(later, time);\n            lock = true;\n        }\n    };\n\n    return wrapperFn;\n}\n\n// @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number\n// Returns the number `num` modulo `range` in such a way so it lies within\n// `range[0]` and `range[1]`. The returned value will be always smaller than\n// `range[1]` unless `includeMax` is set to `true`.\nexport function wrapNum(x, range, includeMax) {\n    var max = range[1],\n        min = range[0],\n        d = max - min;\n    return x === max && includeMax ? x : ((x - min) % d + d) % d + min;\n}\n\n// @function falseFn(): Function\n// Returns a function which always returns `false`.\nexport function falseFn() { return false; }\n\n// @function formatNum(num: Number, digits?: Number): Number\n// Returns the number `num` rounded to `digits` decimals, or to 5 decimals by default.\nexport function formatNum(num, digits) {\n    var pow = Math.pow(10, digits || 5);\n    return Math.round(num * pow) / pow;\n}\n\n// @function isNumeric(num: Number): Boolean\n// Returns whether num is actually numeric\nexport function isNumeric(num) {\n  return !isNaN(parseFloat(num)) && isFinite(num);\n}\n\n// @function trim(str: String): String\n// Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)\nexport function trim(str) {\n    return str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\n}\n\n// @function splitWords(str: String): String[]\n// Trims and splits the string on whitespace and returns the array of parts.\nexport function splitWords(str) {\n    return trim(str).split(/\\s+/);\n}\n\n// @function setOptions(obj: Object, options: Object): Object\n// Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.\nexport function setOptions(obj, options) {\n    if (!obj.hasOwnProperty('options')) {\n        obj.options = obj.options ? create(obj.options) : {};\n    }\n    for (var i in options) {\n        obj.options[i] = options[i];\n    }\n    return obj.options;\n}\n\n// @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\n// Converts an object into a parameter URL string, e.g. `{a: \"foo\", b: \"bar\"}`\n// translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will\n// be appended at the end. If `uppercase` is `true`, the parameter names will\n// be uppercased (e.g. `'?A=foo&B=bar'`)\nexport function getParamString(obj, existingUrl, uppercase) {\n    var params = [];\n    for (var i in obj) {\n        params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\n    }\n    return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\n}\n\nvar templateRe = /\\{ *([\\w_\\-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values — they will be evaluated passing `data` as an argument.\nexport function template(str, data) {\n    return str.replace(templateRe, function (str, key) {\n        var value = data[key];\n\n        if (value === undefined) {\n            throw new Error('No value provided for variable ' + str);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n}\n\n// @function isArray(obj): Boolean\n// Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)\nexport var isArray = Array.isArray || function (obj) {\n    return (Object.prototype.toString.call(obj) === '[object Array]');\n};\n\n// @function indexOf(array: Array, el: Object): Number\n// Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)\nexport function indexOf(array, el) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i] === el) { return i; }\n    }\n    return -1;\n}\n\n// @property emptyImageUrl: String\n// Data URI string containing a base64-encoded empty GIF image.\n// Used as a hack to free memory from unused images on WebKit-powered\n// mobile devices (by setting image `src` to this string).\nexport var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n\nfunction getPrefixed(name) {\n    return window['webkit' + name] || window['moz' + name] || window['ms' + name];\n}\n\nvar lastTime = 0;\n\n// fallback for IE 7-8\nfunction timeoutDefer(fn) {\n    var time = +new Date(),\n        timeToCall = Math.max(0, 16 - (time - lastTime));\n\n    lastTime = time + timeToCall;\n    return window.setTimeout(fn, timeToCall);\n}\n\nexport var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\nexport var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\n        getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\n\n// @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number\n// Schedules `fn` to be executed when the browser repaints. `fn` is bound to\n// `context` if given. When `immediate` is set, `fn` is called immediately if\n// the browser doesn't have native support for\n// [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\n// otherwise it's delayed. Returns a request ID that can be used to cancel the request.\nexport function requestAnimFrame(fn, context, immediate) {\n    if (immediate && requestFn === timeoutDefer) {\n        fn.call(context);\n    } else {\n        return requestFn.call(window, bind(fn, context));\n    }\n}\n\n// @function cancelAnimFrame(id: Number): undefined\n// Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\nexport function cancelAnimFrame(id) {\n    if (id) {\n        cancelFn.call(window, id);\n    }\n}\n\nexport function inVp(elem, threshold = {}, container = null) {\n\n    if ( threshold instanceof HTMLElement ) {\n        container = threshold;\n        threshold = {};\n    }\n\n    threshold = Object.assign({\n        top: 0,\n        right: 0,\n        bottom: 0,\n        left: 0\n    }, threshold);\n\n    container = container || document.documentElement;\n\n    // Get the viewport dimensions\n    const vp = {\n        width: container.clientWidth,\n        height: container.clientHeight\n    };\n\n    // Get the viewport offset and size of the element.\n    // Normailze right and bottom to show offset from their\n    // respective edges istead of the top-left edges.\n    const box = elem.getBoundingClientRect();\n    const {\n        top,\n        left,\n        width,\n        height\n    } = box;\n    const right = vp.width - box.right;\n    const bottom = vp.height - box.bottom;\n\n    // Calculate which sides of the element are cut-off\n    // by the viewport.\n    const cutOff = {\n        top: top < threshold.top,\n        left: left < threshold.left,\n        bottom: bottom < threshold.bottom,\n        right: right < threshold.right\n    };\n\n    // Calculate which sides of the element are partially shown\n    const partial = {\n        top: cutOff.top && top > -height + threshold.top,\n        left: cutOff.left && left > -width + threshold.left,\n        bottom: cutOff.bottom && bottom > -height + threshold.bottom,\n        right: cutOff.right && right > -width + threshold.right\n    };\n\n    const isFullyVisible = top >= threshold.top &&\n        right >= threshold.right &&\n        bottom >= threshold.bottom &&\n        left >= threshold.left;\n\n    const isPartiallyVisible = partial.top ||\n        partial.right ||\n        partial.bottom ||\n        partial.left;\n\n\n    var elH = elem.offsetHeight;\n    var H = container.offsetHeight;\n    var percentage = Math.max(0, top > 0 ? Math.min(elH, H - top) : (box.bottom < H ? box.bottom : H));\n\n    // Calculate which edge of the element are visible.\n    // Every edge can have three states:\n    // - 'fully':     The edge is completely visible.\n    // - 'partially': Some part of the edge can be seen.\n    // - false:       The edge is not visible at all.\n    const edges = {\n        top: !isFullyVisible && !isPartiallyVisible ? false : ((!cutOff.top && !cutOff.left && !cutOff.right) && 'fully') ||\n            (!cutOff.top && 'partially') ||\n            false,\n        right: !isFullyVisible && !isPartiallyVisible ? false : ((!cutOff.right && !cutOff.top && !cutOff.bottom) && 'fully') ||\n            (!cutOff.right && 'partially') ||\n            false,\n        bottom: !isFullyVisible && !isPartiallyVisible ? false : ((!cutOff.bottom && !cutOff.left && !cutOff.right) && 'fully') ||\n            (!cutOff.bottom && 'partially') ||\n            false,\n        left: !isFullyVisible && !isPartiallyVisible ? false : ((!cutOff.left && !cutOff.top && !cutOff.bottom) && 'fully') ||\n            (!cutOff.left && 'partially') ||\n            false,\n        percentage: percentage\n    };\n\n    return {\n        fully: isFullyVisible,\n        partially: isPartiallyVisible,\n        edges\n    };\n}\n\nexport var loader = {\n    js: function(url) {\n        var handler = { _resolved: false };\n        handler.callbacks = [];\n        handler.error = [];\n        handler.then = function(cb) {\n            handler.callbacks.push(cb);\n            if ( handler._resolved ) { return handler.resolve(); }\n            return handler;\n        }\n        handler.catch = function(cb) {\n            handler.error.push(cb);\n            if ( handler._resolved ) { return handler.reject(); }\n            return handler;\n        }\n        handler.resolve = function(_argv) {\n            // var _argv;\n            handler._resolved = true;\n            while ( handler.callbacks.length ) {\n                var cb = handler.callbacks.shift();\n                var retval;\n                try {\n                    _argv = cb(_argv);\n                } catch(e) {\n                    console.log(e);\n                    handler.reject(e);\n                    break;\n                }\n            }\n            return handler;\n        }\n\n        handler.reject = function(e) {\n            while ( handler.error.length ) {\n                var cb = handler.error.shift();\n                cb(e);\n            }\n            console.log(e);\n            console.trace();\n            return handler;\n        }\n\n        if ( url == undefined ) {\n            handler._resolved = true;\n            return handler;\n        }\n\n        var element = document.createElement('script');\n\n        element.onload = function() {\n          handler.resolve(url);\n        };\n        element.onerror = function() {\n          handler.catch.apply(arguments);\n        };\n\n        element.async = true;\n        var parent = 'body';\n        var attr = 'src';\n        element[attr] = url;\n        document[parent].appendChild(element);\n\n        console.log(\"AHOY APPENDED\", url);\n\n        return handler;\n    }\n}","import {Evented} from './Events';\n\nvar Bus = Evented.extend({\n});\n\nvar instance;\nexport var bus = function() {\n  return instance || ( instance = new Bus() );\n}\n","import * as Browser from './Browser';\nexport {Browser};\n\nexport {Class} from './Class';\n\nimport {Evented} from './Events';\nexport {Evented};\nexport var Mixin = {Events: Evented.prototype};\n\nimport * as Util from './Util';\nexport {Util};\nexport {extend, bind, stamp, setOptions, inVp} from './Util';\nexport {bus} from './Bus';\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport * as Browser from '../core/Browser';\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\n\nvar POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown',\n    POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove',\n    POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup',\n    POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n    TAG_WHITE_LIST = ['INPUT', 'SELECT', 'OPTION'],\n\n    _pointers = {},\n    _pointerDocListener = false;\n\n// DomEvent.DoubleTap needs to know about this\nexport var _pointersCount = 0;\n\n// Provides a touch events wrapper for (ms)pointer events.\n// ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\nexport function addPointerListener(obj, type, handler, id) {\n\tif (type === 'touchstart') {\n\t\t_addPointerStart(obj, handler, id);\n\n\t} else if (type === 'touchmove') {\n\t\t_addPointerMove(obj, handler, id);\n\n\t} else if (type === 'touchend') {\n\t\t_addPointerEnd(obj, handler, id);\n\t}\n\n\treturn this;\n}\n\nexport function removePointerListener(obj, type, id) {\n\tvar handler = obj['_leaflet_' + type + id];\n\n\tif (type === 'touchstart') {\n\t\tobj.removeEventListener(POINTER_DOWN, handler, false);\n\n\t} else if (type === 'touchmove') {\n\t\tobj.removeEventListener(POINTER_MOVE, handler, false);\n\n\t} else if (type === 'touchend') {\n\t\tobj.removeEventListener(POINTER_UP, handler, false);\n\t\tobj.removeEventListener(POINTER_CANCEL, handler, false);\n\t}\n\n\treturn this;\n}\n\nfunction _addPointerStart(obj, handler, id) {\n\tvar onDown = Util.bind(function (e) {\n\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\n\t\t\t// In IE11, some touch events needs to fire for form controls, or\n\t\t\t// the controls will stop working. We keep a whitelist of tag names that\n\t\t\t// need these events. For other target tags, we prevent default on the event.\n\t\t\tif (TAG_WHITE_LIST.indexOf(e.target.tagName) < 0) {\n\t\t\t\tDomEvent.preventDefault(e);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t_handlePointer(e, handler);\n\t});\n\n\tobj['_leaflet_touchstart' + id] = onDown;\n\tobj.addEventListener(POINTER_DOWN, onDown, false);\n\n\t// need to keep track of what pointers and how many are active to provide e.touches emulation\n\tif (!_pointerDocListener) {\n\t\t// we listen documentElement as any drags that end by moving the touch off the screen get fired there\n\t\tdocument.documentElement.addEventListener(POINTER_DOWN, _globalPointerDown, true);\n\t\tdocument.documentElement.addEventListener(POINTER_MOVE, _globalPointerMove, true);\n\t\tdocument.documentElement.addEventListener(POINTER_UP, _globalPointerUp, true);\n\t\tdocument.documentElement.addEventListener(POINTER_CANCEL, _globalPointerUp, true);\n\n\t\t_pointerDocListener = true;\n\t}\n}\n\nfunction _globalPointerDown(e) {\n\t_pointers[e.pointerId] = e;\n\t_pointersCount++;\n}\n\nfunction _globalPointerMove(e) {\n\tif (_pointers[e.pointerId]) {\n\t\t_pointers[e.pointerId] = e;\n\t}\n}\n\nfunction _globalPointerUp(e) {\n\tdelete _pointers[e.pointerId];\n\t_pointersCount--;\n}\n\nfunction _handlePointer(e, handler) {\n\te.touches = [];\n\tfor (var i in _pointers) {\n\t\te.touches.push(_pointers[i]);\n\t}\n\te.changedTouches = [e];\n\n\thandler(e);\n}\n\nfunction _addPointerMove(obj, handler, id) {\n\tvar onMove = function (e) {\n\t\t// don't fire touch moves when mouse isn't down\n\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchmove' + id] = onMove;\n\tobj.addEventListener(POINTER_MOVE, onMove, false);\n}\n\nfunction _addPointerEnd(obj, handler, id) {\n\tvar onUp = function (e) {\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchend' + id] = onUp;\n\tobj.addEventListener(POINTER_UP, onUp, false);\n\tobj.addEventListener(POINTER_CANCEL, onUp, false);\n}\n\n","import * as Browser from '../core/Browser';\r\nimport {_pointersCount} from './DomEvent.Pointer';\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nvar _touchstart = Browser.msPointer ? 'MSPointerDown' : Browser.pointer ? 'pointerdown' : 'touchstart',\r\n    _touchend = Browser.msPointer ? 'MSPointerUp' : Browser.pointer ? 'pointerup' : 'touchend',\r\n    _pre = '_leaflet_';\r\n\r\n// inspired by Zepto touch code by Thomas Fuchs\r\nexport function addDoubleTapListener(obj, handler, id) {\r\n\tvar last, touch,\r\n\t    doubleTap = false,\r\n\t    delay = 250;\r\n\r\n\tfunction onTouchStart(e) {\r\n\t\tvar count;\r\n\r\n\t\tif (Browser.pointer) {\r\n\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\tcount = _pointersCount;\r\n\t\t} else {\r\n\t\t\tcount = e.touches.length;\r\n\t\t}\r\n\r\n\t\tif (count > 1) { return; }\r\n\r\n\t\tvar now = Date.now(),\r\n\t\t    delta = now - (last || now);\r\n\r\n\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\tlast = now;\r\n\t}\r\n\r\n\tfunction onTouchEnd(e) {\r\n\t\tif (doubleTap && !touch.cancelBubble) {\r\n\t\t\tif (Browser.pointer) {\r\n\t\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\tvar newTouch = {},\r\n\t\t\t\t    prop, i;\r\n\r\n\t\t\t\tfor (i in touch) {\r\n\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\tnewTouch[i] = prop && prop.bind ? prop.bind(touch) : prop;\r\n\t\t\t\t}\r\n\t\t\t\ttouch = newTouch;\r\n\t\t\t}\r\n\t\t\ttouch.type = 'dblclick';\r\n\t\t\thandler(touch);\r\n\t\t\tlast = null;\r\n\t\t}\r\n\t}\r\n\r\n\tobj[_pre + _touchstart + id] = onTouchStart;\r\n\tobj[_pre + _touchend + id] = onTouchEnd;\r\n\tobj[_pre + 'dblclick' + id] = handler;\r\n\r\n\tobj.addEventListener(_touchstart, onTouchStart, false);\r\n\tobj.addEventListener(_touchend, onTouchEnd, false);\r\n\r\n\t// On some platforms (notably, chrome<55 on win10 + touchscreen + mouse),\r\n\t// the browser doesn't fire touchend/pointerup events but does fire\r\n\t// native dblclicks. See #4127.\r\n\t// Edge 14 also fires native dblclicks, but only for pointerType mouse, see #5180.\r\n\tobj.addEventListener('dblclick', handler, false);\r\n\r\n\treturn this;\r\n}\r\n\r\nexport function removeDoubleTapListener(obj, id) {\r\n\tvar touchstart = obj[_pre + _touchstart + id],\r\n\t    touchend = obj[_pre + _touchend + id],\r\n\t    dblclick = obj[_pre + 'dblclick' + id];\r\n\r\n\tobj.removeEventListener(_touchstart, touchstart, false);\r\n\tobj.removeEventListener(_touchend, touchend, false);\r\n\tif (!Browser.edge) {\r\n\t\tobj.removeEventListener('dblclick', dblclick, false);\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n","import {Point} from '../geometry/Point';\r\nimport * as Util from '../core/Util';\r\nimport * as Browser from '../core/Browser';\r\nimport {addPointerListener, removePointerListener} from './DomEvent.Pointer';\r\nimport {addDoubleTapListener, removeDoubleTapListener} from './DomEvent.DoubleTap';\r\n\r\n/*\r\n * @namespace DomEvent\r\n * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.\r\n */\r\n\r\n// Inspired by John Resig, Dean Edwards and YUI addEvent implementations.\r\n\r\n// @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Adds a listener function (`fn`) to a particular DOM event type of the\r\n// element `el`. You can optionally specify the context of the listener\r\n// (object the `this` keyword will point to). You can also pass several\r\n// space-separated types (e.g. `'click dblclick'`).\r\n\r\n// @alternative\r\n// @function on(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\nexport function on(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\taddOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\taddOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\n// @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Removes a previously added listener function. If no function is specified,\r\n// it will remove all the listeners of that particular DOM event from the element.\r\n// Note that if you passed a custom context to on, you must pass the same\r\n// context to `off` in order to remove the listener.\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement): this\r\n// Removes all known event listeners\r\nexport function off(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\tremoveOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else if (types) {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\tremoveOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var j in obj[eventsKey]) {\r\n\t\t\tremoveOne(obj, j, obj[eventsKey][j]);\r\n\t\t}\r\n\t\tdelete obj[eventsKey];\r\n\t}\r\n}\r\n\r\nfunction addOne(obj, type, fn, context) {\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : '');\r\n\r\n\tif (obj[eventsKey] && obj[eventsKey][id]) { return this; }\r\n\r\n\tvar handler = function (e) {\r\n\t\treturn fn.call(context || obj, e || window.event);\r\n\t};\r\n\r\n\tvar originalHandler = handler;\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t// Needs DomEvent.Pointer.js\r\n\t\taddPointerListener(obj, type, handler, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && addDoubleTapListener &&\r\n\t           !(Browser.pointer && Browser.chrome)) {\r\n\t\t// Chrome >55 does not need the synthetic dblclicks from addDoubleTapListener\r\n\t\t// See #5180\r\n\t\taddDoubleTapListener(obj, handler, id);\r\n\r\n\t} else if ('addEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.addEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\thandler = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif (isExternalTarget(obj, e)) {\r\n\t\t\t\t\toriginalHandler(e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tobj.addEventListener(type === 'mouseenter' ? 'mouseover' : 'mouseout', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tif (type === 'click' && Browser.android) {\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tfilterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('attachEvent' in obj) {\r\n\t\tobj.attachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey] = obj[eventsKey] || {};\r\n\tobj[eventsKey][id] = handler;\r\n}\r\n\r\nfunction removeOne(obj, type, fn, context) {\r\n\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : ''),\r\n\t    handler = obj[eventsKey] && obj[eventsKey][id];\r\n\r\n\tif (!handler) { return this; }\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\tremovePointerListener(obj, type, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && removeDoubleTapListener) {\r\n\t\tremoveDoubleTapListener(obj, id);\r\n\r\n\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.removeEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tobj.removeEventListener(\r\n\t\t\t\ttype === 'mouseenter' ? 'mouseover' :\r\n\t\t\t\ttype === 'mouseleave' ? 'mouseout' : type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('detachEvent' in obj) {\r\n\t\tobj.detachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey][id] = null;\r\n}\r\n\r\n// @function stopPropagation(ev: DOMEvent): this\r\n// Stop the given event from propagation to parent elements. Used inside the listener functions:\r\n// ```js\r\n// L.DomEvent.on(div, 'click', function (ev) {\r\n// \tL.DomEvent.stopPropagation(ev);\r\n// });\r\n// ```\r\nexport function stopPropagation(e) {\r\n\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else if (e.originalEvent) {  // In case of Leaflet event.\r\n\t\te.originalEvent._stopped = true;\r\n\t} else {\r\n\t\te.cancelBubble = true;\r\n\t}\r\n\tskipped(e);\r\n\r\n\treturn this;\r\n}\r\n\r\n// @function disableScrollPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'mousewheel'` events (plus browser variants).\r\nexport function disableScrollPropagation(el) {\r\n\treturn addOne(el, 'mousewheel', stopPropagation);\r\n}\r\n\r\n// @function disableClickPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'click'`, `'doubleclick'`,\r\n// `'mousedown'` and `'touchstart'` events (plus browser variants).\r\nexport function disableClickPropagation(el) {\r\n\ton(el, 'mousedown touchstart dblclick', stopPropagation);\r\n\taddOne(el, 'click', fakeStop);\r\n\treturn this;\r\n}\r\n\r\n// @function preventDefault(ev: DOMEvent): this\r\n// Prevents the default action of the DOM Event `ev` from happening (such as\r\n// following a link in the href of the a element, or doing a POST request\r\n// with page reload when a `<form>` is submitted).\r\n// Use it inside listener functions.\r\nexport function preventDefault(e) {\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// @function stop(ev): this\r\n// Does `stopPropagation` and `preventDefault` at the same time.\r\nexport function stop(e) {\r\n\tpreventDefault(e);\r\n\tstopPropagation(e);\r\n\treturn this;\r\n}\r\n\r\n// @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point\r\n// Gets normalized mouse position from a DOM event relative to the\r\n// `container` or to the whole page if not specified.\r\nexport function getMousePosition(e, container) {\r\n\tif (!container) {\r\n\t\treturn new Point(e.clientX, e.clientY);\r\n\t}\r\n\r\n\tvar rect = container.getBoundingClientRect();\r\n\r\n\treturn new Point(\r\n\t\te.clientX - rect.left - container.clientLeft,\r\n\t\te.clientY - rect.top - container.clientTop);\r\n}\r\n\r\n// Chrome on Win scrolls double the pixels as in other platforms (see #4538),\r\n// and Firefox scrolls device pixels, not CSS pixels\r\nvar wheelPxFactor =\r\n\t(Browser.win && Browser.chrome) ? 2 :\r\n\tBrowser.gecko ? window.devicePixelRatio : 1;\r\n\r\n// @function getWheelDelta(ev: DOMEvent): Number\r\n// Gets normalized wheel delta from a mousewheel DOM event, in vertical\r\n// pixels scrolled (negative if scrolling down).\r\n// Events from pointing devices without precise scrolling are mapped to\r\n// a best guess of 60 pixels.\r\nexport function getWheelDelta(e) {\r\n\treturn (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta\r\n\t       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels\r\n\t       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines\r\n\t       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages\r\n\t       (e.deltaX || e.deltaZ) ? 0 :\t// Skip horizontal/depth wheel events\r\n\t       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels\r\n\t       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines\r\n\t       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages\r\n\t       0;\r\n}\r\n\r\nvar skipEvents = {};\r\n\r\nexport function fakeStop(e) {\r\n\t// fakes stopPropagation by setting a special event flag, checked/reset with skipped(e)\r\n\tskipEvents[e.type] = true;\r\n}\r\n\r\nexport function skipped(e) {\r\n\tvar events = skipEvents[e.type];\r\n\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\tskipEvents[e.type] = false;\r\n\treturn events;\r\n}\r\n\r\n// check if element really left/entered the event target (for mouseenter/mouseleave)\r\nexport function isExternalTarget(el, e) {\r\n\r\n\tvar related = e.relatedTarget;\r\n\r\n\tif (!related) { return true; }\r\n\r\n\ttry {\r\n\t\twhile (related && (related !== el)) {\r\n\t\t\trelated = related.parentNode;\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn false;\r\n\t}\r\n\treturn (related !== el);\r\n}\r\n\r\nvar lastClick;\r\n\r\n// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\nfunction filterClick(e, handler) {\r\n\tvar timeStamp = (e.timeStamp || (e.originalEvent && e.originalEvent.timeStamp)),\r\n\t    elapsed = lastClick && (timeStamp - lastClick);\r\n\r\n\t// are they closer together than 500ms yet more than 100ms?\r\n\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t// on the same event should be triggered far faster;\r\n\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\tstop(e);\r\n\t\treturn;\r\n\t}\r\n\tlastClick = timeStamp;\r\n\r\n\thandler(e);\r\n}\r\n\r\n// @function addListener(…): this\r\n// Alias to [`L.DomEvent.on`](#domevent-on)\r\nexport {on as addListener};\r\n\r\n// @function removeListener(…): this\r\n// Alias to [`L.DomEvent.off`](#domevent-off)\r\nexport {off as removeListener};\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport {Point} from '../geometry/Point';\nimport * as Browser from '../core/Browser';\n\n/*\n * @namespace DomUtil\n *\n * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\n * tree, used by Leaflet internally.\n *\n * Most functions expecting or returning a `HTMLElement` also work for\n * SVG elements. The only difference is that classes refer to CSS classes\n * in HTML and SVG classes in SVG.\n */\n\n if (!Element.prototype.matches) {\n    var ep = Element.prototype;\n \n    if (ep.webkitMatchesSelector) // Chrome <34, SF<7.1, iOS<8\n      ep.matches = ep.webkitMatchesSelector;\n \n    if (ep.msMatchesSelector) // IE9/10/11 & Edge\n      ep.matches = ep.msMatchesSelector;\n \n    if (ep.mozMatchesSelector) // FF<34\n      ep.matches = ep.mozMatchesSelector;\n }\n\n// @property TRANSFORM: String\n// Vendor-prefixed fransform style name (e.g. `'webkitTransform'` for WebKit).\nexport var TRANSFORM = testProp(\n    ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\n\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\n// the same for the transitionend event, in particular the Android 4.1 stock browser\n\n// @property TRANSITION: String\n// Vendor-prefixed transform style name.\nexport var TRANSITION = testProp(\n    ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\n\nexport var TRANSITION_END =\n    TRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';\n\n\n// @function get(id: String|HTMLElement): HTMLElement\n// Returns an element given its DOM id, or returns the element itself\n// if it was passed directly.\nexport function get(id) {\n    return typeof id === 'string' ? document.getElementById(id) : id;\n}\n\n// @function getStyle(el: HTMLElement, styleAttrib: String): String\n// Returns the value for a certain style attribute on an element,\n// including computed values or values set through CSS.\nexport function getStyle(el, style) {\n    var value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\n\n    if ((!value || value === 'auto') && document.defaultView) {\n        var css = document.defaultView.getComputedStyle(el, null);\n        value = css ? css[style] : null;\n    }\n    return value === 'auto' ? null : value;\n}\n\n// @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\n// Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\nexport function create(tagName, className, container) {\n    var el = document.createElement(tagName);\n    el.className = className || '';\n\n    if (container) {\n        container.appendChild(el);\n    }\n    return el;\n}\n\n// @function remove(el: HTMLElement)\n// Removes `el` from its parent element\nexport function remove(el) {\n    var parent = el.parentNode;\n    if (parent) {\n        parent.removeChild(el);\n    }\n}\n\n// @function empty(el: HTMLElement)\n// Removes all of `el`'s children elements from `el`\nexport function empty(el) {\n    while (el.firstChild) {\n        el.removeChild(el.firstChild);\n    }\n}\n\n// @function toFront(el: HTMLElement)\n// Makes `el` the last child of its parent, so it renders in front of the other children.\nexport function toFront(el) {\n    el.parentNode.appendChild(el);\n}\n\n// @function toBack(el: HTMLElement)\n// Makes `el` the first child of its parent, so it renders behind the other children.\nexport function toBack(el) {\n    var parent = el.parentNode;\n    parent.insertBefore(el, parent.firstChild);\n}\n\n// @function hasClass(el: HTMLElement, name: String): Boolean\n// Returns `true` if the element's class attribute contains `name`.\nexport function hasClass(el, name) {\n    if (el.classList !== undefined) {\n        return el.classList.contains(name);\n    }\n    var className = getClass(el);\n    return className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\n}\n\n// @function addClass(el: HTMLElement, name: String)\n// Adds `name` to the element's class attribute.\nexport function addClass(el, name) {\n    if (el.classList !== undefined) {\n        var classes = Util.splitWords(name);\n        for (var i = 0, len = classes.length; i < len; i++) {\n            el.classList.add(classes[i]);\n        }\n    } else if (!hasClass(el, name)) {\n        var className = getClass(el);\n        setClass(el, (className ? className + ' ' : '') + name);\n    }\n}\n\n// @function removeClass(el: HTMLElement, name: String)\n// Removes `name` from the element's class attribute.\nexport function removeClass(el, name) {\n    if (el.classList !== undefined) {\n        el.classList.remove(name);\n    } else {\n        setClass(el, Util.trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\n    }\n}\n\n// @function setClass(el: HTMLElement, name: String)\n// Sets the element's class.\nexport function setClass(el, name) {\n    if (el.className.baseVal === undefined) {\n        el.className = name;\n    } else {\n        // in case of SVG element\n        el.className.baseVal = name;\n    }\n}\n\n// @function getClass(el: HTMLElement): String\n// Returns the element's class.\nexport function getClass(el) {\n    return el.className.baseVal === undefined ? el.className : el.className.baseVal;\n}\n\n// @function setOpacity(el: HTMLElement, opacity: Number)\n// Set the opacity of an element (including old IE support).\n// `opacity` must be a number from `0` to `1`.\nexport function setOpacity(el, value) {\n    if ('opacity' in el.style) {\n        el.style.opacity = value;\n    } else if ('filter' in el.style) {\n        _setOpacityIE(el, value);\n    }\n}\n\nfunction _setOpacityIE(el, value) {\n    var filter = false,\n        filterName = 'DXImageTransform.Microsoft.Alpha';\n\n    // filters collection throws an error if we try to retrieve a filter that doesn't exist\n    try {\n        filter = el.filters.item(filterName);\n    } catch (e) {\n        // don't set opacity to 1 if we haven't already set an opacity,\n        // it isn't needed and breaks transparent pngs.\n        if (value === 1) { return; }\n    }\n\n    value = Math.round(value * 100);\n\n    if (filter) {\n        filter.Enabled = (value !== 100);\n        filter.Opacity = value;\n    } else {\n        el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\n    }\n}\n\n// @function testProp(props: String[]): String|false\n// Goes through the array of style names and returns the first name\n// that is a valid style name for an element. If no such name is found,\n// it returns false. Useful for vendor-prefixed styles like `transform`.\nexport function testProp(props) {\n    var style = document.documentElement.style;\n\n    for (var i = 0; i < props.length; i++) {\n        if (props[i] in style) {\n            return props[i];\n        }\n    }\n    return false;\n}\n\nexport function isPropertySupported(prop) {\n    var style = document.documentElement.style;\n    return prop in style;\n}\n\n// @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\n// Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\n// and optionally scaled by `scale`. Does not have an effect if the\n// browser doesn't support 3D CSS transforms.\nexport function setTransform(el, offset, scale) {\n    var pos = offset || new Point(0, 0);\n\n    el.style[TRANSFORM] =\n        (Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n}\n\n// @function setPosition(el: HTMLElement, position: Point)\n// Sets the position of `el` to coordinates specified by `position`,\n// using CSS translate or top/left positioning depending on the browser\n// (used by Leaflet internally to position its layers).\nexport function setPosition(el, point) {\n\n    /*eslint-disable */\n    el._leaflet_pos = point;\n    /*eslint-enable */\n\n    if (Browser.any3d) {\n        setTransform(el, point);\n    } else {\n        el.style.left = point.x + 'px';\n        el.style.top = point.y + 'px';\n    }\n}\n\n// @function getPosition(el: HTMLElement): Point\n// Returns the coordinates of an element previously positioned with setPosition.\nexport function getPosition(el) {\n    // this method is only used for elements previously positioned using setPosition,\n    // so it's safe to cache the position for performance\n\n    return el._leaflet_pos || new Point(0, 0);\n}\n\n// @function disableTextSelection()\n// Prevents the user from generating `selectstart` DOM events, usually generated\n// when the user drags the mouse through a page with text. Used internally\n// by Leaflet to override the behaviour of any click-and-drag interaction on\n// the map. Affects drag interactions on the whole document.\n\n// @function enableTextSelection()\n// Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).\nexport var disableTextSelection;\nexport var enableTextSelection;\nvar _userSelect;\nif ('onselectstart' in document) {\n    disableTextSelection = function () {\n        DomEvent.on(window, 'selectstart', DomEvent.preventDefault);\n    };\n    enableTextSelection = function () {\n        DomEvent.off(window, 'selectstart', DomEvent.preventDefault);\n    };\n} else {\n    var userSelectProperty = testProp(\n        ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\n\n    disableTextSelection = function () {\n        if (userSelectProperty) {\n            var style = document.documentElement.style;\n            _userSelect = style[userSelectProperty];\n            style[userSelectProperty] = 'none';\n        }\n    };\n    enableTextSelection = function () {\n        if (userSelectProperty) {\n            document.documentElement.style[userSelectProperty] = _userSelect;\n            _userSelect = undefined;\n        }\n    };\n}\n\n// @function disableImageDrag()\n// As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\n// for `dragstart` DOM events, usually generated when the user drags an image.\nexport function disableImageDrag() {\n    DomEvent.on(window, 'dragstart', DomEvent.preventDefault);\n}\n\n// @function enableImageDrag()\n// Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).\nexport function enableImageDrag() {\n    DomEvent.off(window, 'dragstart', DomEvent.preventDefault);\n}\n\nvar _outlineElement, _outlineStyle;\n// @function preventOutline(el: HTMLElement)\n// Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\n// of the element `el` invisible. Used internally by Leaflet to prevent\n// focusable elements from displaying an outline when the user performs a\n// drag interaction on them.\nexport function preventOutline(element) {\n    while (element.tabIndex === -1) {\n        element = element.parentNode;\n    }\n    if (!element || !element.style) { return; }\n    restoreOutline();\n    _outlineElement = element;\n    _outlineStyle = element.style.outline;\n    element.style.outline = 'none';\n    DomEvent.on(window, 'keydown', restoreOutline);\n}\n\n// @function restoreOutline()\n// Cancels the effects of a previous [`L.DomUtil.preventOutline`]().\nexport function restoreOutline() {\n    if (!_outlineElement) { return; }\n    _outlineElement.style.outline = _outlineStyle;\n    _outlineElement = undefined;\n    _outlineStyle = undefined;\n    DomEvent.off(window, 'keydown', restoreOutline);\n}\n","\nimport * as DomEvent from './DomEvent';\nexport {DomEvent};\n\nimport * as DomUtil from './DomUtil';\nexport {DomUtil};\n\n","import {isArray, formatNum} from '../core/Util';\r\n\r\n/*\r\n * @class Point\r\n * @aka L.Point\r\n *\r\n * Represents a point with `x` and `y` coordinates in pixels.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * var point = L.point(200, 300);\r\n * ```\r\n *\r\n * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:\r\n *\r\n * ```js\r\n * map.panBy([200, 300]);\r\n * map.panBy(L.point(200, 300));\r\n * ```\r\n */\r\n\r\nexport function Point(x, y, round) {\r\n\t// @property x: Number; The `x` coordinate of the point\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\t// @property y: Number; The `y` coordinate of the point\r\n\tthis.y = (round ? Math.round(y) : y);\r\n}\r\n\r\nPoint.prototype = {\r\n\r\n\t// @method clone(): Point\r\n\t// Returns a copy of the current point.\r\n\tclone: function () {\r\n\t\treturn new Point(this.x, this.y);\r\n\t},\r\n\r\n\t// @method add(otherPoint: Point): Point\r\n\t// Returns the result of addition of the current and the given points.\r\n\tadd: function (point) {\r\n\t\t// non-destructive, returns a new point\r\n\t\treturn this.clone()._add(toPoint(point));\r\n\t},\r\n\r\n\t_add: function (point) {\r\n\t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method subtract(otherPoint: Point): Point\r\n\t// Returns the result of subtraction of the given point from the current.\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(toPoint(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method divideBy(num: Number): Point\r\n\t// Returns the result of division of the current point by the given number.\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method multiplyBy(num: Number): Point\r\n\t// Returns the result of multiplication of the current point by the given number.\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method scaleBy(scale: Point): Point\r\n\t// Multiply each coordinate of the current point by each coordinate of\r\n\t// `scale`. In linear algebra terms, multiply the point by the\r\n\t// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)\r\n\t// defined by `scale`.\r\n\tscaleBy: function (point) {\r\n\t\treturn new Point(this.x * point.x, this.y * point.y);\r\n\t},\r\n\r\n\t// @method unscaleBy(scale: Point): Point\r\n\t// Inverse of `scaleBy`. Divide each coordinate of the current point by\r\n\t// each coordinate of `scale`.\r\n\tunscaleBy: function (point) {\r\n\t\treturn new Point(this.x / point.x, this.y / point.y);\r\n\t},\r\n\r\n\t// @method round(): Point\r\n\t// Returns a copy of the current point with rounded coordinates.\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method floor(): Point\r\n\t// Returns a copy of the current point with floored coordinates (rounded down).\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method ceil(): Point\r\n\t// Returns a copy of the current point with ceiled coordinates (rounded up).\r\n\tceil: function () {\r\n\t\treturn this.clone()._ceil();\r\n\t},\r\n\r\n\t_ceil: function () {\r\n\t\tthis.x = Math.ceil(this.x);\r\n\t\tthis.y = Math.ceil(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method distanceTo(otherPoint: Point): Number\r\n\t// Returns the cartesian distance between the current and the given points.\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\t// @method equals(otherPoint: Point): Boolean\r\n\t// Returns `true` if the given point has the same coordinates.\r\n\tequals: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\t// @method contains(otherPoint: Point): Boolean\r\n\t// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).\r\n\tcontains: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// Returns a string representation of the point for debugging purposes.\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        formatNum(this.x) + ', ' +\r\n\t\t        formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\n// @factory L.point(x: Number, y: Number, round?: Boolean)\r\n// Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Number[])\r\n// Expects an array of the form `[x, y]` instead.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Object)\r\n// Expects a plain object of the form `{x: Number, y: Number}` instead.\r\nexport function toPoint(x, y, round) {\r\n\tif (x instanceof Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (isArray(x)) {\r\n\t\treturn new Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\tif (typeof x === 'object' && 'x' in x && 'y' in x) {\r\n\t\treturn new Point(x.x, x.y);\r\n\t}\r\n\treturn new Point(x, y, round);\r\n}\r\n","var document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\nvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\nvar fn = (function () {\n  var val;\n\n  var fnMap = [\n    [\n      'requestFullscreen',\n      'exitFullscreen',\n      'fullscreenElement',\n      'fullscreenEnabled',\n      'fullscreenchange',\n      'fullscreenerror'\n    ],\n    // New WebKit\n    [\n      'webkitRequestFullscreen',\n      'webkitExitFullscreen',\n      'webkitFullscreenElement',\n      'webkitFullscreenEnabled',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    // Old WebKit (Safari 5.1)\n    [\n      'webkitRequestFullScreen',\n      'webkitCancelFullScreen',\n      'webkitCurrentFullScreenElement',\n      'webkitCancelFullScreen',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    [\n      'mozRequestFullScreen',\n      'mozCancelFullScreen',\n      'mozFullScreenElement',\n      'mozFullScreenEnabled',\n      'mozfullscreenchange',\n      'mozfullscreenerror'\n    ],\n    [\n      'msRequestFullscreen',\n      'msExitFullscreen',\n      'msFullscreenElement',\n      'msFullscreenEnabled',\n      'MSFullscreenChange',\n      'MSFullscreenError'\n    ]\n  ];\n\n  var i = 0;\n  var l = fnMap.length;\n  var ret = {};\n\n  for (; i < l; i++) {\n    val = fnMap[i];\n    if (val && val[1] in document) {\n      for (i = 0; i < val.length; i++) {\n        ret[fnMap[0][i]] = val[i];\n      }\n      return ret;\n    }\n  }\n\n  return false;\n})();\n\nvar eventNameMap = {\n  change: fn.fullscreenchange,\n  error: fn.fullscreenerror\n};\n\nvar screenfull = {\n  request: function (elem) {\n    var request = fn.requestFullscreen;\n\n    elem = elem || document.documentElement;\n\n    // Work around Safari 5.1 bug: reports support for\n    // keyboard in fullscreen even though it doesn't.\n    // Browser sniffing, since the alternative with\n    // setTimeout is even worse.\n    if (/5\\.1[.\\d]* Safari/.test(navigator.userAgent)) {\n      elem[request]();\n    } else {\n      elem[request](keyboardAllowed ? Element.ALLOW_KEYBOARD_INPUT : {});\n    }\n  },\n  exit: function () {\n    document[fn.exitFullscreen]();\n  },\n  toggle: function (elem) {\n    if (this.isFullscreen) {\n      this.exit();\n    } else {\n      this.request(elem);\n    }\n  },\n  onchange: function (callback) {\n    this.on('change', callback);\n  },\n  onerror: function (callback) {\n    this.on('error', callback);\n  },\n  on: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.addEventListener(eventName, callback, false);\n    }\n  },\n  off: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.removeEventListener(eventName, callback, false);\n    }\n  },\n  raw: fn\n};\n\nObject.defineProperties(screenfull, {\n  isFullscreen: {\n    get: function () {\n      return Boolean(document[fn.fullscreenElement]);\n    }\n  },\n  element: {\n    enumerable: true,\n    get: function () {\n      return document[fn.fullscreenElement];\n    }\n  },\n  enabled: {\n    enumerable: true,\n    get: function () {\n      // Coerce to boolean in case of old WebKit\n      return Boolean(document[fn.fullscreenEnabled]);\n    }\n  }\n});\n\nexport {screenfull};","import * as Util from '../core/Util';\nimport {Evented} from '../core/Events';\n// import {Class} from '../core/Class';\nimport * as Browser from '../core/Browser';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as DomUtil from '../dom/DomUtil';\n\nimport debounce from 'lodash/debounce';\nimport assign from 'lodash/assign';\n\nimport {screenfull} from '../screenfull';\n\n/*\n * @class Reader\n * @aka cozy.Map\n * @inherits Evented\n *\n * The central class of the API — it is used to create a book on a page and manipulate it.\n *\n * @example\n *\n * ```js\n * // initialize the map on the \"map\" div with a given center and zoom\n * var map = L.map('map', {\n *  center: [51.505, -0.09],\n *  zoom: 13\n * });\n * ```\n *\n */\n\nvar _padding = 1.0;\nexport var Reader = Evented.extend({\n  options: {\n    regions: [\n      'header',\n      'toolbar.top',\n      'toolbar.left',\n      'main',\n      'toolbar.right',\n      'toolbar.bottom',\n      'footer'\n    ],\n    metadata: {},\n    flow: 'auto',\n    engine: 'epubjs',\n    trackResize: true,\n    mobileMediaQuery: '(min-device-width : 300px) and (max-device-width : 600px)',\n    forceScrolledDocHeight: 1200,\n    rootfilePath: '',\n    text_size: 100,\n    scale: 100.0,\n    flowOptions: {},\n    theme: 'default',\n    themes: [],\n    injectStylesheet: null\n  },\n\n  initialize: function(id, options) {\n    var self = this\n\n    self._original_document_title = document.title;\n\n    if ( false && localStorage.getItem('cozy.options') ) {\n      options = assign(options, JSON.parse(localStorage.getItem('cozy.options')));\n      if ( options[this.flow] && options[this.flow].text_size ) {\n        options.text_size = options[this.flow].text_size;\n      }\n      if ( options[this.flow] && options[this.flow].scale ) {      \n        options.scale = options[this.flow].scale;\n      }\n    }\n\n    this._cozyOptions = {};\n    if ( localStorage.getItem('cozy.options') ) {\n      this._cozyOptions = JSON.parse(localStorage.getItem('cozy.options'));\n      if ( this._cozyOptions.theme ) {\n        this.options.theme = this._cozyOptions.theme;\n      }\n      // if ( this._cozyOptions.flow ) {\n      //   this.options.flow = this._cozyOptions.flow;\n      // }\n    }\n\n    options = Util.setOptions(this, options);\n\n    this._checkFeatureCompatibility();\n\n    this.metadata = this.options.metadata; // initial seed\n\n    this._initContainer(id);\n    this._initLayout();\n\n    if ( this.options.themes && this.options.themes.length > 0 ) {\n        this.options.themes.forEach(function(theme) {\n            if ( theme.href ) { return; }\n            var klass = theme.klass;\n            var rules = {};\n            for(var rule in theme.rules) {\n                var new_rule = '.' + klass;\n                if ( rule == 'body' ) { new_rule = 'body' + new_rule; }\n                else { new_rule += ' ' + rule ; }\n                rules[new_rule] = theme.rules[rule];\n            }\n            theme.rules = rules;\n        });\n    }\n\n    this._updateTheme();\n\n    // hack for https://github.com/Leaflet/Leaflet/issues/1980\n    // this._onResize = Util.bind(this._onResize, this);\n\n    this._initEvents();\n\n    this.callInitHooks();\n\n    this._mode = this.options.mode;\n  },\n\n  start: function(target, cb) {\n    var self = this;\n\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      cb = target;\n      target = undefined;\n    }\n\n    self._start(target, cb);\n\n    // Util.loader.js(this.options.engine_href).then(function() {\n    //   self._start(target, cb);\n    //   self._loaded = true;\n    // })\n  },\n\n  _start: function(target, cb) {\n    var self = this;\n    target = target || 0;\n\n    // self.open(function() {\n    //   self.draw(target, cb);\n    // });\n\n    self.open(target, cb);\n  },\n\n  reopen: function(options, target) {\n    /* NOP */\n  },\n\n  saveOptions: function(options) {\n    var saved_options = {};\n    if ( localStorage.getItem('cozy.options') ) {\n      saved_options = JSON.parse(localStorage.getItem('cozy.options'));\n    }\n\n    assign(saved_options, options);\n    var key = this.metadata.layout || 'reflowable';\n    var flow = saved_options.flow;\n    if ( saved_options.flow == 'auto' ) {\n      // do not save\n      delete saved_options.flow;\n      flow = this.metadata.flow || 'paginated';\n    }\n    // key += '/' + flow;\n\n    // var key = `${this.flow}/${this.metadata.layout}`;\n    // var key = this.metadata.layout;\n    if ( saved_options.text_size || saved_options.scale ) {\n      saved_options[key] = {};\n      if ( saved_options.text_size ) {\n        saved_options[key].text_size = saved_options.text_size;\n        delete saved_options.text_size;\n      }\n      if ( saved_options.scale ) {\n        saved_options[key].scale = saved_options.scale;\n        delete saved_options.scale;\n      }\n      if ( saved_options.flow ) {\n        saved_options[key].flow = saved_options.flow;\n        delete saved_options.flow;\n      }\n    }\n\n    // saved_options[this.flow] = {}\n    // if ( saved_options.text_size ) {\n    // }\n    localStorage.setItem('cozy.options', JSON.stringify(saved_options));\n    this._cozyOptions = saved_options;\n  },\n\n  _updateTheme: function() {\n    DomUtil.removeClass(this._container, 'cozy-theme-' + ( this._container.dataset.theme || 'default' ));\n    DomUtil.addClass(this._container, 'cozy-theme-' + this.options.theme);\n    this._container.dataset.theme = this.options.theme;\n  },\n\n  draw: function(target) {\n    // NOOP\n  },\n\n  next: function() {\n    // NOOP\n  },\n\n  prev: function() {\n    // NOOP\n  },\n\n  display: function(target) {\n    // backwards compatibility\n    // NOOP\n    return this.gotoPage(target);\n  },\n\n  gotoPage: function(target) {\n    // NOOP\n  },\n\n  goBack: function() {\n    history.back();\n  },\n\n  goForward: function() {\n    history.forward();\n  },\n\n  requestFullscreen: function() {\n    if ( screenfull.enabled ) {\n      // this._preResize();\n      screenfull.toggle(this._container);\n    }\n  },\n\n  _preResize: function() {\n\n  },\n\n  _initContainer: function (id) {\n    var container = this._container = DomUtil.get(id);\n\n    if (!container) {\n      throw new Error('Reader container not found.');\n    } else if (container._cozy_id) {\n      throw new Error('Reader container is already initialized.');\n    }\n\n    DomEvent.on(container, 'scroll', this._onScroll, this);\n    this._containerId = Util.stamp(container);\n  },\n\n  _initLayout: function () {\n    var container = this._container;\n\n    this._fadeAnimated = this.options.fadeAnimation && Browser.any3d;\n\n    DomUtil.addClass(container, 'cozy-reader cozy-container' +\n      (Browser.touch ? ' cozy-touch' : '') +\n      (Browser.retina ? ' cozy-retina' : '') +\n      (Browser.ielt9 ? ' cozy-oldie' : '') +\n      (Browser.safari ? ' cozy-safari' : '') +\n      (this._fadeAnimated ? ' cozy-fade-anim' : '') +\n      ' cozy-engine-' + this.options.engine +\n      ' cozy-theme-' + this.options.theme);\n\n    var position = DomUtil.getStyle(container, 'position');\n\n    this._initPanes();\n\n    if ( ! Browser.columnCount ) {\n      this.options.flow = 'scrolled-doc';\n    }\n  },\n\n  _initPanes: function () {\n    var self = this;\n\n    var panes = this._panes = {};\n\n    var l = 'cozy-';\n    var container = this._container;\n\n    var prefix = 'cozy-module-';\n\n    DomUtil.addClass(container, 'cozy-container');\n    panes['live-status'] = DomUtil.create('div', prefix + 'live-status u-screenreader', container);\n    panes['live-status'].setAttribute('aria-live', 'polite');\n    panes['live-status'].setAttribute('role', 'status'); // possibily redundant with 'aria-live' already there\n    panes['top'] = DomUtil.create('div', prefix + 'top', container);\n    panes['main'] = DomUtil.create('div', prefix + 'main', container);\n    panes['bottom'] = DomUtil.create('div', prefix + 'bottom', container);\n    panes['left'] = DomUtil.create('div', prefix + 'left', panes['main']);\n    panes['right'] = DomUtil.create('div', prefix + 'right', panes['main']);\n    panes['book-cover'] = DomUtil.create('div', prefix + 'book-cover', panes['main']);\n    panes['book'] = DomUtil.create('div', prefix + 'book', panes['book-cover']);\n    panes['loader'] = DomUtil.create('div', prefix + 'book-loading', panes['book']);\n    panes['epub'] = DomUtil.create('div', prefix + 'book-epub', panes['book']);\n    this._initBookLoader();\n  },\n\n  _checkIfLoaded: function () {\n    if (!this._loaded) {\n      throw new Error('Set map center and zoom first.');\n    }\n  },\n\n  // DOM event handling\n\n  // @section Interaction events\n  _initEvents: function (remove) {\n    this._targets = {};\n    this._targets[Util.stamp(this._container)] = this;\n\n    this.tracking = function(reader) {\n      var _action = [];\n      var _last_location_start;\n      var _last_scrollTop;\n      var _reader = reader;\n      return {\n        action: function(v) {\n          if ( v ) {\n            _action = [v];\n            this.event(v);\n            // _reader.fire('trackAction', { action: v })\n          } else {\n            return _action.pop();\n          }\n        },\n\n        peek: function() {\n          return _action[0];\n        },\n\n        event: function(action, data) {\n          if ( data == null ) { data = {}; }\n          data.action = action;\n          _reader.fire(\"trackAction\", data);\n        },\n\n        pageview: function(location) {\n          var do_report = true;\n          if ( _reader.settings.flow == 'scrolled-doc' ) {\n            var scrollTop = 0;\n            if ( _reader._rendition.manager && _reader._rendition.manager.container ) {\n              scrollTop = _reader._rendition.manager.container.scrollTop;\n              // console.log(\"AHOY CHECKING SCROLLTOP\", _last_scrollTop, scrollTop, Math.abs(_last_scrollTop - scrollTop) < _reader._rendition.manager.layout.height);\n            }\n            if ( _last_scrollTop && Math.abs(_last_scrollTop - scrollTop) < _reader._rendition.manager.layout.height ) {\n              do_report = false;\n            } else {\n              _last_scrollTop = scrollTop;\n            }\n          }\n          if ( location.start != _last_location_start && do_report ) {\n            _last_location_start = location.start;\n            var tracking = { cfi: location.start, href: location.href, action: this.action()};\n            _reader.fire('trackPageview', tracking)\n            return tracking;\n          }\n          return false;\n        },\n\n        reset: function() {\n          if ( _reader.settings.flow == 'scrolled-doc' ) {\n            _last_scrollTop = null;\n          }\n        }\n      }\n    }(this);\n\n    var onOff = remove ? DomEvent.off : DomEvent.on;\n\n    // @event click: MouseEvent\n    // Fired when the user clicks (or taps) the map.\n    // @event dblclick: MouseEvent\n    // Fired when the user double-clicks (or double-taps) the map.\n    // @event mousedown: MouseEvent\n    // Fired when the user pushes the mouse button on the map.\n    // @event mouseup: MouseEvent\n    // Fired when the user releases the mouse button on the map.\n    // @event mouseover: MouseEvent\n    // Fired when the mouse enters the map.\n    // @event mouseout: MouseEvent\n    // Fired when the mouse leaves the map.\n    // @event mousemove: MouseEvent\n    // Fired while the mouse moves over the map.\n    // @event contextmenu: MouseEvent\n    // Fired when the user pushes the right mouse button on the map, prevents\n    // default browser context menu from showing if there are listeners on\n    // this event. Also fired on mobile when the user holds a single touch\n    // for a second (also called long press).\n    // @event keypress: KeyboardEvent\n    // Fired when the user presses a key from the keyboard while the map is focused.\n    // onOff(this._container, 'click dblclick mousedown mouseup ' +\n    //   'mouseover mouseout mousemove contextmenu keypress', this._handleDOMEvent, this);\n\n    // if (this.options.trackResize) {\n    //   var self = this;\n    //   var fn = debounce(function(){ self.invalidateSize({}); }, 150);\n    //   onOff(window, 'resize', fn, this);\n    // }\n\n    if (Browser.any3d && this.options.transform3DLimit) {\n      (remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);\n    }\n\n    var self = this;\n    if (screenfull.enabled) {\n      screenfull.on('change', function() {\n        // setTimeout(function() {\n        //   self.invalidateSize({});\n        // }, 100);\n        self.fire('fullscreenchange', { isFullscreen: screenfull.isFullscreen });\n        console.log('AHOY: Am I fullscreen?', screenfull.isFullscreen ? 'YES' : 'NO');\n      });\n    }\n\n    self.on(\"updateLocation\", function(location) {\n      // possibly invoke a pageview event\n      var tracking;\n      if ( tracking = self.tracking.pageview(location) ) {\n        if ( location.percentage ) {\n          var p = Math.ceil(location.percentage * 100);\n          document.title = `${p}% - ${self._original_document_title}`;\n        }\n        var tmp_href = window.location.href.split(\"#\");\n        tmp_href[1] = location.start.substr(8, location.start.length - 8 - 1);\n        var context = [{ cfi: location.start }, '', tmp_href.join('#')];\n\n        if ( tracking.action && tracking.action.match(/\\/go\\/link/) ) {\n          // console.log(\"AHOY ACTION\", tracking.action, context[0].cfi);\n          history.pushState.apply(history, context);\n        } else {\n          history.replaceState.apply(history, context);\n        }\n      }\n    })\n\n    window.addEventListener('popstate', function(event) {\n      console.log(\"AHOY POP STATE\", event)\n      if ( event.isTrusted && event.state != null ) {\n        if ( event.state.cfi == self.__last_state_cfi ) {\n          console.log(\"AHOY POP STATE IGNORE\", self.__last_state_cfi);\n          event.preventDefault();\n          return;\n        }\n        self.__last_state_cfi = event.state.cfi;\n        if ( event.state == null || event.state.cfi == null ) {\n          event.preventDefault();\n          return;\n        }\n        self.display(event.state.cfi);\n      }\n    })\n\n    document.addEventListener('keydown', function(event) {\n      var keyName = event.key;\n      var target = event.target;\n\n      // check if the activeElement is \".special-panel\"\n      var check = document.activeElement;\n      while ( check.localName != 'body' ) {\n        if ( check.classList.contains('special-panel') ) {\n          return;\n        }\n        check = check.parentElement;\n      }\n\n      var IGNORE_TARGETS = [ 'input', 'textarea' ];\n      if ( IGNORE_TARGETS.indexOf(target.localName) >= 0 ) {\n        return;\n      }\n\n      self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey });\n    });\n\n    self.on('keyDown', function(data) {\n      switch(data.keyName) {\n        case 'ArrowRight':\n        case 'PageDown':\n          self.next();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          self.prev();\n          break;\n        case 'Home':\n          self._scroll('HOME');\n          break;\n        case 'End':\n          self._scroll('END')\n          break;\n      }\n    });\n  },\n\n  // _onResize: function() {\n  //   if ( ! this._resizeRequest ) {\n  //     this._resizeRequest = Util.requestAnimFrame(function() {\n  //       this.invalidateSize({})\n  //     }, this);\n  //   }\n  // },\n\n  _onScroll: function () {\n    this._container.scrollTop  = 0;\n    this._container.scrollLeft = 0;\n  },\n\n  _handleDOMEvent: function (e) {\n    if (!this._loaded || DomEvent.skipped(e)) { return; }\n\n    var type = e.type === 'keypress' && e.keyCode === 13 ? 'click' : e.type;\n\n    if (type === 'mousedown') {\n      // prevents outline when clicking on keyboard-focusable element\n      DomUtil.preventOutline(e.target || e.srcElement);\n    }\n\n    this._fireDOMEvent(e, type);\n  },\n\n  _fireDOMEvent: function (e, type, targets) {\n\n    if (e.type === 'click') {\n      // Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).\n      // @event preclick: MouseEvent\n      // Fired before mouse click on the map (sometimes useful when you\n      // want something to happen on click before any existing click\n      // handlers start running).\n      var synth = Util.extend({}, e);\n      synth.type = 'preclick';\n      this._fireDOMEvent(synth, synth.type, targets);\n    }\n\n    if (e._stopped) { return; }\n\n    // Find the layer the event is propagating from and its parents.\n    targets = (targets || []).concat(this._findEventTargets(e, type));\n\n    if (!targets.length) { return; }\n\n    var target = targets[0];\n    if (type === 'contextmenu' && target.listens(type, true)) {\n      DomEvent.preventDefault(e);\n    }\n\n    var data = {\n      originalEvent: e\n    };\n\n    if (e.type !== 'keypress') {\n      var isMarker = (target.options && 'icon' in target.options);\n      data.containerPoint = isMarker ?\n          this.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\n      data.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\n      data.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);\n    }\n\n    for (var i = 0; i < targets.length; i++) {\n      targets[i].fire(type, data, true);\n      if (data.originalEvent._stopped ||\n        (targets[i].options.nonBubblingEvents && Util.indexOf(targets[i].options.nonBubblingEvents, type) !== -1)) { return; }\n    }\n  },\n\n  getFixedBookPanelSize: function() {\n    // have to make the book\n    var style = window.getComputedStyle(this._panes['book']);\n    var h = this._panes['book'].clientHeight - parseFloat(style.paddingTop) - parseFloat(style.paddingBottom);\n    var w = this._panes['book'].clientWidth - parseFloat(style.paddingRight) - parseFloat(style.paddingLeft);\n    return { height: Math.floor(h * 1.00), width: Math.floor(w * 1.00) };\n  },\n\n  invalidateSize: function(options) {\n    // TODO: IS THIS EVER USED?\n    var self = this;\n\n    if ( ! self._drawn ) { return; }\n\n    Util.cancelAnimFrame(this._resizeRequest);\n\n    if (! this._loaded) { return this; }\n\n    this.fire('resized');\n  },\n\n  _resizeBookPane: function() {\n\n  },\n\n  _setupHooks: function() {\n\n  },\n\n  _checkFeatureCompatibility: function() {\n    if ( ! DomUtil.isPropertySupported('columnCount') || this._checkMobileDevice() ) {\n      // force\n      this.options.flow = 'scrolled-doc';\n    }\n    if ( this._checkMobileDevice() ) {\n      this.options.text_size = 120;\n    }\n  },\n\n  _checkMobileDevice: function() {\n    if ( this._isMobile === undefined ) {\n      this._isMobile = false;\n      if ( this.options.mobileMediaQuery ) {\n        this._isMobile = window.matchMedia(this.options.mobileMediaQuery).matches;\n      }\n    }\n    return this._isMobile;\n  },\n\n  _enableBookLoader: function(delay=0) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( delay < 0 ) {\n      delay = 0;\n      self._force_progress = true;\n    }\n    self._loader_timeout = setTimeout(function() {\n      self._panes['loader'].style.display = 'block';\n      // CSB-279 broadcast \"Loading...\" during the spinner for screenreaders.\n      // When locations start coming in for the bottom drag navigation they\n      // will override our message.\n      self.updateLiveStatus(\"Loading...\");\n    }, delay);\n  },\n\n  _disableBookLoader: function(force=false) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( ! self._force_progress || force ) {\n      self._panes['loader'].style.display = 'none';\n      self._force_progress = false;\n      self._panes['loader-status'].innerHTML = '';\n    }\n  },\n\n  _clearBookLoaderTimeout: function() {\n    var self = this;\n    if ( self._loader_timeout ) {\n      clearTimeout(self._loader_timeout);\n      self._loader_timeout = null;\n    }\n  },\n\n  _initBookLoader: function() {\n    // is this not awesome?\n    var template = this.options.loader_template || this.loaderTemplate();\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      this._panes['loader'].appendChild(body.children[0]);\n    }\n    this._panes['loader-status'] = DomUtil.create('div', 'cozy-module-book-loading-status', this._panes['loader']);\n  },\n\n  loaderTemplate: function() {\n    return `<div class=\"cozy-loader-spinner\">\n    <div class=\"spinner-backdrop spinner-backdrop--1\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--2\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--3\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--4\"></div>\n    <div class=\"spinner-quarter spinner-quarter--1\"></div>\n    <div class=\"spinner-quarter spinner-quarter--2\"></div>\n    <div class=\"spinner-quarter spinner-quarter--3\"></div>\n    <div class=\"spinner-quarter spinner-quarter--4\"></div>\n  </div>`;\n  },\n\n  updateLiveStatus: function(message) {\n    if ( ! this._panes['live-status'] ) { return ; }\n    if ( message != this._last_message ) {\n      if ( this._last_timer ) { clearTimeout(this._last_timer); this._last_timer = null; }\n      var clearDelay = 500;\n      setTimeout(() => {\n        this._panes['live-status'].innerText = message;\n        this._last_message = message;\n        console.log(\"-- status:\", message);\n      }, 50);\n      this._last_timer = setTimeout(() => {\n        this._panes['live-status'].innerText = '';\n      }, clearDelay);\n    }\n  },\n\n  EOT: true\n});\n\nObject.defineProperty(Reader.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.prototype, 'flow', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return ( this.options.flow == 'auto' ? 'paginated' : this.options.flow );\n  }\n});\n\nObject.defineProperty(Reader.prototype, 'flowOptions', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n\n    var flow = this.flow;\n    if ( ! this.options.flowOptions[flow] ) {\n      this.options.flowOptions[flow] = {};\n    }\n    if ( ! this.options.flowOptions[flow].text_size ) {\n      this.options.flowOptions[flow].text_size = this.options.text_size;\n    }\n    if ( ! this.options.flowOptions[flow].scale ) {\n      this.options.flowOptions[flow].scale = this.options.scale;\n    }\n\n    return this.options.flowOptions[flow]\n  }\n});\n\nexport function createReader(id, options) {\n  return new Reader(id, options);\n}\n","import Path from \"./path\";\nimport path from \"path-webpack\";\n\n/**\n * creates a Url object for parsing and manipulation of a url string\n * @param\t{string} urlString\ta url string (relative or absolute)\n * @param\t{string} [baseString] optional base for the url,\n * default to window.location.href\n */\nclass Url {\n\tconstructor(urlString, baseString) {\n\t\tvar absolute = (urlString.indexOf(\"://\") > -1);\n\t\tvar pathname = urlString;\n\t\tvar basePath;\n\n\t\tthis.Url = undefined;\n\t\tthis.href = urlString;\n\t\tthis.protocol = \"\";\n\t\tthis.origin = \"\";\n\t\tthis.hash = \"\";\n\t\tthis.hash = \"\";\n\t\tthis.search = \"\";\n\t\tthis.base = baseString;\n\n\t\tif (!absolute &&\n\t\t\t\tbaseString !== false &&\n\t\t\t\ttypeof(baseString) !== \"string\" &&\n\t\t\t\twindow && window.location) {\n\t\t\tthis.base = window.location.href;\n\t\t}\n\n\t\t// URL Polyfill doesn't throw an error if base is empty\n\t\tif (absolute || this.base) {\n\t\t\ttry {\n\t\t\t\tif (this.base) { // Safari doesn't like an undefined base\n\t\t\t\t\tthis.Url = new URL(urlString, this.base);\n\t\t\t\t} else {\n\t\t\t\t\tthis.Url = new URL(urlString);\n\t\t\t\t}\n\t\t\t\tthis.href = this.Url.href;\n\n\t\t\t\tthis.protocol = this.Url.protocol;\n\t\t\t\tthis.origin = this.Url.origin;\n\t\t\t\tthis.hash = this.Url.hash;\n\t\t\t\tthis.search = this.Url.search;\n\n\t\t\t\tpathname = this.Url.pathname;\n\t\t\t} catch (e) {\n\t\t\t\t// Skip URL parsing\n\t\t\t\tthis.Url = undefined;\n\t\t\t\t// resolve the pathname from the base\n\t\t\t\tif (this.base) {\n\t\t\t\t\tbasePath = new Path(this.base);\n\t\t\t\t\tpathname = basePath.resolve(pathname);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.Path = new Path(pathname);\n\n\t\tthis.directory = this.Path.directory;\n\t\tthis.filename = this.Path.filename;\n\t\tthis.extension = this.Path.extension;\n\n\t}\n\n\t/**\n\t * @returns {Path}\n\t */\n\tpath () {\n\t\treturn this.Path;\n\t}\n\n\t/**\n\t * Resolves a relative path to a absolute url\n\t * @param {string} what\n\t * @returns {string} url\n\t */\n\tresolve (what) {\n\t\tvar isAbsolute = (what.indexOf(\"://\") > -1);\n\t\tvar fullpath;\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\tfullpath = path.resolve(this.directory, what);\n\t\treturn this.origin + fullpath;\n\t}\n\n\t/**\n\t * Resolve a path relative to the url\n\t * @param {string} what\n\t * @returns {string} path\n\t */\n\trelative (what) {\n\t\treturn path.relative(what, this.directory);\n\t}\n\n\t/**\n\t * @returns {string}\n\t */\n\ttoString () {\n\t\treturn this.href;\n\t}\n}\n\nexport default Url;\n","import {extend, type, findChildren, RangeObject, isNumber} from \"./utils/core\";\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n\n/**\n\t* Parsing and creation of EpubCFIs: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\n\n\t* Implements:\n\t* - Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\n\t* - Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\n\n\t* Does Not Implement:\n\t* - Temporal Offset (~)\n\t* - Spatial Offset (@)\n\t* - Temporal-Spatial Offset (~ + @)\n\t* - Text Location Assertion ([)\n\t* @class\n\t@param {string | Range | Node } [cfiFrom]\n\t@param {string | object} [base]\n\t@param {string} [ignoreClass] class to ignore when parsing DOM\n*/\nclass EpubCFI {\n\tconstructor(cfiFrom, base, ignoreClass){\n\t\tvar type;\n\n\t\tthis.str = \"\";\n\n\t\tthis.base = {};\n\t\tthis.spinePos = 0; // For compatibility\n\n\t\tthis.range = false; // true || false;\n\n\t\tthis.path = {};\n\t\tthis.start = null;\n\t\tthis.end = null;\n\n\t\t// Allow instantiation without the \"new\" keyword\n\t\tif (!(this instanceof EpubCFI)) {\n\t\t\treturn new EpubCFI(cfiFrom, base, ignoreClass);\n\t\t}\n\n\t\tif(typeof base === \"string\") {\n\t\t\tthis.base = this.parseComponent(base);\n\t\t} else if(typeof base === \"object\" && base.steps) {\n\t\t\tthis.base = base;\n\t\t}\n\n\t\ttype = this.checkType(cfiFrom);\n\n\n\t\tif(type === \"string\") {\n\t\t\tthis.str = cfiFrom;\n\t\t\treturn extend(this, this.parse(cfiFrom));\n\t\t} else if (type === \"range\") {\n\t\t\treturn extend(this, this.fromRange(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === \"node\") {\n\t\t\treturn extend(this, this.fromNode(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === \"EpubCFI\" && cfiFrom.path) {\n\t\t\treturn cfiFrom;\n\t\t} else if (!cfiFrom) {\n\t\t\treturn this;\n\t\t} else {\n\t\t\tthrow new TypeError(\"not a valid argument for EpubCFI\");\n\t\t}\n\n\t}\n\n\t/**\n\t * Check the type of constructor input\n\t * @private\n\t */\n\tcheckType(cfi) {\n\n\t\tif (this.isCfiString(cfi)) {\n\t\t\treturn \"string\";\n\t\t// Is a range object\n\t\t} else if (cfi && typeof cfi === \"object\" && (type(cfi) === \"Range\" || typeof(cfi.startContainer) != \"undefined\")){\n\t\t\treturn \"range\";\n\t\t} else if (cfi && typeof cfi === \"object\" && typeof(cfi.nodeType) != \"undefined\" ){ // || typeof cfi === \"function\"\n\t\t\treturn \"node\";\n\t\t} else if (cfi && typeof cfi === \"object\" && cfi instanceof EpubCFI){\n\t\t\treturn \"EpubCFI\";\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Parse a cfi string to a CFI object representation\n\t * @param {string} cfiStr\n\t * @returns {object} cfi\n\t */\n\tparse(cfiStr) {\n\t\tvar cfi = {\n\t\t\tspinePos: -1,\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\t\tvar baseComponent, pathComponent, range;\n\n\t\tif(typeof cfiStr !== \"string\") {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tif(cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length-1] === \")\") {\n\t\t\t// Remove intial epubcfi( and ending )\n\t\t\tcfiStr = cfiStr.slice(8, cfiStr.length-1);\n\t\t}\n\n\t\tbaseComponent = this.getChapterComponent(cfiStr);\n\n\t\t// Make sure this is a valid cfi or return\n\t\tif(!baseComponent) {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tcfi.base = this.parseComponent(baseComponent);\n\n\t\tpathComponent = this.getPathComponent(cfiStr);\n\t\tcfi.path = this.parseComponent(pathComponent);\n\n\t\trange = this.getRange(cfiStr);\n\n\t\tif(range) {\n\t\t\tcfi.range = true;\n\t\t\tcfi.start = this.parseComponent(range[0]);\n\t\t\tcfi.end = this.parseComponent(range[1]);\n\t\t}\n\n\t\t// Get spine node position\n\t\t// cfi.spineSegment = cfi.base.steps[1];\n\n\t\t// Chapter segment is always the second step\n\t\tcfi.spinePos = cfi.base.steps[1].index;\n\n\t\treturn cfi;\n\t}\n\n\tparseComponent(componentStr){\n\t\tvar component = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar parts = componentStr.split(\":\");\n\t\tvar steps = parts[0].split(\"/\");\n\t\tvar terminal;\n\n\t\tif(parts.length > 1) {\n\t\t\tterminal = parts[1];\n\t\t\tcomponent.terminal = this.parseTerminal(terminal);\n\t\t}\n\n\t\tif (steps[0] === \"\") {\n\t\t\tsteps.shift(); // Ignore the first slash\n\t\t}\n\n\t\tcomponent.steps = steps.map(function(step){\n\t\t\treturn this.parseStep(step);\n\t\t}.bind(this));\n\n\t\treturn component;\n\t}\n\n\tparseStep(stepStr){\n\t\tvar type, num, index, has_brackets, id;\n\n\t\thas_brackets = stepStr.match(/\\[(.*)\\]/);\n\t\tif(has_brackets && has_brackets[1]){\n\t\t\tid = has_brackets[1];\n\t\t}\n\n\t\t//-- Check if step is a text node or element\n\t\tnum = parseInt(stepStr);\n\n\t\tif(isNaN(num)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(num % 2 === 0) { // Even = is an element\n\t\t\ttype = \"element\";\n\t\t\tindex = num / 2 - 1;\n\t\t} else {\n\t\t\ttype = \"text\";\n\t\t\tindex = (num - 1 ) / 2;\n\t\t}\n\n\t\treturn {\n\t\t\t\"type\" : type,\n\t\t\t\"index\" : index,\n\t\t\t\"id\" : id || null\n\t\t};\n\t}\n\n\tparseTerminal(termialStr){\n\t\tvar characterOffset, textLocationAssertion;\n\t\tvar assertion = termialStr.match(/\\[(.*)\\]/);\n\n\t\tif(assertion && assertion[1]){\n\t\t\tcharacterOffset = parseInt(termialStr.split(\"[\")[0]);\n\t\t\ttextLocationAssertion = assertion[1];\n\t\t} else {\n\t\t\tcharacterOffset = parseInt(termialStr);\n\t\t}\n\n\t\tif (!isNumber(characterOffset)) {\n\t\t\tcharacterOffset = null;\n\t\t}\n\n\t\treturn {\n\t\t\t\"offset\": characterOffset,\n\t\t\t\"assertion\": textLocationAssertion\n\t\t};\n\n\t}\n\n\tgetChapterComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\treturn indirection[0];\n\t}\n\n\tgetPathComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\tif(indirection[1]) {\n\t\t\tlet ranges = indirection[1].split(\",\");\n\t\t\treturn ranges[0];\n\t\t}\n\n\t}\n\n\tgetRange(cfiStr) {\n\n\t\tvar ranges = cfiStr.split(\",\");\n\n\t\tif(ranges.length === 3){\n\t\t\treturn [\n\t\t\t\tranges[1],\n\t\t\t\tranges[2]\n\t\t\t];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetCharecterOffsetComponent(cfiStr) {\n\t\tvar splitStr = cfiStr.split(\":\");\n\t\treturn splitStr[1] || \"\";\n\t}\n\n\tjoinSteps(steps) {\n\t\tif(!steps) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn steps.map(function(part){\n\t\t\tvar segment = \"\";\n\n\t\t\tif(part.type === \"element\") {\n\t\t\t\tsegment += (part.index + 1) * 2;\n\t\t\t}\n\n\t\t\tif(part.type === \"text\") {\n\t\t\t\tsegment += 1 + (2 * part.index); // TODO: double check that this is odd\n\t\t\t}\n\n\t\t\tif(part.id) {\n\t\t\t\tsegment += \"[\" + part.id + \"]\";\n\t\t\t}\n\n\t\t\treturn segment;\n\n\t\t}).join(\"/\");\n\n\t}\n\n\tsegmentString(segment) {\n\t\tvar segmentString = \"/\";\n\n\t\tsegmentString += this.joinSteps(segment.steps);\n\n\t\tif(segment.terminal && segment.terminal.offset != null){\n\t\t\tsegmentString += \":\" + segment.terminal.offset;\n\t\t}\n\n\t\tif(segment.terminal && segment.terminal.assertion != null){\n\t\t\tsegmentString += \"[\" + segment.terminal.assertion + \"]\";\n\t\t}\n\n\t\treturn segmentString;\n\t}\n\n\t/**\n\t * Convert CFI to a epubcfi(...) string\n\t * @returns {string} epubcfi\n\t */\n\ttoString(cfi) {\n\t\tif ( ! cfi ) { cfi = this; }\n\t\tvar cfiString = \"epubcfi(\";\n\n\t\tcfiString += this.segmentString(cfi.base);\n\n\t\tcfiString += \"!\";\n\t\tcfiString += this.segmentString(cfi.path);\n\n\t\t// Add Range, if present\n\t\tif(cfi.range && cfi.start) {\n\t\t\tcfiString += \",\";\n\t\t\tcfiString += this.segmentString(cfi.start);\n\t\t}\n\n\t\tif(cfi.range && cfi.end) {\n\t\t\tcfiString += \",\";\n\t\t\tcfiString += this.segmentString(cfi.end);\n\t\t}\n\n\t\tcfiString += \")\";\n\n\t\treturn cfiString;\n\t}\n\n\n\t/**\n\t * Compare which of two CFIs is earlier in the text\n\t * @returns {number} First is earlier = -1, Second is earlier = 1, They are equal = 0\n\t */\n\tcompare(cfiOne, cfiTwo) {\n\t\tvar stepsA, stepsB;\n\t\tvar terminalA, terminalB;\n\n\t\tvar rangeAStartSteps, rangeAEndSteps;\n\t\tvar rangeBEndSteps, rangeBEndSteps;\n\t\tvar rangeAStartTerminal, rangeAEndTerminal;\n\t\tvar rangeBStartTerminal, rangeBEndTerminal;\n\n\t\tif(typeof cfiOne === \"string\") {\n\t\t\tcfiOne = new EpubCFI(cfiOne);\n\t\t}\n\t\tif(typeof cfiTwo === \"string\") {\n\t\t\tcfiTwo = new EpubCFI(cfiTwo);\n\t\t}\n\t\t// Compare Spine Positions\n\t\tif(cfiOne.spinePos > cfiTwo.spinePos) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(cfiOne.spinePos < cfiTwo.spinePos) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (cfiOne.range) {\n\t\t\tstepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\n\t\t\tterminalA = cfiOne.start.terminal;\n\t\t} else {\n\t\t\tstepsA = cfiOne.path.steps;\n\t\t\tterminalA = cfiOne.path.terminal;\n\t\t}\n\n\t\tif (cfiTwo.range) {\n\t\t\tstepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\n\t\t\tterminalB = cfiTwo.start.terminal;\n\t\t} else {\n\t\t\tstepsB = cfiTwo.path.steps;\n\t\t\tterminalB = cfiTwo.path.terminal;\n\t\t}\n\n\t\t// Compare Each Step in the First item\n\t\tfor (var i = 0; i < stepsA.length; i++) {\n\t\t\tif(!stepsA[i]) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif(!stepsB[i]) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index > stepsB[i].index) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index < stepsB[i].index) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t// Otherwise continue checking\n\t\t}\n\n\t\t// All steps in First equal to Second and First is Less Specific\n\t\tif(stepsA.length < stepsB.length) {\n\t\t\treturn 1;\n\t\t}\n\n\t\t// Compare the charecter offset of the text node\n\t\tif(terminalA.offset > terminalB.offset) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(terminalA.offset < terminalB.offset) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// CFI's are equal\n\t\treturn 0;\n\t}\n\n\tstep(node) {\n\t\tvar nodeType = (node.nodeType === TEXT_NODE) ? \"text\" : \"element\";\n\n\t\treturn {\n\t\t\t\"id\" : node.id,\n\t\t\t\"tagName\" : node.tagName,\n\t\t\t\"type\" : nodeType,\n\t\t\t\"index\" : this.position(node)\n\t\t};\n\t}\n\n\tfilteredStep(node, ignoreClass) {\n\t\tvar filteredNode = this.filter(node, ignoreClass);\n\t\tvar nodeType;\n\n\t\t// Node filtered, so ignore\n\t\tif (!filteredNode) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise add the filter node in\n\t\tnodeType = (filteredNode.nodeType === TEXT_NODE) ? \"text\" : \"element\";\n\n\t\treturn {\n\t\t\t\"id\" : filteredNode.id,\n\t\t\t\"tagName\" : filteredNode.tagName,\n\t\t\t\"type\" : nodeType,\n\t\t\t\"index\" : this.filteredPosition(filteredNode, ignoreClass)\n\t\t};\n\t}\n\n\tpathTo(node, offset, ignoreClass) {\n\t\tvar segment = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar currentNode = node;\n\t\tvar step;\n\n\t\twhile(currentNode && currentNode.parentNode &&\n\t\t\t\t\tcurrentNode.parentNode.nodeType != DOCUMENT_NODE) {\n\n\t\t\tif (ignoreClass) {\n\t\t\t\tstep = this.filteredStep(currentNode, ignoreClass);\n\t\t\t} else {\n\t\t\t\tstep = this.step(currentNode);\n\t\t\t}\n\n\t\t\tif (step) {\n\t\t\t\tsegment.steps.unshift(step);\n\t\t\t}\n\n\t\t\tcurrentNode = currentNode.parentNode;\n\n\t\t}\n\n\t\tif (offset != null && offset >= 0) {\n\n\t\t\tsegment.terminal.offset = offset;\n\n\t\t\t// Make sure we are getting to a textNode if there is an offset\n\t\t\tif(segment.steps[segment.steps.length-1].type != \"text\") {\n\t\t\t\tsegment.steps.push({\n\t\t\t\t\t\"type\" : \"text\",\n\t\t\t\t\t\"index\" : 0\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\n\t\treturn segment;\n\t}\n\n\tequalStep(stepA, stepB) {\n\t\tif (!stepA || !stepB) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif(stepA.index === stepB.index &&\n\t\t\t stepA.id === stepB.id &&\n\t\t\t stepA.type === stepB.type) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Create a CFI object from a Range\n\t * @param {Range} range\n\t * @param {string | object} base\n\t * @param {string} [ignoreClass]\n\t * @returns {object} cfi\n\t */\n\tfromRange(range, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\n\t\tvar start = range.startContainer;\n\t\tvar end = range.endContainer;\n\n\t\tvar startOffset = range.startOffset;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar needsIgnoring = false;\n\n\t\tif (ignoreClass) {\n\t\t\t// Tell pathTo if / what to ignore\n\t\t\tneedsIgnoring = (start.ownerDocument.querySelector(\".\" + ignoreClass) != null);\n\t\t}\n\n\n\t\tif (typeof base === \"string\") {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === \"object\") {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\t\t\tcfi.path = this.pathTo(start, startOffset, ignoreClass);\n\t\t} else {\n\t\t\tcfi.range = true;\n\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.start = this.pathTo(start, startOffset, ignoreClass);\n\t\t\tif (needsIgnoring) {\n\t\t\t\tendOffset = this.patchOffset(end, endOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.end = this.pathTo(end, endOffset, ignoreClass);\n\n\t\t\t// Create a new empty path\n\t\t\tcfi.path = {\n\t\t\t\tsteps: [],\n\t\t\t\tterminal: null\n\t\t\t};\n\n\t\t\t// Push steps that are shared between start and end to the common path\n\t\t\tvar len = cfi.start.steps.length;\n\t\t\tvar i;\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\n\t\t\t\t\tif(i === len-1) {\n\t\t\t\t\t\t// Last step is equal, check terminals\n\t\t\t\t\t\tif(cfi.start.terminal === cfi.end.terminal) {\n\t\t\t\t\t\t\t// CFI's are equal\n\t\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t\t\t// Not a range\n\t\t\t\t\t\t\tcfi.range = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\n\t\t\tcfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length);\n\n\t\t\t// TODO: Add Sanity check to make sure that the end if greater than the start\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Create a CFI object from a Node\n\t * @param {Node} anchor\n\t * @param {string | object} base\n\t * @param {string} [ignoreClass]\n\t * @returns {object} cfi\n\t */\n\tfromNode(anchor, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\n\t\tif (typeof base === \"string\") {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === \"object\") {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tcfi.path = this.pathTo(anchor, null, ignoreClass);\n\n\t\treturn cfi;\n\t}\n\n\tfilter(anchor, ignoreClass) {\n\t\tvar needsIgnoring;\n\t\tvar sibling; // to join with\n\t\tvar parent, previousSibling, nextSibling;\n\t\tvar isText = false;\n\n\t\tif (anchor.nodeType === TEXT_NODE) {\n\t\t\tisText = true;\n\t\t\tparent = anchor.parentNode;\n\t\t\tneedsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\n\t\t} else {\n\t\t\tisText = false;\n\t\t\tneedsIgnoring = anchor.classList.contains(ignoreClass);\n\t\t}\n\n\t\tif (needsIgnoring && isText) {\n\t\t\tpreviousSibling = parent.previousSibling;\n\t\t\tnextSibling = parent.nextSibling;\n\n\t\t\t// If the sibling is a text node, join the nodes\n\t\t\tif (previousSibling && previousSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = previousSibling;\n\t\t\t} else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = nextSibling;\n\t\t\t}\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t} else {\n\t\t\t\t// Parent will be ignored on next step\n\t\t\t\treturn anchor;\n\t\t\t}\n\n\t\t} else if (needsIgnoring && !isText) {\n\t\t\t// Otherwise just skip the element node\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// No need to filter\n\t\t\treturn anchor;\n\t\t}\n\n\t}\n\n\tpatchOffset(anchor, offset, ignoreClass) {\n\t\tif (anchor.nodeType != TEXT_NODE) {\n\t\t\tthrow new Error(\"Anchor must be a text node\");\n\t\t}\n\n\t\tvar curr = anchor;\n\t\tvar totalOffset = offset;\n\n\t\t// If the parent is a ignored node, get offset from it's start\n\t\tif (anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\tcurr = anchor.parentNode;\n\t\t}\n\n\t\twhile (curr.previousSibling) {\n\t\t\tif(curr.previousSibling.nodeType === ELEMENT_NODE) {\n\t\t\t\t// Originally a text node, so join\n\t\t\t\tif(curr.previousSibling.classList.contains(ignoreClass)){\n\t\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t\t} else {\n\t\t\t\t\tbreak; // Normal node, dont join\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling is a text node, join the nodes\n\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t}\n\n\t\t\tcurr = curr.previousSibling;\n\t\t}\n\n\t\treturn totalOffset;\n\n\t}\n\n\tnormalizedMap(children, nodeType, ignoreClass) {\n\t\tvar output = {};\n\t\tvar prevIndex = -1;\n\t\tvar i, len = children.length;\n\t\tvar currNodeType;\n\t\tvar prevNodeType;\n\n\t\tfor (i = 0; i < len; i++) {\n\n\t\t\tcurrNodeType = children[i].nodeType;\n\n\t\t\t// Check if needs ignoring\n\t\t\tif (currNodeType === ELEMENT_NODE &&\n\t\t\t\t\tchildren[i].classList.contains(ignoreClass)) {\n\t\t\t\tcurrNodeType = TEXT_NODE;\n\t\t\t}\n\n\t\t\tif (i > 0 &&\n\t\t\t\t\tcurrNodeType === TEXT_NODE &&\n\t\t\t\t\tprevNodeType === TEXT_NODE) {\n\t\t\t\t// join text nodes\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t} else if (nodeType === currNodeType){\n\t\t\t\tprevIndex = prevIndex + 1;\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t}\n\n\t\t\tprevNodeType = currNodeType;\n\n\t\t}\n\n\t\treturn output;\n\t}\n\n\tposition(anchor) {\n\t\tvar children, index;\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tif (!children) {\n\t\t\t\tchildren = findChildren(anchor.parentNode);\n\t\t\t}\n\t\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\t\t} else {\n\t\t\tchildren = this.textNodes(anchor.parentNode);\n\t\t\tindex = children.indexOf(anchor);\n\t\t}\n\n\t\treturn index;\n\t}\n\n\tfilteredPosition(anchor, ignoreClass) {\n\t\tvar children, index, map;\n\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tmap = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\n\t\t} else {\n\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t// Inside an ignored node\n\t\t\tif(anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\t\tanchor = anchor.parentNode;\n\t\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t}\n\t\t\tmap = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\t}\n\n\n\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\n\t\treturn map[index];\n\t}\n\n\tstepsToXpath(steps) {\n\t\tvar xpath = [\".\", \"*\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\txpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\txpath.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\txpath.push(\"*[\" + position + \"]\");\n\t\t\t}\n\t\t});\n\n\t\treturn xpath.join(\"/\");\n\t}\n\n\n\t/*\n\n\tTo get the last step if needed:\n\n\t// Get the terminal step\n\tlastStep = steps[steps.length-1];\n\t// Get the query string\n\tquery = this.stepsToQuery(steps);\n\t// Find the containing element\n\tstartContainerParent = doc.querySelector(query);\n\t// Find the text node within that element\n\tif(startContainerParent && lastStep.type == \"text\") {\n\t\tcontainer = startContainerParent.childNodes[lastStep.index];\n\t}\n\t*/\n\tstepsToQuerySelector(steps) {\n\t\tvar query = [\"html\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\tquery.push(\"#\" + step.id);\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\t// unsupported in querySelector\n\t\t\t\t// query.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\tquery.push(\"*:nth-child(\" + position + \")\");\n\t\t\t}\n\t\t});\n\n\t\treturn query.join(\">\");\n\n\t}\n\n\ttextNodes(container, ignoreClass) {\n\t\treturn Array.prototype.slice.call(container.childNodes).\n\t\t\tfilter(function (node) {\n\t\t\t\tif (node.nodeType === TEXT_NODE) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (ignoreClass && node.classList.contains(ignoreClass)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t}\n\n\twalkToNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container = doc.documentElement;\n\t\tvar children;\n\t\tvar step;\n\t\tvar len = steps.length;\n\t\tvar i;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tstep = steps[i];\n\n\t\t\tif(step.type === \"element\") {\n\t\t\t\t//better to get a container using id as some times step.index may not be correct\n\t\t\t\t//For ex.https://github.com/futurepress/epub.js/issues/561\n\t\t\t\tif(step.id) {\n\t\t\t\t\tcontainer = doc.getElementById(step.id);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tchildren = container.children || findChildren(container);\n\t\t\t\t\tcontainer = children[step.index];\n\t\t\t\t}\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\tcontainer = this.textNodes(container, ignoreClass)[step.index];\n\t\t\t}\n\t\t\tif(!container) {\n\t\t\t\t//Break the for loop as due to incorrect index we can get error if\n\t\t\t\t//container is undefined so that other functionailties works fine\n\t\t\t\t//like navigation\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tfindNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container;\n\t\tvar xpath;\n\n\t\tif(!ignoreClass && typeof doc.evaluate != \"undefined\") {\n\t\t\txpath = this.stepsToXpath(steps);\n\t\t\tcontainer = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n\t\t} else if(ignoreClass) {\n\t\t\tcontainer = this.walkToNode(steps, doc, ignoreClass);\n\t\t} else {\n\t\t\tcontainer = this.walkToNode(steps, doc);\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tfixMiss(steps, offset, _doc, ignoreClass) {\n\t\tvar container = this.findNode(steps.slice(0,-1), _doc, ignoreClass);\n\t\tvar children = container.childNodes;\n\t\tvar map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\tvar child;\n\t\tvar len;\n\t\tvar lastStepIndex = steps[steps.length-1].index;\n\n\t\tfor (let childIndex in map) {\n\t\t\tif (!map.hasOwnProperty(childIndex)) return;\n\n\t\t\tif(map[childIndex] === lastStepIndex) {\n\t\t\t\tchild = children[childIndex];\n\t\t\t\tlen = child.textContent.length;\n\t\t\t\tif(offset > len) {\n\t\t\t\t\toffset = offset - len;\n\t\t\t\t} else {\n\t\t\t\t\tif (child.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tcontainer = child.childNodes[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainer = child;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tcontainer: container,\n\t\t\toffset: offset\n\t\t};\n\n\t}\n\n\t/**\n\t * Creates a DOM range representing a CFI\n\t * @param {document} _doc document referenced in the base\n\t * @param {string} [ignoreClass]\n\t * @return {Range}\n\t */\n\ttoRange(_doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar range;\n\t\tvar start, end, startContainer, endContainer;\n\t\tvar cfi = this;\n\t\tvar startSteps, endSteps;\n\t\tvar needsIgnoring = ignoreClass ? (doc.querySelector(\".\" + ignoreClass) != null) : false;\n\t\tvar missed;\n\n\t\tif (typeof(doc.createRange) !== \"undefined\") {\n\t\t\trange = doc.createRange();\n\t\t} else {\n\t\t\trange = new RangeObject();\n\t\t}\n\n\t\tif (cfi.range) {\n\t\t\tstart = cfi.start;\n\t\t\tstartSteps = cfi.path.steps.concat(start.steps);\n\t\t\tstartContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t\tend = cfi.end;\n\t\t\tendSteps = cfi.path.steps.concat(end.steps);\n\t\t\tendContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t} else {\n\t\t\tstart = cfi.path;\n\t\t\tstartSteps = cfi.path.steps;\n\t\t\tstartContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\n\t\t}\n\n\t\tif(startContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(start.terminal.offset != null) {\n\t\t\t\t\trange.setStart(startContainer, start.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setStart(startContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setStart(missed.container, missed.offset);\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(\"No startContainer found for\", this.toString());\n\t\t\t// No start found\n\t\t\treturn null;\n\t\t}\n\n\t\tif (endContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(end.terminal.offset != null) {\n\t\t\t\t\trange.setEnd(endContainer, end.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setEnd(endContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setEnd(missed.container, missed.offset);\n\t\t\t}\n\t\t}\n\n\n\t\t// doc.defaultView.getSelection().addRange(range);\n\t\treturn range;\n\t}\n\n\t/**\n\t * Check if a string is wrapped with \"epubcfi()\"\n\t * @param {string} str\n\t * @returns {boolean}\n\t */\n\tisCfiString(str) {\n\t\tif(typeof str === \"string\" &&\n\t\t\tstr.indexOf(\"epubcfi(\") === 0 &&\n\t\t\tstr[str.length-1] === \")\") {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgenerateChapterComponent(_spineNodeIndex, _pos, id) {\n\t\tvar pos = parseInt(_pos),\n\t\t\t\tspineNodeIndex = (_spineNodeIndex + 1) * 2,\n\t\t\t\tcfi = \"/\"+spineNodeIndex+\"/\";\n\n\t\tcfi += (pos + 1) * 2;\n\n\t\tif(id) {\n\t\t\tcfi += \"[\" + id + \"]\";\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Collapse a CFI Range to a single CFI Position\n\t * @param {boolean} [toStart=false]\n\t */\n\tcollapse(toStart) {\n\t\tif (!this.range) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.range = false;\n\n\t\tif (toStart) {\n\t\t\tthis.path.steps = this.path.steps.concat(this.start.steps);\n\t\t\tthis.path.terminal = this.start.terminal;\n\t\t} else {\n\t\t\tthis.path.steps = this.path.steps.concat(this.end.steps);\n\t\t\tthis.path.terminal = this.end.terminal;\n\t\t}\n\n\t}\n}\n\nexport default EpubCFI;\n","/**\n * Hooks allow for injecting functions that must all complete in order before finishing\n * They will execute in parallel but all must finish before continuing\n * Functions may return a promise if they are asycn.\n * @param {any} context scope of this\n * @example this.content = new EPUBJS.Hook(this);\n */\nclass Hook {\n\tconstructor(context){\n\t\tthis.context = context || this;\n\t\tthis.hooks = [];\n\t}\n\n\t/**\n\t * Adds a function to be run before a hook completes\n\t * @example this.content.register(function(){...});\n\t */\n\tregister(){\n\t\tfor(var i = 0; i < arguments.length; ++i) {\n\t\t\tif (typeof arguments[i]  === \"function\") {\n\t\t\t\tthis.hooks.push(arguments[i]);\n\t\t\t} else {\n\t\t\t\t// unpack array\n\t\t\t\tfor(var j = 0; j < arguments[i].length; ++j) {\n\t\t\t\t\tthis.hooks.push(arguments[i][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Removes a function\n\t * @example this.content.deregister(function(){...});\n\t */\n\tderegister(func){\n\t\tlet hook;\n\t\tfor (let i = 0; i < this.hooks.length; i++) {\n\t\t\thook = this.hooks[i];\n\t\t\tif (hook === func) {\n\t\t\t\tthis.hooks.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Triggers a hook to run all functions\n\t * @example this.content.trigger(args).then(function(){...});\n\t */\n\ttrigger(){\n\t\tvar args = arguments;\n\t\tvar context = this.context;\n\t\tvar promises = [];\n\n\t\tthis.hooks.forEach(function(task) {\n\t\t\tvar executing = task.apply(context, args);\n\n\t\t\tif(executing && typeof executing[\"then\"] === \"function\") {\n\t\t\t\t// Task is a function that returns a promise\n\t\t\t\tpromises.push(executing);\n\t\t\t}\n\t\t\t// Otherwise Task resolves immediately, continue\n\t\t});\n\n\n\t\treturn Promise.all(promises);\n\t}\n\n\t// Adds a function to be run before a hook completes\n\tlist(){\n\t\treturn this.hooks;\n\t}\n\n\tclear(){\n\t\treturn this.hooks = [];\n\t}\n}\nexport default Hook;\n","import { qs, qsa } from \"./core\";\nimport Url from \"./url\";\nimport Path from \"./path\";\n\nexport function replaceBase(doc, section){\n\tvar base;\n\tvar head;\n\tvar url = section.url;\n\tvar absolute = (url.indexOf(\"://\") > -1);\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tbase = qs(head, \"base\");\n\n\tif(!base) {\n\t\tbase = doc.createElement(\"base\");\n\t\thead.insertBefore(base, head.firstChild);\n\t}\n\n\t// Fix for Safari crashing if the url doesn't have an origin\n\tif (!absolute && window && window.location) {\n\t\turl = window.location.origin + url;\n\t}\n\n\tbase.setAttribute(\"href\", url);\n}\n\nexport function replaceCanonical(doc, section){\n\tvar head;\n\tvar link;\n\tvar url = section.canonical;\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tlink = qs(head, \"link[rel='canonical']\");\n\n\tif (link) {\n\t\tlink.setAttribute(\"href\", url);\n\t} else {\n\t\tlink = doc.createElement(\"link\");\n\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\tlink.setAttribute(\"href\", url);\n\t\thead.appendChild(link);\n\t}\n}\n\nexport function replaceMeta(doc, section){\n\tvar head;\n\tvar meta;\n\tvar id = section.idref;\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tmeta = qs(head, \"link[property='dc.identifier']\");\n\n\tif (meta) {\n\t\tmeta.setAttribute(\"content\", id);\n\t} else {\n\t\tmeta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.identifier\");\n\t\tmeta.setAttribute(\"content\", id);\n\t\thead.appendChild(meta);\n\t}\n}\n\n// TODO: move me to Contents\nexport function replaceLinks(contents, fn) {\n\n\tvar links = contents.querySelectorAll(\"a[href]\");\n\n\tif (!links.length) {\n\t\treturn;\n\t}\n\n\tvar base = qs(contents.ownerDocument, \"base\");\n\tvar location = base ? base.getAttribute(\"href\") : undefined;\n\tvar replaceLink = function(link){\n\t\tvar href = link.getAttribute(\"href\");\n\n\t\tif(href.indexOf(\"mailto:\") === 0){\n\t\t\treturn;\n\t\t}\n\n\t\tvar absolute = (href.indexOf(\"://\") > -1);\n\n\t\tif(absolute){\n\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\n\n\t\t}else{\n\t\t\tvar linkUrl;\n\t\t\ttry {\n\t\t\t\tlinkUrl = new Url(href, location);\t\n\t\t\t} catch(error) {\n\t\t\t\t// NOOP\n\t\t\t}\n\n\t\t\tlink.onclick = function(){\n\n\t\t\t\tif(linkUrl && linkUrl.hash) {\n\t\t\t\t\tfn(linkUrl.Path.path + linkUrl.hash);\n\t\t\t\t} else if(linkUrl){\n\t\t\t\t\tfn(linkUrl.Path.path);\n\t\t\t\t} else {\n\t\t\t\t\tfn(href);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t}.bind(this);\n\n\tfor (var i = 0; i < links.length; i++) {\n\t\treplaceLink(links[i]);\n\t}\n\n\n}\n\nexport function substitute(content, urls, replacements) {\n\turls.forEach(function(url, i){\n\t\tif (url && replacements[i]) {\n\t\t\tcontent = content.replace(new RegExp(url, \"g\"), replacements[i]);\n\t\t}\n\t});\n\treturn content;\n}\n","import { defer } from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Hook from \"./utils/hook\";\nimport { sprint } from \"./utils/core\";\nimport { replaceBase } from \"./utils/replacements\";\n\n/**\n * Represents a Section of the Book\n *\n * In most books this is equivelent to a Chapter\n * @param {object} item  The spine item representing the section\n * @param {object} hooks hooks for serialize and content\n */\nclass Section {\n\tconstructor(item, hooks){\n\t\tthis.idref = item.idref;\n\t\tthis.linear = item.linear === \"yes\";\n\t\tthis.properties = item.properties;\n\t\tthis.index = item.index;\n\t\tthis.href = item.href;\n\t\tthis.url = item.url;\n\t\tthis.canonical = item.canonical;\n\t\tthis.next = item.next;\n\t\tthis.prev = item.prev;\n\n\t\tthis.cfiBase = item.cfiBase;\n\n\t\tif (hooks) {\n\t\t\tthis.hooks = hooks;\n\t\t} else {\n\t\t\tthis.hooks = {};\n\t\t\tthis.hooks.serialize = new Hook(this);\n\t\t\tthis.hooks.content = new Hook(this);\n\t\t}\n\n\t\tthis.document = undefined;\n\t\tthis.contents = undefined;\n\t\tthis.output = undefined;\n\t}\n\n\t/**\n\t * Load the section from its url\n\t * @param  {method} [_request] a request method to use for loading\n\t * @return {document} a promise with the xml document\n\t */\n\tload(_request){\n\t\tvar request = _request || this.request || require(\"./utils/request\");\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(this.contents) {\n\t\t\tloading.resolve(this.contents);\n\t\t} else {\n\t\t\trequest(this.url)\n\t\t\t\t.then(function(xml){\n\t\t\t\t\t// var directory = new Url(this.url).directory;\n\n\t\t\t\t\tthis.document = xml;\n\t\t\t\t\tthis.contents = xml.documentElement;\n\n\t\t\t\t\treturn this.hooks.content.trigger(this.document, this);\n\t\t\t\t}.bind(this))\n\t\t\t\t.then(function(){\n\t\t\t\t\tloading.resolve(this.contents);\n\t\t\t\t}.bind(this))\n\t\t\t\t.catch(function(error){\n\t\t\t\t\tloading.reject(error);\n\t\t\t\t});\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\t/**\n\t * Adds a base tag for resolving urls in the section\n\t * @private\n\t */\n\tbase(){\n\t\treturn replaceBase(this.document, this);\n\t}\n\n\t/**\n\t * Render the contents of a section\n\t * @param  {method} [_request] a request method to use for loading\n\t * @return {string} output a serialized XML Document\n\t */\n\trender(_request){\n\t\tvar rendering = new defer();\n\t\tvar rendered = rendering.promise;\n\t\tthis.output; // TODO: better way to return this from hooks?\n\n\t\tthis.load(_request).\n\t\t\tthen(function(contents){\n\t\t\t\tvar userAgent = (typeof navigator !== 'undefined' && navigator.userAgent) || '';\n\t\t\t\tvar isIE = userAgent.indexOf('Trident') >= 0;\n\t\t\t\tvar Serializer;\n\t\t\t\tif (false && ( typeof XMLSerializer === \"undefined\" || isIE)) {\n\t\t\t\t\tSerializer = require(\"xmldom/dom-parser\").XMLSerializer;\n\t\t\t\t} else {\n\t\t\t\t\tSerializer = XMLSerializer;\n\t\t\t\t}\n\t\t\t\tvar serializer = new Serializer();\n\t\t\t\tthis.output = serializer.serializeToString(contents);\n\t\t\t\treturn this.output;\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\treturn this.hooks.serialize.trigger(this.output, this);\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\trendering.resolve(this.output);\n\t\t\t}.bind(this))\n\t\t\t.catch(function(error){\n\t\t\t\trendering.reject(error);\n\t\t\t});\n\n\t\treturn rendered;\n\t}\n\n\t/**\n\t * Find a string in a section\n\t * @param  {string} _query The query string to find\n\t * @return {object[]} A list of matches, with form {cfi, excerpt}\n\t */\n\tfind(_query){\n\t\tvar section = this;\n\t\tvar matches = [];\n\t\tvar query = _query.toLowerCase();\n\t\tvar find = function(node){\n\t\t\tvar text = node.textContent.toLowerCase();\n\t\t\tvar range = section.document.createRange();\n\t\t\tvar cfi;\n\t\t\tvar pos;\n\t\t\tvar last = -1;\n\t\t\tvar excerpt;\n\t\t\tvar limit = 150;\n\n\t\t\twhile (pos != -1) {\n\t\t\t\t// Search for the query\n\t\t\t\tpos = text.indexOf(query, last + 1);\n\n\t\t\t\tif (pos != -1) {\n\t\t\t\t\t// We found it! Generate a CFI\n\t\t\t\t\trange = section.document.createRange();\n\t\t\t\t\trange.setStart(node, pos);\n\t\t\t\t\trange.setEnd(node, pos + query.length);\n\n\t\t\t\t\tcfi = section.cfiFromRange(range);\n\n\t\t\t\t\t// Generate the excerpt\n\t\t\t\t\tif (node.textContent.length < limit) {\n\t\t\t\t\t\texcerpt = node.textContent;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\texcerpt = node.textContent.substring(pos - limit/2, pos + limit/2);\n\t\t\t\t\t\texcerpt = \"...\" + excerpt + \"...\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add the CFI to the matches list\n\t\t\t\t\tmatches.push({\n\t\t\t\t\t\tcfi: cfi,\n\t\t\t\t\t\texcerpt: excerpt\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlast = pos;\n\t\t\t}\n\t\t};\n\n\t\tsprint(section.document, function(node) {\n\t\t\tfind(node);\n\t\t});\n\n\t\treturn matches;\n\t};\n\n\t/**\n\t* Reconciles the current chapters layout properies with\n\t* the global layout properities.\n\t* @param {object} globalLayout  The global layout settings object, chapter properties string\n\t* @return {object} layoutProperties Object with layout properties\n\t*/\n\treconcileLayoutSettings(globalLayout){\n\t\t//-- Get the global defaults\n\t\tvar settings = {\n\t\t\tlayout : globalLayout.layout,\n\t\t\tspread : globalLayout.spread,\n\t\t\torientation : globalLayout.orientation\n\t\t};\n\n\t\t//-- Get the chapter's display type\n\t\tthis.properties.forEach(function(prop){\n\t\t\tvar rendition = prop.replace(\"rendition:\", \"\");\n\t\t\tvar split = rendition.indexOf(\"-\");\n\t\t\tvar property, value;\n\n\t\t\tif(split != -1){\n\t\t\t\tproperty = rendition.slice(0, split);\n\t\t\t\tvalue = rendition.slice(split+1);\n\n\t\t\t\tsettings[property] = value;\n\t\t\t}\n\t\t});\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Get a CFI from a Range in the Section\n\t * @param  {range} _range\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromRange(_range) {\n\t\treturn new EpubCFI(_range, this.cfiBase).toString();\n\t}\n\n\t/**\n\t * Get a CFI from an Element in the Section\n\t * @param  {element} el\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromElement(el) {\n\t\treturn new EpubCFI(el, this.cfiBase).toString();\n\t}\n\n\t/**\n\t * Unload the section document\n\t */\n\tunload() {\n\t\tthis.document = undefined;\n\t\tthis.contents = undefined;\n\t\tthis.output = undefined;\n\t}\n\n\tdestroy() {\n\t\tthis.unload();\n\t\tthis.hooks.serialize.clear();\n\t\tthis.hooks.content.clear();\n\n\t\tthis.hooks = undefined;\n\t\tthis.idref = undefined;\n\t\tthis.linear = undefined;\n\t\tthis.properties = undefined;\n\t\tthis.index = undefined;\n\t\tthis.href = undefined;\n\t\tthis.url = undefined;\n\t\tthis.next = undefined;\n\t\tthis.prev = undefined;\n\n\t\tthis.cfiBase = undefined;\n\t}\n}\n\nexport default Section;\n","import EpubCFI from \"./epubcfi\";\nimport Hook from \"./utils/hook\";\nimport Section from \"./section\";\nimport {replaceBase, replaceCanonical, replaceMeta} from \"./utils/replacements\";\n\n/**\n * A collection of Spine Items\n */\nclass Spine {\n\tconstructor() {\n\t\tthis.spineItems = [];\n\t\tthis.spineByHref = {};\n\t\tthis.spineByAbsoluteHref = {};\n\t\tthis.spineById = {};\n\n\t\tthis.hooks = {};\n\t\tthis.hooks.serialize = new Hook();\n\t\tthis.hooks.content = new Hook();\n\n\t\t// Register replacements\n\t\tthis.hooks.content.register(replaceBase);\n\t\tthis.hooks.content.register(replaceCanonical);\n\t\tthis.hooks.content.register(replaceMeta);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.loaded = false;\n\n\t\tthis.items = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.baseUrl = undefined;\n\t\tthis.length = undefined;\n\t}\n\n\t/**\n\t * Unpack items from a opf into spine items\n\t * @param  {Packaging} _package\n\t * @param  {method} resolver URL resolver\n\t * @param  {method} canonical Resolve canonical url\n\t */\n\tunpack(_package, resolver, canonical) {\n\n\t\tthis.items = _package.spine;\n\t\tthis.manifest = _package.manifest;\n\t\tthis.spineNodeIndex = _package.spineNodeIndex;\n\t\tthis.baseUrl = _package.baseUrl || _package.basePath || \"\";\n\t\tthis.length = this.items.length;\n\n\t\tthis.items.forEach( (item, index) => {\n\t\t\tvar manifestItem = this.manifest[item.idref];\n\t\t\tvar spineItem;\n\n\t\t\titem.index = index;\n\t\t\titem.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\n\n\t\t\tif (item.href) {\n\t\t\t\titem.url = resolver(item.href, true);\n\t\t\t\titem.canonical = canonical(item.href);\n\t\t\t}\n\n\t\t\tif(manifestItem) {\n\t\t\t\titem.href = manifestItem.href;\n\t\t\t\titem.url = resolver(item.href, true);\n\t\t\t\titem.canonical = canonical(item.href);\n\n\t\t\t\tif(manifestItem.properties.length){\n\t\t\t\t\titem.properties.push.apply(item.properties, manifestItem.properties);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.linear === \"yes\") {\n\t\t\t\titem.prev = function() {\n\t\t\t\t\tlet prevIndex = item.index;\n\t\t\t\t\twhile (prevIndex > 0) {\n\t\t\t\t\t\tlet prev = this.get(prevIndex-1);\n\t\t\t\t\t\tif (prev && prev.linear) {\n\t\t\t\t\t\t\treturn prev;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprevIndex -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}.bind(this);\n\t\t\t\titem.next = function() {\n\t\t\t\t\tlet nextIndex = item.index;\n\t\t\t\t\twhile (nextIndex < this.spineItems.length-1) {\n\t\t\t\t\t\tlet next = this.get(nextIndex+1);\n\t\t\t\t\t\tif (next && next.linear) {\n\t\t\t\t\t\t\treturn next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}.bind(this);\n\t\t\t} else {\n\t\t\t\titem.prev = function() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\titem.next = function() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tspineItem = new Section(item, this.hooks);\n\n\t\t\tthis.append(spineItem);\n\n\n\t\t});\n\n\t\tthis.loaded = true;\n\t}\n\n\t/**\n\t * Get an item from the spine\n\t * @param  {string|number} [target]\n\t * @return {Section} section\n\t * @example spine.get();\n\t * @example spine.get(1);\n\t * @example spine.get(\"chap1.html\");\n\t * @example spine.get(\"#id1234\");\n\t */\n\tget(target) {\n\t\tvar index = 0;\n\n\t\tif (typeof target === \"undefined\") {\n\t\t\twhile (index < this.spineItems.length) {\n\t\t\t\tlet next = this.spineItems[index];\n\t\t\t\tif (next && next.linear) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tindex += 1;\n\t\t\t}\n\t\t} else if(this.epubcfi.isCfiString(target)) {\n\t\t\tlet cfi = new EpubCFI(target);\n\t\t\tindex = cfi.spinePos;\n\t\t} else if(typeof target === \"number\" || isNaN(target) === false){\n\t\t\tindex = target;\n\t\t} else if(typeof target === \"string\" && target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.spineById[target.substring(1)];\n\t\t} else if(typeof target === \"string\") {\n\t\t\t// Remove fragments\n\t\t\ttarget = target.split(\"#\")[0];\n\t\t\tindex = this.spineByAbsoluteHref[target] || this.spineByAbsoluteHref[encodeURI(target)] || this.spineByHref[target] || this.spineByHref[encodeURI(target)];\n\t\t\tif ( ! index ) {\n\t\t\t\t// check for relative paths\n\t\t\t\tfor(var i = 0; i < this.spineItems.length; i++)\t{\n\t\t\t\t\tif ( this.spineItems[i].href.indexOf('/' + target) > -1 ) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.spineItems[index] || null;\n\t}\n\n\t/**\n\t * Append a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tappend(section) {\n\t\tvar index = this.spineItems.length;\n\t\tsection.index = index;\n\n\t\tthis.spineItems.push(section);\n\n\t\t// Encode and Decode href lookups\n\t\t// see pr for details: https://github.com/futurepress/epub.js/pull/358\n\t\tthis.spineByHref[decodeURI(section.href)] = index;\n\t\tthis.spineByHref[encodeURI(section.href)] = index;\n\t\tthis.spineByHref[section.href.substring(section.href.lastIndexOf('/')+1)] = index;\n\t\tthis.spineByHref[section.href] = index;\n\n\t\tthis.spineById[section.idref] = index;\n\n\t\tthis.spineByAbsoluteHref[section.url] = index;\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Prepend a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tprepend(section) {\n\t\t// var index = this.spineItems.unshift(section);\n\t\tthis.spineByHref[section.href] = 0;\n\t\tthis.spineById[section.idref] = 0;\n\n\t\t// Re-index\n\t\tthis.spineItems.forEach(function(item, index){\n\t\t\titem.index = index;\n\t\t});\n\n\t\treturn 0;\n\t}\n\n\t// insert(section, index) {\n\t//\n\t// };\n\n\t/**\n\t * Remove a Section from the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tremove(section) {\n\t\tvar index = this.spineItems.indexOf(section);\n\n\t\tif(index > -1) {\n\t\t\tdelete this.spineByHref[section.href];\n\t\t\tdelete this.spineById[section.idref];\n\n\t\t\treturn this.spineItems.splice(index, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Loop over the Sections in the Spine\n\t * @return {method} forEach\n\t */\n\teach() {\n\t\treturn this.spineItems.forEach.apply(this.spineItems, arguments);\n\t}\n\n\t/**\n\t * Find the first Section in the Spine\n\t * @return {Section} first section\n\t */\n\tfirst() {\n\t\tlet index = 0;\n\n\t\tdo {\n\t\t\tlet next = this.get(index);\n\n\t\t\tif (next && next.linear) {\n\t\t\t\treturn next;\n\t\t\t}\n\t\t\tindex += 1;\n\t\t} while (index < this.spineItems.length) ;\n\t}\n\n\t/**\n\t * Find the last Section in the Spine\n\t * @return {Section} last section\n\t */\n\tlast() {\n\t\tlet index = this.spineItems.length-1;\n\n\t\tdo {\n\t\t\tlet prev = this.get(index);\n\t\t\tif (prev && prev.linear) {\n\t\t\t\treturn prev;\n\t\t\t}\n\t\t\tindex -= 1;\n\t\t} while (index >= 0);\n\t}\n\n\tdestroy() {\n\t\tthis.each((section) => section.destroy());\n\n\t\tthis.spineItems = undefined\n\t\tthis.spineByHref = undefined\n\t\tthis.spineById = undefined\n\n\t\tthis.hooks.serialize.clear();\n\t\tthis.hooks.content.clear();\n\t\tthis.hooks = undefined;\n\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.loaded = false;\n\n\t\tthis.items = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.baseUrl = undefined;\n\t\tthis.length = undefined;\n\t}\n}\n\nexport default Spine;\n","import {defer, requestAnimationFrame} from \"./core\";\n\n/**\n * Queue for handling tasks one at a time\n * @class\n * @param {scope} context what this will resolve to in the tasks\n */\nclass Queue {\n\tconstructor(context){\n\t\tthis._q = [];\n\t\tthis.context = context;\n\t\tthis.tick = requestAnimationFrame;\n\t\tthis.running = false;\n\t\tthis.paused = false;\n\t}\n\n\t/**\n\t * Add an item to the queue\n\t * @return {Promise}\n\t */\n\tenqueue() {\n\t\tvar deferred, promise;\n\t\tvar queued;\n\t\tvar task = [].shift.call(arguments);\n\t\tvar args = arguments;\n\n\t\t// Handle single args without context\n\t\t// if(args && !Array.isArray(args)) {\n\t\t//   args = [args];\n\t\t// }\n\t\tif(!task) {\n\t\t\tthrow new Error(\"No Task Provided\");\n\t\t}\n\n\t\tif(typeof task === \"function\"){\n\n\t\t\tdeferred = new defer();\n\t\t\tpromise = deferred.promise;\n\n\t\t\tqueued = {\n\t\t\t\t\"task\" : task,\n\t\t\t\t\"args\"     : args,\n\t\t\t\t//\"context\"  : context,\n\t\t\t\t\"deferred\" : deferred,\n\t\t\t\t\"promise\" : promise\n\t\t\t};\n\n\t\t} else {\n\t\t\t// Task is a promise\n\t\t\tqueued = {\n\t\t\t\t\"promise\" : task\n\t\t\t};\n\n\t\t}\n\n\t\tthis._q.push(queued);\n\n\t\t// Wait to start queue flush\n\t\tif (this.paused == false && !this.running) {\n\t\t\t// setTimeout(this.flush.bind(this), 0);\n\t\t\t// this.tick.call(window, this.run.bind(this));\n\t\t\tthis.run();\n\t\t}\n\n\t\treturn queued.promise;\n\t}\n\n\t/**\n\t * Run one item\n\t * @return {Promise}\n\t */\n\tdequeue(){\n\t\tvar inwait, task, result;\n\n\t\tif(this._q.length && !this.paused) {\n\t\t\tinwait = this._q.shift();\n\t\t\ttask = inwait.task;\n\t\t\tif(task){\n\t\t\t\t// console.log(task)\n\n\t\t\t\tresult = task.apply(this.context, inwait.args);\n\n\t\t\t\tif(result && typeof result[\"then\"] === \"function\") {\n\t\t\t\t\t// Task is a function that returns a promise\n\t\t\t\t\treturn result.then(function(){\n\t\t\t\t\t\tinwait.deferred.resolve.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this), function() {\n\t\t\t\t\t\tinwait.deferred.reject.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else {\n\t\t\t\t\t// Task resolves immediately\n\t\t\t\t\tinwait.deferred.resolve.apply(this.context, result);\n\t\t\t\t\treturn inwait.promise;\n\t\t\t\t}\n\n\n\n\t\t\t} else if(inwait.promise) {\n\t\t\t\t// Task is a promise\n\t\t\t\treturn inwait.promise;\n\t\t\t}\n\n\t\t} else {\n\t\t\tinwait = new defer();\n\t\t\tinwait.deferred.resolve();\n\t\t\treturn inwait.promise;\n\t\t}\n\n\t}\n\n\t// Run All Immediately\n\tdump(){\n\t\twhile(this._q.length) {\n\t\t\tthis.dequeue();\n\t\t}\n\t}\n\n\t/**\n\t * Run all tasks sequentially, at convince\n\t * @return {Promise}\n\t */\n\trun(){\n\n\t\tif(!this.running){\n\t\t\tthis.running = true;\n\t\t\tthis.defered = new defer();\n\t\t}\n\n\t\tthis.tick.call(window, () => {\n\n\t\t\tif(this._q.length) {\n\n\t\t\t\tthis.dequeue()\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tthis.run();\n\t\t\t\t\t}.bind(this));\n\n\t\t\t} else {\n\t\t\t\tthis.defered.resolve();\n\t\t\t\tthis.running = undefined;\n\t\t\t}\n\n\t\t});\n\n\t\t// Unpause\n\t\tif(this.paused == true) {\n\t\t\tthis.paused = false;\n\t\t}\n\n\t\treturn this.defered.promise;\n\t}\n\n\t/**\n\t * Flush all, as quickly as possible\n\t * @return {Promise}\n\t */\n\tflush(){\n\n\t\tif(this.running){\n\t\t\treturn this.running;\n\t\t}\n\n\t\tif(this._q.length) {\n\t\t\tthis.running = this.dequeue()\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.running = undefined;\n\t\t\t\t\treturn this.flush();\n\t\t\t\t}.bind(this));\n\n\t\t\treturn this.running;\n\t\t}\n\n\t}\n\n\t/**\n\t * Clear all items in wait\n\t */\n\tclear(){\n\t\tthis._q = [];\n\t}\n\n\t/**\n\t * Get the number of tasks in the queue\n\t * @return {number} tasks\n\t */\n\tlength(){\n\t\treturn this._q.length;\n\t}\n\n\t/**\n\t * Pause a running queue\n\t */\n\tpause(){\n\t\tthis.paused = true;\n\t}\n\n\t/**\n\t * End the queue\n\t */\n\tstop(){\n\t\tthis._q = [];\n\t\tthis.running = false;\n\t\tthis.paused = true;\n\t}\n}\n\n\n/**\n * Create a new task from a callback\n * @class\n * @private\n * @param {function} task\n * @param {array} args\n * @param {scope} context\n * @return {function} task\n */\nclass Task {\n\tconstructor(task, args, context){\n\n\t\treturn function(){\n\t\t\tvar toApply = arguments || [];\n\n\t\t\treturn new Promise( (resolve, reject) => {\n\t\t\t\tvar callback = function(value, err){\n\t\t\t\t\tif (!value && err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t// Add the callback to the arguments list\n\t\t\t\ttoApply.push(callback);\n\n\t\t\t\t// Apply all arguments to the functions\n\t\t\t\ttask.apply(context || this, toApply);\n\n\t\t\t});\n\n\t\t};\n\n\t}\n}\n\n\nexport default Queue;\nexport { Task };\n","export const EPUBJS_VERSION = \"0.3\";\n\n// Dom events to listen for\nexport const DOM_EVENTS = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\", \"touchmove\"];\n\nexport const EVENTS = {\n  BOOK : {\n    OPEN_FAILED : \"openFailed\"\n  },\n  CONTENTS : {\n    EXPAND : \"expand\",\n    RESIZE : \"resize\",\n    SELECTED : \"selected\",\n    SELECTED_RANGE : \"selectedRange\",\n    LINK_CLICKED : \"linkClicked\"\n  },\n  LOCATIONS : {\n    CHANGED : \"changed\"\n  },\n  MANAGERS : {\n    RESIZE : \"resize\",\n    RESIZED : \"resized\",\n    ORIENTATION_CHANGE : \"orientationchange\",\n    ADDED : \"added\",\n    SCROLL : \"scroll\",\n    SCROLLED : \"scrolled\",\n    REMOVED : \"removed\",\n  },\n  VIEWS : {\n    AXIS : \"axis\",\n    LOAD_ERROR : \"loaderror\",\n    RENDERED : \"rendered\",\n    RESIZED : \"resized\",\n    DISPLAYED : \"displayed\",\n    SHOWN : \"shown\",\n    HIDDEN : \"hidden\",\n    MARK_CLICKED : \"markClicked\"\n  },\n  RENDITION : {\n    STARTED : \"started\",\n    ATTACHED : \"attached\",\n    DISPLAYED : \"displayed\",\n    DISPLAY_ERROR : \"displayerror\",\n    RENDERED : \"rendered\",\n    REMOVED : \"removed\",\n    RESIZED : \"resized\",\n    ORIENTATION_CHANGE : \"orientationchange\",\n    LOCATION_CHANGED : \"locationChanged\",\n    RELOCATED : \"relocated\",\n    MARK_CLICKED : \"markClicked\",\n    SELECTED : \"selected\",\n    LAYOUT: \"layout\"\n  },\n  LAYOUT : {\n    UPDATED : \"updated\"\n  }\n}\n","import {qs, sprint, locationOf, defer} from \"./utils/core\";\nimport Queue from \"./utils/queue\";\nimport EpubCFI from \"./epubcfi\";\nimport { EVENTS } from \"./utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Find Locations for a Book\n * @param {Spine} spine\n * @param {request} request\n * @param {number} [pause=100]\n */\nclass Locations {\n\tconstructor(spine, request, pause) {\n\t\tthis.spine = spine;\n\t\tthis.request = request;\n\t\tthis.pause = pause || 100;\n\n\t\tthis.q = new Queue(this);\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis._locations = [];\n\t\tthis.total = 0;\n\n\t\tthis.break = 150;\n\n\t\tthis._current = 0;\n\n\t\tthis.currentLocation = '';\n\t\tthis._currentCfi ='';\n\t\tthis.processingTimeout = undefined;\n\t}\n\n\tgenerateFromPageList(pageList) {\n\n\t\tthis.break = 1600;\n\t\tthis.q.pause();\n\n\t\tvar i = 0;\n\n\t\tthis._pageList = pageList;\n\n\t\tthis.spine.each(function(section) {\n\t\t\tif (section.linear) {\n\t\t\t\tthis.q.enqueue(this.process.bind(this), section);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn this.q.run().then(function() {\n\t\t\tthis.total = this._locations.length - 1;\n\n\t\t\tif (this._currentCfi) {\n\t\t\t\tthis.currentLocation = this._currentCfi;\n\t\t\t}\n\n\t\t\treturn this._locations;\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Load all of sections in the book to generate locations\n\t * @param  {int} chars how many chars to split on\n\t * @return {object} locations\n\t */\n\tgenerate(chars) {\n\n\t\tif (chars) {\n\t\t\tthis.break = chars;\n\t\t}\n\n\t\tthis.q.pause();\n\n\t\tthis.spine.each(function(section) {\n\t\t\tif (section.linear) {\n\t\t\t\tthis.q.enqueue(this.process.bind(this), section);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn this.q.run().then(function() {\n\t\t\tthis.total = this._locations.length - 1;\n\n\t\t\tif (this._currentCfi) {\n\t\t\t\tthis.currentLocation = this._currentCfi;\n\t\t\t}\n\n\t\t\treturn this._locations;\n\t\t\t// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\n\t\t}.bind(this));\n\n\t}\n\n\tcreateRange () {\n\t\treturn {\n\t\t\tstartContainer: undefined,\n\t\t\tstartOffset: undefined,\n\t\t\tendContainer: undefined,\n\t\t\tendOffset: undefined\n\t\t};\n\t}\n\n\tprocess(section) {\n\n\t\treturn section.load(this.request)\n\t\t\t.then(function(contents) {\n\t\t\t\tvar completed = new defer();\n\t\t\t\tvar locations = this.parse(contents, section.cfiBase);\n\t\t\t\tthis._locations = this._locations.concat(locations);\n\n\t\t\t\tif ( this._pageList ) {\n\n\t\t\t\t\tvar pages = this._pageList.pagesByAbsolutePath[section.canonical] || []; // || \n\n\t\t\t\t\tpages.forEach((page) => {\n\t\t\t\t\t\tvar item = this._pageList.pageList[page - 1];\n\n\t\t\t\t\t\tvar parts = item.href.split('#');\n\t\t\t\t\t\tvar target = parts[1] ? '#' + parts[1] : 'body';\n\t\t\t\t\t\tvar node = contents.ownerDocument.querySelector(target);\n\t\t\t\t\t\tvar cfi = section.cfiFromElement(node);\n\t\t\t\t\t\tthis._pageList.locations[page - 1] = cfi;\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tsection.unload();\n\n\t\t\t\tthis.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\n\t\t\t\treturn completed.promise;\n\t\t\t}.bind(this));\n\n\t}\n\n\tparse(contents, cfiBase, chars) {\n\t\tvar locations = [];\n\t\tvar range;\n\t\tvar doc = contents.ownerDocument;\n\t\tvar body = qs(doc, \"body\");\n\t\tvar counter = 0;\n\t\tvar prev;\n\t\tvar _break = chars || this.break;\n\t\tvar parser = function(node) {\n\t\t\tvar len = node.length;\n\t\t\tvar dist;\n\t\t\tvar pos = 0;\n\n\t\t\tif (node.textContent.trim().length === 0) {\n\t\t\t\treturn false; // continue\n\t\t\t}\n\n\t\t\t// Start range\n\t\t\tif (counter == 0) {\n\t\t\t\trange = this.createRange();\n\t\t\t\trange.startContainer = node;\n\t\t\t\trange.startOffset = 0;\n\t\t\t}\n\n\t\t\tdist = _break - counter;\n\n\t\t\t// Node is smaller than a break,\n\t\t\t// skip over it\n\t\t\tif(dist > len){\n\t\t\t\tcounter += len;\n\t\t\t\tpos = len;\n\t\t\t}\n\n\n\t\t\twhile (pos < len) {\n\t\t\t\tdist = _break - counter;\n\n\t\t\t\tif (counter === 0) {\n\t\t\t\t\t// Start new range\n\t\t\t\t\tpos += 1;\n\t\t\t\t\trange = this.createRange();\n\t\t\t\t\trange.startContainer = node;\n\t\t\t\t\trange.startOffset = pos;\n\t\t\t\t}\n\n\t\t\t\t// pos += dist;\n\n\t\t\t\t// Gone over\n\t\t\t\tif(pos + dist >= len){\n\t\t\t\t\t// Continue counter for next node\n\t\t\t\t\tcounter += len - pos;\n\t\t\t\t\t// break\n\t\t\t\t\tpos = len;\n\t\t\t\t// At End\n\t\t\t\t} else {\n\t\t\t\t\t// Advance pos\n\t\t\t\t\tpos += dist;\n\n\t\t\t\t\t// End the previous range\n\t\t\t\t\trange.endContainer = node;\n\t\t\t\t\trange.endOffset = pos;\n\t\t\t\t\t// cfi = section.cfiFromRange(range);\n\t\t\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\t\t\tlocations.push(cfi);\n\t\t\t\t\tcounter = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprev = node;\n\t\t};\n\n\t\tsprint(body, parser.bind(this));\n\n\t\t// Close remaining\n\t\tif (range && range.startContainer && prev) {\n\t\t\trange.endContainer = prev;\n\t\t\trange.endOffset = prev.length;\n\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\tlocations.push(cfi);\n\t\t\tcounter = 0;\n\t\t}\n\n\t\treturn locations;\n\t}\n\n\t/**\n\t * Get a location from an EpubCFI\n\t * @param {EpubCFI} cfi\n\t * @return {number}\n\t */\n\tlocationFromCfi(cfi){\n\t\tlet loc;\n\t\tif (EpubCFI.prototype.isCfiString(cfi)) {\n\t\t\tcfi = new EpubCFI(cfi);\n\t\t}\n\t\t// Check if the location has not been set yet\n\t\tif(this._locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tloc = locationOf(cfi, this._locations, this.epubcfi.compare);\n\n\t\tif (loc > this.total) {\n\t\t\treturn this.total;\n\t\t}\n\n\t\treturn loc;\n\t}\n\n\t/**\n\t * Get a percentage position in locations from an EpubCFI\n\t * @param {EpubCFI} cfi\n\t * @return {number}\n\t */\n\tpercentageFromCfi(cfi) {\n\t\tif(this._locations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\t\t// Find closest cfi\n\t\tvar loc = this.locationFromCfi(cfi);\n\t\t// Get percentage in total\n\t\treturn this.percentageFromLocation(loc);\n\t}\n\n\t/**\n\t * Get a percentage position from a location index\n\t * @param {number} location\n\t * @return {number}\n\t */\n\tpercentageFromLocation(loc) {\n\t\tif (!loc || !this.total) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn (loc / this.total);\n\t}\n\n\t/**\n\t * Get an EpubCFI from location index\n\t * @param {number} loc\n\t * @return {EpubCFI} cfi\n\t */\n\tcfiFromLocation(loc){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof loc != \"number\"){\n\t\t\tloc = parseInt(loc);\n\t\t}\n\n\t\tif(loc >= 0 && loc < this._locations.length) {\n\t\t\tcfi = this._locations[loc];\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Get an EpubCFI from location percentage\n\t * @param {number} percentage\n\t * @return {EpubCFI} cfi\n\t */\n\tcfiFromPercentage(percentage){\n\t\tlet loc;\n\t\tif (percentage > 1) {\n\t\t\tconsole.warn(\"Normalize cfiFromPercentage value to between 0 - 1\");\n\t\t}\n\n\t\t// Make sure 1 goes to very end\n\t\tif (percentage >= 1) {\n\t\t\tlet cfi = new EpubCFI(this._locations[this.total]);\n\t\t\tcfi.collapse();\n\t\t\treturn cfi.toString();\n\t\t}\n\n\t\tloc = Math.ceil(this.total * percentage);\n\t\treturn this.cfiFromLocation(loc);\n\t}\n\n\t/**\n\t * Load locations from JSON\n\t * @param {json} locations\n\t */\n\tload(locations){\n\t\tif (typeof locations === \"string\") {\n\t\t\tthis._locations = JSON.parse(locations);\n\t\t} else {\n\t\t\tthis._locations = locations;\n\t\t}\n\t\tthis.total = this._locations.length - 1;\n\t\treturn this._locations;\n\t}\n\n\t/**\n\t * Save locations to JSON\n\t * @return {json}\n\t */\n\tsave(){\n\t\treturn JSON.stringify(this._locations);\n\t}\n\n\tgetCurrent(){\n\t\treturn this._current;\n\t}\n\n\tsetCurrent(curr){\n\t\tvar loc;\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tthis._currentCfi = curr;\n\t\t} else if (typeof curr == \"number\") {\n\t\t\tthis._current = curr;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._locations.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tloc = this.locationFromCfi(curr);\n\t\t\tthis._current = loc;\n\t\t} else {\n\t\t\tloc = curr;\n\t\t}\n\n\t\tthis.emit(EVENTS.LOCATIONS.CHANGED, {\n\t\t\tpercentage: this.percentageFromLocation(loc)\n\t\t});\n\t}\n\n\t/**\n\t * Get the current location\n\t */\n\tget currentLocation() {\n\t\treturn this._current;\n\t}\n\n\t/**\n\t * Set the current location\n\t */\n\tset currentLocation(curr) {\n\t\tthis.setCurrent(curr);\n\t}\n\n\t/**\n\t * Locations length\n\t */\n\tlength () {\n\t\treturn this._locations.length;\n\t}\n\n\tdestroy () {\n\t\tthis.spine = undefined;\n\t\tthis.request = undefined;\n\t\tthis.pause = undefined;\n\n\t\tthis.q.stop();\n\t\tthis.q = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis._locations = undefined\n\t\tthis.total = undefined;\n\n\t\tthis.break = undefined;\n\t\tthis._current = undefined;\n\n\t\tthis.currentLocation = undefined;\n\t\tthis._currentCfi = undefined;\n\t\tclearTimeout(this.processingTimeout);\n\t}\n}\n\nEventEmitter(Locations.prototype);\n\nexport default Locations;\n","import path from \"path-webpack\";\nimport {qs} from \"./utils/core\";\n\n/**\n * Handles Parsing and Accessing an Epub Container\n * @class\n * @param {document} [containerDocument] xml document\n */\nclass Container {\n\tconstructor(containerDocument) {\n\t\tthis.packagePath = '';\n\t\tthis.directory = '';\n\t\tthis.encoding = '';\n\n\t\tif (containerDocument) {\n\t\t\tthis.parse(containerDocument);\n\t\t}\n\t}\n\n\t/**\n\t * Parse the Container XML\n\t * @param  {document} containerDocument\n\t */\n\tparse(containerDocument){\n\t\t//-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\n\t\tvar rootfile;\n\n\t\tif(!containerDocument) {\n\t\t\tthrow new Error(\"Container File Not Found\");\n\t\t}\n\n\t\trootfile = qs(containerDocument, \"rootfile\");\n\n\t\tif(!rootfile) {\n\t\t\tthrow new Error(\"No RootFile Found\");\n\t\t}\n\n\t\tthis.packagePath = rootfile.getAttribute(\"full-path\");\n\t\tthis.directory = path.dirname(this.packagePath);\n\t\tthis.encoding = containerDocument.xmlEncoding;\n\t}\n\n\tdestroy() {\n\t\tthis.packagePath = undefined;\n\t\tthis.directory = undefined;\n\t\tthis.encoding = undefined;\n\t}\n}\n\nexport default Container;\n","import {qs, qsa, qsp, indexOfElementNode} from \"./utils/core\";\n\n/**\n * Open Packaging Format Parser\n * @class\n * @param {document} packageDocument OPF XML\n */\nclass Packaging {\n\tconstructor(packageDocument) {\n\t\tthis.manifest = {};\n\t\tthis.navPath = '';\n\t\tthis.ncxPath = '';\n\t\tthis.coverPath = '';\n\t\tthis.spineNodeIndex = 0;\n\t\tthis.spine = [];\n\t\tthis.metadata = {};\n\n\t\tif (packageDocument) {\n\t\t\tthis.parse(packageDocument);\n\t\t}\n\t}\n\n\t/**\n\t * Parse OPF XML\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tparse(packageDocument){\n\t\tvar metadataNode, manifestNode, spineNode;\n\n\t\tif(!packageDocument) {\n\t\t\tthrow new Error(\"Package File Not Found\");\n\t\t}\n\n\t\tmetadataNode = qs(packageDocument, \"metadata\");\n\t\tif(!metadataNode) {\n\t\t\tthrow new Error(\"No Metadata Found\");\n\t\t}\n\n\t\tmanifestNode = qs(packageDocument, \"manifest\");\n\t\tif(!manifestNode) {\n\t\t\tthrow new Error(\"No Manifest Found\");\n\t\t}\n\n\t\tspineNode = qs(packageDocument, \"spine\");\n\t\tif(!spineNode) {\n\t\t\tthrow new Error(\"No Spine Found\");\n\t\t}\n\n\t\tthis.manifest = this.parseManifest(manifestNode);\n\t\tthis.navPath = this.findNavPath(manifestNode);\n\t\tthis.ncxPath = this.findNcxPath(manifestNode, spineNode);\n\t\tthis.coverPath = this.findCoverPath(packageDocument);\n\n\t\tthis.spineNodeIndex = indexOfElementNode(spineNode);\n\n\t\tthis.spine = this.parseSpine(spineNode, this.manifest);\n\n\t\tthis.uniqueIdentifier = this.findUniqueIdentifier(packageDocument);\n\t\tthis.metadata = this.parseMetadata(metadataNode);\n\n\t\tthis.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\n\n\n\t\treturn {\n\t\t\t\"metadata\" : this.metadata,\n\t\t\t\"spine\"    : this.spine,\n\t\t\t\"manifest\" : this.manifest,\n\t\t\t\"navPath\"  : this.navPath,\n\t\t\t\"ncxPath\"  : this.ncxPath,\n\t\t\t\"coverPath\": this.coverPath,\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex\n\t\t};\n\t}\n\n\t/**\n\t * Parse Metadata\n\t * @private\n\t * @param  {node} xml\n\t * @return {object} metadata\n\t */\n\tparseMetadata(xml){\n\t\tvar metadata = {};\n\n\t\tmetadata.title = this.getElementText(xml, \"title\");\n\t\tmetadata.creator = this.getElementText(xml, \"creator\");\n\t\tmetadata.description = this.getElementText(xml, \"description\");\n\n\t\tmetadata.pubdate = this.getElementText(xml, \"date\");\n\n\t\tmetadata.publisher = this.getElementText(xml, \"publisher\");\n\n\t\tmetadata.identifier = this.getElementText(xml, \"identifier\");\n\t\tmetadata.language = this.getElementText(xml, \"language\");\n\t\tmetadata.rights = this.getElementText(xml, \"rights\");\n\n\t\tmetadata.modified_date = this.getPropertyText(xml, \"dcterms:modified\");\n\n\t\tmetadata.layout = this.getPropertyText(xml, \"rendition:layout\");\n\t\tmetadata.orientation = this.getPropertyText(xml, \"rendition:orientation\");\n\t\tmetadata.flow = this.getPropertyText(xml, \"rendition:flow\");\n\t\tmetadata.viewport = this.getPropertyText(xml, \"rendition:viewport\");\n\t\tmetadata.media_active_class = this.getPropertyText(xml, \"media:active-class\");\n\t\t// metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\n\n\t\treturn metadata;\n\t}\n\n\t/**\n\t * Parse Manifest\n\t * @private\n\t * @param  {node} manifestXml\n\t * @return {object} manifest\n\t */\n\tparseManifest(manifestXml){\n\t\tvar manifest = {};\n\n\t\t//-- Turn items into an array\n\t\t// var selected = manifestXml.querySelectorAll(\"item\");\n\t\tvar selected = qsa(manifestXml, \"item\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t//-- Create an object with the id as key\n\t\titems.forEach(function(item){\n\t\t\tvar id = item.getAttribute(\"id\"),\n\t\t\t\t\thref = item.getAttribute(\"href\") || \"\",\n\t\t\t\t\ttype = item.getAttribute(\"media-type\") || \"\",\n\t\t\t\t\toverlay = item.getAttribute(\"media-overlay\") || \"\",\n\t\t\t\t\tproperties = item.getAttribute(\"properties\") || \"\";\n\n\t\t\tmanifest[id] = {\n\t\t\t\t\"href\" : href,\n\t\t\t\t// \"url\" : href,\n\t\t\t\t\"type\" : type,\n\t\t\t\t\"overlay\" : overlay,\n\t\t\t\t\"properties\" : properties.length ? properties.split(\" \") : []\n\t\t\t};\n\n\t\t});\n\n\t\treturn manifest;\n\n\t}\n\n\t/**\n\t * Parse Spine\n\t * @private\n\t * @param  {node} spineXml\n\t * @param  {Packaging.manifest} manifest\n\t * @return {object} spine\n\t */\n\tparseSpine(spineXml, manifest){\n\t\tvar spine = [];\n\n\t\tvar selected = qsa(spineXml, \"itemref\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t// var epubcfi = new EpubCFI();\n\n\t\t//-- Add to array to mantain ordering and cross reference with manifest\n\t\titems.forEach(function(item, index){\n\t\t\tvar idref = item.getAttribute(\"idref\");\n\t\t\t// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\n\t\t\tvar props = item.getAttribute(\"properties\") || \"\";\n\t\t\tvar propArray = props.length ? props.split(\" \") : [];\n\t\t\t// var manifestProps = manifest[Id].properties;\n\t\t\t// var manifestPropArray = manifestProps.length ? manifestProps.split(\" \") : [];\n\n\t\t\tvar itemref = {\n\t\t\t\t\"idref\" : idref,\n\t\t\t\t\"linear\" : item.getAttribute(\"linear\") || \"yes\",\n\t\t\t\t\"properties\" : propArray,\n\t\t\t\t// \"href\" : manifest[Id].href,\n\t\t\t\t// \"url\" :  manifest[Id].url,\n\t\t\t\t\"index\" : index\n\t\t\t\t// \"cfiBase\" : cfiBase\n\t\t\t};\n\t\t\tspine.push(itemref);\n\t\t});\n\n\t\treturn spine;\n\t}\n\n\t/**\n\t * Find Unique Identifier\n\t * @private\n\t * @param  {node} packageXml\n\t * @return {string} Unique Identifier text\n\t */\n\tfindUniqueIdentifier(packageXml){\n\t\tvar uniqueIdentifierId = packageXml.documentElement.getAttribute(\"unique-identifier\");\n\t\tif (! uniqueIdentifierId) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar identifier = packageXml.getElementById(uniqueIdentifierId);\n\t\tif (! identifier) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (identifier.localName === \"identifier\" && identifier.namespaceURI === \"http://purl.org/dc/elements/1.1/\") {\n\t\t\treturn identifier.childNodes[0].nodeValue.trim();\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Find TOC NAV\n\t * @private\n\t * @param {element} manifestNode\n\t * @return {string}\n\t */\n\tfindNavPath(manifestNode){\n\t\t// Find item with property \"nav\"\n\t\t// Should catch nav irregardless of order\n\t\t// var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"properties\":\"nav\"});\n\t\treturn node ? node.getAttribute(\"href\") : false;\n\t}\n\n\t/**\n\t * Find TOC NCX\n\t * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\n\t * @private\n\t * @param {element} manifestNode\n\t * @param {element} spineNode\n\t * @return {string}\n\t */\n\tfindNcxPath(manifestNode, spineNode){\n\t\t// var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"media-type\":\"application/x-dtbncx+xml\"});\n\t\tvar tocId;\n\n\t\t// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\n\t\t// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\n\t\t// \"The item that describes the NCX must be referenced by the spine toc attribute.\"\n\t\tif (!node) {\n\t\t\ttocId = spineNode.getAttribute(\"toc\");\n\t\t\tif(tocId) {\n\t\t\t\t// node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\n\t\t\t\tnode = manifestNode.querySelector(`#${tocId}`);\n\t\t\t}\n\t\t}\n\n\t\treturn node ? node.getAttribute(\"href\") : false;\n\t}\n\n\t/**\n\t * Find the Cover Path\n\t * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\n\t * Fallback for Epub 2.0\n\t * @private\n\t * @param  {node} packageXml\n\t * @return {string} href\n\t */\n\tfindCoverPath(packageXml){\n\t\tvar pkg = qs(packageXml, \"package\");\n\t\tvar epubVersion = pkg.getAttribute(\"version\");\n\n\t\tif (epubVersion === \"2.0\") {\n\t\t\tvar metaCover = qsp(packageXml, \"meta\", {\"name\":\"cover\"});\n\t\t\tif (metaCover) {\n\t\t\t\tvar coverId = metaCover.getAttribute(\"content\");\n\t\t\t\t// var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\n\t\t\t\tvar cover = packageXml.getElementById(coverId);\n\t\t\t\treturn cover ? cover.getAttribute(\"href\") : \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// var node = packageXml.querySelector(\"item[properties='cover-image']\");\n\t\t\tvar node = qsp(packageXml, \"item\", {\"properties\":\"cover-image\"});\n\t\t\treturn node ? node.getAttribute(\"href\") : \"\";\n\t\t}\n\t}\n\n\t/**\n\t * Get text of a namespaced element\n\t * @private\n\t * @param  {node} xml\n\t * @param  {string} tag\n\t * @return {string} text\n\t */\n\tgetElementText(xml, tag){\n\t\tvar found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag);\n\t\tvar el;\n\n\t\tif(!found || found.length === 0) return \"\";\n\n\t\tel = found[0];\n\n\t\tif(el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn \"\";\n\n\t}\n\n\t/**\n\t * Get text by property\n\t * @private\n\t * @param  {node} xml\n\t * @param  {string} property\n\t * @return {string} text\n\t */\n\tgetPropertyText(xml, property){\n\t\tvar el = qsp(xml, \"meta\", {\"property\":property});\n\n\t\tif(el && el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Load JSON Manifest\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tload(json) {\n\t\tthis.metadata = json.metadata;\n\n\t\tlet spine = json.readingOrder || json.spine;\n\t\tthis.spine = spine.map((item, index) =>{\n\t\t\titem.index = index;\n\t\t\treturn item;\n\t\t});\n\n\t\tjson.resources.forEach((item, index) => {\n\t\t\tthis.manifest[index] = item;\n\n\t\t\tif (item.rel && item.rel[0] === \"cover\") {\n\t\t\t\tthis.coverPath = item.href;\n\t\t\t}\n\t\t});\n\n\t\tthis.spineNodeIndex = 0;\n\n\t\tthis.toc = json.toc.map((item, index) =>{\n\t\t\titem.label = item.title;\n\t\t\treturn item;\n\t\t});\n\n\t\treturn {\n\t\t\t\"metadata\" : this.metadata,\n\t\t\t\"spine\"    : this.spine,\n\t\t\t\"manifest\" : this.manifest,\n\t\t\t\"navPath\"  : this.navPath,\n\t\t\t\"ncxPath\"  : this.ncxPath,\n\t\t\t\"coverPath\": this.coverPath,\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex,\n\t\t\t\"toc\" : this.toc\n\t\t};\n\t}\n\n\tdestroy() {\n\t\tthis.manifest = undefined;\n\t\tthis.navPath = undefined;\n\t\tthis.ncxPath = undefined;\n\t\tthis.coverPath = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.spine = undefined;\n\t\tthis.metadata = undefined;\n\t}\n}\n\nexport default Packaging;\n","import {qs, qsa, querySelectorByType, filterChildren, getParentByTagName} from \"./utils/core\";\n\n/**\n * Navigation Parser\n * @param {document} xml navigation html / xhtml / ncx\n */\nclass Navigation {\n\tconstructor(xml, path, canonical) {\n\t\tthis.toc = [];\n\t\tthis.tocByHref = {};\n\t\tthis.tocById = {};\n\n\t\tthis.landmarks = [];\n\t\tthis.landmarksByType = {};\n\n\t\tthis.canonical = canonical;\n\n\t\tthis.path = path;\n\n\t\tthis.length = 0;\n\t\tif (xml) {\n\t\t\tthis.parse(xml);\n\t\t}\n\t}\n\n\t/**\n\t * Parse out the navigation items\n\t * @param {document} xml navigation html / xhtml / ncx\n\t */\n\tparse(xml) {\n\t\tlet isXml = xml.nodeType;\n\t\tlet html;\n\t\tlet ncx;\n\n\t\tif (isXml) {\n\t\t\thtml = qs(xml, \"html\");\n\t\t\tncx = qs(xml, \"ncx\");\n\t\t}\n\n\t\tif (!isXml) {\n\t\t\tthis.toc = this.load(xml);\n\t\t} else if(html) {\n\t\t\tthis.toc = this.parseNav(xml);\n\t\t\tthis.landmarks = this.parseLandmarks(xml);\n\t\t} else if(ncx){\n\t\t\tthis.toc = this.parseNcx(xml);\n\t\t}\n\n\t\tthis.length = 0;\n\n\t\tthis.unpack(this.toc);\n\t}\n\n\t/**\n\t * Unpack navigation items\n\t * @private\n\t * @param  {array} toc\n\t */\n\tunpack(toc) {\n\t\tvar item;\n\n\t\tfor (var i = 0; i < toc.length; i++) {\n\t\t\titem = toc[i];\n\n\t\t\tif (item.href) {\n\t\t\t\tthis.tocByHref[item.href] = i;\n\t\t\t}\n\n\t\t\tif (item.id) {\n\t\t\t\tthis.tocById[item.id] = i;\n\t\t\t}\n\n\t\t\tthis.length++;\n\n\t\t\tif (item.subitems.length) {\n\t\t\t\tthis.unpack(item.subitems);\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/**\n\t * Get an item from the navigation\n\t * @param  {string} target\n\t * @return {object} navItem\n\t */\n\tget(target) {\n\t\tvar index;\n\n\t\tif(!target) {\n\t\t\treturn this.toc;\n\t\t}\n\n\t\tif(target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.tocById[target.substring(1)];\n\t\t} else if(target in this.tocByHref){\n\t\t\tindex = this.tocByHref[target];\n\t\t}\n\n\t\treturn this.toc[index];\n\t}\n\n\t/**\n\t * Get a landmark by type\n\t * List of types: https://idpf.github.io/epub-vocabs/structure/\n\t * @param  {string} type\n\t * @return {object} landmarkItem\n\t */\n\tlandmark(type) {\n\t\tvar index;\n\n\t\tif(!type) {\n\t\t\treturn this.landmarks;\n\t\t}\n\n\t\tindex = this.landmarksByType[type];\n\n\t\treturn this.landmarks[index];\n\t}\n\n\t/**\n\t * Parse toc from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"toc\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.navItem(navItems[i]);\n\t\t\tif (item) {\n\t\t\t\ttoc[item.id] = item;\n\t\t\t\tif(!item.parent) {\n\t\t\t\t\tlist.push(item);\n\t\t\t\t} else {\n\t\t\t\t\tparent = toc[item.parent];\n\t\t\t\t\tparent.subitems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a navItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} navItem\n\t */\n\tnavItem(item){\n\t\tlet id = item.getAttribute(\"id\") || undefined;\n\t\tlet content = filterChildren(item, \"a\", true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet src = content.getAttribute(\"href\") || \"\";\n\t\t\n\t\tif (!id) {\n\t\t\tid = src;\n\t\t}\n\t\tlet text = content.textContent || \"\";\n\t\tlet html = content.innerHTML;\n\t\tlet subitems = [];\n\t\tlet parentItem = getParentByTagName(item, \"li\");\n\t\tlet parent;\n\n\t\tif (parentItem) {\n\t\t\tparent = parentItem.getAttribute(\"id\");\n\t\t\tif (!parent) {\n\t\t\t\tconst parentContent = filterChildren(parentItem, \"a\", true);\n\t\t\t\tparent = parentContent && parentContent.getAttribute(\"href\");\n      \t\t\t}\n\t\t}\n\n\t\twhile (!parent && parentItem) {\n\t\t\tparentItem = getParentByTagName(parentItem, \"li\");\n\t\t\tif (parentItem) {\n\t\t\t\tparent = parentItem.getAttribute(\"id\");\n\t\t\t\tif (!parent) {\n\t\t\t\t\tconst parentContent = filterChildren(parentItem, \"a\", true);\n          \t\t\t\tparent = parentContent && parentContent.getAttribute(\"href\");\n        \t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar path = this.path.resolve(src);\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"canonical\": this.canonical(path),\n\t\t\t\"label\": text,\n\t\t\t\"html\": html,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t}\n\n\t/**\n\t * Parse landmarks from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} landmarks list\n\t */\n\tparseLandmarks(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"landmarks\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.landmarkItem(navItems[i]);\n\t\t\tif (item) {\n\t\t\t\tlist.push(item);\n\t\t\t\tthis.landmarksByType[item.type] = i;\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a landmarkItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} landmarkItem\n\t */\n\tlandmarkItem(item){\n\t\tlet content = filterChildren(item, \"a\", true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet type = content.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") || undefined;\n\t\tlet href = content.getAttribute(\"href\") || \"\";\n\t\tlet text = content.textContent || \"\";\n\n\t\treturn {\n\t\t\t\"href\": href,\n\t\t\t\"label\": text,\n\t\t\t\"type\" : type\n\t\t};\n\t}\n\n\t/**\n\t * Parse from a Epub > 3.0 NC\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNcx(tocXml){\n\t\tvar navPoints = qsa(tocXml, \"navPoint\");\n\t\tvar length = navPoints.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navPoints || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.ncxItem(navPoints[i]);\n\t\t\ttoc[item.id] = item;\n\t\t\tif(!item.parent) {\n\t\t\t\tlist.push(item);\n\t\t\t} else {\n\t\t\t\tparent = toc[item.parent];\n\t\t\t\tparent.subitems.push(item);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a ncxItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} ncxItem\n\t */\n\tncxItem(item){\n\t\tvar id = item.getAttribute(\"id\") || false,\n\t\t\t\tcontent = qs(item, \"content\"),\n\t\t\t\tsrc = content.getAttribute(\"src\"),\n\t\t\t\tnavLabel = qs(item, \"navLabel\"),\n\t\t\t\ttext = navLabel.textContent ? navLabel.textContent : \"\",\n\t\t\t\tsubitems = [],\n\t\t\t\tparentNode = item.parentNode,\n\t\t\t\tparent;\n\n\t\tif(parentNode && (parentNode.nodeName === \"navPoint\" || parentNode.nodeName.split(':').slice(-1)[0] === \"navPoint\")) {\n\t\t\tparent = parentNode.getAttribute(\"id\");\n\t\t}\n\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t}\n\n\t/**\n\t * Load Spine Items\n\t * @param  {object} json the items to be loaded\n\t * @return {Array} navItems\n\t */\n\tload(json) {\n\t\treturn json.map(item => {\n\t\t\titem.label = item.title;\n\t\t\titem.subitems = item.children ? this.load(item.children) : [];\n\t\t\treturn item;\n\t\t});\n\t}\n\n\t/**\n\t * forEach pass through\n\t * @param  {Function} fn function to run on each item\n\t * @return {method} forEach loop\n\t */\n\tforEach(fn) {\n\t\treturn this.toc.forEach(fn);\n\t}\n}\n\nexport default Navigation;\n","import {substitute} from \"./utils/replacements\";\nimport {createBase64Url, createBlobUrl, blob2base64} from \"./utils/core\";\nimport Url from \"./utils/url\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\nimport path from \"path-webpack\";\n\n/**\n * Handle Package Resources\n * @class\n * @param {Manifest} manifest\n * @param {object} [options]\n * @param {string} [options.replacements=\"base64\"]\n * @param {Archive} [options.archive]\n * @param {method} [options.resolver]\n */\nclass Resources {\n\tconstructor(manifest, options) {\n\t\tthis.settings = {\n\t\t\treplacements: (options && options.replacements) || \"base64\",\n\t\t\tarchive: (options && options.archive),\n\t\t\tresolver: (options && options.resolver),\n\t\t\trequest: (options && options.request)\n\t\t};\n\n\t\tthis.process(manifest);\n\t}\n\n\t/**\n\t * Process resources\n\t * @param {Manifest} manifest\n\t */\n\tprocess(manifest){\n\t\tthis.manifest = manifest;\n\t\tthis.resources = Object.keys(manifest).\n\t\t\tmap(function (key){\n\t\t\t\treturn manifest[key];\n\t\t\t});\n\n\t\tthis.replacementUrls = [];\n\n\t\tthis.html = [];\n\t\tthis.assets = [];\n\t\tthis.css = [];\n\n\t\tthis.urls = [];\n\t\tthis.cssUrls = [];\n\n\t\tthis.split();\n\t\tthis.splitUrls();\n\t}\n\n\t/**\n\t * Split resources by type\n\t * @private\n\t */\n\tsplit(){\n\n\t\t// HTML\n\t\tthis.html = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"application/xhtml+xml\" ||\n\t\t\t\t\t\titem.type === \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Exclude HTML\n\t\tthis.assets = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type !== \"application/xhtml+xml\" &&\n\t\t\t\t\t\titem.type !== \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Only CSS\n\t\tthis.css = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"text/css\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Convert split resources into Urls\n\t * @private\n\t */\n\tsplitUrls(){\n\n\t\t// All Assets Urls\n\t\tthis.urls = this.assets.\n\t\t\tmap(function(item) {\n\t\t\t\treturn item.href;\n\t\t\t}.bind(this));\n\n\t\t// Css Urls\n\t\tthis.cssUrls = this.css.map(function(item) {\n\t\t\treturn item.href;\n\t\t});\n\n\t}\n\n\t/**\n\t * Create a url to a resource\n\t * @param {string} url\n\t * @return {Promise<string>} Promise resolves with url string\n\t */\n\tcreateUrl (url) {\n\t\tvar parsedUrl = new Url(url);\n\t\tvar mimeType = mime.lookup(parsedUrl.filename);\n\n\t\tif (this.settings.archive) {\n\t\t\treturn this.settings.archive.createUrl(url, {\"base64\": (this.settings.replacements === \"base64\")});\n\t\t} else {\n\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\treturn this.settings.request(url, 'blob')\n\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\treturn blob2base64(blob);\n\t\t\t\t\t})\n\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\treturn createBase64Url(blob, mimeType);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn this.settings.request(url, 'blob').then((blob) => {\n\t\t\t\t\treturn createBlobUrl(blob, mimeType);\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Create blob urls for all the assets\n\t * @return {Promise}         returns replacement urls\n\t */\n\treplacements(){\n\t\tif (this.settings.replacements === \"none\") {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve(this.urls);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tvar replacements = this.urls.\n\t\t\tmap( (url) => {\n\t\t\t\tvar absolute = this.settings.resolver(url);\n\n\t\t\t\treturn this.createUrl(absolute).\n\t\t\t\t\tcatch((err) => {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t});\n\n\t\treturn Promise.all(replacements)\n\t\t\t.then( (replacementUrls) => {\n\t\t\t\tthis.replacementUrls = replacementUrls.filter((url) => {\n\t\t\t\t\treturn (typeof(url) === \"string\");\n\t\t\t\t});\n\t\t\t\treturn replacementUrls;\n\t\t\t});\n\t}\n\n\t/**\n\t * Replace URLs in CSS resources\n\t * @private\n\t * @param  {Archive} [archive]\n\t * @param  {method} [resolver]\n\t * @return {Promise}\n\t */\n\treplaceCss(archive, resolver){\n\t\tvar replaced = [];\n\t\tarchive = archive || this.settings.archive;\n\t\tresolver = resolver || this.settings.resolver;\n\t\tthis.cssUrls.forEach(function(href) {\n\t\t\tvar replacement = this.createCssFile(href, archive, resolver)\n\t\t\t\t.then(function (replacementUrl) {\n\t\t\t\t\t// switch the url in the replacementUrls\n\t\t\t\t\tvar indexInUrls = this.urls.indexOf(href);\n\t\t\t\t\tif (indexInUrls > -1) {\n\t\t\t\t\t\tthis.replacementUrls[indexInUrls] = replacementUrl;\n\t\t\t\t\t}\n\t\t\t\t}.bind(this))\n\n\n\t\t\treplaced.push(replacement);\n\t\t}.bind(this));\n\t\treturn Promise.all(replaced);\n\t}\n\n\t/**\n\t * Create a new CSS file with the replaced URLs\n\t * @private\n\t * @param  {string} href the original css file\n\t * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\n\t */\n\tcreateCssFile(href){\n\t\tvar newUrl;\n\n\t\tif (path.isAbsolute(href)) {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tvar absolute = this.settings.resolver(href);\n\n\t\t// Get the text of the css file from the archive\n\t\tvar textResponse;\n\n\t\tif (this.settings.archive) {\n\t\t\ttextResponse = this.settings.archive.getText(absolute);\n\t\t} else {\n\t\t\ttextResponse = this.settings.request(absolute, \"text\");\n\t\t}\n\n\t\t// Get asset links relative to css file\n\t\tvar relUrls = this.urls.map( (assetHref) => {\n\t\t\tvar resolved = this.settings.resolver(assetHref);\n\t\t\tvar relative = new Path(absolute).relative(resolved);\n\n\t\t\treturn relative;\n\t\t});\n\n\t\tif (!textResponse) {\n\t\t\t// file not found, don't replace\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\treturn textResponse.then( (text) => {\n\t\t\t// Replacements in the css text\n\t\t\ttext = substitute(text, relUrls, this.replacementUrls);\n\n\t\t\t// Get the new url\n\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\tnewUrl = createBase64Url(text, \"text/css\");\n\t\t\t} else {\n\t\t\t\tnewUrl = createBlobUrl(text, \"text/css\");\n\t\t\t}\n\n\t\t\treturn newUrl;\n\t\t}, (err) => {\n\t\t\t// handle response errors\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t}\n\n\t/**\n\t * Resolve all resources URLs relative to an absolute URL\n\t * @param  {string} absolute to be resolved to\n\t * @param  {resolver} [resolver]\n\t * @return {string[]} array with relative Urls\n\t */\n\trelativeTo(absolute, resolver){\n\t\tresolver = resolver || this.settings.resolver;\n\n\t\t// Get Urls relative to current sections\n\t\treturn this.urls.\n\t\t\tmap(function(href) {\n\t\t\t\tvar resolved = resolver(href);\n\t\t\t\tvar relative = new Path(absolute).relative(resolved);\n\t\t\t\treturn relative;\n\t\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get a URL for a resource\n\t * @param  {string} path\n\t * @return {string} url\n\t */\n\tget(path) {\n\t\tvar indexInUrls = this.urls.indexOf(path);\n\t\tif (indexInUrls === -1) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.replacementUrls.length) {\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tresolve(this.replacementUrls[indexInUrls]);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\treturn this.createUrl(path);\n\t\t}\n\t}\n\n\t/**\n\t * Substitute urls in content, with replacements,\n\t * relative to a url if provided\n\t * @param  {string} content\n\t * @param  {string} [url]   url to resolve to\n\t * @return {string}         content with urls substituted\n\t */\n\tsubstitute(content, url) {\n\t\tvar relUrls;\n\t\tif (url) {\n\t\t\trelUrls = this.relativeTo(url);\n\t\t} else {\n\t\t\trelUrls = this.urls;\n\t\t}\n\t\treturn substitute(content, relUrls, this.replacementUrls);\n\t}\n\n\tdestroy() {\n\t\tthis.settings = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.resources = undefined;\n\t\tthis.replacementUrls = undefined;\n\t\tthis.html = undefined;\n\t\tthis.assets = undefined;\n\t\tthis.css = undefined;\n\n\t\tthis.urls = undefined;\n\t\tthis.cssUrls = undefined;\n\t}\n}\n\nexport default Resources;\n","import EpubCFI from \"./epubcfi\";\nimport {\n\tqs,\n\tqsa,\n\tquerySelectorByType,\n\tindexOfSorted,\n\tlocationOf\n} from \"./utils/core\";\n\n/**\n * Page List Parser\n * @param {document} [xml]\n */\nclass PageList {\n\tconstructor(xml, path, canonical) {\n\t\tthis.pages = [];\n\t\tthis.locations = [];\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.firstPage = 0;\n\t\tthis.lastPage = 0;\n\t\tthis.totalPages = 0;\n\n\t\tthis.pagesByAbsolutePath = {};\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\n\t\tthis.path = path;\n\t\tthis.canonical = canonical;\n\n\t\tif (xml) {\n\t\t\tthis.pageList = this.parse(xml);\n\t\t}\n\n\t\tif(this.pageList && this.pageList.length) {\n\t\t\tthis.process(this.pageList);\n\t\t}\n\t}\n\n\t/**\n\t * Parse PageList Xml\n\t * @param  {document} xml\n\t */\n\tparse(xml) {\n\t\tvar html = qs(xml, \"html\");\n\t\tvar ncx = qs(xml, \"ncx\");\n\n\t\tif(html) {\n\t\t\treturn this.parseNav(xml);\n\t\t} else if(ncx){ // Not supported\n\t\t\t// return this.parseNcx(xml);\n\t\t\treturn;\n\t\t}\n\n\t}\n\n\t/**\n\t * Parse a Nav PageList\n\t * @private\n\t * @param  {node} navHtml\n\t * @return {PageList.item[]} list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"page-list\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.item(navItems[i], i);\n\t\t\tlist.push(item);\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Page List Item\n\t * @private\n\t * @param  {node} item\n\t * @return {object} pageListItem\n\t */\n\titem(item, i){\n\t\tvar content = qs(item, \"a\"),\n\t\t\t\thref = content.getAttribute(\"href\") || \"\",\n\t\t\t\ttext = content.textContent || \"\",\n\t\t\t\tpageLabel = text,\n\t\t\t\tpage = i + 1, \n\t\t\t\tisCfi = href.indexOf(\"epubcfi\"),\n\t\t\t\tsplit,\n\t\t\t\tpackageUrl,\n\t\t\t\tcfi;\n\n\t\tif(isCfi != -1) {\n\t\t\tsplit = href.split(\"#\");\n\t\t\tpackageUrl = split[0];\n\t\t\tcfi = split.length > 1 ? split[1] : false;\n\t\t\treturn {\n\t\t\t\t\"cfi\" : cfi,\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"packageUrl\" : packageUrl,\n\t\t\t\t\"page\" : page,\n\t\t\t\t\"pageLabel\": pageLabel\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"page\" : page,\n\t\t\t\t\"pageLabel\": pageLabel\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Process pageList items\n\t * @private\n\t * @param  {array} pageList\n\t */\n\tprocess(pageList){\n\t\tpageList.forEach(function(item){\n\t\t\tthis.pages.push(item.page);\n\t\t\tif (item.cfi) {\n\t\t\t\tthis.locations.push(item.cfi);\n\t\t\t}\n\t\t\tif ( item.href ) {\n\t\t\t\tvar href = (item.href.split('#'))[0];\n\t\t\t\tvar path = this.path.resolve(href);\n\t\t\t\tvar absolute = this.canonical(path);\n\t\t\t\tif ( this.pagesByAbsolutePath[absolute] == null ) {\n\t\t\t\t\tthis.pagesByAbsolutePath[absolute] = [];\n\t\t\t\t}\n\t\t\t\tthis.pagesByAbsolutePath[absolute].push(item.page);\n\t\t\t}\n\t\t}, this);\n\t\tthis.firstPage = parseInt(this.pages[0]);\n\t\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\n\t\tthis.totalPages = this.lastPage - this.firstPage;\n\t\tthis.firstPageLabel = this.pageList[0].pageLabel;\n\t\tthis.lastPageLabel = this.pageList[this.pageList.length - 1].pageLabel;\n\t}\n\n\t/**\n\t * Get a PageList result from a EpubCFI\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} page\n\t */\n\tpageFromCfi(cfi){\n\t\tvar pg = -1;\n\n\t\t// Check if the pageList has not been set yet\n\t\tif(this.locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// TODO: check if CFI is valid?\n\n\t\t// check if the cfi is in the location list\n\t\t// var index = this.locations.indexOf(cfi);\n\t\tvar index = indexOfSorted(cfi, this.locations, this.epubcfi.compare);\n\t\tif(index != -1) {\n\t\t\tpg = this.pages[index];\n\t\t} else {\n\t\t\t// Otherwise add it to the list of locations\n\t\t\t// Insert it in the correct position in the locations page\n\t\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\n\t\t\tindex = locationOf(cfi, this.locations, this.epubcfi.compare);\n\t\t\t// Get the page at the location just before the new one, or return the first\n\t\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\n\t\t\tif(pg !== undefined) {\n\t\t\t\t// Add the new page in so that the locations and page array match up\n\t\t\t\t//this.pages.splice(index, 0, pg);\n\t\t\t} else {\n\t\t\t\tpg = -1;\n\t\t\t}\n\n\t\t}\n\t\treturn pg;\n\t}\n\n\tpagesFromLocation(location) {\n\t\tvar pgs = [];\n\n\t\t// Check if the pageList has not been set yet\n\t\tif(this.locations.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tvar pg = this.pageFromCfi(location.start.cfi);\n\t\tif ( pg == -1 || pg >= this.locations.length ) {\n\t\t\treturn [];\n\t\t}\n\n\t\tpgs.push(pg);\n\t\tpg = this.pageFromCfi(location.end.cfi);\n\t\tif ( pg != pgs[0] ) {\n\t\t\tpgs.push(pg);\n\t\t}\n\n\t\treturn pgs;\n\t}\n\n\tpageLabel(page) {\n\t\tvar item = this.pageList[page];\n\t\tif ( item ) {\n\t\t\treturn item.pageLabel || `#${page}`;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Page List Item\n\t * @param  {string | number} pg\n\t * @return {string} cfi\n\t */\n\tcfiFromPage(pg){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof pg != \"number\"){\n\t\t\tpg = parseInt(pg);\n\t\t}\n\n\t\t// check if the cfi is in the page list\n\t\t// Pages could be unsorted.\n\t\tvar index = this.pages.indexOf(pg);\n\t\tif(index != -1) {\n\t\t\tcfi = this.locations[index];\n\t\t}\n\t\t// TODO: handle pages not in the list\n\t\treturn cfi;\n\t}\n\n\tcfiFromPageLabel(pageLabel) {\n\t\tvar item = this.pageList.find(item => item.pageLabel == pageLabel);\n\t\tif ( item ) {\n\t\t\treturn this.cfiFromPage(item.page);\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t * Get a Page from Book percentage\n\t * @param  {number} percent\n\t * @return {number} page\n\t */\n\tpageFromPercentage(percent){\n\t\tvar pg = Math.round(this.totalPages * percent);\n\t\treturn pg;\n\t}\n\n\titemFromPercentage(percent) {\n\t\tvar pg = this.pageFromPercentage(percent);\n\t\treturn this.pageList[pg - 1];\n\t}\n\n\titemFromCfi(cfi) {\n\t\tvar pg = this.pageFromCfi(cfi);\n\t\treturn this.pageList[pg - 1];\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a page\n\t * @param  {number} pg the page\n\t * @return {number} percentage\n\t */\n\tpercentageFromPage(pg){\n\t\tvar percentage = (pg - this.firstPage) / this.totalPages;\n\t\treturn Math.round(percentage * 1000) / 1000;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a cfi\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} percentage\n\t */\n\tpercentageFromCfi(cfi){\n\t\tvar pg = this.pageFromCfi(cfi);\n\t\tvar percentage = this.percentageFromPage(pg);\n\t\treturn percentage;\n\t}\n\n\t/**\n\t * Destroy\n\t */\n\tdestroy() {\n\t\tthis.pages = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.pageList = undefined;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\t}\n}\n\nexport default PageList;\n","import { extend } from \"./utils/core\";\nimport { EVENTS } from \"./utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Figures out the CSS values to apply for a layout\n * @class\n * @param {object} settings\n * @param {string} [settings.layout='reflowable']\n * @param {string} [settings.spread]\n * @param {number} [settings.minSpreadWidth=800]\n * @param {boolean} [settings.evenSpreads=false]\n */\nclass Layout {\n\tconstructor(settings) {\n\t\tthis.settings = settings;\n\t\tthis.name = settings.layout || \"reflowable\";\n\t\tthis._spread = (settings.spread === \"none\") ? false : true;\n\t\tthis._minSpreadWidth = settings.minSpreadWidth || 800;\n\t\tthis._evenSpreads = settings.evenSpreads || false;\n\n\t\tif (settings.flow === \"scrolled\" ||\n\t\t\t\tsettings.flow === \"scrolled-continuous\" ||\n\t\t\t\tsettings.flow === \"scrolled-doc\") {\n\t\t\tthis._flow = \"scrolled\";\n\t\t} else {\n\t\t\tthis._flow = \"paginated\";\n\t\t}\n\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.spreadWidth = 0;\n\t\tthis.delta = 0;\n\n\t\tthis.columnWidth = 0;\n\t\tthis.gap = 0;\n\t\tthis.divisor = 1;\n\n\t\tthis.props = {\n\t\t\tname: this.name,\n\t\t\tspread: this._spread,\n\t\t\tflow: this._flow,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tspreadWidth: 0,\n\t\t\tdelta: 0,\n\t\t\tcolumnWidth: 0,\n\t\t\tgap: 0,\n\t\t\tdivisor: 1\n\t\t};\n\n\t}\n\n\t/**\n\t * Switch the flow between paginated and scrolled\n\t * @param  {string} flow paginated | scrolled\n\t * @return {string} simplified flow\n\t */\n\tflow(flow) {\n\t\tif (typeof(flow) != \"undefined\") {\n\t\t\tif (flow === \"scrolled\" ||\n\t\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\t\tflow === \"scrolled-doc\") {\n\t\t\t\tthis._flow = \"scrolled\";\n\t\t\t} else {\n\t\t\t\tthis._flow = \"paginated\";\n\t\t\t}\n\t\t\t// this.props.flow = this._flow;\n\t\t\tthis.update({flow: this._flow});\n\t\t}\n\t\treturn this._flow;\n\t}\n\n\t/**\n\t * Switch between using spreads or not, and set the\n\t * width at which they switch to single.\n\t * @param  {string} spread \"none\" | \"always\" | \"auto\"\n\t * @param  {number} min integer in pixels\n\t * @return {boolean} spread true | false\n\t */\n\tspread(spread, min) {\n\n\t\tif (spread) {\n\t\t\tthis._spread = (spread === \"none\") ? false : true;\n\t\t\t// this.props.spread = this._spread;\n\t\t\tthis.update({spread: this._spread});\n\t\t}\n\n\t\tif (min >= 0) {\n\t\t\tthis._minSpreadWidth = min;\n\t\t}\n\n\t\treturn this._spread;\n\t}\n\n\t/**\n\t * Calculate the dimensions of the pagination\n\t * @param  {number} _width  width of the rendering\n\t * @param  {number} _height height of the rendering\n\t * @param  {number} _gap    width of the gap between columns\n\t */\n\tcalculate(_width, _height, _gap){\n\n\t\tvar divisor = 1;\n\t\tvar gap = _gap || 0;\n\n\t\t//-- Check the width and create even width columns\n\t\t// var fullWidth = Math.floor(_width);\n\t\tvar width = _width;\n\t\tvar height = _height;\n\n\t\tvar section = Math.floor(width / 12);\n\n\t\tvar columnWidth;\n\t\tvar spreadWidth;\n\t\tvar pageWidth;\n\t\tvar delta;\n\n\t\tif (this._spread && width >= this._minSpreadWidth) {\n\t\t\tdivisor = 2;\n\t\t} else {\n\t\t\tdivisor = 1;\n\t\t}\n\n\t\tif (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\n\t\t\tgap = ((section % 2 === 0) ? section : section - 1);\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" ) {\n\t\t\tgap = 0;\n\t\t}\n\n\t\t//-- Double Page\n\t\tif(divisor > 1) {\n\t\t\t// width = width - gap;\n\t\t\t// columnWidth = (width - gap) / divisor;\n\t\t\t// gap = gap / divisor;\n\t\t\tcolumnWidth = (width / divisor) - gap;\n\t\t\tpageWidth = columnWidth + gap;\n\t\t} else {\n\t\t\tcolumnWidth = width;\n\t\t\tpageWidth = width;\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" && divisor > 1) {\n\t\t\twidth = columnWidth;\n\t\t}\n\n\t\tspreadWidth = (columnWidth * divisor) + gap;\n\n\t\tdelta = Math.ceil(width);\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.spreadWidth = spreadWidth;\n\t\tthis.pageWidth = pageWidth;\n\t\tthis.delta = delta;\n\n\t\tthis.columnWidth = columnWidth;\n\t\tthis.gap = gap;\n\t\tthis.divisor = divisor;\n\n\t\t// this.props.width = width;\n\t\t// this.props.height = _height;\n\t\t// this.props.spreadWidth = spreadWidth;\n\t\t// this.props.pageWidth = pageWidth;\n\t\t// this.props.delta = delta;\n\t\t//\n\t\t// this.props.columnWidth = colWidth;\n\t\t// this.props.gap = gap;\n\t\t// this.props.divisor = divisor;\n\n\t\tthis.update({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tspreadWidth,\n\t\t\tpageWidth,\n\t\t\tdelta,\n\t\t\tcolumnWidth,\n\t\t\tgap,\n\t\t\tdivisor\n\t\t});\n\n\t}\n\n\t/**\n\t * Apply Css to a Document\n\t * @param  {Contents} contents\n\t * @return {Promise}\n\t */\n\tformat(contents){\n\t\tvar formating;\n\n\t\tvar viewport = contents.viewport();\n\t\t// console.log(\"AHOY contents.format VIEWPORT\", this.name, viewport.height);\n\t\tif (this.name === \"pre-paginated\" && viewport.height != 'auto' && viewport.height != undefined ) {\n\t\t\t// console.log(\"AHOY CONTENTS format\", this.columnWidth, this.height);\n\t\t\tformating = contents.fit(this.columnWidth, this.height);\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tformating = contents.columns(this.width, this.height, this.columnWidth, this.gap);\n\t\t} else { // scrolled\n\t\t\tformating = contents.size(this.width, null);\n\t\t\tif ( this.name === 'pre-paginated' ) {\n\t\t\t\tcontents.content.style.overflow = 'auto';\n\t\t\t\tcontents.addStylesheetRules({\n\t\t\t\t\t\"body\": {\n\t\t\t\t\t\t\"margin\": 0,\n\t\t\t\t\t\t\"padding\": \"1em !important\",\n\t\t\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn formating; // might be a promise in some View Managers\n\t}\n\n\t/**\n\t * Count number of pages\n\t * @param  {number} totalLength\n\t * @param  {number} pageLength\n\t * @return {{spreads: Number, pages: Number}}\n\t */\n\tcount(totalLength, pageLength) {\n\n\t\tlet spreads, pages;\n\n\t\tif (this.name === \"pre-paginated\") {\n\t\t\tspreads = 1;\n\t\t\tpages = 1;\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tpageLength = pageLength || this.delta;\n\t\t\tspreads = Math.ceil( totalLength / pageLength);\n\t\t\tpages = spreads * this.divisor;\n\t\t} else { // scrolled\n\t\t\tpageLength = pageLength || this.height;\n\t\t\tspreads = Math.ceil( totalLength / pageLength);\n\t\t\tpages = spreads;\n\t\t}\n\n\t\treturn {\n\t\t\tspreads,\n\t\t\tpages\n\t\t};\n\n\t}\n\n\t/**\n\t * Update props that have changed\n\t * @private\n\t * @param  {object} props\n\t */\n\tupdate(props) {\n\t\t// Remove props that haven't changed\n\t\tObject.keys(props).forEach((propName) => {\n\t\t\tif (this.props[propName] === props[propName]) {\n\t\t\t\tdelete props[propName];\n\t\t\t}\n\t\t});\n\n\t\tif(Object.keys(props).length > 0) {\n\t\t\tlet newProps = extend(this.props, props);\n\t\t\tthis.emit(EVENTS.LAYOUT.UPDATED, newProps, props);\n\t\t}\n\t}\n}\n\nEventEmitter(Layout.prototype);\n\nexport default Layout;\n","import Url from \"./utils/url\";\n\n/**\n * Themes to apply to displayed content\n * @class\n * @param {Rendition} rendition\n */\nclass Themes {\n\tconstructor(rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis._themes = {\n\t\t\t\"default\" : {\n\t\t\t\t\"rules\" : {},\n\t\t\t\t\"url\" : \"\",\n\t\t\t\t\"serialized\" : \"\"\n\t\t\t}\n\t\t};\n\t\tthis._overrides = {};\n\t\tthis._current = \"default\";\n\t\tthis._injected = [];\n\t\tthis.rendition.hooks.content.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.content.register(this.overrides.bind(this));\n\n\t}\n\n\t/**\n\t * Add themes to be used by a rendition\n\t * @param {object | Array<object> | string}\n\t * @example themes.register(\"light\", \"http://example.com/light.css\")\n\t * @example themes.register(\"light\", { \"body\": { \"color\": \"purple\"}})\n\t * @example themes.register({ \"light\" : {...}, \"dark\" : {...}})\n\t */\n\tregister () {\n\t\tif (arguments.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"object\") {\n\t\t\treturn this.registerThemes(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"string\") {\n\t\t\treturn this.default(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"string\") {\n\t\t\treturn this.registerUrl(arguments[0], arguments[1]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"object\") {\n\t\t\treturn this.registerRules(arguments[0], arguments[1]);\n\t\t}\n\t}\n\n\t/**\n\t * Add a default theme to be used by a rendition\n\t * @param {object | string} theme\n\t * @example themes.register(\"http://example.com/default.css\")\n\t * @example themes.register({ \"body\": { \"color\": \"purple\"}})\n\t */\n\tdefault (theme) {\n\t\tif (!theme) {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof(theme) === \"string\") {\n\t\t\treturn this.registerUrl(\"default\", theme);\n\t\t}\n\t\tif (typeof(theme) === \"object\") {\n\t\t\treturn this.registerRules(\"default\", theme);\n\t\t}\n\t}\n\n\t/**\n\t * Register themes object\n\t * @param {object} themes\n\t */\n\tregisterThemes (themes) {\n\t\tfor (var theme in themes) {\n\t\t\tif (themes.hasOwnProperty(theme)) {\n\t\t\t\tif (typeof(themes[theme]) === \"string\") {\n\t\t\t\t\tthis.registerUrl(theme, themes[theme]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.registerRules(theme, themes[theme]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Register a url\n\t * @param {string} name\n\t * @param {string} input\n\t */\n\tregisterUrl (name, input) {\n\t\tvar url = new Url(input);\n\t\tthis._themes[name] = { \"url\": url.toString() };\n\t\tif (this._injected[name]) {\n\t\t\tthis.update(name);\n\t\t}\n\t}\n\n\t/**\n\t * Register rule\n\t * @param {string} name\n\t * @param {object} rules\n\t */\n\tregisterRules (name, rules) {\n\t\tthis._themes[name] = { \"rules\": rules };\n\t\t// TODO: serialize css rules\n\t\tif (this._injected[name]) {\n\t\t\tthis.update(name);\n\t\t}\n\t}\n\n\t/**\n\t * Select a theme\n\t * @param {string} name\n\t */\n\tselect (name) {\n\t\tvar prev = this._current;\n\t\tvar contents;\n\n\t\tthis._current = name;\n\t\tthis.update(name);\n\n\t\tcontents = this.rendition.getContents();\n\t\tcontents.forEach( (content) => {\n\t\t\tcontent.removeClass(prev);\n\t\t\tcontent.addClass(name);\n\t\t});\n\t}\n\n\t/**\n\t * Update a theme\n\t * @param {string} name\n\t */\n\tupdate (name) {\n\t\tvar contents = this.rendition.getContents();\n\t\tcontents.forEach( (content) => {\n\t\t\tthis.add(name, content);\n\t\t});\n\t}\n\n\t/**\n\t * Inject all themes into contents\n\t * @param {Contents} contents\n\t */\n\tinject (contents) {\n\t\tvar links = [];\n\t\tvar themes = this._themes;\n\t\tvar theme;\n\n\t\tfor (var name in themes) {\n\t\t\tif (themes.hasOwnProperty(name) && (name === this._current || name === \"default\")) {\n\t\t\t\ttheme = themes[name];\n\t\t\t\tif((theme.rules && Object.keys(theme.rules).length > 0) || (theme.url && links.indexOf(theme.url) === -1)) {\n\t\t\t\t\tthis.add(name, contents);\n\t\t\t\t}\n\t\t\t\tthis._injected.push(name);\n\t\t\t}\n\t\t}\n\n\t\tif(this._current != \"default\") {\n\t\t\tcontents.addClass(this._current);\n\t\t}\n\t}\n\n\t/**\n\t * Add Theme to contents\n\t * @param {string} name\n\t * @param {Contents} contents\n\t */\n\tadd (name, contents) {\n\t\tvar theme = this._themes[name];\n\n\t\tif (!theme || !contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (theme.url) {\n\t\t\tcontents.addStylesheet(theme.url);\n\t\t} else if (theme.serialized) {\n\t\t\t// TODO: handle serialized\n\t\t} else if (theme.rules) {\n\t\t\tcontents.addStylesheetRules(theme.rules);\n\t\t\ttheme.injected = true;\n\t\t}\n\t}\n\n\t/**\n\t * Add override\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {boolean} priority\n\t */\n\toverride (name, value, priority) {\n\t\tvar contents = this.rendition.getContents();\n\n\t\tthis._overrides[name] = {\n\t\t\tvalue: value,\n\t\t\tpriority: priority === true\n\t\t};\n\n\t\tcontents.forEach( (content) => {\n\t\t\tcontent.css(name, this._overrides[name].value, this._overrides[name].priority);\n\t\t});\n\t}\n\n\t/**\n\t * Add all overrides\n\t * @param {Content} content\n\t */\n\toverrides (contents) {\n\t\tvar overrides = this._overrides;\n\n\t\tfor (var rule in overrides) {\n\t\t\tif (overrides.hasOwnProperty(rule)) {\n\t\t\t\tcontents.css(rule, overrides[rule].value, overrides[rule].priority);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the font size of a rendition\n\t * @param {number} size\n\t */\n\tfontSize (size) {\n\t\tthis.override(\"font-size\", size);\n\t}\n\n\t/**\n\t * Adjust the font-family of a rendition\n\t * @param {string} f\n\t */\n\tfont (f) {\n\t\tthis.override(\"font-family\", f, true);\n\t}\n\n\tdestroy() {\n\t\tthis.rendition = undefined;\n\t\tthis._themes = undefined;\n\t\tthis._overrides = undefined;\n\t\tthis._current = undefined;\n\t\tthis._injected = undefined;\n\t}\n\n}\n\nexport default Themes;\n","import EpubCFI from \"./epubcfi\";\nimport { nodeBounds } from \"./utils/core\";\n\n/**\n * Map text locations to CFI ranges\n * @class\n * @param {Layout} layout Layout to apply\n * @param {string} [direction=\"ltr\"] Text direction\n * @param {string} [axis=\"horizontal\"] vertical or horizontal axis\n * @param {boolean} [dev] toggle developer highlighting\n */\nclass Mapping {\n\tconstructor(layout, direction, axis, dev) {\n\t\tthis.layout = layout;\n\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\n\t\tthis.direction = direction || \"ltr\";\n\t\tthis._dev = dev;\n\t}\n\n\t/**\n\t * Find CFI pairs for entire section at once\n\t */\n\tsection(view) {\n\t\tvar ranges = this.findRanges(view);\n\t\tvar map = this.rangeListToCfiList(view.section.cfiBase, ranges);\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Find CFI pairs for a page\n\t * @param {Contents} contents Contents from view\n\t * @param {string} cfiBase string of the base for a cfi\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t */\n\tpage(contents, cfiBase, start, end) {\n\t\tvar root = contents && contents.document ? contents.document.body : false;\n\t\tvar result;\n\n\t\tif (!root) {\n\t\t\treturn;\n\t\t}\n\n\t\tresult = this.rangePairToCfiPair(cfiBase, {\n\t\t\tstart: this.findStart(root, start, end),\n\t\t\tend: this.findEnd(root, start, end)\n\t\t});\n\n\t\tif (this._dev === true) {\n\t\t\tlet doc = contents.document;\n\t\t\tlet startRange = new EpubCFI(result.start).toRange(doc);\n\t\t\tlet endRange = new EpubCFI(result.end).toRange(doc);\n\n\t\t\tlet selection = doc.defaultView.getSelection();\n\t\t\tlet r = doc.createRange();\n\t\t\tselection.removeAllRanges();\n\t\t\tr.setStart(startRange.startContainer, startRange.startOffset);\n\t\t\tr.setEnd(endRange.endContainer, endRange.endOffset);\n\t\t\tselection.addRange(r);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Walk a node, preforming a function on each node it finds\n\t * @private\n\t * @param {Node} root Node to walkToNode\n\t * @param {function} func walk function\n\t * @return {*} returns the result of the walk function\n\t */\n\twalk(root, func) {\n\t\t// IE11 has strange issue, if root is text node IE throws exception on\n\t\t// calling treeWalker.nextNode(), saying\n\t\t// Unexpected call to method or property access instead of returing null value\n\t\tif(root && root.nodeType === Node.TEXT_NODE) {\n\t\t\treturn;\n\t\t}\n\t\t// safeFilter is required so that it can work in IE as filter is a function for IE\n\t\t// and for other browser filter is an object.\n\t\tvar filter = {\n\t\t\tacceptNode: function(node) {\n\t\t\t\tif (node.data.trim().length > 0) {\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\n\t\t\t\t} else {\n\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tvar safeFilter = filter.acceptNode;\n\t\tsafeFilter.acceptNode = filter.acceptNode;\n\n\t\tvar treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, safeFilter, false);\n\t\tvar node;\n\t\tvar result;\n\t\twhile ((node = treeWalker.nextNode())) {\n\t\t\tresult = func(node);\n\t\t\tif(result) break;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfindRanges(view){\n\t\tvar columns = [];\n\t\tvar scrollWidth = view.contents.scrollWidth();\n\t\tvar spreads = Math.ceil( scrollWidth / this.layout.spreadWidth);\n\t\tvar count = spreads * this.layout.divisor;\n\t\tvar columnWidth = this.layout.columnWidth;\n\t\tvar gap = this.layout.gap;\n\t\tvar start, end;\n\n\t\tfor (var i = 0; i < count.pages; i++) {\n\t\t\tstart = (columnWidth + gap) * i;\n\t\t\tend = (columnWidth * (i+1)) + (gap * i);\n\t\t\tcolumns.push({\n\t\t\t\tstart: this.findStart(view.document.body, start, end),\n\t\t\t\tend: this.findEnd(view.document.body, start, end)\n\t\t\t});\n\t\t}\n\n\t\treturn columns;\n\t}\n\n\t/**\n\t * Find Start Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindStart(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar found;\n\t\tvar $prev = root;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, (node) => {\n\t\t\t\tvar left, right, top, bottom;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\n\t\t\t\telPos = nodeBounds(node);\n\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\t\tleft = this.horizontal ? elPos.left : elPos.top;\n\t\t\t\t\tright = this.horizontal ? elPos.right : elPos.bottom;\n\n\t\t\t\t\tif( left >= start && left <= end ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (right > start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\t\tleft = elPos.left;\n\t\t\t\t\tright = elPos.right;\n\n\t\t\t\t\tif( right <= end && right >= start ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (left < end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttop = elPos.top;\n\t\t\t\t\tbottom = elPos.bottom;\n\n\t\t\t\t\tif( top >= start && top <= end ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (bottom > start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\n\t\t\t});\n\n\t\t\tif(found) {\n\t\t\t\treturn this.findTextStartRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// Return last element\n\t\treturn this.findTextStartRange($prev, start, end);\n\t}\n\n\t/**\n\t * Find End Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindEnd(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar $prev = root;\n\t\tvar found;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, (node) => {\n\n\t\t\t\tvar left, right, top, bottom;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\t\t\t\telPos = nodeBounds(node);\n\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\t\tleft = Math.round(elPos.left);\n\t\t\t\t\tright = Math.round(elPos.right);\n\n\t\t\t\t\tif(left > end && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(right > end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\t\tleft = Math.round(this.horizontal ? elPos.left : elPos.top);\n\t\t\t\t\tright = Math.round(this.horizontal ? elPos.right : elPos.bottom);\n\n\t\t\t\t\tif(right < start && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(left < start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttop = Math.round(elPos.top);\n\t\t\t\t\tbottom = Math.round(elPos.bottom);\n\n\t\t\t\t\tif(top > end && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(bottom > end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t});\n\n\n\t\t\tif(found){\n\t\t\t\treturn this.findTextEndRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// end of chapter\n\t\treturn this.findTextEndRange($prev, start, end);\n\t}\n\n\t/**\n\t * Find Text Start Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindTextStartRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar range;\n\t\tvar pos;\n\t\tvar left, top, right;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\tleft = pos.left;\n\t\t\t\tif( left >= start ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\tright = pos.right;\n\t\t\t\tif( right <= end ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\ttop = pos.top;\n\t\t\t\tif( top >= start ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// prev = range;\n\n\t\t}\n\n\t\treturn ranges[0];\n\t}\n\n\t/**\n\t * Find Text End Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindTextEndRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar prev;\n\t\tvar range;\n\t\tvar pos;\n\t\tvar left, right, top, bottom;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\tleft = pos.left;\n\t\t\t\tright = pos.right;\n\n\t\t\t\tif(left > end && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(right > end) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\tleft = pos.left\n\t\t\t\tright = pos.right;\n\n\t\t\t\tif(right < start && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(left < start) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\ttop = pos.top;\n\t\t\t\tbottom = pos.bottom;\n\n\t\t\t\tif(top > end && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(bottom > end) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t}\n\n\n\t\t\tprev = range;\n\n\t\t}\n\n\t\t// Ends before limit\n\t\treturn ranges[ranges.length-1];\n\n\t}\n\n\t/**\n\t * Split up a text node into ranges for each word\n\t * @private\n\t * @param {Node} root root node\n\t * @param {string} [_splitter] what to split on\n\t * @return {Range[]}\n\t */\n\tsplitTextNodeIntoRanges(node, _splitter){\n\t\tvar ranges = [];\n\t\tvar textContent = node.textContent || \"\";\n\t\tvar text = textContent.trim();\n\t\tvar range;\n\t\tvar doc = node.ownerDocument;\n\t\tvar splitter = _splitter || \" \";\n\n\t\tvar pos = text.indexOf(splitter);\n\n\t\tif(pos === -1 || node.nodeType != Node.TEXT_NODE) {\n\t\t\trange = doc.createRange();\n\t\t\trange.selectNodeContents(node);\n\t\t\treturn [range];\n\t\t}\n\n\t\trange = doc.createRange();\n\t\trange.setStart(node, 0);\n\t\trange.setEnd(node, pos);\n\t\tranges.push(range);\n\t\trange = false;\n\n\t\twhile ( pos != -1 ) {\n\n\t\t\tpos = text.indexOf(splitter, pos + 1);\n\t\t\tif(pos > 0) {\n\n\t\t\t\tif(range) {\n\t\t\t\t\trange.setEnd(node, pos);\n\t\t\t\t\tranges.push(range);\n\t\t\t\t}\n\n\t\t\t\trange = doc.createRange();\n\t\t\t\trange.setStart(node, pos+1);\n\t\t\t}\n\t\t}\n\n\t\tif(range) {\n\t\t\trange.setEnd(node, text.length);\n\t\t\tranges.push(range);\n\t\t}\n\n\t\treturn ranges;\n\t}\n\n\n\t/**\n\t * Turn a pair of ranges into a pair of CFIs\n\t * @private\n\t * @param {string} cfiBase base string for an EpubCFI\n\t * @param {object} rangePair { start: Range, end: Range }\n\t * @return {object} { start: \"epubcfi(...)\", end: \"epubcfi(...)\" }\n\t */\n\trangePairToCfiPair(cfiBase, rangePair){\n\n\t\tvar startRange = rangePair.start;\n\t\tvar endRange = rangePair.end;\n\n\t\tstartRange.collapse(true);\n\t\tendRange.collapse(false);\n\n\t\tlet startCfi = new EpubCFI(startRange, cfiBase).toString();\n\t\tlet endCfi = new EpubCFI(endRange, cfiBase).toString();\n\n\t\treturn {\n\t\t\tstart: startCfi,\n\t\t\tend: endCfi\n\t\t};\n\n\t}\n\n\trangeListToCfiList(cfiBase, columns){\n\t\tvar map = [];\n\t\tvar cifPair;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tcifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\n\n\t\t\tmap.push(cifPair);\n\n\t\t}\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Set the axis for mapping\n\t * @param {string} axis horizontal | vertical\n\t * @return {boolean} is it horizontal?\n\t */\n\taxis(axis) {\n\t\tif (axis) {\n\t\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\n\t\t}\n\t\treturn this.horizontal;\n\t}\n}\n\nexport default Mapping;\n","import EventEmitter from \"event-emitter\";\nimport {isNumber, prefixed, borders, defaults} from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport {replaceLinks} from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\nconst hasNavigator = typeof (navigator) !== \"undefined\";\n\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nclass Contents {\n\tconstructor(doc, content, cfiBase, sectionIndex) {\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.document = doc;\n\t\tthis.documentElement =  this.document.documentElement;\n\t\tthis.content = content || this.document.body;\n\t\tthis.window = this.document.defaultView;\n\n\t\tthis._size = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\tthis.sectionIndex = sectionIndex || 0;\n\t\tthis.cfiBase = cfiBase || \"\";\n\n\t\tthis.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n\n\t\tthis.setViewport();\n\t\tthis.listeners();\n\t}\n\n\t/**\n\t\t* Get DOM events that are listened for and passed along\n\t\t*/\n\tstatic get listenedEvents() {\n\t\treturn DOM_EVENTS;\n\t}\n\n\t/**\n\t\t* Get or Set width\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\twidth(w) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tframe.style.width = w;\n\t\t\t// this.content.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)[\"width\"];\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\theight(h) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tframe.style.height = h;\n\t\t\t// this.content.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)[\"height\"];\n\n\t}\n\n\t/**\n\t\t* Get or Set width of the contents\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\tcontentWidth(w) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tcontent.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[\"width\"];\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height of the contents\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\tcontentHeight(h) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tcontent.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[\"height\"];\n\n\t}\n\n\t/**\n\t\t* Get the width of the text using Range\n\t\t* @returns {number} width\n\t\t*/\n\ttextWidth() {\n\t\tvar viewport = this.$viewport;\n\t\tif ( false && viewport && viewport.width && viewport.width != 'auto' ) {\n\t\t\treturn Math.round(parseFloat(viewport.width, 10));\n\t\t}\n\n\t\tlet rect;\n\t\tlet width;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\t// Select the contents of frame\n\t\trange.selectNodeContents(content);\n\n\t\t// get the width of the text content\n\t\trect = range.getBoundingClientRect();\n\t\twidth = rect.width;\n\n\t\tif (border && border.width) {\n\t\t\twidth += border.width;\n\t\t}\n\n\t\treturn Math.round(width);\n\t}\n\n\t/**\n\t\t* Get the height of the text using Range\n\t\t* @returns {number} height\n\t\t*/\n\ttextHeight() {\n\t\tvar viewport = this.$viewport;\n\t\tif ( false && viewport && viewport.height && viewport.height != 'auto' ) {\n\t\t\treturn Math.round(parseFloat(viewport.height, 10));\n\t\t}\n\n\t\tlet rect;\n\t\tlet height;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\trange.selectNodeContents(content);\n\n\t\trect = range.getBoundingClientRect();\n\t\theight = rect.height;\n\n\t\tif (height && border.height) {\n\t\t\theight += border.height;\n\t\t}\n\n\t\tif (height && rect.top) {\n\t\t\theight += rect.top;\n\t\t}\n\n\t\treturn Math.round(height);\n\t}\n\n\t/**\n\t\t* Get documentElement scrollWidth\n\t\t* @returns {number} width\n\t\t*/\n\tscrollWidth() {\n\t\tvar width = this.documentElement.scrollWidth;\n\n\t\treturn width;\n\t}\n\n\t/**\n\t\t* Get documentElement scrollHeight\n\t\t* @returns {number} height\n\t\t*/\n\tscrollHeight() {\n\t\tvar height = this.documentElement.scrollHeight;\n\n\t\treturn height;\n\t}\n\n\t/**\n\t\t* Set overflow css style of the contents\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflow(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflow = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n\t}\n\n\t/**\n\t\t* Set overflowX css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowX(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowX = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n\t}\n\n\t/**\n\t\t* Set overflowY css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowY(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowY = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n\t}\n\n\t/**\n\t\t* Set Css styles on the contents element (typically Body)\n\t\t* @param {string} property\n\t\t* @param {string} value\n\t\t* @param {boolean} [priority] set as \"important\"\n\t\t*/\n\tcss(property, value, priority) {\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (value) {\n\t\t\tcontent.style.setProperty(property, value, priority ? \"important\" : \"\");\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[property];\n\t}\n\n\t/**\n\t\t* Get or Set the viewport element\n\t\t* @param {object} [options]\n\t\t* @param {string} [options.width]\n\t\t* @param {string} [options.height]\n\t\t* @param {string} [options.scale]\n\t\t* @param {string} [options.minimum]\n\t\t* @param {string} [options.maximum]\n\t\t* @param {string} [options.scalable]\n\t\t*/\n\tviewport(options) {\n\t\tvar _width, _height, _scale, _minimum, _maximum, _scalable;\n\t\t// var width, height, scale, minimum, maximum, scalable;\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar parsed = {\n\t\t\t\"width\": undefined,\n\t\t\t\"height\": undefined,\n\t\t\t\"scale\": undefined,\n\t\t\t\"minimum\": undefined,\n\t\t\t\"maximum\": undefined,\n\t\t\t\"scalable\": undefined\n\t\t};\n\t\tvar newContent = [];\n\t\tvar settings = {};\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tlet content = $viewport.getAttribute(\"content\");\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\n\t\t\t\tparsed.width = _width[1];\n\t\t\t}\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\n\t\t\t\tparsed.height = _height[1];\n\t\t\t}\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\n\t\t\t\tparsed.scale = _scale[1];\n\t\t\t}\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\n\t\t\t\tparsed.minimum = _minimum[1];\n\t\t\t}\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\n\t\t\t\tparsed.maximum = _maximum[1];\n\t\t\t}\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\n\t\t\t\tparsed.scalable = _scalable[1];\n\t\t\t}\n\t\t}\n\n\t\tsettings = defaults(options || {}, parsed);\n\n\t\tif (options) {\n\t\t\tif (settings.width) {\n\t\t\t\tnewContent.push(\"width=\" + settings.width);\n\t\t\t}\n\n\t\t\tif (settings.height) {\n\t\t\t\tnewContent.push(\"height=\" + settings.height);\n\t\t\t}\n\n\t\t\tif (settings.scale) {\n\t\t\t\tnewContent.push(\"initial-scale=\" + settings.scale);\n\t\t\t}\n\n\t\t\tif (settings.scalable === \"no\") {\n\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"maximum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t} else {\n\n\t\t\t\tif (settings.scalable) {\n\t\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t\t}\n\n\t\t\t\tif (settings.minimum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.minimum);\n\t\t\t\t}\n\n\t\t\t\tif (settings.maximum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.maximum);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!$viewport) {\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\n\t\t\t\tthis.document.querySelector(\"head\").appendChild($viewport);\n\t\t\t}\n\n\t\t\t$viewport.setAttribute(\"content\", newContent.join(\", \"));\n\n\t\t\tthis.window.scrollTo(0, 0);\n\t\t}\n\n\n\t\treturn settings;\n\t}\n\n\tsetViewport() {\n\t\tthis.$viewport = { height: 'auto', width: 'auto' };\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar parsed = {\n\t\t\t\"width\": undefined,\n\t\t\t\"height\": undefined,\n\t\t\t\"scale\": undefined,\n\t\t\t\"minimum\": undefined,\n\t\t\t\"maximum\": undefined,\n\t\t\t\"scalable\": undefined\n\t\t};\n\t\tvar newContent = [];\n\t\tvar settings = {};\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tlet content = $viewport.getAttribute(\"content\");\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\n\t\t\t\tparsed.width = _width[1];\n\t\t\t}\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\n\t\t\t\tparsed.height = _height[1];\n\t\t\t}\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\n\t\t\t\tparsed.scale = _scale[1];\n\t\t\t}\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\n\t\t\t\tparsed.minimum = _minimum[1];\n\t\t\t}\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\n\t\t\t\tparsed.maximum = _maximum[1];\n\t\t\t}\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\n\t\t\t\tparsed.scalable = _scalable[1];\n\t\t\t}\n\t\t}\n\t\tthis.$viewport.height = parseFloat(parsed.height) || 'auto';\n\t\tthis.$viewport.width = parseFloat(parsed.width) || 'auto';\n\t}\n\n\t/**\n\t * Event emitter for when the contents has expanded\n\t * @private\n\t */\n\texpand() {\n\t\tthis.emit(EVENTS.CONTENTS.EXPAND);\n\t}\n\n\t/**\n\t * Add DOM listeners\n\t * @private\n\t */\n\tlisteners() {\n\n\t\tthis.imageLoadListeners();\n\n\t\tthis.mediaQueryListeners();\n\n\t\t// this.fontLoadListeners();\n\n\t\tthis.addEventListeners();\n\n\t\tthis.addSelectionListeners();\n\n\t\t// this.transitionListeners();\n\n\t\tthis.resizeListeners();\n\n\t\t// this.resizeObservers();\n\n\t\tthis.linksHandler();\n\t}\n\n\t/**\n\t * Remove DOM listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.removeSelectionListeners();\n\n\t\tclearTimeout(this.expanding);\n\t}\n\n\t/**\n\t * Check if size of contents has changed and\n\t * emit 'resize' event if it has.\n\t * @private\n\t */\n\tresizeCheck() {\n\t\tlet width = this.textWidth();\n\t\tlet height = this.textHeight();\n\n\t\tif (width != this._size.width || height != this._size.height) {\n\n\t\t\tthis._size = {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\n\t\t\tthis.onResize && this.onResize(this._size);\n\t\t\tthis.emit(EVENTS.CONTENTS.RESIZE, this._size);\n\t\t}\n\t}\n\n\t/**\n\t * Poll for resize detection\n\t * @private\n\t */\n\tresizeListeners() {\n\t\tvar width, height;\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\n\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n\t}\n\n\t/**\n\t * Use css transitions to detect resize\n\t * @private\n\t */\n\ttransitionListeners() {\n\t\tlet body = this.content;\n\n\t\tbody.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n\t\tbody.style['transitionDuration'] = \"0.001ms\";\n\t\tbody.style['transitionTimingFunction'] = \"linear\";\n\t\tbody.style['transitionDelay'] = \"0\";\n\n\t\tthis._resizeCheck = this.resizeCheck.bind(this);\n\t\tthis.document.addEventListener('transitionend', this._resizeCheck);\n\t}\n\n\t/**\n\t * Listen for media query changes and emit 'expand' event\n\t * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n\t * @private\n\t */\n\tmediaQueryListeners() {\n\t\tvar sheets = this.document.styleSheets;\n\t\tvar mediaChangeHandler = function(m){\n\t\t\tif(m.matches && !this._expanding) {\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\n\t\t\tvar rules;\n\t\t\t// Firefox errors if we access cssRules cross-domain\n\t\t\ttry {\n\t\t\t\trules = sheets[i].cssRules;\n\t\t\t} catch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(!rules) return; // Stylesheets changed\n\t\t\tfor (var j = 0; j < rules.length; j += 1) {\n\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\n\t\t\t\tif(rules[j].media){\n\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\n\t\t\t\t\tmql.addListener(mediaChangeHandler);\n\t\t\t\t\t//mql.onchange = mediaChangeHandler;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Use MutationObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tresizeObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new MutationObserver((mutations) => {\n\t\t\tthis.resizeCheck();\n\t\t});\n\n\t\t// configuration of the observer:\n\t\tlet config = { attributes: true, childList: true, characterData: true, subtree: true };\n\n\t\t// pass in the target node, as well as the observer options\n\t\tthis.observer.observe(this.document, config);\n\t}\n\n\t/**\n\t * Test if images are loaded or add listener for when they load\n\t * @private\n\t */\n\timageLoadListeners() {\n\t\tvar images = this.document.querySelectorAll(\"img\");\n\t\tvar img;\n\t\tfor (var i = 0; i < images.length; i++) {\n\t\t\timg = images[i];\n\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\n\t\t\t\t\timg.naturalWidth === 0) {\n\t\t\t\timg.onload = this.expand.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Listen for font load and check for resize when loaded\n\t * @private\n\t */\n\tfontLoadListeners() {\n\t\tif (!this.document || !this.document.fonts) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.document.fonts.ready.then(function () {\n\t\t\tthis.resizeCheck();\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Get the documentElement\n\t * @returns {element} documentElement\n\t */\n\troot() {\n\t\tif(!this.document) return null;\n\t\treturn this.document.documentElement;\n\t}\n\n\t/**\n\t * Get the location offset of a EpubCFI or an #id\n\t * @param {string | EpubCFI} target\n\t * @param {string} [ignoreClass] for the cfi\n\t * @returns { {left: Number, top: Number }\n\t */\n\tlocationOf(target, ignoreClass) {\n\t\tvar position;\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\n\n\t\tif(!this.document) return targetPos;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\tlet range = new EpubCFI(target).toRange(this.document, ignoreClass);\n\n\t\t\tif(range) {\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t} else {\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\n\n\t\t\t\t\t// Construct a new non-collapsed range\n\t\t\t\t\tif (isWebkit) {\n\t\t\t\t\t\tlet container = range.startContainer;\n\t\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (container.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\t\t\tposition = container.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset + 2 < container.length) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset + 2);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset - 2 > 0) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset - 2);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else { // empty, return the parent element\n\t\t\t\t\t\t\t\tposition = container.parentNode.getBoundingClientRect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if(typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\n\t\t\tlet id = target.substring(target.indexOf(\"#\")+1);\n\t\t\tlet el = this.document.getElementById(id);\n\n\t\t\tif(el) {\n\t\t\t\tposition = el.getBoundingClientRect();\n\t\t\t\tif ( position.top < 0 ) {\n\t\t\t\t\tvar offsetEl = el.offsetTop ? el : el.offsetParent;\n\t\t\t\t\tposition = { top: offsetEl.offsetTop, left: offsetEl.offsetLeft };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (position) {\n\t\t\ttargetPos.left = position.left;\n\t\t\ttargetPos.top = position.top;\n\t\t}\n\n\t\treturn targetPos;\n\t}\n\n\t/**\n\t * Append a stylesheet link to the document head\n\t * @param {string} src url\n\t */\n\taddStylesheet(src) {\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $stylesheet;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if link already exists\n\t\t\t$stylesheet = this.document.querySelector(\"link[href='\"+src+\"']\");\n\t\t\tif ($stylesheet) {\n\t\t\t\tresolve(true);\n\t\t\t\treturn; // already present\n\t\t\t}\n\n\t\t\t$stylesheet = this.document.createElement(\"link\");\n\t\t\t$stylesheet.type = \"text/css\";\n\t\t\t$stylesheet.rel = \"stylesheet\";\n\t\t\t$stylesheet.href = src;\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\t// Let apply\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($stylesheet);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Append stylesheet rules to a generate stylesheet\n\t * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n\t * Object: https://github.com/desirable-objects/json-to-css\n\t * @param {array | object} rules\n\t */\n\taddStylesheetRules(rules) {\n\t\tvar styleEl;\n\t\tvar styleSheet;\n\t\tvar key = \"epubjs-inserted-css\";\n\n\t\tif(!this.document || !rules || rules.length === 0) return;\n\n\t\t// Check if link already exists\n\t\tstyleEl = this.document.getElementById(key);\n\t\tif (!styleEl) {\n\t\t\tstyleEl = this.document.createElement(\"style\");\n\t\t\tstyleEl.id = key;\n\t\t\t// Append style element to head\n\t\t\tthis.document.head.appendChild(styleEl);\n\t\t}\n\n\n\t\t// Grab style sheet\n\t\tstyleSheet = styleEl.sheet;\n\n\t\tif (Object.prototype.toString.call(rules) === \"[object Array]\") {\n\t\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\n\t\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = \"\";\n\t\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\n\t\t\t\tif (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n\t\t\t\t\trule = rule[1];\n\t\t\t\t\tj = 0;\n\t\t\t\t}\n\n\t\t\t\tfor (var pl = rule.length; j < pl; j++) {\n\t\t\t\t\tvar prop = rule[j];\n\t\t\t\t\tpropStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n\t\t\t\t}\n\n\t\t\t\t// Insert CSS Rule\n\t\t\t\tstyleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n\t\t\t}\n\t\t} else {\n\t\t\tconst selectors = Object.keys(rules);\n\t\t\tselectors.forEach((selector) => {\n\t\t\t\tconst definition = rules[selector];\n\t\t\t\tif (Array.isArray(definition)) {\n\t\t\t\t\tdefinition.forEach((item) => {\n\t\t\t\t\t\tconst _rules = Object.keys(item);\n\t\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\t\treturn `${rule}:${item[rule]}`;\n\t\t\t\t\t\t}).join(';');\n\t\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst _rules = Object.keys(definition);\n\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\treturn `${rule}:${definition[rule]}`;\n\t\t\t\t\t}).join(';');\n\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Append a script tag to the document head\n\t * @param {string} src url\n\t * @returns {Promise} loaded\n\t */\n\taddScript(src) {\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $script;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$script = this.document.createElement(\"script\");\n\t\t\t$script.type = \"text/javascript\";\n\t\t\t$script.async = true;\n\t\t\t$script.src = src;\n\t\t\t$script.onload = $script.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($script);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Add a class to the contents container\n\t * @param {string} className\n\t */\n\taddClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.add(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Remove a class from the contents container\n\t * @param {string} removeClass\n\t */\n\tremoveClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.remove(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Add DOM event listeners\n\t * @private\n\t */\n\taddEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._triggerEvent = this.triggerEvent.bind(this);\n\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.addEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\n\t}\n\n\t/**\n\t * Remove DOM event listeners\n\t * @private\n\t */\n\tremoveEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.removeEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\t\tthis._triggerEvent = undefined;\n\t}\n\n\t/**\n\t * Emit passed browser events\n\t * @private\n\t */\n\ttriggerEvent(e){\n\t\tthis.emit(e.type, e);\n\t}\n\n\t/**\n\t * Add listener for text selection\n\t * @private\n\t */\n\taddSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectionChange = this.onSelectionChange.bind(this);\n\t\tthis.document.addEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t}\n\n\t/**\n\t * Remove listener for text selection\n\t * @private\n\t */\n\tremoveSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.removeEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t\tthis._onSelectionChange = undefined;\n\t}\n\n\t/**\n\t * Handle getting text on selection\n\t * @private\n\t */\n\tonSelectionChange(e){\n\t\tif (this.selectionEndTimeout) {\n\t\t\tclearTimeout(this.selectionEndTimeout);\n\t\t}\n\t\tthis.selectionEndTimeout = setTimeout(function() {\n\t\t\tvar selection = this.window.getSelection();\n\t\t\tthis.triggerSelectedEvent(selection);\n\t\t}.bind(this), 250);\n\t}\n\n\t/**\n\t * Emit event on text selection\n\t * @private\n\t */\n\ttriggerSelectedEvent(selection){\n\t\tvar range, cfirange;\n\n\t\tif (selection && selection.rangeCount > 0) {\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed) {\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get a Dom Range from EpubCFI\n\t * @param {EpubCFI} _cfi\n\t * @param {string} [ignoreClass]\n\t * @returns {Range} range\n\t */\n\trange(_cfi, ignoreClass){\n\t\tvar cfi = new EpubCFI(_cfi);\n\t\treturn cfi.toRange(this.document, ignoreClass);\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom Range\n\t * @param {Range} range\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromRange(range, ignoreClass){\n\t\treturn new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom node\n\t * @param {node} node\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromNode(node, ignoreClass){\n\t\treturn new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t// TODO: find where this is used - remove?\n\tmap(layout){\n\t\tvar map = new Mapping(layout);\n\t\treturn map.section();\n\t}\n\n\t/**\n\t * Size the contents to a given width and height\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tsize(width, height){\n\t\tvar viewport = { scale: 1.0, scalable: \"no\" };\n\n\t\tthis.layoutStyle(\"scrolling\");\n\n\t\tif (width >= 0) {\n\t\t\tthis.width(width);\n\t\t\tviewport.width = width;\n\t\t\tthis.css(\"padding\", \"0 \"+(width/12)+\"px\");\n\t\t}\n\n\t\tif (height >= 0) {\n\t\t\tthis.height(height);\n\t\t\tviewport.height = height;\n\t\t}\n\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\n\n\t\tthis.viewport(viewport);\n\t}\n\n\t/**\n\t * Apply columns to the contents for pagination\n\t * @param {number} width\n\t * @param {number} height\n\t * @param {number} columnWidth\n\t * @param {number} gap\n\t */\n\tcolumns(width, height, columnWidth, gap){\n\t\tlet COLUMN_AXIS = prefixed(\"column-axis\");\n\t\tlet COLUMN_GAP = prefixed(\"column-gap\");\n\t\tlet COLUMN_WIDTH = prefixed(\"column-width\");\n\t\tlet COLUMN_FILL = prefixed(\"column-fill\");\n\n\t\tlet writingMode = this.writingMode();\n\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// Fix body width issues if rtl is only set on body element\n\t\tif (this.content.dir === \"rtl\") {\n\t\t\tthis.direction(\"rtl\");\n\t\t}\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ width: width, height: height, scale: 1.0, scalable: \"no\" });\n\n\t\t// TODO: inline-block needs more testing\n\t\t// Fixes Safari column cut offs, but causes RTL issues\n\t\t// this.css(\"display\", \"inline-block\");\n\n\t\tthis.css(\"overflow-y\", \"hidden\");\n\t\tthis.css(\"margin\", \"0\", true);\n\n\t\tif (axis === \"vertical\") {\n\t\t\tthis.css(\"padding-top\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-bottom\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-left\", \"20px\");\n\t\t\tthis.css(\"padding-right\", \"20px\");\n\t\t} else {\n\t\t\tthis.css(\"padding-top\", \"20px\");\n\t\t\tthis.css(\"padding-bottom\", \"20px\");\n\t\t\tthis.css(\"padding-left\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-right\", (gap / 2) + \"px\", true);\n\t\t}\n\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\t\tthis.css(\"max-width\", \"inherit\");\n\n\t\tthis.css(COLUMN_AXIS, \"horizontal\");\n\t\tthis.css(COLUMN_FILL, \"auto\");\n\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\n\t}\n\n\t/**\n\t * Scale contents from center\n\t * @param {number} scale\n\t * @param {number} offsetX\n\t * @param {number} offsetY\n\t */\n\tscaler(scale, offsetX, offsetY){\n\t\tvar scaleStr = \"scale(\" + scale + \")\";\n\t\tvar translateStr = \"\";\n\t\t// this.css(\"position\", \"absolute\"));\n\t\tthis.css(\"transform-origin\", \"top left\");\n\n\t\tif (offsetX >= 0 || offsetY >= 0) {\n\t\t\ttranslateStr = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px)\";\n\t\t// } else if ( offsetX || offsetY ) {\n\t\t// \ttranslateStr = \" translate(\" + offsetX + \",\" + offsetY + \")\";\n\t\t}\n\n\t\tthis.css(\"transform\", scaleStr + translateStr);\n\t}\n\n\t/**\n\t * Fit contents into a fixed width and height\n\t * @param {number} width\n\t * @param {number} height\n\t */\n\tfit(width, height){\n\t\tvar viewport = this.viewport();\n\t\tvar viewportWidth;\n\t\tvar viewportHeight;\n\n\t\t// var viewportWidth = parseInt(viewport.width);\n\t\t// var viewportHeight = parseInt(viewport.height);\n\n\t\tif ( viewport.width == 'auto' && viewport.height == 'auto' ) {\n\t\t\tviewportWidth = width;\n\t\t\tviewportHeight = height; // this.textHeight(); // height;\n\t\t\tconsole.log(\"AHOY contents.fit\", height, this.textHeight());\n\t\t} else {\n\t\t\tviewportWidth = parseInt(viewport.width);\n\t\t\tviewportHeight = parseInt(viewport.height);\n\t\t}\n\n\t\tvar widthScale = width / viewportWidth;\n\t\tvar heightScale = height / viewportHeight;\n\t\tvar scale;\n\t\tif ( this.axis == 'xxxvertical' ) {\n\t\t\tscale = widthScale > heightScale ? widthScale : heightScale;\n\t\t} else {\n\t\t\tscale = widthScale < heightScale ? widthScale : heightScale;\n\t\t}\n\t\t// console.log(\"AHOY contents.fit\", width, height, \":\", viewportWidth, viewportHeight, \":\", scale);\n\n\t\t// the translate does not work as intended, elements can end up unaligned\n\t\t// var offsetY = (height - (viewportHeight * scale)) / 2;\n\t\t// var offsetX = 0;\n\t\t// if (this.sectionIndex % 2 === 1) {\n\t\t// \toffsetX = width - (viewportWidth * scale);\n\t\t// }\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// scale needs width and height to be set\n\t\tthis.width(viewportWidth);\n\t\tthis.height(viewportHeight);\n\t\tthis.overflow(\"hidden\");\n\n\t\tif ( viewport.width == 'auto' || viewport.height == 'auto' ) {\n\t\t\tthis.content.style.overflow = 'auto';\n\t\t\tthis.addStylesheetRules({\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"margin\": 0,\n\t\t\t\t\t\"padding\": \"1em\",\n\t\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\t// Scale to the correct size\n\t\tthis.scaler(scale, 0, 0);\n\t\t// this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n\n\t\t// background images are not scaled by transform\n\t\tthis.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n\n\t\tthis.css(\"background-color\", \"transparent\");\n\t}\n\n\t/**\n\t * Set the direction of the text\n\t * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n\t */\n\tdirection(dir) {\n\t\tif (this.documentElement) {\n\t\t\tthis.documentElement.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\tmapPage(cfiBase, layout, start, end, dev) {\n\t\tvar mapping = new Mapping(layout, dev);\n\n\t\treturn mapping.page(this, cfiBase, start, end);\n\t}\n\n\t/**\n\t * Emit event when link in content is clicked\n\t * @private\n\t */\n\tlinksHandler() {\n\t\treplaceLinks(this.content, (href) => {\n\t\t\tthis.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n\t\t});\n\t}\n\n\t/**\n\t * Set the writingMode of the text\n\t * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n\t */\n\twritingMode(mode) {\n\t\tlet WRITING_MODE = prefixed(\"writing-mode\");\n\n\t\tif (mode && this.documentElement) {\n\t\t\tthis.documentElement.style[WRITING_MODE] = mode;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n\t}\n\n\t/**\n\t * Set the layoutStyle of the content\n\t * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n\t * @private\n\t */\n\tlayoutStyle(style) {\n\n\t\tif (style) {\n\t\t\tthis._layoutStyle = style;\n\t\t\tnavigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n\t\t}\n\n\t\treturn this._layoutStyle || \"paginated\";\n\t}\n\n\t/**\n\t * Add the epubReadingSystem object to the navigator\n\t * @param {string} name\n\t * @param {string} version\n\t * @private\n\t */\n\tepubReadingSystem(name, version) {\n\t\tnavigator.epubReadingSystem = {\n\t\t\tname: name,\n\t\t\tversion: version,\n\t\t\tlayoutStyle: this.layoutStyle(),\n\t\t\thasFeature: function (feature) {\n\t\t\t\tswitch (feature) {\n\t\t\t\t\tcase \"dom-manipulation\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"layout-changes\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"touch-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"mouse-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"keyboard-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"spine-scripting\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn navigator.epubReadingSystem;\n\t}\n\n\tdestroy() {\n\t\t// Stop observing\n\t\tif(this.observer) {\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tthis.document.removeEventListener('transitionend', this._resizeCheck);\n\n\t\tthis.removeListeners();\n\n\t}\n}\n\nEventEmitter(Contents.prototype);\n\nexport default Contents;\n","import EventEmitter from \"event-emitter\";\nimport EpubCFI from \"./epubcfi\";\n\n/**\n\t* Handles managing adding & removing Annotations\n\t* @param {Rendition} rendition\n\t* @class\n\t*/\nclass Annotations {\n\n\tconstructor (rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis.highlights = [];\n\t\tthis.underlines = [];\n\t\tthis.marks = [];\n\t\tthis._annotations = {};\n\t\tthis._annotationsBySectionIndex = {};\n\n\t\tthis.rendition.hooks.render.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.unloaded.register(this.clear.bind(this));\n\t}\n\n\t/**\n\t * Add an annotation to store\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} [cb] Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t * @returns {Annotation} annotation\n\t */\n\tadd (type, cfiRange, data, cb, className, styles) {\n\t\tlet hash = encodeURI(cfiRange);\n\t\tlet cfi = new EpubCFI(cfiRange);\n\t\tlet sectionIndex = cfi.spinePos;\n\t\tlet annotation = new Annotation({\n\t\t\ttype,\n\t\t\tcfiRange,\n\t\t\tdata,\n\t\t\tsectionIndex,\n\t\t\tcb,\n\t\t\tclassName,\n\t\t\tstyles\n\t\t});\n\n\t\tthis._annotations[hash] = annotation;\n\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tthis._annotationsBySectionIndex[sectionIndex].push(hash);\n\t\t} else {\n\t\t\tthis._annotationsBySectionIndex[sectionIndex] = [hash];\n\t\t}\n\n\t\tlet views = this.rendition.views();\n\n\t\tviews.forEach( (view) => {\n\t\t\tif (annotation.sectionIndex === view.index) {\n\t\t\t\tannotation.attach(view);\n\t\t\t}\n\t\t});\n\n\t\treturn annotation;\n\t}\n\n\t/**\n\t * Remove an annotation from store\n\t * @param {EpubCFI} cfiRange EpubCFI range the annotation is attached to\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n\t */\n\tremove (cfiRange, type) {\n\t\tlet hash = encodeURI(cfiRange);\n\n\t\tif (hash in this._annotations) {\n\t\t\tlet annotation = this._annotations[hash];\n\n\t\t\tif (type && annotation.type !== type) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet views = this.rendition.views();\n\t\t\tviews.forEach( (view) => {\n\t\t\t\tthis._removeFromAnnotationBySectionIndex(annotation.sectionIndex, hash);\n\t\t\t\tif (annotation.sectionIndex === view.index) {\n\t\t\t\t\tannotation.detach(view);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete this._annotations[hash];\n\t\t}\n\t}\n\n\t/**\n\t * Remove an annotations by Section Index\n\t * @private\n\t */\n\t_removeFromAnnotationBySectionIndex (sectionIndex, hash) {\n\t\tthis._annotationsBySectionIndex[sectionIndex] = this._annotationsAt(sectionIndex).filter(h => h !== hash);\n\t}\n\n\t/**\n\t * Get annotations by Section Index\n\t * @private\n\t */\n\t_annotationsAt (index) {\n\t\treturn this._annotationsBySectionIndex[index];\n\t}\n\n\n\t/**\n\t * Add a highlight to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t */\n\thighlight (cfiRange, data, cb, className, styles) {\n\t\tthis.add(\"highlight\", cfiRange, data, cb, className, styles);\n\t}\n\n\t/**\n\t * Add a underline to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t */\n\tunderline (cfiRange, data, cb, className, styles) {\n\t\tthis.add(\"underline\", cfiRange, data, cb, className, styles);\n\t}\n\n\t/**\n\t * Add a mark to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t */\n\tmark (cfiRange, data, cb) {\n\t\tthis.add(\"mark\", cfiRange, data, cb);\n\t}\n\n\t/**\n\t * iterate over annotations in the store\n\t */\n\teach () {\n\t\treturn this._annotations.forEach.apply(this._annotations, arguments);\n\t}\n\n\t/**\n\t * Hook for injecting annotation into a view\n\t * @param {View} view\n\t * @private\n\t */\n\tinject (view) {\n\t\tlet sectionIndex = view.index;\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\n\t\t\tannotations.forEach((hash) => {\n\t\t\t\tlet annotation = this._annotations[hash];\n\t\t\t\tannotation.attach(view);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook for removing annotation from a view\n\t * @param {View} view\n\t * @private\n\t */\n\tclear (view) {\n\t\tlet sectionIndex = view.index;\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\n\t\t\tannotations.forEach((hash) => {\n\t\t\t\tlet annotation = this._annotations[hash];\n\t\t\t\tannotation.detach(view);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * [Not Implemented] Show annotations\n\t * @TODO: needs implementation in View\n\t */\n\tshow () {\n\n\t}\n\n\t/**\n\t * [Not Implemented] Hide annotations\n\t * @TODO: needs implementation in View\n\t */\n\thide () {\n\n\t}\n\n}\n\n/**\n * Annotation object\n * @class\n * @param {object} options\n * @param {string} options.type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n * @param {EpubCFI} options.cfiRange EpubCFI range to attach annotation to\n * @param {object} options.data Data to assign to annotation\n * @param {int} options.sectionIndex Index in the Spine of the Section annotation belongs to\n * @param {function} [options.cb] Callback after annotation is added\n * @param {string} className CSS class to assign to annotation\n * @param {object} styles CSS styles to assign to annotation\n * @returns {Annotation} annotation\n */\nclass Annotation {\n\n\tconstructor ({\n\t\ttype,\n\t\tcfiRange,\n\t\tdata,\n\t\tsectionIndex,\n\t\tcb,\n\t\tclassName,\n\t\tstyles\n\t}) {\n\t\tthis.type = type;\n\t\tthis.cfiRange = cfiRange;\n\t\tthis.data = data;\n\t\tthis.sectionIndex = sectionIndex;\n\t\tthis.mark = undefined;\n\t\tthis.cb = cb;\n\t\tthis.className = className;\n\t\tthis.styles = styles;\n\t}\n\n\t/**\n\t * Update stored data\n\t * @param {object} data\n\t */\n\tupdate (data) {\n\t\tthis.data = data;\n\t}\n\n\t/**\n\t * Add to a view\n\t * @param {View} view\n\t */\n\tattach (view) {\n\t\tlet {cfiRange, data, type, mark, cb, className, styles} = this;\n\t\tlet result;\n\n\t\tif (type === \"highlight\") {\n\t\t\tresult = view.highlight(cfiRange, data, cb, className, styles);\n\t\t} else if (type === \"underline\") {\n\t\t\tresult = view.underline(cfiRange, data, cb, className, styles);\n\t\t} else if (type === \"mark\") {\n\t\t\tresult = view.mark(cfiRange, data, cb);\n\t\t}\n\n\t\tthis.mark = result;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Remove from a view\n\t * @param {View} view\n\t */\n\tdetach (view) {\n\t\tlet {cfiRange, type} = this;\n\t\tlet result;\n\n\t\tif (view) {\n\t\t\tif (type === \"highlight\") {\n\t\t\t\tresult = view.unhighlight(cfiRange);\n\t\t\t} else if (type === \"underline\") {\n\t\t\t\tresult = view.ununderline(cfiRange);\n\t\t\t} else if (type === \"mark\") {\n\t\t\t\tresult = view.unmark(cfiRange);\n\t\t\t}\n\t\t}\n\n\t\tthis.mark = undefined;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * [Not Implemented] Get text of an annotation\n\t * @TODO: needs implementation in contents\n\t */\n\ttext () {\n\n\t}\n\n}\n\nEventEmitter(Annotation.prototype);\n\n\nexport default Annotations\n","export function createElement(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nexport default {\n    createElement: createElement\n};\n","// import 'babelify/polyfill'; // needed for Object.assign\n\nexport default {\n    proxyMouse: proxyMouse\n};\n\n\n/**\n * Start proxying all mouse events that occur on the target node to each node in\n * a set of tracked nodes.\n *\n * The items in tracked do not strictly have to be DOM Nodes, but they do have\n * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.\n *\n * @param target {Node} The node on which to listen for mouse events.\n * @param tracked {Node[]} A (possibly mutable) array of nodes to which to proxy\n *                         events.\n */\nexport function proxyMouse(target, tracked) {\n    function dispatch(e) {\n        // We walk through the set of tracked elements in reverse order so that\n        // events are sent to those most recently added first.\n        //\n        // This is the least surprising behaviour as it simulates the way the\n        // browser would work if items added later were drawn \"on top of\"\n        // earlier ones.\n        for (var i = tracked.length - 1; i >= 0; i--) {\n            var t = tracked[i];\n            var x = e.clientX\n            var y = e.clientY;\n\n            if (e.touches && e.touches.length) {\n              x = e.touches[0].clientX;\n              y = e.touches[0].clientY;\n            }\n\n            if (!contains(t, target, x, y)) {\n                continue;\n            }\n\n            // The event targets this mark, so dispatch a cloned event:\n            t.dispatchEvent(clone(e));\n            // We only dispatch the cloned event to the first matching mark.\n            break;\n        }\n    }\n\n    if (target.nodeName === \"iframe\" || target.nodeName === \"IFRAME\") {\n\n      try {\n        // Try to get the contents if same domain\n        this.target = target.contentDocument;\n      } catch(err){\n        this.target = target;\n      }\n\n    } else {\n      this.target = target;\n    }\n\n    for (var ev of ['mouseup', 'mousedown', 'click', 'touchstart']) {\n        this.target.addEventListener(ev, (e) => dispatch(e), false);\n    }\n\n}\n\n\n/**\n * Clone a mouse event object.\n *\n * @param e {MouseEvent} A mouse event object to clone.\n * @returns {MouseEvent}\n */\nexport function clone(e) {\n    var opts = Object.assign({}, e, {bubbles: false});\n    try {\n        return new MouseEvent(e.type, opts);\n    } catch(err) { // compat: webkit\n        var copy = document.createEvent('MouseEvents');\n        copy.initMouseEvent(e.type, false, opts.cancelable, opts.view,\n                            opts.detail, opts.screenX, opts.screenY,\n                            opts.clientX, opts.clientY, opts.ctrlKey,\n                            opts.altKey, opts.shiftKey, opts.metaKey,\n                            opts.button, opts.relatedTarget);\n        return copy;\n    }\n}\n\n\n/**\n * Check if the item contains the point denoted by the passed coordinates\n * @param item {Object} An object with getBoundingClientRect and getClientRects\n *                      methods.\n * @param x {Number}\n * @param y {Number}\n * @returns {Boolean}\n */\nfunction contains(item, target, x, y) {\n    // offset\n    var offset = target.getBoundingClientRect();\n\n    function rectContains(r, x, y) {\n        var top = r.top - offset.top;\n        var left = r.left - offset.left;\n        var bottom = top + r.height;\n        var right = left + r.width;\n        return (top <= y && left <= x && bottom > y && right > x);\n    }\n\n    // Check overall bounding box first\n    var rect = item.getBoundingClientRect();\n    if (!rectContains(rect, x, y)) {\n        return false;\n    }\n\n    // Then continue to check each child rect\n    var rects = item.getClientRects();\n    for (var i = 0, len = rects.length; i < len; i++) {\n        if (rectContains(rects[i], x, y)) {\n            return true;\n        }\n    }\n    return false;\n}\n","import svg from './svg';\nimport events from './events';\n\nexport class Pane {\n    constructor(target, container = document.body) {\n        this.target = target;\n        this.element = svg.createElement('svg');\n        this.marks = [];\n\n        // Match the coordinates of the target element\n        this.element.style.position = 'absolute';\n        // Disable pointer events\n        this.element.setAttribute('pointer-events', 'none');\n\n        // Set up mouse event proxying between the target element and the marks\n        events.proxyMouse(this.target, this.marks);\n\n        this.container = container;\n        this.container.appendChild(this.element);\n\n        this.render();\n    }\n\n    addMark(mark) {\n        var g = svg.createElement('g');\n        this.element.appendChild(g);\n        mark.bind(g, this.container);\n\n        this.marks.push(mark);\n\n        mark.render();\n        return mark;\n    }\n\n    removeMark(mark) {\n        var idx = this.marks.indexOf(mark);\n        if (idx === -1) {\n            return;\n        }\n        var el = mark.unbind();\n        this.element.removeChild(el);\n        this.marks.splice(idx, 1);\n    }\n\n    render() {\n        setCoords(this.element, coords(this.target, this.container));\n        for (var m of this.marks) {\n            m.render();\n        }\n    }\n}\n\n\nexport class Mark {\n    constructor() {\n        this.element = null;\n    }\n\n    bind(element, container) {\n        this.element = element;\n        this.container = container;\n    }\n\n    unbind() {\n        var el = this.element;\n        this.element = null;\n        return el;\n    }\n\n    render() {}\n\n    dispatchEvent(e) {\n        if (!this.element) return;\n        this.element.dispatchEvent(e);\n    }\n\n    getBoundingClientRect() {\n        return this.element.getBoundingClientRect();\n    }\n\n    getClientRects() {\n        var rects = [];\n        var el = this.element.firstChild;\n        while (el) {\n            rects.push(el.getBoundingClientRect());\n            el = el.nextSibling;\n        }\n        return rects;\n    }\n\n    filteredRanges() {\n      var rects = Array.from(this.range.getClientRects());\n\n      // De-duplicate the boxes\n      return rects.filter((box) => {\n        for (var i = 0; i < rects.length; i++) {\n          if (rects[i] === box) {\n            return true;\n          }\n          let contained = contains(rects[i], box);\n          if (contained) {\n            return false;\n          }\n        }\n        return true;\n      })\n    }\n\n}\n\nexport class Highlight extends Mark {\n    constructor(range, className, data, attributes) {\n        super();\n        this.range = range;\n        this.className = className;\n        this.data = data || {};\n        this.attributes = attributes || {};\n    }\n\n    bind(element, container) {\n        super.bind(element, container);\n\n        for (var attr in this.data) {\n          if (this.data.hasOwnProperty(attr)) {\n            this.element.dataset[attr] = this.data[attr];\n          }\n        }\n\n        for (var attr in this.attributes) {\n          if (this.attributes.hasOwnProperty(attr)) {\n            this.element.setAttribute(attr, this.attributes[attr]);\n          }\n        }\n\n        if (this.className) {\n          this.element.classList.add(this.className);\n        }\n    }\n\n    render() {\n        // Empty element\n        while (this.element.firstChild) {\n            this.element.removeChild(this.element.firstChild);\n        }\n\n        var docFrag = this.element.ownerDocument.createDocumentFragment();\n        var filtered = this.filteredRanges();\n        var offset = this.element.getBoundingClientRect();\n        var container = this.container.getBoundingClientRect();\n        container = { top: container.top, left: container.left };\n        // take into account padding\n        var styles = window.getComputedStyle(this.container);\n        container.left += parseInt(styles.paddingLeft);\n        container.top += parseInt(styles.paddingTop);\n\n        for (var i = 0, len = filtered.length; i < len; i++) {\n            var r = filtered[i];\n            var el = svg.createElement('rect');\n            el.setAttribute('x', r.left - offset.left + container.left);\n            el.setAttribute('y', r.top - offset.top + container.top);\n            el.setAttribute('height', r.height);\n            el.setAttribute('width', r.width);\n            docFrag.appendChild(el);\n        }\n\n        this.element.appendChild(docFrag);\n\n    }\n}\n\nexport class Underline extends Highlight {\n    constructor(range, className, data, attributes) {\n        super(range, className, data,  attributes);\n    }\n\n    render() {\n        // Empty element\n        while (this.element.firstChild) {\n            this.element.removeChild(this.element.firstChild);\n        }\n\n        var docFrag = this.element.ownerDocument.createDocumentFragment();\n        var filtered = this.filteredRanges();\n        var offset = this.element.getBoundingClientRect();\n        var container = this.container.getBoundingClientRect();\n\n        for (var i = 0, len = filtered.length; i < len; i++) {\n            var r = filtered[i];\n\n            var rect = svg.createElement('rect');\n            rect.setAttribute('x', r.left - offset.left + container.left);\n            rect.setAttribute('y', r.top - offset.top + container.top);\n            rect.setAttribute('height', r.height);\n            rect.setAttribute('width', r.width);\n            rect.setAttribute('fill', 'none');\n\n\n            var line = svg.createElement('line');\n            line.setAttribute('x1', r.left - offset.left + container.left);\n            line.setAttribute('x2', r.left - offset.left + container.left + r.width);\n            line.setAttribute('y1', r.top - offset.top + container.top + r.height - 1);\n            line.setAttribute('y2', r.top - offset.top + container.top + r.height - 1);\n\n            line.setAttribute('stroke-width', 1);\n            line.setAttribute('stroke', 'black'); //TODO: match text color?\n            line.setAttribute('stroke-linecap', 'square');\n\n            docFrag.appendChild(rect);\n\n            docFrag.appendChild(line);\n        }\n\n        this.element.appendChild(docFrag);\n\n    }\n}\n\n\nfunction coords(el, container) {\n    var offset = container.getBoundingClientRect();\n    var rect = el.getBoundingClientRect();\n\n    return {\n        top: rect.top - offset.top,\n        left: rect.left - offset.left,\n        height: el.scrollHeight,\n        width: el.scrollWidth\n    };\n}\n\n\nfunction setCoords(el, coords) {\n    el.style.setProperty('top', `${coords.top}px`, 'important');\n    el.style.setProperty('left', `${coords.left}px`, 'important');\n    el.style.setProperty('height', `${coords.height}px`, 'important');\n    el.style.setProperty('width', `${coords.width}px`, 'important');\n}\n\nfunction contains(rect1, rect2) {\n  return (\n    (rect2.right <= rect1.right) &&\n    (rect2.left >= rect1.left) &&\n    (rect2.top >= rect1.top) &&\n    (rect2.bottom <= rect1.bottom)\n  );\n}\n","import EventEmitter from \"event-emitter\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : \"\",\n\t\t\taxis: options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n\t\t\tdirection: undefined,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t\tmethod: undefined\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\t// this.width  = this.settings.width;\n\t\t// this.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// console.log(\"AHOY iframe NEW\", this.layout.height);\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis.pane = undefined;\n\t\tthis.highlights = {};\n\t\tthis.underlines = {};\n\t\tthis.marks = {};\n\n\t}\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement(\"div\");\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\t\telement.style.position = \"relative\";\n\t\telement.style.display = \"block\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.flex = \"none\";\n\t\t} else {\n\t\t\telement.style.flex = \"initial\";\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement(\"iframe\");\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.setAttribute(\"ref\", this.index);\n\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\n\t\tif((\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\tif (!this.settings.method) {\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n\t\t}\n\n\t\treturn this.iframe;\n\t}\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\t// console.log(\"AHOY IFRAME render\", this.layout.height);\n\t\t\t\tthis.layout.format(this.contents);\n\n\t\t\t\t// find and report the writingMode axis\n\t\t\t\tlet writingMode = this.contents.writingMode();\n\t\t\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\t\t\tthis.setAxis(axis);\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\n\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\t\tthis.expand();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t}.bind(this), function(e){\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.then(function() {\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\n\t\t\t}.bind(this));\n\n\t}\n\n\treset () {\n\t\tif (this.iframe) {\n\t\t\tthis.iframe.style.width = \"0\";\n\t\t\tthis.iframe.style.height = \"0\";\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._textWidth = undefined;\n\t\t\tthis._contentWidth = undefined;\n\t\t\tthis._textHeight = undefined;\n\t\t\tthis._contentHeight = undefined;\n\t\t}\n\t\tthis._needsReframe = true;\n\t}\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t\t// console.log(\"AHOY IRAME size lock\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t\tthis.settings.width = width;\n\t\tthis.settings.height = height;\n\t}\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t// this.contents.layout();\n\t\t\tthis.expand();\n\t\t}\n\n\n\n\t}\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\tif(this.layout.name === 'pre-paginated' && this.settings.axis === 'vertical') {\n\t\t\theight = this.contents.textHeight();\n\t\t\twidth = this.contents.textWidth();\n            // width = this.layout.columnWidth;\n\n\t\t} else if(this.layout.name === \"pre-paginated\") {\n\t\t\twidth = this.layout.columnWidth;\n\t\t\theight = this.layout.height;\n\t\t}\n\t\t// Expand Horizontally\n\t\telse if(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\twidth = this.contents.textWidth();\n\n\t\t\tif (width % this.layout.pageWidth > 0) {\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n\t\t\t}\n\n\t\t\tif (this.settings.forceEvenPages) {\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\n\t\t\t\tif ( this.layout.divisor > 1 &&\n\t\t\t\t\t\t this.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t// add a blank page\n\t\t\t\t\twidth += this.layout.pageWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\theight = this.contents.textHeight();\n\t\t\t// width = this.contents.textWidth();\n\t\t\t// console.log(\"AHOY AHOY expand\", this.index, width, height, \"/\", this._width, this._height);\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.reframe(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t}\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n\t\tsize = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\twidthDelta: widthDelta,\n\t\t\theightDelta: heightDelta,\n\t\t};\n\n\t\tthis.pane && this.pane.render();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tlet mark;\n\t\t\tfor (let m in this.marks) {\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\n\t\t\t\t\tmark = this.marks[m];\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\n\n\t\tthis.prevBounds = size;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t}\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif (this.settings.method === \"blobUrl\") {\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n\t\t\tthis.iframe.src = this.blobUrl;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else if(this.settings.method === \"srcdoc\"){\n\t\t\tcontents = contents.replace('</body>', '<script>window.addEventListener(\"load\", (e) => { });</script></body>');\n\t\t\tif ( this.settings.prehooks && this.settings.prehooks.head ) {\n\t\t\t\tvar buffer = [];\n\t\t\t\tthis.settings.prehooks.head.trigger(buffer);\n\t\t\t\tbuffer.forEach((b) => {\n\t\t\t\t\tcontents = contents.replace('</head>', b + '</head>');\n\t\t\t\t})\n\t\t\t\t// contents = contents.replace('</head>', this.settings.prehooks.head(this.settings.layout) + '</head>');\n\t\t\t}\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else {\n\n\t\t\tthis.element.appendChild(this.iframe);\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\tonLoad(event, promise) {\n\n\t\tthis.window = this.iframe.contentWindow;\n\t\tthis.document = this.iframe.contentDocument;\n\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n\n\t\tthis.rendering = false;\n\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\tif (link) {\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t} else {\n\t\t\tlink = this.document.createElement(\"link\");\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t}\n\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpromise.resolve(this.contents);\n\t}\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\n\t\tif (this.contents) {\n\t\t\tthis.layout.format(this.contents);\n\t\t\tthis.expand();\n\t\t}\n\t}\n\n\tsetAxis(axis) {\n\n\t\t// Force vertical for scrolled\n\t\tif (this.layout.props.flow === \"scrolled\") {\n\t\t\taxis = \"vertical\";\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tif(axis == \"horizontal\"){\n\t\t\tthis.element.style.flex = \"none\";\n\t\t} else {\n\t\t\tthis.element.style.flex = \"initial\";\n\t\t}\n\n\t\tthis.size();\n\n\t}\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t}\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t}\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\n\t\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\t\tthis.displayed = true;\n\t\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t\t}.bind(this), function (err) {\n\t\t\t\t\tdisplayed.reject(err, this);\n\t\t\t\t});\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t}\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\n\t\t\t// Remind Safari to redraw the iframe\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\n\t\t\tthis.iframe.offsetWidth;\n\t\t\tthis.iframe.style.transform = null;\n\t\t}\n\n\t\t// console.log(\"AHOY VIEWS iframe show\", this.index);\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\n\t}\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\t// console.log(\"AHOY VIEWS iframe hide\", this.index);\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\n\t}\n\n\toffset() {\n\t\treturn {\n\t\t\ttop: this.element.offsetTop,\n\t\t\tleft: this.element.offsetLeft\n\t\t}\n\t}\n\n\twidth() {\n\t\treturn this._width;\n\t}\n\n\theight() {\n\t\treturn this._height;\n\t}\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t}\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": targetPos.left,\n\t\t\t\"top\": targetPos.top\n\t\t};\n\t}\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tbounds(force) {\n\t\tif(force || !this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\n\t\treturn this.elementBounds;\n\t}\n\n\thighlight(cfiRange, data={}, cb, className = \"epubjs-hl\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"fill\": \"yellow\", \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Highlight(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tunderline(cfiRange, data={}, cb, className = \"epubjs-ul\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Underline(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tmark(cfiRange, data={}, cb) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cfiRange in this.marks) {\n\t\t\tlet item = this.marks[cfiRange];\n\t\t\treturn item;\n\t\t}\n\n\t\tlet range = this.contents.range(cfiRange);\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = range.commonAncestorContainer;\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\n\n\t\tlet emitter = (e) => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tif (range.collapsed && container.nodeType === 1) {\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(container);\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(parent);\n\t\t}\n\n\t\tlet mark = this.document.createElement(\"a\");\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\n\t\tmark.style.position = \"absolute\";\n\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\n\n\t\tif (data) {\n\t\t\tObject.keys(data).forEach((key) => {\n\t\t\t\tmark.dataset[key] = data[key];\n\t\t\t});\n\t\t}\n\n\t\tif (cb) {\n\t\t\tmark.addEventListener(\"click\", cb);\n\t\t\tmark.addEventListener(\"touchstart\", cb);\n\t\t}\n\n\t\tmark.addEventListener(\"click\", emitter);\n\t\tmark.addEventListener(\"touchstart\", emitter);\n\n\t\tthis.placeMark(mark, range);\n\n\t\tthis.element.appendChild(mark);\n\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\n\n\t\treturn parent;\n\t}\n\n\tplaceMark(element, range) {\n\t\tlet top, right, left;\n\n\t\tif(this.layout.name === \"pre-paginated\" ||\n\t\t\tthis.settings.axis !== \"horizontal\") {\n\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\ttop = pos.top;\n\t\t\tright = pos.right;\n\t\t} else {\n\t\t\t// Element might break columns, so find the left most element\n\t\t\tlet rects = range.getClientRects();\n\n\t\t\tlet rect;\n\t\t\tfor (var i = 0; i != rects.length; i++) {\n\t\t\t\trect = rects[i];\n\t\t\t\tif (!left || rect.left < left) {\n\t\t\t\t\tleft = rect.left;\n\t\t\t\t\t// right = rect.right;\n\t\t\t\t\tright = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - (this.layout.gap / 2);\n\t\t\t\t\ttop = rect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.style.top = `${top}px`;\n\t\telement.style.left = `${right}px`;\n\t}\n\n\tunhighlight(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.highlights) {\n\t\t\titem = this.highlights[cfiRange];\n\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.highlights[cfiRange];\n\t\t}\n\t}\n\n\tununderline(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.underlines) {\n\t\t\titem = this.underlines[cfiRange];\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.underlines[cfiRange];\n\t\t}\n\t}\n\n\tunmark(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.marks) {\n\t\t\titem = this.marks[cfiRange];\n\t\t\tthis.element.removeChild(item.element);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.marks[cfiRange];\n\t\t}\n\t}\n\n\tdestroy() {\n\n\t\tfor (let cfiRange in this.highlights) {\n\t\t\tthis.unhighlight(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.underlines) {\n\t\t\tthis.ununderline(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.marks) {\n\t\t\tthis.unmark(cfiRange);\n\t\t}\n\n\t\tif (this.blobUrl) {\n\t\t\trevokeBlobUrl(this.blobUrl);\n\t\t}\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\n\t\t\tthis.iframe = undefined;\n\t\t\tthis.contents = undefined;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t}\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n","import {uuid, isNumber, isElement, windowBounds} from \"../../utils/core\";\nimport throttle from 'lodash/throttle'\n\nclass Stage {\n\tconstructor(_options) {\n\t\tthis.settings = _options || {};\n\t\tthis.id = \"epubjs-container-\" + uuid();\n\n\t\tthis.container = this.create(this.settings);\n\n\t\tif(this.settings.hidden) {\n\t\t\tthis.wrapper = this.wrap(this.container);\n\t\t}\n\n\t}\n\n\t/*\n\t* Creates an element to render to.\n\t* Resizes to passed width and height or to the elements size\n\t*/\n\tcreate(options){\n\t\tlet height  = options.height;// !== false ? options.height : \"100%\";\n\t\tlet width   = options.width;// !== false ? options.width : \"100%\";\n\t\tlet overflow  = options.overflow || false;\n\t\tlet axis = options.axis || \"vertical\";\n\t\tlet direction = options.direction;\n\t\tlet scale = options.scale || 1.0;\n\n\t\tif(options.height && isNumber(options.height)) {\n\t\t\theight = options.height + \"px\";\n\t\t}\n\n\t\tif(options.width && isNumber(options.width)) {\n\t\t\twidth = options.width + \"px\";\n\t\t}\n\n\t\t// Create new container element\n\t\tlet container = document.createElement(\"div\");\n\n\t\tcontainer.id = this.id;\n\t\tcontainer.classList.add(\"epub-container\");\n\n\t\t// Style Element\n\t\t// container.style.fontSize = \"0\";\n\t\tcontainer.style.wordSpacing = \"0\";\n\t\tcontainer.style.lineHeight = \"0\";\n\t\tcontainer.style.verticalAlign = \"top\";\n\t\tcontainer.style.position = \"relative\";\n\n\t\tif(axis === \"horizontal\") {\n\t\t\t// container.style.whiteSpace = \"nowrap\";\n\t\t\tcontainer.style.display = \"flex\";\n\t\t\tcontainer.style.flexDirection = \"row\";\n\t\t\tcontainer.style.flexWrap = \"nowrap\";\n\t\t}\n\n\t\tif(width){\n\t\t\tcontainer.style.width = width;\n\t\t}\n\n\t\tif(height){\n\t\t\tcontainer.style.height = height;\n\t\t}\n\n\t\tif (overflow) {\n\t\t\tcontainer.style.overflow = overflow;\n\t\t}\n\n\t\tif (direction) {\n\t\t\tcontainer.dir = direction;\n\t\t\tcontainer.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (direction && this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (scale && scale != 1.0) {\n\t\t\tcontainer.style[\"transform-origin\"] = \"top left\";\n\t\t\tcontainer.style[\"transform\"] = \"scale(\" + scale + \")\";\n\t\t\tcontainer.style.overflow = \"auto\"; // \"visible\" breaks something?\n\t\t} else {\n\t\t\tcontainer.style[\"transform-origin\"] = null;\n\t\t\tcontainer.style[\"transform\"] = null;\n\t\t}\n\n\t\treturn container;\n\t}\n\n\twrap(container) {\n\t\tvar wrapper = document.createElement(\"div\");\n\n\t\twrapper.style.visibility = \"hidden\";\n\t\twrapper.style.overflow = \"hidden\";\n\t\twrapper.style.width = \"0\";\n\t\twrapper.style.height = \"0\";\n\n\t\twrapper.appendChild(container);\n\t\treturn wrapper;\n\t}\n\n\n\tgetElement(_element){\n\t\tvar element;\n\n\t\tif(isElement(_element)) {\n\t\t\telement = _element;\n\t\t} else if (typeof _element === \"string\") {\n\t\t\telement = document.getElementById(_element);\n\t\t}\n\n\t\tif(!element){\n\t\t\tthrow new Error(\"Not an Element\");\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tattachTo(what){\n\n\t\tvar element = this.getElement(what);\n\t\tvar base;\n\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.hidden) {\n\t\t\tbase = this.wrapper;\n\t\t} else {\n\t\t\tbase = this.container;\n\t\t}\n\n\t\telement.appendChild(base);\n\n\t\tthis.element = element;\n\n\t\treturn element;\n\n\t}\n\n\tgetContainer() {\n\t\treturn this.container;\n\t}\n\n\tonResize(func){\n\t\t// Only listen to window for resize event if width and height are not fixed.\n\t\t// This applies if it is set to a percent or auto.\n\t\tif(!isNumber(this.settings.width) ||\n\t\t\t !isNumber(this.settings.height) ) {\n\t\t\tthis.resizeFunc = throttle(func, 50);\n\t\t\twindow.addEventListener(\"resize\", this.resizeFunc, false);\n\t\t}\n\n\t}\n\n\tonOrientationChange(func){\n\t\tthis.orientationChangeFunc = func;\n\t\twindow.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\n\t}\n\n\tsize(width, height){\n\t\tvar bounds;\n\t\tlet _width = width || this.settings.width;\n\t\tlet _height = height || this.settings.height;\n\n\t\t// If width or height are set to false, inherit them from containing element\n\t\tif(width === null) {\n\t\t\tbounds = this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.width) {\n\t\t\t\twidth = Math.floor(bounds.width);\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.width = width;\n\t\t\t}\n\t\t}\n\n\t\tif(height === null) {\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.height) {\n\t\t\t\theight = bounds.height;\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.height = height;\n\t\t\t}\n\t\t}\n\n\t\tvar _round = function(value) {\n\t\t\treturn Math.round(value);\n\n\t\t\t// -- this calculates the closest even number to value\n\t\t\tvar retval = 2 * Math.round(value / 2);\n\t\t\tif ( retval > value ) {\n\t\t\t\tretval -= 2;\n\t\t\t}\n\t\t\treturn retval;\n\t\t}\n\n\t\tif(!isNumber(width)) {\n\t\t\tbounds = this.container.getBoundingClientRect();\n\t\t\twidth = _round(bounds.width); // Math.floor(bounds.width);\n\t\t\t//height = bounds.height;\n\t\t}\n\n\t\tif(!isNumber(height)) {\n\t\t\tbounds = bounds || this.container.getBoundingClientRect();\n\t\t\t//width = bounds.width;\n\t\t\theight = _round(bounds.height); // bounds.height;\n\t\t}\n\n\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\n\n\t\tthis.containerPadding = {\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\t// Bounds not set, get them from window\n\t\tlet _windowBounds = windowBounds();\n\t\tlet bodyStyles = window.getComputedStyle(document.body);\n\t\tlet bodyPadding = {\n\t\t\tleft: parseFloat(bodyStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(bodyStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(bodyStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\tif (!_width) {\n\t\t\twidth = _windowBounds.width -\n\t\t\t\t\t\t\t\tbodyPadding.left -\n\t\t\t\t\t\t\t\tbodyPadding.right;\n\t\t}\n\n\t\tif ((this.settings.fullsize && !_height) || !_height) {\n\t\t\theight = _windowBounds.height -\n\t\t\t\t\t\t\t\tbodyPadding.top -\n\t\t\t\t\t\t\t\tbodyPadding.bottom;\n\t\t}\n\n\t\tif ( this.settings.scale ) {\n\t\t\twidth /= this.settings.scale;\n\t\t\theight /= this.settings.scale;\n\t\t}\n\n\t\treturn {\n\t\t\twidth: width -\n\t\t\t\t\t\t\tthis.containerPadding.left -\n\t\t\t\t\t\t\tthis.containerPadding.right,\n\t\t\theight: height -\n\t\t\t\t\t\t\tthis.containerPadding.top -\n\t\t\t\t\t\t\tthis.containerPadding.bottom\n\t\t};\n\n\t}\n\n\tbounds(){\n\t\tlet box;\n\t\tif (this.container.style.overflow !== \"visible\") {\n\t\t\tbox = this.container && this.container.getBoundingClientRect();\n\t\t}\n\n\t\tif(!box || !box.width || !box.height) {\n\t\t\treturn windowBounds();\n\t\t} else {\n\t\t\treturn box;\n\t\t}\n\n\t}\n\n\tgetSheet(){\n\t\tvar style = document.createElement(\"style\");\n\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\t\tstyle.appendChild(document.createTextNode(\"\"));\n\n\t\tdocument.head.appendChild(style);\n\n\t\treturn style.sheet;\n\t}\n\n\taddStyleRules(selector, rulesArray){\n\t\tvar scope = \"#\" + this.id + \" \";\n\t\tvar rules = \"\";\n\n\t\tif(!this.sheet){\n\t\t\tthis.sheet = this.getSheet();\n\t\t}\n\n\t\trulesArray.forEach(function(set) {\n\t\t\tfor (var prop in set) {\n\t\t\t\tif(set.hasOwnProperty(prop)) {\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n\t}\n\n\taxis(axis) {\n\t\tif(axis === \"horizontal\") {\n\t\t\tthis.container.style.display = \"flex\";\n\t\t\tthis.container.style.flexDirection = \"row\";\n\t\t\tthis.container.style.flexWrap = \"nowrap\";\n\t\t} else {\n\t\t\tthis.container.style.display = \"block\";\n\t\t}\n\t}\n\n\t// orientation(orientation) {\n\t// \tif (orientation === \"landscape\") {\n\t//\n\t// \t} else {\n\t//\n\t// \t}\n\t//\n\t// \tthis.orientation = orientation;\n\t// }\n\n\tdirection(dir) {\n\t\tif (this.container) {\n\t\t\tthis.container.dir = dir;\n\t\t\tthis.container.style[\"direction\"] = dir;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\toverflow(overflow) {\n\t\tif (this.container) {\n\t\t\tthis.container.style[\"overflow\"] = overflow;\n\t\t}\n\t}\n\n\tscale(s) {\n\t\tif (this.container) {\n\t\t\tif ( s != 1.0 ) {\n\t\t\t\tthis._originalOverflow = this.container.style.overflow;\n\t\t\t\tthis.container.style[\"transform-origin\"] = \"top left\";\n\t\t\t\tthis.container.style[\"transform\"] = \"scale(\" + s + \")\";\n\t\t\t\tthis.container.style.overflow = \"auto\"; // \"visible\"\n\t\t\t} else {\n\t\t\t\tthis.container.style.overflow = this._originalOverflow;\n\t\t\t\tthis.container.style[\"transform-origin\"] = null;\n\t\t\t\tthis.container.style[\"transform\"] = null;\n\t\t\t}\n\t\t\tthis.settings.scale = s;\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tvar base;\n\n\t\tif (this.element) {\n\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tbase = this.wrapper;\n\t\t\t} else {\n\t\t\t\tbase = this.container;\n\t\t\t}\n\n\t\t\tif(this.element.contains(this.container)) {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\n\t\t\twindow.removeEventListener(\"resize\", this.resizeFunc);\n\t\t\twindow.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\n\n\t\t}\n\t}\n}\n\nexport default Stage;\n","class Views {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t}\n\n\tall() {\n\t\treturn this._views;\n\t}\n\n\tfirst() {\n\t\treturn this._views[0];\n\t}\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t}\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t}\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t}\n\n\tget(i) {\n\t\treturn this._views[i];\n\t}\n\n\tappend(view){\n\t\tthis._views.push(view);\n\t\tif(this.container){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t}\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\tif(this.container){\n\t\t\t this.container.removeChild(view.element);\n\t\t}\n\t\tview = null;\n\t}\n\n\t// Iterators\n\n\tforEach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t}\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t}\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t}\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t}\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t}\n}\n\nexport default Views;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber} from \"../../utils/core\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.optsSettings = options.settings;\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\taxis: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\tignoreClass: \"\",\n\t\t\tfullsize: undefined\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tprehooks: this.settings.prehooks,\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: true\n\t\t};\n\n\t\tthis.rendered = false;\n\n\t}\n\n\trender(element, size){\n\t\tlet tag = element.tagName;\n\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\n\t\t\t\ttag && (tag.toLowerCase() == \"body\" ||\n\t\t\t\ttag.toLowerCase() == \"html\")) {\n\t\t\t\tthis.settings.fullsize = true;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tthis.settings.overflow = \"visible\";\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.settings.size = size;\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis,\n\t\t\tfullsize: this.settings.fullsize,\n\t\t\tdirection: this.settings.direction,\n\t\t\tscale: this.settings.scale\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\n\t\tthis.rendered = true;\n\n\t}\n\n\taddEventListeners(){\n\t\tvar scroller;\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tdestroy(){\n\t\tclearTimeout(this.orientationTimeout);\n\t\tclearTimeout(this.resizeTimeout);\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.clear();\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.stage.destroy();\n\n\t\tthis.rendered = false;\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t}\n\n\tonOrientationChange(e) {\n\t\tlet {orientation} = window;\n\n\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\tthis.resize();\n\t\t}\n\n\t\t// Per ampproject:\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\n\t\t// element size depends on window size directly and the measurement\n\t\t// happens in window.resize event. Adding a timeout for correct\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\n\t\tclearTimeout(this.orientationTimeout);\n\t\tthis.orientationTimeout = setTimeout(function(){\n\t\t\tthis.orientationTimeout = undefined;\n\n\t\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\t\tthis.resize();\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n\t\t}.bind(this), 500);\n\n\t}\n\n\tonResized(e) {\n\t\tthis.resize();\n\t}\n\n\tresize(width, height){\n\t\tlet stageSize = this.stage.size(width, height);\n\n\t\t// For Safari, wait for orientation to catch up\n\t\t// if the window is a square\n\t\tthis.winBounds = windowBounds();\n\t\tif (this.orientationTimeout &&\n\t\t\t\tthis.winBounds.width === this.winBounds.height) {\n\t\t\t// reset the stage size for next resize\n\t\t\tthis._stageSize = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._stageSize &&\n\t\t\t\tthis._stageSize.width === stageSize.width &&\n\t\t\t\tthis._stageSize.height === stageSize.height ) {\n\t\t\t// Size is the same, no need to resize\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = stageSize;\n\n\t\tthis._bounds = this.bounds();\n\n\t\t// Clear current views\n\t\tthis.clear();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\n\t\t\twidth: this._stageSize.width,\n\t\t\theight: this._stageSize.height\n\t\t});\n\t}\n\n\tcreateView(section) {\n\t\treturn new this.View(section, this.viewSettings);\n\t}\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check if moving to target is needed\n\t\tif (target === section.href || isNumber(target)) {\n\t\t\ttarget = undefined;\n\t\t}\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location in view\n\t\tif(visible && section) {\n\t\t\tlet offset = visible.offset();\n\n\t\t\tif (this.settings.direction === \"ltr\") {\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\n\t\t\t} else {\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\n\t\t\t}\n\n\t\t\tif(target) {\n\t\t\t\tlet offset = visible.locationOf(target);\n\t\t\t\tthis.moveTo(offset);\n\t\t\t}\n\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.clear();\n\n\t\tthis.add(section)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\tlet offset = view.locationOf(target);\n\t\t\t\t\tthis.moveTo(offset);\n\t\t\t\t\tview.__target = { target: target, offset: offset };\n\t\t\t\t}\n\n\t\t\t}.bind(this), (err) => {\n\t\t\t\tdisplaying.reject(err);\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tvar next;\n\t\t\t\tif (this.layout.name === \"pre-paginated\" &&\n\t\t\t\t\t\tthis.layout.divisor > 1 && section.index > 0) {\n\t\t\t\t\t// First page (cover) should stand alone for pre-paginated books\n\t\t\t\t\tnext = section.next();\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\treturn this.add(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this));\n\t\t// .then(function(){\n\t\t// \treturn this.hooks.display.trigger(view);\n\t\t// }.bind(this))\n\t\t// .then(function(){\n\t\t// \tthis.views.show();\n\t\t// }.bind(this));\n\t\treturn displayed;\n\t}\n\n\tafterDisplayed(view){\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\n\t}\n\n\tafterResized(view){\n\t\tif ( view.__target ) {\n\t\t\tlet offset = view.locationOf(view.__target.target);\n\t\t\tif ( offset.left != view.__target.offset.left && offset.top != view.__target.offset.top ) {\n\t\t\t\tthis.moveTo(offset, false);\n\t\t\t}\n\t\t\tview.__target = undefined;\n\t\t}\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\tmoveTo(offset, silent=true){\n\t\tvar distX = 0,\n\t\t\t  distY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\t\t}\n\t\tthis.scrollTo(distX, distY, silent);\n\t}\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\n\t}\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar left;\n\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top  = this.container.scrollTop + this.container.offsetHeight;\n\n\t\t\tif(top < this.container.scrollHeight) {\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else {\n\t\t\tnext = this.views.last().section.next();\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.clear();\n\n\t\t\treturn this.append(next)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar right;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tright = next.next();\n\t\t\t\t\t\tif (right) {\n\t\t\t\t\t\t\treturn this.append(right);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t}\n\n\tprev(){\n\t\tvar prev;\n\t\tvar left;\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top = this.container.scrollTop;\n\n\t\t\tif(top > 0) {\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.clear();\n\n\t\t\treturn this.prepend(prev)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear () {\n\n\t\t// this.q.clear();\n\n\t\tif (this.views) {\n\t\t\tthis.views.hide();\n\t\t\tthis.scrollTo(0,0, true);\n\t\t\tthis.views.clear();\n\t\t}\n\t}\n\n\tcurrentLocation(){\n\n\t\tif (this.settings.axis === \"vertical\") {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t} else {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t}\n\t\treturn this.location;\n\t}\n\n\tscrolledLocation() {\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\t\tlet pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\n\t\tlet offset = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\toffset = window.scrollY;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet position = view.position();\n\t\t\tlet height = view.height();\n\n\t\t\tlet startPos = offset + container.top - position.top + used;\n\t\t\tlet endPos = startPos + pageHeight - used;\n\t\t\tif (endPos > height) {\n\t\t\t\tendPos = height;\n\t\t\t\tused = (endPos - startPos);\n\t\t\t}\n\n\t\t\tlet totalPages = this.layout.count(height, pageHeight).pages;\n\n\t\t\tlet currPage = Math.ceil(startPos / pageHeight);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.ceil(endPos / pageHeight);\n\n\t\t\tpages = [];\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\n\t\t\t\tlet pg = i + 1;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tpaginatedLocation(){\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\n\t\tlet left = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\tleft = window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet offset = view.offset().left;\n\t\t\tlet position = view.position().left;\n\t\t\tlet width = view.width();\n\n\t\t\t// Find mapping\n\t\t\tlet start = left + container.left - position + used;\n\t\t\tlet end = start + this.layout.width - used;\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n\n\t\t\t// Find displayed pages\n\t\t\t//console.log(\"pre\", end, offset + width);\n\t\t\t// if (end > offset + width) {\n\t\t\t// \tend = offset + width;\n\t\t\t// \tused = this.layout.pageWidth;\n\t\t\t// }\n\t\t\t// console.log(\"post\", end);\n\n\t\t\tlet totalPages = this.layout.count(width).pages;\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\n\n\t\t\t// start page should not be negative\n\t\t\tif (startPage < 0) {\n\t\t\t\tstartPage = 0;\n\t\t\t\tendPage = endPage + 1;\n\t\t\t}\n\n\t\t\t// Reverse page counts for rtl\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\tlet tempStartPage = startPage;\n\t\t\t\tstartPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\n\t\t\t\tlet pg = i;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvisible(){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t}\n\n\tscrollBy(x, y, silent){\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tif(x) this.container.scrollLeft += x * dir;\n\t\t\tif(y) this.container.scrollTop += y;\n\t\t} else {\n\t\t\twindow.scrollBy(x * dir, y * dir);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY;\n\t\t\tscrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\t\ttop: scrollTop,\n\t\t\t\tleft: scrollLeft\n\t\t\t});\n\n\t\t\tclearTimeout(this.afterScrolled);\n\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t});\n\t\t\t}.bind(this), 20);\n\n\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t}\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t}\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\t\t // this.manager.layout(this.layout.format);\n\t}\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(!this.isPaginated) {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta;\n\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\t}\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.forEach(function(view){\n\t\t\t\tif (view) {\n\t\t\t\t\tview.setLayout(layout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tupdateAxis(axis, forceUpdate){\n\n\t\tif (!this.isPaginated) {\n\t\t\taxis = \"vertical\";\n\t\t}\n\n\t\tif (!forceUpdate && axis === this.settings.axis) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.stage && this.stage.axis(axis);\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tif (this.mapping) {\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n\t\t}\n\n\t\tif (this.layout) {\n\t\t\tif (axis === \"vertical\") {\n\t\t\t\tthis.layout.spread(\"none\");\n\t\t\t} else {\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFlow(flow){\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\n\n\t\tthis.isPaginated = isPaginated;\n\n\t\tif (flow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\tflow === \"scrolled\") {\n\t\t\tthis.updateAxis(\"vertical\");\n\t\t} else {\n\t\t\tthis.updateAxis(\"horizontal\");\n\t\t}\n\n\t\tthis.viewSettings.flow = flow;\n\n\t\tif (!this.settings.overflow) {\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : \"auto\";\n\t\t} else {\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.stage && this.stage.overflow(this.overflow);\n\n\t\tthis.updateLayout();\n\n\t}\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tif (!this.views) {\n\t\t\treturn contents;\n\t\t}\n\t\tthis.views.forEach(function(view){\n\t\t\tconst viewContents = view && view.contents;\n\t\t\tif (viewContents) {\n\t\t\t\tcontents.push(viewContents);\n\t\t\t}\n\t\t});\n\t\treturn contents;\n\t}\n\n\tdirection(dir=\"ltr\") {\n\t\tthis.settings.direction = dir;\n\n\t\tthis.stage && this.stage.direction(dir);\n\n\t\tthis.viewSettings.direction = dir;\n\n\t\tthis.updateLayout();\n\t}\n\n\tisRendered() {\n\t\treturn this.rendered;\n\t}\n\n\tscale(s) {\n\t\tif ( s == null ) { s = 1.0; }\n\t\tthis.settings.scale = s;\n\n\t\tif (this.stage) {\n\t\t\tthis.stage.scale(s);\n\t\t}\n\t}\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n","import {extend, defer, requestAnimationFrame, prefixed} from \"../../utils/core\";\nimport { EVENTS, DOM_EVENTS } from \"../../utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n// easing equations from https://github.com/danro/easing-js/blob/master/easing.js\nconst PI_D2 = (Math.PI / 2);\nconst EASING_EQUATIONS = {\n\t\teaseOutSine: function (pos) {\n\t\t\t\treturn Math.sin(pos * PI_D2);\n\t\t},\n\t\teaseInOutSine: function (pos) {\n\t\t\t\treturn (-0.5 * (Math.cos(Math.PI * pos) - 1));\n\t\t},\n\t\teaseInOutQuint: function (pos) {\n\t\t\t\tif ((pos /= 0.5) < 1) {\n\t\t\t\t\t\treturn 0.5 * Math.pow(pos, 5);\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (Math.pow((pos - 2), 5) + 2);\n\t\t},\n\t\teaseInCubic: function(pos) {\n\t\t\treturn Math.pow(pos, 3);\n  \t}\n};\n\nclass Snap {\n\tconstructor(manager, options) {\n\n\t\tthis.settings = extend({\n\t\t\tduration: 80,\n\t\t\tminVelocity: 0.2,\n\t\t\tminDistance: 10,\n\t\t\teasing: EASING_EQUATIONS['easeInCubic']\n\t\t}, options || {});\n\n\t\tthis.supportsTouch = this.supportsTouch();\n\n\t\tif (this.supportsTouch) {\n\t\t\tthis.setup(manager);\n\t\t}\n\t}\n\n\tsetup(manager) {\n\t\tthis.manager = manager;\n\n\t\tthis.layout = this.manager.layout;\n\n\t\tthis.fullsize = this.manager.settings.fullsize;\n\t\tif (this.fullsize) {\n\t\t\tthis.element = this.manager.stage.element;\n\t\t\tthis.scroller = window;\n\t\t\tthis.disableScroll();\n\t\t} else {\n\t\t\tthis.element = this.manager.stage.container;\n\t\t\tthis.scroller = this.element;\n\t\t\tthis.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\n\t\t}\n\n\t\t// this.overflow = this.manager.overflow;\n\n\t\t// set lookahead offset to page width\n\t\tthis.manager.settings.offset = this.layout.width;\n\t\tthis.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\n\n\t\tthis.isVertical = this.manager.settings.axis === \"vertical\";\n\n\t\t// disable snapping if not paginated or axis in not horizontal\n\t\tif (!this.manager.isPaginated || this.isVertical) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.touchCanceler = false;\n\t\tthis.resizeCanceler = false;\n\t\tthis.snapping = false;\n\n\n\t\tthis.scrollLeft;\n\t\tthis.scrollTop;\n\n\t\tthis.startTouchX = undefined;\n\t\tthis.startTouchY = undefined;\n\t\tthis.startTime = undefined;\n\t\tthis.endTouchX = undefined;\n\t\tthis.endTouchY = undefined;\n\t\tthis.endTime = undefined;\n\n\t\tthis.addListeners();\n\t}\n\n\tsupportsTouch() {\n\t\tif (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tdisableScroll() {\n\t\tthis.element.style.overflow = \"hidden\";\n\t}\n\n\tenableScroll() {\n\t\tthis.element.style.overflow = \"\";\n\t}\n\n\taddListeners() {\n\t\tthis._onResize = this.onResize.bind(this);\n\t\twindow.addEventListener('resize', this._onResize);\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tthis.scroller.addEventListener('scroll', this._onScroll);\n\n\t\tthis._onTouchStart = this.onTouchStart.bind(this);\n\t\tthis.scroller.addEventListener('touchstart', this._onTouchStart, { passive: true });\n\t\tthis.on('touchstart', this._onTouchStart);\n\n\t\tthis._onTouchMove = this.onTouchMove.bind(this);\n\t\tthis.scroller.addEventListener('touchmove', this._onTouchMove, { passive: true });\n\t\tthis.on('touchmove', this._onTouchMove);\n\n\t\tthis._onTouchEnd = this.onTouchEnd.bind(this);\n\t\tthis.scroller.addEventListener('touchend', this._onTouchEnd, { passive: true });\n\t\tthis.on('touchend', this._onTouchEnd);\n\n\t\tthis._afterDisplayed = this.afterDisplayed.bind(this);\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n\t}\n\n\tremoveListeners() {\n\t\twindow.removeEventListener('resize', this._onResize);\n\t\tthis._onResize = undefined;\n\n\t\tthis.scroller.removeEventListener('scroll', this._onScroll);\n\t\tthis._onScroll = undefined;\n\n\t\tthis.scroller.removeEventListener('touchstart', this._onTouchStart, { passive: true });\n\t\tthis.off('touchstart', this._onTouchStart);\n\t\tthis._onTouchStart = undefined;\n\n\t\tthis.scroller.removeEventListener('touchmove', this._onTouchMove, { passive: true });\n\t\tthis.off('touchmove', this._onTouchMove);\n\t\tthis._onTouchMove = undefined;\n\n\t\tthis.scroller.removeEventListener('touchend', this._onTouchEnd, { passive: true });\n\t\tthis.off('touchend', this._onTouchEnd);\n\t\tthis._onTouchEnd = undefined;\n\n\t\tthis.manager.off(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n\t\tthis._afterDisplayed = undefined;\n\t}\n\n\tafterDisplayed(view) {\n\t\tlet contents = view.contents;\n\t\t[\"touchstart\", \"touchmove\", \"touchend\"].forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\t}\n\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\tonScroll(e) {\n\t\tthis.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\n\t\tthis.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\n\t}\n\n\tonResize(e) {\n\t\tthis.resizeCanceler = true;\n\t}\n\n\tonTouchStart(e) {\n\t\tlet { screenX, screenY } = e.touches[0];\n\n\t\tif (this.fullsize) {\n\t\t\tthis.enableScroll();\n\t\t}\n\n\t\tthis.touchCanceler = true;\n\n\t\tif (!this.startTouchX) {\n\t\t\tthis.startTouchX = screenX;\n\t\t\tthis.startTouchY = screenY;\n\t\t\tthis.startTime = this.now();\n\t\t}\n\n\t\tthis.endTouchX = screenX;\n\t\tthis.endTouchY = screenY;\n\t\tthis.endTime = this.now();\n\t}\n\n\tonTouchMove(e) {\n\t\tlet { screenX, screenY } = e.touches[0];\n\t\tlet deltaY = Math.abs(screenY - this.endTouchY);\n\n\t\tthis.touchCanceler = true;\n\n\n\t\tif (!this.fullsize && deltaY < 10) {\n\t\t\tthis.element.scrollLeft -= screenX - this.endTouchX;\n\t\t}\n\n\t\tthis.endTouchX = screenX;\n\t\tthis.endTouchY = screenY;\n\t\tthis.endTime = this.now();\n\t}\n\n\tonTouchEnd(e) {\n\t\tif (this.fullsize) {\n\t\t\tthis.disableScroll();\n\t\t}\n\n\t\tthis.touchCanceler = false;\n\n\t\tlet swipped = this.wasSwiped();\n\n\t\tif (swipped !== 0) {\n\t\t\tthis.snap(swipped);\n\t\t} else {\n\t\t\tthis.snap();\n\t\t}\n\n\t\tthis.startTouchX = undefined;\n\t\tthis.startTouchY = undefined;\n\t\tthis.startTime = undefined;\n\t\tthis.endTouchX = undefined;\n\t\tthis.endTouchY = undefined;\n\t\tthis.endTime = undefined;\n\t}\n\n\twasSwiped() {\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\tlet distance = (this.endTouchX - this.startTouchX);\n\t\tlet absolute = Math.abs(distance);\n\t\tlet time = this.endTime - this.startTime;\n\t\tlet velocity = (distance / time);\n\t\tlet minVelocity = this.settings.minVelocity;\n\n\t\tif (absolute <= this.settings.minDistance || absolute >= snapWidth) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (velocity > minVelocity) {\n\t\t\t// previous\n\t\t\treturn -1;\n\t\t} else if (velocity < -minVelocity) {\n\t\t\t// next\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\tneedsSnap() {\n\t\tlet left = this.scrollLeft;\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\treturn (left % snapWidth) !== 0;\n\t}\n\n\tsnap(howMany=0) {\n\t\tlet left = this.scrollLeft;\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\tlet snapTo = Math.round(left / snapWidth) * snapWidth;\n\n\t\tif (howMany) {\n\t\t\tsnapTo += (howMany * snapWidth);\n\t\t}\n\n\t\treturn this.smoothScrollTo(snapTo);\n\t}\n\n\tsmoothScrollTo(destination) {\n\t\tconst deferred = new defer();\n\t\tconst start = this.scrollLeft;\n\t\tconst startTime = this.now();\n\n\t\tconst duration = this.settings.duration;\n\t\tconst easing = this.settings.easing;\n\n\t\tthis.snapping = true;\n\n\t\t// add animation loop\n\t\tfunction tick() {\n\t\t\tconst now = this.now();\n\t\t\tconst time = Math.min(1, ((now - startTime) / duration));\n\t\t\tconst timeFunction = easing(time);\n\n\n\t\t\tif (this.touchCanceler || this.resizeCanceler) {\n\t\t\t\tthis.resizeCanceler = false;\n\t\t\t\tthis.snapping = false;\n\t\t\t\tdeferred.resolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (time < 1) {\n\t\t\t\t\twindow.requestAnimationFrame(tick.bind(this));\n\t\t\t\t\tthis.scrollTo(start + ((destination - start) * time), 0);\n\t\t\t} else {\n\t\t\t\t\tthis.scrollTo(destination, 0);\n\t\t\t\t\tthis.snapping = false;\n\t\t\t\t\tdeferred.resolve();\n\t\t\t}\n\t\t}\n\n\t\ttick.call(this);\n\n\t\treturn deferred.promise;\n\t}\n\n\tscrollTo(left=0, top=0) {\n\t\tif (this.fullsize) {\n\t\t\twindow.scroll(left, top);\n\t\t} else {\n\t\t\tthis.scroller.scrollLeft = left;\n\t\t\tthis.scroller.scrollTop = top;\n\t\t}\n\t}\n\n\tnow() {\n\t\treturn ('now' in window.performance) ? performance.now() : new Date().getTime();\n\t}\n\n\tdestroy() {\n\t\tif (!this.scroller) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.fullsize) {\n\t\t\tthis.enableScroll();\n\t\t}\n\n\t\tthis.removeListeners();\n\n\t\tthis.scroller = undefined;\n\t}\n}\n\nEventEmitter(Snap.prototype);\n\nexport default Snap;\n","import {extend, defer, requestAnimationFrame} from \"../../utils/core\";\nimport DefaultViewManager from \"../default\";\nimport Snap from \"../helpers/snap\";\nimport { EVENTS } from \"../../utils/constants\";\nimport debounce from \"lodash/debounce\";\n\nclass ContinuousViewManager extends DefaultViewManager {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.name = \"continuous\";\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\toverflow: undefined,\n\t\t\taxis: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\toffset: 500,\n\t\t\toffsetDelta: 250,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsnap: false,\n\t\t\tafterScrolledTimeout: 10\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\t// Gap can be 0, but defaults doesn't handle that\n\t\tif (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\n\t\t\tthis.settings.gap = options.settings.gap;\n\t\t}\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: false\n\t\t};\n\n\t\tthis.scrollTop = 0;\n\t\tthis.scrollLeft = 0;\n\t}\n\n\tdisplay(section, target){\n\t\treturn DefaultViewManager.prototype.display.call(this, section, target)\n\t\t\t.then(function () {\n\t\t\t\treturn this.fill();\n\t\t\t}.bind(this));\n\t}\n\n\tfill(_full){\n\t\tvar full = _full || new defer();\n\n\t\tthis.q.enqueue(() => {\n\t\t\treturn this.check();\n\t\t}).then((result) => {\n\t\t\tif (result) {\n\t\t\t\tthis.fill(full);\n\t\t\t} else {\n\t\t\t\tfull.resolve();\n\t\t\t}\n\t\t});\n\n\t\treturn full.promise;\n\t}\n\n\tmoveTo(offset){\n\t\t// var bounds = this.stage.bounds();\n\t\t// var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tvar offsetX = 0,\n\t\t\t\toffsetY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t\toffsetY = offset.top+this.settings.offsetDelta;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\t\t\toffsetX = distX+this.settings.offsetDelta;\n\t\t}\n\n\t\tif (distX > 0 || distY > 0) {\n\t\t\tthis.scrollBy(distX, distY, true);\n\t\t}\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\t// Remove Previous Listeners if present\n\tremoveShownListeners(view){\n\n\t\t// view.off(\"shown\", this.afterDisplayed);\n\t\t// view.off(\"shown\", this.afterDisplayedAbove);\n\t\tview.onDisplayed = function(){};\n\n\t}\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\treturn view.display(this.request);\n\t}\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\n\t\treturn view;\n\t}\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\n\t\treturn view;\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\tupdate(_offset){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.all();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tvar updating = new defer();\n\t\tvar promises = [];\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\n\t\t\tisVisible = this.isVisible(view, offset, offset, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\t// console.log(\"visible \" + view.index);\n\n\t\t\t\tif (!view.displayed) {\n\t\t\t\t\tlet displayed = view.display(this.request)\n\t\t\t\t\t\t.then(function (view) {\n\t\t\t\t\t\t\tview.show();\n\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\tview.hide();\n\t\t\t\t\t\t});\n\t\t\t\t\tpromises.push(displayed);\n\t\t\t\t} else {\n\t\t\t\t\tview.show();\n\t\t\t\t}\n\t\t\t\tvisible.push(view);\n\t\t\t} else {\n\t\t\t\tthis.q.enqueue(view.destroy.bind(view));\n\t\t\t\t// console.log(\"hidden \" + view.index);\n\n\t\t\t\tclearTimeout(this.trimTimeout);\n\t\t\t\tthis.trimTimeout = setTimeout(function(){\n\t\t\t\t\tthis.q.enqueue(this.trim.bind(this));\n\t\t\t\t}.bind(this), 250);\n\t\t\t}\n\n\t\t}\n\n\t\tif(promises.length){\n\t\t\treturn Promise.all(promises)\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tupdating.reject(err);\n\t\t\t\t});\n\t\t} else {\n\t\t\tupdating.resolve();\n\t\t\treturn updating.promise;\n\t\t}\n\n\t}\n\n\tcheck(_offsetLeft, _offsetTop){\n\t\tvar checking = new defer();\n\t\tvar newViews = [];\n\n\t\tvar horizontal = (this.settings.axis === \"horizontal\");\n\t\tvar delta = this.settings.offset || 0;\n\n\t\tif (_offsetLeft && horizontal) {\n\t\t\tdelta = _offsetLeft;\n\t\t}\n\n\t\tif (_offsetTop && !horizontal) {\n\t\t\tdelta = _offsetTop;\n\t\t}\n\n\t\tvar bounds = this._bounds; // bounds saved this until resize\n\n\t\tlet rtl = this.settings.direction === \"rtl\";\n\t\tlet dir = horizontal && rtl ? -1 : 1; //RTL reverses scrollTop\n\n\t\tvar offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n\t\tvar visibleLength = horizontal ? Math.floor(bounds.width) : bounds.height;\n\t\tvar contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n\t\tlet prepend = () => {\n\t\t\tlet first = this.views.first();\n\t\t\tlet prev = first && first.section.prev();\n\n\t\t\tif(prev) {\n\t\t\t\tnewViews.push(this.prepend(prev));\n\t\t\t}\n\t\t};\n\n\t\tlet append = () => {\n\t\t\tlet last = this.views.last();\n\t\t\tlet next = last && last.section.next();\n\n\t\t\tif(next) {\n\t\t\t\tnewViews.push(this.append(next));\n\t\t\t}\n\n\t\t};\n\n\t\tif (offset + visibleLength + delta >= contentLength) {\n\t\t\tif (horizontal && rtl) {\n\t\t\t\tprepend();\n\t\t\t} else {\n\t\t\t\tappend();\n\t\t\t}\n\t\t}\n\n\t\tif (offset - delta < 0 ) {\n\t\t\tif (horizontal && rtl) {\n\t\t\t\tappend();\n\t\t\t} else {\n\t\t\t\tprepend();\n\t\t\t}\n\t\t}\n\n\t\tlet promises = newViews.map((view) => {\n\t\t\treturn view.displayed;\n\t\t});\n\n\t\tif(newViews.length){\n\t\t\treturn Promise.all(promises)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.props.spread) {\n\t\t\t\t\t\treturn this.check();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\t// Check to see if anything new is on screen after rendering\n\t\t\t\t\treturn this.update(delta);\n\t\t\t\t}, (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.q.enqueue(function(){\n\t\t\t\tthis.update();\n\t\t\t}.bind(this));\n\t\t\tchecking.resolve(false);\n\t\t\treturn checking.promise;\n\t\t}\n\n\n\t}\n\n\ttrim(){\n\t\tvar task = new defer();\n\t\tvar displayed = this.views.displayed();\n\t\tvar first = displayed[0];\n\t\tvar last = displayed[displayed.length-1];\n\t\tvar firstIndex = this.views.indexOf(first);\n\t\tvar lastIndex = this.views.indexOf(last);\n\t\tvar above = this.views.slice(0, firstIndex);\n\t\tvar below = this.views.slice(lastIndex+1);\n\n\t\t// Erase all but last above\n\t\tfor (var i = 0; i < above.length-1; i++) {\n\t\t\tthis.erase(above[i], above);\n\t\t}\n\n\t\t// Erase all except first below\n\t\tfor (var j = 1; j < below.length; j++) {\n\t\t\tthis.erase(below[j]);\n\t\t}\n\n\t\ttask.resolve();\n\t\treturn task.promise;\n\t}\n\n\terase(view, above){ //Trim\n\n\t\tvar prevTop;\n\t\tvar prevLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tprevTop = this.container.scrollTop;\n\t\t\tprevLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tprevTop = window.scrollY;\n\t\t\tprevLeft = window.scrollX;\n\t\t}\n\n\t\tvar bounds = view.bounds();\n\n\t\tthis.views.remove(view);\n\n\t\tif(above) {\n\t\t\tif(this.settings.axis === \"vertical\") {\n\t\t\t\tthis.scrollTo(0, prevTop - bounds.height, true);\n\t\t\t} else {\n\t\t\t\tthis.scrollTo(prevLeft - Math.floor(bounds.width), 0, true);\n\t\t\t}\n\t\t}\n\n\t}\n\n\taddEventListeners(stage){\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.ignore = true;\n\t\t\t// this.scrollTo(0,0);\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tthis.addScrollListeners();\n\n\t\tif (this.isPaginated && this.settings.snap) {\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\n\t\t}\n\t}\n\n\taddScrollListeners() {\n\t\tvar scroller;\n\n\t\tthis.tick = requestAnimationFrame;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.prevScrollTop = this.container.scrollTop;\n\t\t\tthis.prevScrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tthis.prevScrollTop = window.scrollY;\n\t\t\tthis.prevScrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollDeltaVert = 0;\n\t\tthis.scrollDeltaHorz = 0;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t\tthis.scrollTop = window.scrollY;\n\t\t\tthis.scrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t\tthis._scrolled = debounce(this.scrolled.bind(this), 30);\n\t\t// this.tick.call(window, this.onScroll.bind(this));\n\n\t\tthis.didScroll = false;\n\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY * dir;\n\t\t\tscrollLeft = window.scrollX * dir;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\n\t\t\tthis._scrolled();\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t\tthis.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n\t\tthis.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n\t\tthis.prevScrollTop = scrollTop;\n\t\tthis.prevScrollLeft = scrollLeft;\n\n\t\tclearTimeout(this.scrollTimeout);\n\t\tthis.scrollTimeout = setTimeout(function(){\n\t\t\tthis.scrollDeltaVert = 0;\n\t\t\tthis.scrollDeltaHorz = 0;\n\t\t}.bind(this), 150);\n\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.didScroll = false;\n\n\t}\n\n\tscrolled() {\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\n\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\ttop: this.scrollTop,\n\t\t\tleft: this.scrollLeft\n\t\t});\n\n\t\tclearTimeout(this.afterScrolled);\n\t\tthis.afterScrolled = setTimeout(function () {\n\n\t\t\t// Don't report scroll if we are about the snap\n\t\t\tif (this.snapper && this.snapper.supportsTouch && this.snapper.needsSnap()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\ttop: this.scrollTop,\n\t\t\t\tleft: this.scrollLeft\n\t\t\t});\n\n\t\t}.bind(this), this.settings.afterScrolledTimeout);\n\t}\n\n\tnext(){\n\n\t\tlet dir = this.settings.direction;\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\n\t\t\t\t\t\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollBy(delta, 0, true);\n\n\t\t} else {\n\n\t\t\tthis.scrollBy(0, this.layout.height, true);\n\n\t\t}\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\t}\n\n\tprev(){\n\n\t\tlet dir = this.settings.direction;\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\n\t\t\t\t\t\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollBy(-delta, 0, true);\n\n\t\t} else {\n\n\t\t\tthis.scrollBy(0, -this.layout.height, true);\n\n\t\t}\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\t}\n\n\t// updateAxis(axis, forceUpdate){\n\t//\n\t// \tsuper.updateAxis(axis, forceUpdate);\n\t//\n\t// \tif (axis === \"vertical\") {\n\t// \t\tthis.settings.infinite = true;\n\t// \t} else {\n\t// \t\tthis.settings.infinite = false;\n\t// \t}\n\t// }\n\n\tupdateFlow(flow){\n\t\tif (this.rendered && this.snapper) {\n\t\t\tthis.snapper.destroy();\n\t\t\tthis.snapper = undefined;\n\t\t}\n\n\t\tsuper.updateFlow(flow);\n\n\t\tif (this.rendered && this.isPaginated && this.settings.snap) {\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\n\t\t}\n\t}\n\n\tdestroy(){\n\t\tsuper.destroy();\n\n\t\tif (this.snapper) {\n\t\t\tthis.snapper.destroy();\n\t\t}\n\t}\n\n}\n\nexport default ContinuousViewManager;\n","import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: \"\",\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800,\n\t\t\tstylesheet: null,\n\t\t\tresizeOnOrientationChange: true,\n\t\t\tscript: null,\n\t\t\tsnap: false\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.book = book;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @member {object} hooks\n\t\t * @property {Hook} hooks.content\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.unloaded = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\n\n\t\tthis.injected = {};\n\t\tthis.injected['identifier'] = this.injectIdentifier.bind(this);\n\t\tthis.book.spine.hooks.content.register(this.injected['identifier']);\n\n\t\tif (this.settings.stylesheet) {\n\t\t\tthis.injected['stylesheet'] = this.injectStylesheet.bind(this);\n\t\t\tthis.book.spine.hooks.content.register(this.injected['stylesheet']);\n\t\t}\n\n\t\tif (this.settings.script) {\n\t\t\tthis.injected['script'] = this.injectScript.bind(this);\n\t\t\tthis.book.spine.hooks.content.register(this.injected['script']);\n\t\t}\n\n\t\t/**\n\t\t * @member {Themes} themes\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.themes = new Themes(this);\n\n\t\t/**\n\t\t * @member {Annotations} annotations\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.annotations = new Annotations(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\t/**\n\t\t * A Rendered Location Range\n\t\t * @typedef location\n\t\t * @type {Object}\n\t\t * @property {object} start\n\t\t * @property {string} start.index\n\t\t * @property {string} start.href\n\t\t * @property {object} start.displayed\n\t\t * @property {EpubCFI} start.cfi\n\t\t * @property {number} start.location\n\t\t * @property {number} start.percentage\n\t\t * @property {number} start.displayed.page\n\t\t * @property {number} start.displayed.total\n\t\t * @property {object} end\n\t\t * @property {string} end.index\n\t\t * @property {string} end.href\n\t\t * @property {object} end.displayed\n\t\t * @property {EpubCFI} end.cfi\n\t\t * @property {number} end.location\n\t\t * @property {number} end.percentage\n\t\t * @property {number} end.displayed.page\n\t\t * @property {number} end.displayed.total\n\t\t * @property {boolean} atStart\n\t\t * @property {boolean} atEnd\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.location = undefined;\n\n\t\t// Hold queue until book is opened\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\tthis.starting = new defer();\n\t\t/**\n\t\t * @member {promise} started returns after the rendition has started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.started = this.starting.promise;\n\t\t// Block the queue until rendering is started\n\t\tthis.q.enqueue(this.start);\n\t}\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t}\n\n\t/**\n\t * Require the manager from passed string, or as a class function\n\t * @param  {string|object} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from imported managers\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\n\t\t\tviewManager = DefaultViewManager;\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\n\t\t\tviewManager = ContinuousViewManager;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tviewManager = manager;\n\t\t}\n\n\t\treturn viewManager;\n\t}\n\n\t/**\n\t * Require the view from passed string, or as a class function\n\t * @param  {string|object} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\t// If view is a string, try to load from imported views,\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\n\t\t\tView = IframeView;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tView = view;\n\t\t}\n\n\t\treturn View;\n\t}\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\tthis.direction(this.book.package.metadata.direction);\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n\t\t// Listen for rotation\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n\t\t/**\n\t\t * Emit that rendering has started\n\t\t * @event started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t}\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Emit that rendering has attached to an element\n\t\t\t * @event attached\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\n\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\t\tif (this.displaying) {\n\t\t\tthis.displaying.resolve();\n\t\t}\n\t\treturn this.q.enqueue(this._display, target);\n\t}\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tif (!this.book) {\n\t\t\treturn;\n\t\t}\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\tthis.displaying = displaying;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length() && isFloat(target)) {\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\tthis.manager.display(section, target)\n\t\t\t.then(() => {\n\t\t\t\tdisplaying.resolve(section);\n\t\t\t\tthis.displaying = undefined;\n\n\t\t\t\t/**\n\t\t\t\t * Emit that a section has been displayed\n\t\t\t\t * @event displayed\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\n\t\t\t\tthis.reportLocation();\n\t\t\t}, (err) => {\n\t\t\t\t/**\n\t\t\t\t * Emit that has been an error displaying\n\t\t\t\t * @event displayError\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n\t\t\t});\n\n\t\treturn displayed;\n\t}\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t}\n\t*/\n\n\t/**\n\t * Report what section has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view));\n\n\t\tthis.hooks.render.trigger(view, this)\n\t\t\t.then(() => {\n\t\t\t\tif (view.contents) {\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Emit that a section has been rendered\n\t\t\t\t\t\t * @event rendered\n\t\t\t\t\t\t * @param {Section} section\n\t\t\t\t\t\t * @param {View} view\n\t\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t\t */\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Report what has been removed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterRemoved(view){\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\n\t\t\t/**\n\t\t\t * Emit that a section has been removed\n\t\t\t * @event removed\n\t\t\t * @param {Section} section\n\t\t\t * @param {View} view\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n\t\t});\n\t}\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size){\n\n\t\t/**\n\t\t * Emit that the rendition has been resized\n\t\t * @event resized\n\t\t * @param {number} width\n\t\t * @param {height} height\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t});\n\n\t\tif (this.location && this.location.start) {\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\n\t}\n\n\t/**\n\t * Report orientation events and display the last seen location\n\t * @private\n\t */\n\tonOrientationChange(orientation){\n\t\t/**\n\t\t * Emit that the rendition has been rotated\n\t\t * @event orientationchange\n\t\t * @param {string} orientation\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n\t}\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t}\n\n\t/**\n\t * Trigger a resize of the views\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tresize(width, height){\n\t\tif (width) {\n\t\t\tthis.settings.width = width;\n\t\t}\n\t\tif (height) {\n\t\t\tthis.settings.height = height;\n\t\t}\n\t\tthis.manager.resize(width, height);\n\t}\n\n\t/**\n\t * Clear all rendered views\n\t */\n\tclear(){\n\t\tthis.manager.clear();\n\t}\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\n\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\n\t\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth,\n\t\t\tdirection: direction\n\t\t};\n\n\t\treturn properties;\n\t}\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled\" ||\n\t\t\t\tflow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tthis.settings.flow = flow;\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\t// this.mapping = new Mapping(this._layout.props);\n\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n\t\t\t})\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t}\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} [min] min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis.settings.spread = spread;\n\n\t\tif (min) {\n\t\t\tthis.settings.minSpreadWidth = min;\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.spread(spread, min);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the direction of the rendition\n\t * @param  {string} dir\n\t */\n\tdirection(dir){\n\n\t\tthis.settings.direction = dir || \"ltr\";\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.direction(this.settings.direction);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Report the current location\n\t * @fires relocated\n\t * @fires locationChanged\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function reportedLocation(){\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\n\t\t\t\tvar location = this.manager.currentLocation();\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\t\tlet located = this.located(result);\n\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else if (location) {\n\t\t\t\t\tlet located = this.located(location);\n\n\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event locationChanged\n\t\t\t\t\t * @deprecated\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t * @property {number} index\n\t\t\t\t\t * @property {string} href\n\t\t\t\t\t * @property {EpubCFI} start\n\t\t\t\t\t * @property {EpubCFI} end\n\t\t\t\t\t * @property {number} percentage\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t});\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event relocated\n\t\t\t\t\t * @type {displayedLocation}\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get the Current Location object\n\t * @return {displayedLocation | promise} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tlet located = this.located(result);\n\t\t\t\treturn located;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tlet located = this.located(location);\n\t\t\treturn located;\n\t\t}\n\t}\n\n\t/**\n\t * Creates a Rendition#locationRange from location\n\t * passed by the Manager\n\t * @returns {displayedLocation}\n\t * @private\n\t */\n\tlocated(location){\n\t\tif (!location.length) {\n\t\t\treturn {};\n\t\t}\n\t\tlet start = location[0];\n\t\tlet end = location[location.length-1];\n\n\t\tlet located = {\n\t\t\tstart: {\n\t\t\t\tindex: start.index,\n\t\t\t\thref: start.href,\n\t\t\t\tcfi: start.mapping.start,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: start.pages[0] || 1,\n\t\t\t\t\ttotal: start.totalPages\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tindex: end.index,\n\t\t\t\thref: end.href,\n\t\t\t\tcfi: end.mapping.end,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: end.pages[end.pages.length-1] || 1,\n\t\t\t\t\ttotal: end.totalPages\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n\t\tif (locationStart != null) {\n\t\t\tlocated.start.location = locationStart;\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n\t\t}\n\t\tif (locationEnd != null) {\n\t\t\tlocated.end.location = locationEnd;\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n\t\t}\n\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n\t\tif (pageStart != -1) {\n\t\t\tlocated.start.page = pageStart;\n\t\t}\n\t\tif (pageEnd != -1) {\n\t\t\tlocated.end.page = pageEnd;\n\t\t}\n\n\t\tif (end.index === this.book.spine.last().index &&\n\t\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\n\t\t\tlocated.atEnd = true;\n\t\t}\n\n\t\tif (start.index === this.book.spine.first().index &&\n\t\t\t\tlocated.start.displayed.page === 1) {\n\t\t\tlocated.atStart = true;\n\t\t}\n\n\t\treturn located;\n\t}\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\t// this.q.clear();\n\t\t// this.q = undefined;\n\n\t\tthis.manager && this.manager.destroy();\n\t\tthis.book.spine.hooks.content.deregister(this.injected['identifier']);\n\t\tthis.book.spine.hooks.content.deregister(this.injected['script']);\n\t\tthis.book.spine.hooks.content.deregister(this.injected['stylesheet']);\n\n\t\tthis.book = undefined;\n\n\t\t// this.views = null;\n\n\t\t// this.hooks.display.clear();\n\t\t// this.hooks.serialize.clear();\n\t\t// this.hooks.content.clear();\n\t\t// this.hooks.layout.clear();\n\t\t// this.hooks.render.clear();\n\t\t// this.hooks.show.clear();\n\t\t// this.hooks = {};\n\n\t\t// this.themes.destroy();\n\t\t// this.themes = undefined;\n\n\t\t// this.epubcfi = undefined;\n\n\t\t// this.starting = undefined;\n\t\t// this.started = undefined;\n\n\n\t}\n\n\t/**\n\t * Pass the events from a view's Contents\n\t * @private\n\t * @param  {Contents} view contents\n\t */\n\tpassEvents(contents){\n\t\tDOM_EVENTS.forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\n\t}\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange, contents){\n\t\t/**\n\t\t * Emit that a text selection has occured\n\t\t * @event selected\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n\t}\n\n\t/**\n\t * Emit a markClicked event with the cfiRange and data from a mark\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerMarkEvent(cfiRange, data, contents){\n\t\t/**\n\t\t * Emit that a mark was clicked\n\t\t * @event markClicked\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {object} data\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n\t}\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\tgetRange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.manager.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\n\t\t}\n\t}\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\tadjustImages(contents) {\n\n\t\tif (this._layout.name === \"pre-paginated\") {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n\t\tlet verticalPadding = parseFloat(computed.verticalPadding);\n\n\t\tcontents.addStylesheetRules({\n\t\t\t\"img\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - verticalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"object-fit\": \"contain\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\",\n\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t},\n\t\t\t\"svg\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - verticalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\"\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Get the Contents object of each rendered view\n\t * @returns {Contents[]}\n\t */\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t}\n\n\t/**\n\t * Get the views member from the manager\n\t * @returns {Views}\n\t */\n\tviews () {\n\t\tlet views = this.manager ? this.manager.views : undefined;\n\t\treturn views || [];\n\t}\n\n\t/**\n\t * Hook to handle link clicks in rendered content\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\thandleLinks(contents) {\n\t\tif (contents) {\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\n\t\t\t\tlet relative = this.book.path.relative(href);\n\t\t\t\tthis.display(relative);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook to handle injecting stylesheet before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectStylesheet(doc, section) {\n\t\tlet style = doc.createElement(\"link\");\n\t\tstyle.setAttribute(\"type\", \"text/css\");\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\n\t}\n\n\t/**\n\t * Hook to handle injecting scripts before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectScript(doc, section) {\n\t\tlet script = doc.createElement(\"script\");\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", this.settings.script);\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n\t/**\n\t * Hook to handle the document identifier before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectIdentifier(doc, section) {\n\t\tlet ident = this.book.packaging.metadata.identifier;\n\t\tlet meta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\t\tif (ident) {\n\t\t\tmeta.setAttribute(\"content\", ident);\n\t\t}\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\n\t}\n\n\tscale(s) {\n\t\treturn this.manager && this.manager.scale(s);\n\t}\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n","import {defer, isXml, parse} from \"./utils/core\";\nimport request from \"./utils/request\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\n\n/**\n * Handles Unzipping a requesting files from an Epub Archive\n * @class\n */\nclass Archive {\n\n\tconstructor() {\n\t\tthis.zip = undefined;\n\t\tthis.urlCache = {};\n\n\t\tthis.checkRequirements();\n\n\t}\n\n\t/**\n\t * Checks to see if JSZip exists in global namspace,\n\t * Requires JSZip if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tif (typeof JSZip === \"undefined\") {\n\t\t\t\tlet JSZip = require(\"jszip\");\n\t\t\t\tthis.zip = new JSZip();\n\t\t\t} else {\n\t\t\t\tthis.zip = new JSZip();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"JSZip lib not loaded\");\n\t\t}\n\t}\n\n\t/**\n\t * Open an archive\n\t * @param  {binary} input\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topen(input, isBase64){\n\t\treturn this.zip.loadAsync(input, {\"base64\": isBase64});\n\t}\n\n\t/**\n\t * Load and Open an archive\n\t * @param  {string} zipUrl\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topenUrl(zipUrl, isBase64){\n\t\treturn request(zipUrl, \"binary\")\n\t\t\t.then(function(data){\n\t\t\t\treturn this.zip.loadAsync(data, {\"base64\": isBase64});\n\t\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Request a url from the archive\n\t * @param  {string} url  a url to request from the archive\n\t * @param  {string} [type] specify the type of the returned result\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\trequest(url, type){\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == \"blob\"){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\t\tif (response) {\n\t\t\tresponse.then(function (r) {\n\t\t\t\tlet result = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {string} [type]\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"xhtml\") {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"html\" || type == \"htm\") {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t}\n\n\t/**\n\t * Get a Blob from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"uint8array\").then(function(uint8array) {\n\t\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get Text from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [encoding]\n\t * @return {string}\n\t */\n\tgetText(url, encoding){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\treturn entry.async(\"string\").then(function(text) {\n\t\t\t\treturn text;\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get a base64 encoded result from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"base64\").then(function(data) {\n\t\t\t\treturn \"data:\" + mimeType + \";base64,\" + data;\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Create a Url from an unarchived item\n\t * @param  {string} url\n\t * @param  {object} [options.base64] use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the archive\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t}\n\n\tdestroy() {\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tfor (let fromCache in this.urlCache) {\n\t\t\t_URL.revokeObjectURL(fromCache);\n\t\t}\n\t\tthis.zip = undefined;\n\t\tthis.urlCache = {};\n\t}\n}\n\nexport default Archive;\n","import {defer, isXml, parse} from \"./utils/core\";\nimport httpRequest from \"./utils/request\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Handles saving and requesting files from local storage\n * @class\n * @param {string} name This should be the name of the application for modals\n * @param {function} [requester]\n * @param {function} [resolver]\n */\nclass Store {\n\n\tconstructor(name, requester, resolver) {\n\t\tthis.urlCache = {};\n\n\t\tthis.storage = undefined;\n\n\t\tthis.name = name;\n\t\tthis.requester = requester || httpRequest;\n\t\tthis.resolver = resolver;\n\n\t\tthis.online = true;\n\n\t\tthis.checkRequirements();\n\n\t\tthis.addListeners();\n\t}\n\n\t/**\n\t * Checks to see if localForage exists in global namspace,\n\t * Requires localForage if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tlet store;\n\t\t\tif (typeof localforage === \"undefined\") {\n\t\t\t\tstore = require(\"localforage\");\n\t\t\t} else {\n\t\t\t\tstore = localforage;\n\t\t\t}\n\t\t\tthis.storage = store.createInstance({\n\t\t\t\t\tname: this.name\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"localForage lib not loaded\");\n\t\t}\n\t}\n\n\t/**\n\t * Add online and offline event listeners\n\t * @private\n\t */\n\taddListeners() {\n\t\tthis._status = this.status.bind(this);\n\t\twindow.addEventListener('online',  this._status);\n\t  window.addEventListener('offline', this._status);\n\t}\n\n\t/**\n\t * Remove online and offline event listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\t\twindow.removeEventListener('online',  this._status);\n\t  window.removeEventListener('offline', this._status);\n\t\tthis._status = undefined;\n\t}\n\n\t/**\n\t * Update the online / offline status\n\t * @private\n\t */\n\tstatus(event) {\n\t\tlet online = navigator.onLine;\n\t\tthis.online = online;\n\t\tif (online) {\n\t\t\tthis.emit(\"online\", this);\n\t\t} else {\n\t\t\tthis.emit(\"offline\", this);\n\t\t}\n\t}\n\n\t/**\n\t * Add all of a book resources to the store\n\t * @param  {Resources} resources  book resources\n\t * @param  {boolean} [force] force resaving resources\n\t * @return {Promise<object>} store objects\n\t */\n\tadd(resources, force) {\n\t\tlet mapped = resources.resources.map((item) => {\n\t\t\tlet { href } = item;\n\t\t\tlet url = this.resolver(href);\n\t\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\t\treturn this.storage.getItem(encodedUrl).then((item) => {\n\t\t\t\tif (!item || force) {\n\t\t\t\t\treturn this.requester(url, \"binary\")\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t\treturn Promise.all(mapped);\n\t}\n\n\t/**\n\t * Put binary data from a url to storage\n\t * @param  {string} url  a url to request from storage\n\t * @param  {boolean} [withCredentials]\n\t * @param  {object} [headers]\n\t * @return {Promise<Blob>}\n\t */\n\tput(url, withCredentials, headers) {\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then((result) => {\n\t\t\tif (!result) {\n\t\t\t\treturn this.requester(url, \"binary\", withCredentials, headers).then((data) => {\n\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t/**\n\t * Request a url\n\t * @param  {string} url  a url to request from storage\n\t * @param  {string} [type] specify the type of the returned result\n\t * @param  {boolean} [withCredentials]\n\t * @param  {object} [headers]\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\trequest(url, type, withCredentials, headers){\n\t\tif (this.online) {\n\t\t\t// From network\n\t\t\treturn this.requester(url, type, withCredentials, headers).then((data) => {\n\t\t\t\t// save to store if not present\n\t\t\t\tthis.put(url);\n\t\t\t\treturn data;\n\t\t\t})\n\t\t} else {\n\t\t\t// From store\n\t\t\treturn this.retrieve(url, type);\n\t\t}\n\n\t}\n\n\t/**\n\t * Request a url from storage\n\t * @param  {string} url  a url to request from storage\n\t * @param  {string} [type] specify the type of the returned result\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\tretrieve(url, type) {\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == \"blob\"){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\n\t\treturn response.then((r) => {\n\t\t\tvar deferred = new defer();\n\t\t\tvar result;\n\t\t\tif (r) {\n\t\t\t\tresult = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t} else {\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tmessage : \"File not found in storage: \" + url,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {string} [type]\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"xhtml\") {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"html\" || type == \"htm\") {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t}\n\n\t/**\n\t * Get a Blob from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\n\t\t\tif(!uint8array) return;\n\n\t\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t});\n\n\t}\n\n\t/**\n\t * Get Text from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string}\n\t */\n\tgetText(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\n\t\t\tvar deferred = new defer();\n\t\t\tvar reader = new FileReader();\n\t\t\tvar blob;\n\n\t\t\tif(!uint8array) return;\n\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\n\n\t\t\treader.addEventListener(\"loadend\", () => {\n\t\t\t\tdeferred.resolve(reader.result);\n\t\t\t});\n\n\t\t\treader.readAsText(blob, mimeType);\n\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Get a base64 encoded result from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then((uint8array) => {\n\t\t\tvar deferred = new defer();\n\t\t\tvar reader = new FileReader();\n\t\t\tvar blob;\n\n\t\t\tif(!uint8array) return;\n\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\n\n\t\t\treader.addEventListener(\"loadend\", () => {\n\t\t\t\tdeferred.resolve(reader.result);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob, mimeType);\n\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Create a Url from a stored item\n\t * @param  {string} url\n\t * @param  {object} [options.base64] use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in storage: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the store\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t}\n\n\tdestroy() {\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tfor (let fromCache in this.urlCache) {\n\t\t\t_URL.revokeObjectURL(fromCache);\n\t\t}\n\t\tthis.urlCache = {};\n\t\tthis.removeListeners();\n\t}\n}\n\nEventEmitter(Store.prototype);\n\nexport default Store;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer} from \"./utils/core\";\nimport Url from \"./utils/url\";\nimport Path from \"./utils/path\";\nimport Spine from \"./spine\";\nimport Locations from \"./locations\";\nimport Container from \"./container\";\nimport Packaging from \"./packaging\";\nimport Navigation from \"./navigation\";\nimport Resources from \"./resources\";\nimport PageList from \"./pagelist\";\nimport Rendition from \"./rendition\";\nimport Archive from \"./archive\";\nimport request from \"./utils/request\";\nimport EpubCFI from \"./epubcfi\";\nimport Store from \"./store\";\nimport { EPUBJS_VERSION, EVENTS } from \"./utils/constants\";\n\nconst CONTAINER_PATH = \"META-INF/container.xml\";\n\nconst INPUT_TYPE = {\n\tBINARY: \"binary\",\n\tBASE64: \"base64\",\n\tEPUB: \"epub\",\n\tOPF: \"opf\",\n\tMANIFEST: \"json\",\n\tDIRECTORY: \"directory\"\n};\n\n/**\n * An Epub representation with methods for the loading, parsing and manipulation\n * of its contents.\n * @class\n * @param {string} [url]\n * @param {object} [options]\n * @param {method} [options.requestMethod] a request function to use instead of the default\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\n * @param {string} [options.replacements=none] use base64, blobUrl, or none for replacing assets in archived Epubs\n * @param {method} [options.canonical] optional function to determine canonical urls for a path\n * @param {string} [options.openAs] optional string to determine the input type\n * @param {string} [options.store=false] cache the contents in local storage, value should be the name of the reader\n * @returns {Book}\n * @example new Book(\"/path/to/book.epub\", {})\n * @example new Book({ replacements: \"blobUrl\" })\n */\nclass Book {\n\tconstructor(url, options) {\n\t\t// Allow passing just options to the Book\n\t\tif (typeof(options) === \"undefined\" &&\n\t\t\t  typeof(url) !== \"string\" &&\n\t\t    url instanceof Blob === false) {\n\t\t\toptions = url;\n\t\t\turl = undefined;\n\t\t}\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\trequestMethod: undefined,\n\t\t\trequestCredentials: undefined,\n\t\t\trequestHeaders: undefined,\n\t\t\tencoding: undefined,\n\t\t\treplacements: undefined,\n\t\t\tcanonical: undefined,\n\t\t\topenAs: undefined,\n\t\t\tstore: undefined\n\t\t});\n\n\t\textend(this.settings, options);\n\n\n\t\t// Promises\n\t\tthis.opening = new defer();\n\t\t/**\n\t\t * @member {promise} opened returns after the book is loaded\n\t\t * @memberof Book\n\t\t */\n\t\tthis.opened = this.opening.promise;\n\t\tthis.isOpen = false;\n\n\t\tthis.loading = {\n\t\t\tmanifest: new defer(),\n\t\t\tspine: new defer(),\n\t\t\tmetadata: new defer(),\n\t\t\tcover: new defer(),\n\t\t\tnavigation: new defer(),\n\t\t\tpageList: new defer(),\n\t\t\tresources: new defer()\n\t\t};\n\n\t\tthis.loaded = {\n\t\t\tmanifest: this.loading.manifest.promise,\n\t\t\tspine: this.loading.spine.promise,\n\t\t\tmetadata: this.loading.metadata.promise,\n\t\t\tcover: this.loading.cover.promise,\n\t\t\tnavigation: this.loading.navigation.promise,\n\t\t\tpageList: this.loading.pageList.promise,\n\t\t\tresources: this.loading.resources.promise\n\t\t};\n\n\t\t/**\n\t\t * @member {promise} ready returns after the book is loaded and parsed\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.ready = Promise.all([\n\t\t\tthis.loaded.manifest,\n\t\t\tthis.loaded.spine,\n\t\t\tthis.loaded.metadata,\n\t\t\tthis.loaded.cover,\n\t\t\tthis.loaded.navigation,\n\t\t\tthis.loaded.resources\n\t\t]);\n\n\n\t\t// Queue for methods used before opening\n\t\tthis.isRendered = false;\n\t\t// this._q = queue(this);\n\n\t\t/**\n\t\t * @member {method} request\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.request = this.settings.requestMethod || request;\n\n\t\t/**\n\t\t * @member {Spine} spine\n\t\t * @memberof Book\n\t\t */\n\t\tthis.spine = new Spine();\n\n\t\t/**\n\t\t * @member {Locations} locations\n\t\t * @memberof Book\n\t\t */\n\t\tthis.locations = new Locations(this.spine, this.load.bind(this));\n\n\t\t/**\n\t\t * @member {Navigation} navigation\n\t\t * @memberof Book\n\t\t */\n\t\tthis.navigation = undefined;\n\n\t\t/**\n\t\t * @member {PageList} pagelist\n\t\t * @memberof Book\n\t\t */\n\t\tthis.pageList = undefined;\n\n\t\t/**\n\t\t * @member {Url} url\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.url = undefined;\n\n\t\t/**\n\t\t * @member {Path} path\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.path = undefined;\n\n\t\t/**\n\t\t * @member {boolean} archived\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.archived = false;\n\n\t\t/**\n\t\t * @member {Archive} archive\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.archive = undefined;\n\n\t\t/**\n\t\t * @member {Store} storage\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.storage = undefined;\n\n\t\t/**\n\t\t * @member {Resources} resources\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.resources = undefined;\n\n\t\t/**\n\t\t * @member {Rendition} rendition\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.rendition = undefined;\n\n\t\t/**\n\t\t * @member {Container} container\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.container = undefined;\n\n\t\t/**\n\t\t * @member {Packaging} packaging\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.packaging = undefined;\n\n\t\t// this.toc = undefined;\n\t\tif (this.settings.store) {\n\t\t\tthis.store(this.settings.store);\n\t\t}\n\n\t\tif(url) {\n\t\t\tthis.open(url, this.settings.openAs).catch((error) => {\n\t\t\t\tvar err = new Error(\"Cannot load book at \"+ url );\n\t\t\t\tthis.emit(EVENTS.BOOK.OPEN_FAILED, err);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Open a epub or url\n\t * @param {string | ArrayBuffer} input Url, Path or ArrayBuffer\n\t * @param {string} [what=\"binary\", \"base64\", \"epub\", \"opf\", \"json\", \"directory\"] force opening as a certain type\n\t * @returns {Promise} of when the book has been loaded\n\t * @example book.open(\"/path/to/book.epub\")\n\t */\n\topen(input, what) {\n\t\tvar opening;\n\t\tvar type = what || this.determineType(input);\n\n\t\tif (type === INPUT_TYPE.BINARY) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input);\n\t\t} else if (type === INPUT_TYPE.BASE64) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input, type);\n\t\t} else if (type === INPUT_TYPE.EPUB) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.request(input, \"binary\", this.settings.requestCredentials)\n\t\t\t\t.then(this.openEpub.bind(this));\n\t\t} else if(type == INPUT_TYPE.OPF) {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openPackaging(this.url.Path.toString());\n\t\t} else if(type == INPUT_TYPE.MANIFEST) {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openManifest(this.url.Path.toString());\n\t\t} else {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openContainer(CONTAINER_PATH)\n\t\t\t\t.then(this.openPackaging.bind(this));\n\t\t}\n\n\t\treturn opening;\n\t}\n\n\t/**\n\t * Open an archived epub\n\t * @private\n\t * @param  {binary} data\n\t * @param  {string} [encoding]\n\t * @return {Promise}\n\t */\n\topenEpub(data, encoding) {\n\t\treturn this.unarchive(data, encoding || this.settings.encoding)\n\t\t\t.then(() => {\n\t\t\t\treturn this.openContainer(CONTAINER_PATH);\n\t\t\t})\n\t\t\t.then((packagePath) => {\n\t\t\t\treturn this.openPackaging(packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the epub container\n\t * @private\n\t * @param  {string} url\n\t * @return {string} packagePath\n\t */\n\topenContainer(url) {\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.container = new Container(xml);\n\t\t\t\treturn this.resolve(this.settings.packagePath || this.container.packagePath);\n\t\t\t\t// return this.resolve(this.container.packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the Open Packaging Format Xml\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenPackaging(url) {\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.packaging = new Packaging(xml);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the manifest JSON\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenManifest(url) {\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((json) => {\n\t\t\t\tthis.packaging = new Packaging();\n\t\t\t\tthis.packaging.load(json);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Load a resource from the Book\n\t * @param  {string} path path to the resource to load\n\t * @return {Promise}     returns a promise with the requested resource\n\t */\n\tload(path) {\n\t\tvar resolved = this.resolve(path);\n\t\tif(this.archived) {\n\t\t\treturn this.archive.request(resolved);\n\t\t} else {\n\t\t\treturn this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\n\t\t}\n\t}\n\n\t/**\n\t * Resolve a path to it's absolute position in the Book\n\t * @param  {string} path\n\t * @param  {boolean} [absolute] force resolving the full URL\n\t * @return {string}          the resolved path string\n\t */\n\tresolve(path, absolute) {\n\t\tif (!path) {\n\t\t\treturn;\n\t\t}\n\t\tvar resolved = path;\n\t\tvar isAbsolute = (path.indexOf(\"://\") > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (this.path) {\n\t\t\tresolved = this.path.resolve(path);\n\t\t}\n\n\t\tif(absolute != false && this.url) {\n\t\t\tresolved = this.url.resolve(resolved);\n\t\t}\n\n\t\treturn resolved;\n\t}\n\n\t/**\n\t * Get a canonical link to a path\n\t * @param  {string} path\n\t * @return {string} the canonical path string\n\t */\n\tcanonical(path) {\n\t\tvar url = path;\n\n\t\tif (!path) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (this.settings.canonical) {\n\t\t\turl = this.settings.canonical(path);\n\t\t} else {\n\t\t\turl = this.resolve(path, true);\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t/**\n\t * Determine the type of they input passed to open\n\t * @private\n\t * @param  {string} input\n\t * @return {string}  binary | directory | epub | opf\n\t */\n\tdetermineType(input) {\n\t\tvar url;\n\t\tvar path;\n\t\tvar extension;\n\n\t\tif (this.settings.encoding === \"base64\") {\n\t\t\treturn INPUT_TYPE.BASE64;\n\t\t}\n\n\t\tif(typeof(input) != \"string\") {\n\t\t\treturn INPUT_TYPE.BINARY;\n\t\t}\n\n\t\turl = new Url(input);\n\t\tpath = url.path();\n\t\textension = path.extension;\n\n\t\tif (!extension) {\n\t\t\treturn INPUT_TYPE.DIRECTORY;\n\t\t}\n\n\t\tif(extension === \"epub\"){\n\t\t\treturn INPUT_TYPE.EPUB;\n\t\t}\n\n\t\tif(extension === \"opf\"){\n\t\t\treturn INPUT_TYPE.OPF;\n\t\t}\n\n\t\tif(extension === \"json\"){\n\t\t\treturn INPUT_TYPE.MANIFEST;\n\t\t}\n\t}\n\n\n\t/**\n\t * unpack the contents of the Books packaging\n\t * @private\n\t * @param {Packaging} packaging object\n\t */\n\tunpack(packaging) {\n\t\tthis.package = packaging; //TODO: deprecated this\n\n\t\tthis.spine.unpack(this.packaging, this.resolve.bind(this), this.canonical.bind(this));\n\n\t\tthis.resources = new Resources(this.packaging.manifest, {\n\t\t\tarchive: this.archive,\n\t\t\tresolver: this.resolve.bind(this),\n\t\t\trequest: this.request.bind(this),\n\t\t\treplacements: this.settings.replacements || (this.archived ? \"blobUrl\" : \"base64\")\n\t\t});\n\n\t\tthis.loadNavigation(this.packaging).then(() => {\n\t\t\t// this.toc = this.navigation.toc;\n\t\t\tthis.loading.navigation.resolve(this.navigation);\n\t\t});\n\n\t\tif (this.packaging.coverPath) {\n\t\t\tthis.cover = this.resolve(this.packaging.coverPath);\n\t\t}\n\t\t// Resolve promises\n\t\tthis.loading.manifest.resolve(this.packaging.manifest);\n\t\tthis.loading.metadata.resolve(this.packaging.metadata);\n\t\tthis.loading.spine.resolve(this.spine);\n\t\tthis.loading.cover.resolve(this.cover);\n\t\tthis.loading.resources.resolve(this.resources);\n\t\tthis.loading.pageList.resolve(this.pageList);\n\n\t\tthis.isOpen = true;\n\n\t\tif(this.archived || this.settings.replacements && this.settings.replacements != \"none\") {\n\t\t\tthis.replacements().then(() => {\n\t\t\t\tthis.opening.resolve(this);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\t} else {\n\t\t\t// Resolve book opened promise\n\t\t\tthis.opening.resolve(this);\n\t\t}\n\n\t}\n\n\t/**\n\t * Load Navigation and PageList from package\n\t * @private\n\t * @param {Packaging} packaging\n\t */\n\tloadNavigation(packaging) {\n\t\tlet navPath = packaging.navPath || packaging.ncxPath;\n\t\tlet toc = packaging.toc;\n\n\t\t// From json manifest\n\t\tif (toc) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.navigation = new Navigation(toc);\n\n\t\t\t\tif (packaging.pageList) {\n\t\t\t\t\tthis.pageList = new PageList(packaging.pageList); // TODO: handle page lists from Manifest\n\t\t\t\t}\n\n\t\t\t\tresolve(this.navigation);\n\t\t\t});\n\t\t}\n\n\t\tif (!navPath) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.navigation = new Navigation();\n\t\t\t\tthis.pageList = new PageList();\n\n\t\t\t\tresolve(this.navigation);\n\t\t\t});\n\t\t}\n\n\t\tnavPath = new Path(this.resolve(navPath));\n\t\treturn this.load(navPath.path, \"xml\")\n\t\t\t.then((xml) => {\n\t\t\t\tthis.navigation = new Navigation(xml, navPath, this.canonical.bind(this));\n\t\t\t\tthis.pageList = new PageList(xml, navPath, this.canonical.bind(this));\n\t\t\t\treturn this.navigation;\n\t\t\t});\n\t}\n\n\t/**\n\t * Gets a Section of the Book from the Spine\n\t * Alias for `book.spine.get`\n\t * @param {string} target\n\t * @return {Section}\n\t */\n\tsection(target) {\n\t\treturn this.spine.get(target);\n\t}\n\n\t/**\n\t * Sugar to render a book to an element\n\t * @param  {element | string} element element or string to add a rendition to\n\t * @param  {object} [options]\n\t * @return {Rendition}\n\t */\n\trenderTo(element, options) {\n\t\tthis.rendition = new Rendition(this, options);\n\t\tthis.rendition.attachTo(element);\n\n\t\treturn this.rendition;\n\t}\n\n\t/**\n\t * Set if request should use withCredentials\n\t * @param {boolean} credentials\n\t */\n\tsetRequestCredentials(credentials) {\n\t\tthis.settings.requestCredentials = credentials;\n\t}\n\n\t/**\n\t * Set headers request should use\n\t * @param {object} headers\n\t */\n\tsetRequestHeaders(headers) {\n\t\tthis.settings.requestHeaders = headers;\n\t}\n\n\t/**\n\t * Unarchive a zipped epub\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {string} [encoding]\n\t * @return {Archive}\n\t */\n\tunarchive(input, encoding) {\n\t\tthis.archive = new Archive();\n\t\treturn this.archive.open(input, encoding);\n\t}\n\n\t/**\n\t * Store the epubs contents\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {string} [encoding]\n\t * @return {Store}\n\t */\n\tstore(name) {\n\t\t// Use \"blobUrl\" or \"base64\" for replacements\n\t\tlet replacementsSetting = this.settings.replacements && this.settings.replacements !== \"none\";\n\t\t// Save original url\n\t\tlet originalUrl = this.url;\n\t\t// Save original request method\n\t\tlet requester = this.settings.requestMethod || request.bind(this);\n\t\t// Create new Store\n\t\tthis.storage = new Store(name, requester, this.resolve.bind(this));\n\t\t// Replace request method to go through store\n\t\tthis.request = this.storage.request.bind(this.storage);\n\n\t\tthis.opened.then(() => {\n\t\t\tif (this.archived) {\n\t\t\t\tthis.storage.requester = this.archive.request.bind(this.archive);\n\t\t\t}\n\t\t\t// Substitute hook\n\t\t\tlet substituteResources = (output, section) => {\n\t\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t\t};\n\n\t\t\t// Set to use replacements\n\t\t\tthis.resources.settings.replacements = replacementsSetting || \"blobUrl\";\n\t\t\t// Create replacement urls\n\t\t\tthis.resources.replacements().\n\t\t\t\tthen(() => {\n\t\t\t\t\treturn this.resources.replaceCss();\n\t\t\t\t});\n\n\t\t\tthis.storage.on(\"offline\", () => {\n\t\t\t\t// Remove url to use relative resolving for hrefs\n\t\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\t\t// Add hook to replace resources in contents\n\t\t\t\tthis.spine.hooks.serialize.register(substituteResources);\n\t\t\t});\n\n\t\t\tthis.storage.on(\"online\", () => {\n\t\t\t\t// Restore original url\n\t\t\t\tthis.url = originalUrl;\n\t\t\t\t// Remove hook\n\t\t\t\tthis.spine.hooks.serialize.deregister(substituteResources);\n\t\t\t});\n\n\t\t});\n\n\t\treturn this.storage;\n\t}\n\n\t/**\n\t * Get the cover url\n\t * @return {string} coverUrl\n\t */\n\tcoverUrl() {\n\t\tvar retrieved = this.loaded.cover.\n\t\t\tthen((url) => {\n\t\t\t\tif(this.archived) {\n\t\t\t\t\t// return this.archive.createUrl(this.cover);\n\t\t\t\t\treturn this.resources.get(this.cover);\n\t\t\t\t}else{\n\t\t\t\t\treturn this.cover;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn retrieved;\n\t}\n\n\t/**\n\t * Load replacement urls\n\t * @private\n\t * @return {Promise} completed loading urls\n\t */\n\treplacements() {\n\t\tthis.spine.hooks.serialize.register((output, section) => {\n\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t});\n\n\t\treturn this.resources.replacements().\n\t\t\tthen(() => {\n\t\t\t\treturn this.resources.replaceCss();\n\t\t\t});\n\t}\n\n\t/**\n\t * Find a DOM Range for a given CFI Range\n\t * @param  {EpubCFI} cfiRange a epub cfi range\n\t * @return {Range}\n\t */\n\tgetRange(cfiRange) {\n\t\tvar cfi = new EpubCFI(cfiRange);\n\t\tvar item = this.spine.get(cfi.spinePos);\n\t\tvar _request = this.load.bind(this);\n\t\tif (!item) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\treject(\"CFI could not be found\");\n\t\t\t});\n\t\t}\n\t\treturn item.load(_request).then(function (contents) {\n\t\t\tvar range = cfi.toRange(item.document);\n\t\t\treturn range;\n\t\t});\n\t}\n\n\t/**\n\t * Generates the Book Key using the identifer in the manifest or other string provided\n\t * @param  {string} [identifier] to use instead of metadata identifier\n\t * @return {string} key\n\t */\n\tkey(identifier) {\n\t\tvar ident = identifier || this.packaging.metadata.identifier || this.url.filename;\n\t\treturn `epubjs:${EPUBJS_VERSION}:${ident}`;\n\t}\n\n\t/**\n\t * Destroy the Book and all associated objects\n\t */\n\tdestroy() {\n\t\tthis.opened = undefined;\n\t\tthis.loading = undefined;\n\t\tthis.loaded = undefined;\n\t\tthis.ready = undefined;\n\n\t\tthis.isOpen = false;\n\t\tthis.isRendered = false;\n\n\t\tthis.spine && this.spine.destroy();\n\t\tthis.locations && this.locations.destroy();\n\t\tthis.pageList && this.pageList.destroy();\n\t\tthis.archive && this.archive.destroy();\n\t\tthis.resources && this.resources.destroy();\n\t\tthis.container && this.container.destroy();\n\t\tthis.packaging && this.packaging.destroy();\n\t\tthis.rendition && this.rendition.destroy();\n\n\t\tthis.spine = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.pageList = undefined;\n\t\tthis.archive = undefined;\n\t\tthis.resources = undefined;\n\t\tthis.container = undefined;\n\t\tthis.packaging = undefined;\n\t\tthis.rendition = undefined;\n\n\t\tthis.navigation = undefined;\n\t\tthis.url = undefined;\n\t\tthis.path = undefined;\n\t\tthis.archived = false;\n\t}\n\n}\n\n//-- Enable binding events to book\nEventEmitter(Book.prototype);\n\nexport default Book;\n","import Book from \"./book\";\nimport Rendition from \"./rendition\";\nimport CFI from \"./epubcfi\";\nimport Contents from \"./contents\";\nimport * as utils from \"./utils/core\";\nimport { EPUBJS_VERSION } from \"./utils/constants\";\nimport '../libs/url/url-polyfill'\n\nimport IframeView from \"./managers/views/iframe\";\nimport DefaultViewManager from \"./managers/default\";\nimport ContinuousViewManager from \"./managers/continuous\";\n\n/**\n * Creates a new Book\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\n * @param {object} options to pass to the book\n * @returns {Book} a new Book object\n * @example ePub(\"/path/to/book.epub\", {})\n */\nfunction ePub(url, options) {\n\treturn new Book(url, options);\n}\n\nePub.VERSION = EPUBJS_VERSION;\n\nif (typeof(global) !== \"undefined\") {\n\tglobal.EPUBJS_VERSION = EPUBJS_VERSION;\n}\n\nePub.Book = Book;\nePub.Rendition = Rendition;\nePub.Contents = Contents;\nePub.CFI = CFI;\nePub.utils = utils;\n\nexport default ePub;\n","import Book from \"./book\";\nimport EpubCFI from \"./epubcfi\";\nimport Rendition from \"./rendition\";\nimport Contents from \"./contents\";\nimport Layout from \"./layout\";\nimport ePub from \"./epub\";\n\nexport default ePub;\nexport {\n\tBook,\n\tEpubCFI,\n\tRendition,\n\tContents,\n\tLayout\n};\n","class PrefabViews {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t}\n\n\tall() {\n\t\treturn this._views;\n\t}\n\n\tfirst() {\n\t\treturn this._views[0];\n\t}\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t}\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t}\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t}\n\n\tget(i) {\n\t\treturn this._views[i];\n\t}\n\n\tappend(view){\n\t\tvar check = false;\n\t\tthis.forEach(function(v) {\n\t\t\tif ( v.section.href == view.section.href ) { check = true; }\n\t\t})\n\t\tif ( check ) { return view; }\n\t\t// if ( check ) { console.log(\"AHOY views.append WUT\", view.section.href)}\n\t\tthis._views.push(view);\n\t\tthis._views.sort(function(a,b) {return (a.section.href > b.section.href) ? 1 : ((b.section.href > a.section.href) ? -1 : 0);});\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tdump() {\n\t\treturn this._views.map(function(v) { return v.section.href });\n\t}\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t}\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\t// if(this.container && view.element.dataset.reused != 'true'){\n\t\t// \t this.container.removeChild(view.element);\n\t\t// }\n\t\tview = null;\n\t}\n\n\t// Iterators\n\n\tforEach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t}\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t}\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t}\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t}\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t}\n}\n\nexport default PrefabViews;\n","import {extend, defer, requestAnimationFrame} from \"epubjs/src/utils/core\";\nimport DefaultViewManager from \"epubjs/src/managers/default\";\nimport ContinuousViewManager from \"epubjs/src/managers/continuous/index\" ;\nimport PrefabViews from \"../helpers/prefab\";\n\nimport { EVENTS } from \"epubjs/src/utils/constants\";\nimport debounce from \"lodash/debounce\";\n\nclass PrePaginatedContinuousViewManager extends ContinuousViewManager {\n    constructor(options) {\n    super(options);\n\n    this.name = \"prepaginated\";\n\n    this._manifest = null;\n    this._spine = [];\n    this.settings.scale = this.settings.scale || 1.0;\n  }\n\n  render(element, size){\n    var scale = this.settings.scale;\n    this.settings.scale = null; // we don't want the stage to scale\n    ContinuousViewManager.prototype.render.call(this, element, size);\n    // Views array methods\n    // use prefab views\n    this.settings.scale = scale;\n    this.views = new PrefabViews(this.container);\n  }\n\n  onResized(e) {\n    if (this.resizeTimeout) {\n      clearTimeout(this.resizeTimeout);\n    }\n    console.log(\"AHOY PREPAGINATED onResized queued\");\n    this.resizeTimeout = setTimeout(function() {\n      this.resize();\n      console.log(\"AHOY PREPAGINATED onResized actual\");\n      this.resizeTimeout = null;\n    }.bind(this), 500);\n    // this.resize();\n  }\n\n  resize(width, height) {\n    var self = this;\n\n    ContinuousViewManager.prototype.resize.call(this, width, height);\n    this._redrawViews();\n  }\n\n  _redrawViews() {\n    var self = this;\n    for(var i = 0; i < self._spine.length; i++) {\n      var href = self._spine[i];\n      // // console.log(\"AHOY DRAWING\", href);\n      var section_ = self._manifest[href];\n      // // var r = self.container.offsetWidth / section_.viewport.width;\n      // // var h = Math.floor(dim.height * r);\n      // var w = self.layout.columnWidth + ( self.layout.columnWidth * 0.10 );\n      // var r = w / section_.viewport.width;\n      // var h = Math.floor(section_.viewport.height * r);\n\n      var h, w;\n      [ w, h ] = self.sizeToViewport(section_);\n\n      var div = self.container.querySelector(`div.epub-view[ref=\"${section_.index}\"]`);\n      div.style.width = `${w}px`;\n      div.style.height = `${h}px`;\n      div.setAttribute('original-height', h);\n      div.setAttribute('layout-height', h);\n\n      var view = this.views.find(section_);\n      if ( view ) {\n          view.size(w, h);\n      }\n    }\n  }\n\n  // RRE - debugging\n  createView(section) {\n\n    var view = this.views.find(section);\n    if ( view ) {\n      return view;\n    }\n\n    var w, h;\n    [ w, h ] = this.sizeToViewport(section);\n    var viewSettings = Object.assign({}, this.viewSettings);\n    viewSettings.layout = Object.assign( Object.create( Object.getPrototypeOf(this.viewSettings.layout)), this.viewSettings.layout);\n    viewSettings.layout.height = h;\n    viewSettings.layout.columnWidth = w;\n    var view = new this.View(section, viewSettings);\n    return view;\n  }\n\n  display(section, target){\n    var self = this;\n    var promises = [];\n\n    this.q.clear();\n    var display = new defer();\n    var promises = [];\n    this.faking = {};\n\n    if ( ! this._manifest ) {\n      this.emit(\"building\");\n      self._manifest = {};\n      var _buildManifest = function(section_) {\n        self._manifest[section_.href] = false;\n        if ( self.settings.viewports && self.settings.viewports[section_.href] ) {\n          section_.viewport = self.settings.viewports[section_.href];\n          self._manifest[section_.href] = section_;\n        } else {\n          self.q.enqueue(() => {\n            section_.load(self.request).then(function(contents) {\n              var meta = contents.querySelector('meta[name=\"viewport\"]');\n              var value = meta.getAttribute('content');\n              var tmp = value.split(\",\");\n              var key = section_.href;\n              var idx = self._spine.indexOf(key);\n              self.emit(\"building\", { index: idx + 1, total: self._spine.length });\n              section_.viewport = {};\n              self._manifest[key] = section_;\n              // self._manifest[key] = { viewport : {} };\n              // self._manifest[key].index = section_.index;\n              // self._manifest[key].href = section_.href;\n              var viewport_width = tmp[0].replace('width=','');\n              var viewport_height = tmp[1].replace('height=','');\n              if ( ! viewport_height.match(/^\\d+$/) ) {\n                viewport_width = viewport_height = 'auto';\n              } else {\n                viewport_width = parseInt(viewport_width, 10);\n                viewport_height = parseInt(viewport_height, 10);\n              }\n              self._manifest[key].viewport.width = viewport_width;\n              self._manifest[key].viewport.height = viewport_height;\n              self.faking[key] = self._manifest[key].viewport;\n            })\n          });\n        }\n      }\n\n      // can we build a manifest here?\n      var prev_ = section.prev();\n      while ( prev_ ) {\n        self._spine.unshift(prev_.href);\n        _buildManifest(prev_);\n        prev_ = prev_.prev();\n      }\n\n      self._spine.push(section.href);\n      _buildManifest(section);\n\n      var next_ = section.next();\n      while ( next_ ) {\n        self._spine.push(next_.href);\n        _buildManifest(next_);\n        next_ = next_.next();\n      }\n\n      console.log(\"AHOY PRE-PAGINATED\", promises.length);\n    }\n\n    var _display = function() {\n\n      var check = document.querySelector('.epub-view');\n      if ( ! check ) {\n        self._max_height = self._max_viewport_height = 0;\n        self._max_width = self._max_viewport_width = 0;\n        console.log(\"AHOY DRAWING\", self._spine.length);\n        for(var i = 0; i < self._spine.length; i++) {\n          var href = self._spine[i];\n          var section_ = self._manifest[href];\n          var w, h;\n          [w, h] = self.sizeToViewport(section_);\n\n          self.container.innerHTML += `<div class=\"epub-view\" ref=\"${section_.index}\" data-href=\"${section_.href}\" style=\"width: ${w}px; height: ${h}px; text-align: center; margin-left: auto; margin-right: auto\"></div>`;\n          var div = self.container.querySelector(`div.epub-view[ref=\"${section_.index}\"]`);\n          // div.setAttribute('use-')\n          div.setAttribute('original-height', h);\n          div.setAttribute('layout-height', h);\n\n          if ( window.debugManager ) {\n            div.style.backgroundImage = `url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 32' width='300' height='32'%3e%3cstyle%3e.small %7b fill: rgba(0,0,0,0.3);%7d%3c/style%3e%3ctext x='0' y='25' class='small'%3e${section_.href}%3c/text%3e%3c/svg%3e\")`;\n            var colorR = Math.floor(Math.random() * 100).toString();\n            var colorG = Math.floor(Math.random() * 100).toString();\n            var colorB = Math.floor(Math.random() * 100).toString();\n            div.style.backgroundColor = `#${colorR}${colorG}${colorB}`;\n          }\n        }\n      }\n\n      // find the <div> with this section\n      // console.log(\"AHOY continuous.display START\", section.href);\n      var div = self.container.querySelector(`div.epub-view[ref=\"${section.index}\"]`);\n      div.scrollIntoView();\n\n      // this.q.clear();\n      // return check ? this.update() : this.check();\n      // var retval = check ? this.update() : this.check();\n      var retval = this.check();\n            console.log(\"AHOY DISPLAY\", check ? \"UPDATE\" : \"CHECK\", retval);\n      retval.then(function() {\n        this.q.clear();\n                console.log(\"AHOY MANAGER BUILT\");\n        this.emit(\"built\");\n        return display.resolve();\n      }.bind(this));\n\n      // return DefaultViewManager.prototype.display.call(this, section, target)\n      //  .then(function () {\n      //    return this.fill();\n      //  }.bind(this));\n\n            return retval;\n    }.bind(this);\n\n    // // promises.push(_display);\n    // while(promises.length) {\n    //  this.q.enqueue(promises.shift);\n    // }\n\n    // console.log(\"AHOY PREPAGINATED\", this.q._q.length);\n    // this.q.enqueue().then((result) => {\n    //  display.resolve();\n    // })\n\n    var q = function() {\n      return this.q.enqueue((result) => {\n        var waiting = 0;\n        for(var i = 0; i < self._spine.length; i++) {\n          var href = self._spine[i];\n          var has_section = self._manifest[href];\n          if ( has_section == false ) { waiting += 1; }\n        }\n        // console.log(\"AHOY PRE-PAGINATED WAITING\", waiting);\n        if ( waiting == 0 ) {\n          return _display();\n        } else {\n          q();\n        }\n      })\n    }.bind(this);\n\n    return q();\n\n    return display.promise;\n\n  }\n\n  _checkStillLoading() {\n    this.q.enqueue((result) => {\n      var waiting = 0;\n      for(var i = 0; i < self._spine.length; i++) {\n        var href = self._spine[i];\n        var has_section = self._manifest[href];\n        if ( has_section == false ) { waiting += 1; }\n      }\n      console.log(\"AHOY PRE-PAGINATED WAITING\", waiting);\n      if ( waiting == 0 ) {\n        return _display();\n      } else {\n        q();\n      }\n    })\n  }\n\n  fill(_full) {\n    var full = _full || new defer();\n\n    this.q.enqueue(() => {\n      return this._checkStillLoading();\n    }).then((result) => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n\n    return full.promise;\n  }\n\n  fillXX(_full){\n    var full = _full || new defer();\n\n    this.q.enqueue(() => {\n      return this.check();\n    }).then((result) => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n\n    return full.promise;\n  }\n\n  moveTo(offset){\n    // var bounds = this.stage.bounds();\n    // var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n    var distX = 0,\n        distY = 0;\n\n    var offsetX = 0,\n        offsetY = 0;\n\n    if(!this.isPaginated) {\n      distY = offset.top;\n      offsetY = offset.top+this.settings.offset;\n    } else {\n      distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n      offsetX = distX+this.settings.offset;\n    }\n\n    if (distX > 0 || distY > 0) {\n      this.scrollBy(distX, distY, true);\n    }\n  }\n\n  afterResized(view){\n    this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n  }\n\n  // Remove Previous Listeners if present\n  removeShownListeners(view){\n\n    // view.off(\"shown\", this.afterDisplayed);\n    // view.off(\"shown\", this.afterDisplayedAbove);\n    view.onDisplayed = function(){};\n\n  }\n\n  add(section){\n    var view = this.createView(section);\n\n    this.views.append(view);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      view.expanded = true;\n    });\n\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n\n    // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n\n    return view.display(this.request);\n  }\n\n  append(section){\n\n    var view = this.createView(section);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      view.expanded = true;\n      // do not do this\n      // this.counter(bounds); // RRE\n    });\n\n    /*\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n    */\n\n    this.views.append(view);\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n\n    return view;\n  }\n\n  prepend(section){\n    var view = this.createView(section);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      this.counter(bounds);\n      view.expanded = true;\n    });\n\n    /*\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n    */\n\n    this.views.prepend(view);\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n\n    return view;\n  }\n\n  counter(bounds){\n    // return;\n    if(this.settings.axis === \"vertical\") {\n      // if ( ! this._timer ) {\n      //  this._timer = setTimeout(function() {\n      //    this._timer = null;\n      //    console.log(\"AHOY USING counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      //    this.scrollBy(0, bounds.heightDelta, true);\n      //    this.x1(`COUNTER ${bounds.heightDelta}`);\n      //  }.bind(this), 500);\n      // } else {\n      //  console.log(\"AHOY SKIPPING counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      // }\n      // console.log(\"AHOY counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      this.scrollBy(0, bounds.heightDelta, true);\n    } else {\n      this.scrollBy(bounds.widthDelta, 0, true);\n    }\n\n  }\n\n  updateXXX(_offset) {\n    var offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n    var visibleLength = horizontal ? bounds.width : bounds.height;\n    var contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n    var divs = document.querySelectorAll('.epub-view');\n    var visible = [];\n    for(var i = 0; i < divs.length; i++) {\n      var div = divs[i];\n      var rect = div.getBoundingClientRect();\n      var marker = '';\n      // if ( rect.top > offset + bounds.height && ( rect.top + rect.height ) <= offset ) {\n      // if ( adjusted_top < ( div.offsetTop + rect.height ) && adjusted_end > div.offsetTop ) {\n      if ( offset < ( div.offsetTop + rect.height ) && ( offset + bounds.height ) > div.offsetTop ) {\n        marker = '**';\n        var section = this._manifest[div.dataset.href];\n        visible.push(section);\n        // if ( ! div.querySelector('iframe') ) {\n        //  newViews.push(this.append(section))\n        // }\n        // var idx = this._spine.indexOf(section.href);\n        // if ( idx > 0 ) {\n        //  visible.push(this._manifest[this._spine[idx - 1]]);\n        // }\n        // if ( idx < this._spine.length - 1 ) {\n        //  visible.push(this._manifest[this._spine[idx + 1]]);\n        // }\n      }\n      // console.log(\"AHOY\", div.dataset.href, rect.top, rect.height, \"/\", div.offsetTop, div.offsetHeight, \"/\", offset, bounds.height, marker);\n    }\n\n  }\n\n  update(_offset){\n    var container = this.bounds();\n    var views = this.views.all();\n    var viewsLength = views.length;\n    var visible = [];\n    var offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n    var isVisible;\n    var view;\n\n    var updating = new defer();\n    var promises = [];\n    var queued = {};\n    for (var i = 0; i < viewsLength; i++) {\n      view = views[i];\n\n      isVisible = this.isVisible(view, offset, offset, container);\n      if ( isVisible === true ) {\n        queued[i] = true;\n      }\n    }\n\n    for(var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      var isVisible = queued[i];\n      if(isVisible === true) {\n        // console.log(\"visible \" + view.index);\n\n        if (!view.displayed) {\n          // console.log(\"AHOY continuous.update !displayed\", view.section.href);\n          let displayed = view.display(this.request)\n            .then(function (view) {\n              view.show();\n            }, (err) => {\n              // console.log(\"AHOY continuous.update ERROR\", err);\n              view.hide();\n            });\n          promises.push(displayed);\n        } else {\n          // console.log(\"AHOY continuous.update show\", view.section.href);\n          view.show();\n        }\n        visible.push(view);\n      } else {\n        this.q.enqueue(view.destroy.bind(view));\n        // console.log(\"hidden \" + view.index);\n\n        clearTimeout(this.trimTimeout);\n        this.trimTimeout = setTimeout(function(){\n          this.q.enqueue(this.trim.bind(this));\n        }.bind(this), 250);\n      }\n\n    }\n\n    if(promises.length){\n      return Promise.all(promises)\n        .catch((err) => {\n          updating.reject(err);\n        });\n    } else {\n      updating.resolve();\n      return updating.promise;\n    }\n\n  }\n\n  check(_offsetLeft, _offsetTop){\n    var checking = new defer();\n    var newViews = [];\n\n    var horizontal = (this.settings.axis === \"horizontal\");\n    var delta = this.settings.offset || 0;\n\n    if (_offsetLeft && horizontal) {\n      delta = _offsetLeft;\n    }\n\n    if (_offsetTop && !horizontal) {\n      delta = _offsetTop;\n    }\n\n    var bounds = this._bounds; // bounds saved this until resize\n\n    let rtl = this.settings.direction === \"rtl\";\n    let dir = horizontal && rtl ? -1 : 1; //RTL reverses scrollTop\n\n    var offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n    var visibleLength = horizontal ? bounds.width : bounds.height;\n    var contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n    var prePaginated = this.layout.props.name == 'pre-paginated';\n\n    // console.log(\"continuous.check prePaginated =\", prePaginated, \"offset=\",\n    //  offset, \"visibleLength =\", visibleLength, \"delta=\", delta, ` (${offset + visibleLength + delta})`, \" >= contentLength =\", contentLength,\n    //  \" == \", offset + visibleLength + delta >= contentLength,\n    //  \" || \", offset - delta, \"<\", 0, \" == \", offset - delta < 0 );\n\n    let prepend = () => {\n      let first = this.views.first();\n      let prev = first && first.section.prev();\n\n      if(prev) {\n        newViews.push(this.prepend(prev));\n      }\n    };\n\n    let append = () => {\n      let last = this.views.last();\n      let next = last && last.section.next();\n\n      if(next) {\n        newViews.push(this.append(next));\n      }\n\n    };\n\n    var adjusted_top = offset - ( bounds.height * 8 );\n    var adjusted_end = offset + ( bounds.height * 8 );\n    // console.log(\"AHOY check\", offset, \"-\", offset + bounds.height, \"/\", adjusted_top, \"-\", adjusted_end);\n\n    // need to figure out which divs are viewable\n    var divs = document.querySelectorAll('.epub-view');\n    var visible = [];\n    for(var i = 0; i < divs.length; i++) {\n      var div = divs[i];\n      var rect = div.getBoundingClientRect();\n      var marker = '';\n      // if ( rect.top > offset + bounds.height && ( rect.top + rect.height ) <= offset ) {\n      // if ( adjusted_top < ( div.offsetTop + rect.height ) && adjusted_end > div.offsetTop ) {\n      if ( offset < ( div.offsetTop + rect.height ) && ( offset + bounds.height ) > div.offsetTop ) {\n        marker = '**';\n        var section = this._manifest[div.dataset.href];\n        visible.push(section);\n        // if ( ! div.querySelector('iframe') ) {\n        //  newViews.push(this.append(section))\n        // }\n        // var idx = this._spine.indexOf(section.href);\n        // if ( idx > 0 ) {\n        //  visible.push(this._manifest[this._spine[idx - 1]]);\n        // }\n        // if ( idx < this._spine.length - 1 ) {\n        //  visible.push(this._manifest[this._spine[idx + 1]]);\n        // }\n      }\n      // console.log(\"AHOY\", div.dataset.href, rect.top, rect.height, \"/\", div.offsetTop, div.offsetHeight, \"/\", offset, bounds.height, marker);\n    }\n\n    this.__check_visible = visible;\n\n    var section = visible[0];\n    if ( section && section.index > 0 ) {\n      visible.unshift(this._manifest[this._spine[section.index - 1]]);\n    }\n    if ( section ) {\n      var tmp = this._spine[section.index + 1];\n      if ( tmp ) {\n        visible.push(this._manifest[tmp]);\n      }\n    }\n    // if ( section && section.prev() ) {\n    //  visible.unshift(section.prev());\n    // }\n    // section = visible[visible.length - 1];\n    // if (section && section.next() ) {\n    //  visible.push(section.next());\n    // }\n\n    for(var i = 0; i < visible.length; i++) {\n      var section = visible[i];\n      // var div = document.querySelector(`.epub-view[ref=\"${section.index}\"]`);\n      // if ( div.querySelector('iframe') ) {\n      //  continue;\n      // }\n      newViews.push(this.append(section));\n    }\n\n    // let promises = newViews.map((view) => {\n    //  return view.displayed;\n    // });\n\n    var promises = [];\n    for(var i = 0; i < newViews.length; i++) {\n      if ( newViews[i] ) {\n        promises.push(newViews[i]);\n      }\n    }\n\n    if(newViews.length){\n      return Promise.all(promises)\n        .then(() => {\n          // return this.check();\n          // if (this.layout.name === \"pre-paginated\" && this.layout.props.spread && this.layout.flow() != 'scrolled') {\n          //   // console.log(\"AHOY check again\");\n          //   return this.check();\n          // }\n        })\n        .then(() => {\n          // Check to see if anything new is on screen after rendering\n          // console.log(\"AHOY update again\");\n          return this.update(delta);\n        }, (err) => {\n          return err;\n        });\n    } else {\n      this.q.enqueue(function(){\n        this.update();\n      }.bind(this));\n      checking.resolve(false);\n      return checking.promise;\n    }\n\n\n  }\n\n  trim(){\n    var task = new defer();\n    var displayed = this.views.displayed();\n    var first = displayed[0];\n    var last = displayed[displayed.length-1];\n    var firstIndex = this.views.indexOf(first);\n    var lastIndex = this.views.indexOf(last);\n    var above = this.views.slice(0, firstIndex);\n    var below = this.views.slice(lastIndex+1);\n\n    // Erase all but last above\n    for (var i = 0; i < above.length-3; i++) {\n      if ( above[i] ) {\n        // console.log(\"AHOY trim > above\", first.section.href, \":\", above[i].section.href);\n        this.erase(above[i], above);\n      }\n    }\n\n    // Erase all except first below\n    for (var j = 3; j < below.length; j++) {\n      if ( below[j] ) {\n        // console.log(\"AHOY trim > below\", last.section.href, \":\", below[j].section.href);\n        this.erase(below[j]);\n      }\n    }\n\n    task.resolve();\n    return task.promise;\n  }\n\n  erase(view, above){ //Trim\n\n    var prevTop;\n    var prevLeft;\n\n    if(this.settings.height) {\n      prevTop = this.container.scrollTop;\n      prevLeft = this.container.scrollLeft;\n    } else {\n      prevTop = window.scrollY;\n      prevLeft = window.scrollX;\n    }\n\n    var bounds = view.bounds();\n\n    // console.log(\"AHOY erase\", view.section.href, above);\n    this.views.remove(view);\n\n    if(above) {\n      if(this.settings.axis === \"vertical\") {\n        // this.scrollTo(0, prevTop - bounds.height, true);\n      } else {\n        this.scrollTo(prevLeft - bounds.width, 0, true);\n      }\n    }\n\n  }\n\n  addEventListeners(stage){\n\n    window.addEventListener(\"unload\", function(e){\n      this.ignore = true;\n      // this.scrollTo(0,0);\n      this.destroy();\n    }.bind(this));\n\n    this.addScrollListeners();\n  }\n\n  addScrollListeners() {\n    var scroller;\n\n    this.tick = requestAnimationFrame;\n\n    if(this.settings.height) {\n      this.prevScrollTop = this.container.scrollTop;\n      this.prevScrollLeft = this.container.scrollLeft;\n    } else {\n      this.prevScrollTop = window.scrollY;\n      this.prevScrollLeft = window.scrollX;\n    }\n\n    this.scrollDeltaVert = 0;\n    this.scrollDeltaHorz = 0;\n\n    if(this.settings.height) {\n      scroller = this.container;\n      this.scrollTop = this.container.scrollTop;\n      this.scrollLeft = this.container.scrollLeft;\n    } else {\n      scroller = window;\n      this.scrollTop = window.scrollY;\n      this.scrollLeft = window.scrollX;\n    }\n\n    scroller.addEventListener(\"scroll\", this.onScroll.bind(this));\n    this._scrolled = debounce(this.scrolled.bind(this), 30);\n    // this.tick.call(window, this.onScroll.bind(this));\n\n    this.didScroll = false;\n\n  }\n\n  removeEventListeners(){\n    var scroller;\n\n    if(this.settings.height) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this.onScroll.bind(this));\n  }\n\n  onScroll(){\n    let scrollTop;\n    let scrollLeft;\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n    if(this.settings.height) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY * dir;\n      scrollLeft = window.scrollX * dir;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if(!this.ignore) {\n\n      this._scrolled();\n\n    } else {\n      this.ignore = false;\n    }\n\n    this.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n    this.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n    this.prevScrollTop = scrollTop;\n    this.prevScrollLeft = scrollLeft;\n\n    clearTimeout(this.scrollTimeout);\n    this.scrollTimeout = setTimeout(function(){\n      this.scrollDeltaVert = 0;\n      this.scrollDeltaHorz = 0;\n    }.bind(this), 150);\n\n\n    this.didScroll = false;\n\n  }\n\n  scrolled() {\n    this.q.enqueue(function() {\n      this.check();\n      this.recenter();\n      setTimeout(function() {\n        this.emit(EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 500);\n    }.bind(this));\n\n    this.emit(EVENTS.MANAGERS.SCROLL, {\n      top: this.scrollTop,\n      left: this.scrollLeft\n    });\n\n    clearTimeout(this.afterScrolled);\n    this.afterScrolled = setTimeout(function () {\n      this.emit(EVENTS.MANAGERS.SCROLLED, {\n        top: this.scrollTop,\n        left: this.scrollLeft\n      });\n    }.bind(this));\n  }\n\n  next(){\n\n    let dir = this.settings.direction;\n    let delta = this.layout.props.name === \"pre-paginated\" &&\n                this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n    delta = this.container.offsetHeight / this.settings.scale;\n\n    if(!this.views.length) return;\n\n    if(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n      this.scrollBy(delta, 0, true);\n\n    } else {\n\n      // this.scrollBy(0, this.layout.height, true);\n      this.scrollBy(0, delta, true);\n\n    }\n\n    this.q.enqueue(function() {\n      this.check();\n    }.bind(this));\n  }\n\n  prev(){\n\n    let dir = this.settings.direction;\n    let delta = this.layout.props.name === \"pre-paginated\" &&\n                this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n    if(!this.views.length) return;\n\n    if(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n      this.scrollBy(-delta, 0, true);\n\n    } else {\n\n      this.scrollBy(0, -this.layout.height, true);\n\n    }\n\n    this.q.enqueue(function() {\n      this.check();\n    }.bind(this));\n  }\n\n  updateAxis(axis, forceUpdate){\n\n    if (!this.isPaginated) {\n      axis = \"vertical\";\n    }\n\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n\n    this.settings.axis = axis;\n\n    this.stage && this.stage.axis(axis);\n\n    this.viewSettings.axis = axis;\n\n    if (this.mapping) {\n      this.mapping.axis(axis);\n    }\n\n    if (this.layout) {\n      if (axis === \"vertical\") {\n        this.layout.spread(\"none\");\n      } else {\n        this.layout.spread(this.layout.settings.spread);\n      }\n    }\n\n    if (axis === \"vertical\") {\n      this.settings.infinite = true;\n    } else {\n      this.settings.infinite = false;\n    }\n  }\n\n  recenter() {\n    var wrapper = this.container.parentElement;\n    var w3 = ( wrapper.scrollWidth / 2 ) - ( wrapper.offsetWidth / 2 );\n    wrapper.scrollLeft = w3;\n  }\n\n  sizeToViewport(section) {\n    var h = this.layout.height;\n    // reduce to 80% to avoid hacking epubjs/layout.js\n    var w = this.layout.columnWidth * 0.8 * this.settings.scale;\n    if ( section.viewport.height != 'auto' ) {\n      if ( this.layout.columnWidth > section.viewport.width ) {\n        w = section.viewport.width * this.settings.scale;\n      }\n      var r = w / section.viewport.width;\n      h = Math.floor(section.viewport.height * r);\n    }\n    return [w, h];\n  }\n\n  sizeToViewport_X(section) {\n    var h = this.layout.height;\n    var w = this.layout.columnWidth * 0.80;\n\n    if ( section.viewport.height != 'auto' ) {\n\n      var r = w / section.viewport.width;\n      h = section.viewport.height * r;\n      var f = 1 / 0.60;\n      var m = Math.min(( f * this.layout.height ) / h, 1.0);\n      console.log(\"AHOY SHRINKING\", `( ${f} * ${this.layout.height} ) / ${h} = ${m} :: ${h * m}`);\n      h *= m;\n\n      h *= this.settings.scale;\n      if ( h > section.viewport.height ) {\n        h = section.viewport.height;\n      }\n\n      r = h / section.viewport.height;\n      w = section.viewport.width * r;\n\n      h = Math.floor(h);\n      w = Math.floor(w);\n    }\n    return [w, h];\n  }\n\n  scale(scale) {\n    var self = this;\n    this.settings.scale = scale;\n    var current = this.currentLocation();\n    var index = -1;\n    if ( current[0] ) {\n      index = current[0].index; \n    }\n\n    this.views.hide();\n    this.views.clear();\n    this._redrawViews();\n    this.views.show();\n    setTimeout(function() {\n      console.log(\"AHOY JUMPING TO\", index);\n      if ( index > -1 ) {\n        var div = self.container.querySelector(`div.epub-view[ref=\"${index}\"]`);\n        div.scrollIntoView(true);\n      }\n      this.check().then(function() {\n        this.onScroll();\n      }.bind(this))\n    }.bind(this), 0);\n  }\n\n  resetScale() {\n    // NOOP\n  }\n\n}\n\nPrePaginatedContinuousViewManager.toString = function() { return 'prepaginated'; }\n\nexport default PrePaginatedContinuousViewManager;\n\n","import IframeView from \"epubjs/src/managers/views/iframe\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"epubjs/src/utils/core\";\n\nclass ReusableIframeView extends IframeView {\n    constructor(section, options) {\n        super(section, options);\n        // this._layout.height = null;\n    }\n\n    container(axis) {\n        var check = document.querySelector(`div[ref='${this.index}']`);\n        if ( check ) {\n            check.dataset.reused = 'true';\n            return check;\n        }\n\n        var element = document.createElement(\"div\");\n\n        element.classList.add(\"epub-view\");\n\n        // this.element.style.minHeight = \"100px\";\n        element.style.height = \"0px\";\n        element.style.width = \"0px\";\n        element.style.overflow = \"hidden\";\n        element.style.position = \"relative\";\n        element.style.display = \"block\";\n\n        if(axis && axis == \"horizontal\"){\n            element.style.flex = \"none\";\n        } else {\n            element.style.flex = \"initial\";\n        }\n\n        return element;\n    }\n\n    create() {\n\n        if(this.iframe) {\n            return this.iframe;\n        }\n\n        if(!this.element) {\n            this.element = this.createContainer();\n        }\n\n        if ( this.element.hasAttribute('layout-height') ) {\n            var height = parseInt(this.element.getAttribute('layout-height'), 10);\n            this._layout_height = height;\n        }\n\n        this.iframe = this.element.querySelector(\"iframe\");\n        if ( this.iframe ) {\n            return this.iframe;\n        }\n\n        this.iframe = document.createElement(\"iframe\");\n        this.iframe.id = this.id;\n        this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n        this.iframe.style.overflow = \"hidden\";\n        this.iframe.seamless = \"seamless\";\n        // Back up if seamless isn't supported\n        this.iframe.style.border = \"none\";\n\n        this.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n        this.resizing = true;\n\n        // this.iframe.style.display = \"none\";\n        this.element.style.visibility = \"hidden\";\n        this.iframe.style.visibility = \"hidden\";\n\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n\n        this.element.setAttribute(\"ref\", this.index);\n        this.element.setAttribute(\"data-href\", this.section.href);\n\n        // this.element.appendChild(this.iframe);\n        this.added = true;\n\n        this.elementBounds = bounds(this.element);\n\n        // if(width || height){\n        //   this.resize(width, height);\n        // } else if(this.width && this.height){\n        //   this.resize(this.width, this.height);\n        // } else {\n        //   this.iframeBounds = bounds(this.iframe);\n        // }\n\n\n        if((\"srcdoc\" in this.iframe)) {\n            this.supportsSrcdoc = true;\n        } else {\n            this.supportsSrcdoc = false;\n        }\n\n        if (!this.settings.method) {\n            this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n        }\n\n        return this.iframe;\n    }\n\n}\n\nexport default ReusableIframeView;\n","import EventEmitter from \"event-emitter\";\n\nimport {inVp} from '../../../core/Util';\nwindow.inVp = inVp;\n\nclass Views {\n    constructor(container, preloading=false) {\n        this.container = container;\n        this._views = [];\n        this.length = 0;\n        this.hidden = false;\n        this.preloading = preloading;\n        this.observer = new IntersectionObserver(this.handleObserver.bind(this), {\n            root: this.containr,\n            rootMargin: '0px',\n            threshold: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1]\n        });\n    }\n\n    all() {\n        return this._views;\n    }\n\n    first() {\n        // return this._views[0];\n        return this.displayed()[0];\n    }\n\n    last() {\n        var d = this.displayed();\n        return d[d.length - 1];\n        // return this._views[this._views.length-1];\n    }\n\n    prev(view) {\n        var index = this.indexOf(view);\n        return this.get(index - 1);\n    }\n\n    next(view) {\n        var index = this.indexOf(view);\n        return this.get(index + 1);\n    }\n\n    indexOf(view) {\n        return this._views.indexOf(view);\n    }\n\n    slice() {\n        return this._views.slice.apply(this._views, arguments);\n    }\n\n    get(i) {\n        return i < 0 ? null : this._views[i];\n    }\n\n    append(view){\n        this._views.push(view);\n        if(this.container){\n            this.container.appendChild(view.element);\n            var threshold = {};\n            var h = this.container.offsetHeight;\n            threshold.top = - ( h * 0.25 );\n            threshold.bottom = - ( h * 0.25 );\n            // view.observer = ElementObserver(view.element, {\n            //     container: this.container,\n            //     onEnter: this.onEnter.bind(this, view), // callback when the element enters the viewport\n            //     onExit: this.onExit.bind(this, view), // callback when the element exits the viewport\n            //     offset: 0, // offset from the edges of the viewport in pixels\n            //     once: false, // if true, observer is detroyed after first callback is triggered\n            //     observerCollection: null // new ObserverCollection() // Advanced: Used for grouping custom viewport handling\n            // })\n            // const { fully, partially, edges } = inVp(view.element, threshold, this.container);\n            // if ( edges.percentage > 0 ) {\n            //     this.onEnter(view);\n            // }\n\n            this.observer.observe(view.element);\n        }\n        this.length++;\n        return view;\n    }\n\n    handleObserver(entries, observer) {\n        entries.forEach(entry => {\n            var div = entry.target;\n            var index = div.getAttribute('ref');\n            var view = this.get(index);\n            if ( entry.isIntersecting && entry.intersectionRatio > 0.0  ) {\n                if ( ! view.displayed ) {\n                    console.log(\"AHOY OBSERVING\", entries.length, index, 'onEnter');\n                    this.onEnter(view);\n                }\n            } else if ( view && view.displayed ) {\n                console.log(\"AHOY OBSERVING\", entries.length, index, 'onExit');\n                this.onExit(view);\n            }\n        })\n    }\n\n    prepend(view){\n        this._views.unshift(view);\n        if(this.container){\n            this.container.insertBefore(view.element, this.container.firstChild);\n        }\n        this.length++;\n        return view;\n    }\n\n    // insert(view, index) {\n    //     this._views.splice(index, 0, view);\n\n    //     if(this.container){\n    //         if(index < this.container.children.length){\n    //             this.container.insertBefore(view.element, this.container.children[index]);\n    //         } else {\n    //             this.container.appendChild(view.element);\n    //         }\n    //     }\n\n    //     this.length++;\n    //     return view;\n    // }\n\n    // remove(view) {\n    //     var index = this._views.indexOf(view);\n\n    //     if(index > -1) {\n    //         this._views.splice(index, 1);\n    //     }\n\n\n    //     this.destroy(view);\n\n    //     this.length--;\n    // }\n\n    destroy(view) {\n        // if(view.displayed){\n        //     view.destroy();\n        // }\n        this.observer.unobserve(view.element);\n        view.destroy();\n\n        if(this.container){\n             this.container.removeChild(view.element);\n        }\n        view = null;\n    }\n\n    // Iterators\n\n    forEach() {\n        // return this._views.forEach.apply(this._views, arguments);\n        return this.displayed().forEach.apply(this._views, arguments);\n    }\n\n    clear(){\n        // Remove all views\n        var view;\n        var len = this.length;\n\n        if(!this.length) return;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            this.destroy(view);\n        }\n\n        this._views = [];\n        this.length = 0;\n        this.observer.disconnect();\n    }\n\n    updateLayout(options) {\n        var width = options.width;\n        var height = options.height;\n        this._views.forEach(function(view) {\n            view.size(width, height);\n            if ( view.contents ) {\n                view.contents.size(width, height);\n            }\n        })\n    }\n\n    find(section){\n\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            // view.displayed\n            if(view.section.index == section.index) {\n                return view;\n            }\n        }\n\n    }\n\n    displayed(){\n        var displayed = [];\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            const { fully, partially, edges } = inVp(view.element, this.container);\n            if ( ( fully || partially ) && edges.percentage > 0 && view.displayed ) {\n                displayed.push(view);\n            }\n            // if(view.displayed){\n            //     displayed.push(view);\n            // }\n        }\n        return displayed;\n    }\n\n    show(){\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            if(view.displayed){\n                view.show();\n            }\n        }\n        this.hidden = false;\n    }\n\n    hide(){\n        var view;\n        var len = this.length;\n\n        for (var i = 0; i < len; i++) {\n            view = this._views[i];\n            if(view.displayed){\n                // console.log(\"AHOY VIEWS hide\", view.index);\n                view.hide();\n            }\n        }\n        this.hidden = true;\n    }\n\n    onEnter(view, el, viewportState) {\n        // console.log(\"AHOY VIEWS onEnter\", view.index, view.preloaded, view.displayed);\n        var preload = ! view.displayed || view.preloaded;\n        if ( ! view.displayed ) {\n            // console.log(\"AHOY SHOULD BE SHOWING\", view);\n            this.emit(\"view.display\", { view: view, viewportState: viewportState });\n        }\n        if ( this.preloading && preload ) {\n            // can we grab the next one?\n            this.preload(this.next(view), view.index);\n            this.preload(this.prev(view), view.index);\n        }\n        if ( ! view.displayed && view.preloaded ) {\n            // console.log(\"AHOY VIEWS onEnter TOGGLE\", view.index, view.preloaded, view.displayed);\n            view.preloaded = false;\n        }\n    }\n\n    preload(view, index) {\n        if ( view && ! view.preloaded ) {\n            view.preloaded = true;\n            // console.log(\"AHOY VIEWS preload\", index, \">\", view.index);\n            this.emit(\"view.preload\", { view: view });\n        }\n    }\n\n    onExit(view, el, viewportState) {\n        // console.log(\"AHOY VIEWS onExit\", view.index, view.preloaded);\n        if ( view.preloaded ) { return ; }\n        view.unload();\n    }\n}\n\nEventEmitter(Views.prototype);\nexport default Views;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber, requestAnimationFrame} from \"epubjs/src/utils/core\";\nimport Mapping from \"epubjs/src/mapping\";\nimport Queue from \"epubjs/src/utils/queue\";\nimport Stage from \"epubjs/src/managers/helpers/stage\";\nimport Views from \"../helpers/scrolling_views\";\nimport { EVENTS } from \"epubjs/src/utils/constants\";\nimport {inVp} from '../../../core/Util';\n\n// import inVp from \"in-vp\";\n\nclass ScrollingContinuousViewManager {\n  constructor(options) {\n\n    this.name = \"scrolling\";\n    this.optsSettings = options.settings;\n    this.View = options.view;\n    this.request = options.request;\n    this.renditionQueue = options.queue;\n    this.q = new Queue(this);\n\n    this.settings = extend(this.settings || {}, {\n      infinite: true,\n      hidden: false,\n      width: undefined,\n      height: undefined,\n      axis: undefined,\n      flow: \"scrolled\",\n      ignoreClass: \"\",\n      fullsize: undefined,\n      minHeight: 1024\n    });\n\n    extend(this.settings, options.settings || {});\n\n    this.viewSettings = {\n      prehooks: this.settings.prehooks,\n      ignoreClass: this.settings.ignoreClass,\n      axis: this.settings.axis,\n      flow: this.settings.flow,\n      layout: this.layout,\n      method: this.settings.method, // srcdoc, blobUrl, write\n      width: 0,\n      height: 0,\n      forceEvenPages: true\n    };\n\n    this.rendered = false;\n    this.settings.scale = this.settings.scale || 1.0;\n    this.settings.xscale = this.settings.scale;\n\n    this.fraction = 0.8;\n    // this.settings.maxWidth = 1024;\n  }\n\n  render(element, size){\n    let tag = element.tagName;\n\n    if (typeof this.settings.fullsize === \"undefined\" &&\n        tag && (tag.toLowerCase() == \"body\" ||\n        tag.toLowerCase() == \"html\")) {\n        this.settings.fullsize = true;\n    }\n\n    if (this.settings.fullsize) {\n      this.settings.overflow = \"visible\";\n      this.overflow = this.settings.overflow;\n    }\n\n    this.settings.size = size;\n\n    // Save the stage\n    this.stage = new Stage({\n      width: size.width,\n      height: size.height,\n      overflow: this.overflow,\n      hidden: this.settings.hidden,\n      axis: this.settings.axis,\n      fullsize: this.settings.fullsize,\n      direction: this.settings.direction,\n      scale: 1.0 // this.settings.scale --- scrolling scales different\n    });\n\n    this.stage.attachTo(element);\n\n    // Get this stage container div\n    this.container = this.stage.getContainer();\n\n    // Views array methods\n    this.views = new Views(this.container, this.layout.name == 'pre-paginated');\n\n    // Calculate Stage Size\n    this._bounds = this.bounds();\n    this._stageSize = this.stage.size();\n\n    var ar = this._stageSize.width / this._stageSize.height;\n    // console.log(\"AHOY STAGE\", this._stageSize.width, this._stageSize.height, \">\", ar);\n\n    // Set the dimensions for views\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n\n    // Function to handle a resize event.\n    // Will only attach if width and height are both fixed.\n    this.stage.onResize(this.onResized.bind(this));\n\n    this.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n    // Add Event Listeners\n    this.addEventListeners();\n\n    // Add Layout method\n    // this.applyLayoutMethod();\n    if (this.layout) {\n      this.updateLayout();\n    }\n\n    this.rendered = true;\n    this._spine = [];\n\n    this.views.on(\"view.preload\", function({view}) {\n      view.display(this.request).then(function() {\n        view.show();\n      })\n    }.bind(this));\n\n    this.views.on(\"view.display\", function({ view, viewportState }) {\n      // console.log(\"AHOY VIEWS scrolling.view.display\", view.index);\n      view.display(this.request).then(function() {\n        view.show();\n        this.gotoTarget(view);\n        if ( true || this._forceLocationEvent ) {\n          this.emit(EVENTS.MANAGERS.SCROLLED, {\n            top: this.scrollTop,\n            left: this.scrollLeft\n          });\n          this._forceLocationEvent = false;\n        }\n      }.bind(this))\n    }.bind(this));\n  }\n\n  display(section, target) {\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    if ( ! this.views.length ) {\n      this.initializeViews(section);\n    }\n\n    // Check if moving to target is needed\n    if (target === section.href || isNumber(target)) {\n      target = undefined;\n    }\n\n    var current = this.current();\n\n    this.ignore = false;\n    var visible = this.views.find(section);\n\n    // console.log(\"AHOY scrolling display\", section, visible, current, current == visible);\n\n    if(target) {\n      this._target = [ visible, target ];\n    }\n\n    // --- scrollIntoView is quirkily aggressive on mobile devices\n    // visible.element.scrollIntoView();\n    if ( visible.element.parentNode ) {\n      visible.element.parentNode.scrollTop = visible.element.offsetTop;\n    }\n\n    if ( visible == current ) {\n      this.gotoTarget(visible);\n    }\n\n    displaying.resolve();\n    return displayed;\n  }\n\n  gotoTarget(view) {\n    if ( this._target && this._target[0] == view ) {\n      let offset = view.locationOf(this._target[1]);\n\n      // -- this does not work; top varies.\n      // offset.top += view.element.getBoundingClientRect().top;\n\n      setTimeout(function() {\n        offset.top += this.container.scrollTop;\n        this.moveTo(offset);\n        this._target = null;\n      }.bind(this), 10);\n\n      // var prev; var style;\n      // for(var i = 0; i < view.index; i++) {\n      //   prev = this.views.get(i);\n      //   style = window.getComputedStyle(prev.element);\n      //   offset.top += ( parseInt(style.height) / this.settings.scale ) + parseInt(style.marginBottom) + parseInt(style.marginTop);\n      //   // offset.top += prev.height() || prev.element.offsetHeight;\n      // }\n      // this.moveTo(offset);\n      // this._target = null;\n    }\n  }\n\n  afterDisplayed(view){\n    // if ( this._target && this._target[0] == view ) {\n    //   let offset = view.locationOf(this._target[1]);\n    //   this.moveTo(offset);\n    //   this._target = null;\n    // }\n    this.emit(EVENTS.MANAGERS.ADDED, view);\n  }\n\n  afterResized(view){\n\n    var bounds = this.container.getBoundingClientRect();\n    var rect = view.element.getBoundingClientRect();\n\n    this.ignore = true;\n\n    // view.element.dataset.resizable = \"true\"\n    view.reframeElement();\n\n    var delta;\n    if ( rect.bottom <= bounds.bottom && rect.top < 0 ) {\n      requestAnimationFrame(function afterDisplayedAfterRAF() {\n        delta = view.element.getBoundingClientRect().height - rect.height;\n        // console.log(\"AHOY afterResized\", view.index, view.element.getBoundingClientRect().height, rect.height, delta);\n        this.container.scrollTop += Math.ceil(delta);        \n      }.bind(this));\n    }\n\n    // the default manager emits EVENTS.MANAGERS.RESIZE when the view is resized\n    // which causes the rendition to scroll to display the current location\n    // since we've (in theory) adjusted that during the paint frame\n    // don't emit\n    // -- this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n  }\n\n  moveTo(offset) {\n    var distX = 0, distY = 0;\n    distY = offset.top;\n    // this.scrollTo(distX, this.container.scrollTop + distY, true);\n    this.scrollTo(distX, distY, false);\n  }\n\n  initializeViews(section) {\n    var self = this;\n\n    this.ignore = true;\n\n    // if ( self._spine.length == 0 ) {\n    //   console.time(\"AHOY initializeViews CRAWL\");\n    //   // can we build a manifest here?\n    //   var prev_ = section.prev();\n    //   while ( prev_ ) {\n    //     // self._spine.unshift(prev_.href);\n    //     self._spine.unshift(prev_);\n    //     prev_ = prev_.prev();\n    //   }\n\n    //   self._spine.push(section);\n\n    //   var next_ = section.next();\n    //   while ( next_ ) {\n    //     // self._spine.push(next_.href);\n    //     self._spine.push(next_);\n    //     next_ = next_.next();\n    //   }\n\n    //   console.timeEnd(\"AHOY initializeViews CRAWL\");\n    // }\n\n    // this._spine.forEach(function (section) {\n\n   this.settings.spine.each(function (section) {\n\n      // if ( this.layout.name == 'pre-paginated' ) {\n      //   // do something\n      //   // viewSettings.layout.height = h;\n      //   // viewSettings.layout.columnWidth = w;\n\n      //   var r = this.layout.height / this.layout.columnWidth;\n\n      //   viewSettings.layout.columnWidth = this.layout.columnWidth * 0.8;\n      //   viewSettings.layout.height = this.layout.height * ( this.layout.columnWidth)\n\n      // }\n      var viewSettings = Object.assign({}, this.viewSettings);\n      viewSettings.layout = Object.assign( Object.create( Object.getPrototypeOf(this.viewSettings.layout)), this.viewSettings.layout);\n      if ( this.layout.name == 'pre-paginated' ) {\n        viewSettings.layout.columnWidth = this.calcuateWidth(viewSettings.layout.columnWidth); // *= ( this.fraction * this.settings.xscale );\n        viewSettings.layout.width = this.calcuateWidth(viewSettings.layout.width); // *= ( this.fraction * this.settings.xscale );\n        viewSettings.minHeight *= this.settings.xscale;\n        viewSettings.maxHeight = viewSettings.height * this.settings.xscale;\n        viewSettings.height = viewSettings.height * this.settings.xscale;\n        viewSettings.layout.height = viewSettings.height;\n        // console.log(\"AHOY new view\", section.index, viewSettings.height);\n      }\n\n      var view = new this.View(section, viewSettings);\n      view.onDisplayed = this.afterDisplayed.bind(this);\n      view.onResize = this.afterResized.bind(this);\n      view.on(EVENTS.VIEWS.AXIS, (axis) => {\n        this.updateAxis(axis);\n      });\n      // view.on('BAMBOOZLE', (e) => {\n      //   this.afterResizedBamboozled(view);\n      // })\n      this.views.append(view);\n    }.bind(this));\n\n    this.ignore = false;\n  }\n\n  direction(dir=\"ltr\") {\n    this.settings.direction = dir;\n\n    this.stage && this.stage.direction(dir);\n\n    this.viewSettings.direction = dir;\n\n    this.updateLayout();\n  }\n\n  onOrientationChange(e) {\n\n  }\n\n  onResized(e) {\n    // if ( this.resizeTimeout ) {\n    //   clearTimeout(this.resizeTimeout);\n    // } else {\n    //   // this._current = this.current() && this.current().section;\n    //   // this._current = { view: this.current(), location: this.currentLocation() };\n    // }\n    // this.resizeTimeout = setTimeout(this.resize.bind(this), 100);\n    this.resize();\n  }\n\n  resize(width, height){\n    let stageSize = this.stage.size(width, height);\n    if ( this.resizeTimeout ) {\n      clearTimeout(this.resizeTimeout);\n      this.resizeTimeout = null;\n    }\n\n    this.ignore = true;\n\n    // For Safari, wait for orientation to catch up\n    // if the window is a square\n    this.winBounds = windowBounds();\n    if (this.orientationTimeout &&\n        this.winBounds.width === this.winBounds.height) {\n      // reset the stage size for next resize\n      this._stageSize = undefined;\n      return;\n    }\n\n    if (this._stageSize &&\n        this._stageSize.width === stageSize.width &&\n        this._stageSize.height === stageSize.height ) {\n      // Size is the same, no need to resize\n      return;\n    }\n\n    this._stageSize = stageSize;\n\n    this._bounds = this.bounds();\n\n    // if ( ! this._resizeTarget ) {\n    //   var current = this.current();\n    //   if ( current ) {\n    //     this._resizeTarget = current.section;\n    //   }\n    // }\n\n    this.clear();\n\n    // Update for new views\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n\n    this.updateLayout();\n\n    // var section; var target;\n    // if ( this._current ) {\n    //   section = this._current.view.section;\n    //   target = this._current.location[0].mapping.start;\n    //   this._current = null;\n    // } else {\n    //   section = this._spine[0];\n    // }\n    // this.initializeViews(section);\n    // this.display(section, target);\n\n    // this.views.updateLayout(this.viewSettings);\n\n    this.emit(EVENTS.MANAGERS.RESIZED, {\n      width: this._stageSize.width,\n      height: this._stageSize.height\n    });\n  }\n\n  updateAxis(axis, forceUpdate) {\n    if (!this.isPaginated) {\n      axis = \"vertical\";\n    }\n\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n\n    this.settings.axis = axis;\n\n    this.stage && this.stage.axis(axis);\n\n    this.viewSettings.axis = axis;\n\n    if (this.mapping) {\n      this.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n    }\n\n    if (this.layout) {\n      this.layout.spread(\"none\");\n    }\n\n  }\n\n  updateFlow(flow) {\n    this.isPaginated = false;\n    this.updateAxis(\"vertical\");\n\n    this.viewSettings.flow = flow;\n\n    if (!this.settings.overflow) {\n      this.overflow = this.isPaginated ? \"hidden\" : \"auto\";\n    } else {\n      this.overflow = this.settings.overflow;\n    }\n\n    this.stage && this.stage.overflow(this.overflow);\n\n    this.updateLayout();\n  }\n\n  getContents() {\n    var contents = [];\n    if (!this.views) {\n      return contents;\n    }\n    this.views.forEach(function(view){\n      const viewContents = view && view.contents;\n      if (viewContents) {\n        contents.push(viewContents);\n      }\n    });\n    return contents;\n  }\n\n  current(){\n    var visible = this.visible();\n    var view;\n    if(visible.length){\n      // Current is the last visible view\n      var current = null;\n      for(var i = 0; i < visible.length; i++) {\n        view = visible[i];\n        const { fully, partially, edges } = inVp(view.element, this.container);\n        if ( ! current ) { current = view; current.percentage = edges.percentage; }\n        else if ( edges.percentage > current.percentage ) {\n          current = view;\n          current.percentage = edges.percentage;\n        }\n      }\n      if ( current ) { return current; }\n      return visible[visible.length-1];\n    }\n    return null;\n  }\n\n  visible() {\n    var visible = [];\n    var views = this.views.displayed();\n    var viewsLength = views.length;\n    var visible = [];\n    var isVisible;\n    var view;\n\n    return this.views.displayed();\n\n    for(var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      if ( view.displayed ) {\n        visible.push(view);\n      }\n    }\n\n    return visible;\n  }\n\n  scrollBy(x, y, silent){\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n    if(silent) {\n      this.ignore = true;\n    }\n\n    if(!this.settings.fullsize) {\n      if(x) this.container.scrollLeft += x * dir;\n      if(y) this.container.scrollTop += y;\n    } else {\n      window.scrollBy(x * dir, y * dir);\n    }\n    this.scrolled = true;\n  }\n\n  scrollTo(x, y, silent) {\n    if(silent) {\n      this.ignore = true;\n    }\n\n    if(!this.settings.fullsize) {\n      this.container.scrollLeft = x;\n      this.container.scrollTop = y;\n    } else {\n      window.scrollTo(x,y);\n    }\n    this.scrolled = true;\n  }\n\n  onScroll() {\n    let scrollTop;\n    let scrollLeft;\n\n    if(!this.settings.fullsize) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY;\n      scrollLeft = window.scrollX;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if(!this.ignore) {\n      this.emit(EVENTS.MANAGERS.SCROLL, {\n        top: scrollTop,\n        left: scrollLeft\n      });\n\n      clearTimeout(this.afterScrolled);\n      this.afterScrolled = setTimeout(function () {\n        this.emit(EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 20);\n\n    } else {\n      this.ignore = false;\n    }\n  }\n\n  bounds() {\n    var bounds;\n\n    bounds = this.stage.bounds();\n\n    return bounds;\n  }\n\n  applyLayout(layout) {\n    this.layout = layout;\n    this.updateLayout();\n  }\n\n  updateLayout() {\n    if (!this.stage) {\n      return;\n    }\n\n    this._stageSize = this.stage.size();\n    this.layout.calculate(this._stageSize.width, this._stageSize.height);\n    // this.layout.width = this.container.offsetWidth * 0.80;\n\n    // Set the dimensions for views\n    this.viewSettings.width = this.layout.width; //  * this.settings.scale;\n    this.viewSettings.height = this.calculateHeight(this.layout.height);\n    this.viewSettings.minHeight = this.viewSettings.height; // * this.settings.scale;\n\n    this.setLayout(this.layout);\n  }\n\n  setLayout(layout){\n\n    this.viewSettings.layout = layout;\n\n    this.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n    if(this.views) {\n\n     this.views._views.forEach(function(view) {\n        var viewSettings = Object.assign({}, this.viewSettings);\n        viewSettings.layout = Object.assign( Object.create( Object.getPrototypeOf(this.viewSettings.layout)), this.viewSettings.layout);\n        if ( this.layout.name == 'pre-paginated' ) {\n          viewSettings.layout.columnWidth = this.calcuateWidth(viewSettings.layout.columnWidth); // *= ( this.fraction * this.settings.xscale );\n          viewSettings.layout.width = this.calcuateWidth(viewSettings.layout.width); // *= ( this.fraction * this.settings.xscale );\n          viewSettings.minHeight *= this.settings.xscale;\n          viewSettings.maxHeight = viewSettings.height * this.settings.xscale;\n          viewSettings.height = viewSettings.height * this.settings.xscale;\n          viewSettings.layout.height = viewSettings.height;\n        }\n\n        view.size(viewSettings.layout.width, viewSettings.layout.height);\n        view.reframe(viewSettings.layout.width, viewSettings.layout.height);\n        view.setLayout(viewSettings.layout);\n      })\n\n      // this.views.forEach(function(view){\n      //   if (view) {\n      //     view.reframe(layout.width, layout.height);\n      //     view.setLayout(layout);\n      //   }\n      // });\n\n    }\n\n  }\n\n  addEventListeners() {\n    var scroller;\n\n    window.addEventListener(\"unload\", function(e){\n      this.destroy();\n    }.bind(this));\n\n    if(!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    this._onScroll = this.onScroll.bind(this);\n    scroller.addEventListener(\"scroll\", this._onScroll);\n\n  }\n\n  removeEventListeners(){\n    var scroller;\n\n    if(!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this._onScroll);\n    this._onScroll = undefined;\n  }\n\n  destroy(){\n    clearTimeout(this.orientationTimeout);\n    clearTimeout(this.resizeTimeout);\n    clearTimeout(this.afterScrolled);\n\n    this.clear();\n\n    this.removeEventListeners();\n\n    this.stage.destroy();\n\n    this.rendered = false;\n\n    /*\n\n      clearTimeout(this.trimTimeout);\n      if(this.settings.hidden) {\n        this.element.removeChild(this.wrapper);\n      } else {\n        this.element.removeChild(this.container);\n      }\n    */\n  }\n\n  next() {\n    var next;\n    var left;\n\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    let dir = this.settings.direction;\n\n    if(!this.views.length) return;\n\n    this.scrollTop = this.container.scrollTop;\n\n    let top  = this.container.scrollTop + this.container.offsetHeight;\n\n    this.scrollBy(0, this.layout.height, false);\n\n    this.q.enqueue(function() {\n      displaying.resolve();\n      return displayed;\n    })\n  }\n\n  prev() {\n    var next;\n    var left;\n\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    let dir = this.settings.direction;\n\n    if(!this.views.length) return;\n\n    this.scrollTop = this.container.scrollTop;\n\n    let top  = this.container.scrollTop - this.container.offsetHeight;\n    this.scrollBy(0, -this.layout.height, false);\n\n    this.q.enqueue(function() {\n      displaying.resolve();\n      return displayed;\n    })\n  }\n\n  clear () {\n\n    // // this.q.clear();\n\n    if (this.views) {\n      this.views.hide();\n      this.scrollTo(0,0, true);\n      this.views.clear();\n    }\n  }\n\n  currentLocation() {\n    let visible = this.visible();\n    let container = this.container.getBoundingClientRect();\n    let pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\n    let offset = 0;\n    let used = 0;\n\n    if(this.settings.fullsize) {\n      offset = window.scrollY;\n    }\n\n    let sections = visible.map((view) => {\n      let {index, href} = view.section;\n      let position = view.position();\n      let height = view.height();\n\n      let startPos = offset + container.top - position.top + used;\n      let endPos = startPos + pageHeight - used;\n      if (endPos > height) {\n        endPos = height;\n        used = (endPos - startPos);\n      }\n\n      let totalPages = this.layout.count(height, pageHeight).pages;\n\n      let currPage = Math.ceil(startPos / pageHeight);\n      let pages = [];\n      let endPage = Math.ceil(endPos / pageHeight);\n\n      pages = [];\n      for (var i = currPage; i <= endPage; i++) {\n        let pg = i + 1;\n        pages.push(pg);\n      }\n\n      totalPages = pages.length;\n\n      let mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n      return {\n        index,\n        href,\n        pages,\n        totalPages,\n        mapping\n      };\n    });\n\n    if ( sections.length == 0 ) {\n      self._forceLocationEvent = true;\n    }\n\n    return sections;\n  }\n\n  isRendered() {\n    return this.rendered;\n  }\n\n  scale(s) {\n    if ( s == null ) { s = 1.0; }\n    this.settings.scale = this.settings.xscale = s;\n\n    // if (this.stage) {\n    //   this.stage.scale(s);\n    // }\n\n    this.clear();\n    this.updateLayout();\n    this.emit(EVENTS.MANAGERS.RESIZED, {\n      width: this._stageSize.width,\n      height: this._stageSize.height\n    });\n  }\n\n  calcuateWidth(width) {\n    var retval = width * this.fraction * this.settings.xscale;\n    // if ( retval > this.settings.maxWidth * this.settings.xscale ) {\n    //   retval = this.settings.maxWidth * this.settings.xscale;\n    // }\n    return retval;\n  }\n\n  calculateHeight(height) {\n    var minHeight = this.layout.name == 'xxpre-paginated' ? 0 : this.settings.minHeight;\n    return height > minHeight ? this.layout.height : this.settings.minHeight;\n  }\n\n}\n\nScrollingContinuousViewManager.toString = function() { return 'continuous'; }\n\n//-- Enable binding events to Manager\nEventEmitter(ScrollingContinuousViewManager.prototype);\n\nexport default ScrollingContinuousViewManager;\n\n","import IframeView from \"epubjs/src/managers/views/iframe\";\nimport Contents from \"epubjs/src/contents\";\n\nimport { EVENTS } from \"epubjs/src/utils/constants\";\n\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"epubjs/src/utils/core\";\n\nclass StickyIframeView extends IframeView {\n    constructor(section, options) {\n        super(section, options);\n\n        this.element.style.height = `${this.layout.height}px`;\n        this.element.style.width = `${this.layout.width}px`;\n        this.element.style.visibility = \"hidden\";\n\n        // console.log(\"AHOY sticky NEW\", this.layout.height);\n    }\n\n    container(axis) {\n        var check = document.querySelector(`div[ref='${this.index}']`);\n        if ( check ) {\n            check.dataset.reused = 'true';\n            return check;\n        }\n\n        var element = document.createElement(\"div\");\n\n        element.classList.add(\"epub-view\");\n\n        // this.element.style.minHeight = \"100px\";\n        element.style.height = \"0px\";\n        element.style.width = \"0px\";\n        element.style.overflow = \"hidden\";\n        element.style.position = \"relative\";\n        element.style.display = \"block\";\n\n        element.setAttribute('ref', this.index);\n\n        if(axis && axis == \"horizontal\"){\n            element.style.flex = \"none\";\n        } else {\n            element.style.flex = \"initial\";\n        }\n\n        return element;\n    }\n\n    create() {\n\n        if(this.iframe) {\n            return this.iframe;\n        }\n\n        if(!this.element) {\n            this.element = this.createContainer();\n        }\n\n        if ( this.element.hasAttribute('layout-height') ) {\n            var height = parseInt(this.element.getAttribute('layout-height'), 10);\n            this._layout_height = height;\n        }\n\n        this.iframe = this.element.querySelector(\"iframe\");\n        if ( this.iframe ) {\n            return this.iframe;\n        }\n\n        this.iframe = document.createElement(\"iframe\");\n        this.iframe.id = this.id;\n        this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n        this.iframe.style.overflow = \"hidden\";\n        this.iframe.seamless = \"seamless\";\n        // Back up if seamless isn't supported\n        this.iframe.style.border = \"none\";\n\n        this.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n        this.resizing = true;\n\n        // this.iframe.style.display = \"none\";\n        this.element.style.visibility = \"hidden\";\n        this.iframe.style.visibility = \"hidden\";\n        this.element.classList.add('epub-view---loading');\n\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n\n        this.element.setAttribute(\"ref\", this.index);\n        this.element.setAttribute(\"data-href\", this.section.href);\n\n        // this.element.appendChild(this.iframe);\n        this.added = true;\n\n        this.elementBounds = bounds(this.element);\n\n        // if(width || height){\n        //   this.resize(width, height);\n        // } else if(this.width && this.height){\n        //   this.resize(this.width, this.height);\n        // } else {\n        //   this.iframeBounds = bounds(this.iframe);\n        // }\n\n\n        if((\"srcdoc\" in this.iframe)) {\n            this.supportsSrcdoc = true;\n        } else {\n            this.supportsSrcdoc = false;\n        }\n\n        if (!this.settings.method) {\n            this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n        }\n\n        return this.iframe;\n    }\n\n    reframe(width, height) {\n        var size;\n\n        var minHeight = this.settings.minHeight || 0;\n        var maxHeight = this.settings.maxHeight || -1;\n\n        // try to add some padding in the shortest pages\n        minHeight *= 0.90;\n\n        // console.log(\"AHOY AHOY reframe\", this.index, width, height);\n\n        if(isNumber(width)){\n            this.element.style.width = width + \"px\";\n            if ( this.iframe ) {\n                this.iframe.style.width = width + \"px\";\n            }\n            this._width = width;\n        }\n\n        if(isNumber(height)){\n            var checkMinHeight = ( this.settings.layout.name == 'reflowable' );\n            height = checkMinHeight && ( height <= minHeight ) ? minHeight : height;\n\n            var styles = window.getComputedStyle(this.element);\n            // setting the element height is delayed\n            if ( this.iframe ) {\n                this.iframe.style.height = height + \"px\";\n            }\n            this._height = height;\n        }\n\n        let widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n        let heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n        size = {\n            width: width,\n            height: height,\n            widthDelta: widthDelta,\n            heightDelta: heightDelta,\n        };\n\n        this.pane && this.pane.render();\n\n        requestAnimationFrame(() => {\n            let mark;\n            for (let m in this.marks) {\n                if (this.marks.hasOwnProperty(m)) {\n                    mark = this.marks[m];\n                    this.placeMark(mark.element, mark.range);\n                }\n            }\n        });\n\n        this.onResize(this, size);\n\n        this.emit(EVENTS.VIEWS.RESIZED, size);\n\n        this.prevBounds = size;\n\n        this.elementBounds = bounds(this.element);\n\n    }\n\n    queryReframeElement() {\n        if ( ! this.iframe ) { return -1; }\n        var height = this.iframe.offsetHeight;\n        var styles = window.getComputedStyle(this.element);\n        var new_height = ( height + parseInt(styles.paddingTop) + parseInt(styles.paddingBottom) )\n        return new_height;\n    }\n\n    reframeElement() {\n        if ( ! this.iframe ) { return; }\n        var height = this.iframe.offsetHeight;\n        var styles = window.getComputedStyle(this.element);\n        var new_height = ( \n            height + \n            parseInt(styles.paddingTop, 10) + \n            parseInt(styles.paddingBottom, 10) + \n            parseInt(styles.borderTopWidth, 10) + \n            parseInt(styles.borderBottomWidth, 10)\n        );\n        var current_height = this.element.offsetHeight;\n\n        // if this is the first re-load and the height doesn't match the current height\n        // DO NOT alter the height because some override is going to be applied\n        // which will alter the height.\n        this.afterResizeCounter += 1;\n        if ( this.unloaded && height != current_height && this.afterResizeCounter == 1 ) { \n            return ; \n        }\n\n        this.element.style.height = `${new_height}px`;\n    }\n\n    display(request) {\n        var displayed = new defer();\n\n        if (!this.displayed) {\n\n            this.render(request)\n                .then(function () {\n\n                    this.emit(EVENTS.VIEWS.DISPLAYED, this);\n                    this.onDisplayed(this);\n\n                    this.displayed = true;\n                    displayed.resolve(this);\n\n                }.bind(this), function (err) {\n                    displayed.reject(err, this);\n                });\n\n        } else {\n            displayed.resolve(this);\n        }\n\n\n        return displayed.promise;\n    }\n\n    show() {\n        super.show();\n        this.element.classList.remove('epub-view---loading');\n    }\n\n    hide() {\n        super.hide();\n    }\n\n    onLoad(event, promise) {\n\n      this.window = this.iframe.contentWindow;\n      this.document = this.iframe.contentDocument;\n\n      this.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n      this.contents.axis = this.settings.axis;\n\n      this.rendering = false;\n      this.afterResizeCounter = 0;\n\n      var link = this.document.querySelector(\"link[rel='canonical']\");\n      if (link) {\n        link.setAttribute(\"href\", this.section.canonical);\n      } else {\n        link = this.document.createElement(\"link\");\n        link.setAttribute(\"rel\", \"canonical\");\n        link.setAttribute(\"href\", this.section.canonical);\n        this.document.querySelector(\"head\").appendChild(link);\n      }\n\n      this.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n        if(this.displayed && this.iframe) {\n          this.expand();\n          if (this.contents) {\n            // console.log(\"AHOY EXPAND\", this.index, this.layout.columnWidth, this.layout.height);\n            this.layout.format(this.contents);\n          }\n        }\n      });\n\n      this.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n        if(this.displayed && this.iframe) {\n          this.expand();\n          if (this.contents) {\n            // console.log(\"AHOY RESIZE\", this.index, this.layout.columnWidth, this.layout.height);\n            this.layout.format(this.contents);\n          }\n        }\n      });\n\n      promise.resolve(this.contents);\n    }\n\n    unload() {\n\n        for (let cfiRange in this.highlights) {\n            this.unhighlight(cfiRange);\n        }\n\n        for (let cfiRange in this.underlines) {\n            this.ununderline(cfiRange);\n        }\n\n        for (let cfiRange in this.marks) {\n            this.unmark(cfiRange);\n        }\n\n        if (this.pane) {\n            this.element.removeChild(this.pane.element);\n            this.pane = undefined;\n        }\n\n        if (this.blobUrl) {\n            revokeBlobUrl(this.blobUrl);\n        }\n\n        if(this.displayed){\n            this.displayed = false;\n\n            this.removeListeners();\n\n            this.stopExpanding = true;\n            this.element.removeChild(this.iframe);\n            this.element.style.visibility = \"hidden\";\n\n            this.unloaded = true;\n\n            this.iframe = undefined;\n            this.contents = undefined;\n\n            // this._textWidth = null;\n            // this._textHeight = null;\n            // this._width = null;\n            // this._height = null;\n        }\n\n        // this.element.style.height = \"0px\";\n        // this.element.style.width = \"0px\";\n    }\n\n    // setLayout(layout) {\n        \n    // }\n\n}\n\nexport default StickyIframeView;\n\n","import Url from \"epubjs/src/utils/url\";\nimport * as Browser from '../core/Browser';\n\nvar BaseUpdater = class {\n  constructor(options={}) {\n    this.reader = options.reader;\n    this.contents = options.contents;\n    this.layout = this.reader._rendition.manager.layout;\n  }\n\n  test(element) {\n    return ( element.matches(this.selector) );\n  }\n\n  stylesheet() {\n    return {};\n  }\n\n  update(element) {\n\n  }\n}\n\nvar TableUpdater = class extends BaseUpdater {\n\n  constructor(options={}) {\n    super(options);\n    this.selector = 'table';\n  }\n\n  test(element) {\n    // this data attribute enables us to force these dynamic tables on or off in the EPUB markup\n    var force_table_modal_to = element.getAttribute('data-fulcrum-table');\n    // clipping is buggy in IE\n    return ( \n      super.test(element) && \n      ! ( Browser.ie || Browser.edge ) &&\n      ( force_table_modal_to == 'true' ||\n        ( force_table_modal_to != 'false' && ( element.offsetHeight >= ( this.layout.height * 0.75 ) ) )\n      )\n    );\n  }\n\n  stylesheet() {\n    return {\n      'table.cozy-mangled-clipped': {\n        'break-inside': 'avoid',\n        'width': `${this.layout.columnWidth * 0.95}px !important`,\n        'table-layout': 'fixed'\n      },\n      'table.cozy-mangled-clipped tbody': {\n        'height': `${this.layout.height * 0.25}px !important`,\n        overflow: 'scroll !important',\n        display: 'block !important',\n        position: 'relative !important',\n        width: '100%'\n      },\n      'table.cozy-mangled-clipped thead': {\n        overflow: 'scroll !important',\n        display: 'block !important'\n      },\n      'table.cozy-mangled-clipped tr': {\n        display: 'block !important'\n      },\n      'table.cozy-mangled-clipped::after': {\n        content: \"\",\n        display: 'block',\n        break: 'all'\n      },\n      '.cozy-mangled-popup-table--container': {\n        position: 'absolute',\n        display: 'flex',\n        'align-items': 'center',\n        'justify-content': 'center',\n        top: '0px',\n        bottom: '0px',\n        right: '0px',\n        left: '0px',\n        'background-color': 'rgba(255, 255, 255, 0.75)'\n      }\n    }\n  }\n\n  update(table) {\n    var reader = this.reader;\n    var contents = this.contents;\n\n    // find a dang background color\n    var element = table;\n    var styles\n    var bgcolor;\n    while ( bgcolor === undefined && element instanceof HTMLElement ) {\n      styles = window.getComputedStyle(element);\n      if ( styles.backgroundColor != 'rgba(0, 0, 0, 0)' && styles.backgroundColor != 'transparent' ) {\n        bgcolor = styles.backgroundColor;\n        break;\n      }\n      element = element.parentNode;\n    }\n\n    if ( ! bgcolor ) {\n      // no background color defined in the EPUB, so what is cozy-sun-bear using?\n      element = reader._panes['epub'];\n      while ( bgcolor === undefined && element instanceof HTMLElement ) {\n        styles = window.getComputedStyle(element);\n        if ( styles.backgroundColor != 'rgba(0, 0, 0, 0)' && styles.backgroundColor != 'transparent' ) {\n          bgcolor = styles.backgroundColor;\n          break;\n        }\n        element = element.parentNode;\n      }\n    }\n\n    if ( ! bgcolor ) { bgcolor = '#fff'; }\n\n    var tableHTML = table.outerHTML;\n\n    table.classList.add('cozy-mangled-clipped');\n\n    var div = document.createElement('div');\n    div.classList.add('cozy-mangled-popup-table--container');\n    table.querySelector('tbody').appendChild(div);\n\n    var button = document.createElement('button');\n    button.classList.add('cozy-mangled-popup--action');\n    button.innerText = 'Open table';\n\n    var tableId = table.getAttribute('data-id');\n    if ( ! tableId ) {\n      var ts = ( new Date() ).getTime();\n      tableId = \"table\" + ts + Math.random(ts);\n      table.setAttribute('data-id', tableId);\n    }\n\n    reader._originalHTML[tableId] = tableHTML;\n    // button.dataset.tableHTML = tableHTML;\n    button.addEventListener('click', function(event) {\n      event.preventDefault();\n\n      var regex = /<body[^>]+>/;\n      var index0 = contents._originalHTML.search(regex);\n      var tableHTML = reader._originalHTML[tableId];\n      var newHTML = contents._originalHTML.substr(0, index0) + `<body style=\"padding: 1.5rem; background: ${bgcolor}\"><section>${tableHTML}</section></body></html>`;\n\n      reader.popup({\n        title: 'View Table',\n        srcdoc: newHTML,\n        onLoad: function(contentDocument, modal) {\n          // adpated from epub.js#replaceLinks --- need to catch _any_ link\n          // to close the modal\n          var base = contentDocument.querySelector(\"base\");\n          var location = base ? base.getAttribute(\"href\") : undefined;\n\n          var links = contentDocument.querySelectorAll('a[href]');\n          for(var i = 0; i < links.length; i++) {\n            var link = links[i];\n            var href = link.getAttribute('href');\n            link.addEventListener('click', function(event) {\n              modal.closeModal();\n              var absolute = (href.indexOf('://') > -1);\n              if ( absolute ) {\n                link.setAttribute('target', '_blank');\n              } else {\n                var linkUrl = new Url(href, location);\n                if (linkUrl) {\n                  event.preventDefault();\n                  reader.display(linkUrl.Path.path + ( linkUrl.hash ? linkUrl.hash : '' ));\n                }\n              }\n            })\n          }\n        }\n      })\n\n    })\n\n    div.appendChild(button);\n  }\n}\n\nvar EnhancedFigureUpdater = class extends BaseUpdater {\n  constructor(options={}) {\n    super(options);\n    this.selector = '[data-resource-type]';\n  }\n\n  stylesheet() {\n    return {\n      '.cozy-mangled-popup-figure--container': {\n        'text-align': 'center !important',\n        'padding': '16px !important'\n      }\n    }\n  }\n\n  update(element) {\n    var button = document.createElement('button');\n    button.classList.add('cozy-mangled-popup--action');\n    button.innerText = `Open ${element.dataset.resourceType.replace(/-/g, ' ')}`;\n\n    var div = document.createElement('div');\n    div.classList.add('cozy-mangled-popup-figure--container');\n    var target = element.querySelector('[data-resource-trigger]');\n    if ( target ) {\n      // parent.innerHTML = '';\n      target.replaceWith(div);\n    } else {\n      element.appendChild(div);\n    }\n\n    var iframe_href = element.dataset.href;\n    var iframe_title = element.dataset.title;\n\n    div.appendChild(button);\n    button.addEventListener('click', function(event) {\n      event.preventDefault();\n\n      reader.popup({\n        title: 'View ' + iframe_title,\n        href: iframe_href,\n        onLoad: function(contentDocument, modal) {\n        }\n      })\n\n    })\n  }\n}\n\nexport function handlePopups(reader, contents) {\n  // var selectors = [ table_config.selector ];\n  var updaters = [];\n  // if ( _rendition.manager.layout.name == 'reflowable' && ! ( Browser.ie || Browser.edge ) ) {\n  // }\n  updaters.push(new TableUpdater({reader, contents}));\n  updaters.push(new EnhancedFigureUpdater({reader, contents}));\n\n  var selectors = [];\n  updaters.forEach((updater) => {\n    selectors.push(updater.selector);\n  })\n\n  var elements = contents.document.querySelectorAll(selectors.join(','));\n\n  var queue = [];\n  for(var i = 0; i < elements.length; i++) {\n    var element = elements[i];\n    updaters.forEach((updater) => {\n      var check = true;\n      if ( ! updater.test(element) ) { return; }\n      queue.push([element, updater])\n    })\n  }\n\n  if ( ! queue.length ) { return ; }\n\n  contents.document.body.classList.add('cozy-mangled--enhanced');\n  contents._originalHTML = contents.document.documentElement.outerHTML;\n  contents._initialized = {};\n  reader._originalHTML = reader._originalHTML || {};\n\n  contents.addStylesheetRules({\n    '.cozy-mangled-popup--action': {\n      cursor: 'pointer',\n      'background-color': '#000000',\n      color: '#ffffff',\n      margin: '2px 0',\n      border: '1px solid transparent',\n      'border-radius': '4px',\n      'box-shadow': '0 0 0 2px #ddd, 0px 0px 0px 4px #666',\n      padding: '1rem 1rem',\n      'text-transform': 'uppercase'\n    },\n    '.cozy-mangled-popup--action:active': {\n      transform: 'translateY(1px)',\n      filter: 'saturate(150%)'\n    },\n    '.cozy-mangled-popup--action:hover, .cozy-mangled-popup--action:focus': {\n      color: '#000000',\n      'border-color': 'currentColor',\n      'background-color': 'white'\n    }\n  })\n\n  var initialized = {};\n  queue.forEach(([element, updater]) => {\n    if ( ! initialized[updater.selector] ) { contents.addStylesheetRules(updater.stylesheet()) }\n    updater.update(element);\n  });\n\n}\n","\nvar INTERACTIVE = {};\nINTERACTIVE['A'] = true;\nINTERACTIVE['SELECT'] = true;\nINTERACTIVE['BUTTON'] = true;\nINTERACTIVE['INPUT'] = true;\n\nvar installedResizeHandler = false;\n\nfunction isInteractive(node) {\n  if ( INTERACTIVE[node.nodeName] ) {\n    // possibly...\n    if ( node.nodeName == 'A' ) { return node.hasAttribute('href'); }\n    return true;\n  }\n  return false;\n}\n\nfunction hideEverythingInContents(contents) {\n  var elements = contents.document.querySelectorAll('body *');\n  for(var i = 0; i < elements.length; i++) {\n    if ( elements[i].nodeType == Node.ELEMENT_NODE ) {\n      var element = elements[i];\n      element.setAttribute('aria-hidden', true);\n      element.setAttribute('tabindex', '-1');\n    }\n  }\n}\n\nfunction hideEverythingVisible(contents) {\n  var elements = contents.document.querySelectorAll('[aria-hidden=\"false\"]');\n  for(var i = 0; i < elements.length; i++) {\n    if ( elements[i].nodeType == Node.ELEMENT_NODE ) {\n      elements[i].setAttribute('aria-hidden', true);\n      if ( INTERACTIVE[elements[i].nodeName] ) {\n        elements[i].setAttribute('tabindex', '-1');\n      }\n    }\n  }\n}\n\nfunction findMatchingContents(contents, cfi) {\n  for(var content of contents) {\n    if ( cfi.indexOf(content.cfiBase) > -1 ) {\n      return content;\n    }\n  }\n  return null; // ???\n}\n\nfunction showEverythingVisible(container, range) {\n  var selfOrElement = function(node) {\n    return ( node.nodeType == Node.TEXT_NODE ) ? node.parentNode : node;\n  }\n\n  var showNode = function(node) {\n    node.setAttribute('aria-hidden', false);\n    if ( INTERACTIVE[node.nodeName] ) {\n      var bounds = node.getBoundingClientRect();\n      var x = bounds.x;\n      var x2 = x + container.scrollLeft;\n      // console.log(\"AHOY NODE BOUNDS\", node, x, x2,\n      //   \"A\",\n      //   x > container.scrollLeft + container.offsetWidth,\n      //   x < container.scrollLeft,\n      //   \"B\",\n      //   x2 > container.scrollLeft + container.offsetWidth,\n      //   x2 < container.scrollLeft\n      //   )\n      if ( x > container.scrollLeft + container.offsetWidth ||\n           x < container.scrollLeft ) {\n      } else {\n        node.setAttribute('tabindex', 0);\n        node.addEventListener('focus', (event) => {\n          // console.log(\"AHOY FOCUS\", node, container.scrollLeft, container.dataset.scrollLeft);\n          var scrollLeft = parseInt(container.dataset.scrollLeft, 10);\n          setTimeout(() => {\n            container.scrollLeft = scrollLeft;\n          }, 0);\n        })\n      }\n    }\n    // node.setAttribute('tabindex', 0);\n    for(var child of node.children){\n      showNode(child);\n    }\n  }\n\n  var showNodeAndSelf = function(node) {\n    if ( node.getAttribute('aria-hidden') == 'true' ) {\n      showNode(node);\n      var parent = node.parentNode;\n      while ( parent != node.ownerDocument.body ) {\n        // console.log(\"AHOY ACTIVATING UP\", parent);\n        parent.setAttribute('aria-hidden', false);\n        //node.setAttribute('tabindex', 0);\n        parent = parent.parentNode;\n      }\n    }\n  }\n\n  var ancestor = selfOrElement(range.commonAncestorContainer);\n  var startContainer = selfOrElement(range.startContainer);\n  var endContainer = selfOrElement(range.endContainer);\n\n  var _iterator = document.createNodeIterator(\n    ancestor,\n    NodeFilter.SHOW_ALL,\n    {\n      acceptNode: function(node) {\n        return NodeFilter.FILTER_ACCEPT;\n      }\n    }\n  )\n\n  var _nodes = [];\n  while ( _iterator.nextNode() ) {\n    // console.log(\"AHOY ITERATOR\", _nodes.length, _iterator.referenceNode, startContainer, _iterator.referenceNode !== startContainer);\n    if (_nodes.length === 0 && _iterator.referenceNode !== startContainer) continue;\n    _nodes.push(_iterator.referenceNode);\n    if (_iterator.referenceNode === endContainer) break;\n  }\n\n  // console.log(\"AHOY NODES\", _nodes, _nodes[0] == startContainer);\n  if ( _nodes.length == 1 && _nodes[0] == startContainer ) {\n    _nodes.pop();\n    for(var child of startContainer.children) {\n      _nodes.push(child);\n    }\n  }\n\n  _nodes.forEach((node) => {\n    if ( node.nodeType == Node.ELEMENT_NODE ) {\n      showNodeAndSelf(node);\n    } else {\n      showNodeAndSelf(node.parentNode);\n    }\n  })\n}\n\nexport function updateFocus(reader, location) {\n  if ( reader.settings.flow == 'scrolled-doc' ) { return ; }\n  if ( reader.options.disableFocusHandling ) { return ; }\n  setTimeout(() => {\n    if ( location.start.cfi == reader._last_location_start_cfi &&\n         location.end.cfi == reader._last_location_end_cfi ) {\n      return;\n    }\n    reader._last_location_start_cfi = location.start.cfi;\n    reader._last_location_end_cfi = location.end.cfi;\n    __updateFocus(reader, location);\n  }, 0);\n\n  reader._last_location_start = location.start.href;\n}\n\nvar elemsWithBoundingRects = [];\nvar getBoundingClientRect = function(element) {\n  if ( ! element._boundingClientRect ) {\n\n    // If not, get it then store it for future use.\n    element._boundingClientRect = element.getBoundingClientRect();\n    elemsWithBoundingRects.push( element );\n  }\n  return element._boundingClientRect;\n}\n\nvar clearClientRects = function() {\n  var i;\n  for ( i = 0; i < elemsWithBoundingRects.length; i++ ) {\n    if ( elemsWithBoundingRects[ i ] ) {\n      elemsWithBoundingRects[ i ]._boundingClientRect = null;\n    }\n  }\n  elemsWithBoundingRects = [];\n}\n\nexport function __updateFocus(reader, location) {\n  // don't use location\n\n  var selfOrElement = function(node) {\n    return ( node.nodeType == Node.TEXT_NODE ) ? node.parentNode : node;\n  }\n\n  var container = reader._rendition.manager.container;\n  var contents = findMatchingContents(reader._rendition.manager.getContents(), location.start.cfi);\n  hideEverythingVisible(contents);\n\n  var containerX = container.scrollLeft;\n  var containerX2 = container.scrollLeft + container.offsetWidth;\n\n  var _showThisNode = function(node) {\n    var bounds = getBoundingClientRect(node); // node.getBoundingClientRect();\n    var x = bounds.left;\n    var x2 = bounds.left + bounds.width;\n\n    var isVisible = false;\n    if ( x <= containerX && x2 >= containerX2 ) { isVisible = true; }\n    else if ( x >= containerX && x < containerX2 ) { isVisible = true; }\n    else if ( x2 > containerX && x2 <= containerX2 ) { isVisible = true; }\n    // else if ( x <= containerX && x2 <= containerX2 ) { isVisible = true; }\n    // else if ( x >= containerX && x2 <= containerX2 ) { isVisible = true; }\n    // else if ( x >= containerX && x2 > containerX2 ) { isVisible = true; }\n\n    if ( isVisible ) {\n      // console.log(\"AHOY\", isVisible, node, bounds, containerX, containerX2);\n      node.setAttribute('aria-hidden', 'false');\n      if ( isInteractive(node) ) {\n        node.setAttribute('tabindex', '0');\n      }\n      var hasSeenVisibleChild = false;\n      for(var child of node.children) {\n        var retval = _showThisNode(child);\n        if ( retval ) { hasSeenVisibleChild = true; }\n        if ( ! retval && hasSeenVisibleChild ) {\n          break;\n        }\n      }\n    }\n\n    return isVisible;\n  }\n\n  var startRange = new ePub.CFI(location.start.cfi).toRange(contents.document);\n  var startNode = selfOrElement(startRange.startContainer);\n\n  var _nodes = [];\n  var checkNode = startNode;\n  while ( checkNode != contents.document.body ) {\n    var bounds = getBoundingClientRect(checkNode); // checkNode.getBoundingClientRect();\n    var x = bounds.left;\n    var x2 = bounds.left + bounds.width;\n\n    var isVisible = false;\n    // if ( x <= containerX && x2 >= containerX2 ) { isVisible = true; }\n    if ( x >= containerX && x < containerX2 ) { isVisible = true; }\n    else if ( x2 > containerX && x2 <= containerX2 ) { isVisible = true; }\n\n    if ( isVisible ) {\n      startNode = checkNode;\n      checkNode = checkNode.parentNode;\n    } else {\n      break;\n    }\n\n  }\n\n  var parentNode = startNode; // .parentNode;\n  while ( parentNode != contents.document.body ) {\n    parentNode.setAttribute('aria-hidden', false);\n    parentNode = parentNode.parentNode;\n  }\n\n  _showThisNode(startNode);\n\n  var children = startNode.parentNode.children;\n  var doProcess = false;\n  for (var nextNode of children) {\n    if ( nextNode == startNode ) { doProcess = true; }\n    else if ( doProcess ) {\n      var isVisible = _showThisNode(nextNode);\n      if ( ! isVisible ) { break; }\n    }\n  }\n\n  if ( reader.__target ) {\n    var possible = contents.document.querySelector(`#${reader.__target}`);\n    if ( possible && ! reader.options.disableFocusTarget ) {\n      possible.focus();\n      correct_drift(reader);\n      // console.log(\"AHOY FOCUSING\", reader.__target, possible);\n    }\n    reader.__target = null;\n  }\n}\n\nvar _checkLayout = function(reader) {\n  var scrollLeft = reader._manager.container.scrollLeft;\n  var mod = scrollLeft % parseInt(reader._manager.layout.delta, 10);\n  // console.log(\"AHOY checkLayout\", scrollLeft, reader._manager.layout.delta, mod);\n  return mod;\n}\n\nvar correct_drift = function(reader, data={}) {\n  var container = reader._rendition.manager.container;\n\n  var mod;\n  var delta;\n  var x; var xyz;\n  setTimeout(function() {\n    var scrollLeft = container.scrollLeft;\n    // mod = scrollLeft % parseInt(reader._rendition.manager.layout.delta, 10);\n    mod = _checkLayout(reader);\n    // console.log(\"AHOY AHOY keyDown TRAP\", mod, mod / reader._rendition.manager.layout.delta,( mod / reader._rendition.manager.layout.delta ) < 0.99 );\n    if ( mod > 0 && ( mod / reader._rendition.manager.layout.delta ) < 0.99 ) {\n      x = Math.floor(container.scrollLeft / parseInt(reader._rendition.manager.layout.delta, 10));\n      if ( data.shiftKey ) { x -= 0 ; }\n      else { x += 1; }\n      var y = container.scrollLeft;\n      delta = ( x * reader._rendition.manager.layout.delta ) - y;\n      xyz = ( x * reader._rendition.manager.layout.delta );\n      // console.log(\"AHOY AHOY keyDown SHIFT\", mod, reader._rendition.manager.layout.delta, x, delta);\n      reader._rendition.manager.scrollBy(delta);\n    }\n  }, 0);    \n}\n\nexport function setupFocusRules(reader) {\n\n  if ( ! installedResizeHandler ) {\n    installedResizeHandler = true;\n    reader.on('resize', () => {\n      clearClientRects();\n    })\n  }\n\n  var contents = reader._rendition.getContents();\n  contents.forEach( (content) => {\n\n    if ( reader.options.debugFocusHandling ) {\n      content.addStylesheetRules({\n        '[aria-hidden=\"true\"]': {\n          'opacity': '0.25 !important'\n        },\n        ':focus': {\n          'outline': '2px solid goldenrod',\n          'padding': '4px',\n          'background': 'lightgoldenrodyellow'\n        }\n      })\n    }\n\n    hideEverythingInContents(content);\n\n    // --- attempts to heal safari/edge\n    content.document.addEventListener('keydown', function(event) {\n      if ( event.keyCode == 9 ) {\n\n        var activeElement = content.document.activeElement;\n        if ( activeElement ) {\n          reader._manager.container.dataset.scrollLeft = reader._manager.container.scrollLeft;\n        } else {\n          reader._manager.container.dataset.scrollLeft = 0;\n        }\n      }\n    })\n\n    // --- capture internal link clicks?\n    content.on('linkClicked', function(href) {\n      if ( href.indexOf('#') > -1 ) {\n        reader.__target = (href.split('#')[1]);\n      }\n    })\n  });\n\n  var __watchInterval;\n  reader._watchLayout = function(delta=1000) {\n    if ( __watchInterval ) { clearInterval(__watchInterval); return; }\n    __watchInterval = setInterval(() => { return reader._checkLayout(reader) }, delta);\n  }\n\n  reader.on('keyDown', function(data) {\n    reader._manager.container.dataset.scrollLeft = reader._manager.container.scrollLeft;\n    correct_drift(reader, data);\n  })\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport ePub from 'epubjs';\nwindow.ePub = ePub;\nimport * as DomUtil from '../dom/DomUtil';\nimport * as Browser from '../core/Browser';\n\nimport path from \"path-webpack\";\n\nimport PrePaginatedContinuousViewManager from '../epubjs/managers/continuous/prepaginated';\nimport ReusableIframeView from '../epubjs/managers/views/iframe';\n\nimport ScrollingContinuousViewManager from '../epubjs/managers/continuous/scrolling';\nimport StickyIframeView from '../epubjs/managers/views/sticky';\n\nimport { handlePopups } from \"../utils/manglers\";\nimport * as focus from \"../utils/focus\";\n\nimport debounce from 'lodash/debounce';\n\nimport Hook from \"epubjs/src/utils/hook\";\n\nReader.EpubJS = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n    this._epubjs_ready = false;\n    window.xpath = path;\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    if ( typeof(target) == 'function' ) {\n      callback = target;\n      target = undefined;\n    }\n    if ( callback == null ) {\n      callback = function() { };\n    }\n\n    self.rootfiles = [];\n\n    this.options.rootfilePath = this.options.rootfilePath || sessionStorage.getItem('rootfilePath');\n\n    var book_href = this.options.href;\n    var book_options = { packagePath: this.options.rootfilePath };\n    if ( this.options.useArchive ) {\n      book_href = book_href.replace(/\\/(\\w+)\\/$/, '/$1/$1.sm.epub');\n      book_options.openAs = 'epub';\n    }\n    this._book = ePub(book_href, book_options);\n    sessionStorage.removeItem('rootfilePath');\n\n    this._book.loaded.navigation.then(function(toc) {\n      self._contents = toc;\n      self.metadata = self._book.packaging.metadata;\n\n      self.fire('updateContents', toc);\n      self.fire('updateTitle', self._book.packaging.metadata);\n    })\n    this._book.ready.then(function() {\n      self.parseRootfiles();\n\n      self.draw(target, callback);\n\n      if ( self.metadata.layout == 'pre-paginated' ) {\n        // fake it with the spine\n        var locations = [];\n        self._book.spine.each(function(item) {\n          locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n          self.locations._locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n        });\n        self.locations.total = locations.length;\n        var t;\n        var f = function() {\n          if ( self._rendition && self._rendition.manager && self._rendition.manager.stage ) {\n            var location = self._rendition.currentLocation();\n            if ( location && location.start) {\n              self.fire('updateLocations', locations);\n              clearTimeout(t);\n              return;\n            }\n          }\n          t = setTimeout(f, 100);\n        }\n\n        t = setTimeout(f, 100);\n      } else if ( self._book.pageList && self._book.pageList.pageList.length && ! self._book.pageList.locations.length ) {\n        self._book.locations.generateFromPageList(self._book.pageList).then(function(locations) {\n          self.fire('updateLocations', locations);\n        })\n      } else {\n        self._book.locations.generate(1600).then(function(locations) {\n          self.fire('updateLocations', locations);\n        })\n      }\n    })\n    // .then(callback);\n  },\n\n  parseRootfiles: function() {\n    var self = this;\n    self._book.load(self._book.url.resolve(\"META-INF/container.xml\")).then(function(containerDoc) {\n        var rootfiles = containerDoc.querySelectorAll(\"rootfile\");\n        if ( rootfiles.length > 1 ) {\n          for(var i = 0; i < rootfiles.length; i++) {\n            var rootfile = rootfiles[i];\n            var rootfilePath = rootfile.getAttribute('full-path');\n            var label = rootfile.getAttribute('rendition:label');\n            var layout = rootfile.getAttribute('rendition:layout');\n            self.rootfiles.push({\n              rootfilePath: rootfilePath,\n              label: label,\n              layout: layout\n            })\n          }\n        }\n    })\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n\n    if ( self._rendition && ! self._rendition.draft ) {\n      // self._unbindEvents();\n      var container = self._rendition.manager.container;\n      Object.keys(self._rendition.hooks).forEach(function(key) {\n        self._rendition.hooks[key].clear();\n      })\n      self._rendition.destroy();\n      self._rendition = null;\n    }\n\n\n    var key = self.metadata.layout || 'reflowable';\n    var flow = this.options.flow;\n    if ( self._cozyOptions[key] && self._cozyOptions[key].flow ) {\n      flow = self._cozyOptions[key].flow;\n      this.options.flow = flow; // restore from stored preferences\n    }\n\n    if ( flow == 'auto' ) {\n      if ( this.metadata.layout == 'pre-paginated' ) {\n          if ( this._container.offsetHeight <= this.options.forceScrolledDocHeight ){\n            flow = 'scrolled-doc';\n          }\n      } else {\n        // flow = 'paginated';\n        flow = this.metadata.flow || 'auto';\n      }\n    }\n\n    // if ( flow == 'auto' && this.metadata.layout == 'pre-paginated' ) {\n    //   if ( this._container.offsetHeight <= this.options.forceScrolledDocHeight ){\n    //     flow = 'scrolled-doc';\n    //   }\n    // }\n\n    // var key = `${flow}/${self.metadata.layout}`;\n    if ( self._cozyOptions[key] ) {\n      if ( self._cozyOptions[key].text_size ) {\n        self.options.text_size = self._cozyOptions[key].text_size;\n      }\n      if ( self._cozyOptions[key].scale ) {\n        self.options.scale = self._cozyOptions[key].scale;\n      }\n    }\n\n    this.settings = { flow: flow, stylesheet: this.options.injectStylesheet };\n    this.settings.manager = this.options.manager || 'default';\n\n    // if ( this.settings.flow == 'auto' && this.metadata.layout == 'pre-paginated' ) {\n    //   // dumb check to see if the window is _tall_ enough to put\n    //   // two pages side by side\n    //   if ( this._container.offsetHeight <= this.options.forceScrolledDocHeight ) {\n    //     this.settings.flow = 'scrolled-doc';\n\n    //     // this.settings.manager = PrePaginatedContinuousViewManager;\n    //     // this.settings.view = ReusableIframeView;\n\n    //     this.settings.manager = ScrollingContinuousViewManager;\n    //     this.settings.view = StickyIframeView;\n    //     this.settings.width = '100%'; // 100%?\n    //     this.settings.spine = this._book.spine;\n    //   }\n    // }\n\n    if ( this.settings.flow == 'auto' || this.settings.flow == 'paginated' ) {\n      this._panes['epub'].style.overflow = this.metadata.layout == 'pre-paginated' ? 'auto' : 'hidden';\n      this.settings.manager = 'default';\n    } else {\n      this._panes['epub'].style.overflow = 'auto';\n      if ( this.settings.manager == 'default' ) {\n        // this.settings.manager = 'continuous';\n        // CSB-272, CSB-277 - continuous scroll \"exclude list\" by ISBN (Gabii 2, Mittell...)\n        const no_continuous_scroll_isbns = ['9780472999064', '9781643150611'];\n        if ( no_continuous_scroll_isbns.includes(this.metadata.identifier) ) {\n          this.settings.manager = 'default';\n        } else {\n          this.settings.manager = ScrollingContinuousViewManager;\n          this.settings.view = StickyIframeView;\n        }\n        this.settings.width = '100%'; // 100%?\n        this.settings.spine = this._book.spine;\n\n      }\n    }\n\n    if ( ! callback ) {\n      callback = function() { };\n    }\n\n    self.settings.height = '100%';\n    self.settings.width = '100%';\n    self.settings['ignoreClass'] = 'annotator-hl';\n\n    if ( this.metadata.layout == 'pre-paginated' && this.settings.manager == 'continuous' ) {\n        // this.settings.manager = 'prepaginated';\n        // this.settings.manager = PrePaginatedContinuousViewManager;\n        // this.settings.view = ReusableIframeView;\n        this.settings.manager = ScrollingContinuousViewManager;\n        this.settings.view = StickyIframeView;\n        this.settings.spread = 'none';\n    }\n\n    if ( this.settings.manager == ScrollingContinuousViewManager ) {\n      if ( this.metadata.layout != 'pre-paginated' && ! this.options.minHeight ) {\n        this.options.minHeight = this._panes['book'].offsetHeight * 0.75;\n      }\n      if ( this.options.minHeight ) {\n        this.settings.minHeight = this.options.minHeight;\n      }\n    }\n\n    if ( self.options.scale != '100' ) {\n      self.settings.scale = parseInt(self.options.scale, 10) / 100;\n    }\n\n    self._panes['book'].dataset.manager = this.settings.manager + ( this.settings.spread ? `-${this.settings.spread}` : '');\n    self._panes['book'].dataset.layout = this.metadata.layout || 'reflowable';\n\n    self._drawRendition(target, callback);\n  },\n\n  _drawRendition: function(target, callback) {\n    var self = this;\n\n    // self._rendition = self._book.renderTo(self._panes['epub'], self.settings);\n    self.rendition = new ePub.Rendition(self._book, self.settings);\n    self._book.rendition = self._rendition;\n\n    this._rendition.settings.prehooks = {};\n    this._rendition.settings.prehooks.head = new Hook(this);\n\n    self._updateFontSize();\n    self._rendition.attachTo(self._panes['epub']);\n\n    self._bindEvents();\n    self._drawn = true;\n\n    if ( target && target.start ) { target = target.start; }\n    if ( ! target && window.location.hash ) {\n      if ( window.location.hash.substr(1, 3) == '/6/' ) {\n        var original_target = window.location.hash.substr(1);\n        target = decodeURIComponent(window.location.hash.substr(1));\n        target = \"epubcfi(\" + target + \")\";\n      } else {\n        target = window.location.hash.substr(2);\n        target = self._book.url.path().resolve(decodeURIComponent(target));\n      }\n    }\n\n    var status_index = 0;\n    self._rendition.on('started', function() {\n      self._manager = self._rendition.manager;\n\n      self._rendition.manager.on(\"building\", function(status) {\n        if ( status ) {\n          status_index += 1;\n          self._panes['loader-status'].innerHTML = `<span>${Math.round((status_index / status.total) * 100.0)}%</span>`;\n        } else {\n          self._enableBookLoader(-1);\n        }\n      })\n      self._rendition.manager.on(\"built\", function() {\n        self._disableBookLoader(true);\n      })\n\n      self.fire('renditionStarted', self._rendition);\n    })\n\n    self._rendition.hooks.content.register(function(contents) {\n      self.fire('ready:contents', contents);\n      self.fire('readyContents', contents);\n\n      // check for tables + columns + popups\n      if ( self._rendition.manager.layout.name == 'reflowable' ) {\n        handlePopups(self, contents);\n      }\n\n    })\n\n    self.display(target, function() {\n      window._loaded = true;\n      self._initializeReaderStyles();\n\n      if ( callback ) { callback(); }\n\n      self._epubjs_ready = true;\n\n      self.display(target, function() {\n        setTimeout(function() {\n          self.fire('opened');\n          self.fire('ready');\n          self._disableBookLoader();\n          clearTimeout(self._queueTimeout);\n          self.tracking.event(\"openBook\", {\n            rootFilePath: self.options.rootFilePath,\n            flow: self.settings.flow,\n            manager: self.settings.manager\n          });\n        }, 100);\n      })\n\n    })\n  },\n\n  _scroll: function(delta) {\n    var self = this;\n    if ( self.options.flow == 'XXscrolled-doc' ) {\n      var container = self._rendition.manager.container;\n      var rect = container.getBoundingClientRect();\n      var scrollTop = container.scrollTop;\n      var newScrollTop = scrollTop;\n      var scrollBy = ( rect.height * 0.98 );\n      switch(delta) {\n        case 'PREV':\n          newScrollTop = -( scrollTop + scrollBy );\n          break;\n        case 'NEXT':\n          newScrollTop = ( scrollTop + scrollBy );\n          break;\n        case 'HOME':\n          newScrollTop = 0;\n          break;\n        case 'END':\n          newScrollTop = container.scrollHeight - scrollBy;\n          break;\n      }\n      container.scrollTop = newScrollTop;\n      return ( Math.floor(container.scrollTop) != Math.floor(scrollTop) );\n    }\n    return false;\n  },\n\n  _navigate: function(promise, callback) {\n    var self = this;\n    self._enableBookLoader(100);\n    promise.then(function() {\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n    }).catch(function(e) {\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n      console.log(\"AHOY NAVIGATE ERROR\", e);\n      throw(e);\n    })\n  },\n\n  next: function() {\n    var self = this;\n    this.tracking.action('reader/go/next');\n    self._scroll('NEXT') || self._navigate(this._rendition.next());\n  },\n\n  prev: function() {\n    this.tracking.action('reader/go/previous');\n    this._scroll('PREV') || this._navigate(this._rendition.prev());\n  },\n\n  first: function() {\n    this.tracking.action('reader/go/first');\n    this._navigate(this._rendition.display(0), undefined);\n  },\n\n  last: function() {\n    var self = this;\n    this.tracking.action('reader/go/last');\n    var target = this._book.spine.length - 1;\n    this._navigate(this._rendition.display(target), undefined);\n  },\n\n  display: function(target, callback) {\n    var self = this;\n\n    var hash;\n    if ( target != null ) {\n      var section = this._book.spine.get(target);\n      if ( ! section) {\n        // maybe it needs to be resolved\n        var guessed = target;\n        if ( guessed.indexOf(\"://\") < 0 ) {\n          var path1 = path.resolve(this._book.path.directory, this._book.packaging.navPath);\n          var path2 = path.resolve(path.dirname(path1), target);\n          guessed = this._book.canonical(path2);\n        }\n        if ( guessed.indexOf(\"#\") !== 0 ) {\n          hash = guessed.split('#')[1];\n          guessed = guessed.split('#')[0];\n        }\n\n        this._book.spine.each(function(item) {\n          if ( item.canonical == guessed ) {\n            section = item;\n            target = section.href;\n            return;\n          }\n        })\n\n        if ( hash ) {\n          target = target + '#' + hash;\n        }\n\n        // console.log(\"AHOY GUESSED\", target);\n      } else if ( target.toString().match(/^\\d+$/) ) {\n        // console.log(\"AHOY USING\", section.href);\n        target = section.href;\n      }\n\n      if ( ! section ) {\n        if ( ! this._epubjs_ready ) {\n          target = 0;\n        } else {\n          return;\n        }\n      }\n    }\n\n    self.tracking.reset();\n    var navigating = this._rendition.display(target).then(function() {\n      this._rendition.display(target);\n    }.bind(this));\n    this._navigate(navigating, callback);\n  },\n\n  gotoPage(target, callback) {\n    return this.display(target, callback)\n  },\n\n  percentageFromCfi: function(cfi) {\n    return this._book.percentageFromCfi(cfi);\n  },\n\n  destroy: function() {\n    if ( this._rendition ) {\n      try {\n        this._rendition.destroy();\n      } catch(e) {}\n    }\n    this._rendition = null;\n    this._drawn = false;\n  },\n\n  reopen: function(options, target) {\n    // different per reader?\n    var target = target || this.currentLocation();\n    if( target.start ) { target = target.start ; }\n    if ( target.cfi ) { target = target.cfi ; }\n\n    var doUpdate = false;\n    if ( options === true ) { doUpdate = true; options = {}; }\n    var changed = {};\n    Object.keys(options).forEach(function(key) {\n      if ( options[key] != this.options[key] ) {\n        doUpdate = true;\n        changed[key] = true;\n      }\n      // doUpdate = doUpdate || ( options[key] != this.options[key] );\n    }.bind(this));\n\n    if ( ! doUpdate ) {\n      return;\n    }\n\n    // performance hack\n    if ( Object.keys(changed).length == 1 && changed.scale ) {\n      this.options.scale = options.scale;\n      this._updateScale();\n      return;\n    }\n\n    if ( options.rootfilePath && options.rootfilePath != this.options.rootfilePath ) {\n      // we need to REOPEN THE DANG BOOK\n      sessionStorage.setItem('rootfilePath', options.rootfilePath);\n      location.reload();\n      return;\n    }\n\n    Util.extend(this.options, options);\n\n    this.draw(target, function() {\n      // this._updateFontSize();\n      this._updateScale();\n      this._updateTheme();\n      this._selectTheme(true);\n    }.bind(this))\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) {\n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    // add a stylesheet to stop images from breaking their columns\n    var add_max_img_styles = false;\n    if ( this._book.packaging.metadata.layout == 'pre-paginated' ) {\n      // NOOP\n    } else if ( this.options.flow == 'auto' || this.options.flow == 'paginated' ) {\n      add_max_img_styles = true;\n    }\n\n    var custom_stylesheet_rules = [];\n\n    // force 90% height instead of default 60%\n    if ( this.metadata.layout != 'pre-paginated' ) {\n      if ( this.options.flow == 'scrolled-doc' ) {\n        // these prehooks are a hack to avoid the contents hooks applying _after_\n        // the view has been displayed\n        this._rendition.settings.prehooks.head.register(function(buffer) {\n          var layout = this.layout;\n          var retval = `\n<style>\nimg {\n  max-width: ${layout.columnWidth ? layout.columnWidth + \"px\" : \"100%\"} !important;\n  max-height: ${(layout.height ? (layout.height * 0.9) + \"px\" : \"90%\")} !important;\n  object-fit: contain;\n  page-break-inside: avoid;\n}\nsvg {\n  max-width: ${layout.columnWidth ? layout.columnWidth + \"px\" : \"100%\"} !important;\n  max-height: ${(layout.height ? (layout.height * 0.9) + \"px\" : \"90%\")} !important;\n  page-break-inside: avoid;\n}\nbody {\n  overflow: hidden;\n  column-rule: 1px solid #ddd;\n}\n</style>\n          ` \n          buffer.push(retval);\n        }.bind(this._rendition));\n      }\n      // --- KEEP THIS IN CASE WE HAVE TO REVERT THE PREHOOKS\n      // this._rendition.hooks.content.register(function(contents) {\n      //   contents.addStylesheetRules({\n      //     \"img\" : {\n      //       \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n      //       \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n      //       \"object-fit\": \"contain\",\n      //       \"page-break-inside\": \"avoid\"\n      //     },\n      //     \"svg\" : {\n      //       \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n      //       \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n      //       \"page-break-inside\": \"avoid\"\n      //     },\n      //     \"body\": {\n      //       \"overflow\": \"hidden\",\n      //       \"column-rule\": \"1px solid #ddd\"\n      //     }\n      //   });\n      // }.bind(this._rendition))\n    } else {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            // \"border\": \"64px solid black !important\",\n            \"box-sizing\": \"border-box !important\"\n          },\n          \"figure\": {\n            \"box-sizing\": \"border-box !important\",\n            \"margin\": \"0 !important\"\n          },\n          \"body\": {\n            \"margin\": \"0\",\n            \"overflow\": \"hidden\"\n          }\n        });\n      }.bind(this._rendition));\n    }\n\n    this._updateFontSize();\n\n    if ( custom_stylesheet_rules.length ) {\n      this._rendition.hooks.content.register(function(view) {\n        view.addStylesheetRules(custom_stylesheet_rules);\n      })\n    }\n\n    this._rendition.on('resized', function(box) {\n      self.fire('resized', box);\n    })\n\n    this._rendition.on('click', function(event, contents) {\n      if ( event.isTrusted ) {\n        this.tracking.action(\"inline/go/link\");\n      }\n    }.bind(this));\n\n    this._rendition.on('keydown', function(event, contents) {\n      var target = event.target;\n      var IGNORE_TARGETS = [ 'input', 'textarea' ];\n      if ( IGNORE_TARGETS.indexOf(target.localName) >= 0 ) {\n        return;\n      }\n      this.fire('keyDown', { keyName: event.key, shiftKey: event.shiftKey, inner: true });\n    }.bind(this));\n\n    var relocated_handler = debounce(function(location) {\n      if ( self._fired ) { self._fired = false; return ; }\n      self.fire('relocated', location);\n\n      // hideEverything/showEverything\n      focus.updateFocus(self, location);\n\n      if ( Browser.safari && self._last_location_start && self._last_location_start != location.start.href ) {\n        self._fired = true;\n        setTimeout(function() {\n          // self._rendition.display(location.start.cfi);\n        }, 0);\n      }\n    }, 10);\n\n    this._rendition.on('relocated', relocated_handler);\n\n    this._rendition.on('displayerror', function(err) {\n      console.log(\"AHOY RENDITION DISPLAY ERROR\", err);\n      self.fire('displayerror', err);\n    })\n\n    var locationChanged_handler = debounce(function(location) {\n      var view = this.manager.current();\n      if ( ! view ) { return ; }\n      var section = view.section;\n      var current = this.book.navigation.get(section.href);\n\n      self.fire(\"updateSection\", current);\n      self.fire(\"updateLocation\", location);\n    }, 150);\n\n    this._rendition.on(\"locationChanged\", locationChanged_handler);\n\n    this.on('updateLocations', function() {\n      // trigger this when all the locations have been loaded from the spine\n      this._rendition.emit('relocated', this._rendition.currentLocation());\n    })\n\n    this._rendition.on(\"rendered\", function(section, view) {\n      self._updateFrameTitle(section, view);\n    });\n\n    this._rendition.on(\"rendered\", function(section, view) {\n\n      if ( self.settings.flow == 'scrolled-doc' ) { return ; }\n      if ( Browser.ie ) { self.options.disableFocusHandling = true; return ; }\n\n      // add focus rules\n      focus.setupFocusRules(self);\n\n    })\n  },\n\n  _initializeReaderStyles: function() {\n    var self = this;\n    var themes = this.options.themes;\n    if ( themes ) {\n      themes.forEach(function(theme) {\n        self._rendition.themes.register(theme['klass'], theme.href ? theme.href : theme.rules);\n      })\n    }\n\n    // base for highlights\n    // this._rendition.themes.override('.epubjs-hl', \"fill: yellow; fill-opacity: 0.3; mix-blend-mode: multiply;\");\n  },\n\n  _selectTheme: function(refresh) {\n    var theme = this.options.theme || 'default';\n    this._rendition.themes.select(theme);\n  },\n\n  _updateFontSize: function() {\n    if ( false && this.metadata.layout == 'pre-paginated') {\n      // we're not doing font changes for pre-paginated\n      return;\n    }\n\n    var text_size = this.options.text_size || 100; // this.options.modes[this.flow].text_size; // this.options.text_size == 'auto' ? 100 : this.options.text_size;\n    if ( text_size == 100 ) { \n      // do not add an unncessary override\n      if ( ! this._rendition.themes._overrides['font-size'] ) {\n        return; \n      }\n    }\n    this._rendition.themes.fontSize(`${text_size}%`);\n\n    // --- prehook avoids jitter but cannot be readily replaced\n    // --- TODO: if this is the first font-size setting could use prehook\n    // --- else: use `themes.fontSize`\n    // this._rendition.settings.prehooks.head.register(function(buffer) {\n    //   buffer.push(`<style>body { font-size: ${text_size}%; }</style>`);\n    // })\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    // var scale = this.options.modes[this.flow].scale;\n    var scale = this.options.scale;\n    if ( scale ) {\n      this.settings.scale = parseInt(scale, 10) / 100.0;\n      this._queueScale();\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        this._rendition.scale(this.settings.scale);\n        var text_size = this.settings.scale == 1.0 ? 100 : this.settings.scale * 100.0;\n        this._rendition.themes.fontSize(`${text_size}%`);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  _updateFrameTitle: function(section, view) {\n    var self = this;\n\n    var title = `Section ${section.index + 1}`;\n    var current = self._book.navigation && self._book.navigation.get(section.href);\n    if ( ! current ) {\n      var subtitle;\n      for(var tag of [ 'h1', 'h2' ]) {\n        var tmp = view.document.querySelectorAll(tag);\n        if ( tmp ) {\n          var buffer = [];\n          for(var i = 0; i < tmp.length; i++) {\n            buffer.push(tmp[i].innerText);\n            if ( tag == 'h2' ) { break; } // only one of these\n          }\n          subtitle = buffer.join(' - ');\n          break;\n        }\n      }\n      if ( ! subtitle ) {\n        for(var i = section.index; i >= 0; i--) {\n          var previousSection = self._book.spine.get(i);\n          var previous = self._book.navigation.get(previousSection.href);\n          if ( previous ) {\n            subtitle = previous.label;\n            break;\n          }\n        }\n      }\n      if ( subtitle ) {\n        title += ': ' + subtitle;\n      }\n    } else {\n      title += ': ' + current.label;\n    }\n    if ( title && view.iframe ) {\n      view.iframe.title = `Contents: ${title}` ;\n    }\n    // Ugly hijack to enable hotjar HELIO-4198\n    view.iframe.setAttribute(\"data-hj-allow-iframe\", \"true\");\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.EpubJS.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'annotations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    if ( Browser.ie ) {\n      return {\n        reset: function() { /* NOOP */ },\n        highlight: function(cfiRange) { /* NOOP */ }\n      }\n    }\n    if ( ! this._rendition.annotations.reset ) {\n      this._rendition.annotations.reset = function(){\n        for(var hash in this._annotations) {\n            var cfiRange = decodeURI(hash);\n            this.remove(cfiRange);\n        }\n        this._annotationsBySectionIndex = {};\n      }.bind(this._rendition.annotations);\n    }\n    return this._rendition.annotations;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._book.locations;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'pageList', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._book.pageList.pageList.length > 0 ? this._book.pageList : undefined;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'rendition', {\n  get: function() {\n    if ( ! this._rendition ) {\n      this._rendition = { draft: true };\n      this._rendition.hooks = {};\n      this._rendition.hooks.content = new Hook(this);\n    }\n    return this._rendition;\n  },\n\n  set: function(rendition) {\n    if ( this._rendition && this._rendition.draft ) {\n      var hook = this._rendition.hooks.content;\n      hook.hooks.forEach(function(fn) {\n        rendition.hooks.content.register(fn)\n      })\n    }\n    this._rendition = rendition;\n  }\n})\n\n\nObject.defineProperty(Reader.EpubJS.prototype, 'CFI', {\n  get: function() {\n    return ePub.CFI;\n  }\n})\n\nwindow.Reader = Reader;\n\nexport function createReader(id, options) {\n  return new Reader.EpubJS(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.Mock = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    this._book = {\n      metadata: {\n        title: 'The Mock Life',\n        creator: 'Alex Mock',\n        publisher: 'University Press',\n        location: 'Ann Arbor, MI',\n        pubdate: '2017-05-23'\n      },\n      contents: {\n        toc: [\n          {id: 1, href: \"/epubs/mock/ops/xhtml/TitlePage.xhtml\", label: \"Title\", parent: null},\n          {id: 2, href: \"/epubs/mock/ops/xhtml/Chapter01.xhtml\", label: \"Chapter 1\", parent: null},\n          {id: 3, href: \"/epubs/mock/ops/xhtml/Chapter02.xhtml\", label: \"Chapter 2\", parent: null},\n          {id: 4, href: \"/epubs/mock/ops/xhtml/Chapter03.xhtml\", label: \"Chapter 3\", parent: null},\n          {id: 5, href: \"/epubs/mock/ops/xhtml/Chapter04.xhtml\", label: \"Chapter 4\", parent: null},\n          {id: 6, href: \"/epubs/mock/ops/xhtml/Chapter05.xhtml\", label: \"Chapter 5\", parent: null},\n          {id: 7, href: \"/epubs/mock/ops/xhtml/Chapter06.xhtml\", label: \"Chapter 6\", parent: null},\n          {id: 8, href: \"/epubs/mock/ops/xhtml/Chapter07.xhtml\", label: \"Chapter 7\", parent: null},\n          {id: 9, href: \"/epubs/mock/ops/xhtml/Index.xhtml\", label: \"Index\", parent: null},\n        ]\n      }\n    };\n\n    this._locations = [\n      'epubcfi(/6/4[TitlePage.xhtml])',\n      'epubcfi(/6/4[Chapter01.xhtml])',\n      'epubcfi(/6/4[Chapter02.xhtml])',\n      'epubcfi(/6/4[Chapter03.xhtml])',\n      'epubcfi(/6/4[Chapter04.xhtml])',\n      'epubcfi(/6/4[Chapter05.xhtml])',\n      'epubcfi(/6/4[Chapter06.xhtml])',\n      'epubcfi(/6/4[Chapter07.xhtml])',\n      'epubcfi(/6/4[Chapter08.xhtml])',\n      'epubcfi(/6/4[Index.xhtml])',\n    ];\n\n    this.__currentIndex = 0;\n\n    this.metadata = this._book.metadata;\n    this.fire('updateContents', this._book.contents);\n    this.fire('updateTitle', this._metadata);\n    this.fire('updateLocations', this._locations);\n    this.draw(target, callback);\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n    this.settings = { flow: this.options.flow };\n    this.settings.height = '100%';\n    this.settings.width = '99%';\n    // this.settings.width = '100%';\n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      callback = target;\n      target = undefined;\n    }\n    callback();\n    self.fire('ready');\n  },\n\n  next: function() {\n    // this._rendition.next();\n  },\n\n  prev: function() {\n    // this._rendition.prev();\n  },\n\n  first: function() {\n    // this._rendition.display(0);\n  },\n\n  last: function() {\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" ) {\n      this.__currentIndex = this._locations.indexOf(target);\n    } else {\n      this.__currentIndex = target;\n    }\n    this.fire(\"relocated\", this.currentLocation());\n  },\n\n  destroy: function() {\n    // if ( this._rendition ) {\n    //   this._rendition.destroy();\n    // }\n    // this._rendition = null;\n  },\n\n  currentLocation: function() {\n    var cfi = this._locations[this.__currentIndex];\n    return {\n      start: { cfi: cfi, href: cfi },\n      end: { cfi: cfi, href: cfi }\n    }\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n  },\n\n  _updateTheme: function() {\n\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.Mock.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    var self = this;\n    return {\n      total: self._locations.length,\n      locationFromCfi: function(cfi) {\n        return self._locations.indexOf(cfi);\n      },\n      percentageFromCfi: function(cfi) {\n        var index = self.locations.locationFromCfi(cfi);\n        return ( index / self.locations.total );\n      },\n      cfiFromPercentage: function(percentage) {\n        var index = Math.ceil(percentage * 10);\n        return self._locations[index];\n      }\n    }\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'annotations', {\n  get: function() {\n    return {\n      reset: function() {},\n      highlight: function() {}\n    }\n  }\n})\n\nexport function createReader(id, options) {\n  return new Reader.Mock(id, options);\n}\n","import {Reader} from './Reader';\nimport * as EpubJS from './Reader.EpubJS';\nimport * as Mock from './Reader.Mock';\n\nvar engines = {\n  epubjs: EpubJS.createReader,\n  mock: Mock.createReader\n}\n\nexport {Reader};\n\nexport var reader = function(id, options) {\n  options = options || {};\n  var engine = options.engine || window.COZY_EPUB_ENGINE || 'epubjs';\n  var engine_href = options.engine_href || window.COZY_EPUB_ENGINE_HREF;\n  var _this = this;\n  var _arguments = arguments;\n\n  options.engine = engine;\n  options.engine_href = engine_href;\n\n  return engines[engine].apply(_this, [id, options]);\n}","\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","/*\n From Zip.js, by Gildas Lormeau\nedited down\n */\n\nvar table = {\n\t\"application\" : {\n\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\n\t\t\"javascript\" : \"js\",\n\t\t\"ogg\" : \"ogx\",\n\t\t\"pdf\" : \"pdf\",\n\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\n\t\t\"rdf+xml\" : \"rdf\",\n\t\t\"smil\" : [ \"smi\", \"smil\" ],\n\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\n\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\" ],\n\t\t\"zip\" : \"zip\",\n\t\t\"x-httpd-eruby\" : \"rhtml\",\n\t\t\"x-latex\" : \"latex\",\n\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\n\t\t\"x-object\" : \"o\",\n\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\n\t\t\"x-silverlight\" : \"scr\",\n\t\t\"epub+zip\" : \"epub\",\n\t\t\"font-tdpfr\" : \"pfr\",\n\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\n\t\t\"json\" : \"json\",\n\t\t\"jsonml+json\" : \"jsonml\",\n\t\t\"mathml+xml\" : \"mathml\",\n\t\t\"metalink+xml\" : \"metalink\",\n\t\t\"mp4\" : \"mp4s\",\n\t\t// \"oebps-package+xml\" : \"opf\",\n\t\t\"omdoc+xml\" : \"omdoc\",\n\t\t\"oxps\" : \"oxps\",\n\t\t\"vnd.amazon.ebook\" : \"azw\",\n\t\t\"widget\" : \"wgt\",\n\t\t// \"x-dtbncx+xml\" : \"ncx\",\n\t\t\"x-dtbook+xml\" : \"dtb\",\n\t\t\"x-dtbresource+xml\" : \"res\",\n\t\t\"x-font-bdf\" : \"bdf\",\n\t\t\"x-font-ghostscript\" : \"gsf\",\n\t\t\"x-font-linux-psf\" : \"psf\",\n\t\t\"x-font-otf\" : \"otf\",\n\t\t\"x-font-pcf\" : \"pcf\",\n\t\t\"x-font-snf\" : \"snf\",\n\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\n\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\n\t\t\"x-font-woff\" : \"woff\",\n\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\n\t\t\"x-mspublisher\" : \"pub\",\n\t\t\"x-nzb\" : \"nzb\",\n\t\t\"x-tgif\" : \"obj\",\n\t\t\"xaml+xml\" : \"xaml\",\n\t\t\"xml-dtd\" : \"dtd\",\n\t\t\"xproc+xml\" : \"xpl\",\n\t\t\"xslt+xml\" : \"xslt\",\n\t\t\"internet-property-stream\" : \"acx\",\n\t\t\"x-compress\" : \"z\",\n\t\t\"x-compressed\" : \"tgz\",\n\t\t\"x-gzip\" : \"gz\",\n\t},\n\t\"audio\" : {\n\t\t\"flac\" : \"flac\",\n\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\n\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\n\t\t\"mpegurl\" : \"m3u\",\n\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\n\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\n\t\t\"x-ms-wma\" : \"wma\",\n\t\t\"x-wav\" : \"wav\",\n\t\t\"adpcm\" : \"adp\",\n\t\t\"mp4\" : \"mp4a\",\n\t\t\"webm\" : \"weba\",\n\t\t\"x-aac\" : \"aac\",\n\t\t\"x-caf\" : \"caf\",\n\t\t\"x-matroska\" : \"mka\",\n\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\n\t\t\"xm\" : \"xm\",\n\t\t\"mid\" : [ \"mid\", \"rmi\" ]\n\t},\n\t\"image\" : {\n\t\t\"gif\" : \"gif\",\n\t\t\"ief\" : \"ief\",\n\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\n\t\t\"pcx\" : \"pcx\",\n\t\t\"png\" : \"png\",\n\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\n\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\n\t\t\"x-icon\" : \"ico\",\n\t\t\"bmp\" : \"bmp\",\n\t\t\"webp\" : \"webp\",\n\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\n\t\t\"x-tga\" : \"tga\",\n\t\t\"cis-cod\" : \"cod\"\n\t},\n\t\"text\" : {\n\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\n\t\t\"css\" : \"css\",\n\t\t\"csv\" : \"csv\",\n\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\n\t\t\"mathml\" : \"mml\",\n\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\n\t\t\"richtext\" : \"rtx\",\n\t\t\"tab-separated-values\" : \"tsv\",\n\t\t\"x-bibtex\" : \"bib\"\n\t},\n\t\"video\" : {\n\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\n\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\n\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\n\t\t\"ogg\" : \"ogv\",\n\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\n\t\t\"x-flv\" : \"flv\",\n\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\n\t\t\"x-mng\" : \"mng\",\n\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\n\t\t\"x-ms-wm\" : \"wm\",\n\t\t\"x-ms-wmv\" : \"wmv\",\n\t\t\"x-ms-wmx\" : \"wmx\",\n\t\t\"x-ms-wvx\" : \"wvx\",\n\t\t\"x-msvideo\" : \"avi\",\n\t\t\"x-sgi-movie\" : \"movie\",\n\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\n\t\t\"3gpp2\" : \"3g2\",\n\t\t\"h261\" : \"h261\",\n\t\t\"h263\" : \"h263\",\n\t\t\"h264\" : \"h264\",\n\t\t\"jpeg\" : \"jpgv\",\n\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\n\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\n\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\n\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\n\t\t\"vnd.vivo\" : \"viv\",\n\t\t\"webm\" : \"webm\",\n\t\t\"x-f4v\" : \"f4v\",\n\t\t\"x-m4v\" : \"m4v\",\n\t\t\"x-ms-vob\" : \"vob\",\n\t\t\"x-smv\" : \"smv\"\n\t}\n};\n\nvar mimeTypes = (function() {\n\tvar type, subtype, val, index, mimeTypes = {};\n\tfor (type in table) {\n\t\tif (table.hasOwnProperty(type)) {\n\t\t\tfor (subtype in table[type]) {\n\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\n\t\t\t\t\tval = table[type][subtype];\n\t\t\t\t\tif (typeof val == \"string\") {\n\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\n\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn mimeTypes;\n})();\n\nvar defaultValue = \"text/plain\";//\"application/octet-stream\";\n\nfunction lookup(filename) {\n\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\n};\n\nmodule.exports = {\n\t'lookup': lookup\n}\n","/* From https://github.com/webcomponents/URL/blob/master/url.js\n * Added UMD, file link handling */\n\n/* Any copyright is dedicated to the Public Domain.\n * http://creativecommons.org/publicdomain/zero/1.0/ */\n'use strict';\n(function (root, factory) {\n    // Fix for this being undefined in modules\n    if (!root) {\n      root = window || global;\n    }\n    if (typeof module === 'object' && module.exports) {\n        // Node\n        module.exports = factory(root);\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else {\n        // Browser globals (root is window)\n        root.URL = factory(root);\n  }\n}(this, function (scope) {\n  // feature detect for URL constructor\n  var hasWorkingUrl = false;\n  if (!scope.forceJURL) {\n    try {\n      var u = new URL('b', 'http://a');\n      u.pathname = 'c%20d';\n      hasWorkingUrl = u.href === 'http://a/c%20d';\n    } catch(e) {}\n  }\n\n  if (hasWorkingUrl)\n    return scope.URL;\n\n  var relative = Object.create(null);\n  relative['ftp'] = 21;\n  relative['file'] = 0;\n  relative['gopher'] = 70;\n  relative['http'] = 80;\n  relative['https'] = 443;\n  relative['ws'] = 80;\n  relative['wss'] = 443;\n\n  var relativePathDotMapping = Object.create(null);\n  relativePathDotMapping['%2e'] = '.';\n  relativePathDotMapping['.%2e'] = '..';\n  relativePathDotMapping['%2e.'] = '..';\n  relativePathDotMapping['%2e%2e'] = '..';\n\n  function isRelativeScheme(scheme) {\n    return relative[scheme] !== undefined;\n  }\n\n  function invalid() {\n    clear.call(this);\n    this._isInvalid = true;\n  }\n\n  function IDNAToASCII(h) {\n    if ('' == h) {\n      invalid.call(this)\n    }\n    // XXX\n    return h.toLowerCase()\n  }\n\n  function percentEscape(c) {\n    var unicode = c.charCodeAt(0);\n    if (unicode > 0x20 &&\n       unicode < 0x7F &&\n       // \" # < > ? `\n       [0x22, 0x23, 0x3C, 0x3E, 0x3F, 0x60].indexOf(unicode) == -1\n      ) {\n      return c;\n    }\n    return encodeURIComponent(c);\n  }\n\n  function percentEscapeQuery(c) {\n    // XXX This actually needs to encode c using encoding and then\n    // convert the bytes one-by-one.\n\n    var unicode = c.charCodeAt(0);\n    if (unicode > 0x20 &&\n       unicode < 0x7F &&\n       // \" # < > ` (do not escape '?')\n       [0x22, 0x23, 0x3C, 0x3E, 0x60].indexOf(unicode) == -1\n      ) {\n      return c;\n    }\n    return encodeURIComponent(c);\n  }\n\n  var EOF = undefined,\n      ALPHA = /[a-zA-Z]/,\n      ALPHANUMERIC = /[a-zA-Z0-9\\+\\-\\.]/;\n\n  function parse(input, stateOverride, base) {\n    function err(message) {\n      errors.push(message)\n    }\n\n    var state = stateOverride || 'scheme start',\n        cursor = 0,\n        buffer = '',\n        seenAt = false,\n        seenBracket = false,\n        errors = [];\n\n    loop: while ((input[cursor - 1] != EOF || cursor == 0) && !this._isInvalid) {\n      var c = input[cursor];\n      switch (state) {\n        case 'scheme start':\n          if (c && ALPHA.test(c)) {\n            buffer += c.toLowerCase(); // ASCII-safe\n            state = 'scheme';\n          } else if (!stateOverride) {\n            buffer = '';\n            state = 'no scheme';\n            continue;\n          } else {\n            err('Invalid scheme.');\n            break loop;\n          }\n          break;\n\n        case 'scheme':\n          if (c && ALPHANUMERIC.test(c)) {\n            buffer += c.toLowerCase(); // ASCII-safe\n          } else if (':' == c) {\n            this._scheme = buffer;\n            buffer = '';\n            if (stateOverride) {\n              break loop;\n            }\n            if (isRelativeScheme(this._scheme)) {\n              this._isRelative = true;\n            }\n            if ('file' == this._scheme) {\n              state = 'relative';\n            } else if (this._isRelative && base && base._scheme == this._scheme) {\n              state = 'relative or authority';\n            } else if (this._isRelative) {\n              state = 'authority first slash';\n            } else {\n              state = 'scheme data';\n            }\n          } else if (!stateOverride) {\n            buffer = '';\n            cursor = 0;\n            state = 'no scheme';\n            continue;\n          } else if (EOF == c) {\n            break loop;\n          } else {\n            err('Code point not allowed in scheme: ' + c)\n            break loop;\n          }\n          break;\n\n        case 'scheme data':\n          if ('?' == c) {\n            this._query = '?';\n            state = 'query';\n          } else if ('#' == c) {\n            this._fragment = '#';\n            state = 'fragment';\n          } else {\n            // XXX error handling\n            if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n              this._schemeData += percentEscape(c);\n            }\n          }\n          break;\n\n        case 'no scheme':\n          if (!base || !(isRelativeScheme(base._scheme))) {\n            err('Missing scheme.');\n            invalid.call(this);\n          } else {\n            state = 'relative';\n            continue;\n          }\n          break;\n\n        case 'relative or authority':\n          if ('/' == c && '/' == input[cursor+1]) {\n            state = 'authority ignore slashes';\n          } else {\n            err('Expected /, got: ' + c);\n            state = 'relative';\n            continue\n          }\n          break;\n\n        case 'relative':\n          this._isRelative = true;\n          if ('file' != this._scheme)\n            this._scheme = base._scheme;\n          if (EOF == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = base._query;\n            this._username = base._username;\n            this._password = base._password;\n            break loop;\n          } else if ('/' == c || '\\\\' == c) {\n            if ('\\\\' == c)\n              err('\\\\ is an invalid code point.');\n            state = 'relative slash';\n          } else if ('?' == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = '?';\n            this._username = base._username;\n            this._password = base._password;\n            state = 'query';\n          } else if ('#' == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = base._query;\n            this._fragment = '#';\n            this._username = base._username;\n            this._password = base._password;\n            state = 'fragment';\n          } else {\n            var nextC = input[cursor+1]\n            var nextNextC = input[cursor+2]\n            if (\n              'file' != this._scheme || !ALPHA.test(c) ||\n              (nextC != ':' && nextC != '|') ||\n              (EOF != nextNextC && '/' != nextNextC && '\\\\' != nextNextC && '?' != nextNextC && '#' != nextNextC)) {\n              this._host = base._host;\n              this._port = base._port;\n              this._username = base._username;\n              this._password = base._password;\n              this._path = base._path.slice();\n              this._path.pop();\n            }\n            state = 'relative path';\n            continue;\n          }\n          break;\n\n        case 'relative slash':\n          if ('/' == c || '\\\\' == c) {\n            if ('\\\\' == c) {\n              err('\\\\ is an invalid code point.');\n            }\n            if ('file' == this._scheme) {\n              state = 'file host';\n            } else {\n              state = 'authority ignore slashes';\n            }\n          } else {\n            if ('file' != this._scheme) {\n              this._host = base._host;\n              this._port = base._port;\n              this._username = base._username;\n              this._password = base._password;\n            }\n            state = 'relative path';\n            continue;\n          }\n          break;\n\n        case 'authority first slash':\n          if ('/' == c) {\n            state = 'authority second slash';\n          } else {\n            err(\"Expected '/', got: \" + c);\n            state = 'authority ignore slashes';\n            continue;\n          }\n          break;\n\n        case 'authority second slash':\n          state = 'authority ignore slashes';\n          if ('/' != c) {\n            err(\"Expected '/', got: \" + c);\n            continue;\n          }\n          break;\n\n        case 'authority ignore slashes':\n          if ('/' != c && '\\\\' != c) {\n            state = 'authority';\n            continue;\n          } else {\n            err('Expected authority, got: ' + c);\n          }\n          break;\n\n        case 'authority':\n          if ('@' == c) {\n            if (seenAt) {\n              err('@ already seen.');\n              buffer += '%40';\n            }\n            seenAt = true;\n            for (var i = 0; i < buffer.length; i++) {\n              var cp = buffer[i];\n              if ('\\t' == cp || '\\n' == cp || '\\r' == cp) {\n                err('Invalid whitespace in authority.');\n                continue;\n              }\n              // XXX check URL code points\n              if (':' == cp && null === this._password) {\n                this._password = '';\n                continue;\n              }\n              var tempC = percentEscape(cp);\n              (null !== this._password) ? this._password += tempC : this._username += tempC;\n            }\n            buffer = '';\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            cursor -= buffer.length;\n            buffer = '';\n            state = 'host';\n            continue;\n          } else {\n            buffer += c;\n          }\n          break;\n\n        case 'file host':\n          if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            if (buffer.length == 2 && ALPHA.test(buffer[0]) && (buffer[1] == ':' || buffer[1] == '|')) {\n              state = 'relative path';\n            } else if (buffer.length == 0) {\n              state = 'relative path start';\n            } else {\n              this._host = IDNAToASCII.call(this, buffer);\n              buffer = '';\n              state = 'relative path start';\n            }\n            continue;\n          } else if ('\\t' == c || '\\n' == c || '\\r' == c) {\n            err('Invalid whitespace in file host.');\n          } else {\n            buffer += c;\n          }\n          break;\n\n        case 'host':\n        case 'hostname':\n          if (':' == c && !seenBracket) {\n            // XXX host parsing\n            this._host = IDNAToASCII.call(this, buffer);\n            buffer = '';\n            state = 'port';\n            if ('hostname' == stateOverride) {\n              break loop;\n            }\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            this._host = IDNAToASCII.call(this, buffer);\n            buffer = '';\n            state = 'relative path start';\n            if (stateOverride) {\n              break loop;\n            }\n            continue;\n          } else if ('\\t' != c && '\\n' != c && '\\r' != c) {\n            if ('[' == c) {\n              seenBracket = true;\n            } else if (']' == c) {\n              seenBracket = false;\n            }\n            buffer += c;\n          } else {\n            err('Invalid code point in host/hostname: ' + c);\n          }\n          break;\n\n        case 'port':\n          if (/[0-9]/.test(c)) {\n            buffer += c;\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c || stateOverride) {\n            if ('' != buffer) {\n              var temp = parseInt(buffer, 10);\n              if (temp != relative[this._scheme]) {\n                this._port = temp + '';\n              }\n              buffer = '';\n            }\n            if (stateOverride) {\n              break loop;\n            }\n            state = 'relative path start';\n            continue;\n          } else if ('\\t' == c || '\\n' == c || '\\r' == c) {\n            err('Invalid code point in port: ' + c);\n          } else {\n            invalid.call(this);\n          }\n          break;\n\n        case 'relative path start':\n          if ('\\\\' == c)\n            err(\"'\\\\' not allowed in path.\");\n          state = 'relative path';\n          if ('/' != c && '\\\\' != c) {\n            continue;\n          }\n          break;\n\n        case 'relative path':\n          if (EOF == c || '/' == c || '\\\\' == c || (!stateOverride && ('?' == c || '#' == c))) {\n            if ('\\\\' == c) {\n              err('\\\\ not allowed in relative path.');\n            }\n            var tmp;\n            if (tmp = relativePathDotMapping[buffer.toLowerCase()]) {\n              buffer = tmp;\n            }\n            if ('..' == buffer) {\n              this._path.pop();\n              if ('/' != c && '\\\\' != c) {\n                this._path.push('');\n              }\n            } else if ('.' == buffer && '/' != c && '\\\\' != c) {\n              this._path.push('');\n            } else if ('.' != buffer) {\n              if ('file' == this._scheme && this._path.length == 0 && buffer.length == 2 && ALPHA.test(buffer[0]) && buffer[1] == '|') {\n                buffer = buffer[0] + ':';\n              }\n              this._path.push(buffer);\n            }\n            buffer = '';\n            if ('?' == c) {\n              this._query = '?';\n              state = 'query';\n            } else if ('#' == c) {\n              this._fragment = '#';\n              state = 'fragment';\n            }\n          } else if ('\\t' != c && '\\n' != c && '\\r' != c) {\n            buffer += percentEscape(c);\n          }\n          break;\n\n        case 'query':\n          if (!stateOverride && '#' == c) {\n            this._fragment = '#';\n            state = 'fragment';\n          } else if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n            this._query += percentEscapeQuery(c);\n          }\n          break;\n\n        case 'fragment':\n          if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n            this._fragment += c;\n          }\n          break;\n      }\n\n      cursor++;\n    }\n  }\n\n  function clear() {\n    this._scheme = '';\n    this._schemeData = '';\n    this._username = '';\n    this._password = null;\n    this._host = '';\n    this._port = '';\n    this._path = [];\n    this._query = '';\n    this._fragment = '';\n    this._isInvalid = false;\n    this._isRelative = false;\n  }\n\n  // Does not process domain names or IP addresses.\n  // Does not handle encoding for the query parameter.\n  function jURL(url, base /* , encoding */) {\n    if (base !== undefined && !(base instanceof jURL))\n      base = new jURL(String(base));\n\n    this._url = url;\n    clear.call(this);\n\n    var input = url.replace(/^[ \\t\\r\\n\\f]+|[ \\t\\r\\n\\f]+$/g, '');\n    // encoding = encoding || 'utf-8'\n\n    parse.call(this, input, null, base);\n  }\n\n  jURL.prototype = {\n    toString: function() {\n      return this.href;\n    },\n    get href() {\n      if (this._isInvalid)\n        return this._url;\n\n      var authority = '';\n      if ('' != this._username || null != this._password) {\n        authority = this._username +\n            (null != this._password ? ':' + this._password : '') + '@';\n      }\n\n      return this.protocol +\n          (this._isRelative ? '//' + authority + this.host : '') +\n          this.pathname + this._query + this._fragment;\n    },\n    set href(href) {\n      clear.call(this);\n      parse.call(this, href);\n    },\n\n    get protocol() {\n      return this._scheme + ':';\n    },\n    set protocol(protocol) {\n      if (this._isInvalid)\n        return;\n      parse.call(this, protocol + ':', 'scheme start');\n    },\n\n    get host() {\n      return this._isInvalid ? '' : this._port ?\n          this._host + ':' + this._port : this._host;\n    },\n    set host(host) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, host, 'host');\n    },\n\n    get hostname() {\n      return this._host;\n    },\n    set hostname(hostname) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, hostname, 'hostname');\n    },\n\n    get port() {\n      return this._port;\n    },\n    set port(port) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, port, 'port');\n    },\n\n    get pathname() {\n      return this._isInvalid ? '' : this._isRelative ?\n          '/' + this._path.join('/') : this._schemeData;\n    },\n    set pathname(pathname) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      this._path = [];\n      parse.call(this, pathname, 'relative path start');\n    },\n\n    get search() {\n      return this._isInvalid || !this._query || '?' == this._query ?\n          '' : this._query;\n    },\n    set search(search) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      this._query = '?';\n      if ('?' == search[0])\n        search = search.slice(1);\n      parse.call(this, search, 'query');\n    },\n\n    get hash() {\n      return this._isInvalid || !this._fragment || '#' == this._fragment ?\n          '' : this._fragment;\n    },\n    set hash(hash) {\n      if (this._isInvalid)\n        return;\n      this._fragment = '#';\n      if ('#' == hash[0])\n        hash = hash.slice(1);\n      parse.call(this, hash, 'fragment');\n    },\n\n    get origin() {\n      var host;\n      if (this._isInvalid || !this._scheme) {\n        return '';\n      }\n      // javascript: Gecko returns String(\"\"), WebKit/Blink String(\"null\")\n      // Gecko throws error for \"data://\"\n      // data: Gecko returns \"\", Blink returns \"data://\", WebKit returns \"null\"\n      // Gecko returns String(\"\") for file: mailto:\n      // WebKit/Blink returns String(\"SCHEME://\") for file: mailto:\n      switch (this._scheme) {\n        case 'file':\n          return 'file://' // EPUBJS Added\n        case 'data':\n        case 'javascript':\n        case 'mailto':\n          return 'null';\n      }\n      host = this.host;\n      if (!host) {\n        return '';\n      }\n      return this._scheme + '://' + host;\n    }\n  };\n\n  // Copy over the static methods\n  var OriginalURL = scope.URL;\n  if (OriginalURL) {\n    jURL.createObjectURL = function(blob) {\n      // IE extension allows a second optional options argument.\n      // http://msdn.microsoft.com/en-us/library/ie/hh772302(v=vs.85).aspx\n      return OriginalURL.createObjectURL.apply(OriginalURL, arguments);\n    };\n    jURL.revokeObjectURL = function(url) {\n      OriginalURL.revokeObjectURL(url);\n    };\n  }\n\n  return jURL;\n}));\n","/**\n * Core Utilities and Helpers\n * @module Core\n*/\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nexport const requestAnimationFrame = (typeof window != \"undefined\") ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\nconst _URL = typeof URL != \"undefined\" ? URL : (typeof window != \"undefined\" ? (window.URL || window.webkitURL || window.mozURL) : undefined);\n\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\nexport function uuid() {\n\tvar d = new Date().getTime();\n\tvar uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\td = Math.floor(d/16);\n\t\treturn (c==\"x\" ? r : (r&0x7|0x8)).toString(16);\n\t});\n\treturn uuid;\n}\n\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\nexport function documentHeight() {\n\treturn Math.max(\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight\n\t);\n}\n\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\nexport function isElement(obj) {\n\treturn !!(obj && obj.nodeType == 1);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isNumber(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isFloat(n) {\n\tlet f = parseFloat(n);\n\n\tif (isNumber(n) === false) {\n\t\treturn false;\n\t}\n\n\tif (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n\t\treturn true;\n\t}\n\n\treturn Math.floor(f) !== f;\n}\n\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\nexport function prefixed(unprefixed) {\n\tvar vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\" ];\n\tvar prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n\tvar upper = unprefixed[0].toUpperCase() + unprefixed.slice(1);\n\tvar length = vendors.length;\n\n\tif (typeof(document) === \"undefined\" || typeof(document.body.style[unprefixed]) != \"undefined\") {\n\t\treturn unprefixed;\n\t}\n\n\tfor ( var i=0; i < length; i++ ) {\n\t\tif (typeof(document.body.style[vendors[i] + upper]) != \"undefined\") {\n\t\t\treturn prefixes[i] + unprefixed;\n\t\t}\n\t}\n\n\treturn unprefixed;\n}\n\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\nexport function defaults(obj) {\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\n\t\tvar source = arguments[i];\n\t\tfor (var prop in source) {\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\n\t\t}\n\t}\n\treturn obj;\n}\n\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\nexport function extend(target) {\n\tvar sources = [].slice.call(arguments, 1);\n\tsources.forEach(function (source) {\n\t\tif(!source) return;\n\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\n\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n\t\t});\n\t});\n\treturn target;\n}\n\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function insert(item, array, compareFunction) {\n\tvar location = locationOf(item, array, compareFunction);\n\tarray.splice(location, 0, item);\n\n\treturn location;\n}\n\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function locationOf(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn pivot;\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared >= 0 ? pivot : pivot + 1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot;\n\t}\n\tif(compared === -1) {\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\n\t}\n}\n\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn -1; // Not found\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared === 0 ? pivot : -1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot; // Found\n\t}\n\tif(compared === -1) {\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\n\t}\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function bounds(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function borders(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\nexport function nodeBounds(node) {\n\tlet elPos;\n\tlet doc = node.ownerDocument;\n\tif(node.nodeType == Node.TEXT_NODE){\n\t\tlet elRange = doc.createRange();\n\t\telRange.selectNodeContents(node);\n\t\telPos = elRange.getBoundingClientRect();\n\t} else {\n\t\telPos = node.getBoundingClientRect();\n\t}\n\treturn elPos;\n}\n\n/**\n * Find the equivelent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\nexport function windowBounds() {\n\n\tvar width = window.innerWidth;\n\tvar height = window.innerHeight;\n\n\treturn {\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tright: width,\n\t\tbottom: height,\n\t\twidth: width,\n\t\theight: height\n\t};\n\n}\n\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\nexport function indexOfNode(node, typeId) {\n\tvar parent = node.parentNode;\n\tvar children = parent.childNodes;\n\tvar sib;\n\tvar index = -1;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tsib = children[i];\n\t\tif (sib.nodeType === typeId) {\n\t\t\tindex++;\n\t\t}\n\t\tif (sib == node) break;\n\t}\n\n\treturn index;\n}\n\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfTextNode(textNode) {\n\treturn indexOfNode(textNode, TEXT_NODE);\n}\n\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfElementNode(elementNode) {\n\treturn indexOfNode(elementNode, ELEMENT_NODE);\n}\n\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\nexport function isXml(ext) {\n\treturn [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\nexport function createBlob(content, mime){\n\treturn new Blob([content], {type : mime });\n}\n\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBlobUrl(content, mime){\n\tvar tempUrl;\n\tvar blob = createBlob(content, mime);\n\n\ttempUrl = _URL.createObjectURL(blob);\n\n\treturn tempUrl;\n}\n\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\nexport function revokeBlobUrl(url){\n\treturn _URL.revokeObjectURL(url);\n}\n\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBase64Url(content, mime){\n\tvar data;\n\tvar datauri;\n\n\tif (typeof(content) !== \"string\") {\n\t\t// Only handles strings\n\t\treturn;\n\t}\n\n\tdata = btoa(encodeURIComponent(content));\n\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\n\n\treturn datauri;\n}\n\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\nexport function type(obj){\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\n}\n\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\nexport function parse(markup, mime, forceXMLDom) {\n\tvar doc;\n\tvar Parser;\n\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\n\t\tParser = require(\"xmldom\").DOMParser;\n\t} else {\n\t\tParser = DOMParser;\n\t}\n\n\t// Remove byte order mark before parsing\n\t// https://www.w3.org/International/questions/qa-byte-order-mark\n\tif(markup.charCodeAt(0) === 0xFEFF) {\n\t\tmarkup = markup.slice(1);\n\t}\n\n\tdoc = new Parser().parseFromString(markup, mime);\n\n\treturn doc;\n}\n\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\nexport function qs(el, sel) {\n\tvar elements;\n\tif (!el) {\n\t\tthrow new Error(\"No Element Provided\");\n\t}\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\telements = el.getElementsByTagName(sel);\n\t\tif (elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\t}\n}\n\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsa(el, sel) {\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelectorAll(sel);\n\t} else {\n\t\treturn el.getElementsByTagName(sel);\n\t}\n}\n\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsp(el, sel, props) {\n\tvar q, filtered;\n\tif (typeof el.querySelector != \"undefined\") {\n\t\tsel += \"[\";\n\t\tfor (var prop in props) {\n\t\t\tsel += prop + \"~='\" + props[prop] + \"'\";\n\t\t}\n\t\tsel += \"]\";\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\tq = el.getElementsByTagName(sel);\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\n\t\t\tfor (var prop in props) {\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (filtered) {\n\t\t\treturn filtered[0];\n\t\t}\n\t}\n}\n\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n\tvar doc = root.ownerDocument || root;\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\n\t} else {\n\t\twalk(root, function(node) {\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\n\t\t\t\tfunc(node);\n\t\t\t}\n\t\t}, true);\n\t}\n}\n\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter funtion or object to filter with\n */\nexport function treeWalker(root, func, filter) {\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\n\tlet node;\n\twhile ((node = treeWalker.nextNode())) {\n\t\tfunc(node);\n\t}\n}\n\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\nexport function walk(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tnode = node.firstChild;\n\tif(node){\n\t\tdo{\n\t\t\tlet walked = walk(node,callback);\n\t\t\tif(walked){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tnode = node.nextSibling;\n\t\t} while(node);\n\t}\n}\n\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\nexport function blob2base64(blob) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar reader = new FileReader();\n\t\treader.readAsDataURL(blob);\n\t\treader.onloadend = function() {\n\t\t\tresolve(reader.result);\n\t\t};\n\t});\n}\n\n\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\nexport function defer() {\n\t/* A method to resolve the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} value : This value is used to resolve the promise\n\t * If the value is a Promise then the associated promise assumes the state\n\t * of Promise passed as value.\n\t */\n\tthis.resolve = null;\n\n\t/* A method to reject the assocaited Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} reason: The reason for the rejection of the Promise.\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\n\t * itself will be the reason for rejection no matter the state of the Promise.\n\t */\n\tthis.reject = null;\n\n\tthis.id = uuid();\n\n\t/* A newly created Pomise object.\n\t * Initially in pending state.\n\t */\n\tthis.promise = new Promise((resolve, reject) => {\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t});\n\tObject.freeze(this);\n}\n\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function querySelectorByType(html, element, type){\n\tvar query;\n\tif (typeof html.querySelector != \"undefined\") {\n\t\tquery = html.querySelector(`${element}[*|type=\"${type}\"]`);\n\t}\n\t// Handle IE not supporting namespaced epub:type in querySelector\n\tif(!query || query.length === 0) {\n\t\tquery = qsa(html, element);\n\t\tfor (var i = 0; i < query.length; i++) {\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type ||\n\t\t\t\t query[i].getAttribute(\"epub:type\") === type) {\n\t\t\t\treturn query[i];\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn query;\n\t}\n}\n\n/**\n * Find direct decendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\nexport function findChildren(el) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function parents(node) {\n\tvar nodes = [node];\n\tfor (; node; node = node.parentNode) {\n\t\tnodes.unshift(node);\n\t}\n\treturn nodes\n}\n\n/**\n * Find all direct decendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\nexport function filterChildren(el, nodeName, single) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n\t\t\tif (single) {\n\t\t\t\treturn node;\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t}\n\t}\n\tif (!single) {\n\t\treturn result;\n\t}\n}\n\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function getParentByTagName(node, tagname) {\n\tlet parent;\n\tif (node === null || tagname === '') return;\n\tparent = node.parentNode;\n\twhile (parent.nodeType === 1) {\n\t\tif (parent.tagName.toLowerCase() === tagname) {\n\t\t\treturn parent;\n\t\t}\n\t\tparent = parent.parentNode;\n\t}\n}\n\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\nexport class RangeObject {\n\tconstructor() {\n\t\tthis.collapsed = false;\n\t\tthis.commonAncestorContainer = undefined;\n\t\tthis.endContainer = undefined;\n\t\tthis.endOffset = undefined;\n\t\tthis.startContainer = undefined;\n\t\tthis.startOffset = undefined;\n\t}\n\n\tsetStart(startNode, startOffset) {\n\t\tthis.startContainer = startNode;\n\t\tthis.startOffset = startOffset;\n\n\t\tif (!this.endContainer) {\n\t\t\tthis.collapse(true);\n\t\t} else {\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tsetEnd(endNode, endOffset) {\n\t\tthis.endContainer = endNode;\n\t\tthis.endOffset = endOffset;\n\n\t\tif (!this.startContainer) {\n\t\t\tthis.collapse(false);\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tcollapse(toStart) {\n\t\tthis.collapsed = true;\n\t\tif (toStart) {\n\t\t\tthis.endContainer = this.startContainer;\n\t\t\tthis.endOffset = this.startOffset;\n\t\t\tthis.commonAncestorContainer = this.startContainer.parentNode;\n\t\t} else {\n\t\t\tthis.startContainer = this.endContainer;\n\t\t\tthis.startOffset = this.endOffset;\n\t\t\tthis.commonAncestorContainer = this.endOffset.parentNode;\n\t\t}\n\t}\n\n\tselectNode(referenceNode) {\n\t\tlet parent = referenceNode.parentNode;\n\t\tlet index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n\t\tthis.setStart(parent, index);\n\t\tthis.setEnd(parent, index + 1);\n\t}\n\n\tselectNodeContents(referenceNode) {\n\t\tlet end = referenceNode.childNodes[referenceNode.childNodes - 1];\n\t\tlet endIndex = (referenceNode.nodeType === 3) ?\n\t\t\t\treferenceNode.textContent.length : parent.childNodes.length;\n\t\tthis.setStart(referenceNode, 0);\n\t\tthis.setEnd(referenceNode, endIndex);\n\t}\n\n\t_commonAncestorContainer(startContainer, endContainer) {\n\t\tvar startParents = parents(startContainer || this.startContainer);\n\t\tvar endParents = parents(endContainer || this.endContainer);\n\n\t\tif (startParents[0] != endParents[0]) return undefined;\n\n\t\tfor (var i = 0; i < startParents.length; i++) {\n\t\t\tif (startParents[i] != endParents[i]) {\n\t\t\t\treturn startParents[i - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\t_checkCollapsed() {\n\t\tif (this.startContainer === this.endContainer &&\n\t\t\t\tthis.startOffset === this.endOffset) {\n\t\t\tthis.collapsed = true;\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t}\n\t}\n\n\ttoString() {\n\t\t// TODO: implement walking between start and end to find text\n\t}\n}\n","import path from \"path-webpack\";\n\n/**\n * Creates a Path object for parsing and manipulation of a path strings\n *\n * Uses a polyfill for Nodejs path: https://nodejs.org/api/path.html\n * @param\t{string} pathString\ta url string (relative or absolute)\n * @class\n */\nclass Path {\n\tconstructor(pathString) {\n\t\tvar protocol;\n\t\tvar parsed;\n\n\t\tprotocol = pathString.indexOf(\"://\");\n\t\tif (protocol > -1) {\n\t\t\tpathString = new URL(pathString).pathname;\n\t\t}\n\n\t\tparsed = this.parse(pathString);\n\n\t\tthis.path = pathString;\n\n\t\tif (this.isDirectory(pathString)) {\n\t\t\tthis.directory = pathString;\n\t\t} else {\n\t\t\tthis.directory = parsed.dir + \"/\";\n\t\t}\n\n\t\tthis.filename = parsed.base;\n\t\tthis.extension = parsed.ext.slice(1);\n\n\t}\n\n\t/**\n\t * Parse the path: https://nodejs.org/api/path.html#path_path_parse_path\n\t * @param\t{string} what\n\t * @returns {object}\n\t */\n\tparse (what) {\n\t\treturn path.parse(what);\n\t}\n\n\t/**\n\t * @param\t{string} what\n\t * @returns {boolean}\n\t */\n\tisAbsolute (what) {\n\t\treturn path.isAbsolute(what || this.path);\n\t}\n\n\t/**\n\t * Check if path ends with a directory\n\t * @param\t{string} what\n\t * @returns {boolean}\n\t */\n\tisDirectory (what) {\n\t\treturn (what.charAt(what.length-1) === \"/\");\n\t}\n\n\t/**\n\t * Resolve a path against the directory of the Path\n\t *\n\t * https://nodejs.org/api/path.html#path_path_resolve_paths\n\t * @param\t{string} what\n\t * @returns {string} resolved\n\t */\n\tresolve (what) {\n\t\treturn path.resolve(this.directory, what);\n\t}\n\n\t/**\n\t * Resolve a path relative to the directory of the Path\n\t *\n\t * https://nodejs.org/api/path.html#path_path_relative_from_to\n\t * @param\t{string} what\n\t * @returns {string} relative\n\t */\n\trelative (what) {\n\t\tvar isAbsolute = what && (what.indexOf(\"://\") > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\treturn path.relative(this.directory, what);\n\t}\n\n\tsplitPath(filename) {\n\t\treturn this.splitPathRe.exec(filename).slice(1);\n\t}\n\n\t/**\n\t * Return the path string\n\t * @returns {string} path\n\t */\n\ttoString () {\n\t\treturn this.path;\n\t}\n}\n\nexport default Path;\n","import {defer, isXml, parse} from \"./core\";\nimport Path from \"./path\";\n\nfunction request(url, type, withCredentials, headers) {\n\tvar supportsURL = (typeof window != \"undefined\") ? window.URL : false; // TODO: fallback for url if window isn't defined\n\tvar BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\n\n\tvar deferred = new defer();\n\n\tvar xhr = new XMLHttpRequest();\n\n\t//-- Check from PDF.js:\n\t//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\n\tvar xhrPrototype = XMLHttpRequest.prototype;\n\n\tvar header;\n\n\tif (!(\"overrideMimeType\" in xhrPrototype)) {\n\t\t// IE10 might have response, but not overrideMimeType\n\t\tObject.defineProperty(xhrPrototype, \"overrideMimeType\", {\n\t\t\tvalue: function xmlHttpRequestOverrideMimeType() {}\n\t\t});\n\t}\n\n\tif(withCredentials) {\n\t\txhr.withCredentials = true;\n\t}\n\n\txhr.onreadystatechange = handler;\n\txhr.onerror = err;\n\n\txhr.open(\"GET\", url, true);\n\n\tfor(header in headers) {\n\t\txhr.setRequestHeader(header, headers[header]);\n\t}\n\n\tif(type == \"json\") {\n\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\n\t}\n\n\t// If type isn\"t set, determine it from the file extension\n\tif(!type) {\n\t\ttype = new Path(url).extension;\n\t}\n\n\tif(type == \"blob\"){\n\t\txhr.responseType = BLOB_RESPONSE;\n\t}\n\n\n\tif(isXml(type)) {\n\t\t// xhr.responseType = \"document\";\n\t\txhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n\t}\n\n\tif(type == \"xhtml\") {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == \"html\" || type == \"htm\") {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == \"binary\") {\n\t\txhr.responseType = \"arraybuffer\";\n\t}\n\n\txhr.send();\n\n\tfunction err(e) {\n\t\tdeferred.reject(e);\n\t}\n\n\tfunction handler() {\n\t\tif (this.readyState === XMLHttpRequest.DONE) {\n\t\t\tvar responseXML = false;\n\n\t\t\tif(this.responseType === \"\" || this.responseType === \"document\") {\n\t\t\t\tresponseXML = this.responseXML;\n\t\t\t}\n\n\t\t\tif (this.status === 200 || this.status === 0 || responseXML) { //-- Firefox is reporting 0 for blob urls\n\t\t\t\tvar r;\n\n\t\t\t\tif (!this.response && !responseXML) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tmessage : \"Empty Response\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tif (this.status === 403) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tresponse: this.response,\n\t\t\t\t\t\tmessage : \"Forbidden\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\t\t\t\tif(responseXML){\n\t\t\t\t\tr = this.responseXML;\n\t\t\t\t} else\n\t\t\t\tif(isXml(type)){\n\t\t\t\t\t// xhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n\t\t\t\t\t// If this.responseXML wasn't set, try to parse using a DOMParser from text\n\t\t\t\t\tr = parse(this.response, \"text/xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"xhtml\"){\n\t\t\t\t\tr = parse(this.response, \"application/xhtml+xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"html\" || type == \"htm\"){\n\t\t\t\t\tr = parse(this.response, \"text/html\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"json\"){\n\t\t\t\t\tr = JSON.parse(this.response);\n\t\t\t\t}else\n\t\t\t\tif(type == \"blob\"){\n\n\t\t\t\t\tif(supportsURL) {\n\t\t\t\t\t\tr = this.response;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//-- Safari doesn't support responseType blob, so create a blob from arraybuffer\n\t\t\t\t\t\tr = new Blob([this.response]);\n\t\t\t\t\t}\n\n\t\t\t\t}else{\n\t\t\t\t\tr = this.response;\n\t\t\t\t}\n\n\t\t\t\tdeferred.resolve(r);\n\t\t\t} else {\n\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tstatus: this.status,\n\t\t\t\t\tmessage : this.response,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t}\n\n\treturn deferred.promise;\n}\n\nexport default request;\n","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString /*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","/*!\n\nJSZip v3.8.0 - A JavaScript class for generating and reading zip files\n<http://stuartk.com/jszip>\n\n(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>\nDual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.\n\nJSZip uses the library pako released under the MIT license :\nhttps://github.com/nodeca/pako/blob/master/LICENSE\n*/\n\n!function(t){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=t();else if(\"function\"==typeof define&&define.amd)define([],t);else{(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this).JSZip=t()}}(function(){return function s(a,o,h){function u(r,t){if(!o[r]){if(!a[r]){var e=\"function\"==typeof require&&require;if(!t&&e)return e(r,!0);if(l)return l(r,!0);var i=new Error(\"Cannot find module '\"+r+\"'\");throw i.code=\"MODULE_NOT_FOUND\",i}var n=o[r]={exports:{}};a[r][0].call(n.exports,function(t){var e=a[r][1][t];return u(e||t)},n,n.exports,s,a,o,h)}return o[r].exports}for(var l=\"function\"==typeof require&&require,t=0;t<h.length;t++)u(h[t]);return u}({1:[function(t,e,r){\"use strict\";var c=t(\"./utils\"),d=t(\"./support\"),p=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";r.encode=function(t){for(var e,r,i,n,s,a,o,h=[],u=0,l=t.length,f=l,d=\"string\"!==c.getTypeOf(t);u<t.length;)f=l-u,i=d?(e=t[u++],r=u<l?t[u++]:0,u<l?t[u++]:0):(e=t.charCodeAt(u++),r=u<l?t.charCodeAt(u++):0,u<l?t.charCodeAt(u++):0),n=e>>2,s=(3&e)<<4|r>>4,a=1<f?(15&r)<<2|i>>6:64,o=2<f?63&i:64,h.push(p.charAt(n)+p.charAt(s)+p.charAt(a)+p.charAt(o));return h.join(\"\")},r.decode=function(t){var e,r,i,n,s,a,o=0,h=0,u=\"data:\";if(t.substr(0,u.length)===u)throw new Error(\"Invalid base64 input, it looks like a data url.\");var l,f=3*(t=t.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\")).length/4;if(t.charAt(t.length-1)===p.charAt(64)&&f--,t.charAt(t.length-2)===p.charAt(64)&&f--,f%1!=0)throw new Error(\"Invalid base64 input, bad content length.\");for(l=d.uint8array?new Uint8Array(0|f):new Array(0|f);o<t.length;)e=p.indexOf(t.charAt(o++))<<2|(n=p.indexOf(t.charAt(o++)))>>4,r=(15&n)<<4|(s=p.indexOf(t.charAt(o++)))>>2,i=(3&s)<<6|(a=p.indexOf(t.charAt(o++))),l[h++]=e,64!==s&&(l[h++]=r),64!==a&&(l[h++]=i);return l}},{\"./support\":30,\"./utils\":32}],2:[function(t,e,r){\"use strict\";var i=t(\"./external\"),n=t(\"./stream/DataWorker\"),s=t(\"./stream/Crc32Probe\"),a=t(\"./stream/DataLengthProbe\");function o(t,e,r,i,n){this.compressedSize=t,this.uncompressedSize=e,this.crc32=r,this.compression=i,this.compressedContent=n}o.prototype={getContentWorker:function(){var t=new n(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a(\"data_length\")),e=this;return t.on(\"end\",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error(\"Bug : uncompressed data size mismatch\")}),t},getCompressedWorker:function(){return new n(i.Promise.resolve(this.compressedContent)).withStreamInfo(\"compressedSize\",this.compressedSize).withStreamInfo(\"uncompressedSize\",this.uncompressedSize).withStreamInfo(\"crc32\",this.crc32).withStreamInfo(\"compression\",this.compression)}},o.createWorkerFrom=function(t,e,r){return t.pipe(new s).pipe(new a(\"uncompressedSize\")).pipe(e.compressWorker(r)).pipe(new a(\"compressedSize\")).withStreamInfo(\"compression\",e)},e.exports=o},{\"./external\":6,\"./stream/Crc32Probe\":25,\"./stream/DataLengthProbe\":26,\"./stream/DataWorker\":27}],3:[function(t,e,r){\"use strict\";var i=t(\"./stream/GenericWorker\");r.STORE={magic:\"\\0\\0\",compressWorker:function(t){return new i(\"STORE compression\")},uncompressWorker:function(){return new i(\"STORE decompression\")}},r.DEFLATE=t(\"./flate\")},{\"./flate\":7,\"./stream/GenericWorker\":28}],4:[function(t,e,r){\"use strict\";var i=t(\"./utils\");var o=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?\"string\"!==i.getTypeOf(t)?function(t,e,r,i){var n=o,s=i+r;t^=-1;for(var a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t}(0|e,t,t.length,0):function(t,e,r,i){var n=o,s=i+r;t^=-1;for(var a=i;a<s;a++)t=t>>>8^n[255&(t^e.charCodeAt(a))];return-1^t}(0|e,t,t.length,0):0}},{\"./utils\":32}],5:[function(t,e,r){\"use strict\";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,e,r){\"use strict\";var i=null;i=\"undefined\"!=typeof Promise?Promise:t(\"lie\"),e.exports={Promise:i}},{lie:37}],7:[function(t,e,r){\"use strict\";var i=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Uint32Array,n=t(\"pako\"),s=t(\"./utils\"),a=t(\"./stream/GenericWorker\"),o=i?\"uint8array\":\"array\";function h(t,e){a.call(this,\"FlateWorker/\"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}r.magic=\"\\b\\0\",s.inherits(h,a),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,t.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(t){return new h(\"Deflate\",t)},r.uncompressWorker=function(){return new h(\"Inflate\",{})}},{\"./stream/GenericWorker\":28,\"./utils\":32,pako:38}],8:[function(t,e,r){\"use strict\";function A(t,e){var r,i=\"\";for(r=0;r<e;r++)i+=String.fromCharCode(255&t),t>>>=8;return i}function i(t,e,r,i,n,s){var a,o,h=t.file,u=t.compression,l=s!==O.utf8encode,f=I.transformTo(\"string\",s(h.name)),d=I.transformTo(\"string\",O.utf8encode(h.name)),c=h.comment,p=I.transformTo(\"string\",s(c)),m=I.transformTo(\"string\",O.utf8encode(c)),_=d.length!==h.name.length,g=m.length!==c.length,b=\"\",v=\"\",y=\"\",w=h.dir,k=h.date,x={crc32:0,compressedSize:0,uncompressedSize:0};e&&!r||(x.crc32=t.crc32,x.compressedSize=t.compressedSize,x.uncompressedSize=t.uncompressedSize);var S=0;e&&(S|=8),l||!_&&!g||(S|=2048);var z=0,C=0;w&&(z|=16),\"UNIX\"===n?(C=798,z|=function(t,e){var r=t;return t||(r=e?16893:33204),(65535&r)<<16}(h.unixPermissions,w)):(C=20,z|=function(t){return 63&(t||0)}(h.dosPermissions)),a=k.getUTCHours(),a<<=6,a|=k.getUTCMinutes(),a<<=5,a|=k.getUTCSeconds()/2,o=k.getUTCFullYear()-1980,o<<=4,o|=k.getUTCMonth()+1,o<<=5,o|=k.getUTCDate(),_&&(v=A(1,1)+A(B(f),4)+d,b+=\"up\"+A(v.length,2)+v),g&&(y=A(1,1)+A(B(p),4)+m,b+=\"uc\"+A(y.length,2)+y);var E=\"\";return E+=\"\\n\\0\",E+=A(S,2),E+=u.magic,E+=A(a,2),E+=A(o,2),E+=A(x.crc32,4),E+=A(x.compressedSize,4),E+=A(x.uncompressedSize,4),E+=A(f.length,2),E+=A(b.length,2),{fileRecord:R.LOCAL_FILE_HEADER+E+f+b,dirRecord:R.CENTRAL_FILE_HEADER+A(C,2)+E+A(p.length,2)+\"\\0\\0\\0\\0\"+A(z,4)+A(i,4)+f+b+p}}var I=t(\"../utils\"),n=t(\"../stream/GenericWorker\"),O=t(\"../utf8\"),B=t(\"../crc32\"),R=t(\"../signature\");function s(t,e,r,i){n.call(this,\"ZipFileWorker\"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}I.inherits(s,n),s.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,n.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-i-1))/r:100}}))},s.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var r=i(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},s.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=i(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),e)this.push({data:function(t){return R.DATA_DESCRIPTOR+A(t.crc32,4)+A(t.compressedSize,4)+A(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},s.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,i=function(t,e,r,i,n){var s=I.transformTo(\"string\",n(i));return R.CENTRAL_DIRECTORY_END+\"\\0\\0\\0\\0\"+A(t,2)+A(t,2)+A(e,4)+A(r,4)+A(s.length,2)+s}(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},s.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},s.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on(\"data\",function(t){e.processChunk(t)}),t.on(\"end\",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on(\"error\",function(t){e.error(t)}),this},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},s.prototype.error=function(t){var e=this._sources;if(!n.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0},s.prototype.lock=function(){n.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=s},{\"../crc32\":4,\"../signature\":23,\"../stream/GenericWorker\":28,\"../utf8\":31,\"../utils\":32}],9:[function(t,e,r){\"use strict\";var u=t(\"../compressions\"),i=t(\"./ZipFileWorker\");r.generateWorker=function(t,a,e){var o=new i(a.streamFiles,e,a.platform,a.encodeFileName),h=0;try{t.forEach(function(t,e){h++;var r=function(t,e){var r=t||e,i=u[r];if(!i)throw new Error(r+\" is not a valid compression method !\");return i}(e.options.compression,a.compression),i=e.options.compressionOptions||a.compressionOptions||{},n=e.dir,s=e.date;e._compressWorker(r,i).withStreamInfo(\"file\",{name:t,dir:n,date:s,comment:e.comment||\"\",unixPermissions:e.unixPermissions,dosPermissions:e.dosPermissions}).pipe(o)}),o.entriesCount=h}catch(t){o.error(t)}return o}},{\"../compressions\":3,\"./ZipFileWorker\":8}],10:[function(t,e,r){\"use strict\";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error(\"The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.\");this.files=Object.create(null),this.comment=null,this.root=\"\",this.clone=function(){var t=new i;for(var e in this)\"function\"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=t(\"./object\")).loadAsync=t(\"./load\"),i.support=t(\"./support\"),i.defaults=t(\"./defaults\"),i.version=\"3.8.0\",i.loadAsync=function(t,e){return(new i).loadAsync(t,e)},i.external=t(\"./external\"),e.exports=i},{\"./defaults\":5,\"./external\":6,\"./load\":11,\"./object\":15,\"./support\":30}],11:[function(t,e,r){\"use strict\";var u=t(\"./utils\"),n=t(\"./external\"),i=t(\"./utf8\"),s=t(\"./zipEntries\"),a=t(\"./stream/Crc32Probe\"),l=t(\"./nodejsUtils\");function f(i){return new n.Promise(function(t,e){var r=i.decompressed.getContentWorker().pipe(new a);r.on(\"error\",function(t){e(t)}).on(\"end\",function(){r.streamInfo.crc32!==i.decompressed.crc32?e(new Error(\"Corrupted zip : CRC32 mismatch\")):t()}).resume()})}e.exports=function(t,o){var h=this;return o=u.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),l.isNode&&l.isStream(t)?n.Promise.reject(new Error(\"JSZip can't accept a stream when loading a zip file.\")):u.prepareContent(\"the loaded zip file\",t,!0,o.optimizedBinaryString,o.base64).then(function(t){var e=new s(o);return e.load(t),e}).then(function(t){var e=[n.Promise.resolve(t)],r=t.files;if(o.checkCRC32)for(var i=0;i<r.length;i++)e.push(f(r[i]));return n.Promise.all(e)}).then(function(t){for(var e=t.shift(),r=e.files,i=0;i<r.length;i++){var n=r[i],s=n.fileNameStr,a=u.resolve(n.fileNameStr);h.file(a,n.decompressed,{binary:!0,optimizedBinaryString:!0,date:n.date,dir:n.dir,comment:n.fileCommentStr.length?n.fileCommentStr:null,unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions,createFolders:o.createFolders}),n.dir||(h.file(a).unsafeOriginalName=s)}return e.zipComment.length&&(h.comment=e.zipComment),h})}},{\"./external\":6,\"./nodejsUtils\":14,\"./stream/Crc32Probe\":25,\"./utf8\":31,\"./utils\":32,\"./zipEntries\":33}],12:[function(t,e,r){\"use strict\";var i=t(\"../utils\"),n=t(\"../stream/GenericWorker\");function s(t,e){n.call(this,\"Nodejs stream input adapter for \"+t),this._upstreamEnded=!1,this._bindStream(e)}i.inherits(s,n),s.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on(\"data\",function(t){e.push({data:t,meta:{percent:0}})}).on(\"error\",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on(\"end\",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},s.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{\"../stream/GenericWorker\":28,\"../utils\":32}],13:[function(t,e,r){\"use strict\";var n=t(\"readable-stream\").Readable;function i(t,e,r){n.call(this,e),this._helper=t;var i=this;t.on(\"data\",function(t,e){i.push(t)||i._helper.pause(),r&&r(e)}).on(\"error\",function(t){i.emit(\"error\",t)}).on(\"end\",function(){i.push(null)})}t(\"../utils\").inherits(i,n),i.prototype._read=function(){this._helper.resume()},e.exports=i},{\"../utils\":32,\"readable-stream\":16}],14:[function(t,e,r){\"use strict\";e.exports={isNode:\"undefined\"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if(\"number\"==typeof t)throw new Error('The \"data\" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&\"function\"==typeof t.on&&\"function\"==typeof t.pause&&\"function\"==typeof t.resume}}},{}],15:[function(t,e,r){\"use strict\";function s(t,e,r){var i,n=u.getTypeOf(e),s=u.extend(r||{},f);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),\"string\"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(t=g(t)),s.createFolders&&(i=_(t))&&b.call(this,i,!0);var a=\"string\"===n&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!a),(e instanceof d&&0===e.uncompressedSize||s.dir||!e||0===e.length)&&(s.base64=!1,s.binary=!0,e=\"\",s.compression=\"STORE\",n=\"string\");var o=null;o=e instanceof d||e instanceof l?e:p.isNode&&p.isStream(e)?new m(t,e):u.prepareContent(t,e,s.binary,s.optimizedBinaryString,s.base64);var h=new c(t,o,s);this.files[t]=h}var n=t(\"./utf8\"),u=t(\"./utils\"),l=t(\"./stream/GenericWorker\"),a=t(\"./stream/StreamHelper\"),f=t(\"./defaults\"),d=t(\"./compressedObject\"),c=t(\"./zipObject\"),o=t(\"./generate\"),p=t(\"./nodejsUtils\"),m=t(\"./nodejs/NodejsStreamInputAdapter\"),_=function(t){\"/\"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf(\"/\");return 0<e?t.substring(0,e):\"\"},g=function(t){return\"/\"!==t.slice(-1)&&(t+=\"/\"),t},b=function(t,e){return e=void 0!==e?e:f.createFolders,t=g(t),this.files[t]||s.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function h(t){return\"[object RegExp]\"===Object.prototype.toString.call(t)}var i={load:function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},forEach:function(t){var e,r,i;for(e in this.files)i=this.files[e],(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,i)},filter:function(r){var i=[];return this.forEach(function(t,e){r(t,e)&&i.push(e)}),i},file:function(t,e,r){if(1!==arguments.length)return t=this.root+t,s.call(this,t,e,r),this;if(h(t)){var i=t;return this.filter(function(t,e){return!e.dir&&i.test(t)})}var n=this.files[this.root+t];return n&&!n.dir?n:null},folder:function(r){if(!r)return this;if(h(r))return this.filter(function(t,e){return e.dir&&r.test(t)});var t=this.root+r,e=b.call(this,t),i=this.clone();return i.root=e.name,i},remove:function(r){r=this.root+r;var t=this.files[r];if(t||(\"/\"!==r.slice(-1)&&(r+=\"/\"),t=this.files[r]),t&&!t.dir)delete this.files[r];else for(var e=this.filter(function(t,e){return e.name.slice(0,r.length)===r}),i=0;i<e.length;i++)delete this.files[e[i].name];return this},generate:function(t){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},generateInternalStream:function(t){var e,r={};try{if((r=u.extend(t||{},{streamFiles:!1,compression:\"STORE\",compressionOptions:null,type:\"\",platform:\"DOS\",comment:null,mimeType:\"application/zip\",encodeFileName:n.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),\"binarystring\"===r.type&&(r.type=\"string\"),!r.type)throw new Error(\"No output type specified.\");u.checkSupport(r.type),\"darwin\"!==r.platform&&\"freebsd\"!==r.platform&&\"linux\"!==r.platform&&\"sunos\"!==r.platform||(r.platform=\"UNIX\"),\"win32\"===r.platform&&(r.platform=\"DOS\");var i=r.comment||this.comment||\"\";e=o.generateWorker(this,r,i)}catch(t){(e=new l(\"error\")).error(t)}return new a(e,r.type||\"string\",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type=\"nodebuffer\"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=i},{\"./compressedObject\":2,\"./defaults\":5,\"./generate\":9,\"./nodejs/NodejsStreamInputAdapter\":12,\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31,\"./utils\":32,\"./zipObject\":35}],16:[function(t,e,r){e.exports=t(\"stream\")},{stream:void 0}],17:[function(t,e,r){\"use strict\";var i=t(\"./DataReader\");function n(t){i.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t(\"../utils\").inherits(n,i),n.prototype.byteAt=function(t){return this.data[this.zero+t]},n.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2),n=t.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===e&&this.data[s+1]===r&&this.data[s+2]===i&&this.data[s+3]===n)return s-this.zero;return-1},n.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2),n=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&r===s[1]&&i===s[2]&&n===s[3]},n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{\"../utils\":32,\"./DataReader\":18}],18:[function(t,e,r){\"use strict\";var i=t(\"../utils\");function n(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error(\"End of data reached (data length = \"+this.length+\", asked index = \"+t+\"). Corrupted zip ?\")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,r=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);return this.index+=t,r},readString:function(t){return i.transformTo(\"string\",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=n},{\"../utils\":32}],19:[function(t,e,r){\"use strict\";var i=t(\"./Uint8ArrayReader\");function n(t){i.call(this,t)}t(\"../utils\").inherits(n,i),n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{\"../utils\":32,\"./Uint8ArrayReader\":21}],20:[function(t,e,r){\"use strict\";var i=t(\"./DataReader\");function n(t){i.call(this,t)}t(\"../utils\").inherits(n,i),n.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},n.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{\"../utils\":32,\"./DataReader\":18}],21:[function(t,e,r){\"use strict\";var i=t(\"./ArrayReader\");function n(t){i.call(this,t)}t(\"../utils\").inherits(n,i),n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{\"../utils\":32,\"./ArrayReader\":17}],22:[function(t,e,r){\"use strict\";var i=t(\"../utils\"),n=t(\"../support\"),s=t(\"./ArrayReader\"),a=t(\"./StringReader\"),o=t(\"./NodeBufferReader\"),h=t(\"./Uint8ArrayReader\");e.exports=function(t){var e=i.getTypeOf(t);return i.checkSupport(e),\"string\"!==e||n.uint8array?\"nodebuffer\"===e?new o(t):n.uint8array?new h(i.transformTo(\"uint8array\",t)):new s(i.transformTo(\"array\",t)):new a(t)}},{\"../support\":30,\"../utils\":32,\"./ArrayReader\":17,\"./NodeBufferReader\":19,\"./StringReader\":20,\"./Uint8ArrayReader\":21}],23:[function(t,e,r){\"use strict\";r.LOCAL_FILE_HEADER=\"PK\u0003\u0004\",r.CENTRAL_FILE_HEADER=\"PK\u0001\u0002\",r.CENTRAL_DIRECTORY_END=\"PK\u0005\u0006\",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR=\"PK\u0006\u0007\",r.ZIP64_CENTRAL_DIRECTORY_END=\"PK\u0006\u0006\",r.DATA_DESCRIPTOR=\"PK\u0007\\b\"},{}],24:[function(t,e,r){\"use strict\";var i=t(\"./GenericWorker\"),n=t(\"../utils\");function s(t){i.call(this,\"ConvertWorker to \"+t),this.destType=t}n.inherits(s,i),s.prototype.processChunk=function(t){this.push({data:n.transformTo(this.destType,t.data),meta:t.meta})},e.exports=s},{\"../utils\":32,\"./GenericWorker\":28}],25:[function(t,e,r){\"use strict\";var i=t(\"./GenericWorker\"),n=t(\"../crc32\");function s(){i.call(this,\"Crc32Probe\"),this.withStreamInfo(\"crc32\",0)}t(\"../utils\").inherits(s,i),s.prototype.processChunk=function(t){this.streamInfo.crc32=n(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=s},{\"../crc32\":4,\"../utils\":32,\"./GenericWorker\":28}],26:[function(t,e,r){\"use strict\";var i=t(\"../utils\"),n=t(\"./GenericWorker\");function s(t){n.call(this,\"DataLengthProbe for \"+t),this.propName=t,this.withStreamInfo(t,0)}i.inherits(s,n),s.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}n.prototype.processChunk.call(this,t)},e.exports=s},{\"../utils\":32,\"./GenericWorker\":28}],27:[function(t,e,r){\"use strict\";var i=t(\"../utils\"),n=t(\"./GenericWorker\");function s(t){n.call(this,\"DataWorker\");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type=\"\",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=i.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}i.inherits(s,n),s.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case\"string\":t=this.data.substring(this.index,e);break;case\"uint8array\":t=this.data.subarray(this.index,e);break;case\"array\":case\"nodebuffer\":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{\"../utils\":32,\"./GenericWorker\":28}],28:[function(t,e,r){\"use strict\";function i(t){this.name=t||\"default\",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(t){this.emit(\"data\",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit(\"end\"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit(\"error\",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit(\"error\",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on(\"data\",function(t){e.processChunk(t)}),t.on(\"end\",function(){e.end()}),t.on(\"error\",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t=\"Worker \"+this.name;return this.previous?this.previous+\" -> \"+t:t}},e.exports=i},{}],29:[function(t,e,r){\"use strict\";var h=t(\"../utils\"),n=t(\"./ConvertWorker\"),s=t(\"./GenericWorker\"),u=t(\"../base64\"),i=t(\"../support\"),a=t(\"../external\"),o=null;if(i.nodestream)try{o=t(\"../nodejs/NodejsStreamOutputAdapter\")}catch(t){}function l(t,o){return new a.Promise(function(e,r){var i=[],n=t._internalType,s=t._outputType,a=t._mimeType;t.on(\"data\",function(t,e){i.push(t),o&&o(e)}).on(\"error\",function(t){i=[],r(t)}).on(\"end\",function(){try{var t=function(t,e,r){switch(t){case\"blob\":return h.newBlob(h.transformTo(\"arraybuffer\",e),r);case\"base64\":return u.encode(e);default:return h.transformTo(t,e)}}(s,function(t,e){var r,i=0,n=null,s=0;for(r=0;r<e.length;r++)s+=e[r].length;switch(t){case\"string\":return e.join(\"\");case\"array\":return Array.prototype.concat.apply([],e);case\"uint8array\":for(n=new Uint8Array(s),r=0;r<e.length;r++)n.set(e[r],i),i+=e[r].length;return n;case\"nodebuffer\":return Buffer.concat(e);default:throw new Error(\"concat : unsupported type '\"+t+\"'\")}}(n,i),a);e(t)}catch(t){r(t)}i=[]}).resume()})}function f(t,e,r){var i=e;switch(e){case\"blob\":case\"arraybuffer\":i=\"uint8array\";break;case\"base64\":i=\"string\"}try{this._internalType=i,this._outputType=e,this._mimeType=r,h.checkSupport(i),this._worker=t.pipe(new n(i)),t.lock()}catch(t){this._worker=new s(\"error\"),this._worker.error(t)}}f.prototype={accumulate:function(t){return l(this,t)},on:function(t,e){var r=this;return\"data\"===t?this._worker.on(t,function(t){e.call(r,t.data,t.meta)}):this._worker.on(t,function(){h.delay(e,arguments,r)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(h.checkSupport(\"nodestream\"),\"nodebuffer\"!==this._outputType)throw new Error(this._outputType+\" is not supported by this method\");return new o(this,{objectMode:\"nodebuffer\"!==this._outputType},t)}},e.exports=f},{\"../base64\":1,\"../external\":6,\"../nodejs/NodejsStreamOutputAdapter\":13,\"../support\":30,\"../utils\":32,\"./ConvertWorker\":24,\"./GenericWorker\":28}],30:[function(t,e,r){\"use strict\";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=\"undefined\"!=typeof ArrayBuffer&&\"undefined\"!=typeof Uint8Array,r.nodebuffer=\"undefined\"!=typeof Buffer,r.uint8array=\"undefined\"!=typeof Uint8Array,\"undefined\"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:\"application/zip\"}).size}catch(t){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(i),r.blob=0===n.getBlob(\"application/zip\").size}catch(t){r.blob=!1}}}try{r.nodestream=!!t(\"readable-stream\").Readable}catch(t){r.nodestream=!1}},{\"readable-stream\":16}],31:[function(t,e,s){\"use strict\";for(var o=t(\"./utils\"),h=t(\"./support\"),r=t(\"./nodejsUtils\"),i=t(\"./stream/GenericWorker\"),u=new Array(256),n=0;n<256;n++)u[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;u[254]=u[254]=1;function a(){i.call(this,\"utf-8 decode\"),this.leftOver=null}function l(){i.call(this,\"utf-8 encode\")}s.utf8encode=function(t){return h.nodebuffer?r.newBufferFrom(t,\"utf-8\"):function(t){var e,r,i,n,s,a=t.length,o=0;for(n=0;n<a;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=h.uint8array?new Uint8Array(o):new Array(o),n=s=0;s<o;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e}(t)},s.utf8decode=function(t){return h.nodebuffer?o.transformTo(\"nodebuffer\",t).toString(\"utf-8\"):function(t){var e,r,i,n,s=t.length,a=new Array(2*s);for(e=r=0;e<s;)if((i=t[e++])<128)a[r++]=i;else if(4<(n=u[i]))a[r++]=65533,e+=n-1;else{for(i&=2===n?31:3===n?15:7;1<n&&e<s;)i=i<<6|63&t[e++],n--;1<n?a[r++]=65533:i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|1023&i)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),o.applyFromCharCode(a)}(t=o.transformTo(h.uint8array?\"uint8array\":\"array\",t))},o.inherits(a,i),a.prototype.processChunk=function(t){var e=o.transformTo(h.uint8array?\"uint8array\":\"array\",t.data);if(this.leftOver&&this.leftOver.length){if(h.uint8array){var r=e;(e=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),e.set(r,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var i=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+u[t[r]]>e?r:e}(e),n=e;i!==e.length&&(h.uint8array?(n=e.subarray(0,i),this.leftOver=e.subarray(i,e.length)):(n=e.slice(0,i),this.leftOver=e.slice(i,e.length))),this.push({data:s.utf8decode(n),meta:t.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=a,o.inherits(l,i),l.prototype.processChunk=function(t){this.push({data:s.utf8encode(t.data),meta:t.meta})},s.Utf8EncodeWorker=l},{\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./support\":30,\"./utils\":32}],32:[function(t,e,a){\"use strict\";var o=t(\"./support\"),h=t(\"./base64\"),r=t(\"./nodejsUtils\"),i=t(\"set-immediate-shim\"),u=t(\"./external\");function n(t){return t}function l(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}a.newBlob=function(e,r){a.checkSupport(\"blob\");try{return new Blob([e],{type:r})}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(r)}catch(t){throw new Error(\"Bug : can't construct the Blob.\")}}};var s={stringifyByChunk:function(t,e,r){var i=[],n=0,s=t.length;if(s<=r)return String.fromCharCode.apply(null,t);for(;n<s;)\"array\"===e||\"nodebuffer\"===e?i.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+r,s)))):i.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+r,s)))),n+=r;return i.join(\"\")},stringifyByChar:function(t){for(var e=\"\",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(t){return!1}}()}};function f(t){var e=65536,r=a.getTypeOf(t),i=!0;if(\"uint8array\"===r?i=s.applyCanBeUsed.uint8array:\"nodebuffer\"===r&&(i=s.applyCanBeUsed.nodebuffer),i)for(;1<e;)try{return s.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return s.stringifyByChar(t)}function d(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}a.applyFromCharCode=f;var c={};c.string={string:n,array:function(t){return l(t,new Array(t.length))},arraybuffer:function(t){return c.string.uint8array(t).buffer},uint8array:function(t){return l(t,new Uint8Array(t.length))},nodebuffer:function(t){return l(t,r.allocBuffer(t.length))}},c.array={string:f,array:n,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(t)}},c.arraybuffer={string:function(t){return f(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:n,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(new Uint8Array(t))}},c.uint8array={string:f,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:n,nodebuffer:function(t){return r.newBufferFrom(t)}},c.nodebuffer={string:f,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return c.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:n},a.transformTo=function(t,e){if(e=e||\"\",!t)return e;a.checkSupport(t);var r=a.getTypeOf(e);return c[r][t](e)},a.resolve=function(t){for(var e=t.split(\"/\"),r=[],i=0;i<e.length;i++){var n=e[i];\".\"===n||\"\"===n&&0!==i&&i!==e.length-1||(\"..\"===n?r.pop():r.push(n))}return r.join(\"/\")},a.getTypeOf=function(t){return\"string\"==typeof t?\"string\":\"[object Array]\"===Object.prototype.toString.call(t)?\"array\":o.nodebuffer&&r.isBuffer(t)?\"nodebuffer\":o.uint8array&&t instanceof Uint8Array?\"uint8array\":o.arraybuffer&&t instanceof ArrayBuffer?\"arraybuffer\":void 0},a.checkSupport=function(t){if(!o[t.toLowerCase()])throw new Error(t+\" is not supported by this platform\")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(t){var e,r,i=\"\";for(r=0;r<(t||\"\").length;r++)i+=\"\\\\x\"+((e=t.charCodeAt(r))<16?\"0\":\"\")+e.toString(16).toUpperCase();return i},a.delay=function(t,e,r){i(function(){t.apply(r||null,e||[])})},a.inherits=function(t,e){function r(){}r.prototype=e.prototype,t.prototype=new r},a.extend=function(){var t,e,r={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===r[e]&&(r[e]=arguments[t][e]);return r},a.prepareContent=function(r,t,i,n,s){return u.Promise.resolve(t).then(function(i){return o.blob&&(i instanceof Blob||-1!==[\"[object File]\",\"[object Blob]\"].indexOf(Object.prototype.toString.call(i)))&&\"undefined\"!=typeof FileReader?new u.Promise(function(e,r){var t=new FileReader;t.onload=function(t){e(t.target.result)},t.onerror=function(t){r(t.target.error)},t.readAsArrayBuffer(i)}):i}).then(function(t){var e=a.getTypeOf(t);return e?(\"arraybuffer\"===e?t=a.transformTo(\"uint8array\",t):\"string\"===e&&(s?t=h.decode(t):i&&!0!==n&&(t=function(t){return l(t,o.uint8array?new Uint8Array(t.length):new Array(t.length))}(t))),t):u.Promise.reject(new Error(\"Can't read the data of '\"+r+\"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?\"))})}},{\"./base64\":1,\"./external\":6,\"./nodejsUtils\":14,\"./support\":30,\"set-immediate-shim\":54}],33:[function(t,e,r){\"use strict\";var i=t(\"./reader/readerFor\"),n=t(\"./utils\"),s=t(\"./signature\"),a=t(\"./zipEntry\"),o=(t(\"./utf8\"),t(\"./support\"));function h(t){this.files=[],this.loadOptions=t}h.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error(\"Corrupted zip or bug: unexpected signature (\"+n.pretty(e)+\", expected \"+n.pretty(t)+\")\")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var i=this.reader.readString(4)===e;return this.reader.setIndex(r),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.uint8array?\"uint8array\":\"array\",r=n.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,r,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),r=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error(\"Multi-volumes zip are not supported\")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error(\"Corrupted zip or bug: expected \"+this.centralDirRecords+\" records in central dir, got \"+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(t<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error(\"Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html\"):new Error(\"Corrupted zip: can't find end of central directory\");this.reader.setIndex(t);var e=t;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error(\"Corrupted zip: can't find the ZIP64 end of central directory locator\");if(this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error(\"Corrupted zip: can't find the ZIP64 end of central directory\");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var i=e-r;if(0<i)this.isSignature(e,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error(\"Corrupted zip: missing \"+Math.abs(i)+\" bytes.\")},prepareReader:function(t){this.reader=i(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=h},{\"./reader/readerFor\":22,\"./signature\":23,\"./support\":30,\"./utf8\":31,\"./utils\":32,\"./zipEntry\":34}],34:[function(t,e,r){\"use strict\";var i=t(\"./reader/readerFor\"),s=t(\"./utils\"),n=t(\"./compressedObject\"),a=t(\"./crc32\"),o=t(\"./utf8\"),h=t(\"./compressions\"),u=t(\"./support\");function l(t,e){this.options=t,this.loadOptions=e}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,r;if(t.skip(22),this.fileNameLength=t.readInt(2),r=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error(\"Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)\");if(null===(e=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null}(this.compressionMethod)))throw new Error(\"Corrupted zip : compression \"+s.pretty(this.compressionMethod)+\" unknown (inner file : \"+s.transformTo(\"string\",this.fileName)+\")\");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error(\"Encrypted zip are not supported\");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||\"/\"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,r,i,n=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<n;)e=t.readInt(2),r=t.readInt(2),i=t.readData(r),this.extraFields[e]={id:e,length:r,value:i};t.setIndex(n)},handleUTF8:function(){var t=u.uint8array?\"uint8array\":\"array\";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var r=s.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var n=s.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=i(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=i(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=l},{\"./compressedObject\":2,\"./compressions\":3,\"./crc32\":4,\"./reader/readerFor\":22,\"./support\":30,\"./utf8\":31,\"./utils\":32}],35:[function(t,e,r){\"use strict\";function i(t,e,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=e,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var s=t(\"./stream/StreamHelper\"),n=t(\"./stream/DataWorker\"),a=t(\"./utf8\"),o=t(\"./compressedObject\"),h=t(\"./stream/GenericWorker\");i.prototype={internalStream:function(t){var e=null,r=\"string\";try{if(!t)throw new Error(\"No output type specified.\");var i=\"string\"===(r=t.toLowerCase())||\"text\"===r;\"binarystring\"!==r&&\"text\"!==r||(r=\"string\"),e=this._decompressWorker();var n=!this._dataBinary;n&&!i&&(e=e.pipe(new a.Utf8EncodeWorker)),!n&&i&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new h(\"error\")).error(t)}return new s(e,r,\"\")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||\"nodebuffer\").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof o&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new n(this._data)}};for(var u=[\"asText\",\"asBinary\",\"asNodeBuffer\",\"asUint8Array\",\"asArrayBuffer\"],l=function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},f=0;f<u.length;f++)i.prototype[u[f]]=l;e.exports=i},{\"./compressedObject\":2,\"./stream/DataWorker\":27,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31}],36:[function(t,l,e){(function(e){\"use strict\";var r,i,t=e.MutationObserver||e.WebKitMutationObserver;if(t){var n=0,s=new t(u),a=e.document.createTextNode(\"\");s.observe(a,{characterData:!0}),r=function(){a.data=n=++n%2}}else if(e.setImmediate||void 0===e.MessageChannel)r=\"document\"in e&&\"onreadystatechange\"in e.document.createElement(\"script\")?function(){var t=e.document.createElement(\"script\");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var o=new e.MessageChannel;o.port1.onmessage=u,r=function(){o.port2.postMessage(0)}}var h=[];function u(){var t,e;i=!0;for(var r=h.length;r;){for(e=h,h=[],t=-1;++t<r;)e[t]();r=h.length}i=!1}l.exports=function(t){1!==h.push(t)||i||r()}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],37:[function(t,e,r){\"use strict\";var n=t(\"immediate\");function u(){}var l={},s=[\"REJECTED\"],a=[\"FULFILLED\"],i=[\"PENDING\"];function o(t){if(\"function\"!=typeof t)throw new TypeError(\"resolver must be a function\");this.state=i,this.queue=[],this.outcome=void 0,t!==u&&c(this,t)}function h(t,e,r){this.promise=t,\"function\"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),\"function\"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(e,r,i){n(function(){var t;try{t=r(i)}catch(t){return l.reject(e,t)}t===e?l.reject(e,new TypeError(\"Cannot resolve promise with itself\")):l.resolve(e,t)})}function d(t){var e=t&&t.then;if(t&&(\"object\"==typeof t||\"function\"==typeof t)&&\"function\"==typeof e)return function(){e.apply(t,arguments)}}function c(e,t){var r=!1;function i(t){r||(r=!0,l.reject(e,t))}function n(t){r||(r=!0,l.resolve(e,t))}var s=p(function(){t(n,i)});\"error\"===s.status&&i(s.value)}function p(t,e){var r={};try{r.value=t(e),r.status=\"success\"}catch(t){r.status=\"error\",r.value=t}return r}(e.exports=o).prototype.finally=function(e){if(\"function\"!=typeof e)return this;var r=this.constructor;return this.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})})},o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if(\"function\"!=typeof t&&this.state===a||\"function\"!=typeof e&&this.state===s)return this;var r=new this.constructor(u);this.state!==i?f(r,this.state===a?t:e,this.outcome):this.queue.push(new h(r,t,e));return r},h.prototype.callFulfilled=function(t){l.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){f(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){l.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){f(this.promise,this.onRejected,t)},l.resolve=function(t,e){var r=p(d,e);if(\"error\"===r.status)return l.reject(t,r.value);var i=r.value;if(i)c(t,i);else{t.state=a,t.outcome=e;for(var n=-1,s=t.queue.length;++n<s;)t.queue[n].callFulfilled(e)}return t},l.reject=function(t,e){t.state=s,t.outcome=e;for(var r=-1,i=t.queue.length;++r<i;)t.queue[r].callRejected(e);return t},o.resolve=function(t){if(t instanceof this)return t;return l.resolve(new this(u),t)},o.reject=function(t){var e=new this(u);return l.reject(e,t)},o.all=function(t){var r=this;if(\"[object Array]\"!==Object.prototype.toString.call(t))return this.reject(new TypeError(\"must be an array\"));var i=t.length,n=!1;if(!i)return this.resolve([]);var s=new Array(i),a=0,e=-1,o=new this(u);for(;++e<i;)h(t[e],e);return o;function h(t,e){r.resolve(t).then(function(t){s[e]=t,++a!==i||n||(n=!0,l.resolve(o,s))},function(t){n||(n=!0,l.reject(o,t))})}},o.race=function(t){var e=this;if(\"[object Array]\"!==Object.prototype.toString.call(t))return this.reject(new TypeError(\"must be an array\"));var r=t.length,i=!1;if(!r)return this.resolve([]);var n=-1,s=new this(u);for(;++n<r;)a=t[n],e.resolve(a).then(function(t){i||(i=!0,l.resolve(s,t))},function(t){i||(i=!0,l.reject(s,t))});var a;return s}},{immediate:36}],38:[function(t,e,r){\"use strict\";var i={};(0,t(\"./lib/utils/common\").assign)(i,t(\"./lib/deflate\"),t(\"./lib/inflate\"),t(\"./lib/zlib/constants\")),e.exports=i},{\"./lib/deflate\":39,\"./lib/inflate\":40,\"./lib/utils/common\":41,\"./lib/zlib/constants\":44}],39:[function(t,e,r){\"use strict\";var a=t(\"./zlib/deflate\"),o=t(\"./utils/common\"),h=t(\"./utils/strings\"),n=t(\"./zlib/messages\"),s=t(\"./zlib/zstream\"),u=Object.prototype.toString,l=0,f=-1,d=0,c=8;function p(t){if(!(this instanceof p))return new p(t);this.options=o.assign({level:f,method:c,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:\"\"},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==l)throw new Error(n[r]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i=\"string\"==typeof e.dictionary?h.string2buf(e.dictionary):\"[object ArrayBuffer]\"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=a.deflateSetDictionary(this.strm,i))!==l)throw new Error(n[r]);this._dict_set=!0}}function i(t,e){var r=new p(e);if(r.push(t,!0),r.err)throw r.msg||n[r.err];return r.result}p.prototype.push=function(t,e){var r,i,n=this.strm,s=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?4:0,\"string\"==typeof t?n.input=h.string2buf(t):\"[object ArrayBuffer]\"===u.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new o.Buf8(s),n.next_out=0,n.avail_out=s),1!==(r=a.deflate(n,i))&&r!==l)return this.onEnd(r),!(this.ended=!0);0!==n.avail_out&&(0!==n.avail_in||4!==i&&2!==i)||(\"string\"===this.options.to?this.onData(h.buf2binstring(o.shrinkBuf(n.output,n.next_out))):this.onData(o.shrinkBuf(n.output,n.next_out)))}while((0<n.avail_in||0===n.avail_out)&&1!==r);return 4===i?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l):2!==i||(this.onEnd(l),!(n.avail_out=0))},p.prototype.onData=function(t){this.chunks.push(t)},p.prototype.onEnd=function(t){t===l&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=p,r.deflate=i,r.deflateRaw=function(t,e){return(e=e||{}).raw=!0,i(t,e)},r.gzip=function(t,e){return(e=e||{}).gzip=!0,i(t,e)}},{\"./utils/common\":41,\"./utils/strings\":42,\"./zlib/deflate\":46,\"./zlib/messages\":51,\"./zlib/zstream\":53}],40:[function(t,e,r){\"use strict\";var d=t(\"./zlib/inflate\"),c=t(\"./utils/common\"),p=t(\"./utils/strings\"),m=t(\"./zlib/constants\"),i=t(\"./zlib/messages\"),n=t(\"./zlib/zstream\"),s=t(\"./zlib/gzheader\"),_=Object.prototype.toString;function a(t){if(!(this instanceof a))return new a(t);this.options=c.assign({chunkSize:16384,windowBits:0,to:\"\"},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var r=d.inflateInit2(this.strm,e.windowBits);if(r!==m.Z_OK)throw new Error(i[r]);this.header=new s,d.inflateGetHeader(this.strm,this.header)}function o(t,e){var r=new a(e);if(r.push(t,!0),r.err)throw r.msg||i[r.err];return r.result}a.prototype.push=function(t,e){var r,i,n,s,a,o,h=this.strm,u=this.options.chunkSize,l=this.options.dictionary,f=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?m.Z_FINISH:m.Z_NO_FLUSH,\"string\"==typeof t?h.input=p.binstring2buf(t):\"[object ArrayBuffer]\"===_.call(t)?h.input=new Uint8Array(t):h.input=t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new c.Buf8(u),h.next_out=0,h.avail_out=u),(r=d.inflate(h,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&l&&(o=\"string\"==typeof l?p.string2buf(l):\"[object ArrayBuffer]\"===_.call(l)?new Uint8Array(l):l,r=d.inflateSetDictionary(this.strm,o)),r===m.Z_BUF_ERROR&&!0===f&&(r=m.Z_OK,f=!1),r!==m.Z_STREAM_END&&r!==m.Z_OK)return this.onEnd(r),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&r!==m.Z_STREAM_END&&(0!==h.avail_in||i!==m.Z_FINISH&&i!==m.Z_SYNC_FLUSH)||(\"string\"===this.options.to?(n=p.utf8border(h.output,h.next_out),s=h.next_out-n,a=p.buf2string(h.output,n),h.next_out=s,h.avail_out=u-s,s&&c.arraySet(h.output,h.output,n,s,0),this.onData(a)):this.onData(c.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(f=!0)}while((0<h.avail_in||0===h.avail_out)&&r!==m.Z_STREAM_END);return r===m.Z_STREAM_END&&(i=m.Z_FINISH),i===m.Z_FINISH?(r=d.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===m.Z_OK):i!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(h.avail_out=0))},a.prototype.onData=function(t){this.chunks.push(t)},a.prototype.onEnd=function(t){t===m.Z_OK&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,o(t,e)},r.ungzip=o},{\"./utils/common\":41,\"./utils/strings\":42,\"./zlib/constants\":44,\"./zlib/gzheader\":47,\"./zlib/inflate\":49,\"./zlib/messages\":51,\"./zlib/zstream\":53}],41:[function(t,e,r){\"use strict\";var i=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if(\"object\"!=typeof r)throw new TypeError(r+\"must be non-object\");for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,r,i,n){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+i),n);else for(var s=0;s<i;s++)t[n+s]=e[r+s]},flattenChunks:function(t){var e,r,i,n,s,a;for(e=i=0,r=t.length;e<r;e++)i+=t[e].length;for(a=new Uint8Array(i),e=n=0,r=t.length;e<r;e++)s=t[e],a.set(s,n),n+=s.length;return a}},s={arraySet:function(t,e,r,i,n){for(var s=0;s<i;s++)t[n+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(i)},{}],42:[function(t,e,r){\"use strict\";var h=t(\"./common\"),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var u=new h.Buf8(256),i=0;i<256;i++)u[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function l(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&n))return String.fromCharCode.apply(null,h.shrinkBuf(t,e));for(var r=\"\",i=0;i<e;i++)r+=String.fromCharCode(t[i]);return r}u[254]=u[254]=1,r.string2buf=function(t){var e,r,i,n,s,a=t.length,o=0;for(n=0;n<a;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new h.Buf8(o),n=s=0;s<o;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e},r.buf2binstring=function(t){return l(t,t.length)},r.binstring2buf=function(t){for(var e=new h.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,i,n,s,a=e||t.length,o=new Array(2*a);for(r=i=0;r<a;)if((n=t[r++])<128)o[i++]=n;else if(4<(s=u[n]))o[i++]=65533,r+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&r<a;)n=n<<6|63&t[r++],s--;1<s?o[i++]=65533:n<65536?o[i++]=n:(n-=65536,o[i++]=55296|n>>10&1023,o[i++]=56320|1023&n)}return l(o,i)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+u[t[r]]>e?r:e}},{\"./common\":41}],43:[function(t,e,r){\"use strict\";e.exports=function(t,e,r,i){for(var n=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(n=n+e[i++]|0)|0,--a;);n%=65521,s%=65521}return n|s<<16|0}},{}],44:[function(t,e,r){\"use strict\";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,r){\"use strict\";var o=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var n=o,s=i+r;t^=-1;for(var a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t}},{}],46:[function(t,e,r){\"use strict\";var h,d=t(\"../utils/common\"),u=t(\"./trees\"),c=t(\"./adler32\"),p=t(\"./crc32\"),i=t(\"./messages\"),l=0,f=4,m=0,_=-2,g=-1,b=4,n=2,v=8,y=9,s=286,a=30,o=19,w=2*s+1,k=15,x=3,S=258,z=S+x+1,C=42,E=113,A=1,I=2,O=3,B=4;function R(t,e){return t.msg=i[e],e}function T(t){return(t<<1)-(4<t?9:0)}function D(t){for(var e=t.length;0<=--e;)t[e]=0}function F(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(d.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function N(t,e){u._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,F(t.strm)}function U(t,e){t.pending_buf[t.pending++]=e}function P(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function L(t,e){var r,i,n=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-z?t.strstart-(t.w_size-z):0,u=t.window,l=t.w_mask,f=t.prev,d=t.strstart+S,c=u[s+a-1],p=u[s+a];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(u[(r=e)+a]===p&&u[r+a-1]===c&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<d);if(i=S-(d-s),s=d-S,a<i){if(t.match_start=e,o<=(a=i))break;c=u[s+a-1],p=u[s+a]}}}while((e=f[e&l])>h&&0!=--n);return a<=t.lookahead?a:t.lookahead}function j(t){var e,r,i,n,s,a,o,h,u,l,f=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-z)){for(d.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=r=t.hash_size;i=t.head[--e],t.head[e]=f<=i?i-f:0,--r;);for(e=r=f;i=t.prev[--e],t.prev[e]=f<=i?i-f:0,--r;);n+=f}if(0===t.strm.avail_in)break;if(a=t.strm,o=t.window,h=t.strstart+t.lookahead,u=n,l=void 0,l=a.avail_in,u<l&&(l=u),r=0===l?0:(a.avail_in-=l,d.arraySet(o,a.input,a.next_in,l,h),1===a.state.wrap?a.adler=c(a.adler,o,l,h):2===a.state.wrap&&(a.adler=p(a.adler,o,l,h)),a.next_in+=l,a.total_in+=l,l),t.lookahead+=r,t.lookahead+t.insert>=x)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+x-1])&t.hash_mask,t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<x)););}while(t.lookahead<z&&0!==t.strm.avail_in)}function Z(t,e){for(var r,i;;){if(t.lookahead<z){if(j(t),t.lookahead<z&&e===l)return A;if(0===t.lookahead)break}if(r=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-z&&(t.match_length=L(t,r)),t.match_length>=x)if(i=u._tr_tally(t,t.strstart-t.match_start,t.match_length-x),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=x){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<x-1?t.strstart:x-1,e===f?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}function W(t,e){for(var r,i,n;;){if(t.lookahead<z){if(j(t),t.lookahead<z&&e===l)return A;if(0===t.lookahead)break}if(r=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=x-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-z&&(t.match_length=L(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===x&&4096<t.strstart-t.match_start)&&(t.match_length=x-1)),t.prev_length>=x&&t.match_length<=t.prev_length){for(n=t.strstart+t.lookahead-x,i=u._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-x),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=x-1,t.strstart++,i&&(N(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((i=u._tr_tally(t,0,t.window[t.strstart-1]))&&N(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=u._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<x-1?t.strstart:x-1,e===f?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}function M(t,e,r,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i,this.func=n}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*w),this.dyn_dtree=new d.Buf16(2*(2*a+1)),this.bl_tree=new d.Buf16(2*(2*o+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(k+1),this.heap=new d.Buf16(2*s+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*s+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=n,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?C:E,t.adler=2===e.wrap?0:1,e.last_flush=l,u._tr_init(e),m):R(t,_)}function K(t){var e=G(t);return e===m&&function(t){t.window_size=2*t.w_size,D(t.head),t.max_lazy_match=h[t.level].max_lazy,t.good_match=h[t.level].good_length,t.nice_match=h[t.level].nice_length,t.max_chain_length=h[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=x-1,t.match_available=0,t.ins_h=0}(t.state),e}function Y(t,e,r,i,n,s){if(!t)return _;var a=1;if(e===g&&(e=6),i<0?(a=0,i=-i):15<i&&(a=2,i-=16),n<1||y<n||r!==v||i<8||15<i||e<0||9<e||s<0||b<s)return R(t,_);8===i&&(i=9);var o=new H;return(t.state=o).strm=t,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+x-1)/x),o.window=new d.Buf8(2*o.w_size),o.head=new d.Buf16(o.hash_size),o.prev=new d.Buf16(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new d.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=r,K(t)}h=[new M(0,0,0,0,function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(j(t),0===t.lookahead&&e===l)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+r;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,N(t,!1),0===t.strm.avail_out))return A;if(t.strstart-t.block_start>=t.w_size-z&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===f?(N(t,!0),0===t.strm.avail_out?O:B):(t.strstart>t.block_start&&(N(t,!1),t.strm.avail_out),A)}),new M(4,4,8,4,Z),new M(4,5,16,8,Z),new M(4,6,32,32,Z),new M(4,4,16,16,W),new M(8,16,32,32,W),new M(8,16,128,128,W),new M(8,32,128,256,W),new M(32,128,258,1024,W),new M(32,258,258,4096,W)],r.deflateInit=function(t,e){return Y(t,e,v,15,8,0)},r.deflateInit2=Y,r.deflateReset=K,r.deflateResetKeep=G,r.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?_:(t.state.gzhead=e,m):_},r.deflate=function(t,e){var r,i,n,s;if(!t||!t.state||5<e||e<0)return t?R(t,_):_;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&e!==f)return R(t,0===t.avail_out?-5:_);if(i.strm=t,r=i.last_flush,i.last_flush=e,i.status===C)if(2===i.wrap)t.adler=0,U(i,31),U(i,139),U(i,8),i.gzhead?(U(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),U(i,255&i.gzhead.time),U(i,i.gzhead.time>>8&255),U(i,i.gzhead.time>>16&255),U(i,i.gzhead.time>>24&255),U(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),U(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(U(i,255&i.gzhead.extra.length),U(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=p(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(U(i,0),U(i,0),U(i,0),U(i,0),U(i,0),U(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),U(i,3),i.status=E);else{var a=v+(i.w_bits-8<<4)<<8;a|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=E,P(i,a),0!==i.strstart&&(P(i,t.adler>>>16),P(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(t.adler=p(t.adler,i.pending_buf,i.pending-n,n)),F(t),n=i.pending,i.pending!==i.pending_buf_size));)U(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(t.adler=p(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=p(t.adler,i.pending_buf,i.pending-n,n)),F(t),n=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,U(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>n&&(t.adler=p(t.adler,i.pending_buf,i.pending-n,n)),0===s&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=p(t.adler,i.pending_buf,i.pending-n,n)),F(t),n=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,U(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>n&&(t.adler=p(t.adler,i.pending_buf,i.pending-n,n)),0===s&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&F(t),i.pending+2<=i.pending_buf_size&&(U(i,255&t.adler),U(i,t.adler>>8&255),t.adler=0,i.status=E)):i.status=E),0!==i.pending){if(F(t),0===t.avail_out)return i.last_flush=-1,m}else if(0===t.avail_in&&T(e)<=T(r)&&e!==f)return R(t,-5);if(666===i.status&&0!==t.avail_in)return R(t,-5);if(0!==t.avail_in||0!==i.lookahead||e!==l&&666!==i.status){var o=2===i.strategy?function(t,e){for(var r;;){if(0===t.lookahead&&(j(t),0===t.lookahead)){if(e===l)return A;break}if(t.match_length=0,r=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===f?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}(i,e):3===i.strategy?function(t,e){for(var r,i,n,s,a=t.window;;){if(t.lookahead<=S){if(j(t),t.lookahead<=S&&e===l)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=x&&0<t.strstart&&(i=a[n=t.strstart-1])===a[++n]&&i===a[++n]&&i===a[++n]){s=t.strstart+S;do{}while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<s);t.match_length=S-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=x?(r=u._tr_tally(t,1,t.match_length-x),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===f?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}(i,e):h[i.level].func(i,e);if(o!==O&&o!==B||(i.status=666),o===A||o===O)return 0===t.avail_out&&(i.last_flush=-1),m;if(o===I&&(1===e?u._tr_align(i):5!==e&&(u._tr_stored_block(i,0,0,!1),3===e&&(D(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),F(t),0===t.avail_out))return i.last_flush=-1,m}return e!==f?m:i.wrap<=0?1:(2===i.wrap?(U(i,255&t.adler),U(i,t.adler>>8&255),U(i,t.adler>>16&255),U(i,t.adler>>24&255),U(i,255&t.total_in),U(i,t.total_in>>8&255),U(i,t.total_in>>16&255),U(i,t.total_in>>24&255)):(P(i,t.adler>>>16),P(i,65535&t.adler)),F(t),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?m:1)},r.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==C&&69!==e&&73!==e&&91!==e&&103!==e&&e!==E&&666!==e?R(t,_):(t.state=null,e===E?R(t,-3):m):_},r.deflateSetDictionary=function(t,e){var r,i,n,s,a,o,h,u,l=e.length;if(!t||!t.state)return _;if(2===(s=(r=t.state).wrap)||1===s&&r.status!==C||r.lookahead)return _;for(1===s&&(t.adler=c(t.adler,e,l,0)),r.wrap=0,l>=r.w_size&&(0===s&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new d.Buf8(r.w_size),d.arraySet(u,e,l-r.w_size,r.w_size,0),e=u,l=r.w_size),a=t.avail_in,o=t.next_in,h=t.input,t.avail_in=l,t.next_in=0,t.input=e,j(r);r.lookahead>=x;){for(i=r.strstart,n=r.lookahead-(x-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+x-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--n;);r.strstart=i,r.lookahead=x-1,j(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=x-1,r.match_available=0,t.next_in=o,t.input=h,t.avail_in=a,r.wrap=s,m},r.deflateInfo=\"pako deflate (from Nodeca project)\"},{\"../utils/common\":41,\"./adler32\":43,\"./crc32\":45,\"./messages\":51,\"./trees\":52}],47:[function(t,e,r){\"use strict\";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,r){\"use strict\";e.exports=function(t,e){var r,i,n,s,a,o,h,u,l,f,d,c,p,m,_,g,b,v,y,w,k,x,S,z,C;r=t.state,i=t.next_in,z=t.input,n=i+(t.avail_in-5),s=t.next_out,C=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),h=r.dmax,u=r.wsize,l=r.whave,f=r.wnext,d=r.window,c=r.hold,p=r.bits,m=r.lencode,_=r.distcode,g=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;t:do{p<15&&(c+=z[i++]<<p,p+=8,c+=z[i++]<<p,p+=8),v=m[c&g];e:for(;;){if(c>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))C[s++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=m[(65535&v)+(c&(1<<y)-1)];continue e}if(32&y){r.mode=12;break t}t.msg=\"invalid literal/length code\",r.mode=30;break t}w=65535&v,(y&=15)&&(p<y&&(c+=z[i++]<<p,p+=8),w+=c&(1<<y)-1,c>>>=y,p-=y),p<15&&(c+=z[i++]<<p,p+=8,c+=z[i++]<<p,p+=8),v=_[c&b];r:for(;;){if(c>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=_[(65535&v)+(c&(1<<y)-1)];continue r}t.msg=\"invalid distance code\",r.mode=30;break t}if(k=65535&v,p<(y&=15)&&(c+=z[i++]<<p,(p+=8)<y&&(c+=z[i++]<<p,p+=8)),h<(k+=c&(1<<y)-1)){t.msg=\"invalid distance too far back\",r.mode=30;break t}if(c>>>=y,p-=y,(y=s-a)<k){if(l<(y=k-y)&&r.sane){t.msg=\"invalid distance too far back\",r.mode=30;break t}if(S=d,(x=0)===f){if(x+=u-y,y<w){for(w-=y;C[s++]=d[x++],--y;);x=s-k,S=C}}else if(f<y){if(x+=u+f-y,(y-=f)<w){for(w-=y;C[s++]=d[x++],--y;);if(x=0,f<w){for(w-=y=f;C[s++]=d[x++],--y;);x=s-k,S=C}}}else if(x+=f-y,y<w){for(w-=y;C[s++]=d[x++],--y;);x=s-k,S=C}for(;2<w;)C[s++]=S[x++],C[s++]=S[x++],C[s++]=S[x++],w-=3;w&&(C[s++]=S[x++],1<w&&(C[s++]=S[x++]))}else{for(x=s-k;C[s++]=C[x++],C[s++]=C[x++],C[s++]=C[x++],2<(w-=3););w&&(C[s++]=C[x++],1<w&&(C[s++]=C[x++]))}break}}break}}while(i<n&&s<o);i-=w=p>>3,c&=(1<<(p-=w<<3))-1,t.next_in=i,t.next_out=s,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=s<o?o-s+257:257-(s-o),r.hold=c,r.bits=p}},{}],49:[function(t,e,r){\"use strict\";var I=t(\"../utils/common\"),O=t(\"./adler32\"),B=t(\"./crc32\"),R=t(\"./inffast\"),T=t(\"./inftrees\"),D=1,F=2,N=0,U=-2,P=1,i=852,n=592;function L(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg=\"\",e.wrap&&(t.adler=1&e.wrap),e.mode=P,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new I.Buf32(i),e.distcode=e.distdyn=new I.Buf32(n),e.sane=1,e.back=-1,N):U}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,a(t)):U}function h(t,e){var r,i;return t&&t.state?(i=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?U:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=r,i.wbits=e,o(t))):U}function u(t,e){var r,i;return t?(i=new s,(t.state=i).window=null,(r=h(t,e))!==N&&(t.state=null),r):U}var l,f,d=!0;function j(t){if(d){var e;for(l=new I.Buf32(512),f=new I.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(T(D,t.lens,0,288,l,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;T(F,t.lens,0,32,f,0,t.work,{bits:5}),d=!1}t.lencode=l,t.lenbits=9,t.distcode=f,t.distbits=5}function Z(t,e,r,i){var n,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new I.Buf8(s.wsize)),i>=s.wsize?(I.arraySet(s.window,e,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i<(n=s.wsize-s.wnext)&&(n=i),I.arraySet(s.window,e,r-i,n,s.wnext),(i-=n)?(I.arraySet(s.window,e,r-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0}r.inflateReset=o,r.inflateReset2=h,r.inflateResetKeep=a,r.inflateInit=function(t){return u(t,15)},r.inflateInit2=u,r.inflate=function(t,e){var r,i,n,s,a,o,h,u,l,f,d,c,p,m,_,g,b,v,y,w,k,x,S,z,C=0,E=new I.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return U;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,n=t.output,h=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,u=r.hold,l=r.bits,f=o,d=h,x=N;t:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(2&r.wrap&&35615===u){E[r.check=0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0),l=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg=\"incorrect header check\",r.mode=30;break}if(8!=(15&u)){t.msg=\"unknown compression method\",r.mode=30;break}if(l-=4,k=8+(15&(u>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){t.msg=\"invalid window size\",r.mode=30;break}r.dmax=1<<k,t.adler=r.check=1,r.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(r.flags=u,8!=(255&r.flags)){t.msg=\"unknown compression method\",r.mode=30;break}if(57344&r.flags){t.msg=\"unknown header flags set\",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=3;case 3:for(;l<32;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,E[2]=u>>>16&255,E[3]=u>>>24&255,r.check=B(r.check,E,4,0)),l=u=0,r.mode=4;case 4:for(;l<16;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(o<(c=r.length)&&(c=o),c&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),I.arraySet(r.head.extra,i,s,c,k)),512&r.flags&&(r.check=B(r.check,i,c,s)),o-=c,s+=c,r.length-=c),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break t;for(c=0;k=i[s+c++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k)),k&&c<o;);if(512&r.flags&&(r.check=B(r.check,i,c,s)),o-=c,s+=c,k)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break t;for(c=0;k=i[s+c++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k)),k&&c<o;);if(512&r.flags&&(r.check=B(r.check,i,c,s)),o-=c,s+=c,k)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(u!==(65535&r.check)){t.msg=\"header crc mismatch\",r.mode=30;break}l=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}t.adler=r.check=L(u),l=u=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){u>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}switch(r.last=1&u,l-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(j(r),r.mode=20,6!==e)break;u>>>=2,l-=2;break t;case 2:r.mode=17;break;case 3:t.msg=\"invalid block type\",r.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){t.msg=\"invalid stored block lengths\",r.mode=30;break}if(r.length=65535&u,l=u=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(c=r.length){if(o<c&&(c=o),h<c&&(c=h),0===c)break t;I.arraySet(n,i,s,c,a),o-=c,s+=c,h-=c,a+=c,r.length-=c;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,286<r.nlen||30<r.ndist){t.msg=\"too many length or distance symbols\",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},x=T(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,x){t.msg=\"invalid code lengths set\",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(b<16)u>>>=_,l-=_,r.lens[r.have++]=b;else{if(16===b){for(z=_+2;l<z;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(u>>>=_,l-=_,0===r.have){t.msg=\"invalid bit length repeat\",r.mode=30;break}k=r.lens[r.have-1],c=3+(3&u),u>>>=2,l-=2}else if(17===b){for(z=_+3;l<z;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}l-=_,k=0,c=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(z=_+7;l<z;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}l-=_,k=0,c=11+(127&(u>>>=_)),u>>>=7,l-=7}if(r.have+c>r.nlen+r.ndist){t.msg=\"invalid bit length repeat\",r.mode=30;break}for(;c--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){t.msg=\"invalid code -- missing end-of-block\",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},x=T(D,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,x){t.msg=\"invalid literal/lengths set\",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},x=T(F,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,x){t.msg=\"invalid distances set\",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=o&&258<=h){t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,R(t,d),a=t.next_out,n=t.output,h=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,u=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(g&&0==(240&g)){for(v=_,y=g,w=b;g=(C=r.lencode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,r.length=b,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){t.msg=\"invalid literal/length code\",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(z=r.extra;l<z;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(C=r.distcode[u&(1<<r.distbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(0==(240&g)){for(v=_,y=g,w=b;g=(C=r.distcode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,64&g){t.msg=\"invalid distance code\",r.mode=30;break}r.offset=b,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(z=r.extra;l<z;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg=\"invalid distance too far back\",r.mode=30;break}r.mode=25;case 25:if(0===h)break t;if(c=d-h,r.offset>c){if((c=r.offset-c)>r.whave&&r.sane){t.msg=\"invalid distance too far back\",r.mode=30;break}p=c>r.wnext?(c-=r.wnext,r.wsize-c):r.wnext-c,c>r.length&&(c=r.length),m=r.window}else m=n,p=a-r.offset,c=r.length;for(h<c&&(c=h),h-=c,r.length-=c;n[a++]=m[p++],--c;);0===r.length&&(r.mode=21);break;case 26:if(0===h)break t;n[a++]=r.length,h--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break t;o--,u|=i[s++]<<l,l+=8}if(d-=h,t.total_out+=d,r.total+=d,d&&(t.adler=r.check=r.flags?B(r.check,n,d,a-d):O(r.check,n,d,a-d)),d=h,(r.flags?u:L(u))!==r.check){t.msg=\"incorrect data check\",r.mode=30;break}l=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break t;o--,u+=i[s++]<<l,l+=8}if(u!==(4294967295&r.total)){t.msg=\"incorrect length check\",r.mode=30;break}l=u=0}r.mode=29;case 29:x=1;break t;case 30:x=-3;break t;case 31:return-4;case 32:default:return U}return t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,(r.wsize||d!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&Z(t,t.output,t.next_out,d-t.avail_out)?(r.mode=31,-4):(f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,r.total+=d,r.wrap&&d&&(t.adler=r.check=r.flags?B(r.check,n,d,t.next_out-d):O(r.check,n,d,t.next_out-d)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==f&&0===d||4===e)&&x===N&&(x=-5),x)},r.inflateEnd=function(t){if(!t||!t.state)return U;var e=t.state;return e.window&&(e.window=null),t.state=null,N},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?U:((r.head=e).done=!1,N):U},r.inflateSetDictionary=function(t,e){var r,i=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?U:11===r.mode&&O(1,e,i,0)!==r.check?-3:Z(t,e,i,i)?(r.mode=31,-4):(r.havedict=1,N):U},r.inflateInfo=\"pako inflate (from Nodeca project)\"},{\"../utils/common\":41,\"./adler32\":43,\"./crc32\":45,\"./inffast\":48,\"./inftrees\":50}],50:[function(t,e,r){\"use strict\";var D=t(\"../utils/common\"),F=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],P=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,i,n,s,a,o){var h,u,l,f,d,c,p,m,_,g=o.bits,b=0,v=0,y=0,w=0,k=0,x=0,S=0,z=0,C=0,E=0,A=null,I=0,O=new D.Buf16(16),B=new D.Buf16(16),R=null,T=0;for(b=0;b<=15;b++)O[b]=0;for(v=0;v<i;v++)O[e[r+v]]++;for(k=g,w=15;1<=w&&0===O[w];w--);if(w<k&&(k=w),0===w)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(y=1;y<w&&0===O[y];y++);for(k<y&&(k=y),b=z=1;b<=15;b++)if(z<<=1,(z-=O[b])<0)return-1;if(0<z&&(0===t||1!==w))return-1;for(B[1]=0,b=1;b<15;b++)B[b+1]=B[b]+O[b];for(v=0;v<i;v++)0!==e[r+v]&&(a[B[e[r+v]]++]=v);if(c=0===t?(A=R=a,19):1===t?(A=F,I-=257,R=N,T-=257,256):(A=U,R=P,-1),b=y,d=s,S=v=E=0,l=-1,f=(C=1<<(x=k))-1,1===t&&852<C||2===t&&592<C)return 1;for(;;){for(p=b-S,_=a[v]<c?(m=0,a[v]):a[v]>c?(m=R[T+a[v]],A[I+a[v]]):(m=96,0),h=1<<b-S,y=u=1<<x;n[d+(E>>S)+(u-=h)]=p<<24|m<<16|_|0,0!==u;);for(h=1<<b-1;E&h;)h>>=1;if(0!==h?(E&=h-1,E+=h):E=0,v++,0==--O[b]){if(b===w)break;b=e[r+a[v]]}if(k<b&&(E&f)!==l){for(0===S&&(S=k),d+=y,z=1<<(x=b-S);x+S<w&&!((z-=O[x+S])<=0);)x++,z<<=1;if(C+=1<<x,1===t&&852<C||2===t&&592<C)return 1;n[l=E&f]=k<<24|x<<16|d-s|0}}return 0!==E&&(n[d+E]=b-S<<24|64<<16|0),o.bits=k,0}},{\"../utils/common\":41}],51:[function(t,e,r){\"use strict\";e.exports={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"}},{}],52:[function(t,e,r){\"use strict\";var n=t(\"../utils/common\"),o=0,h=1;function i(t){for(var e=t.length;0<=--e;)t[e]=0}var s=0,a=29,u=256,l=u+1+a,f=30,d=19,_=2*l+1,g=15,c=16,p=7,m=256,b=16,v=17,y=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(l+2));i(z);var C=new Array(2*f);i(C);var E=new Array(512);i(E);var A=new Array(256);i(A);var I=new Array(a);i(I);var O,B,R,T=new Array(f);function D(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function F(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function N(t){return t<256?E[t]:E[256+(t>>>7)]}function U(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function P(t,e,r){t.bi_valid>c-r?(t.bi_buf|=e<<t.bi_valid&65535,U(t,t.bi_buf),t.bi_buf=e>>c-t.bi_valid,t.bi_valid+=r-c):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function L(t,e,r){P(t,r[2*e],r[2*e+1])}function j(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function Z(t,e,r){var i,n,s=new Array(g+1),a=0;for(i=1;i<=g;i++)s[i]=a=a+r[i-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=j(s[o]++,o))}}function W(t){var e;for(e=0;e<l;e++)t.dyn_ltree[2*e]=0;for(e=0;e<f;e++)t.dyn_dtree[2*e]=0;for(e=0;e<d;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*m]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function M(t){8<t.bi_valid?U(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function H(t,e,r,i){var n=2*e,s=2*r;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[r]}function G(t,e,r){for(var i=t.heap[r],n=r<<1;n<=t.heap_len&&(n<t.heap_len&&H(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!H(e,i,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=i}function K(t,e,r){var i,n,s,a,o=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],n=t.pending_buf[t.l_buf+o],o++,0===i?L(t,n,e):(L(t,(s=A[n])+u+1,e),0!==(a=w[s])&&P(t,n-=I[s],a),L(t,s=N(--i),r),0!==(a=k[s])&&P(t,i-=T[s],a)),o<t.last_lit;);L(t,m,e)}function Y(t,e){var r,i,n,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,h=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=_,r=0;r<h;r++)0!==s[2*r]?(t.heap[++t.heap_len]=u=r,t.depth[r]=0):s[2*r+1]=0;for(;t.heap_len<2;)s[2*(n=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=a[2*n+1]);for(e.max_code=u,r=t.heap_len>>1;1<=r;r--)G(t,s,r);for(n=h;r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],G(t,s,1),i=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=i,s[2*n]=s[2*r]+s[2*i],t.depth[n]=(t.depth[r]>=t.depth[i]?t.depth[r]:t.depth[i])+1,s[2*r+1]=s[2*i+1]=n,t.heap[1]=n++,G(t,s,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var r,i,n,s,a,o,h=e.dyn_tree,u=e.max_code,l=e.stat_desc.static_tree,f=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,c=e.stat_desc.extra_base,p=e.stat_desc.max_length,m=0;for(s=0;s<=g;s++)t.bl_count[s]=0;for(h[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<_;r++)p<(s=h[2*h[2*(i=t.heap[r])+1]+1]+1)&&(s=p,m++),h[2*i+1]=s,u<i||(t.bl_count[s]++,a=0,c<=i&&(a=d[i-c]),o=h[2*i],t.opt_len+=o*(s+a),f&&(t.static_len+=o*(l[2*i+1]+a)));if(0!==m){do{for(s=p-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[p]--,m-=2}while(0<m);for(s=p;0!==s;s--)for(i=t.bl_count[s];0!==i;)u<(n=t.heap[--r])||(h[2*n+1]!==s&&(t.opt_len+=(s-h[2*n+1])*h[2*n],h[2*n+1]=s),i--)}}(t,e),Z(s,u,t.bl_count)}function X(t,e,r){var i,n,s=-1,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),e[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=e[2*(i+1)+1],++o<h&&n===a||(o<u?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[2*b]++):o<=10?t.bl_tree[2*v]++:t.bl_tree[2*y]++,s=n,u=(o=0)===a?(h=138,3):n===a?(h=6,3):(h=7,4))}function V(t,e,r){var i,n,s=-1,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),i=0;i<=r;i++)if(n=a,a=e[2*(i+1)+1],!(++o<h&&n===a)){if(o<u)for(;L(t,n,t.bl_tree),0!=--o;);else 0!==n?(n!==s&&(L(t,n,t.bl_tree),o--),L(t,b,t.bl_tree),P(t,o-3,2)):o<=10?(L(t,v,t.bl_tree),P(t,o-3,3)):(L(t,y,t.bl_tree),P(t,o-11,7));s=n,u=(o=0)===a?(h=138,3):n===a?(h=6,3):(h=7,4)}}i(T);var q=!1;function J(t,e,r,i){P(t,(s<<1)+(i?1:0),3),function(t,e,r,i){M(t),i&&(U(t,r),U(t,~r)),n.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r,!0)}r._tr_init=function(t){q||(function(){var t,e,r,i,n,s=new Array(g+1);for(i=r=0;i<a-1;i++)for(I[i]=r,t=0;t<1<<w[i];t++)A[r++]=i;for(A[r-1]=i,i=n=0;i<16;i++)for(T[i]=n,t=0;t<1<<k[i];t++)E[n++]=i;for(n>>=7;i<f;i++)for(T[i]=n<<7,t=0;t<1<<k[i]-7;t++)E[256+n++]=i;for(e=0;e<=g;e++)s[e]=0;for(t=0;t<=143;)z[2*t+1]=8,t++,s[8]++;for(;t<=255;)z[2*t+1]=9,t++,s[9]++;for(;t<=279;)z[2*t+1]=7,t++,s[7]++;for(;t<=287;)z[2*t+1]=8,t++,s[8]++;for(Z(z,l+1,s),t=0;t<f;t++)C[2*t+1]=5,C[2*t]=j(t,5);O=new D(z,w,u+1,l,g),B=new D(C,k,0,f,g),R=new D(new Array(0),x,0,d,p)}(),q=!0),t.l_desc=new F(t.dyn_ltree,O),t.d_desc=new F(t.dyn_dtree,B),t.bl_desc=new F(t.bl_tree,R),t.bi_buf=0,t.bi_valid=0,W(t)},r._tr_stored_block=J,r._tr_flush_block=function(t,e,r,i){var n,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return h;for(e=32;e<u;e++)if(0!==t.dyn_ltree[2*e])return h;return o}(t)),Y(t,t.l_desc),Y(t,t.d_desc),a=function(t){var e;for(X(t,t.dyn_ltree,t.l_desc.max_code),X(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),e=d-1;3<=e&&0===t.bl_tree[2*S[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=n&&(n=s)):n=s=r+5,r+4<=n&&-1!==e?J(t,e,r,i):4===t.strategy||s===n?(P(t,2+(i?1:0),3),K(t,z,C)):(P(t,4+(i?1:0),3),function(t,e,r,i){var n;for(P(t,e-257,5),P(t,r-1,5),P(t,i-4,4),n=0;n<i;n++)P(t,t.bl_tree[2*S[n]+1],3);V(t,t.dyn_ltree,e-1),V(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),K(t,t.dyn_ltree,t.dyn_dtree)),W(t),i&&M(t)},r._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(A[r]+u+1)]++,t.dyn_dtree[2*N(e)]++),t.last_lit===t.lit_bufsize-1},r._tr_align=function(t){P(t,2,3),L(t,m,z),function(t){16===t.bi_valid?(U(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{\"../utils/common\":41}],53:[function(t,e,r){\"use strict\";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,r){\"use strict\";e.exports=\"function\"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)});","/*!\n    localForage -- Offline Storage, Improved\n    Version 1.10.0\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.localforage = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw (f.code=\"MODULE_NOT_FOUND\", f)}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\n'use strict';\nvar immediate = _dereq_(1);\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n\n},{\"1\":1}],3:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nif (typeof global.Promise !== 'function') {\n  global.Promise = _dereq_(2);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"2\":2}],4:[function(_dereq_,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getIDB() {\n    /* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */\n    try {\n        if (typeof indexedDB !== 'undefined') {\n            return indexedDB;\n        }\n        if (typeof webkitIndexedDB !== 'undefined') {\n            return webkitIndexedDB;\n        }\n        if (typeof mozIndexedDB !== 'undefined') {\n            return mozIndexedDB;\n        }\n        if (typeof OIndexedDB !== 'undefined') {\n            return OIndexedDB;\n        }\n        if (typeof msIndexedDB !== 'undefined') {\n            return msIndexedDB;\n        }\n    } catch (e) {\n        return;\n    }\n}\n\nvar idb = getIDB();\n\nfunction isIndexedDBValid() {\n    try {\n        // Initialize IndexedDB; fall back to vendor-prefixed versions\n        // if needed.\n        if (!idb || !idb.open) {\n            return false;\n        }\n        // We mimic PouchDB here;\n        //\n        // We test for openDatabase because IE Mobile identifies itself\n        // as Safari. Oh the lulz...\n        var isSafari = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform);\n\n        var hasFetch = typeof fetch === 'function' && fetch.toString().indexOf('[native code') !== -1;\n\n        // Safari <10.1 does not meet our requirements for IDB support\n        // (see: https://github.com/pouchdb/pouchdb/issues/5572).\n        // Safari 10.1 shipped with fetch, we can use that to detect it.\n        // Note: this creates issues with `window.fetch` polyfills and\n        // overrides; see:\n        // https://github.com/localForage/localForage/issues/856\n        return (!isSafari || hasFetch) && typeof indexedDB !== 'undefined' &&\n        // some outdated implementations of IDB that appear on Samsung\n        // and HTC Android devices <4.4 are missing IDBKeyRange\n        // See: https://github.com/mozilla/localForage/issues/128\n        // See: https://github.com/mozilla/localForage/issues/272\n        typeof IDBKeyRange !== 'undefined';\n    } catch (e) {\n        return false;\n    }\n}\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\nfunction createBlob(parts, properties) {\n    /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n    parts = parts || [];\n    properties = properties || {};\n    try {\n        return new Blob(parts, properties);\n    } catch (e) {\n        if (e.name !== 'TypeError') {\n            throw e;\n        }\n        var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder;\n        var builder = new Builder();\n        for (var i = 0; i < parts.length; i += 1) {\n            builder.append(parts[i]);\n        }\n        return builder.getBlob(properties.type);\n    }\n}\n\n// This is CommonJS because lie is an external dependency, so Rollup\n// can just ignore it.\nif (typeof Promise === 'undefined') {\n    // In the \"nopromises\" build this will just throw if you don't have\n    // a global promise object, but it would throw anyway later.\n    _dereq_(3);\n}\nvar Promise$1 = Promise;\n\nfunction executeCallback(promise, callback) {\n    if (callback) {\n        promise.then(function (result) {\n            callback(null, result);\n        }, function (error) {\n            callback(error);\n        });\n    }\n}\n\nfunction executeTwoCallbacks(promise, callback, errorCallback) {\n    if (typeof callback === 'function') {\n        promise.then(callback);\n    }\n\n    if (typeof errorCallback === 'function') {\n        promise[\"catch\"](errorCallback);\n    }\n}\n\nfunction normalizeKey(key) {\n    // Cast the key to a string, as that's all we can set as a key.\n    if (typeof key !== 'string') {\n        console.warn(key + ' used as a key, but it is not a string.');\n        key = String(key);\n    }\n\n    return key;\n}\n\nfunction getCallback() {\n    if (arguments.length && typeof arguments[arguments.length - 1] === 'function') {\n        return arguments[arguments.length - 1];\n    }\n}\n\n// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n\nvar DETECT_BLOB_SUPPORT_STORE = 'local-forage-detect-blob-support';\nvar supportsBlobs = void 0;\nvar dbContexts = {};\nvar toString = Object.prototype.toString;\n\n// Transaction Modes\nvar READ_ONLY = 'readonly';\nvar READ_WRITE = 'readwrite';\n\n// Transform a binary string to an array buffer, because otherwise\n// weird stuff happens when you try to work with the binary string directly.\n// It is known.\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction _binStringToArrayBuffer(bin) {\n    var length = bin.length;\n    var buf = new ArrayBuffer(length);\n    var arr = new Uint8Array(buf);\n    for (var i = 0; i < length; i++) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return buf;\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\n// Code borrowed from PouchDB. See:\n// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js\n//\nfunction _checkBlobSupportWithoutCaching(idb) {\n    return new Promise$1(function (resolve) {\n        var txn = idb.transaction(DETECT_BLOB_SUPPORT_STORE, READ_WRITE);\n        var blob = createBlob(['']);\n        txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob, 'key');\n\n        txn.onabort = function (e) {\n            // If the transaction aborts now its due to not being able to\n            // write to the database, likely due to the disk being full\n            e.preventDefault();\n            e.stopPropagation();\n            resolve(false);\n        };\n\n        txn.oncomplete = function () {\n            var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n            var matchedEdge = navigator.userAgent.match(/Edge\\//);\n            // MS Edge pretends to be Chrome 42:\n            // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n            resolve(matchedEdge || !matchedChrome || parseInt(matchedChrome[1], 10) >= 43);\n        };\n    })[\"catch\"](function () {\n        return false; // error, so assume unsupported\n    });\n}\n\nfunction _checkBlobSupport(idb) {\n    if (typeof supportsBlobs === 'boolean') {\n        return Promise$1.resolve(supportsBlobs);\n    }\n    return _checkBlobSupportWithoutCaching(idb).then(function (value) {\n        supportsBlobs = value;\n        return supportsBlobs;\n    });\n}\n\nfunction _deferReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Create a deferred object representing the current database operation.\n    var deferredOperation = {};\n\n    deferredOperation.promise = new Promise$1(function (resolve, reject) {\n        deferredOperation.resolve = resolve;\n        deferredOperation.reject = reject;\n    });\n\n    // Enqueue the deferred operation.\n    dbContext.deferredOperations.push(deferredOperation);\n\n    // Chain its promise to the database readiness.\n    if (!dbContext.dbReady) {\n        dbContext.dbReady = deferredOperation.promise;\n    } else {\n        dbContext.dbReady = dbContext.dbReady.then(function () {\n            return deferredOperation.promise;\n        });\n    }\n}\n\nfunction _advanceReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Resolve its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.resolve();\n        return deferredOperation.promise;\n    }\n}\n\nfunction _rejectReadiness(dbInfo, err) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Reject its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.reject(err);\n        return deferredOperation.promise;\n    }\n}\n\nfunction _getConnection(dbInfo, upgradeNeeded) {\n    return new Promise$1(function (resolve, reject) {\n        dbContexts[dbInfo.name] = dbContexts[dbInfo.name] || createDbContext();\n\n        if (dbInfo.db) {\n            if (upgradeNeeded) {\n                _deferReadiness(dbInfo);\n                dbInfo.db.close();\n            } else {\n                return resolve(dbInfo.db);\n            }\n        }\n\n        var dbArgs = [dbInfo.name];\n\n        if (upgradeNeeded) {\n            dbArgs.push(dbInfo.version);\n        }\n\n        var openreq = idb.open.apply(idb, dbArgs);\n\n        if (upgradeNeeded) {\n            openreq.onupgradeneeded = function (e) {\n                var db = openreq.result;\n                try {\n                    db.createObjectStore(dbInfo.storeName);\n                    if (e.oldVersion <= 1) {\n                        // Added when support for blob shims was added\n                        db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n                    }\n                } catch (ex) {\n                    if (ex.name === 'ConstraintError') {\n                        console.warn('The database \"' + dbInfo.name + '\"' + ' has been upgraded from version ' + e.oldVersion + ' to version ' + e.newVersion + ', but the storage \"' + dbInfo.storeName + '\" already exists.');\n                    } else {\n                        throw ex;\n                    }\n                }\n            };\n        }\n\n        openreq.onerror = function (e) {\n            e.preventDefault();\n            reject(openreq.error);\n        };\n\n        openreq.onsuccess = function () {\n            var db = openreq.result;\n            db.onversionchange = function (e) {\n                // Triggered when the database is modified (e.g. adding an objectStore) or\n                // deleted (even when initiated by other sessions in different tabs).\n                // Closing the connection here prevents those operations from being blocked.\n                // If the database is accessed again later by this instance, the connection\n                // will be reopened or the database recreated as needed.\n                e.target.close();\n            };\n            resolve(db);\n            _advanceReadiness(dbInfo);\n        };\n    });\n}\n\nfunction _getOriginalConnection(dbInfo) {\n    return _getConnection(dbInfo, false);\n}\n\nfunction _getUpgradedConnection(dbInfo) {\n    return _getConnection(dbInfo, true);\n}\n\nfunction _isUpgradeNeeded(dbInfo, defaultVersion) {\n    if (!dbInfo.db) {\n        return true;\n    }\n\n    var isNewStore = !dbInfo.db.objectStoreNames.contains(dbInfo.storeName);\n    var isDowngrade = dbInfo.version < dbInfo.db.version;\n    var isUpgrade = dbInfo.version > dbInfo.db.version;\n\n    if (isDowngrade) {\n        // If the version is not the default one\n        // then warn for impossible downgrade.\n        if (dbInfo.version !== defaultVersion) {\n            console.warn('The database \"' + dbInfo.name + '\"' + \" can't be downgraded from version \" + dbInfo.db.version + ' to version ' + dbInfo.version + '.');\n        }\n        // Align the versions to prevent errors.\n        dbInfo.version = dbInfo.db.version;\n    }\n\n    if (isUpgrade || isNewStore) {\n        // If the store is new then increment the version (if needed).\n        // This will trigger an \"upgradeneeded\" event which is required\n        // for creating a store.\n        if (isNewStore) {\n            var incVersion = dbInfo.db.version + 1;\n            if (incVersion > dbInfo.version) {\n                dbInfo.version = incVersion;\n            }\n        }\n\n        return true;\n    }\n\n    return false;\n}\n\n// encode a blob for indexeddb engines that don't support blobs\nfunction _encodeBlob(blob) {\n    return new Promise$1(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = function (e) {\n            var base64 = btoa(e.target.result || '');\n            resolve({\n                __local_forage_encoded_blob: true,\n                data: base64,\n                type: blob.type\n            });\n        };\n        reader.readAsBinaryString(blob);\n    });\n}\n\n// decode an encoded blob\nfunction _decodeBlob(encodedBlob) {\n    var arrayBuff = _binStringToArrayBuffer(atob(encodedBlob.data));\n    return createBlob([arrayBuff], { type: encodedBlob.type });\n}\n\n// is this one of our fancy encoded blobs?\nfunction _isEncodedBlob(value) {\n    return value && value.__local_forage_encoded_blob;\n}\n\n// Specialize the default `ready()` function by making it dependent\n// on the current database operations. Thus, the driver will be actually\n// ready when it's been initialized (default) *and* there are no pending\n// operations on the database (initiated by some other instances).\nfunction _fullyReady(callback) {\n    var self = this;\n\n    var promise = self._initReady().then(function () {\n        var dbContext = dbContexts[self._dbInfo.name];\n\n        if (dbContext && dbContext.dbReady) {\n            return dbContext.dbReady;\n        }\n    });\n\n    executeTwoCallbacks(promise, callback, callback);\n    return promise;\n}\n\n// Try to establish a new db connection to replace the\n// current one which is broken (i.e. experiencing\n// InvalidStateError while creating a transaction).\nfunction _tryReconnect(dbInfo) {\n    _deferReadiness(dbInfo);\n\n    var dbContext = dbContexts[dbInfo.name];\n    var forages = dbContext.forages;\n\n    for (var i = 0; i < forages.length; i++) {\n        var forage = forages[i];\n        if (forage._dbInfo.db) {\n            forage._dbInfo.db.close();\n            forage._dbInfo.db = null;\n        }\n    }\n    dbInfo.db = null;\n\n    return _getOriginalConnection(dbInfo).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        // store the latest db reference\n        // in case the db was upgraded\n        dbInfo.db = dbContext.db = db;\n        for (var i = 0; i < forages.length; i++) {\n            forages[i]._dbInfo.db = db;\n        }\n    })[\"catch\"](function (err) {\n        _rejectReadiness(dbInfo, err);\n        throw err;\n    });\n}\n\n// FF doesn't like Promises (micro-tasks) and IDDB store operations,\n// so we have to do it with callbacks\nfunction createTransaction(dbInfo, mode, callback, retries) {\n    if (retries === undefined) {\n        retries = 1;\n    }\n\n    try {\n        var tx = dbInfo.db.transaction(dbInfo.storeName, mode);\n        callback(null, tx);\n    } catch (err) {\n        if (retries > 0 && (!dbInfo.db || err.name === 'InvalidStateError' || err.name === 'NotFoundError')) {\n            return Promise$1.resolve().then(function () {\n                if (!dbInfo.db || err.name === 'NotFoundError' && !dbInfo.db.objectStoreNames.contains(dbInfo.storeName) && dbInfo.version <= dbInfo.db.version) {\n                    // increase the db version, to create the new ObjectStore\n                    if (dbInfo.db) {\n                        dbInfo.version = dbInfo.db.version + 1;\n                    }\n                    // Reopen the database for upgrading.\n                    return _getUpgradedConnection(dbInfo);\n                }\n            }).then(function () {\n                return _tryReconnect(dbInfo).then(function () {\n                    createTransaction(dbInfo, mode, callback, retries - 1);\n                });\n            })[\"catch\"](callback);\n        }\n\n        callback(err);\n    }\n}\n\nfunction createDbContext() {\n    return {\n        // Running localForages sharing a database.\n        forages: [],\n        // Shared database.\n        db: null,\n        // Database readiness (promise).\n        dbReady: null,\n        // Deferred operations on the database.\n        deferredOperations: []\n    };\n}\n\n// Open the IndexedDB database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    // Get the current context of the database;\n    var dbContext = dbContexts[dbInfo.name];\n\n    // ...or create a new context.\n    if (!dbContext) {\n        dbContext = createDbContext();\n        // Register the new context in the global container.\n        dbContexts[dbInfo.name] = dbContext;\n    }\n\n    // Register itself as a running localForage in the current context.\n    dbContext.forages.push(self);\n\n    // Replace the default `ready()` function with the specialized one.\n    if (!self._initReady) {\n        self._initReady = self.ready;\n        self.ready = _fullyReady;\n    }\n\n    // Create an array of initialization states of the related localForages.\n    var initPromises = [];\n\n    function ignoreErrors() {\n        // Don't handle errors here,\n        // just makes sure related localForages aren't pending.\n        return Promise$1.resolve();\n    }\n\n    for (var j = 0; j < dbContext.forages.length; j++) {\n        var forage = dbContext.forages[j];\n        if (forage !== self) {\n            // Don't wait for itself...\n            initPromises.push(forage._initReady()[\"catch\"](ignoreErrors));\n        }\n    }\n\n    // Take a snapshot of the related localForages.\n    var forages = dbContext.forages.slice(0);\n\n    // Initialize the connection process only when\n    // all the related localForages aren't pending.\n    return Promise$1.all(initPromises).then(function () {\n        dbInfo.db = dbContext.db;\n        // Get the connection or open a new one without upgrade.\n        return _getOriginalConnection(dbInfo);\n    }).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo, self._defaultConfig.version)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        dbInfo.db = dbContext.db = db;\n        self._dbInfo = dbInfo;\n        // Share the final connection amongst related localForages.\n        for (var k = 0; k < forages.length; k++) {\n            var forage = forages[k];\n            if (forage !== self) {\n                // Self is already up-to-date.\n                forage._dbInfo.db = dbInfo.db;\n                forage._dbInfo.version = dbInfo.version;\n            }\n        }\n    });\n}\n\nfunction getItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.get(key);\n\n                    req.onsuccess = function () {\n                        var value = req.result;\n                        if (value === undefined) {\n                            value = null;\n                        }\n                        if (_isEncodedBlob(value)) {\n                            value = _decodeBlob(value);\n                        }\n                        resolve(value);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items stored in database.\nfunction iterate(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var iterationNumber = 1;\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (cursor) {\n                            var value = cursor.value;\n                            if (_isEncodedBlob(value)) {\n                                value = _decodeBlob(value);\n                            }\n                            var result = iterator(value, cursor.key, iterationNumber++);\n\n                            // when the iterator callback returns any\n                            // (non-`undefined`) value, then we stop\n                            // the iteration immediately\n                            if (result !== void 0) {\n                                resolve(result);\n                            } else {\n                                cursor[\"continue\"]();\n                            }\n                        } else {\n                            resolve();\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n\n    return promise;\n}\n\nfunction setItem(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        var dbInfo;\n        self.ready().then(function () {\n            dbInfo = self._dbInfo;\n            if (toString.call(value) === '[object Blob]') {\n                return _checkBlobSupport(dbInfo.db).then(function (blobSupport) {\n                    if (blobSupport) {\n                        return value;\n                    }\n                    return _encodeBlob(value);\n                });\n            }\n            return value;\n        }).then(function (value) {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n\n                    // The reason we don't _save_ null is because IE 10 does\n                    // not support saving the `null` type in IndexedDB. How\n                    // ironic, given the bug below!\n                    // See: https://github.com/mozilla/localForage/issues/161\n                    if (value === null) {\n                        value = undefined;\n                    }\n\n                    var req = store.put(value, key);\n\n                    transaction.oncomplete = function () {\n                        // Cast to undefined so the value passed to\n                        // callback/promise is the same as what one would get out\n                        // of `getItem()` later. This leads to some weirdness\n                        // (setItem('foo', undefined) will return `null`), but\n                        // it's not my fault localStorage is our baseline and that\n                        // it's weird.\n                        if (value === undefined) {\n                            value = null;\n                        }\n\n                        resolve(value);\n                    };\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction removeItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    // We use a Grunt task to make this safe for IE and some\n                    // versions of Android (including those used by Cordova).\n                    // Normally IE won't like `.delete()` and will insist on\n                    // using `['delete']()`, but we have a build step that\n                    // fixes this for us now.\n                    var req = store[\"delete\"](key);\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onerror = function () {\n                        reject(req.error);\n                    };\n\n                    // The request will be also be aborted if we've exceeded our storage\n                    // space.\n                    transaction.onabort = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction clear(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.clear();\n\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction length(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.count();\n\n                    req.onsuccess = function () {\n                        resolve(req.result);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction key(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        if (n < 0) {\n            resolve(null);\n\n            return;\n        }\n\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var advanced = false;\n                    var req = store.openKeyCursor();\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            // this means there weren't enough keys\n                            resolve(null);\n\n                            return;\n                        }\n\n                        if (n === 0) {\n                            // We have the first key, return it if that's what they\n                            // wanted.\n                            resolve(cursor.key);\n                        } else {\n                            if (!advanced) {\n                                // Otherwise, ask the cursor to skip ahead n\n                                // records.\n                                advanced = true;\n                                cursor.advance(n);\n                            } else {\n                                // When we get here, we've got the nth key.\n                                resolve(cursor.key);\n                            }\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openKeyCursor();\n                    var keys = [];\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (!cursor) {\n                            resolve(keys);\n                            return;\n                        }\n\n                        keys.push(cursor.key);\n                        cursor[\"continue\"]();\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        var isCurrentDb = options.name === currentConfig.name && self._dbInfo.db;\n\n        var dbPromise = isCurrentDb ? Promise$1.resolve(self._dbInfo.db) : _getOriginalConnection(options).then(function (db) {\n            var dbContext = dbContexts[options.name];\n            var forages = dbContext.forages;\n            dbContext.db = db;\n            for (var i = 0; i < forages.length; i++) {\n                forages[i]._dbInfo.db = db;\n            }\n            return db;\n        });\n\n        if (!options.storeName) {\n            promise = dbPromise.then(function (db) {\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                }\n\n                var dropDBPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.deleteDatabase(options.name);\n\n                    req.onerror = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        reject(req.error);\n                    };\n\n                    req.onblocked = function () {\n                        // Closing all open connections in onversionchange handler should prevent this situation, but if\n                        // we do get here, it just means the request remains pending - eventually it will succeed or error\n                        console.warn('dropInstance blocked for database \"' + options.name + '\" until all open connections are closed');\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        resolve(db);\n                    };\n                });\n\n                return dropDBPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var i = 0; i < forages.length; i++) {\n                        var _forage = forages[i];\n                        _advanceReadiness(_forage._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        } else {\n            promise = dbPromise.then(function (db) {\n                if (!db.objectStoreNames.contains(options.storeName)) {\n                    return;\n                }\n\n                var newVersion = db.version + 1;\n\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                    forage._dbInfo.version = newVersion;\n                }\n\n                var dropObjectPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.open(options.name, newVersion);\n\n                    req.onerror = function (err) {\n                        var db = req.result;\n                        db.close();\n                        reject(err);\n                    };\n\n                    req.onupgradeneeded = function () {\n                        var db = req.result;\n                        db.deleteObjectStore(options.storeName);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        db.close();\n                        resolve(db);\n                    };\n                });\n\n                return dropObjectPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var j = 0; j < forages.length; j++) {\n                        var _forage2 = forages[j];\n                        _forage2._dbInfo.db = db;\n                        _advanceReadiness(_forage2._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        }\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar asyncStorage = {\n    _driver: 'asyncStorage',\n    _initStorage: _initStorage,\n    _support: isIndexedDBValid(),\n    iterate: iterate,\n    getItem: getItem,\n    setItem: setItem,\n    removeItem: removeItem,\n    clear: clear,\n    length: length,\n    key: key,\n    keys: keys,\n    dropInstance: dropInstance\n};\n\nfunction isWebSQLValid() {\n    return typeof openDatabase === 'function';\n}\n\n// Sadly, the best way to save binary data in WebSQL/localStorage is serializing\n// it to Base64, so this is how we store it to prevent very strange errors with less\n// verbose ways of binary <-> string data storage.\nvar BASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nvar BLOB_TYPE_PREFIX = '~~local_forage_type~';\nvar BLOB_TYPE_PREFIX_REGEX = /^~~local_forage_type~([^~]+)~/;\n\nvar SERIALIZED_MARKER = '__lfsc__:';\nvar SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER.length;\n\n// OMG the serializations!\nvar TYPE_ARRAYBUFFER = 'arbf';\nvar TYPE_BLOB = 'blob';\nvar TYPE_INT8ARRAY = 'si08';\nvar TYPE_UINT8ARRAY = 'ui08';\nvar TYPE_UINT8CLAMPEDARRAY = 'uic8';\nvar TYPE_INT16ARRAY = 'si16';\nvar TYPE_INT32ARRAY = 'si32';\nvar TYPE_UINT16ARRAY = 'ur16';\nvar TYPE_UINT32ARRAY = 'ui32';\nvar TYPE_FLOAT32ARRAY = 'fl32';\nvar TYPE_FLOAT64ARRAY = 'fl64';\nvar TYPE_SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER_LENGTH + TYPE_ARRAYBUFFER.length;\n\nvar toString$1 = Object.prototype.toString;\n\nfunction stringToBuffer(serializedString) {\n    // Fill the string into a ArrayBuffer.\n    var bufferLength = serializedString.length * 0.75;\n    var len = serializedString.length;\n    var i;\n    var p = 0;\n    var encoded1, encoded2, encoded3, encoded4;\n\n    if (serializedString[serializedString.length - 1] === '=') {\n        bufferLength--;\n        if (serializedString[serializedString.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    var buffer = new ArrayBuffer(bufferLength);\n    var bytes = new Uint8Array(buffer);\n\n    for (i = 0; i < len; i += 4) {\n        encoded1 = BASE_CHARS.indexOf(serializedString[i]);\n        encoded2 = BASE_CHARS.indexOf(serializedString[i + 1]);\n        encoded3 = BASE_CHARS.indexOf(serializedString[i + 2]);\n        encoded4 = BASE_CHARS.indexOf(serializedString[i + 3]);\n\n        /*jslint bitwise: true */\n        bytes[p++] = encoded1 << 2 | encoded2 >> 4;\n        bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;\n        bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;\n    }\n    return buffer;\n}\n\n// Converts a buffer to a string to store, serialized, in the backend\n// storage library.\nfunction bufferToString(buffer) {\n    // base64-arraybuffer\n    var bytes = new Uint8Array(buffer);\n    var base64String = '';\n    var i;\n\n    for (i = 0; i < bytes.length; i += 3) {\n        /*jslint bitwise: true */\n        base64String += BASE_CHARS[bytes[i] >> 2];\n        base64String += BASE_CHARS[(bytes[i] & 3) << 4 | bytes[i + 1] >> 4];\n        base64String += BASE_CHARS[(bytes[i + 1] & 15) << 2 | bytes[i + 2] >> 6];\n        base64String += BASE_CHARS[bytes[i + 2] & 63];\n    }\n\n    if (bytes.length % 3 === 2) {\n        base64String = base64String.substring(0, base64String.length - 1) + '=';\n    } else if (bytes.length % 3 === 1) {\n        base64String = base64String.substring(0, base64String.length - 2) + '==';\n    }\n\n    return base64String;\n}\n\n// Serialize a value, afterwards executing a callback (which usually\n// instructs the `setItem()` callback/promise to be executed). This is how\n// we store binary data with localStorage.\nfunction serialize(value, callback) {\n    var valueType = '';\n    if (value) {\n        valueType = toString$1.call(value);\n    }\n\n    // Cannot use `value instanceof ArrayBuffer` or such here, as these\n    // checks fail when running the tests using casper.js...\n    //\n    // TODO: See why those tests fail and use a better solution.\n    if (value && (valueType === '[object ArrayBuffer]' || value.buffer && toString$1.call(value.buffer) === '[object ArrayBuffer]')) {\n        // Convert binary arrays to a string and prefix the string with\n        // a special marker.\n        var buffer;\n        var marker = SERIALIZED_MARKER;\n\n        if (value instanceof ArrayBuffer) {\n            buffer = value;\n            marker += TYPE_ARRAYBUFFER;\n        } else {\n            buffer = value.buffer;\n\n            if (valueType === '[object Int8Array]') {\n                marker += TYPE_INT8ARRAY;\n            } else if (valueType === '[object Uint8Array]') {\n                marker += TYPE_UINT8ARRAY;\n            } else if (valueType === '[object Uint8ClampedArray]') {\n                marker += TYPE_UINT8CLAMPEDARRAY;\n            } else if (valueType === '[object Int16Array]') {\n                marker += TYPE_INT16ARRAY;\n            } else if (valueType === '[object Uint16Array]') {\n                marker += TYPE_UINT16ARRAY;\n            } else if (valueType === '[object Int32Array]') {\n                marker += TYPE_INT32ARRAY;\n            } else if (valueType === '[object Uint32Array]') {\n                marker += TYPE_UINT32ARRAY;\n            } else if (valueType === '[object Float32Array]') {\n                marker += TYPE_FLOAT32ARRAY;\n            } else if (valueType === '[object Float64Array]') {\n                marker += TYPE_FLOAT64ARRAY;\n            } else {\n                callback(new Error('Failed to get type for BinaryArray'));\n            }\n        }\n\n        callback(marker + bufferToString(buffer));\n    } else if (valueType === '[object Blob]') {\n        // Conver the blob to a binaryArray and then to a string.\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n            // Backwards-compatible prefix for the blob type.\n            var str = BLOB_TYPE_PREFIX + value.type + '~' + bufferToString(this.result);\n\n            callback(SERIALIZED_MARKER + TYPE_BLOB + str);\n        };\n\n        fileReader.readAsArrayBuffer(value);\n    } else {\n        try {\n            callback(JSON.stringify(value));\n        } catch (e) {\n            console.error(\"Couldn't convert value into a JSON string: \", value);\n\n            callback(null, e);\n        }\n    }\n}\n\n// Deserialize data we've inserted into a value column/field. We place\n// special markers into our strings to mark them as encoded; this isn't\n// as nice as a meta field, but it's the only sane thing we can do whilst\n// keeping localStorage support intact.\n//\n// Oftentimes this will just deserialize JSON content, but if we have a\n// special marker (SERIALIZED_MARKER, defined above), we will extract\n// some kind of arraybuffer/binary data/typed array out of the string.\nfunction deserialize(value) {\n    // If we haven't marked this string as being specially serialized (i.e.\n    // something other than serialized JSON), we can just return it and be\n    // done with it.\n    if (value.substring(0, SERIALIZED_MARKER_LENGTH) !== SERIALIZED_MARKER) {\n        return JSON.parse(value);\n    }\n\n    // The following code deals with deserializing some kind of Blob or\n    // TypedArray. First we separate out the type of data we're dealing\n    // with from the data itself.\n    var serializedString = value.substring(TYPE_SERIALIZED_MARKER_LENGTH);\n    var type = value.substring(SERIALIZED_MARKER_LENGTH, TYPE_SERIALIZED_MARKER_LENGTH);\n\n    var blobType;\n    // Backwards-compatible blob type serialization strategy.\n    // DBs created with older versions of localForage will simply not have the blob type.\n    if (type === TYPE_BLOB && BLOB_TYPE_PREFIX_REGEX.test(serializedString)) {\n        var matcher = serializedString.match(BLOB_TYPE_PREFIX_REGEX);\n        blobType = matcher[1];\n        serializedString = serializedString.substring(matcher[0].length);\n    }\n    var buffer = stringToBuffer(serializedString);\n\n    // Return the right type based on the code/type set during\n    // serialization.\n    switch (type) {\n        case TYPE_ARRAYBUFFER:\n            return buffer;\n        case TYPE_BLOB:\n            return createBlob([buffer], { type: blobType });\n        case TYPE_INT8ARRAY:\n            return new Int8Array(buffer);\n        case TYPE_UINT8ARRAY:\n            return new Uint8Array(buffer);\n        case TYPE_UINT8CLAMPEDARRAY:\n            return new Uint8ClampedArray(buffer);\n        case TYPE_INT16ARRAY:\n            return new Int16Array(buffer);\n        case TYPE_UINT16ARRAY:\n            return new Uint16Array(buffer);\n        case TYPE_INT32ARRAY:\n            return new Int32Array(buffer);\n        case TYPE_UINT32ARRAY:\n            return new Uint32Array(buffer);\n        case TYPE_FLOAT32ARRAY:\n            return new Float32Array(buffer);\n        case TYPE_FLOAT64ARRAY:\n            return new Float64Array(buffer);\n        default:\n            throw new Error('Unkown type: ' + type);\n    }\n}\n\nvar localforageSerializer = {\n    serialize: serialize,\n    deserialize: deserialize,\n    stringToBuffer: stringToBuffer,\n    bufferToString: bufferToString\n};\n\n/*\n * Includes code from:\n *\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nfunction createDbTable(t, dbInfo, callback, errorCallback) {\n    t.executeSql('CREATE TABLE IF NOT EXISTS ' + dbInfo.storeName + ' ' + '(id INTEGER PRIMARY KEY, key unique, value)', [], callback, errorCallback);\n}\n\n// Open the WebSQL database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage$1(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = typeof options[i] !== 'string' ? options[i].toString() : options[i];\n        }\n    }\n\n    var dbInfoPromise = new Promise$1(function (resolve, reject) {\n        // Open the database; the openDatabase API will automatically\n        // create it for us if it doesn't exist.\n        try {\n            dbInfo.db = openDatabase(dbInfo.name, String(dbInfo.version), dbInfo.description, dbInfo.size);\n        } catch (e) {\n            return reject(e);\n        }\n\n        // Create our key/value table if it doesn't exist.\n        dbInfo.db.transaction(function (t) {\n            createDbTable(t, dbInfo, function () {\n                self._dbInfo = dbInfo;\n                resolve();\n            }, function (t, error) {\n                reject(error);\n            });\n        }, reject);\n    });\n\n    dbInfo.serializer = localforageSerializer;\n    return dbInfoPromise;\n}\n\nfunction tryExecuteSql(t, dbInfo, sqlStatement, args, callback, errorCallback) {\n    t.executeSql(sqlStatement, args, callback, function (t, error) {\n        if (error.code === error.SYNTAX_ERR) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name = ?\", [dbInfo.storeName], function (t, results) {\n                if (!results.rows.length) {\n                    // if the table is missing (was deleted)\n                    // re-create it table and retry\n                    createDbTable(t, dbInfo, function () {\n                        t.executeSql(sqlStatement, args, callback, errorCallback);\n                    }, errorCallback);\n                } else {\n                    errorCallback(t, error);\n                }\n            }, errorCallback);\n        } else {\n            errorCallback(t, error);\n        }\n    }, errorCallback);\n}\n\nfunction getItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName + ' WHERE key = ? LIMIT 1', [key], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).value : null;\n\n                    // Check to see if this is serialized content we need to\n                    // unpack.\n                    if (result) {\n                        result = dbInfo.serializer.deserialize(result);\n                    }\n\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction iterate$1(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var rows = results.rows;\n                    var length = rows.length;\n\n                    for (var i = 0; i < length; i++) {\n                        var item = rows.item(i);\n                        var result = item.value;\n\n                        // Check to see if this is serialized content\n                        // we need to unpack.\n                        if (result) {\n                            result = dbInfo.serializer.deserialize(result);\n                        }\n\n                        result = iterator(result, item.key, i + 1);\n\n                        // void(0) prevents problems with redefinition\n                        // of `undefined`.\n                        if (result !== void 0) {\n                            resolve(result);\n                            return;\n                        }\n                    }\n\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction _setItem(key, value, callback, retriesLeft) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            // The localStorage API doesn't return undefined values in an\n            // \"expected\" way, so undefined is always cast to null in all\n            // drivers. See: https://github.com/mozilla/localForage/pull/42\n            if (value === undefined) {\n                value = null;\n            }\n\n            // Save the original value to pass to the callback.\n            var originalValue = value;\n\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    dbInfo.db.transaction(function (t) {\n                        tryExecuteSql(t, dbInfo, 'INSERT OR REPLACE INTO ' + dbInfo.storeName + ' ' + '(key, value) VALUES (?, ?)', [key, value], function () {\n                            resolve(originalValue);\n                        }, function (t, error) {\n                            reject(error);\n                        });\n                    }, function (sqlError) {\n                        // The transaction failed; check\n                        // to see if it's a quota error.\n                        if (sqlError.code === sqlError.QUOTA_ERR) {\n                            // We reject the callback outright for now, but\n                            // it's worth trying to re-run the transaction.\n                            // Even if the user accepts the prompt to use\n                            // more storage on Safari, this error will\n                            // be called.\n                            //\n                            // Try to re-run the transaction.\n                            if (retriesLeft > 0) {\n                                resolve(_setItem.apply(self, [key, originalValue, callback, retriesLeft - 1]));\n                                return;\n                            }\n                            reject(sqlError);\n                        }\n                    });\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction setItem$1(key, value, callback) {\n    return _setItem.apply(this, [key, value, callback, 1]);\n}\n\nfunction removeItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName + ' WHERE key = ?', [key], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Deletes every item in the table.\n// TODO: Find out if this resets the AUTO_INCREMENT number.\nfunction clear$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName, [], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Does a simple `COUNT(key)` to get the number of items stored in\n// localForage.\nfunction length$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                // Ahhh, SQL makes this one soooooo easy.\n                tryExecuteSql(t, dbInfo, 'SELECT COUNT(key) as c FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var result = results.rows.item(0).c;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Return the key located at key index X; essentially gets the key from a\n// `WHERE id = ?`. This is the most efficient way I can think to implement\n// this rarely-used (in my experience) part of the API, but it can seem\n// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so\n// the ID of each key will change every time it's updated. Perhaps a stored\n// procedure for the `setItem()` SQL would solve this problem?\n// TODO: Don't change ID on `setItem()`.\nfunction key$1(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName + ' WHERE id = ? LIMIT 1', [n + 1], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).key : null;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var keys = [];\n\n                    for (var i = 0; i < results.rows.length; i++) {\n                        keys.push(results.rows.item(i).key);\n                    }\n\n                    resolve(keys);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// https://www.w3.org/TR/webdatabase/#databases\n// > There is no way to enumerate or delete the databases available for an origin from this API.\nfunction getAllStoreNames(db) {\n    return new Promise$1(function (resolve, reject) {\n        db.transaction(function (t) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\", [], function (t, results) {\n                var storeNames = [];\n\n                for (var i = 0; i < results.rows.length; i++) {\n                    storeNames.push(results.rows.item(i).name);\n                }\n\n                resolve({\n                    db: db,\n                    storeNames: storeNames\n                });\n            }, function (t, error) {\n                reject(error);\n            });\n        }, function (sqlError) {\n            reject(sqlError);\n        });\n    });\n}\n\nfunction dropInstance$1(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            var db;\n            if (options.name === currentConfig.name) {\n                // use the db reference of the current instance\n                db = self._dbInfo.db;\n            } else {\n                db = openDatabase(options.name, '', '', 0);\n            }\n\n            if (!options.storeName) {\n                // drop all database tables\n                resolve(getAllStoreNames(db));\n            } else {\n                resolve({\n                    db: db,\n                    storeNames: [options.storeName]\n                });\n            }\n        }).then(function (operationInfo) {\n            return new Promise$1(function (resolve, reject) {\n                operationInfo.db.transaction(function (t) {\n                    function dropTable(storeName) {\n                        return new Promise$1(function (resolve, reject) {\n                            t.executeSql('DROP TABLE IF EXISTS ' + storeName, [], function () {\n                                resolve();\n                            }, function (t, error) {\n                                reject(error);\n                            });\n                        });\n                    }\n\n                    var operations = [];\n                    for (var i = 0, len = operationInfo.storeNames.length; i < len; i++) {\n                        operations.push(dropTable(operationInfo.storeNames[i]));\n                    }\n\n                    Promise$1.all(operations).then(function () {\n                        resolve();\n                    })[\"catch\"](function (e) {\n                        reject(e);\n                    });\n                }, function (sqlError) {\n                    reject(sqlError);\n                });\n            });\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar webSQLStorage = {\n    _driver: 'webSQLStorage',\n    _initStorage: _initStorage$1,\n    _support: isWebSQLValid(),\n    iterate: iterate$1,\n    getItem: getItem$1,\n    setItem: setItem$1,\n    removeItem: removeItem$1,\n    clear: clear$1,\n    length: length$1,\n    key: key$1,\n    keys: keys$1,\n    dropInstance: dropInstance$1\n};\n\nfunction isLocalStorageValid() {\n    try {\n        return typeof localStorage !== 'undefined' && 'setItem' in localStorage &&\n        // in IE8 typeof localStorage.setItem === 'object'\n        !!localStorage.setItem;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction _getKeyPrefix(options, defaultConfig) {\n    var keyPrefix = options.name + '/';\n\n    if (options.storeName !== defaultConfig.storeName) {\n        keyPrefix += options.storeName + '/';\n    }\n    return keyPrefix;\n}\n\n// Check if localStorage throws when saving an item\nfunction checkIfLocalStorageThrows() {\n    var localStorageTestKey = '_localforage_support_test';\n\n    try {\n        localStorage.setItem(localStorageTestKey, true);\n        localStorage.removeItem(localStorageTestKey);\n\n        return false;\n    } catch (e) {\n        return true;\n    }\n}\n\n// Check if localStorage is usable and allows to save an item\n// This method checks if localStorage is usable in Safari Private Browsing\n// mode, or in any other case where the available quota for localStorage\n// is 0 and there wasn't any saved items yet.\nfunction _isLocalStorageUsable() {\n    return !checkIfLocalStorageThrows() || localStorage.length > 0;\n}\n\n// Config the localStorage backend, using options set in the config.\nfunction _initStorage$2(options) {\n    var self = this;\n    var dbInfo = {};\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    dbInfo.keyPrefix = _getKeyPrefix(options, self._defaultConfig);\n\n    if (!_isLocalStorageUsable()) {\n        return Promise$1.reject();\n    }\n\n    self._dbInfo = dbInfo;\n    dbInfo.serializer = localforageSerializer;\n\n    return Promise$1.resolve();\n}\n\n// Remove all keys from the datastore, effectively destroying all data in\n// the app's key/value store!\nfunction clear$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var keyPrefix = self._dbInfo.keyPrefix;\n\n        for (var i = localStorage.length - 1; i >= 0; i--) {\n            var key = localStorage.key(i);\n\n            if (key.indexOf(keyPrefix) === 0) {\n                localStorage.removeItem(key);\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Retrieve an item from the store. Unlike the original async_storage\n// library in Gaia, we don't modify return values at all. If a key's value\n// is `undefined`, we pass that value to the callback function.\nfunction getItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result = localStorage.getItem(dbInfo.keyPrefix + key);\n\n        // If a result was found, parse it from the serialized\n        // string into a JS object. If result isn't truthy, the key\n        // is likely undefined and we'll pass it straight to the\n        // callback.\n        if (result) {\n            result = dbInfo.serializer.deserialize(result);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items in the store.\nfunction iterate$2(iterator, callback) {\n    var self = this;\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var keyPrefix = dbInfo.keyPrefix;\n        var keyPrefixLength = keyPrefix.length;\n        var length = localStorage.length;\n\n        // We use a dedicated iterator instead of the `i` variable below\n        // so other keys we fetch in localStorage aren't counted in\n        // the `iterationNumber` argument passed to the `iterate()`\n        // callback.\n        //\n        // See: github.com/mozilla/localForage/pull/435#discussion_r38061530\n        var iterationNumber = 1;\n\n        for (var i = 0; i < length; i++) {\n            var key = localStorage.key(i);\n            if (key.indexOf(keyPrefix) !== 0) {\n                continue;\n            }\n            var value = localStorage.getItem(key);\n\n            // If a result was found, parse it from the serialized\n            // string into a JS object. If result isn't truthy, the\n            // key is likely undefined and we'll pass it straight\n            // to the iterator.\n            if (value) {\n                value = dbInfo.serializer.deserialize(value);\n            }\n\n            value = iterator(value, key.substring(keyPrefixLength), iterationNumber++);\n\n            if (value !== void 0) {\n                return value;\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Same as localStorage's key() method, except takes a callback.\nfunction key$2(n, callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result;\n        try {\n            result = localStorage.key(n);\n        } catch (error) {\n            result = null;\n        }\n\n        // Remove the prefix from the key, if a key is found.\n        if (result) {\n            result = result.substring(dbInfo.keyPrefix.length);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var length = localStorage.length;\n        var keys = [];\n\n        for (var i = 0; i < length; i++) {\n            var itemKey = localStorage.key(i);\n            if (itemKey.indexOf(dbInfo.keyPrefix) === 0) {\n                keys.push(itemKey.substring(dbInfo.keyPrefix.length));\n            }\n        }\n\n        return keys;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Supply the number of keys in the datastore to the callback function.\nfunction length$2(callback) {\n    var self = this;\n    var promise = self.keys().then(function (keys) {\n        return keys.length;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Remove an item from the store, nice and simple.\nfunction removeItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        localStorage.removeItem(dbInfo.keyPrefix + key);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Set a key's value and run an optional callback once the value is set.\n// Unlike Gaia's implementation, the callback function is passed the value,\n// in case you want to operate on that value only after you're sure it\n// saved, or something like that.\nfunction setItem$2(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        // Convert undefined values to null.\n        // https://github.com/mozilla/localForage/pull/42\n        if (value === undefined) {\n            value = null;\n        }\n\n        // Save the original value to pass to the callback.\n        var originalValue = value;\n\n        return new Promise$1(function (resolve, reject) {\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    try {\n                        localStorage.setItem(dbInfo.keyPrefix + key, value);\n                        resolve(originalValue);\n                    } catch (e) {\n                        // localStorage capacity exceeded.\n                        // TODO: Make this a specific error/event.\n                        if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                            reject(e);\n                        }\n                        reject(e);\n                    }\n                }\n            });\n        });\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance$2(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        var currentConfig = this.config();\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            if (!options.storeName) {\n                resolve(options.name + '/');\n            } else {\n                resolve(_getKeyPrefix(options, self._defaultConfig));\n            }\n        }).then(function (keyPrefix) {\n            for (var i = localStorage.length - 1; i >= 0; i--) {\n                var key = localStorage.key(i);\n\n                if (key.indexOf(keyPrefix) === 0) {\n                    localStorage.removeItem(key);\n                }\n            }\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar localStorageWrapper = {\n    _driver: 'localStorageWrapper',\n    _initStorage: _initStorage$2,\n    _support: isLocalStorageValid(),\n    iterate: iterate$2,\n    getItem: getItem$2,\n    setItem: setItem$2,\n    removeItem: removeItem$2,\n    clear: clear$2,\n    length: length$2,\n    key: key$2,\n    keys: keys$2,\n    dropInstance: dropInstance$2\n};\n\nvar sameValue = function sameValue(x, y) {\n    return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);\n};\n\nvar includes = function includes(array, searchElement) {\n    var len = array.length;\n    var i = 0;\n    while (i < len) {\n        if (sameValue(array[i], searchElement)) {\n            return true;\n        }\n        i++;\n    }\n\n    return false;\n};\n\nvar isArray = Array.isArray || function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n};\n\n// Drivers are stored here when `defineDriver()` is called.\n// They are shared across all instances of localForage.\nvar DefinedDrivers = {};\n\nvar DriverSupport = {};\n\nvar DefaultDrivers = {\n    INDEXEDDB: asyncStorage,\n    WEBSQL: webSQLStorage,\n    LOCALSTORAGE: localStorageWrapper\n};\n\nvar DefaultDriverOrder = [DefaultDrivers.INDEXEDDB._driver, DefaultDrivers.WEBSQL._driver, DefaultDrivers.LOCALSTORAGE._driver];\n\nvar OptionalDriverMethods = ['dropInstance'];\n\nvar LibraryMethods = ['clear', 'getItem', 'iterate', 'key', 'keys', 'length', 'removeItem', 'setItem'].concat(OptionalDriverMethods);\n\nvar DefaultConfig = {\n    description: '',\n    driver: DefaultDriverOrder.slice(),\n    name: 'localforage',\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\n    // we can use without a prompt.\n    size: 4980736,\n    storeName: 'keyvaluepairs',\n    version: 1.0\n};\n\nfunction callWhenReady(localForageInstance, libraryMethod) {\n    localForageInstance[libraryMethod] = function () {\n        var _args = arguments;\n        return localForageInstance.ready().then(function () {\n            return localForageInstance[libraryMethod].apply(localForageInstance, _args);\n        });\n    };\n}\n\nfunction extend() {\n    for (var i = 1; i < arguments.length; i++) {\n        var arg = arguments[i];\n\n        if (arg) {\n            for (var _key in arg) {\n                if (arg.hasOwnProperty(_key)) {\n                    if (isArray(arg[_key])) {\n                        arguments[0][_key] = arg[_key].slice();\n                    } else {\n                        arguments[0][_key] = arg[_key];\n                    }\n                }\n            }\n        }\n    }\n\n    return arguments[0];\n}\n\nvar LocalForage = function () {\n    function LocalForage(options) {\n        _classCallCheck(this, LocalForage);\n\n        for (var driverTypeKey in DefaultDrivers) {\n            if (DefaultDrivers.hasOwnProperty(driverTypeKey)) {\n                var driver = DefaultDrivers[driverTypeKey];\n                var driverName = driver._driver;\n                this[driverTypeKey] = driverName;\n\n                if (!DefinedDrivers[driverName]) {\n                    // we don't need to wait for the promise,\n                    // since the default drivers can be defined\n                    // in a blocking manner\n                    this.defineDriver(driver);\n                }\n            }\n        }\n\n        this._defaultConfig = extend({}, DefaultConfig);\n        this._config = extend({}, this._defaultConfig, options);\n        this._driverSet = null;\n        this._initDriver = null;\n        this._ready = false;\n        this._dbInfo = null;\n\n        this._wrapLibraryMethodsWithReady();\n        this.setDriver(this._config.driver)[\"catch\"](function () {});\n    }\n\n    // Set any config values for localForage; can be called anytime before\n    // the first API call (e.g. `getItem`, `setItem`).\n    // We loop through options so we don't overwrite existing config\n    // values.\n\n\n    LocalForage.prototype.config = function config(options) {\n        // If the options argument is an object, we use it to set values.\n        // Otherwise, we return either a specified config value or all\n        // config values.\n        if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n            // If localforage is ready and fully initialized, we can't set\n            // any new configuration values. Instead, we return an error.\n            if (this._ready) {\n                return new Error(\"Can't call config() after localforage \" + 'has been used.');\n            }\n\n            for (var i in options) {\n                if (i === 'storeName') {\n                    options[i] = options[i].replace(/\\W/g, '_');\n                }\n\n                if (i === 'version' && typeof options[i] !== 'number') {\n                    return new Error('Database version must be a number.');\n                }\n\n                this._config[i] = options[i];\n            }\n\n            // after all config options are set and\n            // the driver option is used, try setting it\n            if ('driver' in options && options.driver) {\n                return this.setDriver(this._config.driver);\n            }\n\n            return true;\n        } else if (typeof options === 'string') {\n            return this._config[options];\n        } else {\n            return this._config;\n        }\n    };\n\n    // Used to define a custom driver, shared across all instances of\n    // localForage.\n\n\n    LocalForage.prototype.defineDriver = function defineDriver(driverObject, callback, errorCallback) {\n        var promise = new Promise$1(function (resolve, reject) {\n            try {\n                var driverName = driverObject._driver;\n                var complianceError = new Error('Custom driver not compliant; see ' + 'https://mozilla.github.io/localForage/#definedriver');\n\n                // A driver name should be defined and not overlap with the\n                // library-defined, default drivers.\n                if (!driverObject._driver) {\n                    reject(complianceError);\n                    return;\n                }\n\n                var driverMethods = LibraryMethods.concat('_initStorage');\n                for (var i = 0, len = driverMethods.length; i < len; i++) {\n                    var driverMethodName = driverMethods[i];\n\n                    // when the property is there,\n                    // it should be a method even when optional\n                    var isRequired = !includes(OptionalDriverMethods, driverMethodName);\n                    if ((isRequired || driverObject[driverMethodName]) && typeof driverObject[driverMethodName] !== 'function') {\n                        reject(complianceError);\n                        return;\n                    }\n                }\n\n                var configureMissingMethods = function configureMissingMethods() {\n                    var methodNotImplementedFactory = function methodNotImplementedFactory(methodName) {\n                        return function () {\n                            var error = new Error('Method ' + methodName + ' is not implemented by the current driver');\n                            var promise = Promise$1.reject(error);\n                            executeCallback(promise, arguments[arguments.length - 1]);\n                            return promise;\n                        };\n                    };\n\n                    for (var _i = 0, _len = OptionalDriverMethods.length; _i < _len; _i++) {\n                        var optionalDriverMethod = OptionalDriverMethods[_i];\n                        if (!driverObject[optionalDriverMethod]) {\n                            driverObject[optionalDriverMethod] = methodNotImplementedFactory(optionalDriverMethod);\n                        }\n                    }\n                };\n\n                configureMissingMethods();\n\n                var setDriverSupport = function setDriverSupport(support) {\n                    if (DefinedDrivers[driverName]) {\n                        console.info('Redefining LocalForage driver: ' + driverName);\n                    }\n                    DefinedDrivers[driverName] = driverObject;\n                    DriverSupport[driverName] = support;\n                    // don't use a then, so that we can define\n                    // drivers that have simple _support methods\n                    // in a blocking manner\n                    resolve();\n                };\n\n                if ('_support' in driverObject) {\n                    if (driverObject._support && typeof driverObject._support === 'function') {\n                        driverObject._support().then(setDriverSupport, reject);\n                    } else {\n                        setDriverSupport(!!driverObject._support);\n                    }\n                } else {\n                    setDriverSupport(true);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n\n        executeTwoCallbacks(promise, callback, errorCallback);\n        return promise;\n    };\n\n    LocalForage.prototype.driver = function driver() {\n        return this._driver || null;\n    };\n\n    LocalForage.prototype.getDriver = function getDriver(driverName, callback, errorCallback) {\n        var getDriverPromise = DefinedDrivers[driverName] ? Promise$1.resolve(DefinedDrivers[driverName]) : Promise$1.reject(new Error('Driver not found.'));\n\n        executeTwoCallbacks(getDriverPromise, callback, errorCallback);\n        return getDriverPromise;\n    };\n\n    LocalForage.prototype.getSerializer = function getSerializer(callback) {\n        var serializerPromise = Promise$1.resolve(localforageSerializer);\n        executeTwoCallbacks(serializerPromise, callback);\n        return serializerPromise;\n    };\n\n    LocalForage.prototype.ready = function ready(callback) {\n        var self = this;\n\n        var promise = self._driverSet.then(function () {\n            if (self._ready === null) {\n                self._ready = self._initDriver();\n            }\n\n            return self._ready;\n        });\n\n        executeTwoCallbacks(promise, callback, callback);\n        return promise;\n    };\n\n    LocalForage.prototype.setDriver = function setDriver(drivers, callback, errorCallback) {\n        var self = this;\n\n        if (!isArray(drivers)) {\n            drivers = [drivers];\n        }\n\n        var supportedDrivers = this._getSupportedDrivers(drivers);\n\n        function setDriverToConfig() {\n            self._config.driver = self.driver();\n        }\n\n        function extendSelfWithDriver(driver) {\n            self._extend(driver);\n            setDriverToConfig();\n\n            self._ready = self._initStorage(self._config);\n            return self._ready;\n        }\n\n        function initDriver(supportedDrivers) {\n            return function () {\n                var currentDriverIndex = 0;\n\n                function driverPromiseLoop() {\n                    while (currentDriverIndex < supportedDrivers.length) {\n                        var driverName = supportedDrivers[currentDriverIndex];\n                        currentDriverIndex++;\n\n                        self._dbInfo = null;\n                        self._ready = null;\n\n                        return self.getDriver(driverName).then(extendSelfWithDriver)[\"catch\"](driverPromiseLoop);\n                    }\n\n                    setDriverToConfig();\n                    var error = new Error('No available storage method found.');\n                    self._driverSet = Promise$1.reject(error);\n                    return self._driverSet;\n                }\n\n                return driverPromiseLoop();\n            };\n        }\n\n        // There might be a driver initialization in progress\n        // so wait for it to finish in order to avoid a possible\n        // race condition to set _dbInfo\n        var oldDriverSetDone = this._driverSet !== null ? this._driverSet[\"catch\"](function () {\n            return Promise$1.resolve();\n        }) : Promise$1.resolve();\n\n        this._driverSet = oldDriverSetDone.then(function () {\n            var driverName = supportedDrivers[0];\n            self._dbInfo = null;\n            self._ready = null;\n\n            return self.getDriver(driverName).then(function (driver) {\n                self._driver = driver._driver;\n                setDriverToConfig();\n                self._wrapLibraryMethodsWithReady();\n                self._initDriver = initDriver(supportedDrivers);\n            });\n        })[\"catch\"](function () {\n            setDriverToConfig();\n            var error = new Error('No available storage method found.');\n            self._driverSet = Promise$1.reject(error);\n            return self._driverSet;\n        });\n\n        executeTwoCallbacks(this._driverSet, callback, errorCallback);\n        return this._driverSet;\n    };\n\n    LocalForage.prototype.supports = function supports(driverName) {\n        return !!DriverSupport[driverName];\n    };\n\n    LocalForage.prototype._extend = function _extend(libraryMethodsAndProperties) {\n        extend(this, libraryMethodsAndProperties);\n    };\n\n    LocalForage.prototype._getSupportedDrivers = function _getSupportedDrivers(drivers) {\n        var supportedDrivers = [];\n        for (var i = 0, len = drivers.length; i < len; i++) {\n            var driverName = drivers[i];\n            if (this.supports(driverName)) {\n                supportedDrivers.push(driverName);\n            }\n        }\n        return supportedDrivers;\n    };\n\n    LocalForage.prototype._wrapLibraryMethodsWithReady = function _wrapLibraryMethodsWithReady() {\n        // Add a stub for each driver API method that delays the call to the\n        // corresponding driver method until localForage is ready. These stubs\n        // will be replaced by the driver methods as soon as the driver is\n        // loaded, so there is no performance impact.\n        for (var i = 0, len = LibraryMethods.length; i < len; i++) {\n            callWhenReady(this, LibraryMethods[i]);\n        }\n    };\n\n    LocalForage.prototype.createInstance = function createInstance(options) {\n        return new LocalForage(options);\n    };\n\n    return LocalForage;\n}();\n\n// The actual localForage object that we expose as a module or via a\n// global. It's extended by pulling in one of our other libraries.\n\n\nvar localforage_js = new LocalForage();\n\nmodule.exports = localforage_js;\n\n},{\"3\":3}]},{},[4])(4)\n});\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nmodule.exports = apply;\n","var baseTimes = require('./_baseTimes'),\n    isArguments = require('./isArguments'),\n    isArray = require('./isArray'),\n    isBuffer = require('./isBuffer'),\n    isIndex = require('./_isIndex'),\n    isTypedArray = require('./isTypedArray');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = arrayLikeKeys;\n","var baseAssignValue = require('./_baseAssignValue'),\n    eq = require('./eq');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nmodule.exports = assignValue;\n","var defineProperty = require('./_defineProperty');\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nmodule.exports = baseAssignValue;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nmodule.exports = baseIsArguments;\n","var isFunction = require('./isFunction'),\n    isMasked = require('./_isMasked'),\n    isObject = require('./isObject'),\n    toSource = require('./_toSource');\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nmodule.exports = baseIsNative;\n","var baseGetTag = require('./_baseGetTag'),\n    isLength = require('./isLength'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nmodule.exports = baseIsTypedArray;\n","var isPrototype = require('./_isPrototype'),\n    nativeKeys = require('./_nativeKeys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseKeys;\n","var identity = require('./identity'),\n    overRest = require('./_overRest'),\n    setToString = require('./_setToString');\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nmodule.exports = baseRest;\n","var constant = require('./constant'),\n    defineProperty = require('./_defineProperty'),\n    identity = require('./identity');\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nmodule.exports = baseSetToString;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nmodule.exports = baseTimes;\n","var trimmedEndIndex = require('./_trimmedEndIndex');\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nmodule.exports = baseTrim;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nmodule.exports = baseUnary;\n","var assignValue = require('./_assignValue'),\n    baseAssignValue = require('./_baseAssignValue');\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nmodule.exports = copyObject;\n","var root = require('./_root');\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nmodule.exports = coreJsData;\n","var baseRest = require('./_baseRest'),\n    isIterateeCall = require('./_isIterateeCall');\n\n/**\n * Creates a function like `_.assign`.\n *\n * @private\n * @param {Function} assigner The function to assign values.\n * @returns {Function} Returns the new assigner function.\n */\nfunction createAssigner(assigner) {\n  return baseRest(function(object, sources) {\n    var index = -1,\n        length = sources.length,\n        customizer = length > 1 ? sources[length - 1] : undefined,\n        guard = length > 2 ? sources[2] : undefined;\n\n    customizer = (assigner.length > 3 && typeof customizer == 'function')\n      ? (length--, customizer)\n      : undefined;\n\n    if (guard && isIterateeCall(sources[0], sources[1], guard)) {\n      customizer = length < 3 ? undefined : customizer;\n      length = 1;\n    }\n    object = Object(object);\n    while (++index < length) {\n      var source = sources[index];\n      if (source) {\n        assigner(object, source, index, customizer);\n      }\n    }\n    return object;\n  });\n}\n\nmodule.exports = createAssigner;\n","var getNative = require('./_getNative');\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nmodule.exports = defineProperty;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var baseIsNative = require('./_baseIsNative'),\n    getValue = require('./_getValue');\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nmodule.exports = getNative;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nmodule.exports = getValue;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nmodule.exports = isIndex;\n","var eq = require('./eq'),\n    isArrayLike = require('./isArrayLike'),\n    isIndex = require('./_isIndex'),\n    isObject = require('./isObject');\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nmodule.exports = isIterateeCall;\n","var coreJsData = require('./_coreJsData');\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nmodule.exports = isMasked;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nmodule.exports = isPrototype;\n","var overArg = require('./_overArg');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nmodule.exports = nativeKeys;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nmodule.exports = nodeUtil;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nmodule.exports = overArg;\n","var apply = require('./_apply');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nmodule.exports = overRest;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var baseSetToString = require('./_baseSetToString'),\n    shortOut = require('./_shortOut');\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nmodule.exports = setToString;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nmodule.exports = shortOut;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nmodule.exports = toSource;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nmodule.exports = trimmedEndIndex;\n","var assignValue = require('./_assignValue'),\n    copyObject = require('./_copyObject'),\n    createAssigner = require('./_createAssigner'),\n    isArrayLike = require('./isArrayLike'),\n    isPrototype = require('./_isPrototype'),\n    keys = require('./keys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns own enumerable string keyed properties of source objects to the\n * destination object. Source objects are applied from left to right.\n * Subsequent sources overwrite property assignments of previous sources.\n *\n * **Note:** This method mutates `object` and is loosely based on\n * [`Object.assign`](https://mdn.io/Object/assign).\n *\n * @static\n * @memberOf _\n * @since 0.10.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @see _.assignIn\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * function Bar() {\n *   this.c = 3;\n * }\n *\n * Foo.prototype.b = 2;\n * Bar.prototype.d = 4;\n *\n * _.assign({ 'a': 0 }, new Foo, new Bar);\n * // => { 'a': 1, 'c': 3 }\n */\nvar assign = createAssigner(function(object, source) {\n  if (isPrototype(source) || isArrayLike(source)) {\n    copyObject(source, keys(source), object);\n    return;\n  }\n  for (var key in source) {\n    if (hasOwnProperty.call(source, key)) {\n      assignValue(object, key, source[key]);\n    }\n  }\n});\n\nmodule.exports = assign;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nmodule.exports = constant;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nmodule.exports = eq;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nmodule.exports = identity;\n","var baseIsArguments = require('./_baseIsArguments'),\n    isObjectLike = require('./isObjectLike');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nmodule.exports = isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nmodule.exports = isArray;\n","var isFunction = require('./isFunction'),\n    isLength = require('./isLength');\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nmodule.exports = isArrayLike;\n","var root = require('./_root'),\n    stubFalse = require('./stubFalse');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nmodule.exports = isBuffer;\n","var baseGetTag = require('./_baseGetTag'),\n    isObject = require('./isObject');\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nmodule.exports = isFunction;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nmodule.exports = isLength;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var baseIsTypedArray = require('./_baseIsTypedArray'),\n    baseUnary = require('./_baseUnary'),\n    nodeUtil = require('./_nodeUtil');\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nmodule.exports = isTypedArray;\n","var arrayLikeKeys = require('./_arrayLikeKeys'),\n    baseKeys = require('./_baseKeys'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nmodule.exports = keys;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = stubFalse;\n","var debounce = require('./debounce'),\n    isObject = require('./isObject');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nmodule.exports = throttle;\n","var baseTrim = require('./_baseTrim'),\n    isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","'use strict';\n\nif (!process) {\n  var process = {\n    \"cwd\" : function () { return '/' }\n  };\n}\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","module.exports = __WEBPACK_EXTERNAL_MODULE__3787__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","\n// import {version} from '../package.json';\n// export {version};\n\n// // control\n// export * from './control/index';\n\n// // core\n// export * from './core/index';\n\n// // dom\n// export * from './dom/index';\n\n// // reader\n// import {reader} from './reader/index';\n// export * from './reader/index';\n\n// misc\n\nvar oldCozy = window.cozy;\nexport function noConflict() {\n  window.cozy = oldCozy;\n  return this;\n}\n\n\n\nvar cozy = {};\n// cozy.reader = reader;\n\nimport {version} from '../package.json';\nvar control = require('./control/index');\nvar core = require('./core/index');\nvar dom = require('./dom/index');\nvar reader = require('./reader/index');\n\n[ control, core, dom, reader ].forEach((m) => {\n  Object.keys(m).forEach((key) => {\n    cozy[key] = m[key];\n  })\n})\n\nexport default cozy;"],"names":["Class","Reader","Util","DomUtil","Control","extend","options","initialize","setOptions","container","_container","_locked","_id","Date","getTime","parseInt","Math","random","getRegion","region","setRegion","reader","_reader","removeControl","addControl","getContainer","addTo","remove","onAdd","addClass","area","getControlRegion","appendChild","onRemove","_refocusOnMap","e","screenX","screenY","focus","_className","widget","className","direction","push","join","control","include","getControlContainer","l","_controlContainer","create","target","_panes","parts","split","tmp","parent","x","length","slug","shift","panel","getControlRegion_1","slot","pop","div","childElement","firstChild","insertBefore","_classify","i","_clearControlRegion","_controlRegions","DomEvent","PageControl","_control","querySelector","_createButton","_fill","html","label","_bindEvents","title","link","innerHTML","href","setAttribute","self","disableClickPropagation","on","stop","_action","data","_unit","flow","s","unit","replace","_label","EOT","PagePrevious","prev","PageNext","next","PageFirst","first","PageLast","last","pageNext","pagePrevious","pageFirst","pageLast","assign","activeModal","dismissModalListener","FOCUSABLE_ELEMENTS","ACTIONABLE_ELEMENTS","Modal","fraction","width","actions","callbacks","onShow","onClose","handlers","_initializedEvents","template","panelHTML","main","action","button_cls","body","DOMParser","parseFromString","modal","children","onClick","bind","onKeydown","onModalTransition","addEventListener","button_id","button","event","preventDefault","callback","close","closeModal","deactivate","removeEventListeners","activeElement","showModal","document","_resize","setFocusToFirstNode","addEventListeners","activate","setTimeout","removeClass","forEach","removeEventListener","style","height","offsetHeight","offsetWidth","header","footer","clientHeight","getFocusableNodes","nodes","querySelectorAll","Object","keys","map","key","focusableNodes","getActionableNodes","keyCode","maintainFocus","closeAfterAction","hasAttribute","fire","actionableNodes","indexOf","parentElement","click","did_match","selector","matches","getAttribute","handler","focusedItemIndex","shiftKey","update","titleEl","innerText","popup","_popupModal","iframe","modalDiv","removeChild","createElement","onLoad","contentDocument","srcdoc","open","write","Contents","defaultTemplate","position","_goto_interval","tracking","_modal","trim","rendition","manager","_display","contentlist","pagelist","_toolbar","_pageListError","dataset","toggle","current","classList","display","add","updateLiveStatus","form","parentNode","input","value","pageList","page","find","p","pageLabel","cfiFromPage","p1","firstPageLabel","p2","lastPageLabel","_setupSkipLink","_process","items","tabindex","item","option","_createOption","subitems","toc","pages","pg","info","cfi","locations","chapter","pad","toString","anchor","textContent","span","tagName","skipLink","ul","stopPropagation","contents","Title","h1","setOpacity","_title","_divider","_section","bookTitle","fn","PublicationMetadata","_publisher","_rights","publisher","rights","publicationMetadata","Preferences","hasThemes","updatePreferences","initializeForm","_createPanel","possible_fieldsets","metadata","layout","rootfiles","themes","_fieldsets","cls","fieldset","fields","hasFields","field","id","j","inputs","checked","name","hint","_form","doUpdate","new_options","saveable_options","updateForm","saveOptions","reopen","Fieldset","_current","TextSize","_input","_output","_preview","_actionReset","_updatePreview","text_size","saveable","fontSize","Display","scrolled_help","Theme","theme","klass","Rendition","rootfilePath","expr","rootfile","accessMode","Scale","scale","transform","preferences","Widget","_onAddExtra","_updateTemplate","_updateClass","hasOwnProperty","node","Button","Panel","Toggle","state","states","stateName","_resetState","_state","filter","Citation","designMode","formatted","range","createRange","selectNode","sel","window","getSelection","removeAllRanges","addRange","flag","execCommand","err","console","log","_message","detach","citations","citation","index","format","text","createTextNode","_formatted","_initializeForm","_formatCitation","selected","Search","_data","_canceled","_processing","_addLocation","_article","getElementsByTagName","searchString","openModalResults","openModalWaiting","submitQuery","evt","cmd","ctrlKey","altKey","metaKey","_emptyArticle","loaderTemplate","_buildResults","url","searchUrl","encodeURIComponent","request","XMLHttpRequest","onload","status","JSON","parse","response","onerror","send","hasChildNodes","lastChild","content","no_results","feedback","results_list","feedback_link","press_subdomain","noid","location","feedback_text","annotations","reset","highlight","highlight_off","search_results","result","cfiRange","snippet","loc","locationFromCfi","locText","match","slice","locElement","search","BibliographicInformation","dl","metadata_fields","metadata_fields_seen","idx","_formatDate","dt","dd","bibliographicInformation","Download","_configureDownloadForm","submit","download_links","size","download","Navigator","_setup","_initializeNavigator","_createControl","_background","_status","_spanCurrentPercentage","_spanCurrentLocation","_spanTotalLocations","_spanCurrentPageLabel","isIE","navigator","userAgent","_keyDown","_update","_mouseDown","cfiFromLocation","percent","_total","cfiFromPercentage","_watching","gotoPage","parseFloat","current_location","max","percentage","fill","end","_end","background","ceil","current_page","pageFromCfi","pagesFromLocation","pageLabels","_initiated","getComputedStyle","getPropertyValue","total","min","spine","currentLocation","_parseLocation","_last_value","_handle_relocated","start","_last_location_start","_last_location_end","message","handle_possible_pdf_location","reload","start_cfi","percentageFromCfi","Fullscreen","_fullscreenchangeHandler","isFullscreen","fullscreenElement","requestFullscreen","exitFullscreen","glyph","fullscreen","documentElement","ie","ielt9","edge","webkit","userAgentContains","android","android23","opera","chrome","gecko","safari","phantom","opera12","win","platform","ie3d","webkit3d","WebKitCSSMatrix","gecko3d","any3d","L_DISABLE_3D","mobile","orientation","mobileWebkit","mobileWebkit3d","msPointer","PointerEvent","MSPointerEvent","pointer","touch","L_NO_TOUCH","DocumentTouch","mobileOpera","mobileGecko","retina","devicePixelRatio","screen","deviceXDPI","logicalXDPI","canvas","getContext","svg","vml","shape","behavior","adj","columnCount","undefined","str","toLowerCase","props","NewClass","apply","arguments","callInitHooks","parentProto","__super__","prototype","proto","constructor","statics","includes","checkDeprecatedMixinEvents","concat","_initHooks","_initHooksCalled","call","len","mergeOptions","addInitHook","args","Array","init","cozy","Mixin","isArray","Evented","types","context","type","_on","splitWords","off","_events","_off","typeListeners","newListener","ctx","listeners","falseFn","_firingCount","splice","propagate","listens","_propagateEvent","_eventParents","once","addEventParent","obj","stamp","removeEventParent","layer","clearAllEventListeners","addOneTimeEventListener","fireEvent","hasEventListeners","dest","src","F","lastId","_cozy_id","throttle","time","lock","wrapperFn","later","wrapNum","includeMax","d","formatNum","num","digits","pow","round","isNumeric","isNaN","isFinite","getParamString","existingUrl","uppercase","params","toUpperCase","templateRe","Error","array","el","emptyImageUrl","getPrefixed","lastTime","timeoutDefer","timeToCall","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","clearTimeout","requestAnimFrame","immediate","cancelAnimFrame","inVp","elem","threshold","HTMLElement","top","right","bottom","left","vp","clientWidth","box","getBoundingClientRect","cutOff","partial","isFullyVisible","isPartiallyVisible","elH","H","edges","fully","partially","loader","js","_resolved","error","then","cb","resolve","reject","_argv","retval","trace","element","async","attr","Bus","instance","bus","Browser","Events","POINTER_DOWN","POINTER_MOVE","POINTER_UP","POINTER_CANCEL","TAG_WHITE_LIST","_pointers","_pointerDocListener","_pointersCount","addPointerListener","_addPointerStart","_addPointerMove","_addPointerEnd","removePointerListener","onDown","pointerType","MSPOINTER_TYPE_MOUSE","_handlePointer","_globalPointerDown","_globalPointerMove","_globalPointerUp","pointerId","touches","changedTouches","onMove","buttons","onUp","_touchstart","_touchend","_pre","addDoubleTapListener","doubleTap","delay","onTouchStart","count","now","delta","onTouchEnd","cancelBubble","newTouch","prop","removeDoubleTapListener","touchstart","touchend","dblclick","Point","addOne","eventsKey","removeOne","originalHandler","isExternalTarget","filterClick","attachEvent","detachEvent","originalEvent","_stopped","skipped","disableScrollPropagation","fakeStop","returnValue","getMousePosition","clientX","clientY","rect","clientLeft","clientTop","wheelPxFactor","getWheelDelta","wheelDeltaY","deltaY","deltaMode","deltaX","deltaZ","wheelDelta","detail","abs","skipEvents","events","related","relatedTarget","lastClick","timeStamp","elapsed","_simulatedClick","_simulated","addListener","removeListener","Element","ep","webkitMatchesSelector","msMatchesSelector","mozMatchesSelector","TRANSFORM","testProp","TRANSITION","TRANSITION_END","get","getElementById","getStyle","currentStyle","defaultView","css","empty","toFront","toBack","hasClass","contains","getClass","RegExp","test","classes","setClass","baseVal","opacity","_setOpacityIE","filterName","filters","Enabled","Opacity","isPropertySupported","setTransform","offset","pos","y","setPosition","point","_leaflet_pos","getPosition","disableTextSelection","enableTextSelection","_userSelect","userSelectProperty","disableImageDrag","enableImageDrag","_outlineElement","_outlineStyle","preventOutline","tabIndex","restoreOutline","outline","clone","_add","toPoint","subtract","_subtract","divideBy","_divideBy","multiplyBy","_multiplyBy","scaleBy","unscaleBy","_round","floor","_floor","_ceil","distanceTo","sqrt","equals","keyboardAllowed","val","fnMap","ret","eventNameMap","change","fullscreenchange","fullscreenerror","screenfull","ALLOW_KEYBOARD_INPUT","exit","onchange","eventName","raw","defineProperties","Boolean","enumerable","enabled","fullscreenEnabled","debounce","_padding","regions","engine","trackResize","mobileMediaQuery","forceScrolledDocHeight","flowOptions","injectStylesheet","_original_document_title","localStorage","getItem","_cozyOptions","_checkFeatureCompatibility","_initContainer","_initLayout","rules","rule","new_rule","_updateTheme","_initEvents","_mode","mode","_start","saved_options","setItem","stringify","draw","goBack","history","back","goForward","forward","_preResize","_onScroll","_containerId","_fadeAnimated","fadeAnimation","_initPanes","panes","prefix","_initBookLoader","_checkIfLoaded","_loaded","_targets","_last_scrollTop","v","peek","pageview","do_report","settings","scrollTop","_rendition","onOff","transform3DLimit","_onMoveEnd","tmp_href","substr","pushState","replaceState","isTrusted","__last_state_cfi","keyName","check","localName","IGNORE_TARGETS","_scroll","scrollLeft","_handleDOMEvent","srcElement","_fireDOMEvent","targets","synth","_findEventTargets","isMarker","containerPoint","latLngToContainerPoint","getLatLng","mouseEventToContainerPoint","layerPoint","containerPointToLayerPoint","latlng","layerPointToLatLng","nonBubblingEvents","getFixedBookPanelSize","h","paddingTop","paddingBottom","w","paddingRight","paddingLeft","invalidateSize","_drawn","_resizeRequest","_resizeBookPane","_setupHooks","_checkMobileDevice","_isMobile","matchMedia","_enableBookLoader","_clearBookLoaderTimeout","_force_progress","_loader_timeout","_disableBookLoader","force","loader_template","_last_message","_last_timer","clearDelay","defineProperty","_metadata","set","createReader","PrefabViews","_views","hidden","view","section","sort","a","b","reused","unshift","destroy","displayed","show","hide","defer","DefaultViewManager","ContinuousViewManager","EVENTS","PrePaginatedContinuousViewManager","_manifest","_spine","render","views","resizeTimeout","resize","_redrawViews","section_","sizeToViewport","viewSettings","getPrototypeOf","columnWidth","View","promises","q","clear","faking","emit","_buildManifest","viewports","viewport","enqueue","load","meta","viewport_width","viewport_height","prev_","next_","_max_height","_max_viewport_height","_max_width","_max_viewport_width","debugManager","backgroundImage","colorR","colorG","colorB","backgroundColor","scrollIntoView","waiting","has_section","promise","_full","full","_checkStillLoading","distX","distY","offsetX","offsetY","isPaginated","scrollBy","MANAGERS","RESIZE","onDisplayed","createView","append","VIEWS","RESIZED","bounds","expanded","AXIS","axis","updateAxis","afterDisplayed","onResize","afterResized","counter","prepend","heightDelta","widthDelta","_offset","horizontal","dir","visibleLength","contentLength","scrollWidth","scrollHeight","divs","visible","marker","offsetTop","all","viewsLength","isVisible","updating","queued","trimTimeout","Promise","_offsetLeft","_offsetTop","checking","newViews","_bounds","rtl","prePaginated","adjusted_top","adjusted_end","__check_visible","task","firstIndex","lastIndex","above","below","erase","prevTop","prevLeft","scrollY","scrollX","scrollTo","stage","ignore","addScrollListeners","scroller","tick","prevScrollTop","prevScrollLeft","scrollDeltaVert","scrollDeltaHorz","onScroll","_scrolled","scrolled","didScroll","scrollTimeout","recenter","SCROLLED","SCROLL","afterScrolled","spread","forceUpdate","mapping","infinite","wrapper","w3","r","f","m","IframeView","borders","uuid","isNumber","createBlobUrl","revokeBlobUrl","ReusableIframeView","overflow","flex","createContainer","_layout_height","scrolling","seamless","border","resizing","visibility","_width","_height","added","elementBounds","supportsSrcdoc","method","EventEmitter","Views","preloading","observer","IntersectionObserver","handleObserver","root","containr","rootMargin","observe","entries","entry","isIntersecting","intersectionRatio","onEnter","onExit","unobserve","disconnect","viewportState","preload","preloaded","unload","windowBounds","Mapping","Queue","Stage","ScrollingContinuousViewManager","optsSettings","renditionQueue","queue","ignoreClass","fullsize","minHeight","prehooks","forceEvenPages","rendered","xscale","tag","attachTo","_stageSize","ar","onResized","onOrientationChange","updateLayout","gotoTarget","_forceLocationEvent","displaying","initializeViews","_target","locationOf","moveTo","ADDED","reframeElement","afterDisplayedAfterRAF","each","calcuateWidth","maxHeight","stageSize","winBounds","orientationTimeout","viewContents","silent","calculate","calculateHeight","setLayout","reframe","pageHeight","innerHeight","used","sections","startPos","endPos","totalPages","currPage","endPage","cfiBase","StickyIframeView","checkMinHeight","styles","prevBounds","pane","mark","marks","placeMark","new_height","borderTopWidth","borderBottomWidth","current_height","afterResizeCounter","unloaded","DISPLAYED","contentWindow","rendering","canonical","CONTENTS","EXPAND","expand","highlights","unhighlight","underlines","ununderline","unmark","blobUrl","removeListeners","stopExpanding","Url","BaseUpdater","TableUpdater","force_table_modal_to","table","bgcolor","tableHTML","outerHTML","tableId","ts","_originalHTML","regex","index0","newHTML","base","links","absolute","linkUrl","Path","path","hash","EnhancedFigureUpdater","resourceType","replaceWith","iframe_href","iframe_title","handlePopups","updaters","selectors","updater","elements","_initialized","addStylesheetRules","cursor","color","margin","padding","initialized","stylesheet","INTERACTIVE","installedResizeHandler","isInteractive","nodeName","hideEverythingInContents","nodeType","Node","ELEMENT_NODE","hideEverythingVisible","findMatchingContents","showEverythingVisible","selfOrElement","TEXT_NODE","showNode","x2","child","showNodeAndSelf","ownerDocument","ancestor","commonAncestorContainer","startContainer","endContainer","_iterator","createNodeIterator","NodeFilter","SHOW_ALL","acceptNode","FILTER_ACCEPT","_nodes","nextNode","referenceNode","updateFocus","disableFocusHandling","_last_location_start_cfi","_last_location_end_cfi","__updateFocus","elemsWithBoundingRects","_boundingClientRect","clearClientRects","getContents","containerX","containerX2","_showThisNode","hasSeenVisibleChild","startRange","ePub","CFI","toRange","startNode","checkNode","doProcess","__target","possible","disableFocusTarget","correct_drift","_checkLayout","_manager","mod","xyz","setupFocusRules","debugFocusHandling","__watchInterval","_watchLayout","clearInterval","setInterval","Hook","EpubJS","_epubjs_ready","xpath","sessionStorage","book_href","book_options","packagePath","useArchive","openAs","_book","removeItem","loaded","navigation","_contents","packaging","ready","parseRootfiles","_locations","t","generateFromPageList","generate","containerDoc","draft","hooks","no_continuous_scroll_isbns","identifier","_drawRendition","head","_updateFontSize","original_target","decodeURIComponent","status_index","register","_initializeReaderStyles","_queueTimeout","rootFilePath","newScrollTop","_navigate","guessed","path1","directory","navPath","path2","dirname","navigating","changed","_updateScale","_selectTheme","_cached_location","add_max_img_styles","custom_stylesheet_rules","buffer","inner","relocated_handler","_fired","locationChanged_handler","book","_updateFrameTitle","refresh","select","_overrides","_queueScale","subtitle","previousSection","previous","_annotations","decodeURI","_annotationsBySectionIndex","hook","Mock","creator","pubdate","__currentIndex","engines","epubjs","mock","COZY_EPUB_ENGINE","engine_href","COZY_EPUB_ENGINE_HREF","_this","_arguments","oldCozy","noConflict","version","require","core","dom"],"sourceRoot":""}