<<<<<<< HEAD
{"version":3,"file":"cozy-sun-bear.js","sources":["../node_modules/url-polyfill/url-polyfill.js","../node_modules/classlist-polyfill/src/index.js","../src/core/Util.js","../src/core/Class.js","../src/core/Events.js","../src/core/Browser.js","../src/geometry/Point.js","../src/dom/DomEvent.Pointer.js","../src/dom/DomEvent.DoubleTap.js","../src/dom/DomEvent.js","../src/dom/DomUtil.js","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isFunction.js","../node_modules/lodash/_coreJsData.js","../node_modules/lodash/_isMasked.js","../node_modules/lodash/_toSource.js","../node_modules/lodash/_baseIsNative.js","../node_modules/lodash/_getValue.js","../node_modules/lodash/_getNative.js","../node_modules/lodash/_defineProperty.js","../node_modules/lodash/_baseAssignValue.js","../node_modules/lodash/eq.js","../node_modules/lodash/_assignValue.js","../node_modules/lodash/_copyObject.js","../node_modules/lodash/identity.js","../node_modules/lodash/_apply.js","../node_modules/lodash/_overRest.js","../node_modules/lodash/constant.js","../node_modules/lodash/_baseSetToString.js","../node_modules/lodash/_shortOut.js","../node_modules/lodash/_setToString.js","../node_modules/lodash/_baseRest.js","../node_modules/lodash/isLength.js","../node_modules/lodash/isArrayLike.js","../node_modules/lodash/_isIndex.js","../node_modules/lodash/_isIterateeCall.js","../node_modules/lodash/_createAssigner.js","../node_modules/lodash/_isPrototype.js","../node_modules/lodash/_baseTimes.js","../node_modules/lodash/_baseIsArguments.js","../node_modules/lodash/isArguments.js","../node_modules/lodash/isArray.js","../node_modules/lodash/stubFalse.js","../node_modules/lodash/isBuffer.js","../node_modules/lodash/_baseIsTypedArray.js","../node_modules/lodash/_baseUnary.js","../node_modules/lodash/_nodeUtil.js","../node_modules/lodash/isTypedArray.js","../node_modules/lodash/_arrayLikeKeys.js","../node_modules/lodash/_overArg.js","../node_modules/lodash/_nativeKeys.js","../node_modules/lodash/_baseKeys.js","../node_modules/lodash/keys.js","../node_modules/lodash/assign.js","../src/screenfull.js","../src/reader/Reader.js","../src/control/Control.js","../src/control/Control.Paging.js","../src/control/Modal.js","../src/control/Control.Contents.js","../src/control/Control.Title.js","../src/control/Control.PublicationMetadata.js","../src/control/Control.Preferences.js","../src/control/Control.Widget.js","../src/control/Control.Citation.js","../src/control/Control.Search.js","../src/control/Control.BibliographicInformation.js","../src/control/Control.Download.js","../src/control/Control.Navigator.js","../src/control/index.js","../src/core/Bus.js","../src/core/index.js","../src/epubjs.js","../node_modules/path-webpack/path.js","../src/reader/Reader.EpubJS.js","../src/reader/Reader.Mock.js","../src/reader/index.js"],"sourcesContent":["(function(global) {\r\n  /**\r\n   * Polyfill URLSearchParams\r\n   *\r\n   * Inspired from : https://github.com/WebReflection/url-search-params/blob/master/src/url-search-params.js\r\n   */\r\n\r\n  var checkIfIteratorIsSupported = function() {\r\n    try {\r\n      return !!Symbol.iterator;\r\n    } catch(error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  var iteratorSupported = checkIfIteratorIsSupported();\r\n\r\n  var createIterator = function(items) {\r\n    var iterator = {\r\n      next: function() {\r\n        var value = items.shift();\r\n        return { done: value === void 0, value: value };\r\n      }\r\n    };\r\n\r\n    if(iteratorSupported) {\r\n      iterator[Symbol.iterator] = function() {\r\n        return iterator;\r\n      };\r\n    }\r\n\r\n    return iterator;\r\n  };\r\n\r\n  /**\r\n   * Search param name and values should be encoded according to https://url.spec.whatwg.org/#urlencoded-serializing\r\n   * encodeURIComponent() produces the same result except encoding spaces as `%20` instead of `+`.\r\n   */\r\n  var serializeParam = function(value) {\r\n    return encodeURIComponent(value).replace(/%20/g, '+');\r\n  };\r\n\r\n  var deserializeParam = function(value) {\r\n    return decodeURIComponent(value).replace(/\\+/g, ' ');\r\n  };\r\n\r\n  var polyfillURLSearchParams= function() {\r\n\r\n    var URLSearchParams = function(searchString) {\r\n      Object.defineProperty(this, '_entries', { value: {} });\r\n\r\n      if(typeof searchString === 'string') {\r\n        if(searchString !== '') {\r\n          searchString = searchString.replace(/^\\?/, '');\r\n          var attributes = searchString.split('&');\r\n          var attribute;\r\n          for(var i = 0; i < attributes.length; i++) {\r\n            attribute = attributes[i].split('=');\r\n            this.append(\r\n              deserializeParam(attribute[0]),\r\n              (attribute.length > 1) ? deserializeParam(attribute[1]) : ''\r\n            );\r\n          }\r\n        }\r\n      } else if(searchString instanceof URLSearchParams) {\r\n        var _this = this;\r\n        searchString.forEach(function(value, name) {\r\n          _this.append(value, name);\r\n        });\r\n      }\r\n    };\r\n\r\n    var proto = URLSearchParams.prototype;\r\n\r\n    proto.append = function(name, value) {\r\n      if(name in this._entries) {\r\n        this._entries[name].push(value.toString());\r\n      } else {\r\n        this._entries[name] = [value.toString()];\r\n      }\r\n    };\r\n\r\n    proto.delete = function(name) {\r\n      delete this._entries[name];\r\n    };\r\n\r\n    proto.get = function(name) {\r\n      return (name in this._entries) ? this._entries[name][0] : null;\r\n    };\r\n\r\n    proto.getAll = function(name) {\r\n      return (name in this._entries) ? this._entries[name].slice(0) : [];\r\n    };\r\n\r\n    proto.has = function(name) {\r\n      return (name in this._entries);\r\n    };\r\n\r\n    proto.set = function(name, value) {\r\n      this._entries[name] = [value.toString()];\r\n    };\r\n\r\n    proto.forEach = function(callback, thisArg) {\r\n      var entries;\r\n      for(var name in this._entries) {\r\n        if(this._entries.hasOwnProperty(name)) {\r\n          entries = this._entries[name];\r\n          for(var i = 0; i < entries.length; i++) {\r\n            callback.call(thisArg, entries[i], name, this);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    proto.keys = function() {\r\n      var items = [];\r\n      this.forEach(function(value, name) { items.push(name); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    proto.values = function() {\r\n      var items = [];\r\n      this.forEach(function(value) { items.push(value); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    proto.entries = function() {\r\n      var items = [];\r\n      this.forEach(function(value, name) { items.push([name, value]); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    if(iteratorSupported) {\r\n      proto[Symbol.iterator] = proto.entries;\r\n    }\r\n\r\n    proto.toString = function() {\r\n      var searchString = '';\r\n      this.forEach(function(value, name) {\r\n        if(searchString.length > 0) searchString+= '&';\r\n        searchString += serializeParam(name) + '=' + serializeParam(value);\r\n      });\r\n      return searchString;\r\n    };\r\n\r\n    global.URLSearchParams = URLSearchParams;\r\n  };\r\n\r\n  if(!('URLSearchParams' in global) || (new URLSearchParams('?a=1').toString() !== 'a=1')) {\r\n    polyfillURLSearchParams();\r\n  }\r\n\r\n  // HTMLAnchorElement\r\n\r\n})(\r\n  (typeof global !== 'undefined') ? global\r\n    : ((typeof window !== 'undefined') ? window\r\n    : ((typeof self !== 'undefined') ? self : this))\r\n);\r\n\r\n(function(global) {\r\n  /**\r\n   * Polyfill URL\r\n   *\r\n   * Inspired from : https://github.com/arv/DOM-URL-Polyfill/blob/master/src/url.js\r\n   */\r\n\r\n  var checkIfURLIsSupported = function() {\r\n    try {\r\n      var u = new URL('b', 'http://a');\r\n      u.pathname = 'c%20d';\r\n      return (u.href === 'http://a/c%20d') && u.searchParams;\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  var polyfillURL = function() {\r\n    var _URL = global.URL;\r\n\r\n    var URL = function(url, base) {\r\n      if(typeof url !== 'string') url = String(url);\r\n\r\n      var doc = document.implementation.createHTMLDocument('');\r\n      window.doc = doc;\r\n      if(base) {\r\n        var baseElement = doc.createElement('base');\r\n        baseElement.href = base;\r\n        doc.head.appendChild(baseElement);\r\n      }\r\n\r\n      var anchorElement = doc.createElement('a');\r\n      anchorElement.href = url;\r\n      doc.body.appendChild(anchorElement);\r\n      anchorElement.href = anchorElement.href; // force href to refresh\r\n\r\n      if(anchorElement.protocol === ':' || !/:/.test(anchorElement.href)) {\r\n        throw new TypeError('Invalid URL');\r\n      }\r\n\r\n      Object.defineProperty(this, '_anchorElement', {\r\n        value: anchorElement\r\n      });\r\n    };\r\n\r\n    var proto = URL.prototype;\r\n\r\n    var linkURLWithAnchorAttribute = function(attributeName) {\r\n      Object.defineProperty(proto, attributeName, {\r\n        get: function() {\r\n          return this._anchorElement[attributeName];\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement[attributeName] = value;\r\n        },\r\n        enumerable: true\r\n      });\r\n    };\r\n\r\n    ['hash', 'host', 'hostname', 'port', 'protocol', 'search']\r\n    .forEach(function(attributeName) {\r\n      linkURLWithAnchorAttribute(attributeName);\r\n    });\r\n\r\n    Object.defineProperties(proto, {\r\n\r\n      'toString': {\r\n        get: function() {\r\n          var _this = this;\r\n          return function() {\r\n            return _this.href;\r\n          };\r\n        }\r\n      },\r\n\r\n      'href' : {\r\n        get: function() {\r\n          return this._anchorElement.href.replace(/\\?$/,'');\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement.href = value;\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'pathname' : {\r\n        get: function() {\r\n          return this._anchorElement.pathname.replace(/(^\\/?)/,'/');\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement.pathname = value;\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'origin': {\r\n        get: function() {\r\n          // get expected port from protocol\r\n          var expectedPort = {'http:': 80, 'https:': 443, 'ftp:': 21}[this._anchorElement.protocol];\r\n          // add port to origin if, expected port is different than actual port\r\n          // and it is not empty f.e http://foo:8080\r\n          // 8080 != 80 && 8080 != ''\r\n          var addPortToOrigin = this._anchorElement.port != expectedPort &&\r\n            this._anchorElement.port !== ''\r\n\r\n          return this._anchorElement.protocol +\r\n            '//' +\r\n            this._anchorElement.hostname +\r\n            (addPortToOrigin ? (':' + this._anchorElement.port) : '');\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'password': { // TODO\r\n        get: function() {\r\n          return '';\r\n        },\r\n        set: function(value) {\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'username': { // TODO\r\n        get: function() {\r\n          return '';\r\n        },\r\n        set: function(value) {\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'searchParams': {\r\n        get: function() {\r\n          var searchParams = new URLSearchParams(this.search);\r\n          var _this = this;\r\n          ['append', 'delete', 'set'].forEach(function(methodName) {\r\n            var method = searchParams[methodName];\r\n            searchParams[methodName] = function() {\r\n              method.apply(searchParams, arguments);\r\n              _this.search = searchParams.toString();\r\n            };\r\n          });\r\n          return searchParams;\r\n        },\r\n        enumerable: true\r\n      }\r\n    });\r\n\r\n    URL.createObjectURL = function(blob) {\r\n      return _URL.createObjectURL.apply(_URL, arguments);\r\n    };\r\n\r\n    URL.revokeObjectURL = function(url) {\r\n      return _URL.revokeObjectURL.apply(_URL, arguments);\r\n    };\r\n\r\n    global.URL = URL;\r\n\r\n  };\r\n\r\n  if(!checkIfURLIsSupported()) {\r\n    polyfillURL();\r\n  }\r\n\r\n  if((global.location !== void 0) && !('origin' in global.location)) {\r\n    var getOrigin = function() {\r\n      return global.location.protocol + '//' + global.location.hostname + (global.location.port ? (':' + global.location.port) : '');\r\n    };\r\n\r\n    try {\r\n      Object.defineProperty(global.location, 'origin', {\r\n        get: getOrigin,\r\n        enumerable: true\r\n      });\r\n    } catch(e) {\r\n      setInterval(function() {\r\n        global.location.origin = getOrigin();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n})(\r\n  (typeof global !== 'undefined') ? global\r\n    : ((typeof window !== 'undefined') ? window\r\n    : ((typeof self !== 'undefined') ? self : this))\r\n);\r\n","/*\n * classList.js: Cross-browser full element.classList implementation.\n * 1.1.20170427\n *\n * By Eli Grey, http://eligrey.com\n * License: Dedicated to the public domain.\n *   See https://github.com/eligrey/classList.js/blob/master/LICENSE.md\n */\n\n/*global self, document, DOMException */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */\n\nif (\"document\" in window.self) {\n\n// Full polyfill for browsers with no classList support\n// Including IE < Edge missing SVGElement.classList\nif (!(\"classList\" in document.createElement(\"_\")) \n\t|| document.createElementNS && !(\"classList\" in document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\"))) {\n\n(function (view) {\n\n\"use strict\";\n\nif (!('Element' in view)) return;\n\nvar\n\t  classListProp = \"classList\"\n\t, protoProp = \"prototype\"\n\t, elemCtrProto = view.Element[protoProp]\n\t, objCtr = Object\n\t, strTrim = String[protoProp].trim || function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, \"\");\n\t}\n\t, arrIndexOf = Array[protoProp].indexOf || function (item) {\n\t\tvar\n\t\t\t  i = 0\n\t\t\t, len = this.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\t// Vendors: please allow content code to instantiate DOMExceptions\n\t, DOMEx = function (type, message) {\n\t\tthis.name = type;\n\t\tthis.code = DOMException[type];\n\t\tthis.message = message;\n\t}\n\t, checkTokenAndGetIndex = function (classList, token) {\n\t\tif (token === \"\") {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"SYNTAX_ERR\"\n\t\t\t\t, \"An invalid or illegal string was specified\"\n\t\t\t);\n\t\t}\n\t\tif (/\\s/.test(token)) {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"INVALID_CHARACTER_ERR\"\n\t\t\t\t, \"String contains an invalid character\"\n\t\t\t);\n\t\t}\n\t\treturn arrIndexOf.call(classList, token);\n\t}\n\t, ClassList = function (elem) {\n\t\tvar\n\t\t\t  trimmedClasses = strTrim.call(elem.getAttribute(\"class\") || \"\")\n\t\t\t, classes = trimmedClasses ? trimmedClasses.split(/\\s+/) : []\n\t\t\t, i = 0\n\t\t\t, len = classes.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tthis.push(classes[i]);\n\t\t}\n\t\tthis._updateClassName = function () {\n\t\t\telem.setAttribute(\"class\", this.toString());\n\t\t};\n\t}\n\t, classListProto = ClassList[protoProp] = []\n\t, classListGetter = function () {\n\t\treturn new ClassList(this);\n\t}\n;\n// Most DOMException implementations don't allow calling DOMException's toString()\n// on non-DOMExceptions. Error's toString() is sufficient here.\nDOMEx[protoProp] = Error[protoProp];\nclassListProto.item = function (i) {\n\treturn this[i] || null;\n};\nclassListProto.contains = function (token) {\n\ttoken += \"\";\n\treturn checkTokenAndGetIndex(this, token) !== -1;\n};\nclassListProto.add = function () {\n\tvar\n\t\t  tokens = arguments\n\t\t, i = 0\n\t\t, l = tokens.length\n\t\t, token\n\t\t, updated = false\n\t;\n\tdo {\n\t\ttoken = tokens[i] + \"\";\n\t\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\t\tthis.push(token);\n\t\t\tupdated = true;\n\t\t}\n\t}\n\twhile (++i < l);\n\n\tif (updated) {\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.remove = function () {\n\tvar\n\t\t  tokens = arguments\n\t\t, i = 0\n\t\t, l = tokens.length\n\t\t, token\n\t\t, updated = false\n\t\t, index\n\t;\n\tdo {\n\t\ttoken = tokens[i] + \"\";\n\t\tindex = checkTokenAndGetIndex(this, token);\n\t\twhile (index !== -1) {\n\t\t\tthis.splice(index, 1);\n\t\t\tupdated = true;\n\t\t\tindex = checkTokenAndGetIndex(this, token);\n\t\t}\n\t}\n\twhile (++i < l);\n\n\tif (updated) {\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.toggle = function (token, force) {\n\ttoken += \"\";\n\n\tvar\n\t\t  result = this.contains(token)\n\t\t, method = result ?\n\t\t\tforce !== true && \"remove\"\n\t\t:\n\t\t\tforce !== false && \"add\"\n\t;\n\n\tif (method) {\n\t\tthis[method](token);\n\t}\n\n\tif (force === true || force === false) {\n\t\treturn force;\n\t} else {\n\t\treturn !result;\n\t}\n};\nclassListProto.toString = function () {\n\treturn this.join(\" \");\n};\n\nif (objCtr.defineProperty) {\n\tvar classListPropDesc = {\n\t\t  get: classListGetter\n\t\t, enumerable: true\n\t\t, configurable: true\n\t};\n\ttry {\n\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t} catch (ex) { // IE 8 doesn't support enumerable:true\n\t\t// adding undefined to fight this issue https://github.com/eligrey/classList.js/issues/36\n\t\t// modernie IE8-MSW7 machine has IE8 8.0.6001.18702 and is affected\n\t\tif (ex.number === undefined || ex.number === -0x7FF5EC54) {\n\t\t\tclassListPropDesc.enumerable = false;\n\t\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t\t}\n\t}\n} else if (objCtr[protoProp].__defineGetter__) {\n\telemCtrProto.__defineGetter__(classListProp, classListGetter);\n}\n\n}(window.self));\n\n}\n\n// There is full or partial native classList support, so just check if we need\n// to normalize the add/remove and toggle APIs.\n\n(function () {\n\t\"use strict\";\n\n\tvar testElement = document.createElement(\"_\");\n\n\ttestElement.classList.add(\"c1\", \"c2\");\n\n\t// Polyfill for IE 10/11 and Firefox <26, where classList.add and\n\t// classList.remove exist but support only one argument at a time.\n\tif (!testElement.classList.contains(\"c2\")) {\n\t\tvar createMethod = function(method) {\n\t\t\tvar original = DOMTokenList.prototype[method];\n\n\t\t\tDOMTokenList.prototype[method] = function(token) {\n\t\t\t\tvar i, len = arguments.length;\n\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\ttoken = arguments[i];\n\t\t\t\t\toriginal.call(this, token);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tcreateMethod('add');\n\t\tcreateMethod('remove');\n\t}\n\n\ttestElement.classList.toggle(\"c3\", false);\n\n\t// Polyfill for IE 10 and Firefox <24, where classList.toggle does not\n\t// support the second argument.\n\tif (testElement.classList.contains(\"c3\")) {\n\t\tvar _toggle = DOMTokenList.prototype.toggle;\n\n\t\tDOMTokenList.prototype.toggle = function(token, force) {\n\t\t\tif (1 in arguments && !this.contains(token) === !force) {\n\t\t\t\treturn force;\n\t\t\t} else {\n\t\t\t\treturn _toggle.call(this, token);\n\t\t\t}\n\t\t};\n\n\t}\n\n\ttestElement = null;\n}());\n\n}\n","/*\n * @namespace Util\n *\n * Various utility functions, used by Leaflet internally.\n */\n\n// @function extend(dest: Object, src?: Object): Object\n// Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.\nexport function extend(dest) {\n    var i, j, len, src;\n\n    for (j = 1, len = arguments.length; j < len; j++) {\n        src = arguments[j];\n        for (i in src) {\n            dest[i] = src[i];\n        }\n    }\n    return dest;\n}\n\n// @function create(proto: Object, properties?: Object): Object\n// Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\nexport var create = Object.create || (function () {\n    function F() {}\n    return function (proto) {\n        F.prototype = proto;\n        return new F();\n    };\n})();\n\n// @function bind(fn: Function, …): Function\n// Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n// Has a `L.bind()` shortcut.\nexport function bind(fn, obj) {\n    var slice = Array.prototype.slice;\n\n    if (fn.bind) {\n        return fn.bind.apply(fn, slice.call(arguments, 1));\n    }\n\n    var args = slice.call(arguments, 2);\n\n    return function () {\n        return fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\n    };\n}\n\n// @property lastId: Number\n// Last unique ID used by [`stamp()`](#util-stamp)\nexport var lastId = 0;\n\n// @function stamp(obj: Object): Number\n// Returns the unique ID of an object, assiging it one if it doesn't have it.\nexport function stamp(obj) {\n    /*eslint-disable */\n    obj._cozy_id = obj._cozy_id || ++lastId;\n    return obj._cozy_id; /* not leaflet */\n    /*eslint-enable */\n}\n\n// @function throttle(fn: Function, time: Number, context: Object): Function\n// Returns a function which executes function `fn` with the given scope `context`\n// (so that the `this` keyword refers to `context` inside `fn`'s code). The function\n// `fn` will be called no more than one time per given amount of `time`. The arguments\n// received by the bound function will be any arguments passed when binding the\n// function, followed by any arguments passed when invoking the bound function.\n// Has an `L.throttle` shortcut.\nexport function throttle(fn, time, context) {\n    var lock, args, wrapperFn, later;\n\n    later = function () {\n        // reset lock and call if queued\n        lock = false;\n        if (args) {\n            wrapperFn.apply(context, args);\n            args = false;\n        }\n    };\n\n    wrapperFn = function () {\n        if (lock) {\n            // called too soon, queue to call later\n            args = arguments;\n\n        } else {\n            // call and lock until later\n            fn.apply(context, arguments);\n            setTimeout(later, time);\n            lock = true;\n        }\n    };\n\n    return wrapperFn;\n}\n\n// @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number\n// Returns the number `num` modulo `range` in such a way so it lies within\n// `range[0]` and `range[1]`. The returned value will be always smaller than\n// `range[1]` unless `includeMax` is set to `true`.\nexport function wrapNum(x, range, includeMax) {\n    var max = range[1],\n        min = range[0],\n        d = max - min;\n    return x === max && includeMax ? x : ((x - min) % d + d) % d + min;\n}\n\n// @function falseFn(): Function\n// Returns a function which always returns `false`.\nexport function falseFn() { return false; }\n\n// @function formatNum(num: Number, digits?: Number): Number\n// Returns the number `num` rounded to `digits` decimals, or to 5 decimals by default.\nexport function formatNum(num, digits) {\n    var pow = Math.pow(10, digits || 5);\n    return Math.round(num * pow) / pow;\n}\n\n// @function isNumeric(num: Number): Boolean\n// Returns whether num is actually numeric\nexport function isNumeric(num) {\n  return !isNaN(parseFloat(num)) && isFinite(num);\n}\n\n// @function trim(str: String): String\n// Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)\nexport function trim(str) {\n    return str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\n}\n\n// @function splitWords(str: String): String[]\n// Trims and splits the string on whitespace and returns the array of parts.\nexport function splitWords(str) {\n    return trim(str).split(/\\s+/);\n}\n\n// @function setOptions(obj: Object, options: Object): Object\n// Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.\nexport function setOptions(obj, options) {\n    if (!obj.hasOwnProperty('options')) {\n        obj.options = obj.options ? create(obj.options) : {};\n    }\n    for (var i in options) {\n        obj.options[i] = options[i];\n    }\n    return obj.options;\n}\n\n// @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\n// Converts an object into a parameter URL string, e.g. `{a: \"foo\", b: \"bar\"}`\n// translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will\n// be appended at the end. If `uppercase` is `true`, the parameter names will\n// be uppercased (e.g. `'?A=foo&B=bar'`)\nexport function getParamString(obj, existingUrl, uppercase) {\n    var params = [];\n    for (var i in obj) {\n        params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\n    }\n    return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\n}\n\nvar templateRe = /\\{ *([\\w_\\-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values — they will be evaluated passing `data` as an argument.\nexport function template(str, data) {\n    return str.replace(templateRe, function (str, key) {\n        var value = data[key];\n\n        if (value === undefined) {\n            throw new Error('No value provided for variable ' + str);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n}\n\n// @function isArray(obj): Boolean\n// Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)\nexport var isArray = Array.isArray || function (obj) {\n    return (Object.prototype.toString.call(obj) === '[object Array]');\n};\n\n// @function indexOf(array: Array, el: Object): Number\n// Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)\nexport function indexOf(array, el) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i] === el) { return i; }\n    }\n    return -1;\n}\n\n// @property emptyImageUrl: String\n// Data URI string containing a base64-encoded empty GIF image.\n// Used as a hack to free memory from unused images on WebKit-powered\n// mobile devices (by setting image `src` to this string).\nexport var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n\nfunction getPrefixed(name) {\n    return window['webkit' + name] || window['moz' + name] || window['ms' + name];\n}\n\nvar lastTime = 0;\n\n// fallback for IE 7-8\nfunction timeoutDefer(fn) {\n    var time = +new Date(),\n        timeToCall = Math.max(0, 16 - (time - lastTime));\n\n    lastTime = time + timeToCall;\n    return window.setTimeout(fn, timeToCall);\n}\n\nexport var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\nexport var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\n        getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\n\n// @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number\n// Schedules `fn` to be executed when the browser repaints. `fn` is bound to\n// `context` if given. When `immediate` is set, `fn` is called immediately if\n// the browser doesn't have native support for\n// [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\n// otherwise it's delayed. Returns a request ID that can be used to cancel the request.\nexport function requestAnimFrame(fn, context, immediate) {\n    if (immediate && requestFn === timeoutDefer) {\n        fn.call(context);\n    } else {\n        return requestFn.call(window, bind(fn, context));\n    }\n}\n\n// @function cancelAnimFrame(id: Number): undefined\n// Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\nexport function cancelAnimFrame(id) {\n    if (id) {\n        cancelFn.call(window, id);\n    }\n}\n\nexport var loader = {\n    js: function(url) {\n        var handler = { _resolved: false };\n        handler.callbacks = [];\n        handler.error = [];\n        handler.then = function(cb) {\n            handler.callbacks.push(cb);\n            if ( handler._resolved ) { return handler.resolve(); }\n            return handler;\n        }\n        handler.catch = function(cb) {\n            handler.error.push(cb);\n            if ( handler._resolved ) { return handler.reject(); }\n            return handler;\n        }\n        handler.resolve = function(_argv) {\n            // var _argv;\n            handler._resolved = true;\n            while ( handler.callbacks.length ) {\n                var cb = handler.callbacks.shift();\n                var retval;\n                try {\n                    _argv = cb(_argv);\n                } catch(e) {\n                    console.log(e);\n                    handler.reject(e);\n                    break;\n                }\n            }\n            return handler;\n        }\n\n        handler.reject = function(e) {\n            while ( handler.error.length ) {\n                var cb = handler.error.shift();\n                cb(e);\n            }\n            console.log(e);\n            console.trace();\n            return handler;\n        }\n\n        if ( url == undefined ) {\n            handler._resolved = true;\n            return handler;\n        }\n\n        var element = document.createElement('script');\n\n        element.onload = function() {\n          handler.resolve(url);\n        };\n        element.onerror = function() {\n          handler.catch.apply(arguments);\n        };\n\n        element.async = true;\n        var parent = 'body';\n        var attr = 'src';\n        element[attr] = url;\n        document[parent].appendChild(element);\n\n        console.log(\"AHOY APPENDED\", url);\n\n        return handler;\n    }\n}","import * as Util from './Util';\r\n\r\n// @class Class\r\n// @aka L.Class\r\n\r\n// @section\r\n// @uninheritable\r\n\r\n// Thanks to John Resig and Dean Edwards for inspiration!\r\n\r\nexport function Class() {}\r\n\r\nClass.extend = function (props) {\r\n\r\n\t// @function extend(props: Object): Function\r\n\t// [Extends the current class](#class-inheritance) given the properties to be included.\r\n\t// Returns a Javascript function that is a class constructor (to be called with `new`).\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tthis.callInitHooks();\r\n\t};\r\n\r\n\tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n\tvar proto = Util.create(parentProto);\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t// inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tUtil.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tcheckDeprecatedMixinEvents(props.includes);\r\n\t\tUtil.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (proto.options) {\r\n\t\tprops.options = Util.extend(Util.create(proto.options), props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tUtil.extend(proto, props);\r\n\t\r\n\tproto._initHooks = [];\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parentProto.callInitHooks) {\r\n\t\t\tparentProto.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// @function include(properties: Object): this\r\n// [Includes a mixin](#class-includes) into the current class.\r\nClass.include = function (props) {\r\n\tUtil.extend(this.prototype, props);\r\n\treturn this;\r\n};\r\n\r\n// @function mergeOptions(options: Object): this\r\n// [Merges `options`](#class-options) into the defaults of the class.\r\nClass.mergeOptions = function (options) {\r\n\tUtil.extend(this.prototype.options, options);\r\n\treturn this;\r\n};\r\n\r\n// @function addInitHook(fn: Function): this\r\n// Adds a [constructor hook](#class-constructor-hooks) to the class.\r\nClass.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n\treturn this;\r\n};\r\n\r\nfunction checkDeprecatedMixinEvents(includes) {\r\n\tif (!cozy || !cozy.Mixin) { return; }\r\n\r\n\tincludes = cozy.Util.isArray(includes) ? includes : [includes];\r\n\r\n\t// for (var i = 0; i < includes.length; i++) {\r\n\t// \tif (includes[i] === cozy.Mixin.Events) {\r\n\t// \t\tconsole.warn('Deprecated include of cozy.Mixin.Events: ' +\r\n\t// \t\t\t'this property will be removed in future releases, ' +\r\n\t// \t\t\t'please inherit from cozy.Evented instead.', new Error().stack);\r\n\t// \t}\r\n\t// }\r\n}\r\n","import {Class} from './Class';\r\nimport * as Util from './Util';\r\n\r\n/*\r\n * @class Evented\r\n * @aka L.Evented\r\n * @inherits Class\r\n *\r\n * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * map.on('click', function(e) {\r\n * \talert(e.latlng);\r\n * } );\r\n * ```\r\n *\r\n * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:\r\n *\r\n * ```js\r\n * function onClick(e) { ... }\r\n *\r\n * map.on('click', onClick);\r\n * map.off('click', onClick);\r\n * ```\r\n */\r\n\r\nexport var Evented = Class.extend({\r\n\r\n\t/* @method on(type: String, fn: Function, context?: Object): this\r\n\t * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).\r\n\t *\r\n\t * @alternative\r\n\t * @method on(eventMap: Object): this\r\n\t * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\t */\r\n\ton: function (types, fn, context) {\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\t// we don't process space-separated events here for performance;\r\n\t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n\t\t\t\tthis._on(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._on(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/* @method off(type: String, fn?: Function, context?: Object): this\r\n\t * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.\r\n\t *\r\n\t * @alternative\r\n\t * @method off(eventMap: Object): this\r\n\t * Removes a set of type/listener pairs.\r\n\t *\r\n\t * @alternative\r\n\t * @method off: this\r\n\t * Removes all listeners to all events on the object.\r\n\t */\r\n\toff: function (types, fn, context) {\r\n\r\n\t\tif (!types) {\r\n\t\t\t// clear all listeners if called without arguments\r\n\t\t\tdelete this._events;\r\n\r\n\t\t} else if (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis._off(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._off(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// attach listener (without syntactic sugar now)\r\n\t_on: function (type, fn, context) {\r\n\t\tthis._events = this._events || {};\r\n\r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._events[type];\r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._events[type] = typeListeners;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\t// Less memory footprint.\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\t\tvar newListener = {fn: fn, ctx: context},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if fn already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].fn === fn && listeners[i].ctx === context) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlisteners.push(newListener);\r\n\t},\r\n\r\n\t_off: function (type, fn, context) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n\r\n\t\tif (!this._events) { return; }\r\n\r\n\t\tlisteners = this._events[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!fn) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].fn = Util.falseFn;\r\n\t\t\t}\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._events[type];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find fn and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.ctx !== context) { continue; }\r\n\t\t\t\tif (l.fn === fn) {\r\n\r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\tl.fn = Util.falseFn;\r\n\r\n\t\t\t\t\tif (this._firingCount) {\r\n\t\t\t\t\t\t/* copy array in case events are being fired */\r\n\t\t\t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners.splice(i, 1);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// @method fire(type: String, data?: Object, propagate?: Boolean): this\r\n\t// Fires an event of the specified type. You can optionally provide an data\r\n\t// object — the first argument of the listener function will contain its\r\n\t// properties. The event can optionally be propagated to event parents.\r\n\tfire: function (type, data, propagate) {\r\n\t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n\t\tvar event = Util.extend({}, data, {type: type, target: this});\r\n\r\n\t\tif (this._events) {\r\n\t\t\tvar listeners = this._events[type];\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n\t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tvar l = listeners[i];\r\n\t\t\t\t\tl.fn.call(l.ctx || this, event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._firingCount--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// propagate the event to parents (set with addEventParent)\r\n\t\t\tthis._propagateEvent(event);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method listens(type: String): Boolean\r\n\t// Returns `true` if a particular event type has any listeners attached to it.\r\n\tlistens: function (type, propagate) {\r\n\t\tvar listeners = this._events && this._events[type];\r\n\t\tif (listeners && listeners.length) { return true; }\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// also check parents for listeners if event propagates\r\n\t\t\tfor (var id in this._eventParents) {\r\n\t\t\t\tif (this._eventParents[id].listens(type, propagate)) { return true; }\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// @method once(…): this\r\n\t// Behaves as [`on(…)`](#evented-on), except the listener will only get fired once and then removed.\r\n\tonce: function (types, fn, context) {\r\n\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis.once(type, types[type], fn);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar handler = Util.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .off(types, fn, context)\r\n\t\t\t    .off(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\t// add a listener that's executed once and removed after that\r\n\t\treturn this\r\n\t\t    .on(types, fn, context)\r\n\t\t    .on(types, handler, context);\r\n\t},\r\n\r\n\t// @method addEventParent(obj: Evented): this\r\n\t// Adds an event parent - an `Evented` that will receive propagated events\r\n\taddEventParent: function (obj) {\r\n\t\tthis._eventParents = this._eventParents || {};\r\n\t\tthis._eventParents[Util.stamp(obj)] = obj;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method removeEventParent(obj: Evented): this\r\n\t// Removes an event parent, so it will stop receiving propagated events\r\n\tremoveEventParent: function (obj) {\r\n\t\tif (this._eventParents) {\r\n\t\t\tdelete this._eventParents[Util.stamp(obj)];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\tfor (var id in this._eventParents) {\r\n\t\t\tthis._eventParents[id].fire(e.type, Util.extend({layer: e.target}, e), true);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar proto = Evented.prototype;\r\n\r\n// aliases; we should ditch those eventually\r\n\r\n// @method addEventListener(…): this\r\n// Alias to [`on(…)`](#evented-on)\r\nproto.addEventListener = proto.on;\r\n\r\n// @method removeEventListener(…): this\r\n// Alias to [`off(…)`](#evented-off)\r\n\r\n// @method clearAllEventListeners(…): this\r\n// Alias to [`off()`](#evented-off)\r\nproto.removeEventListener = proto.clearAllEventListeners = proto.off;\r\n\r\n// @method addOneTimeEventListener(…): this\r\n// Alias to [`once(…)`](#evented-once)\r\nproto.addOneTimeEventListener = proto.once;\r\n\r\n// @method fireEvent(…): this\r\n// Alias to [`fire(…)`](#evented-fire)\r\nproto.fireEvent = proto.fire;\r\n\r\n// @method hasEventListeners(…): Boolean\r\n// Alias to [`listens(…)`](#evented-listens)\r\nproto.hasEventListeners = proto.listens;\r\n","\n/*\n * @namespace Browser\n * @aka L.Browser\n *\n * A namespace with static properties for browser/feature detection used by Leaflet internally.\n *\n * @example\n *\n * ```js\n * if (L.Browser.ielt9) {\n *   alert('Upgrade your browser, dude!');\n * }\n * ```\n */\n\nvar style = document.documentElement.style;\n\n// @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).\nexport var ie = 'ActiveXObject' in window;\n\n// @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.\nexport var ielt9 = ie && !document.addEventListener;\n\n// @property edge: Boolean; `true` for the Edge web browser.\nexport var edge = 'msLaunchUri' in navigator && !('documentMode' in document);\n\n// @property webkit: Boolean;\n// `true` for webkit-based browsers like Chrome and Safari (including mobile versions).\nexport var webkit = userAgentContains('webkit');\n\n// @property android: Boolean\n// `true` for any browser running on an Android platform.\nexport var android = userAgentContains('android');\n\n// @property android23: Boolean; `true` for browsers running on Android 2 or Android 3.\nexport var android23 = userAgentContains('android 2') || userAgentContains('android 3');\n\n// @property opera: Boolean; `true` for the Opera browser\nexport var opera = !!window.opera;\n\n// @property chrome: Boolean; `true` for the Chrome browser.\nexport var chrome = userAgentContains('chrome');\n\n// @property gecko: Boolean; `true` for gecko-based browsers like Firefox.\nexport var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;\n\n// @property safari: Boolean; `true` for the Safari browser.\nexport var safari = !chrome && userAgentContains('safari');\n\nexport var phantom = userAgentContains('phantom');\n\n// @property opera12: Boolean\n// `true` for the Opera browser supporting CSS transforms (version 12 or later).\nexport var opera12 = 'OTransition' in style;\n\n// @property win: Boolean; `true` when the browser is running in a Windows platform\nexport var win = navigator.platform.indexOf('Win') === 0;\n\n// @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.\nexport var ie3d = ie && ('transition' in style);\n\n// @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.\nexport var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;\n\n// @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.\nexport var gecko3d = 'MozPerspective' in style;\n\n// @property any3d: Boolean\n// `true` for all browsers supporting CSS transforms.\nexport var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;\n\n// @property mobile: Boolean; `true` for all browsers running in a mobile device.\nexport var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');\n\n// @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.\nexport var mobileWebkit = mobile && webkit;\n\n// @property mobileWebkit3d: Boolean\n// `true` for all webkit-based browsers in a mobile device supporting CSS transforms.\nexport var mobileWebkit3d = mobile && webkit3d;\n\n// @property msPointer: Boolean\n// `true` for browsers implementing the Microsoft touch events model (notably IE10).\nexport var msPointer = !window.PointerEvent && window.MSPointerEvent;\n\n// @property pointer: Boolean\n// `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\nexport var pointer = !!(window.PointerEvent || msPointer);\n\n// @property touch: Boolean\n// `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).\n// This does not necessarily mean that the browser is running in a computer with\n// a touchscreen, it only means that the browser is capable of understanding\n// touch events.\nexport var touch = !window.L_NO_TOUCH && (pointer || 'ontouchstart' in window ||\n        (window.DocumentTouch && document instanceof window.DocumentTouch));\n\n// @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.\nexport var mobileOpera = mobile && opera;\n\n// @property mobileGecko: Boolean\n// `true` for gecko-based browsers running in a mobile device.\nexport var mobileGecko = mobile && gecko;\n\n// @property retina: Boolean\n// `true` for browsers on a high-resolution \"retina\" screen.\nexport var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;\n\n\n// @property canvas: Boolean\n// `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\nexport var canvas = (function () {\n    return !!document.createElement('canvas').getContext;\n}());\n\n// @property svg: Boolean\n// `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).\n// export var svg = !!(document.createElementNS && svgCreate('svg').createSVGRect);\nexport var svg = true;\n\n// @property vml: Boolean\n// `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).\nexport var vml = !svg && (function () {\n    try {\n        var div = document.createElement('div');\n        div.innerHTML = '<v:shape adj=\"1\"/>';\n\n        var shape = div.firstChild;\n        shape.style.behavior = 'url(#default#VML)';\n\n        return shape && (typeof shape.adj === 'object');\n\n    } catch (e) {\n        return false;\n    }\n}());\n\nexport var columnCount = ( 'columnCount' in style );\nexport var classList = ( document.documentElement.classList !== undefined );\n\nfunction userAgentContains(str) {\n    return navigator.userAgent.toLowerCase().indexOf(str) >= 0;\n}\n","import {isArray, formatNum} from '../core/Util';\r\n\r\n/*\r\n * @class Point\r\n * @aka L.Point\r\n *\r\n * Represents a point with `x` and `y` coordinates in pixels.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * var point = L.point(200, 300);\r\n * ```\r\n *\r\n * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:\r\n *\r\n * ```js\r\n * map.panBy([200, 300]);\r\n * map.panBy(L.point(200, 300));\r\n * ```\r\n */\r\n\r\nexport function Point(x, y, round) {\r\n\t// @property x: Number; The `x` coordinate of the point\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\t// @property y: Number; The `y` coordinate of the point\r\n\tthis.y = (round ? Math.round(y) : y);\r\n}\r\n\r\nPoint.prototype = {\r\n\r\n\t// @method clone(): Point\r\n\t// Returns a copy of the current point.\r\n\tclone: function () {\r\n\t\treturn new Point(this.x, this.y);\r\n\t},\r\n\r\n\t// @method add(otherPoint: Point): Point\r\n\t// Returns the result of addition of the current and the given points.\r\n\tadd: function (point) {\r\n\t\t// non-destructive, returns a new point\r\n\t\treturn this.clone()._add(toPoint(point));\r\n\t},\r\n\r\n\t_add: function (point) {\r\n\t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method subtract(otherPoint: Point): Point\r\n\t// Returns the result of subtraction of the given point from the current.\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(toPoint(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method divideBy(num: Number): Point\r\n\t// Returns the result of division of the current point by the given number.\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method multiplyBy(num: Number): Point\r\n\t// Returns the result of multiplication of the current point by the given number.\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method scaleBy(scale: Point): Point\r\n\t// Multiply each coordinate of the current point by each coordinate of\r\n\t// `scale`. In linear algebra terms, multiply the point by the\r\n\t// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)\r\n\t// defined by `scale`.\r\n\tscaleBy: function (point) {\r\n\t\treturn new Point(this.x * point.x, this.y * point.y);\r\n\t},\r\n\r\n\t// @method unscaleBy(scale: Point): Point\r\n\t// Inverse of `scaleBy`. Divide each coordinate of the current point by\r\n\t// each coordinate of `scale`.\r\n\tunscaleBy: function (point) {\r\n\t\treturn new Point(this.x / point.x, this.y / point.y);\r\n\t},\r\n\r\n\t// @method round(): Point\r\n\t// Returns a copy of the current point with rounded coordinates.\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method floor(): Point\r\n\t// Returns a copy of the current point with floored coordinates (rounded down).\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method ceil(): Point\r\n\t// Returns a copy of the current point with ceiled coordinates (rounded up).\r\n\tceil: function () {\r\n\t\treturn this.clone()._ceil();\r\n\t},\r\n\r\n\t_ceil: function () {\r\n\t\tthis.x = Math.ceil(this.x);\r\n\t\tthis.y = Math.ceil(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method distanceTo(otherPoint: Point): Number\r\n\t// Returns the cartesian distance between the current and the given points.\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\t// @method equals(otherPoint: Point): Boolean\r\n\t// Returns `true` if the given point has the same coordinates.\r\n\tequals: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\t// @method contains(otherPoint: Point): Boolean\r\n\t// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).\r\n\tcontains: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// Returns a string representation of the point for debugging purposes.\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        formatNum(this.x) + ', ' +\r\n\t\t        formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\n// @factory L.point(x: Number, y: Number, round?: Boolean)\r\n// Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Number[])\r\n// Expects an array of the form `[x, y]` instead.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Object)\r\n// Expects a plain object of the form `{x: Number, y: Number}` instead.\r\nexport function toPoint(x, y, round) {\r\n\tif (x instanceof Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (isArray(x)) {\r\n\t\treturn new Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\tif (typeof x === 'object' && 'x' in x && 'y' in x) {\r\n\t\treturn new Point(x.x, x.y);\r\n\t}\r\n\treturn new Point(x, y, round);\r\n}\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport * as Browser from '../core/Browser';\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\n\nvar POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown',\n    POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove',\n    POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup',\n    POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n    TAG_WHITE_LIST = ['INPUT', 'SELECT', 'OPTION'],\n\n    _pointers = {},\n    _pointerDocListener = false;\n\n// DomEvent.DoubleTap needs to know about this\nexport var _pointersCount = 0;\n\n// Provides a touch events wrapper for (ms)pointer events.\n// ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\nexport function addPointerListener(obj, type, handler, id) {\n\tif (type === 'touchstart') {\n\t\t_addPointerStart(obj, handler, id);\n\n\t} else if (type === 'touchmove') {\n\t\t_addPointerMove(obj, handler, id);\n\n\t} else if (type === 'touchend') {\n\t\t_addPointerEnd(obj, handler, id);\n\t}\n\n\treturn this;\n}\n\nexport function removePointerListener(obj, type, id) {\n\tvar handler = obj['_leaflet_' + type + id];\n\n\tif (type === 'touchstart') {\n\t\tobj.removeEventListener(POINTER_DOWN, handler, false);\n\n\t} else if (type === 'touchmove') {\n\t\tobj.removeEventListener(POINTER_MOVE, handler, false);\n\n\t} else if (type === 'touchend') {\n\t\tobj.removeEventListener(POINTER_UP, handler, false);\n\t\tobj.removeEventListener(POINTER_CANCEL, handler, false);\n\t}\n\n\treturn this;\n}\n\nfunction _addPointerStart(obj, handler, id) {\n\tvar onDown = Util.bind(function (e) {\n\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\n\t\t\t// In IE11, some touch events needs to fire for form controls, or\n\t\t\t// the controls will stop working. We keep a whitelist of tag names that\n\t\t\t// need these events. For other target tags, we prevent default on the event.\n\t\t\tif (TAG_WHITE_LIST.indexOf(e.target.tagName) < 0) {\n\t\t\t\tDomEvent.preventDefault(e);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t_handlePointer(e, handler);\n\t});\n\n\tobj['_leaflet_touchstart' + id] = onDown;\n\tobj.addEventListener(POINTER_DOWN, onDown, false);\n\n\t// need to keep track of what pointers and how many are active to provide e.touches emulation\n\tif (!_pointerDocListener) {\n\t\t// we listen documentElement as any drags that end by moving the touch off the screen get fired there\n\t\tdocument.documentElement.addEventListener(POINTER_DOWN, _globalPointerDown, true);\n\t\tdocument.documentElement.addEventListener(POINTER_MOVE, _globalPointerMove, true);\n\t\tdocument.documentElement.addEventListener(POINTER_UP, _globalPointerUp, true);\n\t\tdocument.documentElement.addEventListener(POINTER_CANCEL, _globalPointerUp, true);\n\n\t\t_pointerDocListener = true;\n\t}\n}\n\nfunction _globalPointerDown(e) {\n\t_pointers[e.pointerId] = e;\n\t_pointersCount++;\n}\n\nfunction _globalPointerMove(e) {\n\tif (_pointers[e.pointerId]) {\n\t\t_pointers[e.pointerId] = e;\n\t}\n}\n\nfunction _globalPointerUp(e) {\n\tdelete _pointers[e.pointerId];\n\t_pointersCount--;\n}\n\nfunction _handlePointer(e, handler) {\n\te.touches = [];\n\tfor (var i in _pointers) {\n\t\te.touches.push(_pointers[i]);\n\t}\n\te.changedTouches = [e];\n\n\thandler(e);\n}\n\nfunction _addPointerMove(obj, handler, id) {\n\tvar onMove = function (e) {\n\t\t// don't fire touch moves when mouse isn't down\n\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchmove' + id] = onMove;\n\tobj.addEventListener(POINTER_MOVE, onMove, false);\n}\n\nfunction _addPointerEnd(obj, handler, id) {\n\tvar onUp = function (e) {\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchend' + id] = onUp;\n\tobj.addEventListener(POINTER_UP, onUp, false);\n\tobj.addEventListener(POINTER_CANCEL, onUp, false);\n}\n\n","import * as Browser from '../core/Browser';\r\nimport {_pointersCount} from './DomEvent.Pointer';\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nvar _touchstart = Browser.msPointer ? 'MSPointerDown' : Browser.pointer ? 'pointerdown' : 'touchstart',\r\n    _touchend = Browser.msPointer ? 'MSPointerUp' : Browser.pointer ? 'pointerup' : 'touchend',\r\n    _pre = '_leaflet_';\r\n\r\n// inspired by Zepto touch code by Thomas Fuchs\r\nexport function addDoubleTapListener(obj, handler, id) {\r\n\tvar last, touch,\r\n\t    doubleTap = false,\r\n\t    delay = 250;\r\n\r\n\tfunction onTouchStart(e) {\r\n\t\tvar count;\r\n\r\n\t\tif (Browser.pointer) {\r\n\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\tcount = _pointersCount;\r\n\t\t} else {\r\n\t\t\tcount = e.touches.length;\r\n\t\t}\r\n\r\n\t\tif (count > 1) { return; }\r\n\r\n\t\tvar now = Date.now(),\r\n\t\t    delta = now - (last || now);\r\n\r\n\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\tlast = now;\r\n\t}\r\n\r\n\tfunction onTouchEnd(e) {\r\n\t\tif (doubleTap && !touch.cancelBubble) {\r\n\t\t\tif (Browser.pointer) {\r\n\t\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\tvar newTouch = {},\r\n\t\t\t\t    prop, i;\r\n\r\n\t\t\t\tfor (i in touch) {\r\n\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\tnewTouch[i] = prop && prop.bind ? prop.bind(touch) : prop;\r\n\t\t\t\t}\r\n\t\t\t\ttouch = newTouch;\r\n\t\t\t}\r\n\t\t\ttouch.type = 'dblclick';\r\n\t\t\thandler(touch);\r\n\t\t\tlast = null;\r\n\t\t}\r\n\t}\r\n\r\n\tobj[_pre + _touchstart + id] = onTouchStart;\r\n\tobj[_pre + _touchend + id] = onTouchEnd;\r\n\tobj[_pre + 'dblclick' + id] = handler;\r\n\r\n\tobj.addEventListener(_touchstart, onTouchStart, false);\r\n\tobj.addEventListener(_touchend, onTouchEnd, false);\r\n\r\n\t// On some platforms (notably, chrome<55 on win10 + touchscreen + mouse),\r\n\t// the browser doesn't fire touchend/pointerup events but does fire\r\n\t// native dblclicks. See #4127.\r\n\t// Edge 14 also fires native dblclicks, but only for pointerType mouse, see #5180.\r\n\tobj.addEventListener('dblclick', handler, false);\r\n\r\n\treturn this;\r\n}\r\n\r\nexport function removeDoubleTapListener(obj, id) {\r\n\tvar touchstart = obj[_pre + _touchstart + id],\r\n\t    touchend = obj[_pre + _touchend + id],\r\n\t    dblclick = obj[_pre + 'dblclick' + id];\r\n\r\n\tobj.removeEventListener(_touchstart, touchstart, false);\r\n\tobj.removeEventListener(_touchend, touchend, false);\r\n\tif (!Browser.edge) {\r\n\t\tobj.removeEventListener('dblclick', dblclick, false);\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n","import {Point} from '../geometry/Point';\r\nimport * as Util from '../core/Util';\r\nimport * as Browser from '../core/Browser';\r\nimport {addPointerListener, removePointerListener} from './DomEvent.Pointer';\r\nimport {addDoubleTapListener, removeDoubleTapListener} from './DomEvent.DoubleTap';\r\n\r\n/*\r\n * @namespace DomEvent\r\n * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.\r\n */\r\n\r\n// Inspired by John Resig, Dean Edwards and YUI addEvent implementations.\r\n\r\n// @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Adds a listener function (`fn`) to a particular DOM event type of the\r\n// element `el`. You can optionally specify the context of the listener\r\n// (object the `this` keyword will point to). You can also pass several\r\n// space-separated types (e.g. `'click dblclick'`).\r\n\r\n// @alternative\r\n// @function on(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\nexport function on(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\taddOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\taddOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\n// @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Removes a previously added listener function. If no function is specified,\r\n// it will remove all the listeners of that particular DOM event from the element.\r\n// Note that if you passed a custom context to on, you must pass the same\r\n// context to `off` in order to remove the listener.\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement): this\r\n// Removes all known event listeners\r\nexport function off(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\tremoveOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else if (types) {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\tremoveOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var j in obj[eventsKey]) {\r\n\t\t\tremoveOne(obj, j, obj[eventsKey][j]);\r\n\t\t}\r\n\t\tdelete obj[eventsKey];\r\n\t}\r\n}\r\n\r\nfunction addOne(obj, type, fn, context) {\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : '');\r\n\r\n\tif (obj[eventsKey] && obj[eventsKey][id]) { return this; }\r\n\r\n\tvar handler = function (e) {\r\n\t\treturn fn.call(context || obj, e || window.event);\r\n\t};\r\n\r\n\tvar originalHandler = handler;\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t// Needs DomEvent.Pointer.js\r\n\t\taddPointerListener(obj, type, handler, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && addDoubleTapListener &&\r\n\t           !(Browser.pointer && Browser.chrome)) {\r\n\t\t// Chrome >55 does not need the synthetic dblclicks from addDoubleTapListener\r\n\t\t// See #5180\r\n\t\taddDoubleTapListener(obj, handler, id);\r\n\r\n\t} else if ('addEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.addEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\thandler = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif (isExternalTarget(obj, e)) {\r\n\t\t\t\t\toriginalHandler(e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tobj.addEventListener(type === 'mouseenter' ? 'mouseover' : 'mouseout', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tif (type === 'click' && Browser.android) {\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tfilterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('attachEvent' in obj) {\r\n\t\tobj.attachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey] = obj[eventsKey] || {};\r\n\tobj[eventsKey][id] = handler;\r\n}\r\n\r\nfunction removeOne(obj, type, fn, context) {\r\n\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : ''),\r\n\t    handler = obj[eventsKey] && obj[eventsKey][id];\r\n\r\n\tif (!handler) { return this; }\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\tremovePointerListener(obj, type, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && removeDoubleTapListener) {\r\n\t\tremoveDoubleTapListener(obj, id);\r\n\r\n\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.removeEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tobj.removeEventListener(\r\n\t\t\t\ttype === 'mouseenter' ? 'mouseover' :\r\n\t\t\t\ttype === 'mouseleave' ? 'mouseout' : type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('detachEvent' in obj) {\r\n\t\tobj.detachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey][id] = null;\r\n}\r\n\r\n// @function stopPropagation(ev: DOMEvent): this\r\n// Stop the given event from propagation to parent elements. Used inside the listener functions:\r\n// ```js\r\n// L.DomEvent.on(div, 'click', function (ev) {\r\n// \tL.DomEvent.stopPropagation(ev);\r\n// });\r\n// ```\r\nexport function stopPropagation(e) {\r\n\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else if (e.originalEvent) {  // In case of Leaflet event.\r\n\t\te.originalEvent._stopped = true;\r\n\t} else {\r\n\t\te.cancelBubble = true;\r\n\t}\r\n\tskipped(e);\r\n\r\n\treturn this;\r\n}\r\n\r\n// @function disableScrollPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'mousewheel'` events (plus browser variants).\r\nexport function disableScrollPropagation(el) {\r\n\treturn addOne(el, 'mousewheel', stopPropagation);\r\n}\r\n\r\n// @function disableClickPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'click'`, `'doubleclick'`,\r\n// `'mousedown'` and `'touchstart'` events (plus browser variants).\r\nexport function disableClickPropagation(el) {\r\n\ton(el, 'mousedown touchstart dblclick', stopPropagation);\r\n\taddOne(el, 'click', fakeStop);\r\n\treturn this;\r\n}\r\n\r\n// @function preventDefault(ev: DOMEvent): this\r\n// Prevents the default action of the DOM Event `ev` from happening (such as\r\n// following a link in the href of the a element, or doing a POST request\r\n// with page reload when a `<form>` is submitted).\r\n// Use it inside listener functions.\r\nexport function preventDefault(e) {\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// @function stop(ev): this\r\n// Does `stopPropagation` and `preventDefault` at the same time.\r\nexport function stop(e) {\r\n\tpreventDefault(e);\r\n\tstopPropagation(e);\r\n\treturn this;\r\n}\r\n\r\n// @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point\r\n// Gets normalized mouse position from a DOM event relative to the\r\n// `container` or to the whole page if not specified.\r\nexport function getMousePosition(e, container) {\r\n\tif (!container) {\r\n\t\treturn new Point(e.clientX, e.clientY);\r\n\t}\r\n\r\n\tvar rect = container.getBoundingClientRect();\r\n\r\n\treturn new Point(\r\n\t\te.clientX - rect.left - container.clientLeft,\r\n\t\te.clientY - rect.top - container.clientTop);\r\n}\r\n\r\n// Chrome on Win scrolls double the pixels as in other platforms (see #4538),\r\n// and Firefox scrolls device pixels, not CSS pixels\r\nvar wheelPxFactor =\r\n\t(Browser.win && Browser.chrome) ? 2 :\r\n\tBrowser.gecko ? window.devicePixelRatio : 1;\r\n\r\n// @function getWheelDelta(ev: DOMEvent): Number\r\n// Gets normalized wheel delta from a mousewheel DOM event, in vertical\r\n// pixels scrolled (negative if scrolling down).\r\n// Events from pointing devices without precise scrolling are mapped to\r\n// a best guess of 60 pixels.\r\nexport function getWheelDelta(e) {\r\n\treturn (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta\r\n\t       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels\r\n\t       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines\r\n\t       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages\r\n\t       (e.deltaX || e.deltaZ) ? 0 :\t// Skip horizontal/depth wheel events\r\n\t       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels\r\n\t       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines\r\n\t       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages\r\n\t       0;\r\n}\r\n\r\nvar skipEvents = {};\r\n\r\nexport function fakeStop(e) {\r\n\t// fakes stopPropagation by setting a special event flag, checked/reset with skipped(e)\r\n\tskipEvents[e.type] = true;\r\n}\r\n\r\nexport function skipped(e) {\r\n\tvar events = skipEvents[e.type];\r\n\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\tskipEvents[e.type] = false;\r\n\treturn events;\r\n}\r\n\r\n// check if element really left/entered the event target (for mouseenter/mouseleave)\r\nexport function isExternalTarget(el, e) {\r\n\r\n\tvar related = e.relatedTarget;\r\n\r\n\tif (!related) { return true; }\r\n\r\n\ttry {\r\n\t\twhile (related && (related !== el)) {\r\n\t\t\trelated = related.parentNode;\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn false;\r\n\t}\r\n\treturn (related !== el);\r\n}\r\n\r\nvar lastClick;\r\n\r\n// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\nfunction filterClick(e, handler) {\r\n\tvar timeStamp = (e.timeStamp || (e.originalEvent && e.originalEvent.timeStamp)),\r\n\t    elapsed = lastClick && (timeStamp - lastClick);\r\n\r\n\t// are they closer together than 500ms yet more than 100ms?\r\n\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t// on the same event should be triggered far faster;\r\n\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\tstop(e);\r\n\t\treturn;\r\n\t}\r\n\tlastClick = timeStamp;\r\n\r\n\thandler(e);\r\n}\r\n\r\n// @function addListener(…): this\r\n// Alias to [`L.DomEvent.on`](#domevent-on)\r\nexport {on as addListener};\r\n\r\n// @function removeListener(…): this\r\n// Alias to [`L.DomEvent.off`](#domevent-off)\r\nexport {off as removeListener};\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport {Point} from '../geometry/Point';\nimport * as Browser from '../core/Browser';\n\n/*\n * @namespace DomUtil\n *\n * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\n * tree, used by Leaflet internally.\n *\n * Most functions expecting or returning a `HTMLElement` also work for\n * SVG elements. The only difference is that classes refer to CSS classes\n * in HTML and SVG classes in SVG.\n */\n\n if (!Element.prototype.matches) {\n    var ep = Element.prototype;\n \n    if (ep.webkitMatchesSelector) // Chrome <34, SF<7.1, iOS<8\n      ep.matches = ep.webkitMatchesSelector;\n \n    if (ep.msMatchesSelector) // IE9/10/11 & Edge\n      ep.matches = ep.msMatchesSelector;\n \n    if (ep.mozMatchesSelector) // FF<34\n      ep.matches = ep.mozMatchesSelector;\n }\n\n// @property TRANSFORM: String\n// Vendor-prefixed fransform style name (e.g. `'webkitTransform'` for WebKit).\nexport var TRANSFORM = testProp(\n    ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\n\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\n// the same for the transitionend event, in particular the Android 4.1 stock browser\n\n// @property TRANSITION: String\n// Vendor-prefixed transform style name.\nexport var TRANSITION = testProp(\n    ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\n\nexport var TRANSITION_END =\n    TRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';\n\n\n// @function get(id: String|HTMLElement): HTMLElement\n// Returns an element given its DOM id, or returns the element itself\n// if it was passed directly.\nexport function get(id) {\n    return typeof id === 'string' ? document.getElementById(id) : id;\n}\n\n// @function getStyle(el: HTMLElement, styleAttrib: String): String\n// Returns the value for a certain style attribute on an element,\n// including computed values or values set through CSS.\nexport function getStyle(el, style) {\n    var value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\n\n    if ((!value || value === 'auto') && document.defaultView) {\n        var css = document.defaultView.getComputedStyle(el, null);\n        value = css ? css[style] : null;\n    }\n    return value === 'auto' ? null : value;\n}\n\n// @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\n// Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\nexport function create(tagName, className, container) {\n    var el = document.createElement(tagName);\n    el.className = className || '';\n\n    if (container) {\n        container.appendChild(el);\n    }\n    return el;\n}\n\n// @function remove(el: HTMLElement)\n// Removes `el` from its parent element\nexport function remove(el) {\n    var parent = el.parentNode;\n    if (parent) {\n        parent.removeChild(el);\n    }\n}\n\n// @function empty(el: HTMLElement)\n// Removes all of `el`'s children elements from `el`\nexport function empty(el) {\n    while (el.firstChild) {\n        el.removeChild(el.firstChild);\n    }\n}\n\n// @function toFront(el: HTMLElement)\n// Makes `el` the last child of its parent, so it renders in front of the other children.\nexport function toFront(el) {\n    el.parentNode.appendChild(el);\n}\n\n// @function toBack(el: HTMLElement)\n// Makes `el` the first child of its parent, so it renders behind the other children.\nexport function toBack(el) {\n    var parent = el.parentNode;\n    parent.insertBefore(el, parent.firstChild);\n}\n\n// @function hasClass(el: HTMLElement, name: String): Boolean\n// Returns `true` if the element's class attribute contains `name`.\nexport function hasClass(el, name) {\n    if (el.classList !== undefined) {\n        return el.classList.contains(name);\n    }\n    var className = getClass(el);\n    return className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\n}\n\n// @function addClass(el: HTMLElement, name: String)\n// Adds `name` to the element's class attribute.\nexport function addClass(el, name) {\n    if (el.classList !== undefined) {\n        var classes = Util.splitWords(name);\n        for (var i = 0, len = classes.length; i < len; i++) {\n            el.classList.add(classes[i]);\n        }\n    } else if (!hasClass(el, name)) {\n        var className = getClass(el);\n        setClass(el, (className ? className + ' ' : '') + name);\n    }\n}\n\n// @function removeClass(el: HTMLElement, name: String)\n// Removes `name` from the element's class attribute.\nexport function removeClass(el, name) {\n    if (el.classList !== undefined) {\n        el.classList.remove(name);\n    } else {\n        setClass(el, Util.trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\n    }\n}\n\n// @function setClass(el: HTMLElement, name: String)\n// Sets the element's class.\nexport function setClass(el, name) {\n    if (el.className.baseVal === undefined) {\n        el.className = name;\n    } else {\n        // in case of SVG element\n        el.className.baseVal = name;\n    }\n}\n\n// @function getClass(el: HTMLElement): String\n// Returns the element's class.\nexport function getClass(el) {\n    return el.className.baseVal === undefined ? el.className : el.className.baseVal;\n}\n\n// @function setOpacity(el: HTMLElement, opacity: Number)\n// Set the opacity of an element (including old IE support).\n// `opacity` must be a number from `0` to `1`.\nexport function setOpacity(el, value) {\n    if ('opacity' in el.style) {\n        el.style.opacity = value;\n    } else if ('filter' in el.style) {\n        _setOpacityIE(el, value);\n    }\n}\n\nfunction _setOpacityIE(el, value) {\n    var filter = false,\n        filterName = 'DXImageTransform.Microsoft.Alpha';\n\n    // filters collection throws an error if we try to retrieve a filter that doesn't exist\n    try {\n        filter = el.filters.item(filterName);\n    } catch (e) {\n        // don't set opacity to 1 if we haven't already set an opacity,\n        // it isn't needed and breaks transparent pngs.\n        if (value === 1) { return; }\n    }\n\n    value = Math.round(value * 100);\n\n    if (filter) {\n        filter.Enabled = (value !== 100);\n        filter.Opacity = value;\n    } else {\n        el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\n    }\n}\n\n// @function testProp(props: String[]): String|false\n// Goes through the array of style names and returns the first name\n// that is a valid style name for an element. If no such name is found,\n// it returns false. Useful for vendor-prefixed styles like `transform`.\nexport function testProp(props) {\n    var style = document.documentElement.style;\n\n    for (var i = 0; i < props.length; i++) {\n        if (props[i] in style) {\n            return props[i];\n        }\n    }\n    return false;\n}\n\nexport function isPropertySupported(prop) {\n    var style = document.documentElement.style;\n    return prop in style;\n}\n\n// @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\n// Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\n// and optionally scaled by `scale`. Does not have an effect if the\n// browser doesn't support 3D CSS transforms.\nexport function setTransform(el, offset, scale) {\n    var pos = offset || new Point(0, 0);\n\n    el.style[TRANSFORM] =\n        (Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n}\n\n// @function setPosition(el: HTMLElement, position: Point)\n// Sets the position of `el` to coordinates specified by `position`,\n// using CSS translate or top/left positioning depending on the browser\n// (used by Leaflet internally to position its layers).\nexport function setPosition(el, point) {\n\n    /*eslint-disable */\n    el._leaflet_pos = point;\n    /*eslint-enable */\n\n    if (Browser.any3d) {\n        setTransform(el, point);\n    } else {\n        el.style.left = point.x + 'px';\n        el.style.top = point.y + 'px';\n    }\n}\n\n// @function getPosition(el: HTMLElement): Point\n// Returns the coordinates of an element previously positioned with setPosition.\nexport function getPosition(el) {\n    // this method is only used for elements previously positioned using setPosition,\n    // so it's safe to cache the position for performance\n\n    return el._leaflet_pos || new Point(0, 0);\n}\n\n// @function disableTextSelection()\n// Prevents the user from generating `selectstart` DOM events, usually generated\n// when the user drags the mouse through a page with text. Used internally\n// by Leaflet to override the behaviour of any click-and-drag interaction on\n// the map. Affects drag interactions on the whole document.\n\n// @function enableTextSelection()\n// Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).\nexport var disableTextSelection;\nexport var enableTextSelection;\nvar _userSelect;\nif ('onselectstart' in document) {\n    disableTextSelection = function () {\n        DomEvent.on(window, 'selectstart', DomEvent.preventDefault);\n    };\n    enableTextSelection = function () {\n        DomEvent.off(window, 'selectstart', DomEvent.preventDefault);\n    };\n} else {\n    var userSelectProperty = testProp(\n        ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\n\n    disableTextSelection = function () {\n        if (userSelectProperty) {\n            var style = document.documentElement.style;\n            _userSelect = style[userSelectProperty];\n            style[userSelectProperty] = 'none';\n        }\n    };\n    enableTextSelection = function () {\n        if (userSelectProperty) {\n            document.documentElement.style[userSelectProperty] = _userSelect;\n            _userSelect = undefined;\n        }\n    };\n}\n\n// @function disableImageDrag()\n// As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\n// for `dragstart` DOM events, usually generated when the user drags an image.\nexport function disableImageDrag() {\n    DomEvent.on(window, 'dragstart', DomEvent.preventDefault);\n}\n\n// @function enableImageDrag()\n// Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).\nexport function enableImageDrag() {\n    DomEvent.off(window, 'dragstart', DomEvent.preventDefault);\n}\n\nvar _outlineElement, _outlineStyle;\n// @function preventOutline(el: HTMLElement)\n// Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\n// of the element `el` invisible. Used internally by Leaflet to prevent\n// focusable elements from displaying an outline when the user performs a\n// drag interaction on them.\nexport function preventOutline(element) {\n    while (element.tabIndex === -1) {\n        element = element.parentNode;\n    }\n    if (!element || !element.style) { return; }\n    restoreOutline();\n    _outlineElement = element;\n    _outlineStyle = element.style.outline;\n    element.style.outline = 'none';\n    DomEvent.on(window, 'keydown', restoreOutline);\n}\n\n// @function restoreOutline()\n// Cancels the effects of a previous [`L.DomUtil.preventOutline`]().\nexport function restoreOutline() {\n    if (!_outlineElement) { return; }\n    _outlineElement.style.outline = _outlineStyle;\n    _outlineElement = undefined;\n    _outlineStyle = undefined;\n    DomEvent.off(window, 'keydown', restoreOutline);\n}\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObject = require('./isObject');\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nmodule.exports = isFunction;\n","var root = require('./_root');\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nmodule.exports = coreJsData;\n","var coreJsData = require('./_coreJsData');\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nmodule.exports = isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nmodule.exports = toSource;\n","var isFunction = require('./isFunction'),\n    isMasked = require('./_isMasked'),\n    isObject = require('./isObject'),\n    toSource = require('./_toSource');\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nmodule.exports = baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nmodule.exports = getValue;\n","var baseIsNative = require('./_baseIsNative'),\n    getValue = require('./_getValue');\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nmodule.exports = getNative;\n","var getNative = require('./_getNative');\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nmodule.exports = defineProperty;\n","var defineProperty = require('./_defineProperty');\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nmodule.exports = baseAssignValue;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nmodule.exports = eq;\n","var baseAssignValue = require('./_baseAssignValue'),\n    eq = require('./eq');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nmodule.exports = assignValue;\n","var assignValue = require('./_assignValue'),\n    baseAssignValue = require('./_baseAssignValue');\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nmodule.exports = copyObject;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nmodule.exports = identity;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nmodule.exports = apply;\n","var apply = require('./_apply');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nmodule.exports = overRest;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nmodule.exports = constant;\n","var constant = require('./constant'),\n    defineProperty = require('./_defineProperty'),\n    identity = require('./identity');\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nmodule.exports = baseSetToString;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nmodule.exports = shortOut;\n","var baseSetToString = require('./_baseSetToString'),\n    shortOut = require('./_shortOut');\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nmodule.exports = setToString;\n","var identity = require('./identity'),\n    overRest = require('./_overRest'),\n    setToString = require('./_setToString');\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nmodule.exports = baseRest;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nmodule.exports = isLength;\n","var isFunction = require('./isFunction'),\n    isLength = require('./isLength');\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nmodule.exports = isArrayLike;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\nmodule.exports = isIndex;\n","var eq = require('./eq'),\n    isArrayLike = require('./isArrayLike'),\n    isIndex = require('./_isIndex'),\n    isObject = require('./isObject');\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nmodule.exports = isIterateeCall;\n","var baseRest = require('./_baseRest'),\n    isIterateeCall = require('./_isIterateeCall');\n\n/**\n * Creates a function like `_.assign`.\n *\n * @private\n * @param {Function} assigner The function to assign values.\n * @returns {Function} Returns the new assigner function.\n */\nfunction createAssigner(assigner) {\n  return baseRest(function(object, sources) {\n    var index = -1,\n        length = sources.length,\n        customizer = length > 1 ? sources[length - 1] : undefined,\n        guard = length > 2 ? sources[2] : undefined;\n\n    customizer = (assigner.length > 3 && typeof customizer == 'function')\n      ? (length--, customizer)\n      : undefined;\n\n    if (guard && isIterateeCall(sources[0], sources[1], guard)) {\n      customizer = length < 3 ? undefined : customizer;\n      length = 1;\n    }\n    object = Object(object);\n    while (++index < length) {\n      var source = sources[index];\n      if (source) {\n        assigner(object, source, index, customizer);\n      }\n    }\n    return object;\n  });\n}\n\nmodule.exports = createAssigner;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nmodule.exports = isPrototype;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nmodule.exports = baseTimes;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nmodule.exports = baseIsArguments;\n","var baseIsArguments = require('./_baseIsArguments'),\n    isObjectLike = require('./isObjectLike');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nmodule.exports = isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nmodule.exports = isArray;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = stubFalse;\n","var root = require('./_root'),\n    stubFalse = require('./stubFalse');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nmodule.exports = isBuffer;\n","var baseGetTag = require('./_baseGetTag'),\n    isLength = require('./isLength'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nmodule.exports = baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nmodule.exports = baseUnary;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nmodule.exports = nodeUtil;\n","var baseIsTypedArray = require('./_baseIsTypedArray'),\n    baseUnary = require('./_baseUnary'),\n    nodeUtil = require('./_nodeUtil');\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nmodule.exports = isTypedArray;\n","var baseTimes = require('./_baseTimes'),\n    isArguments = require('./isArguments'),\n    isArray = require('./isArray'),\n    isBuffer = require('./isBuffer'),\n    isIndex = require('./_isIndex'),\n    isTypedArray = require('./isTypedArray');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = arrayLikeKeys;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nmodule.exports = overArg;\n","var overArg = require('./_overArg');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nmodule.exports = nativeKeys;\n","var isPrototype = require('./_isPrototype'),\n    nativeKeys = require('./_nativeKeys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseKeys;\n","var arrayLikeKeys = require('./_arrayLikeKeys'),\n    baseKeys = require('./_baseKeys'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nmodule.exports = keys;\n","var assignValue = require('./_assignValue'),\n    copyObject = require('./_copyObject'),\n    createAssigner = require('./_createAssigner'),\n    isArrayLike = require('./isArrayLike'),\n    isPrototype = require('./_isPrototype'),\n    keys = require('./keys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns own enumerable string keyed properties of source objects to the\n * destination object. Source objects are applied from left to right.\n * Subsequent sources overwrite property assignments of previous sources.\n *\n * **Note:** This method mutates `object` and is loosely based on\n * [`Object.assign`](https://mdn.io/Object/assign).\n *\n * @static\n * @memberOf _\n * @since 0.10.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @see _.assignIn\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * function Bar() {\n *   this.c = 3;\n * }\n *\n * Foo.prototype.b = 2;\n * Bar.prototype.d = 4;\n *\n * _.assign({ 'a': 0 }, new Foo, new Bar);\n * // => { 'a': 1, 'c': 3 }\n */\nvar assign = createAssigner(function(object, source) {\n  if (isPrototype(source) || isArrayLike(source)) {\n    copyObject(source, keys(source), object);\n    return;\n  }\n  for (var key in source) {\n    if (hasOwnProperty.call(source, key)) {\n      assignValue(object, key, source[key]);\n    }\n  }\n});\n\nmodule.exports = assign;\n","var document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\nvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\nvar fn = (function () {\n  var val;\n\n  var fnMap = [\n    [\n      'requestFullscreen',\n      'exitFullscreen',\n      'fullscreenElement',\n      'fullscreenEnabled',\n      'fullscreenchange',\n      'fullscreenerror'\n    ],\n    // New WebKit\n    [\n      'webkitRequestFullscreen',\n      'webkitExitFullscreen',\n      'webkitFullscreenElement',\n      'webkitFullscreenEnabled',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    // Old WebKit (Safari 5.1)\n    [\n      'webkitRequestFullScreen',\n      'webkitCancelFullScreen',\n      'webkitCurrentFullScreenElement',\n      'webkitCancelFullScreen',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    [\n      'mozRequestFullScreen',\n      'mozCancelFullScreen',\n      'mozFullScreenElement',\n      'mozFullScreenEnabled',\n      'mozfullscreenchange',\n      'mozfullscreenerror'\n    ],\n    [\n      'msRequestFullscreen',\n      'msExitFullscreen',\n      'msFullscreenElement',\n      'msFullscreenEnabled',\n      'MSFullscreenChange',\n      'MSFullscreenError'\n    ]\n  ];\n\n  var i = 0;\n  var l = fnMap.length;\n  var ret = {};\n\n  for (; i < l; i++) {\n    val = fnMap[i];\n    if (val && val[1] in document) {\n      for (i = 0; i < val.length; i++) {\n        ret[fnMap[0][i]] = val[i];\n      }\n      return ret;\n    }\n  }\n\n  return false;\n})();\n\nvar eventNameMap = {\n  change: fn.fullscreenchange,\n  error: fn.fullscreenerror\n};\n\nvar screenfull = {\n  request: function (elem) {\n    var request = fn.requestFullscreen;\n\n    elem = elem || document.documentElement;\n\n    // Work around Safari 5.1 bug: reports support for\n    // keyboard in fullscreen even though it doesn't.\n    // Browser sniffing, since the alternative with\n    // setTimeout is even worse.\n    if (/5\\.1[.\\d]* Safari/.test(navigator.userAgent)) {\n      elem[request]();\n    } else {\n      elem[request](keyboardAllowed && Element.ALLOW_KEYBOARD_INPUT);\n    }\n  },\n  exit: function () {\n    document[fn.exitFullscreen]();\n  },\n  toggle: function (elem) {\n    if (this.isFullscreen) {\n      this.exit();\n    } else {\n      this.request(elem);\n    }\n  },\n  onchange: function (callback) {\n    this.on('change', callback);\n  },\n  onerror: function (callback) {\n    this.on('error', callback);\n  },\n  on: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.addEventListener(eventName, callback, false);\n    }\n  },\n  off: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.removeEventListener(eventName, callback, false);\n    }\n  },\n  raw: fn\n};\n\nObject.defineProperties(screenfull, {\n  isFullscreen: {\n    get: function () {\n      return Boolean(document[fn.fullscreenElement]);\n    }\n  },\n  element: {\n    enumerable: true,\n    get: function () {\n      return document[fn.fullscreenElement];\n    }\n  },\n  enabled: {\n    enumerable: true,\n    get: function () {\n      // Coerce to boolean in case of old WebKit\n      return Boolean(document[fn.fullscreenEnabled]);\n    }\n  }\n});\n\nexport {screenfull};","import * as Util from '../core/Util';\nimport {Evented} from '../core/Events';\n// import {Class} from '../core/Class';\nimport * as Browser from '../core/Browser';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as DomUtil from '../dom/DomUtil';\n\nimport debounce from 'lodash/debounce';\nimport assign from 'lodash/assign';\n\nimport {screenfull} from '../screenfull';\n\n/*\n * @class Reader\n * @aka cozy.Map\n * @inherits Evented\n *\n * The central class of the API — it is used to create a book on a page and manipulate it.\n *\n * @example\n *\n * ```js\n * // initialize the map on the \"map\" div with a given center and zoom\n * var map = L.map('map', {\n *  center: [51.505, -0.09],\n *  zoom: 13\n * });\n * ```\n *\n */\n\nvar _padding = 1.0;\nexport var Reader = Evented.extend({\n  options: {\n    regions: [\n      'header',\n      'toolbar.top',\n      'toolbar.left',\n      'main',\n      'toolbar.right',\n      'toolbar.bottom',\n      'footer'\n    ],\n    metadata: {},\n    flow: 'auto',\n    engine: 'epubjs',\n    fontSizeLarge: '140%',\n    fontSizeSmall: '90%',\n    fontSizeDefault: '100%',\n    trackResize: true,\n    text_size: 100,\n    mobileMediaQuery: '(min-device-width : 300px) and (max-device-width : 600px)',\n    forceScrolledDocHeight: 1200,\n    theme: 'default',\n    rootfilePath: '',\n    themes: []\n  },\n\n  initialize: function(id, options) {\n    var self = this\n\n    self._original_document_title = document.title;\n\n    if ( localStorage.getItem('cozy.options') ) {\n      options = assign(options, JSON.parse(localStorage.getItem('cozy.options')));\n    }\n    options = Util.setOptions(this, options);\n\n    this._checkFeatureCompatibility();\n\n    this.metadata = this.options.metadata; // initial seed\n\n    this._initContainer(id);\n    this._initLayout();\n\n    if ( this.options.themes && this.options.themes.length > 0 ) {\n        this.options.themes.forEach(function(theme) {\n            if ( theme.href ) { return; }\n            var klass = theme.klass;\n            var rules = {};\n            for(var rule in theme.rules) {\n                var new_rule = '.' + klass;\n                if ( rule == 'body' ) { new_rule = 'body' + new_rule; }\n                else { new_rule += ' ' + rule ; }\n                rules[new_rule] = theme.rules[rule];\n            }\n            theme.rules = rules;\n        });\n    }\n\n    this._updateTheme();\n\n    // hack for https://github.com/Leaflet/Leaflet/issues/1980\n    // this._onResize = Util.bind(this._onResize, this);\n\n    this._initEvents();\n\n    this.callInitHooks();\n\n    this._mode = this.options.mode;\n  },\n\n  start: function(target, cb) {\n    var self = this;\n\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      cb = target;\n      target = undefined;\n    }\n\n    Util.loader.js(this.options.engine_href).then(function() {\n      self._start(target, cb);\n      self._loaded = true;\n    })\n  },\n\n  _start: function(target, cb) {\n    var self = this;\n    target = target || 0;\n\n    // self.open(function() {\n    //   self.draw(target, cb);\n    // });\n\n    self.open(target, cb);\n  },\n\n  reopen: function(options, target) {\n    /* NOP */\n  },\n\n  saveOptions: function(options) {\n    var saved_options = {};\n    assign(saved_options, options);\n    if ( saved_options.flow == 'auto' ) {\n      // do not save\n      delete saved_options.flow;\n    }\n    localStorage.setItem('cozy.options', JSON.stringify(saved_options));\n  },\n\n  _updateTheme: function() {\n    DomUtil.removeClass(this._container, 'cozy-theme-' + ( this._container.dataset.theme || 'default' ));\n    DomUtil.addClass(this._container, 'cozy-theme-' + this.options.theme);\n    this._container.dataset.theme = this.options.theme;\n  },\n\n  draw: function(target) {\n    // NOOP\n  },\n\n  next: function() {\n    // NOOP\n  },\n\n  prev: function() {\n    // NOOP\n  },\n\n  display: function(index) {\n    // NOOP\n  },\n\n  gotoPage: function(target) {\n    // NOOP\n  },\n\n  goBack: function() {\n    history.back();\n  },\n\n  goForward: function() {\n    history.forward();\n  },\n\n  requestFullscreen: function() {\n    if ( screenfull.enabled ) {\n      // this._preResize();\n      screenfull.toggle(this._container);\n    }\n  },\n\n  _preResize: function() {\n\n  },\n\n  _initContainer: function (id) {\n    var container = this._container = DomUtil.get(id);\n\n    if (!container) {\n      throw new Error('Reader container not found.');\n    } else if (container._cozy_id) {\n      throw new Error('Reader container is already initialized.');\n    }\n\n    DomEvent.on(container, 'scroll', this._onScroll, this);\n    this._containerId = Util.stamp(container);\n  },\n\n  _initLayout: function () {\n    var container = this._container;\n\n    this._fadeAnimated = this.options.fadeAnimation && Browser.any3d;\n\n    DomUtil.addClass(container, 'cozy-container' +\n      (Browser.touch ? ' cozy-touch' : '') +\n      (Browser.retina ? ' cozy-retina' : '') +\n      (Browser.ielt9 ? ' cozy-oldie' : '') +\n      (Browser.safari ? ' cozy-safari' : '') +\n      (this._fadeAnimated ? ' cozy-fade-anim' : '') +\n      ' cozy-engine-' + this.options.engine +\n      ' cozy-theme-' + this.options.theme);\n\n    var position = DomUtil.getStyle(container, 'position');\n\n    this._initPanes();\n\n    if ( ! Browser.columnCount ) {\n      this.options.flow = 'scrolled-doc';\n    }\n  },\n\n  _initPanes: function () {\n    var self = this;\n\n    var panes = this._panes = {};\n\n    var l = 'cozy-';\n    var container = this._container;\n\n    var prefix = 'cozy-module-';\n\n    DomUtil.addClass(container, 'cozy-container');\n    panes['top'] = DomUtil.create('div', prefix + 'top', container);\n    panes['main'] = DomUtil.create('div', prefix + 'main', container);\n    panes['bottom'] = DomUtil.create('div', prefix + 'bottom', container);\n\n    panes['left'] = DomUtil.create('div', prefix + 'left', panes['main']);\n    panes['book-cover'] = DomUtil.create('div', prefix + 'book-cover', panes['main']);\n    panes['right'] = DomUtil.create('div', prefix + 'right', panes['main']);\n    panes['book'] = DomUtil.create('div', prefix + 'book', panes['book-cover']);\n    panes['loader'] = DomUtil.create('div', prefix + 'book-loading', panes['book']);\n    panes['epub'] = DomUtil.create('div', prefix + 'book-epub', panes['book']);\n    this._initBookLoader();\n  },\n\n  _checkIfLoaded: function () {\n    if (!this._loaded) {\n      throw new Error('Set map center and zoom first.');\n    }\n  },\n\n  // DOM event handling\n\n  // @section Interaction events\n  _initEvents: function (remove) {\n    this._targets = {};\n    this._targets[Util.stamp(this._container)] = this;\n\n    this.tracking = function(reader) {\n      var _action = [];\n      var _last_location_start;\n      var _reader = reader;\n      return {\n        action: function(v) {\n          if ( v ) {\n            _action = [v];\n            this.event(v);\n            // _reader.fire('trackAction', { action: v })\n          } else {\n            return _action.pop();\n          }\n        },\n\n        event: function(action, data) {\n          if ( data == null ) { data = {}; }\n          data.action = action;\n          _reader.fire(\"trackAction\", data);\n        },\n\n        pageview: function(location) {\n          if ( location.start != _last_location_start ) {\n            _last_location_start = location.start;\n            // console.log(\"AHOY RELOCATED\", location, location.start, location.href, location.location, this.action());\n            _reader.fire('trackPageview', { cfi: location.start, href: location.href, action: this.action()})\n            return true;\n          }\n          return false;\n        }\n      }\n    }(this);\n\n    var onOff = remove ? DomEvent.off : DomEvent.on;\n\n    // @event click: MouseEvent\n    // Fired when the user clicks (or taps) the map.\n    // @event dblclick: MouseEvent\n    // Fired when the user double-clicks (or double-taps) the map.\n    // @event mousedown: MouseEvent\n    // Fired when the user pushes the mouse button on the map.\n    // @event mouseup: MouseEvent\n    // Fired when the user releases the mouse button on the map.\n    // @event mouseover: MouseEvent\n    // Fired when the mouse enters the map.\n    // @event mouseout: MouseEvent\n    // Fired when the mouse leaves the map.\n    // @event mousemove: MouseEvent\n    // Fired while the mouse moves over the map.\n    // @event contextmenu: MouseEvent\n    // Fired when the user pushes the right mouse button on the map, prevents\n    // default browser context menu from showing if there are listeners on\n    // this event. Also fired on mobile when the user holds a single touch\n    // for a second (also called long press).\n    // @event keypress: KeyboardEvent\n    // Fired when the user presses a key from the keyboard while the map is focused.\n    // onOff(this._container, 'click dblclick mousedown mouseup ' +\n    //   'mouseover mouseout mousemove contextmenu keypress', this._handleDOMEvent, this);\n\n    // if (this.options.trackResize) {\n    //   var self = this;\n    //   var fn = debounce(function(){ self.invalidateSize({}); }, 150);\n    //   onOff(window, 'resize', fn, this);\n    // }\n\n    if (Browser.any3d && this.options.transform3DLimit) {\n      (remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);\n    }\n\n    var self = this;\n    if (screenfull.enabled) {\n      screenfull.on('change', function() {\n        // setTimeout(function() {\n        //   self.invalidateSize({});\n        // }, 100);\n        console.log('AHOY: Am I fullscreen?', screenfull.isFullscreen ? 'YES' : 'NO');\n      });\n    }\n\n    self.on(\"updateLocation\", function(location) {\n      var location_href = location.start;\n\n      if ( self._ignoreHistory ) {\n        self._ignoreHistory = false;\n        return;\n      }\n\n      if ( self.tracking.pageview(location) ) {\n        var tmp_href = window.location.href.split(\"#\");\n        tmp_href[1] = location.start.substr(8, location.start.length - 8 - 1);\n        history.pushState({ cfi: location.start }, '', tmp_href.join('#'));\n\n        if ( location.percentage ) {\n          var p = Math.ceil(location.percentage * 100);\n          document.title = `${self._original_document_title} - ${p}%`;\n        }        \n      }\n    })\n\n    window.addEventListener('popstate', function(event) {\n      if ( event.isTrusted && event.state !== null ) {\n        self._ignoreHistory = true;\n        self.gotoPage(event.state.cfi);\n      }\n    })\n\n    document.addEventListener('keydown', function(event) {\n      var keyName = event.key;\n      var target = event.target;\n\n      // check if the activeElement is \".special-panel\"\n      var check = document.activeElement;\n      while ( check.localName != 'body' ) {\n        if ( check.classList.contains('special-panel') ) {\n          return;\n        }\n        check = check.parentElement;\n      }\n\n      var IGNORE_TARGETS = [ 'input', 'target' ];\n      if ( IGNORE_TARGETS.indexOf(target.localName) >= 0 ) {\n        return;\n      }\n\n      self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey });\n    });\n\n    self.on('keyDown', function(data) {\n      switch(data.keyName) {\n        case 'ArrowRight':\n        case 'PageDown':\n          self.next();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          self.prev();\n          break;\n        case 'Home':\n          self._scroll('HOME');\n          break;\n        case 'End':\n          self._scroll('END')\n          break;\n      }\n    });\n  },\n\n  // _onResize: function() {\n  //   if ( ! this._resizeRequest ) {\n  //     this._resizeRequest = Util.requestAnimFrame(function() {\n  //       this.invalidateSize({})\n  //     }, this);\n  //   }\n  // },\n\n  _onScroll: function () {\n    this._container.scrollTop  = 0;\n    this._container.scrollLeft = 0;\n  },\n\n  _handleDOMEvent: function (e) {\n    if (!this._loaded || DomEvent.skipped(e)) { return; }\n\n    var type = e.type === 'keypress' && e.keyCode === 13 ? 'click' : e.type;\n\n    if (type === 'mousedown') {\n      // prevents outline when clicking on keyboard-focusable element\n      DomUtil.preventOutline(e.target || e.srcElement);\n    }\n\n    this._fireDOMEvent(e, type);\n  },\n\n  _fireDOMEvent: function (e, type, targets) {\n\n    if (e.type === 'click') {\n      // Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).\n      // @event preclick: MouseEvent\n      // Fired before mouse click on the map (sometimes useful when you\n      // want something to happen on click before any existing click\n      // handlers start running).\n      var synth = Util.extend({}, e);\n      synth.type = 'preclick';\n      this._fireDOMEvent(synth, synth.type, targets);\n    }\n\n    if (e._stopped) { return; }\n\n    // Find the layer the event is propagating from and its parents.\n    targets = (targets || []).concat(this._findEventTargets(e, type));\n\n    if (!targets.length) { return; }\n\n    var target = targets[0];\n    if (type === 'contextmenu' && target.listens(type, true)) {\n      DomEvent.preventDefault(e);\n    }\n\n    var data = {\n      originalEvent: e\n    };\n\n    if (e.type !== 'keypress') {\n      var isMarker = (target.options && 'icon' in target.options);\n      data.containerPoint = isMarker ?\n          this.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\n      data.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\n      data.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);\n    }\n\n    for (var i = 0; i < targets.length; i++) {\n      targets[i].fire(type, data, true);\n      if (data.originalEvent._stopped ||\n        (targets[i].options.nonBubblingEvents && Util.indexOf(targets[i].options.nonBubblingEvents, type) !== -1)) { return; }\n    }\n  },\n\n  getFixedBookPanelSize: function() {\n    // have to make the book\n    var style = window.getComputedStyle(this._panes['book']);\n    var h = this._panes['book'].clientHeight - parseFloat(style.paddingTop) - parseFloat(style.paddingBottom);\n    var w = this._panes['book'].clientWidth - parseFloat(style.paddingRight) - parseFloat(style.paddingLeft);\n    return { height: Math.floor(h * 1.00), width: Math.floor(w * 1.00) };\n  },\n\n  invalidateSize: function(options) {\n    // TODO: IS THIS EVER USED?\n    var self = this;\n\n    if ( ! self._drawn ) { return; }\n\n    Util.cancelAnimFrame(this._resizeRequest);\n\n    if (! this._loaded) { return this; }\n\n    this.fire('resized');\n  },\n\n  _resizeBookPane: function() {\n\n  },\n\n  _setupHooks: function() {\n\n  },\n\n  _checkFeatureCompatibility: function() {\n    if ( ! DomUtil.isPropertySupported('columnCount') || this._checkMobileDevice() ) {\n      // force\n      this.options.flow = 'scrolled-doc';\n    }\n    if ( this._checkMobileDevice() ) {\n      // this.options.fontSizeLarge = '160%';\n      // this.options.fontSizeSmall ='100%';\n      // this.options.fontSizeDefault = '120%';\n      this.options.text_size = 120;\n    }\n  },\n\n  _checkMobileDevice: function() {\n    if ( this._isMobile === undefined ) {\n      this._isMobile = false;\n      if ( this.options.mobileMediaQuery ) {\n        this._isMobile = window.matchMedia(this.options.mobileMediaQuery).matches;\n      }\n    }\n    return this._isMobile;\n  },\n\n  _enableBookLoader: function(delay=0) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( delay < 0 ) {\n      delay = 0;\n      self._force_progress = true;\n    }\n    self._loader_timeout = setTimeout(function() {\n      self._panes['loader'].style.display = 'block';\n    }, delay);\n  },\n\n  _disableBookLoader: function(force=false) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( ! self._force_progress || force ) {\n      self._panes['loader'].style.display = 'none';\n      self._force_progress = false;\n      self._panes['loader-status'].innerHTML = '';\n    }\n  },\n\n  _clearBookLoaderTimeout: function() {\n    var self = this;\n    if ( self._loader_timeout ) {\n      clearTimeout(self._loader_timeout);\n      self._loader_timeout = null;\n    }\n  },\n\n  _initBookLoader: function() {\n    // is this not awesome?\n    var template = this.options.loader_template || this.loaderTemplate();\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      this._panes['loader'].appendChild(body.children[0]);\n    }\n    this._panes['loader-status'] = DomUtil.create('div', 'cozy-module-book-loading-status', this._panes['loader']);\n  },\n\n  loaderTemplate: function() {\n    return `<div class=\"cozy-loader-spinner\">\n    <div class=\"spinner-backdrop spinner-backdrop--1\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--2\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--3\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--4\"></div>\n    <div class=\"spinner-quarter spinner-quarter--1\"></div>\n    <div class=\"spinner-quarter spinner-quarter--2\"></div>\n    <div class=\"spinner-quarter spinner-quarter--3\"></div>\n    <div class=\"spinner-quarter spinner-quarter--4\"></div>\n  </div>`;\n  },\n\n  EOT: true\n});\n\nexport function createReader(id, options) {\n  return new Reader(id, options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\n\n/*\n * @class Control\n * @aka L.Control\n * @inherits Class\n *\n * L.Control is a base class for implementing reader controls. Handles regioning.\n * All other controls extend from this class.\n */\n\nexport var Control = Class.extend({\n    // @section\n    // @aka Control options\n    options: {\n        // @option region: String = 'topright'\n        // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n        // `'topright'`, `'bottomleft'` or `'bottomright'`\n    },\n\n    initialize: function (options) {\n        Util.setOptions(this, options);\n        if ( options.container ) {\n            this._container = options.container;\n            this._locked = true;\n        }\n        this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    },\n\n    /* @section\n     * Classes extending L.Control will inherit the following methods:\n     *\n     * @method getRegion: string\n     * Returns the region of the control.\n     */\n    getRegion: function () {\n        return this.options.region;\n    },\n\n    // @method setRegion(region: string): this\n    // Sets the region of the control.\n    setRegion: function (region) {\n        var reader = this._reader;\n\n        if (reader) {\n            reader.removeControl(this);\n        }\n\n        this.options.region = region;\n\n        if (reader) {\n            reader.addControl(this);\n        }\n\n        return this;\n    },\n\n    // @method getContainer: HTMLElement\n    // Returns the HTMLElement that contains the control.\n    getContainer: function () {\n        return this._container;\n    },\n\n    // @method addTo(reader: Map): this\n    // Adds the control to the given reader.\n    addTo: function (reader) {\n        this.remove();\n        this._reader = reader;\n\n        var container = this._container = this.onAdd(reader);\n\n        DomUtil.addClass(container, 'cozy-control');\n\n        if ( ! this._locked ) {\n            var region = this.getRegion();\n            var area = reader.getControlRegion(region);\n            area.appendChild(container);\n        }\n\n        return this;\n    },\n\n    // @method remove: this\n    // Removes the control from the reader it is currently active on.\n    remove: function () {\n        if (!this._reader) {\n            return this;\n        }\n\n        if (! this._container) {\n            return this;\n        }\n\n        if ( ! this._locked ) {\n            DomUtil.remove(this._container);\n        }\n\n        if (this.onRemove) {\n            this.onRemove(this._reader);\n        }\n\n        this._reader = null;\n\n        return this;\n    },\n\n    _refocusOnMap: function (e) {\n        // if reader exists and event is not a keyboard event\n        if (this._reader && e && e.screenX > 0 && e.screenY > 0) {\n            this._reader.getContainer().focus();\n        }\n    },\n\n    _className: function(widget) {\n        var className = [ 'cozy-control' ];\n        if ( this.options.direction ) {\n            className.push('cozy-control-' + this.options.direction);\n        }\n        if ( widget ) {\n            className.push('cozy-control-' + widget);\n        }\n        return className.join(' ');\n    }\n});\n\nexport var control = function (options) {\n    return new Control(options);\n};\n\n/* @section Extension methods\n * @uninheritable\n *\n * Every control should extend from `L.Control` and (re-)implement the following methods.\n *\n * @method onAdd(reader: Map): HTMLElement\n * Should return the container DOM element for the control and add listeners on relevant reader events. Called on [`control.addTo(reader)`](#control-addTo).\n *\n * @method onRemove(reader: Map)\n * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).\n */\n\n/* @namespace Map\n * @section Methods for Layers and Controls\n */\nReader.include({\n    // @method addControl(control: Control): this\n    // Adds the given control to the reader\n    addControl: function (control) {\n        control.addTo(this);\n        return this;\n    },\n\n    // @method removeControl(control: Control): this\n    // Removes the given control from the reader\n    removeControl: function (control) {\n        control.remove();\n        return this;\n    },\n\n    getControlContainer: function() {\n        var l = 'cozy-';\n        if ( ! this._controlContainer ) {\n            this._controlContainer =\n                DomUtil.create('div', l + 'control-container', this._container);\n        }\n        return this._controlContainer;\n    },\n\n    getControlRegion: function (target) {\n\n        if ( ! this._panes[target] ) {\n            // target is dot-delimited string\n            // first dot is the panel\n            var parts = target.split('.');\n            var tmp = [];\n            var parent = this._container;\n            var x = 0;\n            while ( parts.length ) {\n                var slug = parts.shift();\n                tmp.push(slug);\n                var panel = tmp.join(\".\");\n                var className = 'cozy-panel-' + slug;\n                if ( ! this._panes[panel] ) {\n                    this._panes[panel] = DomUtil.create('div', className, parent);\n                }\n                parent = this._panes[panel];\n                x += 1;\n                if ( x > 100 ) { break; }\n            }\n        }\n        return this._panes[target];\n    },\n\n    getControlRegion_1: function (target) {\n\n        var tmp = target.split('.');\n        var region = tmp.shift();\n        var slot = tmp.pop() || '-slot';\n\n        var container = this._panes[region];\n        if ( ! this._panes[target] ) {\n            var className = 'cozy-' + region + '--item cozy-slot-' + slot\n            if ( ! this._panes[region + '.' + slot] ) {\n                var div = DomUtil.create('div', className);\n                if ( slot == 'left' || slot == 'bottom' ) {\n                    var childElement = this._panes[region].firstChild;\n                    this._panes[region].insertBefore(div, childElement);\n                } else {\n                    this._panes[region].appendChild(div);\n                }\n                this._panes[region + '.' + slot] = div;\n            }\n            className = this._classify(tmp);\n            this._panes[target] = DomUtil.create('div', className, this._panes[region + '.' + slot]);\n        }\n\n        return this._panes[target];\n    },\n\n    _classify: function(tmp) {\n        var l = 'cozy-';\n        var className = [];\n        for(var i in tmp) {\n            className.push(l + tmp[i]);\n        }\n        className = className.join(' ');\n        return className;\n    },\n\n    _clearControlRegion: function () {\n        for (var i in this._controlRegions) {\n            DomUtil.remove(this._controlRegions[i]);\n        }\n        DomUtil.remove(this._controlContainer);\n        delete this._controlRegions;\n        delete this._controlContainer;\n    }\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nvar PageControl = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n      container = DomUtil.create('div', className),\n\n      this._control  = this._createButton(this._fill(options.html || options.label), this._fill(options.label),\n              className, container);\n    }\n    this._bindEvents();\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    return link;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    DomEvent.disableClickPropagation(this._control);\n    DomEvent.on(this._control, 'click', DomEvent.stop);\n    DomEvent.on(this._control, 'click', this._action, this);\n\n    this._reader.on('reopen', function(data) {\n      // update the button text / titles\n      var html = self.options.html || self.options.label;\n      self._control.innerHTML = self._fill(html);\n      self._control.setAttribute('title', self._fill(self.options.label));\n      self._control.setAttribute('aria-label', self._fill(self.options.label));\n    });\n\n  },\n\n  _unit: function() {\n    return ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  _fill: function(s) {\n    var unit = this._unit();\n    return s.replace(/\\$\\{unit\\}/g, unit);\n  },\n\n  _label: function() {\n    return this.options.label + \" \" + ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  EOT: true\n});\n\nexport var PagePrevious = PageControl.extend({\n  options: {\n    region: 'edge.left',\n    direction: 'previous',\n    label: 'Previous ${unit}',\n    html: '<i class=\"icon-chevron-left oi\" data-glyph=\"chevron-left\" title=\"Previous ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.prev();\n  }\n});\n\nexport var PageNext = PageControl.extend({\n  options: {\n    region: 'edge.right',\n    direction: 'next',\n    label: 'Next ${unit}',\n    html: '<i class=\"icon-chevron-right oi\" data-glyph=\"chevron-right\" title=\"Next ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.next();\n  }\n});\n\nexport var PageFirst = PageControl.extend({\n  options: {\n    direction: 'first',\n    label: 'First ${unit}'\n  },\n  _action: function(e) {\n      this._reader.first();\n  }\n});\n\nexport var PageLast = PageControl.extend({\n  options: {\n    direction: 'last',\n    label: 'Last ${unit}'\n  },\n  _action: function(e) {\n      this._reader.last();\n  }\n});\n\nexport var pageNext = function(options) {\n  return new PageNext(options);\n}\n\nexport var pagePrevious = function(options) {\n  return new PagePrevious(options);\n}\n\nexport var pageFirst = function(options) {\n  return new PageFirst(options);\n}\n\nexport var pageLast = function(options) {\n  return new PageLast(options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nimport assign from 'lodash/assign';\n\nvar activeModal;\nvar dismissModalListener = false;\n\n// from https://github.com/ghosh/micromodal/blob/master/src/index.js\nconst FOCUSABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'iframe',\n    'object',\n    'embed',\n    '[contenteditable]',\n    '[tabindex]:not([tabindex^=\"-\"])'\n  ];\n\nconst ACTIONABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input[type=\"submit\"]:not([disabled])',\n    'button:not([disabled])'\n  ];\n\nexport var Modal = Class.extend({\n  options: {\n    // @option region: String = 'topright'\n    // The region of the control (one of the reader edges). Possible values are `'left' ad 'right'`\n    region: 'left',\n    fraction: 0,\n    width: null,\n    className: {},\n    actions: null,\n    callbacks: { onShow: function() {}, onClose: function() {} },\n    handlers: {}\n  },\n\n  initialize: function (options) {\n    options = Util.setOptions(this, options);\n    this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    this._initializedEvents = false;\n    this.callbacks = assign({}, this.options.callbacks);\n    this.actions = this.options.actions ? assign({}, this.options.actions) : null;\n    this.handlers = assign({}, this.options.handlers);\n    if ( typeof(this.options.className) == 'string' ) {\n      this.options.className = { container: this.options.className };\n    }\n  },\n\n  addTo: function(reader) {\n    var self = this;\n    this._reader = reader;\n    var template = this.options.template;\n\n    var panelHTML = `<div class=\"cozy-modal modal-slide ${this.options.region || 'left'}\" id=\"modal-${this._id}\" aria-labelledby=\"modal-${this._id}-title\" role=\"dialog\" aria-describedby=\"modal-${this._id}-content\" aria-hidden=\"true\">\n      <div class=\"modal__overlay\" tabindex=\"-1\" data-modal-close>\n        <div class=\"modal__container ${this.options.className.container ? this.options.className.container : ''}\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-${this._id}-title\" aria-describedby=\"modal-${this._id}-content\" id=\"modal-${this._id}-container\">\n          <div role=\"document\">\n            <header class=\"modal__header\">\n              <h3 class=\"modal__title\" id=\"modal-${this._id}-title\">${this.options.title}</h3>\n              <button class=\"modal__close\" aria-label=\"Close modal\" aria-controls=\"modal-${this._id}-container\" data-modal-close></button>\n            </header>\n            <main class=\"modal__content ${this.options.className.main ? this.options.className.main : ''}\" id=\"modal-${this._id}-content\">\n              ${template}\n            </main>`;\n\n    if ( this.options.actions ) {\n      panelHTML += '<footer class=\"modal__footer\">'\n      for(var i in this.options.actions) {\n        var action = this.options.actions[i];\n        var button_cls = action.className || 'button--default';\n        panelHTML += `<button id=\"action-${this._id}-${i}\" class=\"button button--lg ${button_cls}\">${action.label}</button>`;\n      }\n      panelHTML += '</footer>';\n    }\n\n    panelHTML += '</div></div></div></div>';\n\n    var body = new DOMParser().parseFromString(panelHTML, \"text/html\").body;\n\n    this.modal = reader._container.appendChild(body.children[0]);\n    this._container = this.modal; // compatibility\n\n    this.container = this.modal.querySelector('.modal__container');\n    this._bindEvents();\n    return this;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    this.onClick = this.onClick.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n    this.onModalTransition = this.onModalTransition.bind(this);\n\n    this.modal.addEventListener('transitionend', function() {\n    }.bind(this));\n\n    // bind any actions\n    if ( this.actions ) {\n      for(var i in this.actions) {\n        let action = this.actions[i];\n        let button_id = '#action-' + this._id + '-' + i;\n        let button = this.modal.querySelector(button_id);\n        if ( button ) {\n          DomEvent.on(button, 'click', function(event) {\n            event.preventDefault();\n            action.callback(event);\n            if ( action.close ) {\n              self.closeModal();\n            }\n          })\n        }\n      }\n    }\n  },\n\n  deactivate: function() {\n    this.closeModal();\n  },\n\n  closeModal: function() {\n    var self = this;\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.removeEventListeners();\n    if ( this.activeElement ) {\n      this.activeElement.focus();\n    }\n    this.callbacks.onClose(this.modal);\n  },\n\n  showModal: function() {\n    this.activeElement = document.activeElement\n    this._resize();\n    this.modal.setAttribute('aria-hidden', 'false')\n    this.setFocusToFirstNode()\n    this.addEventListeners()\n    this.callbacks.onShow(this.modal)\n  },\n\n  activate: function() {\n    return this.showModal();\n    var self = this;\n    activeModal = this;\n    DomUtil.addClass(self._reader._container, 'st-modal-activating');\n    this._resize();\n    DomUtil.addClass(this._reader._container, 'st-modal-open');\n    setTimeout(function() {\n      DomUtil.addClass(self._container, 'active');\n      DomUtil.removeClass(self._reader._container, 'st-modal-activating');\n      self._container.setAttribute('aria-hidden', 'false');\n      self.setFocusToFirstNode();\n    }, 25);\n  },\n\n  addEventListeners: function () {\n    // --- do we need touch listeners?\n    // this.modal.addEventListener('touchstart', this.onClick)\n    // this.modal.addEventListener('touchend', this.onClick)\n    this.modal.addEventListener('click', this.onClick)\n    document.addEventListener('keydown', this.onKeydown)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.addEventListener(event, this.onModalTransition);\n    }.bind(this))\n  },\n\n  removeEventListeners: function () {\n    this.modal.removeEventListener('touchstart', this.onClick)\n    this.modal.removeEventListener('click', this.onClick)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.removeEventListener(event, this.onModalTransition);\n    }.bind(this))\n    document.removeEventListener('keydown', this.onKeydown)\n  },\n\n  _resize: function() {\n    var container = this._reader._container;\n    this.container.style.height = container.offsetHeight + 'px';\n    // console.log(\"AHOY MODAL\", this.container.style.height);\n    if ( ! this.options.className.container  ) {\n      this.container.style.width = this.options.width || parseInt(container.offsetWidth * this.options.fraction) + 'px';\n    }\n\n    var header = this.container.querySelector('header');\n    var footer = this.container.querySelector('footer');\n    var main = this.container.querySelector('main');\n    var height = this.container.clientHeight - header.clientHeight;\n    if ( footer ) {\n      height -= footer.clientHeight;\n    }\n    main.style.height = height + 'px';\n  },\n\n  getFocusableNodes: function() {\n    const nodes = this.modal.querySelectorAll(FOCUSABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  setFocusToFirstNode: function() {\n    var focusableNodes = this.getFocusableNodes();\n    if ( focusableNodes.length ) {\n      focusableNodes[0].focus();\n    } else {\n      activeModal._container.focus();\n    }\n  },\n\n  getActionableNodes: function() {\n    const nodes = this.modal.querySelectorAll(ACTIONABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  onKeydown: function(event) {\n    if ( event.keyCode == 27 ) { this.closeModal(); }\n    if ( event.keyCode == 9 ) {\n      this.maintainFocus(event);\n    }\n  },\n\n  onClick: function(event) {\n\n    var closeAfterAction = false;\n    var target = event.target;\n\n    // As far as I can tell, the code below isn't catching direct clicks on\n    // items with class='data-modal-close' as they're not ACTIONABLE_ELEMENTS.\n    // Adding them to ACTIONABLE_ELEMENTS causes undesirable behavior where\n    // their child items also close the modal thanks to the loop below.\n    // Children of .modal__overlay include the modal header, border area and\n    // padding. We don't want clicks on these closing the modal.\n    // Just close the modal now for direct clicks on a '.data-modal-close'.\n    if (target.hasAttribute('data-modal-close')) {\n      this.fire('closed');\n      this.closeModal();\n      return;\n    }\n\n    // if the target isn't an actionable type, walk the DOM until\n    // one is found\n    var actionableNodes = this.getActionableNodes();\n    while ( actionableNodes.indexOf(target) < 0 && target != this.modal ) {\n      target = target.parentElement;\n    }\n\n    // no target found, punt\n    if ( actionableNodes.indexOf(target) < 0 ) {\n      return;\n    }\n\n    if (this.handlers.click) {\n      var did_match = false;\n      for(var selector in this.handlers.click) {\n        if ( target.matches(selector) ) {\n          closeAfterAction = this.handlers.click[selector](this, target);\n          break;\n        }\n      }\n    }\n\n    if (closeAfterAction || target.hasAttribute('data-modal-close')) this.closeModal();\n\n    event.preventDefault();\n  },\n\n  onModalTransition: function(event) {\n    if ( this.modal.getAttribute('aria-hidden') == 'true' ) {\n      this._reader.fire('modal-closed');\n    } else {\n      this._reader.fire('modal-opened');\n    }\n  },\n\n  on: function(event, selector, handler) {\n    if (! this.handlers[event] ) {\n      this.handlers[event] = {};\n    }\n    if (typeof(selector) == 'function') {\n      handler = selector;\n      selector = '*';\n    }\n    this.handlers[event][selector] = handler;\n  },\n\n  fire: function(event) {\n    if ( this.handlers[event] && this.handlers[event]['*'] ) {\n      this.handlers[event]['*'](this);\n    }\n  },\n\n  maintainFocus: function(event) {\n    var focusableNodes = this.getFocusableNodes();\n    var focusedItemIndex = focusableNodes.indexOf(document.activeElement);\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableNodes[focusableNodes.length - 1].focus()\n      event.preventDefault()\n    }\n\n    if (!event.shiftKey && focusedItemIndex === focusableNodes.length - 1) {\n      focusableNodes[0].focus()\n      event.preventDefault()\n    }\n  },\n\n  EOT: true\n});\n\nReader.include({\n  modal: function (options) {\n    var modal = new Modal(options);\n    return modal.addTo(this);\n    // return this;\n  },\n\n  EOT: true\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport {Modal} from './Modal';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Contents = Control.extend({\n\n  defaultTemplate: `<button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Table of Contents\"><i class=\"icon-menu oi\" data-glyph=\"menu\" title=\"Table of Contents\" aria-hidden=\"true\"></i></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    this._control.setAttribute('id', 'action-' + this._id);\n    container.style.position = 'relative';\n\n    this._reader.on('updateContents', function(data) {\n\n      DomEvent.on(this._control, 'click', function(event) {\n        event.preventDefault();\n        self._reader.tracking.action('contents/open');\n        self._modal.activate();\n      }, this)\n\n      this._modal = this._reader.modal({\n        template: '<ul></ul>',\n        title: 'Contents',\n        region: 'left',\n        className: 'cozy-modal-contents'\n      });\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('data-href');\n        this._reader.tracking.action('contents/go');\n        this._reader.gotoPage(target);\n        return true;\n      }.bind(this))\n\n      this._modal.on('closed', function() {\n        self._reader.tracking.action('contents/close');\n      })\n\n      this._setupSkipLink();\n\n      var parent = self._modal._container.querySelector('ul');\n      // var s = data.toc.filter(function(value) { return value.parent == null }).map(function(value) { return [ value, 0, parent ] });\n      // while ( s.length ) {\n      //   var tuple = s.shift();\n      //   var chapter = tuple[0];\n      //   var tabindex = tuple[1];\n      //   var parent = tuple[2];\n\n      //   var option = self._createOption(chapter, tabindex, parent);\n      //   data.toc.filter(function(value) { return value.parent == chapter.id }).reverse().forEach(function(chapter_) {\n      //     s.unshift([chapter_, tabindex + 1, option]);\n      //   });\n      // }\n      var _process = function(items, tabindex, parent) {\n        items.forEach(function(item) {\n          var option = self._createOption(item, tabindex, parent);\n          if ( item.subitems && item.subitems.length ) {\n            _process(item.subitems, tabindex + 1, option);\n          }\n        })\n      }\n      _process(data.toc, 0, parent);\n    }.bind(this))\n\n    return container;\n  },\n\n  _createOption(chapter, tabindex, parent) {\n\n    function pad(value, length) {\n        return (value.toString().length < length) ? pad(\"-\"+value, length):value;\n    }\n    var option = DomUtil.create('li');\n    if ( chapter.href ) {\n      var anchor = DomUtil.create('a', null, option);\n      anchor.textContent = chapter.label;\n      // var tab = pad('', tabindex); tab = tab.length ? tab + ' ' : '';\n      // option.textContent = tab + chapter.label;\n      anchor.setAttribute('href', chapter.href);\n      anchor.setAttribute('data-href', chapter.href);\n    } else {\n      var span = DomUtil.create('span', null, option);\n      span.textContent = chapter.label;\n    }\n\n    if ( parent.tagName == 'LI' ) {\n      // need to nest\n      var tmp = parent.querySelector('ul');\n      if ( ! tmp ) {\n        tmp = DomUtil.create('ul', null, parent);\n      }\n      parent = tmp;\n    }\n\n    parent.appendChild(option);\n    return option;\n  },\n\n  _setupSkipLink: function() {\n    if ( ! this.options.skipLink ) { return; }\n      \n    var target = document.querySelector(this.options.skipLink);\n    if ( ! target ) { return; }\n\n    var link = document.createElement('a');\n    link.textContent = 'Skip to contents';\n    link.setAttribute('href', '#action-' + this._id);\n\n    var ul = target.querySelector('ul');\n    if ( ul ) {\n      // add to list\n      target = document.createElement('li');\n      ul.appendChild(target);\n    }\n    target.appendChild(link);\n    link.addEventListener('click', function(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      this._control.click();\n    }.bind(this))\n\n  },\n\n  EOT: true\n});\n\nexport var contents = function(options) {\n  return new Contents(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var Title = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    var h1 = DomUtil.create('h1', 'cozy-h1', container);\n    DomUtil.setOpacity(h1, 0);\n    this._title = DomUtil.create('span', 'cozy-title', h1);\n    this._divider = DomUtil.create('span', 'cozy-divider', h1);\n    this._divider.textContent = \" · \";\n    this._section = DomUtil.create('span', 'cozy-section', h1);\n\n    // --- TODO: disable until we can work out how to \n    // --- more reliably match the current section to the contents\n    // this._reader.on('updateSection', function(data) {\n    //   if ( data && data.label ) {\n    //     self._section.textContent = data.label;\n    //     DomUtil.setOpacity(self._section, 1.0);\n    //     DomUtil.setOpacity(self._divider, 1.0);\n    //   } else {\n    //     DomUtil.setOpacity(self._section, 0);\n    //     DomUtil.setOpacity(self._divider, 0);\n    //   }\n    // })\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._title.textContent = data.title || data.bookTitle;\n        DomUtil.setOpacity(self._section, 0);\n        DomUtil.setOpacity(self._divider, 0);\n        DomUtil.setOpacity(h1, 1);\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var title = function(options) {\n  return new Title(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var PublicationMetadata = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    this._publisher = DomUtil.create('div', 'cozy-publisher', container);\n    this._rights = DomUtil.create('div', 'cozy-rights', container);\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._publisher.textContent = data.publisher;\n        self._rights.textContent = data.rights;\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var publicationMetadata = function(options) {\n  return new PublicationMetadata(options);\n}\n","import {Class} from '../core/Class';\nimport {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as Util from '../core/Util';\n\nimport assign from 'lodash/assign';\nimport keys from 'lodash/keys';\n\nexport var Preferences = Control.extend({\n  options: {\n    label: 'Preferences',\n    hasThemes: false,\n    html: '<i class=\"icon-cog oi\" data-glyph=\"cog\" title=\"Preferences and Settings\" aria-hidden=\"true\"></i>'\n  },\n\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className('preferences'),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    this._activated = false;\n    this._control = this._createButton(options.html || options.label, options.label,\n            className, container, this._action)\n\n    // self.initializeForm();\n    this._modal = this._reader.modal({\n      // template: '<form></form>',\n      title: 'Preferences',\n      className: 'cozy-modal-preferences',\n      actions: [\n        {\n          label: 'Save Changes',\n          callback: function(event) {\n            self.updatePreferences(event);\n          }\n        }\n      ],\n      region: 'right'\n    });\n\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self.initializeForm();\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n    if ( this._modal._container.querySelector('form') ) { return; }\n\n    var template = '';\n\n    var possible_fieldsets = [];\n    if ( this._reader.metadata.layout == 'pre-paginated' ) {\n      // different panel\n      possible_fieldsets.push('Scale');\n    } else {\n      possible_fieldsets.push('TextSize');\n    }\n    possible_fieldsets.push('Display');\n\n    if ( this._reader.rootfiles && this._reader.rootfiles.length > 1 ) {\n      // this.options.hasPackagePaths = true;\n      possible_fieldsets.push('Rendition');\n    }\n\n    if ( this._reader.options.themes && this._reader.options.themes.length > 0 ) {\n      this.options.hasThemes = true;\n      possible_fieldsets.push('Theme');\n    }\n\n    this._fieldsets = [];\n    possible_fieldsets.forEach(function(cls) {\n      var fieldset = new Preferences.fieldset[cls](this);\n      template += fieldset.template();\n      this._fieldsets.push(fieldset);\n    }.bind(this))\n\n    if ( this.options.fields ) {\n      this.options.hasFields = true;\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        template += `<fieldset class=\"custom-field\">\n          <legend>${field.label}</legend>\n        `;\n        for(var j in field.inputs) {\n          var input = field.inputs[j];\n          var checked = input.value == field.value ? ' checked=\"checked\"' : '';\n          template += `<label><input id=\"preferences-custom-${i}-${j}\" type=\"radio\" name=\"x${field.name}\" value=\"${input.value}\" ${checked}/>${input.label}</label>`;\n        }\n        if ( field.hint ) {\n          template += `<p class=\"hint\" style=\"font-size: 90%\">${field.hint}</p>`;\n        }\n      }\n    }\n\n    template = '<form>' + template + '</form>';\n\n    // this._modal = this._reader.modal({\n    //   template: template,\n    //   title: 'Preferences',\n    //   className: 'cozy-modal-preferences',\n    //   actions: [\n    //     {\n    //       label: 'Save Changes',\n    //       callback: function(event) {\n    //         self.updatePreferences(event);\n    //       }\n    //     }\n    //   ],\n    //   region: 'right'\n    // });\n\n    this._modal._container.querySelector('main').innerHTML = template;\n    this._form = this._modal._container.querySelector('form');\n  },\n\n  initializeForm: function() {\n    this._createPanel();\n    this._fieldsets.forEach(function(fieldset) {\n      fieldset.initializeForm(this._form);\n    }.bind(this));\n  },\n\n  updatePreferences: function(event) {\n    event.preventDefault();\n\n    var doUpdate = false;\n    var new_options = {};\n    var saveable_options = {};\n    this._fieldsets.forEach(function(fieldset) {\n      // doUpdate = doUpdate || fieldset.updateForm(this._form, new_options);\n      // assign(new_options, fieldset.updateForm(this._form));\n      fieldset.updateForm(this._form, new_options, saveable_options);\n    }.bind(this));\n\n    if ( this.options.hasFields ) {\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        var input = this._form.querySelector(`input[name=\"x${field.name}\"]:checked`);\n        if ( input.value != field.value ) {\n          field.value = input.value;\n          field.callback(field.value);\n        }\n      }\n    }\n\n    this._modal.deactivate();\n\n    setTimeout(function() {\n      this._reader.saveOptions(saveable_options);\n      this._reader.reopen(new_options);\n    }.bind(this), 100);\n  },\n\n  EOT: true\n});\n\nPreferences.fieldset = {};\n\nvar Fieldset = Class.extend({\n\n  options: {},\n\n  initialize: function (control, options) {\n      Util.setOptions(this, options);\n      this._control = control;\n      this._current = {};\n      this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n  },\n\n  template: function() {\n\n  },\n\n  EOT: true\n\n\n});\n\nPreferences.fieldset.TextSize = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var text_size = this._control._reader.options.text_size || 100;\n    if ( text_size == 'auto' ) { text_size = 100; }\n    this._current.text_size = text_size;\n    this._input.value = text_size;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.text_size = saveable.text_size = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Text Size</legend>\n        <div class=\"preview--text_size\" id=\"x${this._id}-preview\">\n          ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span>T-</span>\n          <input name=\"text_size\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span>T+</span>\n        </p>\n        <p>\n          <span>Text Size: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.fontSize = `${( parseInt(this._input.value, 10) / 100 )}em`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Display = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var flow = this._control._reader.options.flow || this._control._reader.metadata.flow || 'auto';\n    // if ( flow == 'auto' ) { flow = 'paginated'; }\n\n    var input = form.querySelector(`#x${this._id}-input-${flow}`);\n    input.checked = true;\n    this._current.flow = flow;\n\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-flow\"]:checked`);\n    options.flow = input.value;\n    if ( options.flow != 'auto' ) {\n      saveable.flow = options.flow;\n    }\n    // if ( input.value == 'auto' ) {\n    //   // we do NOT want to save flow as a preference\n    //   return {};\n    // }\n    // return { flow: input.value };\n  },\n\n  template: function() {\n    var scrolled_help = '';\n    if ( this._control._reader.metadata.layout != 'pre-paginated' ) {\n      scrolled_help = \"<br /><small>This is an experimental feature that may cause display and loading issues for the book when enabled.</small>\";\n    }\n    return `<fieldset>\n            <legend>Display</legend>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-auto\" value=\"auto\" /> Auto<br /><small>Let the reader determine display mode based on your browser dimensions and the type of content you're reading</small></label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-paginated\" value=\"paginated\" /> Page-by-Page</label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-scrolled-doc\" value=\"scrolled-doc\" /> Scroll${scrolled_help}</label>\n          </fieldset>`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Theme = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var theme = this._control._reader.options.theme || 'default';\n\n    var input = form.querySelector(`#x${this._id}-input-theme-${theme}`);\n    input.checked = true;\n    this._current.theme = theme;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-theme\"]:checked`);\n    options.theme = saveable.theme = input.value;\n    // return { theme: input.value };\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Theme</legend>\n            <label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-default\" value=\"default\" />Default</label>`;\n\n    this._control._reader.options.themes.forEach(function(theme) {\n      template += `<label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-${theme.klass}\" value=\"${theme.klass}\" />${theme.name}</label>`\n    }.bind(this));\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Rendition = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var rootfiles = this._control._reader.rootfiles;\n    var rootfilePath = this._control._reader.options.rootfilePath;\n    var expr = rootfilePath ? `[value=\"${rootfilePath}\"]` : \":first-child\";\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]${expr}`);\n    input.checked = true;\n    this._current.rootfilePath = rootfilePath || rootfiles[0].rootfilePath;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]:checked`);\n    if ( input.value != this._current.rootfilePath ) {\n      options.rootfilePath = input.value;\n      this._current.rootfilePath = input.value;\n    }\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Rendition</legend>\n    `;\n\n    this._control._reader.rootfiles.forEach(function(rootfile, i) {\n      template += `<label><input name=\"x${this._id}-rootfilePath\" type=\"radio\" id=\"x${this._id}-input-rootfilePath-${i}\" value=\"${rootfile.rootfilePath}\" />${rootfile.label || rootfile.accessMode || rootfile.rootfilePath}</label>`;\n    }.bind(this))\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Scale = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview > div`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var scale = this._control._reader.options.scale || 100;\n    if ( ! scale ) { scale = 100; }\n    this._current.scale = scale;\n    this._input.value = scale;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.scale = saveable.scale = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Zoom In/Out</legend>\n        <div class=\"preview--scale\" id=\"x${this._id}-preview\" style=\"overflow: hidden; height: 5rem\">\n          <div>\n            ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n          </div>\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span style=\"font-size: 150%\">⊖<span class=\"u-screenreader\"> Zoom Out</span></span>\n          <input name=\"scale\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span style=\"font-size: 150%\">⊕<span class=\"u-screenreader\">Zoom In </span></span>\n        </p>\n        <p>\n          <span>Scale: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.transform = `scale(${( parseInt(this._input.value, 10) / 100 )}) translate(0,0)`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nexport var preferences = function(options) {\n  return new Preferences(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Widget = Control.extend({\n\n\n  options: {\n      // @option region: String = 'topright'\n      // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n      // `'topright'`, `'bottomleft'` or `'bottomright'`\n  },\n\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      // NOOP\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n\n    }\n\n    this._onAddExtra(container);\n    this._updateTemplate(container);\n    this._updateClass(container);\n    this._bindEvents(container);\n\n    return container;\n  },\n\n  _updateTemplate: function(container) {\n    var data = this.data();\n    for(var slot in data) {\n      if ( data.hasOwnProperty(slot) ) {\n        var value = data[slot];\n        if ( typeof(value) == \"function\" ) { value = value(); }\n        var node = container.querySelector(`[data-slot=${slot}]`);\n        if ( node ) {\n          if ( node.hasAttribute('value') ) {\n            node.setAttribute('value', value);\n          } else {\n            node.innerHTML = value;\n          }\n        }\n      }\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this.options.className ) {\n      DomUtil.addClass(container, this.options.className);\n    }\n  },\n\n  _onAddExtra: function() { },\n\n  _bindEvents: function(container) {\n    var control = container.querySelector(\"[data-toggle=button]\");\n    if ( ! control ) { return ; }\n    DomEvent.disableClickPropagation(control);\n    DomEvent.on(control, 'click', DomEvent.stop);\n    DomEvent.on(control, 'click', this._action, this);\n  },\n\n  _action: function() {\n  },\n\n  data: function() {\n    return this.options.data || {};\n  },\n\n  EOT: true\n});\n\nWidget.Button = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _action: function() {\n    this.options.onClick(this, this._reader);\n  },\n\n  EOT: true\n});\n\nWidget.Panel = Widget.extend({\n  defaultTemplate: `<div><span data-slot=\"text\"></span></div>`,\n\n\n  EOT: true\n});\n\nWidget.Toggle = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _onAddExtra: function(container) {\n    this.state(this.options.states[0].stateName, container);\n\n    return container;\n  },\n\n  state: function(stateName, container) {\n    container = container || this._container;\n    this._resetState(container);\n    this._state = this.options.states.filter(function(s) { return s.stateName == stateName })[0];\n    this._updateClass(container);\n    this._updateTemplate(container);\n  },\n\n  _resetState: function(container) {\n    if ( ! this._state ) { return; }\n    if ( this._state.className ) {\n      DomUtil.removeClass(container, this._state.className);\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this._state.className ) {\n      DomUtil.addClass(container, this._state.className);\n    }\n  },\n\n  _action: function() {\n    this._state.onClick(this, this._reader);\n  },\n\n  data: function() {\n    return this._state.data || {};\n  },\n\n  EOT: true\n});\n\n// export var widget = function(options) {\n//   return new Widget(options);\n// }\n\nexport var widget = {\n  button: function(options) { return new Widget.Button(options); },\n  panel: function(options) { return new Widget.Panel(options); },\n  toggle: function(options) { return new Widget.Toggle(options); }\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Citation = Control.extend({\n  options: {\n    label: 'Citation',\n    html: '<span class=\"citation\" aria-label=\"Get Citation\"></span>'\n  },\n\n  defaultTemplate: '<button class=\"button--sm cozy-citation citation\" data-toggle=\"open\" aria-label=\"Get Citation\"></button>',\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Select Citation Format</legend>\n      </fieldset>\n    </form>\n    <blockquote id=\"formatted\" style=\"padding: 8px; border-left: 4px solid black; background-color: #fff\"></blockquote>\n    <div class=\"alert alert-info\" id=\"message\" style=\"display: none\"></div>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Copy Citation to Clipboard',\n      className: 'cozy-modal-citatation',\n      actions: [\n        {\n          label: 'Copy Citation',\n          callback: function(event) {\n            document.designMode = \"on\";\n            var formatted = self._modal._container.querySelector(\"#formatted\");\n\n            var range = document.createRange();\n            range.selectNode(formatted);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // formatted.select();\n\n            try {\n              var flag = document.execCommand('copy');\n            } catch(err) {\n              console.log(\"AHOY COPY FAILED\", err);\n            }\n\n            self._message.innerHTML = 'Success! Citation copied to your clipboard.';\n            self._message.style.display = 'block';\n            sel.removeAllRanges();\n            range.detach();\n            document.designMode = \"off\";\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    var fieldset = this._form.querySelector('fieldset');\n\n    var citations = this.options.citations || this._reader.metadata.citations;\n\n    citations.forEach(function(citation, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', citation.format);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = document.createTextNode(\" \" + citation.format);\n      label.appendChild(text);\n      input.setAttribute('data-text', citation.text);\n    });\n\n    this._formatted = this._modal._container.querySelector(\"#formatted\");\n    this._message = this._modal._container.querySelector(\"#message\");\n    DomEvent.on(this._form, 'change', function(event) {\n      var target = event.target;\n      if ( target.tagName == 'INPUT' ) {\n        this._initializeForm();\n      }\n    }, this);\n\n    this._initializeForm();\n  },\n\n  _initializeForm: function() {\n    var formatted = this._formatCitation();\n    this._formatted.innerHTML = formatted;\n    this._message.style.display = 'none';\n    this._message.innerHTML = '';\n  },\n\n  _formatCitation: function(format) {\n    if ( format == null ) {\n      var selected = this._form.querySelector(\"input:checked\");\n      format = selected.value;\n    }\n    var selected = this._form.querySelector(\"input[value=\" + format + \"]\");\n    return selected.getAttribute('data-text');\n    // return selected.dataset.text;\n  },\n\n  EOT: true\n});\n\nexport var citation = function(options) {\n  return new Citation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Search = Control.extend({\n  options: {\n    label: 'Search',\n    html: '<span>Search</span>'\n  },\n\n  defaultTemplate: `<form class=\"search\">\n    <label class=\"u-screenreader\" for=\"cozy-search-string\">Search in this text</label>\n    <input id=\"cozy-search-string\" name=\"search\" type=\"text\" placeholder=\"Search in this text...\"/>\n    <button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Search\"><i class=\"icon-magnifying-glass oi\" data-glyph=\"magnifying-glass\" title=\"Search\" aria-hidden=\"true\"></i></button>\n  </form>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    container.style.position = 'relative';\n\n    this._data = null;\n    this._canceled = false;\n    this._processing = false;\n\n    this._reader.on('ready', function() {\n\n      this._modal = this._reader.modal({\n        template: '<article></article>',\n        title: 'Search Results',\n        className: { container: 'cozy-modal-search' },\n        region: 'left',\n      });\n\n      this._modal.callbacks.onClose = function() {\n        if ( self._processing ) {\n          self._canceled = true;\n        }\n      };\n\n      this._article = this._modal._container.querySelector('article');\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('href');\n        this._reader.tracking.action('search/go');\n        this._reader.gotoPage(target);\n        return true;\n      }.bind(this));\n\n      this._modal.on('closed', function() {\n        this._reader.tracking.action('contents/close');\n      }.bind(this))\n\n    }.bind(this));\n\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n\n      var searchString = this._container.querySelector(\"#cozy-search-string\").value;\n      searchString = searchString.replace(/^\\s*/, '').replace(/\\s*$/, '');\n\n      if ( ! searchString ) {\n        // just punt\n        return;\n      }\n\n      if ( searchString == this.searchString ) {\n        // cached results\n        self.openModalResults();\n      } else {\n        this.searchString = searchString;\n        self.openModalWaiting();\n        self.submitQuery();\n      }\n    }, this);\n\n    return container;\n  },\n\n  openModalWaiting: function() {\n    this._processing = true;\n    this._emptyArticle();\n    var value = this.searchString;\n    this._article.innerHTML = '<p>Submitting query for <em>' + value + '</em>...</p>' + this._reader.loaderTemplate();\n    this._modal.activate();\n  },\n\n  openModalResults: function() {\n    if ( this._canceled ) {\n      this._canceled = false;\n      return;\n    }\n    this._buildResults();\n    this._modal.activate();\n    this._reader.tracking.action(\"search/open\");\n  },\n\n  submitQuery: function() {\n    var self = this;\n\n    var url = this.options.searchUrl + this.searchString;\n\n    var request = new XMLHttpRequest();\n    request.open('GET', url, true);\n\n    request.onload = function() {\n      if (this.status >= 200 && this.status < 400) {\n        // Success!\n        var data = JSON.parse(this.response);\n        console.log(\"SEARCH DATA\", data);\n\n        self._data = data;\n\n      } else {\n        // We reached our target server, but it returned an error\n\n        self._data = null;\n        console.log(this.response);\n      }\n\n      self._reader.tracking.action(\"search/submitQuery\");\n      self.openModalResults();\n\n    };\n\n    request.onerror = function() {\n      // There was a connection error of some sort\n      self._data = null;\n      self.openModalResults();\n    };\n\n    request.send();\n\n  },\n\n  _emptyArticle: function() {\n    while (this._article && this._article.hasChildNodes()) {\n      this._article.removeChild(this._article.lastChild);\n    }\n  },\n\n  _buildResults: function() {\n    var self = this;\n    var content;\n\n    this._processing = false;\n\n    self._emptyArticle();\n\n    var reader = this._reader;\n    reader.annotations.reset();\n\n    if ( this._data ) {\n      var highlight = true\n      if (this._data.highlight_off == \"yes\") {\n        highlight = false;\n      }\n      if ( this._data.search_results.length ) {\n        content = DomUtil.create('ul');\n\n        this._data.search_results.forEach(function(result) {\n          var option = DomUtil.create('li');\n          var anchor = DomUtil.create('a', null, option);\n          var cfiRange = \"epubcfi(\" + result.cfi + \")\";\n\n          if (result.snippet) {\n            if (result.title) {\n              var chapterTitle = DomUtil.create('i');\n              chapterTitle.textContent = result.title + \": \";\n              anchor.appendChild(chapterTitle);\n            }\n            anchor.appendChild(document.createTextNode(result.snippet));\n\n            anchor.setAttribute(\"href\", cfiRange);\n            content.appendChild(option);\n          }\n          if (highlight) {\n            reader.annotations.highlight(cfiRange);\n          }\n        });\n      } else {\n        content = DomUtil.create(\"p\")\n        content.textContent = 'No results found for \"' + self.searchString + '\"';\n      }\n    } else {\n      content = DomUtil.create(\"p\")\n      content.textContent = 'There was a problem processing this query.';\n    }\n\n    self._article.appendChild(content);\n  },\n\n  EOT: true\n});\n\nexport var search = function(options) {\n  return new Search(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var BibliographicInformation = Control.extend({\n  options: {\n    label: 'Info',\n    direction: 'left',\n    html: '<span class=\"oi\" data-glyph=\"info\">Info</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-bib-info oi\" data-glyph=\"info\" data-toggle=\"open\" aria-label=\"Bibliographic Information\"> Info</button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<dl>\n    </dl>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Info',\n      region: 'left',\n      fraction: 1.0\n    });\n\n    var dl = this._modal._container.querySelector('dl');\n\n    var metadata_fields = [\n      [ 'title', 'Title' ],\n      [ 'creator', 'Author' ],\n      [ 'pubdate', 'Publication Date' ],\n      [ 'modified_date', 'Modified Date' ],\n      [ 'publisher', 'Publisher' ],\n      [ 'rights', 'Rights' ],\n      [ 'doi', 'DOI' ],\n      [ 'description', 'Description' ],\n    ];\n\n    var metadata_fields_seen = {};\n\n    var metadata = this._reader.metadata;\n\n    for(var idx in metadata_fields) {\n      var key = metadata_fields[idx][0];\n      var label = metadata_fields[idx][1];\n      if ( metadata[key] ) {\n        var value = metadata[key];\n        if ( key == 'pubdate' || key == 'modified_date' ) {\n          value = this._formatDate(value);\n          if ( ! value ) { continue; }\n          // value = d.toISOString().slice(0,10); // for YYYY-MM-DD\n        }\n        metadata_fields_seen[key] = true;\n        var dt = DomUtil.create('dt', 'cozy-bib-info-label', dl);\n        dt.innerHTML = label;\n        var dd = DomUtil.create('dd', 'cozy-bib-info-value cozy-bib-info-value-' + key, dl);\n        dd.innerHTML = value;\n      }\n    }\n\n  },\n\n  _formatDate: function(value) {\n    var match = value.match(/\\d{4}/);\n    if ( match ) {\n      return match[0];\n    }\n    return null;\n  },\n\n  EOT: true\n});\n\nexport var bibliographicInformation = function(options) {\n  return new BibliographicInformation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Download = Control.extend({\n  options: {\n    label: 'Download Book',\n    html: '<span>Download Book</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-download oi\" data-toggle=\"open\" data-glyph=\"data-transfer-download\"> Download Book</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Choose File Format</legend>\n      </fieldset>\n    </form>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Download Book',\n      className: 'cozy-modal-download',\n      actions: [\n        {\n          label: 'Download',\n          callback: function(event) {\n            var selected = self._form.querySelector(\"input:checked\");\n            var href = selected.getAttribute('data-href');\n            self._configureDownloadForm(href);\n            self._form.submit();\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');    \n    var fieldset = this._form.querySelector('fieldset');\n    this._reader.options.download_links.forEach(function(link, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', link.format);\n      input.setAttribute('data-href', link.href);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = link.format;\n      if ( link.size ) {\n        text += \" (\" + link.size + \")\";\n      }\n      var text = document.createTextNode(\" \" + text);\n      label.appendChild(text);\n    });\n\n  },\n\n  _configureDownloadForm: function(href) {\n    var self = this;\n    self._form.setAttribute('method', 'GET');\n    self._form.setAttribute('action', href);\n    self._form.setAttribute('target', '_blank');\n  },\n\n\n  EOT: true\n});\n\nexport var download = function(options) {\n  return new Download(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Navigator = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n    } else {\n\n      var className = this._className('navigator'),\n          options = this.options;\n      \n      container = DomUtil.create('div', className);\n    }\n    this._setup(container);\n\n    this._reader.on('updateLocations', function(locations) {      \n      // if ( ! this._reader.currentLocation() || ! this._reader.currentLocation().start ) {\n      //   console.log(\"AHOY updateLocations NO START\", this._reader.currentLocation().then);\n      //   setTimeout(function() {\n      //     this._initializeNavigator(locations);\n      //   }.bind(this), 100);\n      //   return;\n      // }\n      this._initializeNavigator(locations);\n    }.bind(this));\n\n    return container;\n  },\n\n  _setup: function(container) {\n    this._control = container.querySelector(\"input[type=range]\");\n    if ( ! this._control ) {\n      this._createControl(container);\n    }\n    this._background = container.querySelector(\".cozy-navigator-range__background\");\n    this._status = container.querySelector(\".cozy-navigator-range__status\");\n    this._spanCurrentPercentage = container.querySelector(\".currentPercentage\");\n    this._spanCurrentLocation = container.querySelector(\".currentLocation\");\n    this._spanTotalLocations = container.querySelector(\".totalLocations\");\n\n    this._bindEvents();\n  },\n\n  _createControl: function (container) {\n    var template = `<div class=\"cozy-navigator-range\">\n        <label class=\"u-screenreader\" for=\"cozy-navigator-range-input\">Location: </label>\n        <input class=\"cozy-navigator-range__input\" id=\"cozy-navigator-range-input\" type=\"range\" name=\"locations-range-value\" min=\"0\" max=\"100\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\" aria-valuetext=\"0% • Location 0 of ?\" value=\"0\" data-background-position=\"0\" />\n        <div class=\"cozy-navigator-range__background\"></div>\n      </div>\n      <div class=\"cozy-navigator-range__status\"><span class=\"currentPercentage\">0%</span> • Location <span class=\"currentLocation\">0</span> of <span class=\"totalLocations\">?</span></div>\n    `;\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      container.appendChild(body.children[0]);\n    }\n\n    this._control = container.querySelector(\"input[type=range]\");\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    this._control.addEventListener(\"input\", function() {\n      self._update();\n    }, false);\n    this._control.addEventListener(\"change\", function() { self._action(); }, false);\n    this._control.addEventListener(\"mousedown\", function(){\n        self._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"mouseup\", function(){\n        self._mouseDown = false;\n    }, false);\n    this._control.addEventListener(\"keydown\", function(){\n      self._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"keyup\", function(){\n      self._mouseDown = false;\n    }, false);\n\n    this._reader.on('relocated', function(location) {\n      if ( ! self._initiated ) { return; }\n      if ( ! self._mouseDown ) {\n        self._control.value = Math.ceil(self._reader.locations.percentageFromCfi(self._reader.currentLocation().start.cfi) * 100);\n        self._update();\n      }\n    })\n\n  },\n\n  _action: function() {\n    var value = this._control.value;\n    var locations = this._reader.locations;\n    var cfi = locations.cfiFromPercentage(value / 100);\n    this._reader.tracking.action(\"navigator/go\");\n    this._reader.gotoPage(cfi);\n  },\n\n  _update: function() {\n    var self = this;\n\n    var current = this._reader.currentLocation();\n    if ( ! current || ! current.start ) {\n      setTimeout(function() {\n        this._update();\n      }.bind(this), 100);\n    }\n\n    var rangeBg = this._background;\n    var range = self._control;\n\n    var value = parseInt(range.value, 10);\n    var percentage = value;\n\n    rangeBg.setAttribute('style', 'background-position: ' + (-percentage) + '% 0%, left top;');\n    self._control.setAttribute('data-background-position', Math.ceil(percentage));\n\n    this._spanCurrentPercentage.innerHTML = percentage + '%';\n    if ( current && current.start ) {\n      var current_location = this._reader.locations.locationFromCfi(current.start.cfi);\n      this._spanCurrentLocation.innerHTML = ( current_location );\n    }\n    self._last_delta = self._last_value > value; self._last_value = value;\n  },\n\n  _initializeNavigator: function(locations) {\n    console.log(\"AHOY updateLocations PROCESSING LOCATION\");\n    this._initiated = true;\n    this._total = this._reader.locations.total;\n    if ( this._reader.currentLocation() && this._reader.currentLocation().start ) {\n      this._control.value = Math.ceil(this._reader.locations.percentageFromCfi(this._reader.currentLocation().start.cfi) * 100);\n      this._last_value = this._control.value;\n    } else {\n      this._last_value = this._control.value;\n    }\n\n    this._spanTotalLocations.innerHTML = this._total;\n\n    this._update();\n    setTimeout(function() {\n      DomUtil.addClass(this._container, 'initialized');\n    }.bind(this), 0);\n  },\n\n  EOT: true\n});\n\nexport var navigator = function(options) {\n  return new Navigator(options);\n}\n","import {Control, control} from './Control';\nimport {PageNext, PagePrevious, pageNext, pagePrevious, PageFirst, pageFirst, PageLast, pageLast} from './Control.Paging';\nimport {Contents, contents} from './Control.Contents';\nimport {Title, title} from './Control.Title';\nimport {PublicationMetadata, publicationMetadata} from './Control.PublicationMetadata';\nimport {Preferences, preferences} from './Control.Preferences';\nimport {Widget, widget} from './Control.Widget';\nimport {Citation, citation} from './Control.Citation';\nimport {Search, search} from './Control.Search';\nimport {BibliographicInformation, bibliographicInformation} from './Control.BibliographicInformation';\nimport {Download, download} from './Control.Download';\nimport {Navigator, navigator} from './Control.Navigator';\n\n// import {Zoom, zoom} from './Control.Zoom';\n// import {Attribution, attribution} from './Control.Attribution';\n\nControl.PageNext = PageNext;\nControl.PagePrevious = PagePrevious;\nControl.PageFirst = PageFirst;\nControl.PageLast = PageLast;\ncontrol.pagePrevious = pagePrevious;\ncontrol.pageNext = pageNext;\ncontrol.pageFirst = pageFirst;\ncontrol.pageLast = pageLast;\n\nControl.Contents = Contents;\ncontrol.contents = contents;\n\nControl.Title = Title;\ncontrol.title = title;\n\nControl.PublicationMetadata = PublicationMetadata;\ncontrol.publicationMetadata = publicationMetadata;\n\nControl.Preferences = Preferences;\ncontrol.preferences = preferences;\n\nControl.Widget = Widget;\ncontrol.widget = widget;\n\nControl.Citation = Citation;\ncontrol.citation = citation;\n\nControl.Search = Search;\ncontrol.search = search;\n\nControl.BibliographicInformation = BibliographicInformation;\ncontrol.bibliographicInformation = bibliographicInformation;\n\nControl.Download = Download;\ncontrol.download = download;\n\nControl.Navigator = Navigator;\ncontrol.navigator = navigator;\n\nexport {Control, control};\n","import {Evented} from './Events';\n\nvar Bus = Evented.extend({\n});\n\nvar instance;\nexport var bus = function() {\n  return instance || ( instance = new Bus() );\n}\n","import * as Browser from './Browser';\nexport {Browser};\n\nexport {Class} from './Class';\n\nimport {Evented} from './Events';\nexport {Evented};\nexport var Mixin = {Events: Evented.prototype};\n\nimport * as Util from './Util';\nexport {Util};\nexport {extend, bind, stamp, setOptions} from './Util';\nexport {bus} from './Bus';\n","\n// var ePub = window.ePub;\n// export {ePub};\n\nexport function ePub(href, options) {\n\tif ( window.require !== undefined ) {\n\t\twindow.ePub = require(\"ePub\");\n\t}\n  return window.ePub(href, options);\n}\n","'use strict';\n\nif (!process) {\n  var process = {\n    \"cwd\" : function () { return '/' }\n  };\n}\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as epubjs from '../epubjs';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as Browser from '../core/Browser';\n\nimport path from \"path-webpack\";\n\nReader.EpubJS = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n    this._epubjs_ready = false;\n    window.xpath = path;\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    if ( typeof(target) == 'function' ) {\n      callback = target;\n      target = undefined;\n    }\n    if ( callback == null ) {\n      callback = function() { };\n    }\n\n    self.rootfiles = [];\n\n    this.options.rootfilePath = this.options.rootfilePath || sessionStorage.getItem('rootfilePath');\n\n    var book_href = this.options.href;\n    var book_options = { packagePath: this.options.rootfilePath };\n    if ( this.options.useArchive ) {\n      book_href = book_href.replace(/\\/(\\w+)\\/$/, '/$1/$1.sm.epub');\n      book_options.openAs = 'epub';\n    }\n    this._book = epubjs.ePub(book_href, book_options);\n    sessionStorage.removeItem('rootfilePath');\n\n    this._book.loaded.navigation.then(function(toc) {\n      self._contents = toc;\n      self.metadata = self._book.package.metadata;\n      self.fire('updateContents', toc);\n      self.fire('updateTitle', self._book.package.metadata);\n    })\n    this._book.ready.then(function() {\n      self.parseRootfiles();\n\n      self.draw(target, callback);\n\n      if ( self.metadata.layout == 'pre-paginated' ) {\n        // fake it with the spine\n        var locations = [];\n        self._book.spine.each(function(item) {\n          locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n          self.locations._locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n        });\n        self.locations.total = locations.length;\n        var t;\n        var f = function() {\n          if ( self._rendition && self._rendition.manager && self._rendition.manager.stage ) {\n            var location = self._rendition.currentLocation();\n            if ( location && location.start) {\n              self.fire('updateLocations', locations);\n              clearTimeout(t);\n              return;\n            }\n          }\n          t = setTimeout(f, 100);\n        }\n\n        t = setTimeout(f, 100);\n      } else {\n        self._book.locations.generate(1600).then(function(locations) {\n          // console.log(\"AHOY WUT\", locations);\n          self.fire('updateLocations', locations);\n        })\n      }\n    })\n    // .then(callback);\n  },\n\n  parseRootfiles: function() {\n    var self = this;\n    self._book.load(self._book.url.resolve(\"META-INF/container.xml\")).then(function(containerDoc) {\n        var rootfiles = containerDoc.querySelectorAll(\"rootfile\");\n        if ( rootfiles.length > 1 ) {\n          console.log(\"AHOY ROOTFILES MULTIPLE RENDITIONS\", rootfiles.length);\n          for(var i = 0; i < rootfiles.length; i++) {\n            var rootfile = rootfiles[i];\n            var rootfilePath = rootfile.getAttribute('full-path');\n            var label = rootfile.getAttribute('rendition:label');\n            var layout = rootfile.getAttribute('rendition:layout');\n            self.rootfiles.push({\n              rootfilePath: rootfilePath,\n              label: label,\n              layout: layout\n            })\n          }\n        }\n    })\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n\n    if ( self._rendition ) {\n      // self._unbindEvents();\n      var container = self._rendition.manager.container;\n      Object.keys(self._rendition.hooks).forEach(function(key) {\n        console.log(\"AHOY draw clearing\", key);\n        self._rendition.hooks[key].clear();\n      })\n      self._rendition.destroy();\n      self._rendition = null;\n    }\n\n    this.settings = { flow: this.options.flow };\n    this.settings.manager = this.options.manager || 'default';\n\n    if ( this.settings.flow == 'auto' && this.metadata.layout == 'pre-paginated' ) {\n      // dumb check to see if the window is _tall_ enough to put\n      // two pages side by side\n      if ( this._container.offsetHeight <= this.options.forceScrolledDocHeight ) {\n        this.settings.flow = 'scrolled-doc';\n        this.settings.manager = 'prepaginated';\n      }\n    }\n\n    if ( this.settings.flow == 'auto' || this.settings.flow == 'paginated' ) {\n      this._panes['epub'].style.overflow = this.metadata.layout == 'pre-paginated' ? 'auto' : 'hidden';\n      this.settings.manager = 'default';\n    } else {\n      this._panes['epub'].style.overflow = 'auto';\n      if ( this.settings.manager == 'default' ) {\n        this.settings.manager = 'continuous';\n      }\n    }\n\n    if ( ! callback ) {\n      callback = function() { };\n    }\n\n    if ( this.metadata.layout == 'pre-paginated' && this.settings.manager == 'continuous' ) {\n        this.settings.manager = 'prepaginated';\n    }\n\n    if ( this.settings.manager == 'prepaginated' ) {\n      this.settings.spread = 'none';\n    }\n\n    // would pre-paginated work better if we scaled the default view from the start? maybe?\n    if ( false && this.metadata.layout == 'pre-paginated' && this.settings.manager == 'default' ) {\n      this.settings.spread = 'none';\n      this._panes['epub'].style.overflow = 'auto';\n    }\n\n    self.settings.height = '100%';\n    self.settings.width = '100%';\n    self.settings['ignoreClass'] = 'annotator-hl';\n\n    if ( self.options.scale != '100' ) {\n      self.settings.scale = parseInt(self.options.scale, 10) / 100;\n    }\n\n    self._panes['book'].dataset.manager = this.settings.manager + ( this.settings.spread ? `-${this.settings.spread}` : '');\n    self._panes['book'].dataset.layout = this.metadata.layout || 'reflowable';\n\n    self._drawRendition(target, callback);\n  },\n\n  _drawRendition: function(target, callback) {\n    var self = this;\n\n    self._rendition = self._book.renderTo(self._panes['epub'], self.settings);\n    self._updateFontSize();\n    self._bindEvents();\n    self._drawn = true;\n\n    if ( target && target.start ) { target = target.start; }\n    if ( ! target && window.location.hash ) {\n      if ( window.location.hash.substr(1, 3) == '/6/' ) {\n        target = decodeURIComponent(window.location.hash.substr(1));\n        // if ( target.match(/\\]$/ ) ) {\n        //   // target += '/2';\n        //   target += '/1:0';\n        // }\n        target = \"epubcfi(\" + target + \")\";\n      } else {\n        target = window.location.hash.substr(2);\n        target = self._book.url.path().resolve(target);\n      }\n    }\n\n    var status_index = 0;\n    self._rendition.on('started', function() {\n\n      self._rendition.manager.on(\"building\", function(status) {\n        if ( status ) {\n          status_index += 1;\n          self._panes['loader-status'].innerHTML = `<span>${Math.round((status_index / status.total) * 100.0)}%</span>`;\n        } else {\n          self._enableBookLoader(-1);\n        }\n      })\n      self._rendition.manager.on(\"built\", function() {\n        console.log(\"AHOY manager built\");\n        self._disableBookLoader(true);\n      })\n    })\n\n    self._rendition.hooks.content.register(function(contents) {\n      self.fire('ready:contents', contents);\n      self.fire('readyContents', contents);\n      contents.document.addEventListener('keydown', (event) => {\n        const keyName = event.key;\n        self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey, inner: true });\n        console.log('inner keydown event: ', keyName);\n      });\n    })\n\n    self.gotoPage(target, function() {\n      window._loaded = true;\n      self._initializeReaderStyles();\n\n      if ( callback ) { callback(); }\n\n      self._epubjs_ready = true;\n\n      self.gotoPage(target, function() {\n        setTimeout(function() {\n          self.fire('opened');\n          self.fire('ready');\n          clearTimeout(self._queueTimeout);\n          self.tracking.event(\"openBook\", {\n            rootFilePath: self.options.rootFilePath,\n            flow: self.settings.flow,\n            manager: self.settings.manager\n          });\n        }, 100);\n      })\n\n    })\n  },\n\n  _scroll: function(delta) {\n    var self = this;\n    if ( self.options.flow == 'XXscrolled-doc' ) {\n      var container = self._rendition.manager.container;\n      var rect = container.getBoundingClientRect();\n      var scrollTop = container.scrollTop;\n      var newScrollTop = scrollTop;\n      var scrollBy = ( rect.height * 0.98 );\n      switch(delta) {\n        case 'PREV':\n          newScrollTop = -( scrollTop + scrollBy );\n          break;\n        case 'NEXT':\n          newScrollTop = ( scrollTop + scrollBy );\n          break;\n        case 'HOME':\n          newScrollTop = 0;\n          break;\n        case 'END':\n          newScrollTop = container.scrollHeight - scrollBy;\n          break;\n      }\n      container.scrollTop = newScrollTop;\n      return ( Math.floor(container.scrollTop) != Math.floor(scrollTop) );\n    }\n    return false;\n  },\n\n  _navigate: function(promise, callback) {\n    var self = this;\n    self._enableBookLoader(100);\n    promise.then(function() {\n      console.log(\"AHOY NAVIGATE FIN\");\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n    }).catch(function(e) {\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n      console.log(\"AHOY NAVIGATE ERROR\", e);\n      throw(e);\n    })\n  },\n\n  next: function() {\n    var self = this;\n    this.tracking.action('reader/go/next');\n    self._scroll('NEXT') || self._navigate(this._rendition.next());\n  },\n\n  prev: function() {\n    this.tracking.action('reader/go/previous');\n    this._scroll('PREV') || this._navigate(this._rendition.prev());\n  },\n\n  first: function() {\n    this.tracking.action('reader/go/first');\n    this._navigate(this._rendition.display(0), undefined);\n  },\n\n  last: function() {\n    var self = this;\n    this.tracking.action('reader/go/last');\n    var target = this._book.spine.length - 1;\n    this._navigate(this._rendition.display(target), undefined);\n  },\n\n  gotoPage: function(target, callback) {\n    var hash;\n    if ( target != null ) {\n      var section = this._book.spine.get(target);\n      if ( ! section) {\n        // maybe it needs to be resolved\n        var guessed = target;\n        if ( guessed.indexOf(\"://\") < 0 ) {\n          var path1 = path.resolve(this._book.path.directory, this._book.package.navPath);\n          var path2 = path.resolve(path.dirname(path1), target);\n          guessed = this._book.canonical(path2);\n        }\n        if ( guessed.indexOf(\"#\") !== 0 ) {\n          hash = guessed.split('#')[1];\n          guessed = guessed.split('#')[0];\n        }\n\n        this._book.spine.each(function(item) {\n          if ( item.canonical == guessed ) {\n            section = item;\n            target = section.href;\n            return;\n          }\n        })\n\n        if ( hash ) {\n          target = target + '#' + hash;\n        }\n\n        console.log(\"AHOY GUESSED\", target);\n      } else if ( target.toString().match(/^\\d+$/) ) {\n        console.log(\"AHOY USING\", section.href);\n        target = section.href;\n      }\n\n      if ( ! section ) {\n        if ( ! this._epubjs_ready ) {\n          target = 0;\n        } else {\n          return;\n        }\n      }\n    }\n\n    console.log(\"AHOY gotoPage\", target);\n\n    // this.__hash = hash;\n    var navigating = this._rendition.display(target).then(function() {\n      this._rendition.display(target);\n    }.bind(this));\n    this._navigate(navigating, callback);\n  },\n\n  percentageFromCfi: function(cfi) {\n    return this._book.percentageFromCfi(cfi);\n  },\n\n  destroy: function() {\n    if ( this._rendition ) {\n      try {\n        this._rendition.destroy();\n      } catch(e) {}\n    }\n    this._rendition = null;\n    this._drawn = false;\n  },\n\n  reopen: function(options, target) {\n    // different per reader?\n    var target = target || this.currentLocation();\n    if( target.start ) { target = target.start ; }\n    if ( target.cfi ) { target = target.cfi ; }\n\n    var doUpdate = false;\n    if ( options === true ) { doUpdate = true; options = {}; }\n    var changed = {};\n    Object.keys(options).forEach(function(key) {\n      if ( options[key] != this.options[key] ) {\n        doUpdate = true;\n        changed[key] = true;\n      }\n      // doUpdate = doUpdate || ( options[key] != this.options[key] );\n    }.bind(this));\n\n    if ( ! doUpdate ) {\n      return;\n    }\n\n    // performance hack\n    if ( Object.keys(changed).length == 1 && changed.scale ) {\n      reader.options.scale = options.scale;\n      this._updateScale();\n      return;\n    }\n\n    if ( options.rootfilePath && options.rootfilePath != this.options.rootfilePath ) {\n      // we need to REOPEN THE DANG BOOK\n      sessionStorage.setItem('rootfilePath', options.rootfilePath);\n      location.reload();\n      return;\n    }\n\n    Util.extend(this.options, options);\n\n    this.draw(target, function() {\n      this._updateFontSize();\n      this._updateScale();\n      this._updateTheme();\n      this._selectTheme(true);\n    }.bind(this))\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) {\n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    // add a stylesheet to stop images from breaking their columns\n    var add_max_img_styles = false;\n    if ( this._book.package.metadata.layout == 'pre-paginated' ) {\n      // NOOP\n    } else if ( this.options.flow == 'auto' || this.options.flow == 'paginated' ) {\n      add_max_img_styles = true;\n    }\n\n    var custom_stylesheet_rules = [];\n\n    // force 90% height instead of default 60%\n    if ( this.metadata.layout != 'pre-paginated' ) {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n            \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n            \"object-fit\": \"contain\",\n            \"page-break-inside\": \"avoid\"\n          },\n          \"svg\" : {\n            \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n            \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n            \"page-break-inside\": \"avoid\"\n          }\n        });\n      }.bind(this._rendition))\n    } else {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            // \"border\": \"64px solid black !important\",\n            \"box-sizing\": \"border-box !important\"\n          },\n          \"figure\": {\n            \"box-sizing\": \"border-box !important\",\n            \"margin\": \"0 !important\"\n          },\n          \"body\": {\n            \"margin\": \"0\"\n          }\n        });\n      }.bind(this._rendition));\n    }\n\n    this._updateFontSize();\n\n    if ( custom_stylesheet_rules.length ) {\n      this._rendition.hooks.content.register(function(view) {\n        view.addStylesheetRules(custom_stylesheet_rules);\n      })\n    }\n\n    this._rendition.on('resized', function(box) {\n      self.fire('resized', box);\n    })\n\n    this._rendition.on('relocated', function(location) {\n      if ( self._fired ) { self._fired = false; return ; }\n      self.fire('relocated', location);\n      if ( Browser.safari && self._last_location_start && self._last_location_start != location.start.href ) {\n        console.log(\"AHOY RELOCATED\", self._last_location_start, location.start.href);\n        self._fired = true;\n        console.log(\"AHOY RENDITION Q\", self._rendition.q.length());\n        setTimeout(function() {\n          // self._rendition.display(location.start.cfi);\n        }, 0);\n      }\n      self._last_location_start = location.start.href;\n    })\n\n    this._rendition.on('displayerror', function(err) {\n      console.log(\"AHOY RENDITION DISPLAY ERROR\", err);\n    })\n\n    this._rendition.on(\"locationChanged\", function(location) {\n      var view = this.manager.current();\n      var section = view.section;\n      var current = this.book.navigation.get(section.href);\n\n      // if ( self.__hash && view.contents ) {\n      //   var check = section.contents.querySelector(`#${self.__hash}`);\n      //   if ( check ) {\n      //     var new_target = section.cfiFromElement(check);\n      //     this.display(new_target);\n      //     self.__hash = null;\n      //     return;\n      //   }\n      // }\n\n      self.fire(\"updateSection\", current);\n      self.fire(\"updateLocation\", location);\n      // self.fire(\"relocated\", location);\n    });\n\n    this._rendition.on(\"rendered\", function(section, view) {\n\n      if ( view.contents ) {\n        // view.contents.on(\"xxlinkClicked\", function(href) {\n        //   console.log(\"AHOY CLICKED\", href);\n        //   var tmp = href.split(\"#\");\n        //   href = tmp[0];\n        //   var hash = tmp[1]\n        //   // var current = self.currentLocation().start.href;\n        //   // var section = self._book.spine.get(current.href);\n        //   console.log(\"AHOY CLICKED CHECK\", section.canonical, href);\n        //   if ( section.canonical.indexOf(href) < 0 ) {\n        //     self.gotoPage(href);\n        //     // self._rendition.display(href);\n\n        //   } else if ( hash ) {\n        //     // we're already on this page, so we need to scroll to this location\n        //     var node = view.contents.content.querySelector('#' + hash);\n        //     console.log(\"AHOY INTERNAL\", hash, view.contents, node);\n        //   }\n        //   // self._rendition.display(href);\n        // })\n      }\n\n      if(false) {\n        if ( ! self._rendition.manager.container.dataset.__scroll ) {\n          var ticking;\n          self._rendition.manager.container.addEventListener(\"scroll\", function(event) {\n            if ( self._rendition && self._rendition.manager ) {\n              var container = self._rendition.manager.container;\n              var mod = container.scrollLeft % parseInt(self._rendition.manager.layout.delta, 10);\n              console.log(\"AHOY DETECTED SCROLL\", mod, mod / self._rendition.manager.layout.delta);\n            }\n          });\n          self._rendition.manager.container.dataset.__scroll = true;\n        }\n      }\n\n      self.on('keyDown', function(data) {\n        if ( data.keyName == 'Tab' && data.inner ) {\n          var container = self._rendition.manager.container;\n          var mod;\n          var delta;\n          var x; var xyz;\n          setTimeout(function() {\n            var scrollLeft = container.scrollLeft;\n            mod = scrollLeft % parseInt(self._rendition.manager.layout.delta, 10);\n            if ( mod > 0 && ( mod / self._rendition.manager.layout.delta ) < 0.99 ) {\n              // var x = Math.floor(event.target.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10)) + 1;\n              // var delta = ( x * self._rendition.manager.layout.delta) - event.target.scrollLeft;\n              x = Math.floor(container.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10));\n              if ( data.shiftKey ) { x -= 0 ; }\n              else { x += 1; }\n              var y = container.scrollLeft;\n              delta = ( x * self._rendition.manager.layout.delta ) - y;\n              xyz = ( x * self._rendition.manager.layout.delta );\n              // if ( data.shiftKey ) { delta *= -1 ; }\n              if ( true || ! data.shiftKey ) {\n                self._rendition.manager.scrollBy(delta);\n              }\n            }\n            console.log(\"AHOY DOING THE SCROLLING\", data.shiftKey, scrollLeft, mod, x, xyz, delta);\n          }, 0);\n        }\n      })\n\n\n    })\n  },\n\n  _initializeReaderStyles: function() {\n    var self = this;\n    var themes = this.options.themes;\n    if ( themes ) {\n      themes.forEach(function(theme) {\n        self._rendition.themes.register(theme['klass'], theme.href ? theme.href : theme.rules);\n      })\n    }\n\n    // base for highlights\n    this._rendition.themes.override('.epubjs-hl', \"fill: yellow; fill-opacity: 0.3; mix-blend-mode: multiply;\");\n  },\n\n  _selectTheme: function(refresh) {\n    var theme = this.options.theme || 'default';\n    this._rendition.themes.select(theme);\n    if ( 0 && refresh ) {\n      var cfi = this.currentLocation().end.cfi;\n      this._rendition.manager.clear();\n      console.log(\"AHOY\", cfi);\n      this._rendition.display(cfi);\n    }\n  },\n\n  _updateFontSize: function() {\n    if ( this.metadata.layout == 'pre-paginated') {\n      // we're not doing font changes for pre-paginted\n      return;\n    }\n\n    var text_size = this.options.text_size == 'auto' ? 100 : this.options.text_size;\n    this._rendition.themes.fontSize(`${text_size}%`);\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    var scale = this.options.scale;\n    if ( scale ) {\n      this.settings.scale = parseInt(scale, 10) / 100.0;\n      this._queueScale();\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        console.log(\"AHOY SCALING\", this.settings.scale);\n        this._rendition.scale(this.settings.scale);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    var scale = this.options.scale;\n    if ( scale ) {\n      scale = parseInt(scale, 10) / 100.0;\n      this._rendition.scale(scale);\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        console.log(\"AHOY SCALING\", this.settings.scale);\n        this._rendition.scale(this.settings.scale);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.EpubJS.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'annotations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    if ( Browser.ie ) {\n      return {\n        reset: function() { /* NOOP */ },\n        highlight: function(cfiRange) { /* NOOP */ }\n      }\n    }\n    if ( ! this._rendition.annotations.reset ) {\n      this._rendition.annotations.reset = function(){\n        for(var hash in this._annotations) {\n            var cfiRange = decodeURI(hash);\n            this.remove(cfiRange);\n        }\n        this._annotationsBySectionIndex = {};\n      }.bind(this._rendition.annotations);\n    }\n    return this._rendition.annotations;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._book.locations;\n  }\n});\n\nwindow.Reader = Reader;\n\nexport function createReader(id, options) {\n  return new Reader.EpubJS(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.Mock = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    this._book = {\n      metadata: {\n        title: 'The Mock Life',\n        creator: 'Alex Mock',\n        publisher: 'University Press',\n        location: 'Ann Arbor, MI',\n        pubdate: '2017-05-23'\n      },\n      contents: {\n        toc: [\n          {id: 1, href: \"/epubs/mock/ops/xhtml/TitlePage.xhtml\", label: \"Title\", parent: null},\n          {id: 2, href: \"/epubs/mock/ops/xhtml/Chapter01.xhtml\", label: \"Chapter 1\", parent: null},\n          {id: 3, href: \"/epubs/mock/ops/xhtml/Chapter02.xhtml\", label: \"Chapter 2\", parent: null},\n          {id: 4, href: \"/epubs/mock/ops/xhtml/Chapter03.xhtml\", label: \"Chapter 3\", parent: null},\n          {id: 5, href: \"/epubs/mock/ops/xhtml/Chapter04.xhtml\", label: \"Chapter 4\", parent: null},\n          {id: 6, href: \"/epubs/mock/ops/xhtml/Chapter05.xhtml\", label: \"Chapter 5\", parent: null},\n          {id: 7, href: \"/epubs/mock/ops/xhtml/Chapter06.xhtml\", label: \"Chapter 6\", parent: null},\n          {id: 8, href: \"/epubs/mock/ops/xhtml/Chapter07.xhtml\", label: \"Chapter 7\", parent: null},\n          {id: 9, href: \"/epubs/mock/ops/xhtml/Index.xhtml\", label: \"Index\", parent: null},\n        ]\n      }\n    };\n\n    this._locations = [\n      'epubcfi(/6/4[TitlePage.xhtml])',\n      'epubcfi(/6/4[Chapter01.xhtml])',\n      'epubcfi(/6/4[Chapter02.xhtml])',\n      'epubcfi(/6/4[Chapter03.xhtml])',\n      'epubcfi(/6/4[Chapter04.xhtml])',\n      'epubcfi(/6/4[Chapter05.xhtml])',\n      'epubcfi(/6/4[Chapter06.xhtml])',\n      'epubcfi(/6/4[Chapter07.xhtml])',\n      'epubcfi(/6/4[Chapter08.xhtml])',\n      'epubcfi(/6/4[Index.xhtml])',\n    ];\n\n    this.__currentIndex = 0;\n\n    this.metadata = this._book.metadata;\n    this.fire('updateContents', this._book.contents);\n    this.fire('updateTitle', this._metadata);\n    this.fire('updateLocations', this._locations);\n    this.draw(target, callback);\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n    this.settings = { flow: this.options.flow };\n    this.settings.height = '100%';\n    this.settings.width = '99%';\n    // this.settings.width = '100%';\n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      callback = target;\n      target = undefined;\n    }\n    callback();\n    self.fire('ready');\n  },\n\n  next: function() {\n    // this._rendition.next();\n  },\n\n  prev: function() {\n    // this._rendition.prev();\n  },\n\n  first: function() {\n    // this._rendition.display(0);\n  },\n\n  last: function() {\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" ) {\n      this.__currentIndex = this._locations.indexOf(target);\n    } else {\n      this.__currentIndex = target;\n    }\n    this.fire(\"relocated\", this.currentLocation());\n  },\n\n  destroy: function() {\n    // if ( this._rendition ) {\n    //   this._rendition.destroy();\n    // }\n    // this._rendition = null;\n  },\n\n  currentLocation: function() {\n    var cfi = this._locations[this.__currentIndex];\n    return {\n      start: { cfi: cfi, href: cfi },\n      end: { cfi: cfi, href: cfi }\n    }\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n  },\n\n  _updateTheme: function() {\n\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.Mock.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    var self = this;\n    return {\n      total: self._locations.length,\n      locationFromCfi: function(cfi) {\n        return self._locations.indexOf(cfi);\n      },\n      percentageFromCfi: function(cfi) {\n        var index = self.locations.locationFromCfi(cfi);\n        return ( index / self.locations.total );\n      },\n      cfiFromPercentage: function(percentage) {\n        var index = Math.ceil(percentage * 10);\n        return self._locations[index];\n      }\n    }\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'annotations', {\n  get: function() {\n    return {\n      reset: function() {},\n      highlight: function() {}\n    }\n  }\n})\n\nexport function createReader(id, options) {\n  return new Reader.Mock(id, options);\n}\n","import {Reader} from './Reader';\nimport * as EpubJS from './Reader.EpubJS';\nimport * as Mock from './Reader.Mock';\n\nvar engines = {\n  epubjs: EpubJS.createReader,\n  mock: Mock.createReader\n}\n\nexport var reader = function(id, options) {\n  options = options || {};\n  var engine = options.engine || window.COZY_EPUB_ENGINE || 'epubjs';\n  var engine_href = options.engine_href || window.COZY_EPUB_ENGINE_HREF;\n  var _this = this;\n  var _arguments = arguments;\n\n  options.engine = engine;\n  options.engine_href = engine_href;\n\n  return engines[engine].apply(_this, [id, options]);\n}"],"names":["global","this","extend","dest","i","j","len","src","arguments","length","create","Object","F","proto","prototype","bind","fn","obj","slice","Array","apply","call","args","concat","lastId","stamp","_cozy_id","throttle","time","context","lock","wrapperFn","later","setTimeout","wrapNum","x","range","includeMax","max","min","d","falseFn","formatNum","num","digits","pow","Math","round","isNumeric","isNaN","parseFloat","isFinite","trim","str","replace","splitWords","split","setOptions","options","hasOwnProperty","getParamString","existingUrl","uppercase","params","push","encodeURIComponent","toUpperCase","indexOf","join","templateRe","template","data","key","value","undefined","Error","isArray","toString","array","el","emptyImageUrl","getPrefixed","name","window","lastTime","timeoutDefer","Date","timeToCall","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","id","clearTimeout","requestAnimFrame","immediate","cancelAnimFrame","loader","js","url","handler","_resolved","callbacks","error","then","cb","resolve","catch","reject","_argv","shift","e","console","log","trace","element","document","createElement","onload","onerror","async","parent","attr","appendChild","Class","props","NewClass","initialize","callInitHooks","parentProto","__super__","Util","constructor","statics","includes","checkDeprecatedMixinEvents","_initHooks","_initHooksCalled","include","mergeOptions","addInitHook","init","cozy","Mixin","Evented","on","types","type","_on","off","_events","_off","typeListeners","newListener","ctx","listeners","l","_firingCount","splice","fire","propagate","listens","event","target","_propagateEvent","_eventParents","once","addEventParent","removeEventParent","layer","addEventListener","removeEventListener","clearAllEventListeners","addOneTimeEventListener","fireEvent","hasEventListeners","style","documentElement","ie","ielt9","edge","navigator","webkit","userAgentContains","android","android23","opera","chrome","gecko","safari","phantom","opera12","win","platform","ie3d","webkit3d","WebKitCSSMatrix","gecko3d","any3d","L_DISABLE_3D","mobile","orientation","mobileWebkit","mobileWebkit3d","msPointer","PointerEvent","MSPointerEvent","pointer","touch","L_NO_TOUCH","DocumentTouch","mobileOpera","mobileGecko","retina","devicePixelRatio","screen","deviceXDPI","logicalXDPI","canvas","getContext","svg","vml","div","innerHTML","shape","firstChild","behavior","babelHelpers.typeof","adj","columnCount","classList","userAgent","toLowerCase","Point","y","clone","add","point","_add","toPoint","subtract","_subtract","divideBy","_divideBy","multiplyBy","_multiplyBy","scaleBy","unscaleBy","_round","floor","_floor","ceil","_ceil","distanceTo","sqrt","equals","contains","abs","POINTER_DOWN","Browser","POINTER_MOVE","POINTER_UP","POINTER_CANCEL","TAG_WHITE_LIST","_pointers","_pointerDocListener","_pointersCount","addPointerListener","_addPointerStart","_addPointerMove","_addPointerEnd","removePointerListener","onDown","pointerType","MSPOINTER_TYPE_MOUSE","tagName","DomEvent","_handlePointer","_globalPointerDown","_globalPointerMove","_globalPointerUp","pointerId","touches","changedTouches","onMove","buttons","onUp","_touchstart","_touchend","_pre","addDoubleTapListener","last","doubleTap","delay","onTouchStart","count","now","delta","onTouchEnd","cancelBubble","newTouch","prop","removeDoubleTapListener","touchstart","touchend","dblclick","addOne","eventsKey","removeOne","originalHandler","isExternalTarget","filterClick","attachEvent","detachEvent","stopPropagation","originalEvent","_stopped","skipped","disableScrollPropagation","disableClickPropagation","fakeStop","preventDefault","returnValue","stop","getMousePosition","container","clientX","clientY","rect","getBoundingClientRect","left","clientLeft","top","clientTop","wheelPxFactor","getWheelDelta","wheelDeltaY","deltaY","deltaMode","deltaX","deltaZ","wheelDelta","detail","skipEvents","events","related","relatedTarget","parentNode","err","lastClick","timeStamp","elapsed","_simulatedClick","_simulated","Element","matches","ep","webkitMatchesSelector","msMatchesSelector","mozMatchesSelector","TRANSFORM","testProp","TRANSITION","TRANSITION_END","get","getElementById","getStyle","currentStyle","defaultView","css","getComputedStyle","className","remove","removeChild","empty","toFront","toBack","insertBefore","hasClass","getClass","RegExp","test","addClass","classes","setClass","removeClass","baseVal","setOpacity","opacity","_setOpacityIE","filter","filterName","filters","item","Enabled","Opacity","isPropertySupported","setTransform","offset","scale","pos","setPosition","_leaflet_pos","getPosition","disableTextSelection","enableTextSelection","_userSelect","userSelectProperty","disableImageDrag","enableImageDrag","_outlineElement","_outlineStyle","preventOutline","tabIndex","restoreOutline","outline","freeGlobal","Symbol","root","objectProto","nativeObjectToString","symToStringTag","getRawTag","objectToString","isObject","baseGetTag","coreJsData","funcProto","funcToString","isMasked","isFunction","toSource","getValue","baseIsNative","defineProperty","getNative","eq","baseAssignValue","assignValue","nativeMax","identity","constant","shortOut","baseSetToString","setToString","overRest","isLength","MAX_SAFE_INTEGER","isArrayLike","isIndex","baseRest","isIterateeCall","isObjectLike","baseIsArguments","stubFalse","argsTag","funcTag","nodeUtil","baseUnary","baseIsTypedArray","isArguments","isBuffer","isTypedArray","baseTimes","overArg","isPrototype","nativeKeys","arrayLikeKeys","baseKeys","createAssigner","copyObject","keys","keyboardAllowed","val","fnMap","ret","eventNameMap","change","fullscreenchange","fullscreenerror","screenfull","request","elem","requestFullscreen","ALLOW_KEYBOARD_INPUT","exit","exitFullscreen","toggle","isFullscreen","onchange","callback","eventName","raw","defineProperties","Boolean","fullscreenElement","enumerable","enabled","fullscreenEnabled","Reader","regions","metadata","flow","engine","fontSizeLarge","fontSizeSmall","fontSizeDefault","trackResize","text_size","mobileMediaQuery","forceScrolledDocHeight","theme","rootfilePath","themes","self","_original_document_title","title","localStorage","getItem","assign","JSON","parse","_checkFeatureCompatibility","_initContainer","_initLayout","forEach","href","klass","rules","rule","new_rule","_updateTheme","_initEvents","_mode","mode","start","engine_href","_start","_loaded","open","reopen","saveOptions","saved_options","setItem","stringify","DomUtil","_container","dataset","draw","next","prev","display","index","gotoPage","goBack","history","back","goForward","forward","_preResize","_onScroll","_containerId","_fadeAnimated","fadeAnimation","position","_initPanes","panes","_panes","prefix","_initBookLoader","_checkIfLoaded","_targets","tracking","reader","_action","_last_location_start","_reader","action","v","pop","pageview","location","cfi","transform3DLimit","_onMoveEnd","location_href","_ignoreHistory","tmp_href","substr","pushState","percentage","p","isTrusted","state","keyName","check","activeElement","localName","parentElement","IGNORE_TARGETS","shiftKey","_scroll","scrollTop","scrollLeft","_handleDOMEvent","keyCode","srcElement","_fireDOMEvent","targets","synth","_findEventTargets","isMarker","containerPoint","latLngToContainerPoint","getLatLng","mouseEventToContainerPoint","layerPoint","containerPointToLayerPoint","latlng","layerPointToLatLng","nonBubblingEvents","getFixedBookPanelSize","h","clientHeight","paddingTop","paddingBottom","w","clientWidth","paddingRight","paddingLeft","height","width","invalidateSize","_drawn","_resizeRequest","_resizeBookPane","_setupHooks","_checkMobileDevice","_isMobile","matchMedia","_enableBookLoader","_clearBookLoaderTimeout","_force_progress","_loader_timeout","_disableBookLoader","force","loader_template","loaderTemplate","body","DOMParser","parseFromString","children","EOT","Control","_locked","_id","getTime","parseInt","random","getRegion","region","setRegion","removeControl","addControl","getContainer","addTo","onAdd","area","getControlRegion","onRemove","_refocusOnMap","screenX","screenY","focus","_className","widget","direction","control","getControlContainer","_controlContainer","parts","tmp","slug","panel","getControlRegion_1","slot","childElement","_classify","_clearControlRegion","_controlRegions","PageControl","_control","querySelector","_createButton","_fill","html","label","_bindEvents","link","setAttribute","_unit","s","unit","_label","PagePrevious","PageNext","PageFirst","first","PageLast","pageNext","pagePrevious","pageFirst","pageLast","activeModal","FOCUSABLE_ELEMENTS","ACTIONABLE_ELEMENTS","Modal","fraction","actions","onShow","onClose","handlers","_initializedEvents","panelHTML","main","button_cls","modal","onClick","onKeydown","onModalTransition","button_id","button","close","closeModal","deactivate","removeEventListeners","showModal","_resize","setFocusToFirstNode","addEventListeners","activate","offsetHeight","offsetWidth","header","footer","getFocusableNodes","nodes","querySelectorAll","map","focusableNodes","getActionableNodes","maintainFocus","closeAfterAction","hasAttribute","actionableNodes","click","selector","getAttribute","focusedItemIndex","Contents","defaultTemplate","_modal","_setupSkipLink","_process","items","tabindex","option","_createOption","subitems","toc","chapter","anchor","textContent","span","skipLink","ul","contents","Title","h1","_title","_divider","_section","bookTitle","PublicationMetadata","_publisher","_rights","publisher","rights","publicationMetadata","Preferences","hasThemes","_activated","updatePreferences","initializeForm","_createPanel","possible_fieldsets","layout","rootfiles","_fieldsets","cls","fieldset","fields","hasFields","field","inputs","input","checked","hint","_form","new_options","saveable_options","updateForm","Fieldset","_current","TextSize","form","_input","_output","_preview","_actionReset","_updatePreview","saveable","fontSize","Display","scrolled_help","Theme","Rendition","expr","rootfile","accessMode","Scale","transform","preferences","Widget","_onAddExtra","_updateTemplate","_updateClass","node","Button","Panel","Toggle","states","stateName","_resetState","_state","Citation","designMode","formatted","createRange","selectNode","sel","getSelection","removeAllRanges","addRange","flag","execCommand","_message","detach","citations","citation","format","text","createTextNode","_formatted","_initializeForm","_formatCitation","selected","Search","_data","_canceled","_processing","_article","searchString","openModalResults","openModalWaiting","submitQuery","_emptyArticle","_buildResults","searchUrl","XMLHttpRequest","status","response","send","hasChildNodes","lastChild","content","annotations","reset","highlight","highlight_off","search_results","result","cfiRange","snippet","chapterTitle","search","BibliographicInformation","dl","metadata_fields","idx","_formatDate","metadata_fields_seen","dt","dd","match","bibliographicInformation","Download","_configureDownloadForm","submit","download_links","size","download","Navigator","_setup","locations","_initializeNavigator","_createControl","_background","_status","_spanCurrentPercentage","_spanCurrentLocation","_spanTotalLocations","_update","_mouseDown","_initiated","percentageFromCfi","currentLocation","cfiFromPercentage","current","rangeBg","current_location","locationFromCfi","_last_delta","_last_value","_total","total","Bus","instance","bus","Events","ePub","require","EpubJS","_epubjs_ready","xpath","path","sessionStorage","book_href","book_options","packagePath","useArchive","openAs","_book","epubjs","removeItem","loaded","navigation","_contents","package","ready","parseRootfiles","spine","each","cfiBase","_locations","t","f","_rendition","manager","stage","generate","load","containerDoc","hooks","clear","destroy","settings","overflow","spread","_drawRendition","renderTo","_updateFontSize","hash","decodeURIComponent","status_index","register","inner","_initializeReaderStyles","_queueTimeout","rootFilePath","newScrollTop","scrollBy","scrollHeight","_navigate","promise","section","guessed","path1","directory","navPath","path2","dirname","canonical","navigating","doUpdate","changed","_updateScale","reload","_selectTheme","_cached_location","custom_stylesheet_rules","addStylesheetRules","_layout","columnWidth","view","box","_fired","q","book","mod","xyz","override","refresh","select","_queueScale","_metadata","set","_annotations","decodeURI","_annotationsBySectionIndex","createReader","Mock","creator","pubdate","__currentIndex","end","engines","mock","COZY_EPUB_ENGINE","COZY_EPUB_ENGINE_HREF","_this"],"mappings":"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"}
=======
{"version":3,"file":"cozy-sun-bear.js","sources":["../node_modules/url-polyfill/url-polyfill.js","../node_modules/classlist-polyfill/src/index.js","../src/core/Util.js","../src/core/Class.js","../src/core/Events.js","../src/core/Browser.js","../src/geometry/Point.js","../src/dom/DomEvent.Pointer.js","../src/dom/DomEvent.DoubleTap.js","../src/dom/DomEvent.js","../src/dom/DomUtil.js","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../node_modules/lodash/isFunction.js","../node_modules/lodash/_coreJsData.js","../node_modules/lodash/_isMasked.js","../node_modules/lodash/_toSource.js","../node_modules/lodash/_baseIsNative.js","../node_modules/lodash/_getValue.js","../node_modules/lodash/_getNative.js","../node_modules/lodash/_defineProperty.js","../node_modules/lodash/_baseAssignValue.js","../node_modules/lodash/eq.js","../node_modules/lodash/_assignValue.js","../node_modules/lodash/_copyObject.js","../node_modules/lodash/identity.js","../node_modules/lodash/_apply.js","../node_modules/lodash/_overRest.js","../node_modules/lodash/constant.js","../node_modules/lodash/_baseSetToString.js","../node_modules/lodash/_shortOut.js","../node_modules/lodash/_setToString.js","../node_modules/lodash/_baseRest.js","../node_modules/lodash/isLength.js","../node_modules/lodash/isArrayLike.js","../node_modules/lodash/_isIndex.js","../node_modules/lodash/_isIterateeCall.js","../node_modules/lodash/_createAssigner.js","../node_modules/lodash/_isPrototype.js","../node_modules/lodash/_baseTimes.js","../node_modules/lodash/_baseIsArguments.js","../node_modules/lodash/isArguments.js","../node_modules/lodash/isArray.js","../node_modules/lodash/stubFalse.js","../node_modules/lodash/isBuffer.js","../node_modules/lodash/_baseIsTypedArray.js","../node_modules/lodash/_baseUnary.js","../node_modules/lodash/_nodeUtil.js","../node_modules/lodash/isTypedArray.js","../node_modules/lodash/_arrayLikeKeys.js","../node_modules/lodash/_overArg.js","../node_modules/lodash/_nativeKeys.js","../node_modules/lodash/_baseKeys.js","../node_modules/lodash/keys.js","../node_modules/lodash/assign.js","../src/screenfull.js","../src/reader/Reader.js","../src/control/Control.js","../src/control/Control.Paging.js","../src/control/Modal.js","../src/control/Control.Contents.js","../src/control/Control.Title.js","../src/control/Control.PublicationMetadata.js","../src/control/Control.Preferences.js","../src/control/Control.Widget.js","../src/control/Control.Citation.js","../src/control/Control.Search.js","../src/control/Control.BibliographicInformation.js","../src/control/Control.Download.js","../src/control/Control.Navigator.js","../src/control/index.js","../src/core/Bus.js","../src/core/index.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/assign/is-implemented.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/keys/is-implemented.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/function/noop.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/is-value.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/keys/shim.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/keys/index.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/valid-value.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/assign/shim.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/assign/index.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/normalize-options.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/is-callable.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/string/#/contains/is-implemented.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/string/#/contains/shim.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/string/#/contains/index.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/d/index.js","../../sandbox/epub.js/node_modules/event-emitter/node_modules/es5-ext/object/valid-callable.js","../../sandbox/epub.js/node_modules/event-emitter/index.js","../../sandbox/epub.js/src/utils/core.js","../../sandbox/epub.js/node_modules/path-webpack/path.js","../../sandbox/epub.js/src/utils/path.js","../../sandbox/epub.js/src/utils/url.js","../../sandbox/epub.js/src/epubcfi.js","../../sandbox/epub.js/src/utils/hook.js","../../sandbox/epub.js/src/utils/replacements.js","../../sandbox/epub.js/src/section.js","../../sandbox/epub.js/src/spine.js","../../sandbox/epub.js/src/utils/queue.js","../../sandbox/epub.js/src/utils/constants.js","../../sandbox/epub.js/src/locations.js","../../sandbox/epub.js/src/container.js","../../sandbox/epub.js/src/packaging.js","../../sandbox/epub.js/src/navigation.js","../../sandbox/epub.js/libs/mime/mime.js","../../sandbox/epub.js/src/resources.js","../../sandbox/epub.js/src/pagelist.js","../../sandbox/epub.js/src/layout.js","../../sandbox/epub.js/src/themes.js","../../sandbox/epub.js/src/mapping.js","../../sandbox/epub.js/src/contents.js","../../sandbox/epub.js/src/annotations.js","../../sandbox/epub.js/node_modules/marks-pane/lib/svg.js","../../sandbox/epub.js/node_modules/marks-pane/lib/events.js","../../sandbox/epub.js/node_modules/marks-pane/lib/marks.js","../../sandbox/epub.js/src/managers/views/iframe.js","../../sandbox/epub.js/node_modules/lodash/isObject.js","../../sandbox/epub.js/node_modules/lodash/_freeGlobal.js","../../sandbox/epub.js/node_modules/lodash/_root.js","../../sandbox/epub.js/node_modules/lodash/now.js","../../sandbox/epub.js/node_modules/lodash/_Symbol.js","../../sandbox/epub.js/node_modules/lodash/_getRawTag.js","../../sandbox/epub.js/node_modules/lodash/_objectToString.js","../../sandbox/epub.js/node_modules/lodash/_baseGetTag.js","../../sandbox/epub.js/node_modules/lodash/isObjectLike.js","../../sandbox/epub.js/node_modules/lodash/isSymbol.js","../../sandbox/epub.js/node_modules/lodash/toNumber.js","../../sandbox/epub.js/node_modules/lodash/debounce.js","../../sandbox/epub.js/node_modules/lodash/throttle.js","../../sandbox/epub.js/src/managers/helpers/stage.js","../../sandbox/epub.js/src/managers/helpers/views.js","../../sandbox/epub.js/src/managers/default/index.js","../../sandbox/epub.js/src/managers/helpers/snap.js","../../sandbox/epub.js/src/managers/continuous/index.js","../../sandbox/epub.js/src/rendition.js","../../sandbox/epub.js/src/utils/request.js","../../sandbox/epub.js/src/archive.js","../../sandbox/epub.js/src/store.js","../../sandbox/epub.js/src/book.js","../../sandbox/epub.js/libs/url/url-polyfill.js","../../sandbox/epub.js/src/epub.js","../node_modules/path-webpack/path.js","../src/epubjs/managers/helpers/prefab.js","../src/epubjs/managers/continuous/prepaginated.js","../src/epubjs/managers/views/iframe.js","../src/reader/Reader.EpubJS.js","../src/reader/Reader.Mock.js","../src/reader/index.js"],"sourcesContent":["(function(global) {\r\n  /**\r\n   * Polyfill URLSearchParams\r\n   *\r\n   * Inspired from : https://github.com/WebReflection/url-search-params/blob/master/src/url-search-params.js\r\n   */\r\n\r\n  var checkIfIteratorIsSupported = function() {\r\n    try {\r\n      return !!Symbol.iterator;\r\n    } catch(error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  var iteratorSupported = checkIfIteratorIsSupported();\r\n\r\n  var createIterator = function(items) {\r\n    var iterator = {\r\n      next: function() {\r\n        var value = items.shift();\r\n        return { done: value === void 0, value: value };\r\n      }\r\n    };\r\n\r\n    if(iteratorSupported) {\r\n      iterator[Symbol.iterator] = function() {\r\n        return iterator;\r\n      };\r\n    }\r\n\r\n    return iterator;\r\n  };\r\n\r\n  /**\r\n   * Search param name and values should be encoded according to https://url.spec.whatwg.org/#urlencoded-serializing\r\n   * encodeURIComponent() produces the same result except encoding spaces as `%20` instead of `+`.\r\n   */\r\n  var serializeParam = function(value) {\r\n    return encodeURIComponent(value).replace(/%20/g, '+');\r\n  };\r\n\r\n  var deserializeParam = function(value) {\r\n    return decodeURIComponent(value).replace(/\\+/g, ' ');\r\n  };\r\n\r\n  var polyfillURLSearchParams= function() {\r\n\r\n    var URLSearchParams = function(searchString) {\r\n      Object.defineProperty(this, '_entries', { value: {} });\r\n\r\n      if(typeof searchString === 'string') {\r\n        if(searchString !== '') {\r\n          searchString = searchString.replace(/^\\?/, '');\r\n          var attributes = searchString.split('&');\r\n          var attribute;\r\n          for(var i = 0; i < attributes.length; i++) {\r\n            attribute = attributes[i].split('=');\r\n            this.append(\r\n              deserializeParam(attribute[0]),\r\n              (attribute.length > 1) ? deserializeParam(attribute[1]) : ''\r\n            );\r\n          }\r\n        }\r\n      } else if(searchString instanceof URLSearchParams) {\r\n        var _this = this;\r\n        searchString.forEach(function(value, name) {\r\n          _this.append(value, name);\r\n        });\r\n      }\r\n    };\r\n\r\n    var proto = URLSearchParams.prototype;\r\n\r\n    proto.append = function(name, value) {\r\n      if(name in this._entries) {\r\n        this._entries[name].push(value.toString());\r\n      } else {\r\n        this._entries[name] = [value.toString()];\r\n      }\r\n    };\r\n\r\n    proto.delete = function(name) {\r\n      delete this._entries[name];\r\n    };\r\n\r\n    proto.get = function(name) {\r\n      return (name in this._entries) ? this._entries[name][0] : null;\r\n    };\r\n\r\n    proto.getAll = function(name) {\r\n      return (name in this._entries) ? this._entries[name].slice(0) : [];\r\n    };\r\n\r\n    proto.has = function(name) {\r\n      return (name in this._entries);\r\n    };\r\n\r\n    proto.set = function(name, value) {\r\n      this._entries[name] = [value.toString()];\r\n    };\r\n\r\n    proto.forEach = function(callback, thisArg) {\r\n      var entries;\r\n      for(var name in this._entries) {\r\n        if(this._entries.hasOwnProperty(name)) {\r\n          entries = this._entries[name];\r\n          for(var i = 0; i < entries.length; i++) {\r\n            callback.call(thisArg, entries[i], name, this);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    proto.keys = function() {\r\n      var items = [];\r\n      this.forEach(function(value, name) { items.push(name); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    proto.values = function() {\r\n      var items = [];\r\n      this.forEach(function(value) { items.push(value); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    proto.entries = function() {\r\n      var items = [];\r\n      this.forEach(function(value, name) { items.push([name, value]); });\r\n      return createIterator(items);\r\n    };\r\n\r\n    if(iteratorSupported) {\r\n      proto[Symbol.iterator] = proto.entries;\r\n    }\r\n\r\n    proto.toString = function() {\r\n      var searchString = '';\r\n      this.forEach(function(value, name) {\r\n        if(searchString.length > 0) searchString+= '&';\r\n        searchString += serializeParam(name) + '=' + serializeParam(value);\r\n      });\r\n      return searchString;\r\n    };\r\n\r\n    global.URLSearchParams = URLSearchParams;\r\n  };\r\n\r\n  if(!('URLSearchParams' in global) || (new URLSearchParams('?a=1').toString() !== 'a=1')) {\r\n    polyfillURLSearchParams();\r\n  }\r\n\r\n  // HTMLAnchorElement\r\n\r\n})(\r\n  (typeof global !== 'undefined') ? global\r\n    : ((typeof window !== 'undefined') ? window\r\n    : ((typeof self !== 'undefined') ? self : this))\r\n);\r\n\r\n(function(global) {\r\n  /**\r\n   * Polyfill URL\r\n   *\r\n   * Inspired from : https://github.com/arv/DOM-URL-Polyfill/blob/master/src/url.js\r\n   */\r\n\r\n  var checkIfURLIsSupported = function() {\r\n    try {\r\n      var u = new URL('b', 'http://a');\r\n      u.pathname = 'c%20d';\r\n      return (u.href === 'http://a/c%20d') && u.searchParams;\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n  var polyfillURL = function() {\r\n    var _URL = global.URL;\r\n\r\n    var URL = function(url, base) {\r\n      if(typeof url !== 'string') url = String(url);\r\n\r\n      var doc = document.implementation.createHTMLDocument('');\r\n      window.doc = doc;\r\n      if(base) {\r\n        var baseElement = doc.createElement('base');\r\n        baseElement.href = base;\r\n        doc.head.appendChild(baseElement);\r\n      }\r\n\r\n      var anchorElement = doc.createElement('a');\r\n      anchorElement.href = url;\r\n      doc.body.appendChild(anchorElement);\r\n      anchorElement.href = anchorElement.href; // force href to refresh\r\n\r\n      if(anchorElement.protocol === ':' || !/:/.test(anchorElement.href)) {\r\n        throw new TypeError('Invalid URL');\r\n      }\r\n\r\n      Object.defineProperty(this, '_anchorElement', {\r\n        value: anchorElement\r\n      });\r\n    };\r\n\r\n    var proto = URL.prototype;\r\n\r\n    var linkURLWithAnchorAttribute = function(attributeName) {\r\n      Object.defineProperty(proto, attributeName, {\r\n        get: function() {\r\n          return this._anchorElement[attributeName];\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement[attributeName] = value;\r\n        },\r\n        enumerable: true\r\n      });\r\n    };\r\n\r\n    ['hash', 'host', 'hostname', 'port', 'protocol', 'search']\r\n    .forEach(function(attributeName) {\r\n      linkURLWithAnchorAttribute(attributeName);\r\n    });\r\n\r\n    Object.defineProperties(proto, {\r\n\r\n      'toString': {\r\n        get: function() {\r\n          var _this = this;\r\n          return function() {\r\n            return _this.href;\r\n          };\r\n        }\r\n      },\r\n\r\n      'href' : {\r\n        get: function() {\r\n          return this._anchorElement.href.replace(/\\?$/,'');\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement.href = value;\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'pathname' : {\r\n        get: function() {\r\n          return this._anchorElement.pathname.replace(/(^\\/?)/,'/');\r\n        },\r\n        set: function(value) {\r\n          this._anchorElement.pathname = value;\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'origin': {\r\n        get: function() {\r\n          // get expected port from protocol\r\n          var expectedPort = {'http:': 80, 'https:': 443, 'ftp:': 21}[this._anchorElement.protocol];\r\n          // add port to origin if, expected port is different than actual port\r\n          // and it is not empty f.e http://foo:8080\r\n          // 8080 != 80 && 8080 != ''\r\n          var addPortToOrigin = this._anchorElement.port != expectedPort &&\r\n            this._anchorElement.port !== ''\r\n\r\n          return this._anchorElement.protocol +\r\n            '//' +\r\n            this._anchorElement.hostname +\r\n            (addPortToOrigin ? (':' + this._anchorElement.port) : '');\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'password': { // TODO\r\n        get: function() {\r\n          return '';\r\n        },\r\n        set: function(value) {\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'username': { // TODO\r\n        get: function() {\r\n          return '';\r\n        },\r\n        set: function(value) {\r\n        },\r\n        enumerable: true\r\n      },\r\n\r\n      'searchParams': {\r\n        get: function() {\r\n          var searchParams = new URLSearchParams(this.search);\r\n          var _this = this;\r\n          ['append', 'delete', 'set'].forEach(function(methodName) {\r\n            var method = searchParams[methodName];\r\n            searchParams[methodName] = function() {\r\n              method.apply(searchParams, arguments);\r\n              _this.search = searchParams.toString();\r\n            };\r\n          });\r\n          return searchParams;\r\n        },\r\n        enumerable: true\r\n      }\r\n    });\r\n\r\n    URL.createObjectURL = function(blob) {\r\n      return _URL.createObjectURL.apply(_URL, arguments);\r\n    };\r\n\r\n    URL.revokeObjectURL = function(url) {\r\n      return _URL.revokeObjectURL.apply(_URL, arguments);\r\n    };\r\n\r\n    global.URL = URL;\r\n\r\n  };\r\n\r\n  if(!checkIfURLIsSupported()) {\r\n    polyfillURL();\r\n  }\r\n\r\n  if((global.location !== void 0) && !('origin' in global.location)) {\r\n    var getOrigin = function() {\r\n      return global.location.protocol + '//' + global.location.hostname + (global.location.port ? (':' + global.location.port) : '');\r\n    };\r\n\r\n    try {\r\n      Object.defineProperty(global.location, 'origin', {\r\n        get: getOrigin,\r\n        enumerable: true\r\n      });\r\n    } catch(e) {\r\n      setInterval(function() {\r\n        global.location.origin = getOrigin();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n})(\r\n  (typeof global !== 'undefined') ? global\r\n    : ((typeof window !== 'undefined') ? window\r\n    : ((typeof self !== 'undefined') ? self : this))\r\n);\r\n","/*\n * classList.js: Cross-browser full element.classList implementation.\n * 1.1.20170427\n *\n * By Eli Grey, http://eligrey.com\n * License: Dedicated to the public domain.\n *   See https://github.com/eligrey/classList.js/blob/master/LICENSE.md\n */\n\n/*global self, document, DOMException */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */\n\nif (\"document\" in window.self) {\n\n// Full polyfill for browsers with no classList support\n// Including IE < Edge missing SVGElement.classList\nif (!(\"classList\" in document.createElement(\"_\")) \n\t|| document.createElementNS && !(\"classList\" in document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\"))) {\n\n(function (view) {\n\n\"use strict\";\n\nif (!('Element' in view)) return;\n\nvar\n\t  classListProp = \"classList\"\n\t, protoProp = \"prototype\"\n\t, elemCtrProto = view.Element[protoProp]\n\t, objCtr = Object\n\t, strTrim = String[protoProp].trim || function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, \"\");\n\t}\n\t, arrIndexOf = Array[protoProp].indexOf || function (item) {\n\t\tvar\n\t\t\t  i = 0\n\t\t\t, len = this.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\t// Vendors: please allow content code to instantiate DOMExceptions\n\t, DOMEx = function (type, message) {\n\t\tthis.name = type;\n\t\tthis.code = DOMException[type];\n\t\tthis.message = message;\n\t}\n\t, checkTokenAndGetIndex = function (classList, token) {\n\t\tif (token === \"\") {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"SYNTAX_ERR\"\n\t\t\t\t, \"An invalid or illegal string was specified\"\n\t\t\t);\n\t\t}\n\t\tif (/\\s/.test(token)) {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"INVALID_CHARACTER_ERR\"\n\t\t\t\t, \"String contains an invalid character\"\n\t\t\t);\n\t\t}\n\t\treturn arrIndexOf.call(classList, token);\n\t}\n\t, ClassList = function (elem) {\n\t\tvar\n\t\t\t  trimmedClasses = strTrim.call(elem.getAttribute(\"class\") || \"\")\n\t\t\t, classes = trimmedClasses ? trimmedClasses.split(/\\s+/) : []\n\t\t\t, i = 0\n\t\t\t, len = classes.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tthis.push(classes[i]);\n\t\t}\n\t\tthis._updateClassName = function () {\n\t\t\telem.setAttribute(\"class\", this.toString());\n\t\t};\n\t}\n\t, classListProto = ClassList[protoProp] = []\n\t, classListGetter = function () {\n\t\treturn new ClassList(this);\n\t}\n;\n// Most DOMException implementations don't allow calling DOMException's toString()\n// on non-DOMExceptions. Error's toString() is sufficient here.\nDOMEx[protoProp] = Error[protoProp];\nclassListProto.item = function (i) {\n\treturn this[i] || null;\n};\nclassListProto.contains = function (token) {\n\ttoken += \"\";\n\treturn checkTokenAndGetIndex(this, token) !== -1;\n};\nclassListProto.add = function () {\n\tvar\n\t\t  tokens = arguments\n\t\t, i = 0\n\t\t, l = tokens.length\n\t\t, token\n\t\t, updated = false\n\t;\n\tdo {\n\t\ttoken = tokens[i] + \"\";\n\t\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\t\tthis.push(token);\n\t\t\tupdated = true;\n\t\t}\n\t}\n\twhile (++i < l);\n\n\tif (updated) {\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.remove = function () {\n\tvar\n\t\t  tokens = arguments\n\t\t, i = 0\n\t\t, l = tokens.length\n\t\t, token\n\t\t, updated = false\n\t\t, index\n\t;\n\tdo {\n\t\ttoken = tokens[i] + \"\";\n\t\tindex = checkTokenAndGetIndex(this, token);\n\t\twhile (index !== -1) {\n\t\t\tthis.splice(index, 1);\n\t\t\tupdated = true;\n\t\t\tindex = checkTokenAndGetIndex(this, token);\n\t\t}\n\t}\n\twhile (++i < l);\n\n\tif (updated) {\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.toggle = function (token, force) {\n\ttoken += \"\";\n\n\tvar\n\t\t  result = this.contains(token)\n\t\t, method = result ?\n\t\t\tforce !== true && \"remove\"\n\t\t:\n\t\t\tforce !== false && \"add\"\n\t;\n\n\tif (method) {\n\t\tthis[method](token);\n\t}\n\n\tif (force === true || force === false) {\n\t\treturn force;\n\t} else {\n\t\treturn !result;\n\t}\n};\nclassListProto.toString = function () {\n\treturn this.join(\" \");\n};\n\nif (objCtr.defineProperty) {\n\tvar classListPropDesc = {\n\t\t  get: classListGetter\n\t\t, enumerable: true\n\t\t, configurable: true\n\t};\n\ttry {\n\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t} catch (ex) { // IE 8 doesn't support enumerable:true\n\t\t// adding undefined to fight this issue https://github.com/eligrey/classList.js/issues/36\n\t\t// modernie IE8-MSW7 machine has IE8 8.0.6001.18702 and is affected\n\t\tif (ex.number === undefined || ex.number === -0x7FF5EC54) {\n\t\t\tclassListPropDesc.enumerable = false;\n\t\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t\t}\n\t}\n} else if (objCtr[protoProp].__defineGetter__) {\n\telemCtrProto.__defineGetter__(classListProp, classListGetter);\n}\n\n}(window.self));\n\n}\n\n// There is full or partial native classList support, so just check if we need\n// to normalize the add/remove and toggle APIs.\n\n(function () {\n\t\"use strict\";\n\n\tvar testElement = document.createElement(\"_\");\n\n\ttestElement.classList.add(\"c1\", \"c2\");\n\n\t// Polyfill for IE 10/11 and Firefox <26, where classList.add and\n\t// classList.remove exist but support only one argument at a time.\n\tif (!testElement.classList.contains(\"c2\")) {\n\t\tvar createMethod = function(method) {\n\t\t\tvar original = DOMTokenList.prototype[method];\n\n\t\t\tDOMTokenList.prototype[method] = function(token) {\n\t\t\t\tvar i, len = arguments.length;\n\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\ttoken = arguments[i];\n\t\t\t\t\toriginal.call(this, token);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tcreateMethod('add');\n\t\tcreateMethod('remove');\n\t}\n\n\ttestElement.classList.toggle(\"c3\", false);\n\n\t// Polyfill for IE 10 and Firefox <24, where classList.toggle does not\n\t// support the second argument.\n\tif (testElement.classList.contains(\"c3\")) {\n\t\tvar _toggle = DOMTokenList.prototype.toggle;\n\n\t\tDOMTokenList.prototype.toggle = function(token, force) {\n\t\t\tif (1 in arguments && !this.contains(token) === !force) {\n\t\t\t\treturn force;\n\t\t\t} else {\n\t\t\t\treturn _toggle.call(this, token);\n\t\t\t}\n\t\t};\n\n\t}\n\n\ttestElement = null;\n}());\n\n}\n","/*\n * @namespace Util\n *\n * Various utility functions, used by Leaflet internally.\n */\n\n// @function extend(dest: Object, src?: Object): Object\n// Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.\nexport function extend(dest) {\n    var i, j, len, src;\n\n    for (j = 1, len = arguments.length; j < len; j++) {\n        src = arguments[j];\n        for (i in src) {\n            dest[i] = src[i];\n        }\n    }\n    return dest;\n}\n\n// @function create(proto: Object, properties?: Object): Object\n// Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\nexport var create = Object.create || (function () {\n    function F() {}\n    return function (proto) {\n        F.prototype = proto;\n        return new F();\n    };\n})();\n\n// @function bind(fn: Function, …): Function\n// Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n// Has a `L.bind()` shortcut.\nexport function bind(fn, obj) {\n    var slice = Array.prototype.slice;\n\n    if (fn.bind) {\n        return fn.bind.apply(fn, slice.call(arguments, 1));\n    }\n\n    var args = slice.call(arguments, 2);\n\n    return function () {\n        return fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\n    };\n}\n\n// @property lastId: Number\n// Last unique ID used by [`stamp()`](#util-stamp)\nexport var lastId = 0;\n\n// @function stamp(obj: Object): Number\n// Returns the unique ID of an object, assiging it one if it doesn't have it.\nexport function stamp(obj) {\n    /*eslint-disable */\n    obj._cozy_id = obj._cozy_id || ++lastId;\n    return obj._cozy_id; /* not leaflet */\n    /*eslint-enable */\n}\n\n// @function throttle(fn: Function, time: Number, context: Object): Function\n// Returns a function which executes function `fn` with the given scope `context`\n// (so that the `this` keyword refers to `context` inside `fn`'s code). The function\n// `fn` will be called no more than one time per given amount of `time`. The arguments\n// received by the bound function will be any arguments passed when binding the\n// function, followed by any arguments passed when invoking the bound function.\n// Has an `L.throttle` shortcut.\nexport function throttle(fn, time, context) {\n    var lock, args, wrapperFn, later;\n\n    later = function () {\n        // reset lock and call if queued\n        lock = false;\n        if (args) {\n            wrapperFn.apply(context, args);\n            args = false;\n        }\n    };\n\n    wrapperFn = function () {\n        if (lock) {\n            // called too soon, queue to call later\n            args = arguments;\n\n        } else {\n            // call and lock until later\n            fn.apply(context, arguments);\n            setTimeout(later, time);\n            lock = true;\n        }\n    };\n\n    return wrapperFn;\n}\n\n// @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number\n// Returns the number `num` modulo `range` in such a way so it lies within\n// `range[0]` and `range[1]`. The returned value will be always smaller than\n// `range[1]` unless `includeMax` is set to `true`.\nexport function wrapNum(x, range, includeMax) {\n    var max = range[1],\n        min = range[0],\n        d = max - min;\n    return x === max && includeMax ? x : ((x - min) % d + d) % d + min;\n}\n\n// @function falseFn(): Function\n// Returns a function which always returns `false`.\nexport function falseFn() { return false; }\n\n// @function formatNum(num: Number, digits?: Number): Number\n// Returns the number `num` rounded to `digits` decimals, or to 5 decimals by default.\nexport function formatNum(num, digits) {\n    var pow = Math.pow(10, digits || 5);\n    return Math.round(num * pow) / pow;\n}\n\n// @function isNumeric(num: Number): Boolean\n// Returns whether num is actually numeric\nexport function isNumeric(num) {\n  return !isNaN(parseFloat(num)) && isFinite(num);\n}\n\n// @function trim(str: String): String\n// Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)\nexport function trim(str) {\n    return str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\n}\n\n// @function splitWords(str: String): String[]\n// Trims and splits the string on whitespace and returns the array of parts.\nexport function splitWords(str) {\n    return trim(str).split(/\\s+/);\n}\n\n// @function setOptions(obj: Object, options: Object): Object\n// Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.\nexport function setOptions(obj, options) {\n    if (!obj.hasOwnProperty('options')) {\n        obj.options = obj.options ? create(obj.options) : {};\n    }\n    for (var i in options) {\n        obj.options[i] = options[i];\n    }\n    return obj.options;\n}\n\n// @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\n// Converts an object into a parameter URL string, e.g. `{a: \"foo\", b: \"bar\"}`\n// translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will\n// be appended at the end. If `uppercase` is `true`, the parameter names will\n// be uppercased (e.g. `'?A=foo&B=bar'`)\nexport function getParamString(obj, existingUrl, uppercase) {\n    var params = [];\n    for (var i in obj) {\n        params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\n    }\n    return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\n}\n\nvar templateRe = /\\{ *([\\w_\\-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values — they will be evaluated passing `data` as an argument.\nexport function template(str, data) {\n    return str.replace(templateRe, function (str, key) {\n        var value = data[key];\n\n        if (value === undefined) {\n            throw new Error('No value provided for variable ' + str);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n}\n\n// @function isArray(obj): Boolean\n// Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)\nexport var isArray = Array.isArray || function (obj) {\n    return (Object.prototype.toString.call(obj) === '[object Array]');\n};\n\n// @function indexOf(array: Array, el: Object): Number\n// Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)\nexport function indexOf(array, el) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i] === el) { return i; }\n    }\n    return -1;\n}\n\n// @property emptyImageUrl: String\n// Data URI string containing a base64-encoded empty GIF image.\n// Used as a hack to free memory from unused images on WebKit-powered\n// mobile devices (by setting image `src` to this string).\nexport var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n\nfunction getPrefixed(name) {\n    return window['webkit' + name] || window['moz' + name] || window['ms' + name];\n}\n\nvar lastTime = 0;\n\n// fallback for IE 7-8\nfunction timeoutDefer(fn) {\n    var time = +new Date(),\n        timeToCall = Math.max(0, 16 - (time - lastTime));\n\n    lastTime = time + timeToCall;\n    return window.setTimeout(fn, timeToCall);\n}\n\nexport var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\nexport var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\n        getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\n\n// @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number\n// Schedules `fn` to be executed when the browser repaints. `fn` is bound to\n// `context` if given. When `immediate` is set, `fn` is called immediately if\n// the browser doesn't have native support for\n// [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\n// otherwise it's delayed. Returns a request ID that can be used to cancel the request.\nexport function requestAnimFrame(fn, context, immediate) {\n    if (immediate && requestFn === timeoutDefer) {\n        fn.call(context);\n    } else {\n        return requestFn.call(window, bind(fn, context));\n    }\n}\n\n// @function cancelAnimFrame(id: Number): undefined\n// Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\nexport function cancelAnimFrame(id) {\n    if (id) {\n        cancelFn.call(window, id);\n    }\n}\n\nexport var loader = {\n    js: function(url) {\n        var handler = { _resolved: false };\n        handler.callbacks = [];\n        handler.error = [];\n        handler.then = function(cb) {\n            handler.callbacks.push(cb);\n            if ( handler._resolved ) { return handler.resolve(); }\n            return handler;\n        }\n        handler.catch = function(cb) {\n            handler.error.push(cb);\n            if ( handler._resolved ) { return handler.reject(); }\n            return handler;\n        }\n        handler.resolve = function(_argv) {\n            // var _argv;\n            handler._resolved = true;\n            while ( handler.callbacks.length ) {\n                var cb = handler.callbacks.shift();\n                var retval;\n                try {\n                    _argv = cb(_argv);\n                } catch(e) {\n                    console.log(e);\n                    handler.reject(e);\n                    break;\n                }\n            }\n            return handler;\n        }\n\n        handler.reject = function(e) {\n            while ( handler.error.length ) {\n                var cb = handler.error.shift();\n                cb(e);\n            }\n            console.log(e);\n            console.trace();\n            return handler;\n        }\n\n        if ( url == undefined ) {\n            handler._resolved = true;\n            return handler;\n        }\n\n        var element = document.createElement('script');\n\n        element.onload = function() {\n          handler.resolve(url);\n        };\n        element.onerror = function() {\n          handler.catch.apply(arguments);\n        };\n\n        element.async = true;\n        var parent = 'body';\n        var attr = 'src';\n        element[attr] = url;\n        document[parent].appendChild(element);\n\n        console.log(\"AHOY APPENDED\", url);\n\n        return handler;\n    }\n}","import * as Util from './Util';\r\n\r\n// @class Class\r\n// @aka L.Class\r\n\r\n// @section\r\n// @uninheritable\r\n\r\n// Thanks to John Resig and Dean Edwards for inspiration!\r\n\r\nexport function Class() {}\r\n\r\nClass.extend = function (props) {\r\n\r\n\t// @function extend(props: Object): Function\r\n\t// [Extends the current class](#class-inheritance) given the properties to be included.\r\n\t// Returns a Javascript function that is a class constructor (to be called with `new`).\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tthis.callInitHooks();\r\n\t};\r\n\r\n\tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n\tvar proto = Util.create(parentProto);\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t// inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tUtil.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tcheckDeprecatedMixinEvents(props.includes);\r\n\t\tUtil.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (proto.options) {\r\n\t\tprops.options = Util.extend(Util.create(proto.options), props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tUtil.extend(proto, props);\r\n\t\r\n\tproto._initHooks = [];\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parentProto.callInitHooks) {\r\n\t\t\tparentProto.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// @function include(properties: Object): this\r\n// [Includes a mixin](#class-includes) into the current class.\r\nClass.include = function (props) {\r\n\tUtil.extend(this.prototype, props);\r\n\treturn this;\r\n};\r\n\r\n// @function mergeOptions(options: Object): this\r\n// [Merges `options`](#class-options) into the defaults of the class.\r\nClass.mergeOptions = function (options) {\r\n\tUtil.extend(this.prototype.options, options);\r\n\treturn this;\r\n};\r\n\r\n// @function addInitHook(fn: Function): this\r\n// Adds a [constructor hook](#class-constructor-hooks) to the class.\r\nClass.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n\treturn this;\r\n};\r\n\r\nfunction checkDeprecatedMixinEvents(includes) {\r\n\tif (!cozy || !cozy.Mixin) { return; }\r\n\r\n\tincludes = cozy.Util.isArray(includes) ? includes : [includes];\r\n\r\n\t// for (var i = 0; i < includes.length; i++) {\r\n\t// \tif (includes[i] === cozy.Mixin.Events) {\r\n\t// \t\tconsole.warn('Deprecated include of cozy.Mixin.Events: ' +\r\n\t// \t\t\t'this property will be removed in future releases, ' +\r\n\t// \t\t\t'please inherit from cozy.Evented instead.', new Error().stack);\r\n\t// \t}\r\n\t// }\r\n}\r\n","import {Class} from './Class';\r\nimport * as Util from './Util';\r\n\r\n/*\r\n * @class Evented\r\n * @aka L.Evented\r\n * @inherits Class\r\n *\r\n * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * map.on('click', function(e) {\r\n * \talert(e.latlng);\r\n * } );\r\n * ```\r\n *\r\n * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:\r\n *\r\n * ```js\r\n * function onClick(e) { ... }\r\n *\r\n * map.on('click', onClick);\r\n * map.off('click', onClick);\r\n * ```\r\n */\r\n\r\nexport var Evented = Class.extend({\r\n\r\n\t/* @method on(type: String, fn: Function, context?: Object): this\r\n\t * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).\r\n\t *\r\n\t * @alternative\r\n\t * @method on(eventMap: Object): this\r\n\t * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\t */\r\n\ton: function (types, fn, context) {\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\t// we don't process space-separated events here for performance;\r\n\t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n\t\t\t\tthis._on(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._on(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/* @method off(type: String, fn?: Function, context?: Object): this\r\n\t * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.\r\n\t *\r\n\t * @alternative\r\n\t * @method off(eventMap: Object): this\r\n\t * Removes a set of type/listener pairs.\r\n\t *\r\n\t * @alternative\r\n\t * @method off: this\r\n\t * Removes all listeners to all events on the object.\r\n\t */\r\n\toff: function (types, fn, context) {\r\n\r\n\t\tif (!types) {\r\n\t\t\t// clear all listeners if called without arguments\r\n\t\t\tdelete this._events;\r\n\r\n\t\t} else if (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis._off(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._off(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// attach listener (without syntactic sugar now)\r\n\t_on: function (type, fn, context) {\r\n\t\tthis._events = this._events || {};\r\n\r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._events[type];\r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._events[type] = typeListeners;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\t// Less memory footprint.\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\t\tvar newListener = {fn: fn, ctx: context},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if fn already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].fn === fn && listeners[i].ctx === context) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlisteners.push(newListener);\r\n\t},\r\n\r\n\t_off: function (type, fn, context) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n\r\n\t\tif (!this._events) { return; }\r\n\r\n\t\tlisteners = this._events[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!fn) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].fn = Util.falseFn;\r\n\t\t\t}\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._events[type];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find fn and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.ctx !== context) { continue; }\r\n\t\t\t\tif (l.fn === fn) {\r\n\r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\tl.fn = Util.falseFn;\r\n\r\n\t\t\t\t\tif (this._firingCount) {\r\n\t\t\t\t\t\t/* copy array in case events are being fired */\r\n\t\t\t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners.splice(i, 1);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// @method fire(type: String, data?: Object, propagate?: Boolean): this\r\n\t// Fires an event of the specified type. You can optionally provide an data\r\n\t// object — the first argument of the listener function will contain its\r\n\t// properties. The event can optionally be propagated to event parents.\r\n\tfire: function (type, data, propagate) {\r\n\t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n\t\tvar event = Util.extend({}, data, {type: type, target: this});\r\n\r\n\t\tif (this._events) {\r\n\t\t\tvar listeners = this._events[type];\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n\t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tvar l = listeners[i];\r\n\t\t\t\t\tl.fn.call(l.ctx || this, event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._firingCount--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// propagate the event to parents (set with addEventParent)\r\n\t\t\tthis._propagateEvent(event);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method listens(type: String): Boolean\r\n\t// Returns `true` if a particular event type has any listeners attached to it.\r\n\tlistens: function (type, propagate) {\r\n\t\tvar listeners = this._events && this._events[type];\r\n\t\tif (listeners && listeners.length) { return true; }\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// also check parents for listeners if event propagates\r\n\t\t\tfor (var id in this._eventParents) {\r\n\t\t\t\tif (this._eventParents[id].listens(type, propagate)) { return true; }\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// @method once(…): this\r\n\t// Behaves as [`on(…)`](#evented-on), except the listener will only get fired once and then removed.\r\n\tonce: function (types, fn, context) {\r\n\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis.once(type, types[type], fn);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar handler = Util.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .off(types, fn, context)\r\n\t\t\t    .off(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\t// add a listener that's executed once and removed after that\r\n\t\treturn this\r\n\t\t    .on(types, fn, context)\r\n\t\t    .on(types, handler, context);\r\n\t},\r\n\r\n\t// @method addEventParent(obj: Evented): this\r\n\t// Adds an event parent - an `Evented` that will receive propagated events\r\n\taddEventParent: function (obj) {\r\n\t\tthis._eventParents = this._eventParents || {};\r\n\t\tthis._eventParents[Util.stamp(obj)] = obj;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method removeEventParent(obj: Evented): this\r\n\t// Removes an event parent, so it will stop receiving propagated events\r\n\tremoveEventParent: function (obj) {\r\n\t\tif (this._eventParents) {\r\n\t\t\tdelete this._eventParents[Util.stamp(obj)];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\tfor (var id in this._eventParents) {\r\n\t\t\tthis._eventParents[id].fire(e.type, Util.extend({layer: e.target}, e), true);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar proto = Evented.prototype;\r\n\r\n// aliases; we should ditch those eventually\r\n\r\n// @method addEventListener(…): this\r\n// Alias to [`on(…)`](#evented-on)\r\nproto.addEventListener = proto.on;\r\n\r\n// @method removeEventListener(…): this\r\n// Alias to [`off(…)`](#evented-off)\r\n\r\n// @method clearAllEventListeners(…): this\r\n// Alias to [`off()`](#evented-off)\r\nproto.removeEventListener = proto.clearAllEventListeners = proto.off;\r\n\r\n// @method addOneTimeEventListener(…): this\r\n// Alias to [`once(…)`](#evented-once)\r\nproto.addOneTimeEventListener = proto.once;\r\n\r\n// @method fireEvent(…): this\r\n// Alias to [`fire(…)`](#evented-fire)\r\nproto.fireEvent = proto.fire;\r\n\r\n// @method hasEventListeners(…): Boolean\r\n// Alias to [`listens(…)`](#evented-listens)\r\nproto.hasEventListeners = proto.listens;\r\n","\n/*\n * @namespace Browser\n * @aka L.Browser\n *\n * A namespace with static properties for browser/feature detection used by Leaflet internally.\n *\n * @example\n *\n * ```js\n * if (L.Browser.ielt9) {\n *   alert('Upgrade your browser, dude!');\n * }\n * ```\n */\n\nvar style = document.documentElement.style;\n\n// @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).\nexport var ie = 'ActiveXObject' in window;\n\n// @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.\nexport var ielt9 = ie && !document.addEventListener;\n\n// @property edge: Boolean; `true` for the Edge web browser.\nexport var edge = 'msLaunchUri' in navigator && !('documentMode' in document);\n\n// @property webkit: Boolean;\n// `true` for webkit-based browsers like Chrome and Safari (including mobile versions).\nexport var webkit = userAgentContains('webkit');\n\n// @property android: Boolean\n// `true` for any browser running on an Android platform.\nexport var android = userAgentContains('android');\n\n// @property android23: Boolean; `true` for browsers running on Android 2 or Android 3.\nexport var android23 = userAgentContains('android 2') || userAgentContains('android 3');\n\n// @property opera: Boolean; `true` for the Opera browser\nexport var opera = !!window.opera;\n\n// @property chrome: Boolean; `true` for the Chrome browser.\nexport var chrome = userAgentContains('chrome');\n\n// @property gecko: Boolean; `true` for gecko-based browsers like Firefox.\nexport var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;\n\n// @property safari: Boolean; `true` for the Safari browser.\nexport var safari = !chrome && userAgentContains('safari');\n\nexport var phantom = userAgentContains('phantom');\n\n// @property opera12: Boolean\n// `true` for the Opera browser supporting CSS transforms (version 12 or later).\nexport var opera12 = 'OTransition' in style;\n\n// @property win: Boolean; `true` when the browser is running in a Windows platform\nexport var win = navigator.platform.indexOf('Win') === 0;\n\n// @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.\nexport var ie3d = ie && ('transition' in style);\n\n// @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.\nexport var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;\n\n// @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.\nexport var gecko3d = 'MozPerspective' in style;\n\n// @property any3d: Boolean\n// `true` for all browsers supporting CSS transforms.\nexport var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;\n\n// @property mobile: Boolean; `true` for all browsers running in a mobile device.\nexport var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');\n\n// @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.\nexport var mobileWebkit = mobile && webkit;\n\n// @property mobileWebkit3d: Boolean\n// `true` for all webkit-based browsers in a mobile device supporting CSS transforms.\nexport var mobileWebkit3d = mobile && webkit3d;\n\n// @property msPointer: Boolean\n// `true` for browsers implementing the Microsoft touch events model (notably IE10).\nexport var msPointer = !window.PointerEvent && window.MSPointerEvent;\n\n// @property pointer: Boolean\n// `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\nexport var pointer = !!(window.PointerEvent || msPointer);\n\n// @property touch: Boolean\n// `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).\n// This does not necessarily mean that the browser is running in a computer with\n// a touchscreen, it only means that the browser is capable of understanding\n// touch events.\nexport var touch = !window.L_NO_TOUCH && (pointer || 'ontouchstart' in window ||\n        (window.DocumentTouch && document instanceof window.DocumentTouch));\n\n// @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.\nexport var mobileOpera = mobile && opera;\n\n// @property mobileGecko: Boolean\n// `true` for gecko-based browsers running in a mobile device.\nexport var mobileGecko = mobile && gecko;\n\n// @property retina: Boolean\n// `true` for browsers on a high-resolution \"retina\" screen.\nexport var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;\n\n\n// @property canvas: Boolean\n// `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\nexport var canvas = (function () {\n    return !!document.createElement('canvas').getContext;\n}());\n\n// @property svg: Boolean\n// `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).\n// export var svg = !!(document.createElementNS && svgCreate('svg').createSVGRect);\nexport var svg = true;\n\n// @property vml: Boolean\n// `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).\nexport var vml = !svg && (function () {\n    try {\n        var div = document.createElement('div');\n        div.innerHTML = '<v:shape adj=\"1\"/>';\n\n        var shape = div.firstChild;\n        shape.style.behavior = 'url(#default#VML)';\n\n        return shape && (typeof shape.adj === 'object');\n\n    } catch (e) {\n        return false;\n    }\n}());\n\nexport var columnCount = ( 'columnCount' in style );\nexport var classList = ( document.documentElement.classList !== undefined );\n\nfunction userAgentContains(str) {\n    return navigator.userAgent.toLowerCase().indexOf(str) >= 0;\n}\n","import {isArray, formatNum} from '../core/Util';\r\n\r\n/*\r\n * @class Point\r\n * @aka L.Point\r\n *\r\n * Represents a point with `x` and `y` coordinates in pixels.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * var point = L.point(200, 300);\r\n * ```\r\n *\r\n * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:\r\n *\r\n * ```js\r\n * map.panBy([200, 300]);\r\n * map.panBy(L.point(200, 300));\r\n * ```\r\n */\r\n\r\nexport function Point(x, y, round) {\r\n\t// @property x: Number; The `x` coordinate of the point\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\t// @property y: Number; The `y` coordinate of the point\r\n\tthis.y = (round ? Math.round(y) : y);\r\n}\r\n\r\nPoint.prototype = {\r\n\r\n\t// @method clone(): Point\r\n\t// Returns a copy of the current point.\r\n\tclone: function () {\r\n\t\treturn new Point(this.x, this.y);\r\n\t},\r\n\r\n\t// @method add(otherPoint: Point): Point\r\n\t// Returns the result of addition of the current and the given points.\r\n\tadd: function (point) {\r\n\t\t// non-destructive, returns a new point\r\n\t\treturn this.clone()._add(toPoint(point));\r\n\t},\r\n\r\n\t_add: function (point) {\r\n\t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method subtract(otherPoint: Point): Point\r\n\t// Returns the result of subtraction of the given point from the current.\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(toPoint(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method divideBy(num: Number): Point\r\n\t// Returns the result of division of the current point by the given number.\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method multiplyBy(num: Number): Point\r\n\t// Returns the result of multiplication of the current point by the given number.\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method scaleBy(scale: Point): Point\r\n\t// Multiply each coordinate of the current point by each coordinate of\r\n\t// `scale`. In linear algebra terms, multiply the point by the\r\n\t// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)\r\n\t// defined by `scale`.\r\n\tscaleBy: function (point) {\r\n\t\treturn new Point(this.x * point.x, this.y * point.y);\r\n\t},\r\n\r\n\t// @method unscaleBy(scale: Point): Point\r\n\t// Inverse of `scaleBy`. Divide each coordinate of the current point by\r\n\t// each coordinate of `scale`.\r\n\tunscaleBy: function (point) {\r\n\t\treturn new Point(this.x / point.x, this.y / point.y);\r\n\t},\r\n\r\n\t// @method round(): Point\r\n\t// Returns a copy of the current point with rounded coordinates.\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method floor(): Point\r\n\t// Returns a copy of the current point with floored coordinates (rounded down).\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method ceil(): Point\r\n\t// Returns a copy of the current point with ceiled coordinates (rounded up).\r\n\tceil: function () {\r\n\t\treturn this.clone()._ceil();\r\n\t},\r\n\r\n\t_ceil: function () {\r\n\t\tthis.x = Math.ceil(this.x);\r\n\t\tthis.y = Math.ceil(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method distanceTo(otherPoint: Point): Number\r\n\t// Returns the cartesian distance between the current and the given points.\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\t// @method equals(otherPoint: Point): Boolean\r\n\t// Returns `true` if the given point has the same coordinates.\r\n\tequals: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\t// @method contains(otherPoint: Point): Boolean\r\n\t// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).\r\n\tcontains: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// Returns a string representation of the point for debugging purposes.\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        formatNum(this.x) + ', ' +\r\n\t\t        formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\n// @factory L.point(x: Number, y: Number, round?: Boolean)\r\n// Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Number[])\r\n// Expects an array of the form `[x, y]` instead.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Object)\r\n// Expects a plain object of the form `{x: Number, y: Number}` instead.\r\nexport function toPoint(x, y, round) {\r\n\tif (x instanceof Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (isArray(x)) {\r\n\t\treturn new Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\tif (typeof x === 'object' && 'x' in x && 'y' in x) {\r\n\t\treturn new Point(x.x, x.y);\r\n\t}\r\n\treturn new Point(x, y, round);\r\n}\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport * as Browser from '../core/Browser';\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\n\nvar POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown',\n    POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove',\n    POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup',\n    POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n    TAG_WHITE_LIST = ['INPUT', 'SELECT', 'OPTION'],\n\n    _pointers = {},\n    _pointerDocListener = false;\n\n// DomEvent.DoubleTap needs to know about this\nexport var _pointersCount = 0;\n\n// Provides a touch events wrapper for (ms)pointer events.\n// ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\nexport function addPointerListener(obj, type, handler, id) {\n\tif (type === 'touchstart') {\n\t\t_addPointerStart(obj, handler, id);\n\n\t} else if (type === 'touchmove') {\n\t\t_addPointerMove(obj, handler, id);\n\n\t} else if (type === 'touchend') {\n\t\t_addPointerEnd(obj, handler, id);\n\t}\n\n\treturn this;\n}\n\nexport function removePointerListener(obj, type, id) {\n\tvar handler = obj['_leaflet_' + type + id];\n\n\tif (type === 'touchstart') {\n\t\tobj.removeEventListener(POINTER_DOWN, handler, false);\n\n\t} else if (type === 'touchmove') {\n\t\tobj.removeEventListener(POINTER_MOVE, handler, false);\n\n\t} else if (type === 'touchend') {\n\t\tobj.removeEventListener(POINTER_UP, handler, false);\n\t\tobj.removeEventListener(POINTER_CANCEL, handler, false);\n\t}\n\n\treturn this;\n}\n\nfunction _addPointerStart(obj, handler, id) {\n\tvar onDown = Util.bind(function (e) {\n\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\n\t\t\t// In IE11, some touch events needs to fire for form controls, or\n\t\t\t// the controls will stop working. We keep a whitelist of tag names that\n\t\t\t// need these events. For other target tags, we prevent default on the event.\n\t\t\tif (TAG_WHITE_LIST.indexOf(e.target.tagName) < 0) {\n\t\t\t\tDomEvent.preventDefault(e);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t_handlePointer(e, handler);\n\t});\n\n\tobj['_leaflet_touchstart' + id] = onDown;\n\tobj.addEventListener(POINTER_DOWN, onDown, false);\n\n\t// need to keep track of what pointers and how many are active to provide e.touches emulation\n\tif (!_pointerDocListener) {\n\t\t// we listen documentElement as any drags that end by moving the touch off the screen get fired there\n\t\tdocument.documentElement.addEventListener(POINTER_DOWN, _globalPointerDown, true);\n\t\tdocument.documentElement.addEventListener(POINTER_MOVE, _globalPointerMove, true);\n\t\tdocument.documentElement.addEventListener(POINTER_UP, _globalPointerUp, true);\n\t\tdocument.documentElement.addEventListener(POINTER_CANCEL, _globalPointerUp, true);\n\n\t\t_pointerDocListener = true;\n\t}\n}\n\nfunction _globalPointerDown(e) {\n\t_pointers[e.pointerId] = e;\n\t_pointersCount++;\n}\n\nfunction _globalPointerMove(e) {\n\tif (_pointers[e.pointerId]) {\n\t\t_pointers[e.pointerId] = e;\n\t}\n}\n\nfunction _globalPointerUp(e) {\n\tdelete _pointers[e.pointerId];\n\t_pointersCount--;\n}\n\nfunction _handlePointer(e, handler) {\n\te.touches = [];\n\tfor (var i in _pointers) {\n\t\te.touches.push(_pointers[i]);\n\t}\n\te.changedTouches = [e];\n\n\thandler(e);\n}\n\nfunction _addPointerMove(obj, handler, id) {\n\tvar onMove = function (e) {\n\t\t// don't fire touch moves when mouse isn't down\n\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchmove' + id] = onMove;\n\tobj.addEventListener(POINTER_MOVE, onMove, false);\n}\n\nfunction _addPointerEnd(obj, handler, id) {\n\tvar onUp = function (e) {\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchend' + id] = onUp;\n\tobj.addEventListener(POINTER_UP, onUp, false);\n\tobj.addEventListener(POINTER_CANCEL, onUp, false);\n}\n\n","import * as Browser from '../core/Browser';\r\nimport {_pointersCount} from './DomEvent.Pointer';\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nvar _touchstart = Browser.msPointer ? 'MSPointerDown' : Browser.pointer ? 'pointerdown' : 'touchstart',\r\n    _touchend = Browser.msPointer ? 'MSPointerUp' : Browser.pointer ? 'pointerup' : 'touchend',\r\n    _pre = '_leaflet_';\r\n\r\n// inspired by Zepto touch code by Thomas Fuchs\r\nexport function addDoubleTapListener(obj, handler, id) {\r\n\tvar last, touch,\r\n\t    doubleTap = false,\r\n\t    delay = 250;\r\n\r\n\tfunction onTouchStart(e) {\r\n\t\tvar count;\r\n\r\n\t\tif (Browser.pointer) {\r\n\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\tcount = _pointersCount;\r\n\t\t} else {\r\n\t\t\tcount = e.touches.length;\r\n\t\t}\r\n\r\n\t\tif (count > 1) { return; }\r\n\r\n\t\tvar now = Date.now(),\r\n\t\t    delta = now - (last || now);\r\n\r\n\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\tlast = now;\r\n\t}\r\n\r\n\tfunction onTouchEnd(e) {\r\n\t\tif (doubleTap && !touch.cancelBubble) {\r\n\t\t\tif (Browser.pointer) {\r\n\t\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\tvar newTouch = {},\r\n\t\t\t\t    prop, i;\r\n\r\n\t\t\t\tfor (i in touch) {\r\n\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\tnewTouch[i] = prop && prop.bind ? prop.bind(touch) : prop;\r\n\t\t\t\t}\r\n\t\t\t\ttouch = newTouch;\r\n\t\t\t}\r\n\t\t\ttouch.type = 'dblclick';\r\n\t\t\thandler(touch);\r\n\t\t\tlast = null;\r\n\t\t}\r\n\t}\r\n\r\n\tobj[_pre + _touchstart + id] = onTouchStart;\r\n\tobj[_pre + _touchend + id] = onTouchEnd;\r\n\tobj[_pre + 'dblclick' + id] = handler;\r\n\r\n\tobj.addEventListener(_touchstart, onTouchStart, false);\r\n\tobj.addEventListener(_touchend, onTouchEnd, false);\r\n\r\n\t// On some platforms (notably, chrome<55 on win10 + touchscreen + mouse),\r\n\t// the browser doesn't fire touchend/pointerup events but does fire\r\n\t// native dblclicks. See #4127.\r\n\t// Edge 14 also fires native dblclicks, but only for pointerType mouse, see #5180.\r\n\tobj.addEventListener('dblclick', handler, false);\r\n\r\n\treturn this;\r\n}\r\n\r\nexport function removeDoubleTapListener(obj, id) {\r\n\tvar touchstart = obj[_pre + _touchstart + id],\r\n\t    touchend = obj[_pre + _touchend + id],\r\n\t    dblclick = obj[_pre + 'dblclick' + id];\r\n\r\n\tobj.removeEventListener(_touchstart, touchstart, false);\r\n\tobj.removeEventListener(_touchend, touchend, false);\r\n\tif (!Browser.edge) {\r\n\t\tobj.removeEventListener('dblclick', dblclick, false);\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n","import {Point} from '../geometry/Point';\r\nimport * as Util from '../core/Util';\r\nimport * as Browser from '../core/Browser';\r\nimport {addPointerListener, removePointerListener} from './DomEvent.Pointer';\r\nimport {addDoubleTapListener, removeDoubleTapListener} from './DomEvent.DoubleTap';\r\n\r\n/*\r\n * @namespace DomEvent\r\n * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.\r\n */\r\n\r\n// Inspired by John Resig, Dean Edwards and YUI addEvent implementations.\r\n\r\n// @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Adds a listener function (`fn`) to a particular DOM event type of the\r\n// element `el`. You can optionally specify the context of the listener\r\n// (object the `this` keyword will point to). You can also pass several\r\n// space-separated types (e.g. `'click dblclick'`).\r\n\r\n// @alternative\r\n// @function on(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\nexport function on(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\taddOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\taddOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\n// @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Removes a previously added listener function. If no function is specified,\r\n// it will remove all the listeners of that particular DOM event from the element.\r\n// Note that if you passed a custom context to on, you must pass the same\r\n// context to `off` in order to remove the listener.\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement): this\r\n// Removes all known event listeners\r\nexport function off(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\tremoveOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else if (types) {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\tremoveOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var j in obj[eventsKey]) {\r\n\t\t\tremoveOne(obj, j, obj[eventsKey][j]);\r\n\t\t}\r\n\t\tdelete obj[eventsKey];\r\n\t}\r\n}\r\n\r\nfunction addOne(obj, type, fn, context) {\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : '');\r\n\r\n\tif (obj[eventsKey] && obj[eventsKey][id]) { return this; }\r\n\r\n\tvar handler = function (e) {\r\n\t\treturn fn.call(context || obj, e || window.event);\r\n\t};\r\n\r\n\tvar originalHandler = handler;\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t// Needs DomEvent.Pointer.js\r\n\t\taddPointerListener(obj, type, handler, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && addDoubleTapListener &&\r\n\t           !(Browser.pointer && Browser.chrome)) {\r\n\t\t// Chrome >55 does not need the synthetic dblclicks from addDoubleTapListener\r\n\t\t// See #5180\r\n\t\taddDoubleTapListener(obj, handler, id);\r\n\r\n\t} else if ('addEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.addEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\thandler = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif (isExternalTarget(obj, e)) {\r\n\t\t\t\t\toriginalHandler(e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tobj.addEventListener(type === 'mouseenter' ? 'mouseover' : 'mouseout', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tif (type === 'click' && Browser.android) {\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tfilterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('attachEvent' in obj) {\r\n\t\tobj.attachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey] = obj[eventsKey] || {};\r\n\tobj[eventsKey][id] = handler;\r\n}\r\n\r\nfunction removeOne(obj, type, fn, context) {\r\n\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : ''),\r\n\t    handler = obj[eventsKey] && obj[eventsKey][id];\r\n\r\n\tif (!handler) { return this; }\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\tremovePointerListener(obj, type, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && removeDoubleTapListener) {\r\n\t\tremoveDoubleTapListener(obj, id);\r\n\r\n\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.removeEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tobj.removeEventListener(\r\n\t\t\t\ttype === 'mouseenter' ? 'mouseover' :\r\n\t\t\t\ttype === 'mouseleave' ? 'mouseout' : type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('detachEvent' in obj) {\r\n\t\tobj.detachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey][id] = null;\r\n}\r\n\r\n// @function stopPropagation(ev: DOMEvent): this\r\n// Stop the given event from propagation to parent elements. Used inside the listener functions:\r\n// ```js\r\n// L.DomEvent.on(div, 'click', function (ev) {\r\n// \tL.DomEvent.stopPropagation(ev);\r\n// });\r\n// ```\r\nexport function stopPropagation(e) {\r\n\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else if (e.originalEvent) {  // In case of Leaflet event.\r\n\t\te.originalEvent._stopped = true;\r\n\t} else {\r\n\t\te.cancelBubble = true;\r\n\t}\r\n\tskipped(e);\r\n\r\n\treturn this;\r\n}\r\n\r\n// @function disableScrollPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'mousewheel'` events (plus browser variants).\r\nexport function disableScrollPropagation(el) {\r\n\treturn addOne(el, 'mousewheel', stopPropagation);\r\n}\r\n\r\n// @function disableClickPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'click'`, `'doubleclick'`,\r\n// `'mousedown'` and `'touchstart'` events (plus browser variants).\r\nexport function disableClickPropagation(el) {\r\n\ton(el, 'mousedown touchstart dblclick', stopPropagation);\r\n\taddOne(el, 'click', fakeStop);\r\n\treturn this;\r\n}\r\n\r\n// @function preventDefault(ev: DOMEvent): this\r\n// Prevents the default action of the DOM Event `ev` from happening (such as\r\n// following a link in the href of the a element, or doing a POST request\r\n// with page reload when a `<form>` is submitted).\r\n// Use it inside listener functions.\r\nexport function preventDefault(e) {\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// @function stop(ev): this\r\n// Does `stopPropagation` and `preventDefault` at the same time.\r\nexport function stop(e) {\r\n\tpreventDefault(e);\r\n\tstopPropagation(e);\r\n\treturn this;\r\n}\r\n\r\n// @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point\r\n// Gets normalized mouse position from a DOM event relative to the\r\n// `container` or to the whole page if not specified.\r\nexport function getMousePosition(e, container) {\r\n\tif (!container) {\r\n\t\treturn new Point(e.clientX, e.clientY);\r\n\t}\r\n\r\n\tvar rect = container.getBoundingClientRect();\r\n\r\n\treturn new Point(\r\n\t\te.clientX - rect.left - container.clientLeft,\r\n\t\te.clientY - rect.top - container.clientTop);\r\n}\r\n\r\n// Chrome on Win scrolls double the pixels as in other platforms (see #4538),\r\n// and Firefox scrolls device pixels, not CSS pixels\r\nvar wheelPxFactor =\r\n\t(Browser.win && Browser.chrome) ? 2 :\r\n\tBrowser.gecko ? window.devicePixelRatio : 1;\r\n\r\n// @function getWheelDelta(ev: DOMEvent): Number\r\n// Gets normalized wheel delta from a mousewheel DOM event, in vertical\r\n// pixels scrolled (negative if scrolling down).\r\n// Events from pointing devices without precise scrolling are mapped to\r\n// a best guess of 60 pixels.\r\nexport function getWheelDelta(e) {\r\n\treturn (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta\r\n\t       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels\r\n\t       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines\r\n\t       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages\r\n\t       (e.deltaX || e.deltaZ) ? 0 :\t// Skip horizontal/depth wheel events\r\n\t       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels\r\n\t       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines\r\n\t       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages\r\n\t       0;\r\n}\r\n\r\nvar skipEvents = {};\r\n\r\nexport function fakeStop(e) {\r\n\t// fakes stopPropagation by setting a special event flag, checked/reset with skipped(e)\r\n\tskipEvents[e.type] = true;\r\n}\r\n\r\nexport function skipped(e) {\r\n\tvar events = skipEvents[e.type];\r\n\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\tskipEvents[e.type] = false;\r\n\treturn events;\r\n}\r\n\r\n// check if element really left/entered the event target (for mouseenter/mouseleave)\r\nexport function isExternalTarget(el, e) {\r\n\r\n\tvar related = e.relatedTarget;\r\n\r\n\tif (!related) { return true; }\r\n\r\n\ttry {\r\n\t\twhile (related && (related !== el)) {\r\n\t\t\trelated = related.parentNode;\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn false;\r\n\t}\r\n\treturn (related !== el);\r\n}\r\n\r\nvar lastClick;\r\n\r\n// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\nfunction filterClick(e, handler) {\r\n\tvar timeStamp = (e.timeStamp || (e.originalEvent && e.originalEvent.timeStamp)),\r\n\t    elapsed = lastClick && (timeStamp - lastClick);\r\n\r\n\t// are they closer together than 500ms yet more than 100ms?\r\n\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t// on the same event should be triggered far faster;\r\n\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\tstop(e);\r\n\t\treturn;\r\n\t}\r\n\tlastClick = timeStamp;\r\n\r\n\thandler(e);\r\n}\r\n\r\n// @function addListener(…): this\r\n// Alias to [`L.DomEvent.on`](#domevent-on)\r\nexport {on as addListener};\r\n\r\n// @function removeListener(…): this\r\n// Alias to [`L.DomEvent.off`](#domevent-off)\r\nexport {off as removeListener};\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport {Point} from '../geometry/Point';\nimport * as Browser from '../core/Browser';\n\n/*\n * @namespace DomUtil\n *\n * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\n * tree, used by Leaflet internally.\n *\n * Most functions expecting or returning a `HTMLElement` also work for\n * SVG elements. The only difference is that classes refer to CSS classes\n * in HTML and SVG classes in SVG.\n */\n\n if (!Element.prototype.matches) {\n    var ep = Element.prototype;\n \n    if (ep.webkitMatchesSelector) // Chrome <34, SF<7.1, iOS<8\n      ep.matches = ep.webkitMatchesSelector;\n \n    if (ep.msMatchesSelector) // IE9/10/11 & Edge\n      ep.matches = ep.msMatchesSelector;\n \n    if (ep.mozMatchesSelector) // FF<34\n      ep.matches = ep.mozMatchesSelector;\n }\n\n// @property TRANSFORM: String\n// Vendor-prefixed fransform style name (e.g. `'webkitTransform'` for WebKit).\nexport var TRANSFORM = testProp(\n    ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\n\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\n// the same for the transitionend event, in particular the Android 4.1 stock browser\n\n// @property TRANSITION: String\n// Vendor-prefixed transform style name.\nexport var TRANSITION = testProp(\n    ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\n\nexport var TRANSITION_END =\n    TRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';\n\n\n// @function get(id: String|HTMLElement): HTMLElement\n// Returns an element given its DOM id, or returns the element itself\n// if it was passed directly.\nexport function get(id) {\n    return typeof id === 'string' ? document.getElementById(id) : id;\n}\n\n// @function getStyle(el: HTMLElement, styleAttrib: String): String\n// Returns the value for a certain style attribute on an element,\n// including computed values or values set through CSS.\nexport function getStyle(el, style) {\n    var value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\n\n    if ((!value || value === 'auto') && document.defaultView) {\n        var css = document.defaultView.getComputedStyle(el, null);\n        value = css ? css[style] : null;\n    }\n    return value === 'auto' ? null : value;\n}\n\n// @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\n// Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\nexport function create(tagName, className, container) {\n    var el = document.createElement(tagName);\n    el.className = className || '';\n\n    if (container) {\n        container.appendChild(el);\n    }\n    return el;\n}\n\n// @function remove(el: HTMLElement)\n// Removes `el` from its parent element\nexport function remove(el) {\n    var parent = el.parentNode;\n    if (parent) {\n        parent.removeChild(el);\n    }\n}\n\n// @function empty(el: HTMLElement)\n// Removes all of `el`'s children elements from `el`\nexport function empty(el) {\n    while (el.firstChild) {\n        el.removeChild(el.firstChild);\n    }\n}\n\n// @function toFront(el: HTMLElement)\n// Makes `el` the last child of its parent, so it renders in front of the other children.\nexport function toFront(el) {\n    el.parentNode.appendChild(el);\n}\n\n// @function toBack(el: HTMLElement)\n// Makes `el` the first child of its parent, so it renders behind the other children.\nexport function toBack(el) {\n    var parent = el.parentNode;\n    parent.insertBefore(el, parent.firstChild);\n}\n\n// @function hasClass(el: HTMLElement, name: String): Boolean\n// Returns `true` if the element's class attribute contains `name`.\nexport function hasClass(el, name) {\n    if (el.classList !== undefined) {\n        return el.classList.contains(name);\n    }\n    var className = getClass(el);\n    return className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\n}\n\n// @function addClass(el: HTMLElement, name: String)\n// Adds `name` to the element's class attribute.\nexport function addClass(el, name) {\n    if (el.classList !== undefined) {\n        var classes = Util.splitWords(name);\n        for (var i = 0, len = classes.length; i < len; i++) {\n            el.classList.add(classes[i]);\n        }\n    } else if (!hasClass(el, name)) {\n        var className = getClass(el);\n        setClass(el, (className ? className + ' ' : '') + name);\n    }\n}\n\n// @function removeClass(el: HTMLElement, name: String)\n// Removes `name` from the element's class attribute.\nexport function removeClass(el, name) {\n    if (el.classList !== undefined) {\n        el.classList.remove(name);\n    } else {\n        setClass(el, Util.trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\n    }\n}\n\n// @function setClass(el: HTMLElement, name: String)\n// Sets the element's class.\nexport function setClass(el, name) {\n    if (el.className.baseVal === undefined) {\n        el.className = name;\n    } else {\n        // in case of SVG element\n        el.className.baseVal = name;\n    }\n}\n\n// @function getClass(el: HTMLElement): String\n// Returns the element's class.\nexport function getClass(el) {\n    return el.className.baseVal === undefined ? el.className : el.className.baseVal;\n}\n\n// @function setOpacity(el: HTMLElement, opacity: Number)\n// Set the opacity of an element (including old IE support).\n// `opacity` must be a number from `0` to `1`.\nexport function setOpacity(el, value) {\n    if ('opacity' in el.style) {\n        el.style.opacity = value;\n    } else if ('filter' in el.style) {\n        _setOpacityIE(el, value);\n    }\n}\n\nfunction _setOpacityIE(el, value) {\n    var filter = false,\n        filterName = 'DXImageTransform.Microsoft.Alpha';\n\n    // filters collection throws an error if we try to retrieve a filter that doesn't exist\n    try {\n        filter = el.filters.item(filterName);\n    } catch (e) {\n        // don't set opacity to 1 if we haven't already set an opacity,\n        // it isn't needed and breaks transparent pngs.\n        if (value === 1) { return; }\n    }\n\n    value = Math.round(value * 100);\n\n    if (filter) {\n        filter.Enabled = (value !== 100);\n        filter.Opacity = value;\n    } else {\n        el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\n    }\n}\n\n// @function testProp(props: String[]): String|false\n// Goes through the array of style names and returns the first name\n// that is a valid style name for an element. If no such name is found,\n// it returns false. Useful for vendor-prefixed styles like `transform`.\nexport function testProp(props) {\n    var style = document.documentElement.style;\n\n    for (var i = 0; i < props.length; i++) {\n        if (props[i] in style) {\n            return props[i];\n        }\n    }\n    return false;\n}\n\nexport function isPropertySupported(prop) {\n    var style = document.documentElement.style;\n    return prop in style;\n}\n\n// @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\n// Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\n// and optionally scaled by `scale`. Does not have an effect if the\n// browser doesn't support 3D CSS transforms.\nexport function setTransform(el, offset, scale) {\n    var pos = offset || new Point(0, 0);\n\n    el.style[TRANSFORM] =\n        (Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n}\n\n// @function setPosition(el: HTMLElement, position: Point)\n// Sets the position of `el` to coordinates specified by `position`,\n// using CSS translate or top/left positioning depending on the browser\n// (used by Leaflet internally to position its layers).\nexport function setPosition(el, point) {\n\n    /*eslint-disable */\n    el._leaflet_pos = point;\n    /*eslint-enable */\n\n    if (Browser.any3d) {\n        setTransform(el, point);\n    } else {\n        el.style.left = point.x + 'px';\n        el.style.top = point.y + 'px';\n    }\n}\n\n// @function getPosition(el: HTMLElement): Point\n// Returns the coordinates of an element previously positioned with setPosition.\nexport function getPosition(el) {\n    // this method is only used for elements previously positioned using setPosition,\n    // so it's safe to cache the position for performance\n\n    return el._leaflet_pos || new Point(0, 0);\n}\n\n// @function disableTextSelection()\n// Prevents the user from generating `selectstart` DOM events, usually generated\n// when the user drags the mouse through a page with text. Used internally\n// by Leaflet to override the behaviour of any click-and-drag interaction on\n// the map. Affects drag interactions on the whole document.\n\n// @function enableTextSelection()\n// Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).\nexport var disableTextSelection;\nexport var enableTextSelection;\nvar _userSelect;\nif ('onselectstart' in document) {\n    disableTextSelection = function () {\n        DomEvent.on(window, 'selectstart', DomEvent.preventDefault);\n    };\n    enableTextSelection = function () {\n        DomEvent.off(window, 'selectstart', DomEvent.preventDefault);\n    };\n} else {\n    var userSelectProperty = testProp(\n        ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\n\n    disableTextSelection = function () {\n        if (userSelectProperty) {\n            var style = document.documentElement.style;\n            _userSelect = style[userSelectProperty];\n            style[userSelectProperty] = 'none';\n        }\n    };\n    enableTextSelection = function () {\n        if (userSelectProperty) {\n            document.documentElement.style[userSelectProperty] = _userSelect;\n            _userSelect = undefined;\n        }\n    };\n}\n\n// @function disableImageDrag()\n// As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\n// for `dragstart` DOM events, usually generated when the user drags an image.\nexport function disableImageDrag() {\n    DomEvent.on(window, 'dragstart', DomEvent.preventDefault);\n}\n\n// @function enableImageDrag()\n// Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).\nexport function enableImageDrag() {\n    DomEvent.off(window, 'dragstart', DomEvent.preventDefault);\n}\n\nvar _outlineElement, _outlineStyle;\n// @function preventOutline(el: HTMLElement)\n// Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\n// of the element `el` invisible. Used internally by Leaflet to prevent\n// focusable elements from displaying an outline when the user performs a\n// drag interaction on them.\nexport function preventOutline(element) {\n    while (element.tabIndex === -1) {\n        element = element.parentNode;\n    }\n    if (!element || !element.style) { return; }\n    restoreOutline();\n    _outlineElement = element;\n    _outlineStyle = element.style.outline;\n    element.style.outline = 'none';\n    DomEvent.on(window, 'keydown', restoreOutline);\n}\n\n// @function restoreOutline()\n// Cancels the effects of a previous [`L.DomUtil.preventOutline`]().\nexport function restoreOutline() {\n    if (!_outlineElement) { return; }\n    _outlineElement.style.outline = _outlineStyle;\n    _outlineElement = undefined;\n    _outlineStyle = undefined;\n    DomEvent.off(window, 'keydown', restoreOutline);\n}\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","var baseGetTag = require('./_baseGetTag'),\n    isObject = require('./isObject');\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nmodule.exports = isFunction;\n","var root = require('./_root');\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nmodule.exports = coreJsData;\n","var coreJsData = require('./_coreJsData');\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nmodule.exports = isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nmodule.exports = toSource;\n","var isFunction = require('./isFunction'),\n    isMasked = require('./_isMasked'),\n    isObject = require('./isObject'),\n    toSource = require('./_toSource');\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nmodule.exports = baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nmodule.exports = getValue;\n","var baseIsNative = require('./_baseIsNative'),\n    getValue = require('./_getValue');\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nmodule.exports = getNative;\n","var getNative = require('./_getNative');\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nmodule.exports = defineProperty;\n","var defineProperty = require('./_defineProperty');\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nmodule.exports = baseAssignValue;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nmodule.exports = eq;\n","var baseAssignValue = require('./_baseAssignValue'),\n    eq = require('./eq');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nmodule.exports = assignValue;\n","var assignValue = require('./_assignValue'),\n    baseAssignValue = require('./_baseAssignValue');\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nmodule.exports = copyObject;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nmodule.exports = identity;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nmodule.exports = apply;\n","var apply = require('./_apply');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nmodule.exports = overRest;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nmodule.exports = constant;\n","var constant = require('./constant'),\n    defineProperty = require('./_defineProperty'),\n    identity = require('./identity');\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nmodule.exports = baseSetToString;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nmodule.exports = shortOut;\n","var baseSetToString = require('./_baseSetToString'),\n    shortOut = require('./_shortOut');\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nmodule.exports = setToString;\n","var identity = require('./identity'),\n    overRest = require('./_overRest'),\n    setToString = require('./_setToString');\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nmodule.exports = baseRest;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nmodule.exports = isLength;\n","var isFunction = require('./isFunction'),\n    isLength = require('./isLength');\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nmodule.exports = isArrayLike;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\nmodule.exports = isIndex;\n","var eq = require('./eq'),\n    isArrayLike = require('./isArrayLike'),\n    isIndex = require('./_isIndex'),\n    isObject = require('./isObject');\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nmodule.exports = isIterateeCall;\n","var baseRest = require('./_baseRest'),\n    isIterateeCall = require('./_isIterateeCall');\n\n/**\n * Creates a function like `_.assign`.\n *\n * @private\n * @param {Function} assigner The function to assign values.\n * @returns {Function} Returns the new assigner function.\n */\nfunction createAssigner(assigner) {\n  return baseRest(function(object, sources) {\n    var index = -1,\n        length = sources.length,\n        customizer = length > 1 ? sources[length - 1] : undefined,\n        guard = length > 2 ? sources[2] : undefined;\n\n    customizer = (assigner.length > 3 && typeof customizer == 'function')\n      ? (length--, customizer)\n      : undefined;\n\n    if (guard && isIterateeCall(sources[0], sources[1], guard)) {\n      customizer = length < 3 ? undefined : customizer;\n      length = 1;\n    }\n    object = Object(object);\n    while (++index < length) {\n      var source = sources[index];\n      if (source) {\n        assigner(object, source, index, customizer);\n      }\n    }\n    return object;\n  });\n}\n\nmodule.exports = createAssigner;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nmodule.exports = isPrototype;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nmodule.exports = baseTimes;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nmodule.exports = baseIsArguments;\n","var baseIsArguments = require('./_baseIsArguments'),\n    isObjectLike = require('./isObjectLike');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nmodule.exports = isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nmodule.exports = isArray;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = stubFalse;\n","var root = require('./_root'),\n    stubFalse = require('./stubFalse');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nmodule.exports = isBuffer;\n","var baseGetTag = require('./_baseGetTag'),\n    isLength = require('./isLength'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nmodule.exports = baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nmodule.exports = baseUnary;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nmodule.exports = nodeUtil;\n","var baseIsTypedArray = require('./_baseIsTypedArray'),\n    baseUnary = require('./_baseUnary'),\n    nodeUtil = require('./_nodeUtil');\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nmodule.exports = isTypedArray;\n","var baseTimes = require('./_baseTimes'),\n    isArguments = require('./isArguments'),\n    isArray = require('./isArray'),\n    isBuffer = require('./isBuffer'),\n    isIndex = require('./_isIndex'),\n    isTypedArray = require('./isTypedArray');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = arrayLikeKeys;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nmodule.exports = overArg;\n","var overArg = require('./_overArg');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nmodule.exports = nativeKeys;\n","var isPrototype = require('./_isPrototype'),\n    nativeKeys = require('./_nativeKeys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseKeys;\n","var arrayLikeKeys = require('./_arrayLikeKeys'),\n    baseKeys = require('./_baseKeys'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nmodule.exports = keys;\n","var assignValue = require('./_assignValue'),\n    copyObject = require('./_copyObject'),\n    createAssigner = require('./_createAssigner'),\n    isArrayLike = require('./isArrayLike'),\n    isPrototype = require('./_isPrototype'),\n    keys = require('./keys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns own enumerable string keyed properties of source objects to the\n * destination object. Source objects are applied from left to right.\n * Subsequent sources overwrite property assignments of previous sources.\n *\n * **Note:** This method mutates `object` and is loosely based on\n * [`Object.assign`](https://mdn.io/Object/assign).\n *\n * @static\n * @memberOf _\n * @since 0.10.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @see _.assignIn\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * function Bar() {\n *   this.c = 3;\n * }\n *\n * Foo.prototype.b = 2;\n * Bar.prototype.d = 4;\n *\n * _.assign({ 'a': 0 }, new Foo, new Bar);\n * // => { 'a': 1, 'c': 3 }\n */\nvar assign = createAssigner(function(object, source) {\n  if (isPrototype(source) || isArrayLike(source)) {\n    copyObject(source, keys(source), object);\n    return;\n  }\n  for (var key in source) {\n    if (hasOwnProperty.call(source, key)) {\n      assignValue(object, key, source[key]);\n    }\n  }\n});\n\nmodule.exports = assign;\n","var document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\nvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\nvar fn = (function () {\n  var val;\n\n  var fnMap = [\n    [\n      'requestFullscreen',\n      'exitFullscreen',\n      'fullscreenElement',\n      'fullscreenEnabled',\n      'fullscreenchange',\n      'fullscreenerror'\n    ],\n    // New WebKit\n    [\n      'webkitRequestFullscreen',\n      'webkitExitFullscreen',\n      'webkitFullscreenElement',\n      'webkitFullscreenEnabled',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    // Old WebKit (Safari 5.1)\n    [\n      'webkitRequestFullScreen',\n      'webkitCancelFullScreen',\n      'webkitCurrentFullScreenElement',\n      'webkitCancelFullScreen',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    [\n      'mozRequestFullScreen',\n      'mozCancelFullScreen',\n      'mozFullScreenElement',\n      'mozFullScreenEnabled',\n      'mozfullscreenchange',\n      'mozfullscreenerror'\n    ],\n    [\n      'msRequestFullscreen',\n      'msExitFullscreen',\n      'msFullscreenElement',\n      'msFullscreenEnabled',\n      'MSFullscreenChange',\n      'MSFullscreenError'\n    ]\n  ];\n\n  var i = 0;\n  var l = fnMap.length;\n  var ret = {};\n\n  for (; i < l; i++) {\n    val = fnMap[i];\n    if (val && val[1] in document) {\n      for (i = 0; i < val.length; i++) {\n        ret[fnMap[0][i]] = val[i];\n      }\n      return ret;\n    }\n  }\n\n  return false;\n})();\n\nvar eventNameMap = {\n  change: fn.fullscreenchange,\n  error: fn.fullscreenerror\n};\n\nvar screenfull = {\n  request: function (elem) {\n    var request = fn.requestFullscreen;\n\n    elem = elem || document.documentElement;\n\n    // Work around Safari 5.1 bug: reports support for\n    // keyboard in fullscreen even though it doesn't.\n    // Browser sniffing, since the alternative with\n    // setTimeout is even worse.\n    if (/5\\.1[.\\d]* Safari/.test(navigator.userAgent)) {\n      elem[request]();\n    } else {\n      elem[request](keyboardAllowed && Element.ALLOW_KEYBOARD_INPUT);\n    }\n  },\n  exit: function () {\n    document[fn.exitFullscreen]();\n  },\n  toggle: function (elem) {\n    if (this.isFullscreen) {\n      this.exit();\n    } else {\n      this.request(elem);\n    }\n  },\n  onchange: function (callback) {\n    this.on('change', callback);\n  },\n  onerror: function (callback) {\n    this.on('error', callback);\n  },\n  on: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.addEventListener(eventName, callback, false);\n    }\n  },\n  off: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.removeEventListener(eventName, callback, false);\n    }\n  },\n  raw: fn\n};\n\nObject.defineProperties(screenfull, {\n  isFullscreen: {\n    get: function () {\n      return Boolean(document[fn.fullscreenElement]);\n    }\n  },\n  element: {\n    enumerable: true,\n    get: function () {\n      return document[fn.fullscreenElement];\n    }\n  },\n  enabled: {\n    enumerable: true,\n    get: function () {\n      // Coerce to boolean in case of old WebKit\n      return Boolean(document[fn.fullscreenEnabled]);\n    }\n  }\n});\n\nexport {screenfull};","import * as Util from '../core/Util';\nimport {Evented} from '../core/Events';\n// import {Class} from '../core/Class';\nimport * as Browser from '../core/Browser';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as DomUtil from '../dom/DomUtil';\n\nimport debounce from 'lodash/debounce';\nimport assign from 'lodash/assign';\n\nimport {screenfull} from '../screenfull';\n\n/*\n * @class Reader\n * @aka cozy.Map\n * @inherits Evented\n *\n * The central class of the API — it is used to create a book on a page and manipulate it.\n *\n * @example\n *\n * ```js\n * // initialize the map on the \"map\" div with a given center and zoom\n * var map = L.map('map', {\n *  center: [51.505, -0.09],\n *  zoom: 13\n * });\n * ```\n *\n */\n\nvar _padding = 1.0;\nexport var Reader = Evented.extend({\n  options: {\n    regions: [\n      'header',\n      'toolbar.top',\n      'toolbar.left',\n      'main',\n      'toolbar.right',\n      'toolbar.bottom',\n      'footer'\n    ],\n    metadata: {},\n    flow: 'auto',\n    engine: 'epubjs',\n    fontSizeLarge: '140%',\n    fontSizeSmall: '90%',\n    fontSizeDefault: '100%',\n    trackResize: true,\n    text_size: 100,\n    mobileMediaQuery: '(min-device-width : 300px) and (max-device-width : 600px)',\n    forceScrolledDocHeight: 1200,\n    theme: 'default',\n    rootfilePath: '',\n    themes: []\n  },\n\n  initialize: function(id, options) {\n    var self = this\n\n    self._original_document_title = document.title;\n\n    if ( localStorage.getItem('cozy.options') ) {\n      options = assign(options, JSON.parse(localStorage.getItem('cozy.options')));\n    }\n    options = Util.setOptions(this, options);\n\n    this._checkFeatureCompatibility();\n\n    this.metadata = this.options.metadata; // initial seed\n\n    this._initContainer(id);\n    this._initLayout();\n\n    if ( this.options.themes && this.options.themes.length > 0 ) {\n        this.options.themes.forEach(function(theme) {\n            if ( theme.href ) { return; }\n            var klass = theme.klass;\n            var rules = {};\n            for(var rule in theme.rules) {\n                var new_rule = '.' + klass;\n                if ( rule == 'body' ) { new_rule = 'body' + new_rule; }\n                else { new_rule += ' ' + rule ; }\n                rules[new_rule] = theme.rules[rule];\n            }\n            theme.rules = rules;\n        });\n    }\n\n    this._updateTheme();\n\n    // hack for https://github.com/Leaflet/Leaflet/issues/1980\n    // this._onResize = Util.bind(this._onResize, this);\n\n    this._initEvents();\n\n    this.callInitHooks();\n\n    this._mode = this.options.mode;\n  },\n\n  start: function(target, cb) {\n    var self = this;\n\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      cb = target;\n      target = undefined;\n    }\n\n    self._start(target, cb);\n\n    // Util.loader.js(this.options.engine_href).then(function() {\n    //   self._start(target, cb);\n    //   self._loaded = true;\n    // })\n  },\n\n  _start: function(target, cb) {\n    var self = this;\n    target = target || 0;\n\n    // self.open(function() {\n    //   self.draw(target, cb);\n    // });\n\n    self.open(target, cb);\n  },\n\n  reopen: function(options, target) {\n    /* NOP */\n  },\n\n  saveOptions: function(options) {\n    var saved_options = {};\n    assign(saved_options, options);\n    if ( saved_options.flow == 'auto' ) {\n      // do not save\n      delete saved_options.flow;\n    }\n    localStorage.setItem('cozy.options', JSON.stringify(saved_options));\n  },\n\n  _updateTheme: function() {\n    DomUtil.removeClass(this._container, 'cozy-theme-' + ( this._container.dataset.theme || 'default' ));\n    DomUtil.addClass(this._container, 'cozy-theme-' + this.options.theme);\n    this._container.dataset.theme = this.options.theme;\n  },\n\n  draw: function(target) {\n    // NOOP\n  },\n\n  next: function() {\n    // NOOP\n  },\n\n  prev: function() {\n    // NOOP\n  },\n\n  display: function(index) {\n    // NOOP\n  },\n\n  gotoPage: function(target) {\n    // NOOP\n  },\n\n  goBack: function() {\n    history.back();\n  },\n\n  goForward: function() {\n    history.forward();\n  },\n\n  requestFullscreen: function() {\n    if ( screenfull.enabled ) {\n      // this._preResize();\n      screenfull.toggle(this._container);\n    }\n  },\n\n  _preResize: function() {\n\n  },\n\n  _initContainer: function (id) {\n    var container = this._container = DomUtil.get(id);\n\n    if (!container) {\n      throw new Error('Reader container not found.');\n    } else if (container._cozy_id) {\n      throw new Error('Reader container is already initialized.');\n    }\n\n    DomEvent.on(container, 'scroll', this._onScroll, this);\n    this._containerId = Util.stamp(container);\n  },\n\n  _initLayout: function () {\n    var container = this._container;\n\n    this._fadeAnimated = this.options.fadeAnimation && Browser.any3d;\n\n    DomUtil.addClass(container, 'cozy-container' +\n      (Browser.touch ? ' cozy-touch' : '') +\n      (Browser.retina ? ' cozy-retina' : '') +\n      (Browser.ielt9 ? ' cozy-oldie' : '') +\n      (Browser.safari ? ' cozy-safari' : '') +\n      (this._fadeAnimated ? ' cozy-fade-anim' : '') +\n      ' cozy-engine-' + this.options.engine +\n      ' cozy-theme-' + this.options.theme);\n\n    var position = DomUtil.getStyle(container, 'position');\n\n    this._initPanes();\n\n    if ( ! Browser.columnCount ) {\n      this.options.flow = 'scrolled-doc';\n    }\n  },\n\n  _initPanes: function () {\n    var self = this;\n\n    var panes = this._panes = {};\n\n    var l = 'cozy-';\n    var container = this._container;\n\n    var prefix = 'cozy-module-';\n\n    DomUtil.addClass(container, 'cozy-container');\n    panes['top'] = DomUtil.create('div', prefix + 'top', container);\n    panes['main'] = DomUtil.create('div', prefix + 'main', container);\n    panes['bottom'] = DomUtil.create('div', prefix + 'bottom', container);\n\n    panes['left'] = DomUtil.create('div', prefix + 'left', panes['main']);\n    panes['book-cover'] = DomUtil.create('div', prefix + 'book-cover', panes['main']);\n    panes['right'] = DomUtil.create('div', prefix + 'right', panes['main']);\n    panes['book'] = DomUtil.create('div', prefix + 'book', panes['book-cover']);\n    panes['loader'] = DomUtil.create('div', prefix + 'book-loading', panes['book']);\n    panes['epub'] = DomUtil.create('div', prefix + 'book-epub', panes['book']);\n    this._initBookLoader();\n  },\n\n  _checkIfLoaded: function () {\n    if (!this._loaded) {\n      throw new Error('Set map center and zoom first.');\n    }\n  },\n\n  // DOM event handling\n\n  // @section Interaction events\n  _initEvents: function (remove) {\n    this._targets = {};\n    this._targets[Util.stamp(this._container)] = this;\n\n    this.tracking = function(reader) {\n      var _action = [];\n      var _last_location_start;\n      var _reader = reader;\n      return {\n        action: function(v) {\n          if ( v ) {\n            _action = [v];\n            this.event(v);\n            // _reader.fire('trackAction', { action: v })\n          } else {\n            return _action.pop();\n          }\n        },\n\n        event: function(action, data) {\n          if ( data == null ) { data = {}; }\n          data.action = action;\n          _reader.fire(\"trackAction\", data);\n        },\n\n        pageview: function(location) {\n          if ( location.start != _last_location_start ) {\n            _last_location_start = location.start;\n            // console.log(\"AHOY RELOCATED\", location, location.start, location.href, location.location, this.action());\n            _reader.fire('trackPageview', { cfi: location.start, href: location.href, action: this.action()})\n            return true;\n          }\n          return false;\n        }\n      }\n    }(this);\n\n    var onOff = remove ? DomEvent.off : DomEvent.on;\n\n    // @event click: MouseEvent\n    // Fired when the user clicks (or taps) the map.\n    // @event dblclick: MouseEvent\n    // Fired when the user double-clicks (or double-taps) the map.\n    // @event mousedown: MouseEvent\n    // Fired when the user pushes the mouse button on the map.\n    // @event mouseup: MouseEvent\n    // Fired when the user releases the mouse button on the map.\n    // @event mouseover: MouseEvent\n    // Fired when the mouse enters the map.\n    // @event mouseout: MouseEvent\n    // Fired when the mouse leaves the map.\n    // @event mousemove: MouseEvent\n    // Fired while the mouse moves over the map.\n    // @event contextmenu: MouseEvent\n    // Fired when the user pushes the right mouse button on the map, prevents\n    // default browser context menu from showing if there are listeners on\n    // this event. Also fired on mobile when the user holds a single touch\n    // for a second (also called long press).\n    // @event keypress: KeyboardEvent\n    // Fired when the user presses a key from the keyboard while the map is focused.\n    // onOff(this._container, 'click dblclick mousedown mouseup ' +\n    //   'mouseover mouseout mousemove contextmenu keypress', this._handleDOMEvent, this);\n\n    // if (this.options.trackResize) {\n    //   var self = this;\n    //   var fn = debounce(function(){ self.invalidateSize({}); }, 150);\n    //   onOff(window, 'resize', fn, this);\n    // }\n\n    if (Browser.any3d && this.options.transform3DLimit) {\n      (remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);\n    }\n\n    var self = this;\n    if (screenfull.enabled) {\n      screenfull.on('change', function() {\n        // setTimeout(function() {\n        //   self.invalidateSize({});\n        // }, 100);\n        console.log('AHOY: Am I fullscreen?', screenfull.isFullscreen ? 'YES' : 'NO');\n      });\n    }\n\n    self.on(\"updateLocation\", function(location) {\n      var location_href = location.start;\n\n      if ( self._ignoreHistory ) {\n        self._ignoreHistory = false;\n        return;\n      }\n\n      if ( self.tracking.pageview(location) ) {\n        var tmp_href = window.location.href.split(\"#\");\n        tmp_href[1] = location.start.substr(8, location.start.length - 8 - 1);\n        history.pushState({ cfi: location.start }, '', tmp_href.join('#'));\n\n        if ( location.percentage ) {\n          var p = Math.ceil(location.percentage * 100);\n          document.title = `${self._original_document_title} - ${p}%`;\n        }        \n      }\n    })\n\n    window.addEventListener('popstate', function(event) {\n      if ( event.isTrusted && event.state !== null ) {\n        self._ignoreHistory = true;\n        self.gotoPage(event.state.cfi);\n      }\n    })\n\n    document.addEventListener('keydown', function(event) {\n      var keyName = event.key;\n      var target = event.target;\n\n      // check if the activeElement is \".special-panel\"\n      var check = document.activeElement;\n      while ( check.localName != 'body' ) {\n        if ( check.classList.contains('special-panel') ) {\n          return;\n        }\n        check = check.parentElement;\n      }\n\n      var IGNORE_TARGETS = [ 'input', 'target' ];\n      if ( IGNORE_TARGETS.indexOf(target.localName) >= 0 ) {\n        return;\n      }\n\n      self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey });\n    });\n\n    self.on('keyDown', function(data) {\n      switch(data.keyName) {\n        case 'ArrowRight':\n        case 'PageDown':\n          self.next();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          self.prev();\n          break;\n        case 'Home':\n          self._scroll('HOME');\n          break;\n        case 'End':\n          self._scroll('END')\n          break;\n      }\n    });\n  },\n\n  // _onResize: function() {\n  //   if ( ! this._resizeRequest ) {\n  //     this._resizeRequest = Util.requestAnimFrame(function() {\n  //       this.invalidateSize({})\n  //     }, this);\n  //   }\n  // },\n\n  _onScroll: function () {\n    this._container.scrollTop  = 0;\n    this._container.scrollLeft = 0;\n  },\n\n  _handleDOMEvent: function (e) {\n    if (!this._loaded || DomEvent.skipped(e)) { return; }\n\n    var type = e.type === 'keypress' && e.keyCode === 13 ? 'click' : e.type;\n\n    if (type === 'mousedown') {\n      // prevents outline when clicking on keyboard-focusable element\n      DomUtil.preventOutline(e.target || e.srcElement);\n    }\n\n    this._fireDOMEvent(e, type);\n  },\n\n  _fireDOMEvent: function (e, type, targets) {\n\n    if (e.type === 'click') {\n      // Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).\n      // @event preclick: MouseEvent\n      // Fired before mouse click on the map (sometimes useful when you\n      // want something to happen on click before any existing click\n      // handlers start running).\n      var synth = Util.extend({}, e);\n      synth.type = 'preclick';\n      this._fireDOMEvent(synth, synth.type, targets);\n    }\n\n    if (e._stopped) { return; }\n\n    // Find the layer the event is propagating from and its parents.\n    targets = (targets || []).concat(this._findEventTargets(e, type));\n\n    if (!targets.length) { return; }\n\n    var target = targets[0];\n    if (type === 'contextmenu' && target.listens(type, true)) {\n      DomEvent.preventDefault(e);\n    }\n\n    var data = {\n      originalEvent: e\n    };\n\n    if (e.type !== 'keypress') {\n      var isMarker = (target.options && 'icon' in target.options);\n      data.containerPoint = isMarker ?\n          this.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\n      data.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\n      data.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);\n    }\n\n    for (var i = 0; i < targets.length; i++) {\n      targets[i].fire(type, data, true);\n      if (data.originalEvent._stopped ||\n        (targets[i].options.nonBubblingEvents && Util.indexOf(targets[i].options.nonBubblingEvents, type) !== -1)) { return; }\n    }\n  },\n\n  getFixedBookPanelSize: function() {\n    // have to make the book\n    var style = window.getComputedStyle(this._panes['book']);\n    var h = this._panes['book'].clientHeight - parseFloat(style.paddingTop) - parseFloat(style.paddingBottom);\n    var w = this._panes['book'].clientWidth - parseFloat(style.paddingRight) - parseFloat(style.paddingLeft);\n    return { height: Math.floor(h * 1.00), width: Math.floor(w * 1.00) };\n  },\n\n  invalidateSize: function(options) {\n    // TODO: IS THIS EVER USED?\n    var self = this;\n\n    if ( ! self._drawn ) { return; }\n\n    Util.cancelAnimFrame(this._resizeRequest);\n\n    if (! this._loaded) { return this; }\n\n    this.fire('resized');\n  },\n\n  _resizeBookPane: function() {\n\n  },\n\n  _setupHooks: function() {\n\n  },\n\n  _checkFeatureCompatibility: function() {\n    if ( ! DomUtil.isPropertySupported('columnCount') || this._checkMobileDevice() ) {\n      // force\n      this.options.flow = 'scrolled-doc';\n    }\n    if ( this._checkMobileDevice() ) {\n      // this.options.fontSizeLarge = '160%';\n      // this.options.fontSizeSmall ='100%';\n      // this.options.fontSizeDefault = '120%';\n      this.options.text_size = 120;\n    }\n  },\n\n  _checkMobileDevice: function() {\n    if ( this._isMobile === undefined ) {\n      this._isMobile = false;\n      if ( this.options.mobileMediaQuery ) {\n        this._isMobile = window.matchMedia(this.options.mobileMediaQuery).matches;\n      }\n    }\n    return this._isMobile;\n  },\n\n  _enableBookLoader: function(delay=0) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( delay < 0 ) {\n      delay = 0;\n      self._force_progress = true;\n    }\n    self._loader_timeout = setTimeout(function() {\n      self._panes['loader'].style.display = 'block';\n    }, delay);\n  },\n\n  _disableBookLoader: function(force=false) {\n    var self = this;\n    self._clearBookLoaderTimeout();\n    if ( ! self._force_progress || force ) {\n      self._panes['loader'].style.display = 'none';\n      self._force_progress = false;\n      self._panes['loader-status'].innerHTML = '';\n    }\n  },\n\n  _clearBookLoaderTimeout: function() {\n    var self = this;\n    if ( self._loader_timeout ) {\n      clearTimeout(self._loader_timeout);\n      self._loader_timeout = null;\n    }\n  },\n\n  _initBookLoader: function() {\n    // is this not awesome?\n    var template = this.options.loader_template || this.loaderTemplate();\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      this._panes['loader'].appendChild(body.children[0]);\n    }\n    this._panes['loader-status'] = DomUtil.create('div', 'cozy-module-book-loading-status', this._panes['loader']);\n  },\n\n  loaderTemplate: function() {\n    return `<div class=\"cozy-loader-spinner\">\n    <div class=\"spinner-backdrop spinner-backdrop--1\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--2\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--3\"></div>\n    <div class=\"spinner-backdrop spinner-backdrop--4\"></div>\n    <div class=\"spinner-quarter spinner-quarter--1\"></div>\n    <div class=\"spinner-quarter spinner-quarter--2\"></div>\n    <div class=\"spinner-quarter spinner-quarter--3\"></div>\n    <div class=\"spinner-quarter spinner-quarter--4\"></div>\n  </div>`;\n  },\n\n  EOT: true\n});\n\nexport function createReader(id, options) {\n  return new Reader(id, options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\n\n/*\n * @class Control\n * @aka L.Control\n * @inherits Class\n *\n * L.Control is a base class for implementing reader controls. Handles regioning.\n * All other controls extend from this class.\n */\n\nexport var Control = Class.extend({\n    // @section\n    // @aka Control options\n    options: {\n        // @option region: String = 'topright'\n        // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n        // `'topright'`, `'bottomleft'` or `'bottomright'`\n    },\n\n    initialize: function (options) {\n        Util.setOptions(this, options);\n        if ( options.container ) {\n            this._container = options.container;\n            this._locked = true;\n        }\n        this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    },\n\n    /* @section\n     * Classes extending L.Control will inherit the following methods:\n     *\n     * @method getRegion: string\n     * Returns the region of the control.\n     */\n    getRegion: function () {\n        return this.options.region;\n    },\n\n    // @method setRegion(region: string): this\n    // Sets the region of the control.\n    setRegion: function (region) {\n        var reader = this._reader;\n\n        if (reader) {\n            reader.removeControl(this);\n        }\n\n        this.options.region = region;\n\n        if (reader) {\n            reader.addControl(this);\n        }\n\n        return this;\n    },\n\n    // @method getContainer: HTMLElement\n    // Returns the HTMLElement that contains the control.\n    getContainer: function () {\n        return this._container;\n    },\n\n    // @method addTo(reader: Map): this\n    // Adds the control to the given reader.\n    addTo: function (reader) {\n        this.remove();\n        this._reader = reader;\n\n        var container = this._container = this.onAdd(reader);\n\n        DomUtil.addClass(container, 'cozy-control');\n\n        if ( ! this._locked ) {\n            var region = this.getRegion();\n            var area = reader.getControlRegion(region);\n            area.appendChild(container);\n        }\n\n        return this;\n    },\n\n    // @method remove: this\n    // Removes the control from the reader it is currently active on.\n    remove: function () {\n        if (!this._reader) {\n            return this;\n        }\n\n        if (! this._container) {\n            return this;\n        }\n\n        if ( ! this._locked ) {\n            DomUtil.remove(this._container);\n        }\n\n        if (this.onRemove) {\n            this.onRemove(this._reader);\n        }\n\n        this._reader = null;\n\n        return this;\n    },\n\n    _refocusOnMap: function (e) {\n        // if reader exists and event is not a keyboard event\n        if (this._reader && e && e.screenX > 0 && e.screenY > 0) {\n            this._reader.getContainer().focus();\n        }\n    },\n\n    _className: function(widget) {\n        var className = [ 'cozy-control' ];\n        if ( this.options.direction ) {\n            className.push('cozy-control-' + this.options.direction);\n        }\n        if ( widget ) {\n            className.push('cozy-control-' + widget);\n        }\n        return className.join(' ');\n    }\n});\n\nexport var control = function (options) {\n    return new Control(options);\n};\n\n/* @section Extension methods\n * @uninheritable\n *\n * Every control should extend from `L.Control` and (re-)implement the following methods.\n *\n * @method onAdd(reader: Map): HTMLElement\n * Should return the container DOM element for the control and add listeners on relevant reader events. Called on [`control.addTo(reader)`](#control-addTo).\n *\n * @method onRemove(reader: Map)\n * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).\n */\n\n/* @namespace Map\n * @section Methods for Layers and Controls\n */\nReader.include({\n    // @method addControl(control: Control): this\n    // Adds the given control to the reader\n    addControl: function (control) {\n        control.addTo(this);\n        return this;\n    },\n\n    // @method removeControl(control: Control): this\n    // Removes the given control from the reader\n    removeControl: function (control) {\n        control.remove();\n        return this;\n    },\n\n    getControlContainer: function() {\n        var l = 'cozy-';\n        if ( ! this._controlContainer ) {\n            this._controlContainer =\n                DomUtil.create('div', l + 'control-container', this._container);\n        }\n        return this._controlContainer;\n    },\n\n    getControlRegion: function (target) {\n\n        if ( ! this._panes[target] ) {\n            // target is dot-delimited string\n            // first dot is the panel\n            var parts = target.split('.');\n            var tmp = [];\n            var parent = this._container;\n            var x = 0;\n            while ( parts.length ) {\n                var slug = parts.shift();\n                tmp.push(slug);\n                var panel = tmp.join(\".\");\n                var className = 'cozy-panel-' + slug;\n                if ( ! this._panes[panel] ) {\n                    this._panes[panel] = DomUtil.create('div', className, parent);\n                }\n                parent = this._panes[panel];\n                x += 1;\n                if ( x > 100 ) { break; }\n            }\n        }\n        return this._panes[target];\n    },\n\n    getControlRegion_1: function (target) {\n\n        var tmp = target.split('.');\n        var region = tmp.shift();\n        var slot = tmp.pop() || '-slot';\n\n        var container = this._panes[region];\n        if ( ! this._panes[target] ) {\n            var className = 'cozy-' + region + '--item cozy-slot-' + slot\n            if ( ! this._panes[region + '.' + slot] ) {\n                var div = DomUtil.create('div', className);\n                if ( slot == 'left' || slot == 'bottom' ) {\n                    var childElement = this._panes[region].firstChild;\n                    this._panes[region].insertBefore(div, childElement);\n                } else {\n                    this._panes[region].appendChild(div);\n                }\n                this._panes[region + '.' + slot] = div;\n            }\n            className = this._classify(tmp);\n            this._panes[target] = DomUtil.create('div', className, this._panes[region + '.' + slot]);\n        }\n\n        return this._panes[target];\n    },\n\n    _classify: function(tmp) {\n        var l = 'cozy-';\n        var className = [];\n        for(var i in tmp) {\n            className.push(l + tmp[i]);\n        }\n        className = className.join(' ');\n        return className;\n    },\n\n    _clearControlRegion: function () {\n        for (var i in this._controlRegions) {\n            DomUtil.remove(this._controlRegions[i]);\n        }\n        DomUtil.remove(this._controlContainer);\n        delete this._controlRegions;\n        delete this._controlContainer;\n    }\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nvar PageControl = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n      container = DomUtil.create('div', className),\n\n      this._control  = this._createButton(this._fill(options.html || options.label), this._fill(options.label),\n              className, container);\n    }\n    this._bindEvents();\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    return link;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    DomEvent.disableClickPropagation(this._control);\n    DomEvent.on(this._control, 'click', DomEvent.stop);\n    DomEvent.on(this._control, 'click', this._action, this);\n\n    this._reader.on('reopen', function(data) {\n      // update the button text / titles\n      var html = self.options.html || self.options.label;\n      self._control.innerHTML = self._fill(html);\n      self._control.setAttribute('title', self._fill(self.options.label));\n      self._control.setAttribute('aria-label', self._fill(self.options.label));\n    });\n\n  },\n\n  _unit: function() {\n    return ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  _fill: function(s) {\n    var unit = this._unit();\n    return s.replace(/\\$\\{unit\\}/g, unit);\n  },\n\n  _label: function() {\n    return this.options.label + \" \" + ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  EOT: true\n});\n\nexport var PagePrevious = PageControl.extend({\n  options: {\n    region: 'edge.left',\n    direction: 'previous',\n    label: 'Previous ${unit}',\n    html: '<i class=\"icon-chevron-left oi\" data-glyph=\"chevron-left\" title=\"Previous ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.prev();\n  }\n});\n\nexport var PageNext = PageControl.extend({\n  options: {\n    region: 'edge.right',\n    direction: 'next',\n    label: 'Next ${unit}',\n    html: '<i class=\"icon-chevron-right oi\" data-glyph=\"chevron-right\" title=\"Next ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.next();\n  }\n});\n\nexport var PageFirst = PageControl.extend({\n  options: {\n    direction: 'first',\n    label: 'First ${unit}'\n  },\n  _action: function(e) {\n      this._reader.first();\n  }\n});\n\nexport var PageLast = PageControl.extend({\n  options: {\n    direction: 'last',\n    label: 'Last ${unit}'\n  },\n  _action: function(e) {\n      this._reader.last();\n  }\n});\n\nexport var pageNext = function(options) {\n  return new PageNext(options);\n}\n\nexport var pagePrevious = function(options) {\n  return new PagePrevious(options);\n}\n\nexport var pageFirst = function(options) {\n  return new PageFirst(options);\n}\n\nexport var pageLast = function(options) {\n  return new PageLast(options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nimport assign from 'lodash/assign';\n\nvar activeModal;\nvar dismissModalListener = false;\n\n// from https://github.com/ghosh/micromodal/blob/master/src/index.js\nconst FOCUSABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'iframe',\n    'object',\n    'embed',\n    '[contenteditable]',\n    '[tabindex]:not([tabindex^=\"-\"])'\n  ];\n\nconst ACTIONABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input[type=\"submit\"]:not([disabled])',\n    'button:not([disabled])'\n  ];\n\nexport var Modal = Class.extend({\n  options: {\n    // @option region: String = 'topright'\n    // The region of the control (one of the reader edges). Possible values are `'left' ad 'right'`\n    region: 'left',\n    fraction: 0,\n    width: null,\n    className: {},\n    actions: null,\n    callbacks: { onShow: function() {}, onClose: function() {} },\n    handlers: {}\n  },\n\n  initialize: function (options) {\n    options = Util.setOptions(this, options);\n    this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    this._initializedEvents = false;\n    this.callbacks = assign({}, this.options.callbacks);\n    this.actions = this.options.actions ? assign({}, this.options.actions) : null;\n    this.handlers = assign({}, this.options.handlers);\n    if ( typeof(this.options.className) == 'string' ) {\n      this.options.className = { container: this.options.className };\n    }\n  },\n\n  addTo: function(reader) {\n    var self = this;\n    this._reader = reader;\n    var template = this.options.template;\n\n    var panelHTML = `<div class=\"cozy-modal modal-slide ${this.options.region || 'left'}\" id=\"modal-${this._id}\" aria-labelledby=\"modal-${this._id}-title\" role=\"dialog\" aria-describedby=\"modal-${this._id}-content\" aria-hidden=\"true\">\n      <div class=\"modal__overlay\" tabindex=\"-1\" data-modal-close>\n        <div class=\"modal__container ${this.options.className.container ? this.options.className.container : ''}\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-${this._id}-title\" aria-describedby=\"modal-${this._id}-content\" id=\"modal-${this._id}-container\">\n          <div role=\"document\">\n            <header class=\"modal__header\">\n              <h3 class=\"modal__title\" id=\"modal-${this._id}-title\">${this.options.title}</h3>\n              <button class=\"modal__close\" aria-label=\"Close modal\" aria-controls=\"modal-${this._id}-container\" data-modal-close></button>\n            </header>\n            <main class=\"modal__content ${this.options.className.main ? this.options.className.main : ''}\" id=\"modal-${this._id}-content\">\n              ${template}\n            </main>`;\n\n    if ( this.options.actions ) {\n      panelHTML += '<footer class=\"modal__footer\">'\n      for(var i in this.options.actions) {\n        var action = this.options.actions[i];\n        var button_cls = action.className || 'button--default';\n        panelHTML += `<button id=\"action-${this._id}-${i}\" class=\"button button--lg ${button_cls}\">${action.label}</button>`;\n      }\n      panelHTML += '</footer>';\n    }\n\n    panelHTML += '</div></div></div></div>';\n\n    var body = new DOMParser().parseFromString(panelHTML, \"text/html\").body;\n\n    this.modal = reader._container.appendChild(body.children[0]);\n    this._container = this.modal; // compatibility\n\n    this.container = this.modal.querySelector('.modal__container');\n    this._bindEvents();\n    return this;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    this.onClick = this.onClick.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n    this.onModalTransition = this.onModalTransition.bind(this);\n\n    this.modal.addEventListener('transitionend', function() {\n    }.bind(this));\n\n    // bind any actions\n    if ( this.actions ) {\n      for(var i in this.actions) {\n        let action = this.actions[i];\n        let button_id = '#action-' + this._id + '-' + i;\n        let button = this.modal.querySelector(button_id);\n        if ( button ) {\n          DomEvent.on(button, 'click', function(event) {\n            event.preventDefault();\n            action.callback(event);\n            if ( action.close ) {\n              self.closeModal();\n            }\n          })\n        }\n      }\n    }\n  },\n\n  deactivate: function() {\n    this.closeModal();\n  },\n\n  closeModal: function() {\n    var self = this;\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.removeEventListeners();\n    if ( this.activeElement ) {\n      this.activeElement.focus();\n    }\n    this.callbacks.onClose(this.modal);\n  },\n\n  showModal: function() {\n    this.activeElement = document.activeElement\n    this._resize();\n    this.modal.setAttribute('aria-hidden', 'false')\n    this.setFocusToFirstNode()\n    this.addEventListeners()\n    this.callbacks.onShow(this.modal)\n  },\n\n  activate: function() {\n    return this.showModal();\n    var self = this;\n    activeModal = this;\n    DomUtil.addClass(self._reader._container, 'st-modal-activating');\n    this._resize();\n    DomUtil.addClass(this._reader._container, 'st-modal-open');\n    setTimeout(function() {\n      DomUtil.addClass(self._container, 'active');\n      DomUtil.removeClass(self._reader._container, 'st-modal-activating');\n      self._container.setAttribute('aria-hidden', 'false');\n      self.setFocusToFirstNode();\n    }, 25);\n  },\n\n  addEventListeners: function () {\n    // --- do we need touch listeners?\n    // this.modal.addEventListener('touchstart', this.onClick)\n    // this.modal.addEventListener('touchend', this.onClick)\n    this.modal.addEventListener('click', this.onClick)\n    document.addEventListener('keydown', this.onKeydown)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.addEventListener(event, this.onModalTransition);\n    }.bind(this))\n  },\n\n  removeEventListeners: function () {\n    this.modal.removeEventListener('touchstart', this.onClick)\n    this.modal.removeEventListener('click', this.onClick)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.removeEventListener(event, this.onModalTransition);\n    }.bind(this))\n    document.removeEventListener('keydown', this.onKeydown)\n  },\n\n  _resize: function() {\n    var container = this._reader._container;\n    this.container.style.height = container.offsetHeight + 'px';\n    // console.log(\"AHOY MODAL\", this.container.style.height);\n    if ( ! this.options.className.container  ) {\n      this.container.style.width = this.options.width || parseInt(container.offsetWidth * this.options.fraction) + 'px';\n    }\n\n    var header = this.container.querySelector('header');\n    var footer = this.container.querySelector('footer');\n    var main = this.container.querySelector('main');\n    var height = this.container.clientHeight - header.clientHeight;\n    if ( footer ) {\n      height -= footer.clientHeight;\n    }\n    main.style.height = height + 'px';\n  },\n\n  getFocusableNodes: function() {\n    const nodes = this.modal.querySelectorAll(FOCUSABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  setFocusToFirstNode: function() {\n    var focusableNodes = this.getFocusableNodes();\n    if ( focusableNodes.length ) {\n      focusableNodes[0].focus();\n    } else {\n      activeModal._container.focus();\n    }\n  },\n\n  getActionableNodes: function() {\n    const nodes = this.modal.querySelectorAll(ACTIONABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  onKeydown: function(event) {\n    if ( event.keyCode == 27 ) { this.closeModal(); }\n    if ( event.keyCode == 9 ) {\n      this.maintainFocus(event);\n    }\n  },\n\n  onClick: function(event) {\n\n    var closeAfterAction = false;\n    var target = event.target;\n\n    // As far as I can tell, the code below isn't catching direct clicks on\n    // items with class='data-modal-close' as they're not ACTIONABLE_ELEMENTS.\n    // Adding them to ACTIONABLE_ELEMENTS causes undesirable behavior where\n    // their child items also close the modal thanks to the loop below.\n    // Children of .modal__overlay include the modal header, border area and\n    // padding. We don't want clicks on these closing the modal.\n    // Just close the modal now for direct clicks on a '.data-modal-close'.\n    if (target.hasAttribute('data-modal-close')) {\n      this.fire('closed');\n      this.closeModal();\n      return;\n    }\n\n    // if the target isn't an actionable type, walk the DOM until\n    // one is found\n    var actionableNodes = this.getActionableNodes();\n    while ( actionableNodes.indexOf(target) < 0 && target != this.modal ) {\n      target = target.parentElement;\n    }\n\n    // no target found, punt\n    if ( actionableNodes.indexOf(target) < 0 ) {\n      return;\n    }\n\n    if (this.handlers.click) {\n      var did_match = false;\n      for(var selector in this.handlers.click) {\n        if ( target.matches(selector) ) {\n          closeAfterAction = this.handlers.click[selector](this, target);\n          break;\n        }\n      }\n    }\n\n    if (closeAfterAction || target.hasAttribute('data-modal-close')) this.closeModal();\n\n    event.preventDefault();\n  },\n\n  onModalTransition: function(event) {\n    if ( this.modal.getAttribute('aria-hidden') == 'true' ) {\n      this._reader.fire('modal-closed');\n    } else {\n      this._reader.fire('modal-opened');\n    }\n  },\n\n  on: function(event, selector, handler) {\n    if (! this.handlers[event] ) {\n      this.handlers[event] = {};\n    }\n    if (typeof(selector) == 'function') {\n      handler = selector;\n      selector = '*';\n    }\n    this.handlers[event][selector] = handler;\n  },\n\n  fire: function(event) {\n    if ( this.handlers[event] && this.handlers[event]['*'] ) {\n      this.handlers[event]['*'](this);\n    }\n  },\n\n  maintainFocus: function(event) {\n    var focusableNodes = this.getFocusableNodes();\n    var focusedItemIndex = focusableNodes.indexOf(document.activeElement);\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableNodes[focusableNodes.length - 1].focus()\n      event.preventDefault()\n    }\n\n    if (!event.shiftKey && focusedItemIndex === focusableNodes.length - 1) {\n      focusableNodes[0].focus()\n      event.preventDefault()\n    }\n  },\n\n  EOT: true\n});\n\nReader.include({\n  modal: function (options) {\n    var modal = new Modal(options);\n    return modal.addTo(this);\n    // return this;\n  },\n\n  EOT: true\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport {Modal} from './Modal';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Contents = Control.extend({\n\n  defaultTemplate: `<button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Table of Contents\"><i class=\"icon-menu oi\" data-glyph=\"menu\" title=\"Table of Contents\" aria-hidden=\"true\"></i></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    this._control.setAttribute('id', 'action-' + this._id);\n    container.style.position = 'relative';\n\n    this._reader.on('updateContents', function(data) {\n\n      DomEvent.on(this._control, 'click', function(event) {\n        event.preventDefault();\n        self._reader.tracking.action('contents/open');\n        self._modal.activate();\n      }, this)\n\n      this._modal = this._reader.modal({\n        template: '<ul></ul>',\n        title: 'Contents',\n        region: 'left',\n        className: 'cozy-modal-contents'\n      });\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('data-href');\n        this._reader.tracking.action('contents/go');\n        this._reader.gotoPage(target);\n        return true;\n      }.bind(this))\n\n      this._modal.on('closed', function() {\n        self._reader.tracking.action('contents/close');\n      })\n\n      this._setupSkipLink();\n\n      var parent = self._modal._container.querySelector('ul');\n      // var s = data.toc.filter(function(value) { return value.parent == null }).map(function(value) { return [ value, 0, parent ] });\n      // while ( s.length ) {\n      //   var tuple = s.shift();\n      //   var chapter = tuple[0];\n      //   var tabindex = tuple[1];\n      //   var parent = tuple[2];\n\n      //   var option = self._createOption(chapter, tabindex, parent);\n      //   data.toc.filter(function(value) { return value.parent == chapter.id }).reverse().forEach(function(chapter_) {\n      //     s.unshift([chapter_, tabindex + 1, option]);\n      //   });\n      // }\n      var _process = function(items, tabindex, parent) {\n        items.forEach(function(item) {\n          var option = self._createOption(item, tabindex, parent);\n          if ( item.subitems && item.subitems.length ) {\n            _process(item.subitems, tabindex + 1, option);\n          }\n        })\n      }\n      _process(data.toc, 0, parent);\n    }.bind(this))\n\n    return container;\n  },\n\n  _createOption(chapter, tabindex, parent) {\n\n    function pad(value, length) {\n        return (value.toString().length < length) ? pad(\"-\"+value, length):value;\n    }\n    var option = DomUtil.create('li');\n    if ( chapter.href ) {\n      var anchor = DomUtil.create('a', null, option);\n      anchor.textContent = chapter.label;\n      // var tab = pad('', tabindex); tab = tab.length ? tab + ' ' : '';\n      // option.textContent = tab + chapter.label;\n      anchor.setAttribute('href', chapter.href);\n      anchor.setAttribute('data-href', chapter.href);\n    } else {\n      var span = DomUtil.create('span', null, option);\n      span.textContent = chapter.label;\n    }\n\n    if ( parent.tagName == 'LI' ) {\n      // need to nest\n      var tmp = parent.querySelector('ul');\n      if ( ! tmp ) {\n        tmp = DomUtil.create('ul', null, parent);\n      }\n      parent = tmp;\n    }\n\n    parent.appendChild(option);\n    return option;\n  },\n\n  _setupSkipLink: function() {\n    if ( ! this.options.skipLink ) { return; }\n      \n    var target = document.querySelector(this.options.skipLink);\n    if ( ! target ) { return; }\n\n    var link = document.createElement('a');\n    link.textContent = 'Skip to contents';\n    link.setAttribute('href', '#action-' + this._id);\n\n    var ul = target.querySelector('ul');\n    if ( ul ) {\n      // add to list\n      target = document.createElement('li');\n      ul.appendChild(target);\n    }\n    target.appendChild(link);\n    link.addEventListener('click', function(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      this._control.click();\n    }.bind(this))\n\n  },\n\n  EOT: true\n});\n\nexport var contents = function(options) {\n  return new Contents(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var Title = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    var h1 = DomUtil.create('h1', 'cozy-h1', container);\n    DomUtil.setOpacity(h1, 0);\n    this._title = DomUtil.create('span', 'cozy-title', h1);\n    this._divider = DomUtil.create('span', 'cozy-divider', h1);\n    this._divider.textContent = \" · \";\n    this._section = DomUtil.create('span', 'cozy-section', h1);\n\n    // --- TODO: disable until we can work out how to \n    // --- more reliably match the current section to the contents\n    // this._reader.on('updateSection', function(data) {\n    //   if ( data && data.label ) {\n    //     self._section.textContent = data.label;\n    //     DomUtil.setOpacity(self._section, 1.0);\n    //     DomUtil.setOpacity(self._divider, 1.0);\n    //   } else {\n    //     DomUtil.setOpacity(self._section, 0);\n    //     DomUtil.setOpacity(self._divider, 0);\n    //   }\n    // })\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._title.textContent = data.title || data.bookTitle;\n        DomUtil.setOpacity(self._section, 0);\n        DomUtil.setOpacity(self._divider, 0);\n        DomUtil.setOpacity(h1, 1);\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var title = function(options) {\n  return new Title(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var PublicationMetadata = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    this._publisher = DomUtil.create('div', 'cozy-publisher', container);\n    this._rights = DomUtil.create('div', 'cozy-rights', container);\n\n    this._reader.on('updateTitle', function(data) {\n      if ( data ) {\n        self._publisher.textContent = data.publisher;\n        self._rights.textContent = data.rights;\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var publicationMetadata = function(options) {\n  return new PublicationMetadata(options);\n}\n","import {Class} from '../core/Class';\nimport {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as Util from '../core/Util';\n\nimport assign from 'lodash/assign';\nimport keys from 'lodash/keys';\n\nexport var Preferences = Control.extend({\n  options: {\n    label: 'Preferences',\n    hasThemes: false,\n    html: '<i class=\"icon-cog oi\" data-glyph=\"cog\" title=\"Preferences and Settings\" aria-hidden=\"true\"></i>'\n  },\n\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className('preferences'),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    this._activated = false;\n    this._control = this._createButton(options.html || options.label, options.label,\n            className, container, this._action)\n\n    // self.initializeForm();\n    this._modal = this._reader.modal({\n      // template: '<form></form>',\n      title: 'Preferences',\n      className: 'cozy-modal-preferences',\n      actions: [\n        {\n          label: 'Save Changes',\n          callback: function(event) {\n            self.updatePreferences(event);\n          }\n        }\n      ],\n      region: 'right'\n    });\n\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self.initializeForm();\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n    if ( this._modal._container.querySelector('form') ) { return; }\n\n    var template = '';\n\n    var possible_fieldsets = [];\n    if ( this._reader.metadata.layout == 'pre-paginated' ) {\n      // different panel\n      possible_fieldsets.push('Scale');\n    } else {\n      possible_fieldsets.push('TextSize');\n    }\n    possible_fieldsets.push('Display');\n\n    if ( this._reader.rootfiles && this._reader.rootfiles.length > 1 ) {\n      // this.options.hasPackagePaths = true;\n      possible_fieldsets.push('Rendition');\n    }\n\n    if ( this._reader.options.themes && this._reader.options.themes.length > 0 ) {\n      this.options.hasThemes = true;\n      possible_fieldsets.push('Theme');\n    }\n\n    this._fieldsets = [];\n    possible_fieldsets.forEach(function(cls) {\n      var fieldset = new Preferences.fieldset[cls](this);\n      template += fieldset.template();\n      this._fieldsets.push(fieldset);\n    }.bind(this))\n\n    if ( this.options.fields ) {\n      this.options.hasFields = true;\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        template += `<fieldset class=\"custom-field\">\n          <legend>${field.label}</legend>\n        `;\n        for(var j in field.inputs) {\n          var input = field.inputs[j];\n          var checked = input.value == field.value ? ' checked=\"checked\"' : '';\n          template += `<label><input id=\"preferences-custom-${i}-${j}\" type=\"radio\" name=\"x${field.name}\" value=\"${input.value}\" ${checked}/>${input.label}</label>`;\n        }\n        if ( field.hint ) {\n          template += `<p class=\"hint\" style=\"font-size: 90%\">${field.hint}</p>`;\n        }\n      }\n    }\n\n    template = '<form>' + template + '</form>';\n\n    // this._modal = this._reader.modal({\n    //   template: template,\n    //   title: 'Preferences',\n    //   className: 'cozy-modal-preferences',\n    //   actions: [\n    //     {\n    //       label: 'Save Changes',\n    //       callback: function(event) {\n    //         self.updatePreferences(event);\n    //       }\n    //     }\n    //   ],\n    //   region: 'right'\n    // });\n\n    this._modal._container.querySelector('main').innerHTML = template;\n    this._form = this._modal._container.querySelector('form');\n  },\n\n  initializeForm: function() {\n    this._createPanel();\n    this._fieldsets.forEach(function(fieldset) {\n      fieldset.initializeForm(this._form);\n    }.bind(this));\n  },\n\n  updatePreferences: function(event) {\n    event.preventDefault();\n\n    var doUpdate = false;\n    var new_options = {};\n    var saveable_options = {};\n    this._fieldsets.forEach(function(fieldset) {\n      // doUpdate = doUpdate || fieldset.updateForm(this._form, new_options);\n      // assign(new_options, fieldset.updateForm(this._form));\n      fieldset.updateForm(this._form, new_options, saveable_options);\n    }.bind(this));\n\n    if ( this.options.hasFields ) {\n      for(var i in this.options.fields) {\n        var field = this.options.fields[i];\n        var id = \"preferences-custom-\" + i;\n        var input = this._form.querySelector(`input[name=\"x${field.name}\"]:checked`);\n        if ( input.value != field.value ) {\n          field.value = input.value;\n          field.callback(field.value);\n        }\n      }\n    }\n\n    this._modal.deactivate();\n\n    setTimeout(function() {\n      this._reader.saveOptions(saveable_options);\n      this._reader.reopen(new_options);\n    }.bind(this), 100);\n  },\n\n  EOT: true\n});\n\nPreferences.fieldset = {};\n\nvar Fieldset = Class.extend({\n\n  options: {},\n\n  initialize: function (control, options) {\n      Util.setOptions(this, options);\n      this._control = control;\n      this._current = {};\n      this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n  },\n\n  template: function() {\n\n  },\n\n  EOT: true\n\n\n});\n\nPreferences.fieldset.TextSize = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var text_size = this._control._reader.options.text_size || 100;\n    if ( text_size == 'auto' ) { text_size = 100; }\n    this._current.text_size = text_size;\n    this._input.value = text_size;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.text_size = saveable.text_size = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Text Size</legend>\n        <div class=\"preview--text_size\" id=\"x${this._id}-preview\">\n          ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span>T-</span>\n          <input name=\"text_size\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span>T+</span>\n        </p>\n        <p>\n          <span>Text Size: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.fontSize = `${( parseInt(this._input.value, 10) / 100 )}em`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Display = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var flow = this._control._reader.options.flow || this._control._reader.metadata.flow || 'auto';\n    // if ( flow == 'auto' ) { flow = 'paginated'; }\n\n    var input = form.querySelector(`#x${this._id}-input-${flow}`);\n    input.checked = true;\n    this._current.flow = flow;\n\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-flow\"]:checked`);\n    options.flow = input.value;\n    if ( options.flow != 'auto' ) {\n      saveable.flow = options.flow;\n    }\n    // if ( input.value == 'auto' ) {\n    //   // we do NOT want to save flow as a preference\n    //   return {};\n    // }\n    // return { flow: input.value };\n  },\n\n  template: function() {\n    var scrolled_help = '';\n    if ( this._control._reader.metadata.layout != 'pre-paginated' ) {\n      scrolled_help = \"<br /><small>This is an experimental feature that may cause display and loading issues for the book when enabled.</small>\";\n    }\n    return `<fieldset>\n            <legend>Display</legend>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-auto\" value=\"auto\" /> Auto<br /><small>Let the reader determine display mode based on your browser dimensions and the type of content you're reading</small></label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-paginated\" value=\"paginated\" /> Page-by-Page</label>\n            <label><input name=\"x${this._id}-flow\" type=\"radio\" id=\"x${this._id}-input-scrolled-doc\" value=\"scrolled-doc\" /> Scroll${scrolled_help}</label>\n          </fieldset>`;\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Theme = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var theme = this._control._reader.options.theme || 'default';\n\n    var input = form.querySelector(`#x${this._id}-input-theme-${theme}`);\n    input.checked = true;\n    this._current.theme = theme;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-theme\"]:checked`);\n    options.theme = saveable.theme = input.value;\n    // return { theme: input.value };\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Theme</legend>\n            <label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-default\" value=\"default\" />Default</label>`;\n\n    this._control._reader.options.themes.forEach(function(theme) {\n      template += `<label><input name=\"x${this._id}-theme\" type=\"radio\" id=\"x${this._id}-input-theme-${theme.klass}\" value=\"${theme.klass}\" />${theme.name}</label>`\n    }.bind(this));\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Rendition = Fieldset.extend({\n\n  initializeForm: function(form) {\n    var rootfiles = this._control._reader.rootfiles;\n    var rootfilePath = this._control._reader.options.rootfilePath;\n    var expr = rootfilePath ? `[value=\"${rootfilePath}\"]` : \":first-child\";\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]${expr}`);\n    input.checked = true;\n    this._current.rootfilePath = rootfilePath || rootfiles[0].rootfilePath;\n  },\n\n  updateForm: function(form, options, saveable) {\n    var input = form.querySelector(`input[name=\"x${this._id}-rootfilePath\"]:checked`);\n    if ( input.value != this._current.rootfilePath ) {\n      options.rootfilePath = input.value;\n      this._current.rootfilePath = input.value;\n    }\n  },\n\n  template: function() {\n    var template = `<fieldset>\n            <legend>Rendition</legend>\n    `;\n\n    this._control._reader.rootfiles.forEach(function(rootfile, i) {\n      template += `<label><input name=\"x${this._id}-rootfilePath\" type=\"radio\" id=\"x${this._id}-input-rootfilePath-${i}\" value=\"${rootfile.rootfilePath}\" />${rootfile.label || rootfile.accessMode || rootfile.rootfilePath}</label>`;\n    }.bind(this))\n\n    template += '</fieldset>';\n\n    return template;\n\n  },\n\n  EOT: true\n\n});\n\nPreferences.fieldset.Scale = Fieldset.extend({\n\n  initializeForm: function(form) {\n    if ( ! this._input ) {\n      this._input = form.querySelector(`#x${this._id}-input`);\n      this._output = form.querySelector(`#x${this._id}-output`);\n      this._preview = form.querySelector(`#x${this._id}-preview > div`);\n      this._actionReset = form.querySelector(`#x${this._id}-reset`);\n\n      this._input.addEventListener('input', this._updatePreview.bind(this));\n      this._input.addEventListener('change', this._updatePreview.bind(this));\n\n      this._actionReset.addEventListener('click', function(event) {\n        event.preventDefault();\n        this._input.value = 100;\n        this._updatePreview();\n      }.bind(this));\n    }\n\n    var scale = this._control._reader.options.scale || 100;\n    if ( ! scale ) { scale = 100; }\n    this._current.scale = scale;\n    this._input.value = scale;\n    this._updatePreview();\n  },\n\n  updateForm: function(form, options, saveable) {\n    // return { text_size: this._input.value };\n    options.scale = saveable.scale = this._input.value;\n    // options.text_size = this._input.value;\n    // return ( this._input.value != this._current.text_size );\n  },\n\n  template: function() {\n    return `<fieldset class=\"cozy-fieldset-text_size\">\n        <legend>Zoom In/Out</legend>\n        <div class=\"preview--scale\" id=\"x${this._id}-preview\" style=\"overflow: hidden; height: 5rem\">\n          <div>\n            ‘Yes, that’s it,’ said the Hatter with a sigh: ‘it’s always tea-time, and we’ve no time to wash the things between whiles.’\n          </div>\n        </div>\n        <p style=\"white-space: no-wrap\">\n          <span style=\"font-size: 150%\">⊖<span class=\"u-screenreader\"> Zoom Out</span></span>\n          <input name=\"scale\" type=\"range\" id=\"x${this._id}-input\" value=\"100\" min=\"50\" max=\"400\" step=\"10\" style=\"width: 75%; display: inline-block\" />\n          <span style=\"font-size: 150%\">⊕<span class=\"u-screenreader\">Zoom In </span></span>\n        </p>\n        <p>\n          <span>Scale: </span>\n          <span id=\"x${this._id}-output\">100</span>\n          <button id=\"x${this._id}-reset\" class=\"reset button--inline\" style=\"margin-left: 8px\">Reset</button> \n        </p>\n      </fieldset>`;\n  },\n\n  _updatePreview: function() {\n    this._preview.style.transform = `scale(${( parseInt(this._input.value, 10) / 100 )}) translate(0,0)`;\n    this._output.innerHTML = `${this._input.value}%`;\n  },\n\n  EOT: true\n\n});\n\nexport var preferences = function(options) {\n  return new Preferences(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Widget = Control.extend({\n\n\n  options: {\n      // @option region: String = 'topright'\n      // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n      // `'topright'`, `'bottomleft'` or `'bottomright'`\n  },\n\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      // NOOP\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n\n    }\n\n    this._onAddExtra(container);\n    this._updateTemplate(container);\n    this._updateClass(container);\n    this._bindEvents(container);\n\n    return container;\n  },\n\n  _updateTemplate: function(container) {\n    var data = this.data();\n    for(var slot in data) {\n      if ( data.hasOwnProperty(slot) ) {\n        var value = data[slot];\n        if ( typeof(value) == \"function\" ) { value = value(); }\n        var node = container.querySelector(`[data-slot=${slot}]`);\n        if ( node ) {\n          if ( node.hasAttribute('value') ) {\n            node.setAttribute('value', value);\n          } else {\n            node.innerHTML = value;\n          }\n        }\n      }\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this.options.className ) {\n      DomUtil.addClass(container, this.options.className);\n    }\n  },\n\n  _onAddExtra: function() { },\n\n  _bindEvents: function(container) {\n    var control = container.querySelector(\"[data-toggle=button]\");\n    if ( ! control ) { return ; }\n    DomEvent.disableClickPropagation(control);\n    DomEvent.on(control, 'click', DomEvent.stop);\n    DomEvent.on(control, 'click', this._action, this);\n  },\n\n  _action: function() {\n  },\n\n  data: function() {\n    return this.options.data || {};\n  },\n\n  EOT: true\n});\n\nWidget.Button = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _action: function() {\n    this.options.onClick(this, this._reader);\n  },\n\n  EOT: true\n});\n\nWidget.Panel = Widget.extend({\n  defaultTemplate: `<div><span data-slot=\"text\"></span></div>`,\n\n\n  EOT: true\n});\n\nWidget.Toggle = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _onAddExtra: function(container) {\n    this.state(this.options.states[0].stateName, container);\n\n    return container;\n  },\n\n  state: function(stateName, container) {\n    container = container || this._container;\n    this._resetState(container);\n    this._state = this.options.states.filter(function(s) { return s.stateName == stateName })[0];\n    this._updateClass(container);\n    this._updateTemplate(container);\n  },\n\n  _resetState: function(container) {\n    if ( ! this._state ) { return; }\n    if ( this._state.className ) {\n      DomUtil.removeClass(container, this._state.className);\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this._state.className ) {\n      DomUtil.addClass(container, this._state.className);\n    }\n  },\n\n  _action: function() {\n    this._state.onClick(this, this._reader);\n  },\n\n  data: function() {\n    return this._state.data || {};\n  },\n\n  EOT: true\n});\n\n// export var widget = function(options) {\n//   return new Widget(options);\n// }\n\nexport var widget = {\n  button: function(options) { return new Widget.Button(options); },\n  panel: function(options) { return new Widget.Panel(options); },\n  toggle: function(options) { return new Widget.Toggle(options); }\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Citation = Control.extend({\n  options: {\n    label: 'Citation',\n    html: '<span class=\"citation\" aria-label=\"Get Citation\"></span>'\n  },\n\n  defaultTemplate: '<button class=\"button--sm cozy-citation citation\" data-toggle=\"open\" aria-label=\"Get Citation\"></button>',\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Select Citation Format</legend>\n      </fieldset>\n    </form>\n    <blockquote id=\"formatted\" style=\"padding: 8px; border-left: 4px solid black; background-color: #fff\"></blockquote>\n    <div class=\"alert alert-info\" id=\"message\" style=\"display: none\"></div>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Copy Citation to Clipboard',\n      className: 'cozy-modal-citatation',\n      actions: [\n        {\n          label: 'Copy Citation',\n          callback: function(event) {\n            document.designMode = \"on\";\n            var formatted = self._modal._container.querySelector(\"#formatted\");\n\n            var range = document.createRange();\n            range.selectNode(formatted);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // formatted.select();\n\n            try {\n              var flag = document.execCommand('copy');\n            } catch(err) {\n              console.log(\"AHOY COPY FAILED\", err);\n            }\n\n            self._message.innerHTML = 'Success! Citation copied to your clipboard.';\n            self._message.style.display = 'block';\n            sel.removeAllRanges();\n            range.detach();\n            document.designMode = \"off\";\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    var fieldset = this._form.querySelector('fieldset');\n\n    var citations = this.options.citations || this._reader.metadata.citations;\n\n    citations.forEach(function(citation, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', citation.format);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = document.createTextNode(\" \" + citation.format);\n      label.appendChild(text);\n      input.setAttribute('data-text', citation.text);\n    });\n\n    this._formatted = this._modal._container.querySelector(\"#formatted\");\n    this._message = this._modal._container.querySelector(\"#message\");\n    DomEvent.on(this._form, 'change', function(event) {\n      var target = event.target;\n      if ( target.tagName == 'INPUT' ) {\n        this._initializeForm();\n      }\n    }, this);\n\n    this._initializeForm();\n  },\n\n  _initializeForm: function() {\n    var formatted = this._formatCitation();\n    this._formatted.innerHTML = formatted;\n    this._message.style.display = 'none';\n    this._message.innerHTML = '';\n  },\n\n  _formatCitation: function(format) {\n    if ( format == null ) {\n      var selected = this._form.querySelector(\"input:checked\");\n      format = selected.value;\n    }\n    var selected = this._form.querySelector(\"input[value=\" + format + \"]\");\n    return selected.getAttribute('data-text');\n    // return selected.dataset.text;\n  },\n\n  EOT: true\n});\n\nexport var citation = function(options) {\n  return new Citation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Search = Control.extend({\n  options: {\n    label: 'Search',\n    html: '<span>Search</span>'\n  },\n\n  defaultTemplate: `<form class=\"search\">\n    <label class=\"u-screenreader\" for=\"cozy-search-string\">Search in this text</label>\n    <input id=\"cozy-search-string\" name=\"search\" type=\"text\" placeholder=\"Search in this text...\"/>\n    <button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Search\"><i class=\"icon-magnifying-glass oi\" data-glyph=\"magnifying-glass\" title=\"Search\" aria-hidden=\"true\"></i></button>\n  </form>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    container.style.position = 'relative';\n\n    this._data = null;\n    this._canceled = false;\n    this._processing = false;\n\n    this._reader.on('ready', function() {\n\n      this._modal = this._reader.modal({\n        template: '<article></article>',\n        title: 'Search Results',\n        className: { container: 'cozy-modal-search' },\n        region: 'left',\n      });\n\n      this._modal.callbacks.onClose = function() {\n        if ( self._processing ) {\n          self._canceled = true;\n        }\n      };\n\n      this._article = this._modal._container.querySelector('article');\n\n      this._modal.on('click', 'a[href]', function(modal, target) {\n        target = target.getAttribute('href');\n        this._reader.tracking.action('search/go');\n        this._reader.gotoPage(target);\n        return true;\n      }.bind(this));\n\n      this._modal.on('closed', function() {\n        this._reader.tracking.action('contents/close');\n      }.bind(this))\n\n    }.bind(this));\n\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n\n      var searchString = this._container.querySelector(\"#cozy-search-string\").value;\n      searchString = searchString.replace(/^\\s*/, '').replace(/\\s*$/, '');\n\n      if ( ! searchString ) {\n        // just punt\n        return;\n      }\n\n      if ( searchString == this.searchString ) {\n        // cached results\n        self.openModalResults();\n      } else {\n        this.searchString = searchString;\n        self.openModalWaiting();\n        self.submitQuery();\n      }\n    }, this);\n\n    return container;\n  },\n\n  openModalWaiting: function() {\n    this._processing = true;\n    this._emptyArticle();\n    var value = this.searchString;\n    this._article.innerHTML = '<p>Submitting query for <em>' + value + '</em>...</p>' + this._reader.loaderTemplate();\n    this._modal.activate();\n  },\n\n  openModalResults: function() {\n    if ( this._canceled ) {\n      this._canceled = false;\n      return;\n    }\n    this._buildResults();\n    this._modal.activate();\n    this._reader.tracking.action(\"search/open\");\n  },\n\n  submitQuery: function() {\n    var self = this;\n\n    var url = this.options.searchUrl + this.searchString;\n\n    var request = new XMLHttpRequest();\n    request.open('GET', url, true);\n\n    request.onload = function() {\n      if (this.status >= 200 && this.status < 400) {\n        // Success!\n        var data = JSON.parse(this.response);\n        console.log(\"SEARCH DATA\", data);\n\n        self._data = data;\n\n      } else {\n        // We reached our target server, but it returned an error\n\n        self._data = null;\n        console.log(this.response);\n      }\n\n      self._reader.tracking.action(\"search/submitQuery\");\n      self.openModalResults();\n\n    };\n\n    request.onerror = function() {\n      // There was a connection error of some sort\n      self._data = null;\n      self.openModalResults();\n    };\n\n    request.send();\n\n  },\n\n  _emptyArticle: function() {\n    while (this._article && this._article.hasChildNodes()) {\n      this._article.removeChild(this._article.lastChild);\n    }\n  },\n\n  _buildResults: function() {\n    var self = this;\n    var content;\n\n    this._processing = false;\n\n    self._emptyArticle();\n\n    var reader = this._reader;\n    reader.annotations.reset();\n\n    if ( this._data ) {\n      var highlight = true\n      if (this._data.highlight_off == \"yes\") {\n        highlight = false;\n      }\n      if ( this._data.search_results.length ) {\n        content = DomUtil.create('ul');\n\n        this._data.search_results.forEach(function(result) {\n          var option = DomUtil.create('li');\n          var anchor = DomUtil.create('a', null, option);\n          var cfiRange = \"epubcfi(\" + result.cfi + \")\";\n\n          if (result.snippet) {\n            if (result.title) {\n              var chapterTitle = DomUtil.create('i');\n              chapterTitle.textContent = result.title + \": \";\n              anchor.appendChild(chapterTitle);\n            }\n            anchor.appendChild(document.createTextNode(result.snippet));\n\n            anchor.setAttribute(\"href\", cfiRange);\n            content.appendChild(option);\n          }\n          if (highlight) {\n            reader.annotations.highlight(cfiRange);\n          }\n        });\n      } else {\n        content = DomUtil.create(\"p\")\n        content.textContent = 'No results found for \"' + self.searchString + '\"';\n      }\n    } else {\n      content = DomUtil.create(\"p\")\n      content.textContent = 'There was a problem processing this query.';\n    }\n\n    self._article.appendChild(content);\n  },\n\n  EOT: true\n});\n\nexport var search = function(options) {\n  return new Search(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var BibliographicInformation = Control.extend({\n  options: {\n    label: 'Info',\n    direction: 'left',\n    html: '<span class=\"oi\" data-glyph=\"info\">Info</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-bib-info oi\" data-glyph=\"info\" data-toggle=\"open\" aria-label=\"Bibliographic Information\"> Info</button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<dl>\n    </dl>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Info',\n      region: 'left',\n      fraction: 1.0\n    });\n\n    var dl = this._modal._container.querySelector('dl');\n\n    var metadata_fields = [\n      [ 'title', 'Title' ],\n      [ 'creator', 'Author' ],\n      [ 'pubdate', 'Publication Date' ],\n      [ 'modified_date', 'Modified Date' ],\n      [ 'publisher', 'Publisher' ],\n      [ 'rights', 'Rights' ],\n      [ 'doi', 'DOI' ],\n      [ 'description', 'Description' ],\n    ];\n\n    var metadata_fields_seen = {};\n\n    var metadata = this._reader.metadata;\n\n    for(var idx in metadata_fields) {\n      var key = metadata_fields[idx][0];\n      var label = metadata_fields[idx][1];\n      if ( metadata[key] ) {\n        var value = metadata[key];\n        if ( key == 'pubdate' || key == 'modified_date' ) {\n          value = this._formatDate(value);\n          if ( ! value ) { continue; }\n          // value = d.toISOString().slice(0,10); // for YYYY-MM-DD\n        }\n        metadata_fields_seen[key] = true;\n        var dt = DomUtil.create('dt', 'cozy-bib-info-label', dl);\n        dt.innerHTML = label;\n        var dd = DomUtil.create('dd', 'cozy-bib-info-value cozy-bib-info-value-' + key, dl);\n        dd.innerHTML = value;\n      }\n    }\n\n  },\n\n  _formatDate: function(value) {\n    var match = value.match(/\\d{4}/);\n    if ( match ) {\n      return match[0];\n    }\n    return null;\n  },\n\n  EOT: true\n});\n\nexport var bibliographicInformation = function(options) {\n  return new BibliographicInformation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Download = Control.extend({\n  options: {\n    label: 'Download Book',\n    html: '<span>Download Book</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-download oi\" data-toggle=\"open\" data-glyph=\"data-transfer-download\"> Download Book</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('updateContents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Choose File Format</legend>\n      </fieldset>\n    </form>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Download Book',\n      className: 'cozy-modal-download',\n      actions: [\n        {\n          label: 'Download',\n          callback: function(event) {\n            var selected = self._form.querySelector(\"input:checked\");\n            var href = selected.getAttribute('data-href');\n            self._configureDownloadForm(href);\n            self._form.submit();\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');    \n    var fieldset = this._form.querySelector('fieldset');\n    this._reader.options.download_links.forEach(function(link, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', link.format);\n      input.setAttribute('data-href', link.href);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = link.format;\n      if ( link.size ) {\n        text += \" (\" + link.size + \")\";\n      }\n      var text = document.createTextNode(\" \" + text);\n      label.appendChild(text);\n    });\n\n  },\n\n  _configureDownloadForm: function(href) {\n    var self = this;\n    self._form.setAttribute('method', 'GET');\n    self._form.setAttribute('action', href);\n    self._form.setAttribute('target', '_blank');\n  },\n\n\n  EOT: true\n});\n\nexport var download = function(options) {\n  return new Download(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Navigator = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n    } else {\n\n      var className = this._className('navigator'),\n          options = this.options;\n      \n      container = DomUtil.create('div', className);\n    }\n    this._setup(container);\n\n    this._reader.on('updateLocations', function(locations) {      \n      // if ( ! this._reader.currentLocation() || ! this._reader.currentLocation().start ) {\n      //   console.log(\"AHOY updateLocations NO START\", this._reader.currentLocation().then);\n      //   setTimeout(function() {\n      //     this._initializeNavigator(locations);\n      //   }.bind(this), 100);\n      //   return;\n      // }\n      this._initializeNavigator(locations);\n    }.bind(this));\n\n    return container;\n  },\n\n  _setup: function(container) {\n    this._control = container.querySelector(\"input[type=range]\");\n    if ( ! this._control ) {\n      this._createControl(container);\n    }\n    this._background = container.querySelector(\".cozy-navigator-range__background\");\n    this._status = container.querySelector(\".cozy-navigator-range__status\");\n    this._spanCurrentPercentage = container.querySelector(\".currentPercentage\");\n    this._spanCurrentLocation = container.querySelector(\".currentLocation\");\n    this._spanTotalLocations = container.querySelector(\".totalLocations\");\n\n    this._bindEvents();\n  },\n\n  _createControl: function (container) {\n    var template = `<div class=\"cozy-navigator-range\">\n        <label class=\"u-screenreader\" for=\"cozy-navigator-range-input\">Location: </label>\n        <input class=\"cozy-navigator-range__input\" id=\"cozy-navigator-range-input\" type=\"range\" name=\"locations-range-value\" min=\"0\" max=\"100\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\" aria-valuetext=\"0% • Location 0 of ?\" value=\"0\" data-background-position=\"0\" />\n        <div class=\"cozy-navigator-range__background\"></div>\n      </div>\n      <div class=\"cozy-navigator-range__status\"><span class=\"currentPercentage\">0%</span> • Location <span class=\"currentLocation\">0</span> of <span class=\"totalLocations\">?</span></div>\n    `;\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      container.appendChild(body.children[0]);\n    }\n\n    this._control = container.querySelector(\"input[type=range]\");\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    this._control.addEventListener(\"input\", function() {\n      self._update();\n    }, false);\n    this._control.addEventListener(\"change\", function() { self._action(); }, false);\n    this._control.addEventListener(\"mousedown\", function(){\n        self._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"mouseup\", function(){\n        self._mouseDown = false;\n    }, false);\n    this._control.addEventListener(\"keydown\", function(){\n      self._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"keyup\", function(){\n      self._mouseDown = false;\n    }, false);\n\n    this._reader.on('relocated', function(location) {\n      if ( ! self._initiated ) { return; }\n      if ( ! self._mouseDown ) {\n        self._control.value = Math.ceil(self._reader.locations.percentageFromCfi(self._reader.currentLocation().start.cfi) * 100);\n        self._update();\n      }\n    })\n\n  },\n\n  _action: function() {\n    var value = this._control.value;\n    var locations = this._reader.locations;\n    var cfi = locations.cfiFromPercentage(value / 100);\n    this._reader.tracking.action(\"navigator/go\");\n    this._reader.gotoPage(cfi);\n  },\n\n  _update: function() {\n    var self = this;\n\n    var current = this._reader.currentLocation();\n    if ( ! current || ! current.start ) {\n      setTimeout(function() {\n        this._update();\n      }.bind(this), 100);\n    }\n\n    var rangeBg = this._background;\n    var range = self._control;\n\n    var value = parseInt(range.value, 10);\n    var percentage = value;\n\n    rangeBg.setAttribute('style', 'background-position: ' + (-percentage) + '% 0%, left top;');\n    self._control.setAttribute('data-background-position', Math.ceil(percentage));\n\n    this._spanCurrentPercentage.innerHTML = percentage + '%';\n    if ( current && current.start ) {\n      var current_location = this._reader.locations.locationFromCfi(current.start.cfi);\n      this._spanCurrentLocation.innerHTML = ( current_location );\n    }\n    self._last_delta = self._last_value > value; self._last_value = value;\n  },\n\n  _initializeNavigator: function(locations) {\n    console.log(\"AHOY updateLocations PROCESSING LOCATION\");\n    this._initiated = true;\n    this._total = this._reader.locations.total;\n    if ( this._reader.currentLocation() && this._reader.currentLocation().start ) {\n      this._control.value = Math.ceil(this._reader.locations.percentageFromCfi(this._reader.currentLocation().start.cfi) * 100);\n      this._last_value = this._control.value;\n    } else {\n      this._last_value = this._control.value;\n    }\n\n    this._spanTotalLocations.innerHTML = this._total;\n\n    this._update();\n    setTimeout(function() {\n      DomUtil.addClass(this._container, 'initialized');\n    }.bind(this), 0);\n  },\n\n  EOT: true\n});\n\nexport var navigator = function(options) {\n  return new Navigator(options);\n}\n","import {Control, control} from './Control';\nimport {PageNext, PagePrevious, pageNext, pagePrevious, PageFirst, pageFirst, PageLast, pageLast} from './Control.Paging';\nimport {Contents, contents} from './Control.Contents';\nimport {Title, title} from './Control.Title';\nimport {PublicationMetadata, publicationMetadata} from './Control.PublicationMetadata';\nimport {Preferences, preferences} from './Control.Preferences';\nimport {Widget, widget} from './Control.Widget';\nimport {Citation, citation} from './Control.Citation';\nimport {Search, search} from './Control.Search';\nimport {BibliographicInformation, bibliographicInformation} from './Control.BibliographicInformation';\nimport {Download, download} from './Control.Download';\nimport {Navigator, navigator} from './Control.Navigator';\n\n// import {Zoom, zoom} from './Control.Zoom';\n// import {Attribution, attribution} from './Control.Attribution';\n\nControl.PageNext = PageNext;\nControl.PagePrevious = PagePrevious;\nControl.PageFirst = PageFirst;\nControl.PageLast = PageLast;\ncontrol.pagePrevious = pagePrevious;\ncontrol.pageNext = pageNext;\ncontrol.pageFirst = pageFirst;\ncontrol.pageLast = pageLast;\n\nControl.Contents = Contents;\ncontrol.contents = contents;\n\nControl.Title = Title;\ncontrol.title = title;\n\nControl.PublicationMetadata = PublicationMetadata;\ncontrol.publicationMetadata = publicationMetadata;\n\nControl.Preferences = Preferences;\ncontrol.preferences = preferences;\n\nControl.Widget = Widget;\ncontrol.widget = widget;\n\nControl.Citation = Citation;\ncontrol.citation = citation;\n\nControl.Search = Search;\ncontrol.search = search;\n\nControl.BibliographicInformation = BibliographicInformation;\ncontrol.bibliographicInformation = bibliographicInformation;\n\nControl.Download = Download;\ncontrol.download = download;\n\nControl.Navigator = Navigator;\ncontrol.navigator = navigator;\n\nexport {Control, control};\n","import {Evented} from './Events';\n\nvar Bus = Evented.extend({\n});\n\nvar instance;\nexport var bus = function() {\n  return instance || ( instance = new Bus() );\n}\n","import * as Browser from './Browser';\nexport {Browser};\n\nexport {Class} from './Class';\n\nimport {Evented} from './Events';\nexport {Evented};\nexport var Mixin = {Events: Evented.prototype};\n\nimport * as Util from './Util';\nexport {Util};\nexport {extend, bind, stamp, setOptions} from './Util';\nexport {bus} from './Bus';\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn (obj.foo + obj.bar + obj.trzy) === \"razdwatrzy\";\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n return false;\n}\n};\n","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) {\n return (val !== _undefined) && (val !== null);\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) {\n\treturn keys(isValue(object) ? Object(object) : object);\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")()\n\t? Object.keys\n\t: require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")()\n\t? Object.assign\n\t: require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","// Deprecated\n\n\"use strict\";\n\nmodule.exports = function (obj) {\n return typeof obj === \"function\";\n};\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn (str.contains(\"dwa\") === true) && (str.contains(\"foo\") === false);\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")()\n\t? String.prototype.contains\n\t: require(\"./shim\");\n","'use strict';\n\nvar assign        = require('es5-ext/object/assign')\n  , normalizeOpts = require('es5-ext/object/normalize-options')\n  , isCallable    = require('es5-ext/object/is-callable')\n  , contains      = require('es5-ext/string/#/contains')\n\n  , d;\n\nd = module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif ((arguments.length < 2) || (typeof dscr !== 'string')) {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (dscr == null) {\n\t\tc = w = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t\tw = contains.call(dscr, 'w');\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== 'string') {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (get == null) {\n\t\tget = undefined;\n\t} else if (!isCallable(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (set == null) {\n\t\tset = undefined;\n\t} else if (!isCallable(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (dscr == null) {\n\t\tc = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","/**\n * Core Utilities and Helpers\n * @module Core\n*/\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nexport const requestAnimationFrame = (typeof window != \"undefined\") ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\nconst _URL = typeof URL != \"undefined\" ? URL : (typeof window != \"undefined\" ? (window.URL || window.webkitURL || window.mozURL) : undefined);\n\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\nexport function uuid() {\n\tvar d = new Date().getTime();\n\tvar uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\td = Math.floor(d/16);\n\t\treturn (c==\"x\" ? r : (r&0x7|0x8)).toString(16);\n\t});\n\treturn uuid;\n}\n\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\nexport function documentHeight() {\n\treturn Math.max(\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight\n\t);\n}\n\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\nexport function isElement(obj) {\n\treturn !!(obj && obj.nodeType == 1);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isNumber(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isFloat(n) {\n\tlet f = parseFloat(n);\n\n\tif (isNumber(n) === false) {\n\t\treturn false;\n\t}\n\n\tif (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n\t\treturn true;\n\t}\n\n\treturn Math.floor(f) !== f;\n}\n\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\nexport function prefixed(unprefixed) {\n\tvar vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\" ];\n\tvar prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n\tvar upper = unprefixed[0].toUpperCase() + unprefixed.slice(1);\n\tvar length = vendors.length;\n\n\tif (typeof(document) === \"undefined\" || typeof(document.body.style[unprefixed]) != \"undefined\") {\n\t\treturn unprefixed;\n\t}\n\n\tfor ( var i=0; i < length; i++ ) {\n\t\tif (typeof(document.body.style[vendors[i] + upper]) != \"undefined\") {\n\t\t\treturn prefixes[i] + unprefixed;\n\t\t}\n\t}\n\n\treturn unprefixed;\n}\n\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\nexport function defaults(obj) {\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\n\t\tvar source = arguments[i];\n\t\tfor (var prop in source) {\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\n\t\t}\n\t}\n\treturn obj;\n}\n\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\nexport function extend(target) {\n\tvar sources = [].slice.call(arguments, 1);\n\tsources.forEach(function (source) {\n\t\tif(!source) return;\n\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\n\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n\t\t});\n\t});\n\treturn target;\n}\n\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function insert(item, array, compareFunction) {\n\tvar location = locationOf(item, array, compareFunction);\n\tarray.splice(location, 0, item);\n\n\treturn location;\n}\n\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function locationOf(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn pivot;\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared >= 0 ? pivot : pivot + 1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot;\n\t}\n\tif(compared === -1) {\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\n\t}\n}\n\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn -1; // Not found\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared === 0 ? pivot : -1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot; // Found\n\t}\n\tif(compared === -1) {\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\n\t}\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function bounds(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function borders(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\nexport function nodeBounds(node) {\n\tlet elPos;\n\tlet doc = node.ownerDocument;\n\tif(node.nodeType == Node.TEXT_NODE){\n\t\tlet elRange = doc.createRange();\n\t\telRange.selectNodeContents(node);\n\t\telPos = elRange.getBoundingClientRect();\n\t} else {\n\t\telPos = node.getBoundingClientRect();\n\t}\n\treturn elPos;\n}\n\n/**\n * Find the equivelent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\nexport function windowBounds() {\n\n\tvar width = window.innerWidth;\n\tvar height = window.innerHeight;\n\n\treturn {\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tright: width,\n\t\tbottom: height,\n\t\twidth: width,\n\t\theight: height\n\t};\n\n}\n\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\nexport function indexOfNode(node, typeId) {\n\tvar parent = node.parentNode;\n\tvar children = parent.childNodes;\n\tvar sib;\n\tvar index = -1;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tsib = children[i];\n\t\tif (sib.nodeType === typeId) {\n\t\t\tindex++;\n\t\t}\n\t\tif (sib == node) break;\n\t}\n\n\treturn index;\n}\n\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfTextNode(textNode) {\n\treturn indexOfNode(textNode, TEXT_NODE);\n}\n\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfElementNode(elementNode) {\n\treturn indexOfNode(elementNode, ELEMENT_NODE);\n}\n\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\nexport function isXml(ext) {\n\treturn [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\nexport function createBlob(content, mime){\n\treturn new Blob([content], {type : mime });\n}\n\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBlobUrl(content, mime){\n\tvar tempUrl;\n\tvar blob = createBlob(content, mime);\n\n\ttempUrl = _URL.createObjectURL(blob);\n\n\treturn tempUrl;\n}\n\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\nexport function revokeBlobUrl(url){\n\treturn _URL.revokeObjectURL(url);\n}\n\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBase64Url(content, mime){\n\tvar data;\n\tvar datauri;\n\n\tif (typeof(content) !== \"string\") {\n\t\t// Only handles strings\n\t\treturn;\n\t}\n\n\tdata = btoa(encodeURIComponent(content));\n\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\n\n\treturn datauri;\n}\n\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\nexport function type(obj){\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\n}\n\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\nexport function parse(markup, mime, forceXMLDom) {\n\tvar doc;\n\tvar Parser;\n\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\n\t\tParser = require(\"xmldom\").DOMParser;\n\t} else {\n\t\tParser = DOMParser;\n\t}\n\n\t// Remove byte order mark before parsing\n\t// https://www.w3.org/International/questions/qa-byte-order-mark\n\tif(markup.charCodeAt(0) === 0xFEFF) {\n\t\tmarkup = markup.slice(1);\n\t}\n\n\tdoc = new Parser().parseFromString(markup, mime);\n\n\treturn doc;\n}\n\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\nexport function qs(el, sel) {\n\tvar elements;\n\tif (!el) {\n\t\tthrow new Error(\"No Element Provided\");\n\t}\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\telements = el.getElementsByTagName(sel);\n\t\tif (elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\t}\n}\n\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsa(el, sel) {\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelectorAll(sel);\n\t} else {\n\t\treturn el.getElementsByTagName(sel);\n\t}\n}\n\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsp(el, sel, props) {\n\tvar q, filtered;\n\tif (typeof el.querySelector != \"undefined\") {\n\t\tsel += \"[\";\n\t\tfor (var prop in props) {\n\t\t\tsel += prop + \"~='\" + props[prop] + \"'\";\n\t\t}\n\t\tsel += \"]\";\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\tq = el.getElementsByTagName(sel);\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\n\t\t\tfor (var prop in props) {\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (filtered) {\n\t\t\treturn filtered[0];\n\t\t}\n\t}\n}\n\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n\tvar doc = root.ownerDocument || root;\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\n\t} else {\n\t\twalk(root, function(node) {\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\n\t\t\t\tfunc(node);\n\t\t\t}\n\t\t}, true);\n\t}\n}\n\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter funtion or object to filter with\n */\nexport function treeWalker(root, func, filter) {\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\n\tlet node;\n\twhile ((node = treeWalker.nextNode())) {\n\t\tfunc(node);\n\t}\n}\n\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\nexport function walk(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tnode = node.firstChild;\n\tif(node){\n\t\tdo{\n\t\t\tlet walked = walk(node,callback);\n\t\t\tif(walked){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tnode = node.nextSibling;\n\t\t} while(node);\n\t}\n}\n\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\nexport function blob2base64(blob) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar reader = new FileReader();\n\t\treader.readAsDataURL(blob);\n\t\treader.onloadend = function() {\n\t\t\tresolve(reader.result);\n\t\t};\n\t});\n}\n\n\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\nexport function defer() {\n\t/* A method to resolve the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} value : This value is used to resolve the promise\n\t * If the value is a Promise then the associated promise assumes the state\n\t * of Promise passed as value.\n\t */\n\tthis.resolve = null;\n\n\t/* A method to reject the assocaited Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} reason: The reason for the rejection of the Promise.\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\n\t * itself will be the reason for rejection no matter the state of the Promise.\n\t */\n\tthis.reject = null;\n\n\tthis.id = uuid();\n\n\t/* A newly created Pomise object.\n\t * Initially in pending state.\n\t */\n\tthis.promise = new Promise((resolve, reject) => {\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t});\n\tObject.freeze(this);\n}\n\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function querySelectorByType(html, element, type){\n\tvar query;\n\tif (typeof html.querySelector != \"undefined\") {\n\t\tquery = html.querySelector(`${element}[*|type=\"${type}\"]`);\n\t}\n\t// Handle IE not supporting namespaced epub:type in querySelector\n\tif(!query || query.length === 0) {\n\t\tquery = qsa(html, element);\n\t\tfor (var i = 0; i < query.length; i++) {\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type ||\n\t\t\t\t query[i].getAttribute(\"epub:type\") === type) {\n\t\t\t\treturn query[i];\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn query;\n\t}\n}\n\n/**\n * Find direct decendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\nexport function findChildren(el) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function parents(node) {\n\tvar nodes = [node];\n\tfor (; node; node = node.parentNode) {\n\t\tnodes.unshift(node);\n\t}\n\treturn nodes\n}\n\n/**\n * Find all direct decendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\nexport function filterChildren(el, nodeName, single) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n\t\t\tif (single) {\n\t\t\t\treturn node;\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t}\n\t}\n\tif (!single) {\n\t\treturn result;\n\t}\n}\n\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function getParentByTagName(node, tagname) {\n\tlet parent;\n\tif (node === null || tagname === '') return;\n\tparent = node.parentNode;\n\twhile (parent.nodeType === 1) {\n\t\tif (parent.tagName.toLowerCase() === tagname) {\n\t\t\treturn parent;\n\t\t}\n\t\tparent = parent.parentNode;\n\t}\n}\n\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\nexport class RangeObject {\n\tconstructor() {\n\t\tthis.collapsed = false;\n\t\tthis.commonAncestorContainer = undefined;\n\t\tthis.endContainer = undefined;\n\t\tthis.endOffset = undefined;\n\t\tthis.startContainer = undefined;\n\t\tthis.startOffset = undefined;\n\t}\n\n\tsetStart(startNode, startOffset) {\n\t\tthis.startContainer = startNode;\n\t\tthis.startOffset = startOffset;\n\n\t\tif (!this.endContainer) {\n\t\t\tthis.collapse(true);\n\t\t} else {\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tsetEnd(endNode, endOffset) {\n\t\tthis.endContainer = endNode;\n\t\tthis.endOffset = endOffset;\n\n\t\tif (!this.startContainer) {\n\t\t\tthis.collapse(false);\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tcollapse(toStart) {\n\t\tthis.collapsed = true;\n\t\tif (toStart) {\n\t\t\tthis.endContainer = this.startContainer;\n\t\t\tthis.endOffset = this.startOffset;\n\t\t\tthis.commonAncestorContainer = this.startContainer.parentNode;\n\t\t} else {\n\t\t\tthis.startContainer = this.endContainer;\n\t\t\tthis.startOffset = this.endOffset;\n\t\t\tthis.commonAncestorContainer = this.endOffset.parentNode;\n\t\t}\n\t}\n\n\tselectNode(referenceNode) {\n\t\tlet parent = referenceNode.parentNode;\n\t\tlet index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n\t\tthis.setStart(parent, index);\n\t\tthis.setEnd(parent, index + 1);\n\t}\n\n\tselectNodeContents(referenceNode) {\n\t\tlet end = referenceNode.childNodes[referenceNode.childNodes - 1];\n\t\tlet endIndex = (referenceNode.nodeType === 3) ?\n\t\t\t\treferenceNode.textContent.length : parent.childNodes.length;\n\t\tthis.setStart(referenceNode, 0);\n\t\tthis.setEnd(referenceNode, endIndex);\n\t}\n\n\t_commonAncestorContainer(startContainer, endContainer) {\n\t\tvar startParents = parents(startContainer || this.startContainer);\n\t\tvar endParents = parents(endContainer || this.endContainer);\n\n\t\tif (startParents[0] != endParents[0]) return undefined;\n\n\t\tfor (var i = 0; i < startParents.length; i++) {\n\t\t\tif (startParents[i] != endParents[i]) {\n\t\t\t\treturn startParents[i - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\t_checkCollapsed() {\n\t\tif (this.startContainer === this.endContainer &&\n\t\t\t\tthis.startOffset === this.endOffset) {\n\t\t\tthis.collapsed = true;\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t}\n\t}\n\n\ttoString() {\n\t\t// TODO: implement walking between start and end to find text\n\t}\n}\n","'use strict';\n\nif (!process) {\n  var process = {\n    \"cwd\" : function () { return '/' }\n  };\n}\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n","import path from \"path-webpack\";\n\n/**\n * Creates a Path object for parsing and manipulation of a path strings\n *\n * Uses a polyfill for Nodejs path: https://nodejs.org/api/path.html\n * @param\t{string} pathString\ta url string (relative or absolute)\n * @class\n */\nclass Path {\n\tconstructor(pathString) {\n\t\tvar protocol;\n\t\tvar parsed;\n\n\t\tprotocol = pathString.indexOf(\"://\");\n\t\tif (protocol > -1) {\n\t\t\tpathString = new URL(pathString).pathname;\n\t\t}\n\n\t\tparsed = this.parse(pathString);\n\n\t\tthis.path = pathString;\n\n\t\tif (this.isDirectory(pathString)) {\n\t\t\tthis.directory = pathString;\n\t\t} else {\n\t\t\tthis.directory = parsed.dir + \"/\";\n\t\t}\n\n\t\tthis.filename = parsed.base;\n\t\tthis.extension = parsed.ext.slice(1);\n\n\t}\n\n\t/**\n\t * Parse the path: https://nodejs.org/api/path.html#path_path_parse_path\n\t * @param\t{string} what\n\t * @returns {object}\n\t */\n\tparse (what) {\n\t\treturn path.parse(what);\n\t}\n\n\t/**\n\t * @param\t{string} what\n\t * @returns {boolean}\n\t */\n\tisAbsolute (what) {\n\t\treturn path.isAbsolute(what || this.path);\n\t}\n\n\t/**\n\t * Check if path ends with a directory\n\t * @param\t{string} what\n\t * @returns {boolean}\n\t */\n\tisDirectory (what) {\n\t\treturn (what.charAt(what.length-1) === \"/\");\n\t}\n\n\t/**\n\t * Resolve a path against the directory of the Path\n\t *\n\t * https://nodejs.org/api/path.html#path_path_resolve_paths\n\t * @param\t{string} what\n\t * @returns {string} resolved\n\t */\n\tresolve (what) {\n\t\treturn path.resolve(this.directory, what);\n\t}\n\n\t/**\n\t * Resolve a path relative to the directory of the Path\n\t *\n\t * https://nodejs.org/api/path.html#path_path_relative_from_to\n\t * @param\t{string} what\n\t * @returns {string} relative\n\t */\n\trelative (what) {\n\t\tvar isAbsolute = what && (what.indexOf(\"://\") > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\treturn path.relative(this.directory, what);\n\t}\n\n\tsplitPath(filename) {\n\t\treturn this.splitPathRe.exec(filename).slice(1);\n\t}\n\n\t/**\n\t * Return the path string\n\t * @returns {string} path\n\t */\n\ttoString () {\n\t\treturn this.path;\n\t}\n}\n\nexport default Path;\n","import Path from \"./path\";\nimport path from \"path-webpack\";\n\n/**\n * creates a Url object for parsing and manipulation of a url string\n * @param\t{string} urlString\ta url string (relative or absolute)\n * @param\t{string} [baseString] optional base for the url,\n * default to window.location.href\n */\nclass Url {\n\tconstructor(urlString, baseString) {\n\t\tvar absolute = (urlString.indexOf(\"://\") > -1);\n\t\tvar pathname = urlString;\n\t\tvar basePath;\n\n\t\tthis.Url = undefined;\n\t\tthis.href = urlString;\n\t\tthis.protocol = \"\";\n\t\tthis.origin = \"\";\n\t\tthis.hash = \"\";\n\t\tthis.hash = \"\";\n\t\tthis.search = \"\";\n\t\tthis.base = baseString;\n\n\t\tif (!absolute &&\n\t\t\t\tbaseString !== false &&\n\t\t\t\ttypeof(baseString) !== \"string\" &&\n\t\t\t\twindow && window.location) {\n\t\t\tthis.base = window.location.href;\n\t\t}\n\n\t\t// URL Polyfill doesn't throw an error if base is empty\n\t\tif (absolute || this.base) {\n\t\t\ttry {\n\t\t\t\tif (this.base) { // Safari doesn't like an undefined base\n\t\t\t\t\tthis.Url = new URL(urlString, this.base);\n\t\t\t\t} else {\n\t\t\t\t\tthis.Url = new URL(urlString);\n\t\t\t\t}\n\t\t\t\tthis.href = this.Url.href;\n\n\t\t\t\tthis.protocol = this.Url.protocol;\n\t\t\t\tthis.origin = this.Url.origin;\n\t\t\t\tthis.hash = this.Url.hash;\n\t\t\t\tthis.search = this.Url.search;\n\n\t\t\t\tpathname = this.Url.pathname;\n\t\t\t} catch (e) {\n\t\t\t\t// Skip URL parsing\n\t\t\t\tthis.Url = undefined;\n\t\t\t\t// resolve the pathname from the base\n\t\t\t\tif (this.base) {\n\t\t\t\t\tbasePath = new Path(this.base);\n\t\t\t\t\tpathname = basePath.resolve(pathname);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.Path = new Path(pathname);\n\n\t\tthis.directory = this.Path.directory;\n\t\tthis.filename = this.Path.filename;\n\t\tthis.extension = this.Path.extension;\n\n\t}\n\n\t/**\n\t * @returns {Path}\n\t */\n\tpath () {\n\t\treturn this.Path;\n\t}\n\n\t/**\n\t * Resolves a relative path to a absolute url\n\t * @param {string} what\n\t * @returns {string} url\n\t */\n\tresolve (what) {\n\t\tvar isAbsolute = (what.indexOf(\"://\") > -1);\n\t\tvar fullpath;\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\tfullpath = path.resolve(this.directory, what);\n\t\treturn this.origin + fullpath;\n\t}\n\n\t/**\n\t * Resolve a path relative to the url\n\t * @param {string} what\n\t * @returns {string} path\n\t */\n\trelative (what) {\n\t\treturn path.relative(what, this.directory);\n\t}\n\n\t/**\n\t * @returns {string}\n\t */\n\ttoString () {\n\t\treturn this.href;\n\t}\n}\n\nexport default Url;\n","import {extend, type, findChildren, RangeObject, isNumber} from \"./utils/core\";\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n\n/**\n\t* Parsing and creation of EpubCFIs: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\n\n\t* Implements:\n\t* - Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\n\t* - Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\n\n\t* Does Not Implement:\n\t* - Temporal Offset (~)\n\t* - Spatial Offset (@)\n\t* - Temporal-Spatial Offset (~ + @)\n\t* - Text Location Assertion ([)\n\t* @class\n\t@param {string | Range | Node } [cfiFrom]\n\t@param {string | object} [base]\n\t@param {string} [ignoreClass] class to ignore when parsing DOM\n*/\nclass EpubCFI {\n\tconstructor(cfiFrom, base, ignoreClass){\n\t\tvar type;\n\n\t\tthis.str = \"\";\n\n\t\tthis.base = {};\n\t\tthis.spinePos = 0; // For compatibility\n\n\t\tthis.range = false; // true || false;\n\n\t\tthis.path = {};\n\t\tthis.start = null;\n\t\tthis.end = null;\n\n\t\t// Allow instantiation without the \"new\" keyword\n\t\tif (!(this instanceof EpubCFI)) {\n\t\t\treturn new EpubCFI(cfiFrom, base, ignoreClass);\n\t\t}\n\n\t\tif(typeof base === \"string\") {\n\t\t\tthis.base = this.parseComponent(base);\n\t\t} else if(typeof base === \"object\" && base.steps) {\n\t\t\tthis.base = base;\n\t\t}\n\n\t\ttype = this.checkType(cfiFrom);\n\n\n\t\tif(type === \"string\") {\n\t\t\tthis.str = cfiFrom;\n\t\t\treturn extend(this, this.parse(cfiFrom));\n\t\t} else if (type === \"range\") {\n\t\t\treturn extend(this, this.fromRange(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === \"node\") {\n\t\t\treturn extend(this, this.fromNode(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === \"EpubCFI\" && cfiFrom.path) {\n\t\t\treturn cfiFrom;\n\t\t} else if (!cfiFrom) {\n\t\t\treturn this;\n\t\t} else {\n\t\t\tthrow new TypeError(\"not a valid argument for EpubCFI\");\n\t\t}\n\n\t}\n\n\t/**\n\t * Check the type of constructor input\n\t * @private\n\t */\n\tcheckType(cfi) {\n\n\t\tif (this.isCfiString(cfi)) {\n\t\t\treturn \"string\";\n\t\t// Is a range object\n\t\t} else if (cfi && typeof cfi === \"object\" && (type(cfi) === \"Range\" || typeof(cfi.startContainer) != \"undefined\")){\n\t\t\treturn \"range\";\n\t\t} else if (cfi && typeof cfi === \"object\" && typeof(cfi.nodeType) != \"undefined\" ){ // || typeof cfi === \"function\"\n\t\t\treturn \"node\";\n\t\t} else if (cfi && typeof cfi === \"object\" && cfi instanceof EpubCFI){\n\t\t\treturn \"EpubCFI\";\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Parse a cfi string to a CFI object representation\n\t * @param {string} cfiStr\n\t * @returns {object} cfi\n\t */\n\tparse(cfiStr) {\n\t\tvar cfi = {\n\t\t\tspinePos: -1,\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\t\tvar baseComponent, pathComponent, range;\n\n\t\tif(typeof cfiStr !== \"string\") {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tif(cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length-1] === \")\") {\n\t\t\t// Remove intial epubcfi( and ending )\n\t\t\tcfiStr = cfiStr.slice(8, cfiStr.length-1);\n\t\t}\n\n\t\tbaseComponent = this.getChapterComponent(cfiStr);\n\n\t\t// Make sure this is a valid cfi or return\n\t\tif(!baseComponent) {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tcfi.base = this.parseComponent(baseComponent);\n\n\t\tpathComponent = this.getPathComponent(cfiStr);\n\t\tcfi.path = this.parseComponent(pathComponent);\n\n\t\trange = this.getRange(cfiStr);\n\n\t\tif(range) {\n\t\t\tcfi.range = true;\n\t\t\tcfi.start = this.parseComponent(range[0]);\n\t\t\tcfi.end = this.parseComponent(range[1]);\n\t\t}\n\n\t\t// Get spine node position\n\t\t// cfi.spineSegment = cfi.base.steps[1];\n\n\t\t// Chapter segment is always the second step\n\t\tcfi.spinePos = cfi.base.steps[1].index;\n\n\t\treturn cfi;\n\t}\n\n\tparseComponent(componentStr){\n\t\tvar component = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar parts = componentStr.split(\":\");\n\t\tvar steps = parts[0].split(\"/\");\n\t\tvar terminal;\n\n\t\tif(parts.length > 1) {\n\t\t\tterminal = parts[1];\n\t\t\tcomponent.terminal = this.parseTerminal(terminal);\n\t\t}\n\n\t\tif (steps[0] === \"\") {\n\t\t\tsteps.shift(); // Ignore the first slash\n\t\t}\n\n\t\tcomponent.steps = steps.map(function(step){\n\t\t\treturn this.parseStep(step);\n\t\t}.bind(this));\n\n\t\treturn component;\n\t}\n\n\tparseStep(stepStr){\n\t\tvar type, num, index, has_brackets, id;\n\n\t\thas_brackets = stepStr.match(/\\[(.*)\\]/);\n\t\tif(has_brackets && has_brackets[1]){\n\t\t\tid = has_brackets[1];\n\t\t}\n\n\t\t//-- Check if step is a text node or element\n\t\tnum = parseInt(stepStr);\n\n\t\tif(isNaN(num)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(num % 2 === 0) { // Even = is an element\n\t\t\ttype = \"element\";\n\t\t\tindex = num / 2 - 1;\n\t\t} else {\n\t\t\ttype = \"text\";\n\t\t\tindex = (num - 1 ) / 2;\n\t\t}\n\n\t\treturn {\n\t\t\t\"type\" : type,\n\t\t\t\"index\" : index,\n\t\t\t\"id\" : id || null\n\t\t};\n\t}\n\n\tparseTerminal(termialStr){\n\t\tvar characterOffset, textLocationAssertion;\n\t\tvar assertion = termialStr.match(/\\[(.*)\\]/);\n\n\t\tif(assertion && assertion[1]){\n\t\t\tcharacterOffset = parseInt(termialStr.split(\"[\")[0]);\n\t\t\ttextLocationAssertion = assertion[1];\n\t\t} else {\n\t\t\tcharacterOffset = parseInt(termialStr);\n\t\t}\n\n\t\tif (!isNumber(characterOffset)) {\n\t\t\tcharacterOffset = null;\n\t\t}\n\n\t\treturn {\n\t\t\t\"offset\": characterOffset,\n\t\t\t\"assertion\": textLocationAssertion\n\t\t};\n\n\t}\n\n\tgetChapterComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\treturn indirection[0];\n\t}\n\n\tgetPathComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\tif(indirection[1]) {\n\t\t\tlet ranges = indirection[1].split(\",\");\n\t\t\treturn ranges[0];\n\t\t}\n\n\t}\n\n\tgetRange(cfiStr) {\n\n\t\tvar ranges = cfiStr.split(\",\");\n\n\t\tif(ranges.length === 3){\n\t\t\treturn [\n\t\t\t\tranges[1],\n\t\t\t\tranges[2]\n\t\t\t];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetCharecterOffsetComponent(cfiStr) {\n\t\tvar splitStr = cfiStr.split(\":\");\n\t\treturn splitStr[1] || \"\";\n\t}\n\n\tjoinSteps(steps) {\n\t\tif(!steps) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn steps.map(function(part){\n\t\t\tvar segment = \"\";\n\n\t\t\tif(part.type === \"element\") {\n\t\t\t\tsegment += (part.index + 1) * 2;\n\t\t\t}\n\n\t\t\tif(part.type === \"text\") {\n\t\t\t\tsegment += 1 + (2 * part.index); // TODO: double check that this is odd\n\t\t\t}\n\n\t\t\tif(part.id) {\n\t\t\t\tsegment += \"[\" + part.id + \"]\";\n\t\t\t}\n\n\t\t\treturn segment;\n\n\t\t}).join(\"/\");\n\n\t}\n\n\tsegmentString(segment) {\n\t\tvar segmentString = \"/\";\n\n\t\tsegmentString += this.joinSteps(segment.steps);\n\n\t\tif(segment.terminal && segment.terminal.offset != null){\n\t\t\tsegmentString += \":\" + segment.terminal.offset;\n\t\t}\n\n\t\tif(segment.terminal && segment.terminal.assertion != null){\n\t\t\tsegmentString += \"[\" + segment.terminal.assertion + \"]\";\n\t\t}\n\n\t\treturn segmentString;\n\t}\n\n\t/**\n\t * Convert CFI to a epubcfi(...) string\n\t * @returns {string} epubcfi\n\t */\n\ttoString() {\n\t\tvar cfiString = \"epubcfi(\";\n\n\t\tcfiString += this.segmentString(this.base);\n\n\t\tcfiString += \"!\";\n\t\tcfiString += this.segmentString(this.path);\n\n\t\t// Add Range, if present\n\t\tif(this.range && this.start) {\n\t\t\tcfiString += \",\";\n\t\t\tcfiString += this.segmentString(this.start);\n\t\t}\n\n\t\tif(this.range && this.end) {\n\t\t\tcfiString += \",\";\n\t\t\tcfiString += this.segmentString(this.end);\n\t\t}\n\n\t\tcfiString += \")\";\n\n\t\treturn cfiString;\n\t}\n\n\n\t/**\n\t * Compare which of two CFIs is earlier in the text\n\t * @returns {number} First is earlier = -1, Second is earlier = 1, They are equal = 0\n\t */\n\tcompare(cfiOne, cfiTwo) {\n\t\tvar stepsA, stepsB;\n\t\tvar terminalA, terminalB;\n\n\t\tvar rangeAStartSteps, rangeAEndSteps;\n\t\tvar rangeBEndSteps, rangeBEndSteps;\n\t\tvar rangeAStartTerminal, rangeAEndTerminal;\n\t\tvar rangeBStartTerminal, rangeBEndTerminal;\n\n\t\tif(typeof cfiOne === \"string\") {\n\t\t\tcfiOne = new EpubCFI(cfiOne);\n\t\t}\n\t\tif(typeof cfiTwo === \"string\") {\n\t\t\tcfiTwo = new EpubCFI(cfiTwo);\n\t\t}\n\t\t// Compare Spine Positions\n\t\tif(cfiOne.spinePos > cfiTwo.spinePos) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(cfiOne.spinePos < cfiTwo.spinePos) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (cfiOne.range) {\n\t\t\tstepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\n\t\t\tterminalA = cfiOne.start.terminal;\n\t\t} else {\n\t\t\tstepsA = cfiOne.path.steps;\n\t\t\tterminalA = cfiOne.path.terminal;\n\t\t}\n\n\t\tif (cfiTwo.range) {\n\t\t\tstepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\n\t\t\tterminalB = cfiTwo.start.terminal;\n\t\t} else {\n\t\t\tstepsB = cfiTwo.path.steps;\n\t\t\tterminalB = cfiTwo.path.terminal;\n\t\t}\n\n\t\t// Compare Each Step in the First item\n\t\tfor (var i = 0; i < stepsA.length; i++) {\n\t\t\tif(!stepsA[i]) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif(!stepsB[i]) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index > stepsB[i].index) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index < stepsB[i].index) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t// Otherwise continue checking\n\t\t}\n\n\t\t// All steps in First equal to Second and First is Less Specific\n\t\tif(stepsA.length < stepsB.length) {\n\t\t\treturn 1;\n\t\t}\n\n\t\t// Compare the charecter offset of the text node\n\t\tif(terminalA.offset > terminalB.offset) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(terminalA.offset < terminalB.offset) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// CFI's are equal\n\t\treturn 0;\n\t}\n\n\tstep(node) {\n\t\tvar nodeType = (node.nodeType === TEXT_NODE) ? \"text\" : \"element\";\n\n\t\treturn {\n\t\t\t\"id\" : node.id,\n\t\t\t\"tagName\" : node.tagName,\n\t\t\t\"type\" : nodeType,\n\t\t\t\"index\" : this.position(node)\n\t\t};\n\t}\n\n\tfilteredStep(node, ignoreClass) {\n\t\tvar filteredNode = this.filter(node, ignoreClass);\n\t\tvar nodeType;\n\n\t\t// Node filtered, so ignore\n\t\tif (!filteredNode) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise add the filter node in\n\t\tnodeType = (filteredNode.nodeType === TEXT_NODE) ? \"text\" : \"element\";\n\n\t\treturn {\n\t\t\t\"id\" : filteredNode.id,\n\t\t\t\"tagName\" : filteredNode.tagName,\n\t\t\t\"type\" : nodeType,\n\t\t\t\"index\" : this.filteredPosition(filteredNode, ignoreClass)\n\t\t};\n\t}\n\n\tpathTo(node, offset, ignoreClass) {\n\t\tvar segment = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar currentNode = node;\n\t\tvar step;\n\n\t\twhile(currentNode && currentNode.parentNode &&\n\t\t\t\t\tcurrentNode.parentNode.nodeType != DOCUMENT_NODE) {\n\n\t\t\tif (ignoreClass) {\n\t\t\t\tstep = this.filteredStep(currentNode, ignoreClass);\n\t\t\t} else {\n\t\t\t\tstep = this.step(currentNode);\n\t\t\t}\n\n\t\t\tif (step) {\n\t\t\t\tsegment.steps.unshift(step);\n\t\t\t}\n\n\t\t\tcurrentNode = currentNode.parentNode;\n\n\t\t}\n\n\t\tif (offset != null && offset >= 0) {\n\n\t\t\tsegment.terminal.offset = offset;\n\n\t\t\t// Make sure we are getting to a textNode if there is an offset\n\t\t\tif(segment.steps[segment.steps.length-1].type != \"text\") {\n\t\t\t\tsegment.steps.push({\n\t\t\t\t\t\"type\" : \"text\",\n\t\t\t\t\t\"index\" : 0\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\n\t\treturn segment;\n\t}\n\n\tequalStep(stepA, stepB) {\n\t\tif (!stepA || !stepB) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif(stepA.index === stepB.index &&\n\t\t\t stepA.id === stepB.id &&\n\t\t\t stepA.type === stepB.type) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Create a CFI object from a Range\n\t * @param {Range} range\n\t * @param {string | object} base\n\t * @param {string} [ignoreClass]\n\t * @returns {object} cfi\n\t */\n\tfromRange(range, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\n\t\tvar start = range.startContainer;\n\t\tvar end = range.endContainer;\n\n\t\tvar startOffset = range.startOffset;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar needsIgnoring = false;\n\n\t\tif (ignoreClass) {\n\t\t\t// Tell pathTo if / what to ignore\n\t\t\tneedsIgnoring = (start.ownerDocument.querySelector(\".\" + ignoreClass) != null);\n\t\t}\n\n\n\t\tif (typeof base === \"string\") {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === \"object\") {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\t\t\tcfi.path = this.pathTo(start, startOffset, ignoreClass);\n\t\t} else {\n\t\t\tcfi.range = true;\n\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.start = this.pathTo(start, startOffset, ignoreClass);\n\t\t\tif (needsIgnoring) {\n\t\t\t\tendOffset = this.patchOffset(end, endOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.end = this.pathTo(end, endOffset, ignoreClass);\n\n\t\t\t// Create a new empty path\n\t\t\tcfi.path = {\n\t\t\t\tsteps: [],\n\t\t\t\tterminal: null\n\t\t\t};\n\n\t\t\t// Push steps that are shared between start and end to the common path\n\t\t\tvar len = cfi.start.steps.length;\n\t\t\tvar i;\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\n\t\t\t\t\tif(i === len-1) {\n\t\t\t\t\t\t// Last step is equal, check terminals\n\t\t\t\t\t\tif(cfi.start.terminal === cfi.end.terminal) {\n\t\t\t\t\t\t\t// CFI's are equal\n\t\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t\t\t// Not a range\n\t\t\t\t\t\t\tcfi.range = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\n\t\t\tcfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length);\n\n\t\t\t// TODO: Add Sanity check to make sure that the end if greater than the start\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Create a CFI object from a Node\n\t * @param {Node} anchor\n\t * @param {string | object} base\n\t * @param {string} [ignoreClass]\n\t * @returns {object} cfi\n\t */\n\tfromNode(anchor, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\trange: false,\n\t\t\tbase: {},\n\t\t\tpath: {},\n\t\t\tstart: null,\n\t\t\tend: null\n\t\t};\n\n\t\tif (typeof base === \"string\") {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === \"object\") {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tcfi.path = this.pathTo(anchor, null, ignoreClass);\n\n\t\treturn cfi;\n\t}\n\n\tfilter(anchor, ignoreClass) {\n\t\tvar needsIgnoring;\n\t\tvar sibling; // to join with\n\t\tvar parent, previousSibling, nextSibling;\n\t\tvar isText = false;\n\n\t\tif (anchor.nodeType === TEXT_NODE) {\n\t\t\tisText = true;\n\t\t\tparent = anchor.parentNode;\n\t\t\tneedsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\n\t\t} else {\n\t\t\tisText = false;\n\t\t\tneedsIgnoring = anchor.classList.contains(ignoreClass);\n\t\t}\n\n\t\tif (needsIgnoring && isText) {\n\t\t\tpreviousSibling = parent.previousSibling;\n\t\t\tnextSibling = parent.nextSibling;\n\n\t\t\t// If the sibling is a text node, join the nodes\n\t\t\tif (previousSibling && previousSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = previousSibling;\n\t\t\t} else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = nextSibling;\n\t\t\t}\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t} else {\n\t\t\t\t// Parent will be ignored on next step\n\t\t\t\treturn anchor;\n\t\t\t}\n\n\t\t} else if (needsIgnoring && !isText) {\n\t\t\t// Otherwise just skip the element node\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// No need to filter\n\t\t\treturn anchor;\n\t\t}\n\n\t}\n\n\tpatchOffset(anchor, offset, ignoreClass) {\n\t\tif (anchor.nodeType != TEXT_NODE) {\n\t\t\tthrow new Error(\"Anchor must be a text node\");\n\t\t}\n\n\t\tvar curr = anchor;\n\t\tvar totalOffset = offset;\n\n\t\t// If the parent is a ignored node, get offset from it's start\n\t\tif (anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\tcurr = anchor.parentNode;\n\t\t}\n\n\t\twhile (curr.previousSibling) {\n\t\t\tif(curr.previousSibling.nodeType === ELEMENT_NODE) {\n\t\t\t\t// Originally a text node, so join\n\t\t\t\tif(curr.previousSibling.classList.contains(ignoreClass)){\n\t\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t\t} else {\n\t\t\t\t\tbreak; // Normal node, dont join\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling is a text node, join the nodes\n\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t}\n\n\t\t\tcurr = curr.previousSibling;\n\t\t}\n\n\t\treturn totalOffset;\n\n\t}\n\n\tnormalizedMap(children, nodeType, ignoreClass) {\n\t\tvar output = {};\n\t\tvar prevIndex = -1;\n\t\tvar i, len = children.length;\n\t\tvar currNodeType;\n\t\tvar prevNodeType;\n\n\t\tfor (i = 0; i < len; i++) {\n\n\t\t\tcurrNodeType = children[i].nodeType;\n\n\t\t\t// Check if needs ignoring\n\t\t\tif (currNodeType === ELEMENT_NODE &&\n\t\t\t\t\tchildren[i].classList.contains(ignoreClass)) {\n\t\t\t\tcurrNodeType = TEXT_NODE;\n\t\t\t}\n\n\t\t\tif (i > 0 &&\n\t\t\t\t\tcurrNodeType === TEXT_NODE &&\n\t\t\t\t\tprevNodeType === TEXT_NODE) {\n\t\t\t\t// join text nodes\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t} else if (nodeType === currNodeType){\n\t\t\t\tprevIndex = prevIndex + 1;\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t}\n\n\t\t\tprevNodeType = currNodeType;\n\n\t\t}\n\n\t\treturn output;\n\t}\n\n\tposition(anchor) {\n\t\tvar children, index;\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tif (!children) {\n\t\t\t\tchildren = findChildren(anchor.parentNode);\n\t\t\t}\n\t\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\t\t} else {\n\t\t\tchildren = this.textNodes(anchor.parentNode);\n\t\t\tindex = children.indexOf(anchor);\n\t\t}\n\n\t\treturn index;\n\t}\n\n\tfilteredPosition(anchor, ignoreClass) {\n\t\tvar children, index, map;\n\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tmap = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\n\t\t} else {\n\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t// Inside an ignored node\n\t\t\tif(anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\t\tanchor = anchor.parentNode;\n\t\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t}\n\t\t\tmap = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\t}\n\n\n\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\n\t\treturn map[index];\n\t}\n\n\tstepsToXpath(steps) {\n\t\tvar xpath = [\".\", \"*\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\txpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\txpath.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\txpath.push(\"*[\" + position + \"]\");\n\t\t\t}\n\t\t});\n\n\t\treturn xpath.join(\"/\");\n\t}\n\n\n\t/*\n\n\tTo get the last step if needed:\n\n\t// Get the terminal step\n\tlastStep = steps[steps.length-1];\n\t// Get the query string\n\tquery = this.stepsToQuery(steps);\n\t// Find the containing element\n\tstartContainerParent = doc.querySelector(query);\n\t// Find the text node within that element\n\tif(startContainerParent && lastStep.type == \"text\") {\n\t\tcontainer = startContainerParent.childNodes[lastStep.index];\n\t}\n\t*/\n\tstepsToQuerySelector(steps) {\n\t\tvar query = [\"html\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\tquery.push(\"#\" + step.id);\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\t// unsupported in querySelector\n\t\t\t\t// query.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\tquery.push(\"*:nth-child(\" + position + \")\");\n\t\t\t}\n\t\t});\n\n\t\treturn query.join(\">\");\n\n\t}\n\n\ttextNodes(container, ignoreClass) {\n\t\treturn Array.prototype.slice.call(container.childNodes).\n\t\t\tfilter(function (node) {\n\t\t\t\tif (node.nodeType === TEXT_NODE) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (ignoreClass && node.classList.contains(ignoreClass)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t}\n\n\twalkToNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container = doc.documentElement;\n\t\tvar children;\n\t\tvar step;\n\t\tvar len = steps.length;\n\t\tvar i;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tstep = steps[i];\n\n\t\t\tif(step.type === \"element\") {\n\t\t\t\t//better to get a container using id as some times step.index may not be correct\n\t\t\t\t//For ex.https://github.com/futurepress/epub.js/issues/561\n\t\t\t\tif(step.id) {\n\t\t\t\t\tcontainer = doc.getElementById(step.id);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tchildren = container.children || findChildren(container);\n\t\t\t\t\tcontainer = children[step.index];\n\t\t\t\t}\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\tcontainer = this.textNodes(container, ignoreClass)[step.index];\n\t\t\t}\n\t\t\tif(!container) {\n\t\t\t\t//Break the for loop as due to incorrect index we can get error if\n\t\t\t\t//container is undefined so that other functionailties works fine\n\t\t\t\t//like navigation\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tfindNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container;\n\t\tvar xpath;\n\n\t\tif(!ignoreClass && typeof doc.evaluate != \"undefined\") {\n\t\t\txpath = this.stepsToXpath(steps);\n\t\t\tcontainer = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n\t\t} else if(ignoreClass) {\n\t\t\tcontainer = this.walkToNode(steps, doc, ignoreClass);\n\t\t} else {\n\t\t\tcontainer = this.walkToNode(steps, doc);\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tfixMiss(steps, offset, _doc, ignoreClass) {\n\t\tvar container = this.findNode(steps.slice(0,-1), _doc, ignoreClass);\n\t\tvar children = container.childNodes;\n\t\tvar map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\tvar child;\n\t\tvar len;\n\t\tvar lastStepIndex = steps[steps.length-1].index;\n\n\t\tfor (let childIndex in map) {\n\t\t\tif (!map.hasOwnProperty(childIndex)) return;\n\n\t\t\tif(map[childIndex] === lastStepIndex) {\n\t\t\t\tchild = children[childIndex];\n\t\t\t\tlen = child.textContent.length;\n\t\t\t\tif(offset > len) {\n\t\t\t\t\toffset = offset - len;\n\t\t\t\t} else {\n\t\t\t\t\tif (child.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tcontainer = child.childNodes[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainer = child;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tcontainer: container,\n\t\t\toffset: offset\n\t\t};\n\n\t}\n\n\t/**\n\t * Creates a DOM range representing a CFI\n\t * @param {document} _doc document referenced in the base\n\t * @param {string} [ignoreClass]\n\t * @return {Range}\n\t */\n\ttoRange(_doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar range;\n\t\tvar start, end, startContainer, endContainer;\n\t\tvar cfi = this;\n\t\tvar startSteps, endSteps;\n\t\tvar needsIgnoring = ignoreClass ? (doc.querySelector(\".\" + ignoreClass) != null) : false;\n\t\tvar missed;\n\n\t\tif (typeof(doc.createRange) !== \"undefined\") {\n\t\t\trange = doc.createRange();\n\t\t} else {\n\t\t\trange = new RangeObject();\n\t\t}\n\n\t\tif (cfi.range) {\n\t\t\tstart = cfi.start;\n\t\t\tstartSteps = cfi.path.steps.concat(start.steps);\n\t\t\tstartContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t\tend = cfi.end;\n\t\t\tendSteps = cfi.path.steps.concat(end.steps);\n\t\t\tendContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t} else {\n\t\t\tstart = cfi.path;\n\t\t\tstartSteps = cfi.path.steps;\n\t\t\tstartContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\n\t\t}\n\n\t\tif(startContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(start.terminal.offset != null) {\n\t\t\t\t\trange.setStart(startContainer, start.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setStart(startContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setStart(missed.container, missed.offset);\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(\"No startContainer found for\", this.toString());\n\t\t\t// No start found\n\t\t\treturn null;\n\t\t}\n\n\t\tif (endContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(end.terminal.offset != null) {\n\t\t\t\t\trange.setEnd(endContainer, end.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setEnd(endContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setEnd(missed.container, missed.offset);\n\t\t\t}\n\t\t}\n\n\n\t\t// doc.defaultView.getSelection().addRange(range);\n\t\treturn range;\n\t}\n\n\t/**\n\t * Check if a string is wrapped with \"epubcfi()\"\n\t * @param {string} str\n\t * @returns {boolean}\n\t */\n\tisCfiString(str) {\n\t\tif(typeof str === \"string\" &&\n\t\t\tstr.indexOf(\"epubcfi(\") === 0 &&\n\t\t\tstr[str.length-1] === \")\") {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgenerateChapterComponent(_spineNodeIndex, _pos, id) {\n\t\tvar pos = parseInt(_pos),\n\t\t\t\tspineNodeIndex = (_spineNodeIndex + 1) * 2,\n\t\t\t\tcfi = \"/\"+spineNodeIndex+\"/\";\n\n\t\tcfi += (pos + 1) * 2;\n\n\t\tif(id) {\n\t\t\tcfi += \"[\" + id + \"]\";\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Collapse a CFI Range to a single CFI Position\n\t * @param {boolean} [toStart=false]\n\t */\n\tcollapse(toStart) {\n\t\tif (!this.range) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.range = false;\n\n\t\tif (toStart) {\n\t\t\tthis.path.steps = this.path.steps.concat(this.start.steps);\n\t\t\tthis.path.terminal = this.start.terminal;\n\t\t} else {\n\t\t\tthis.path.steps = this.path.steps.concat(this.end.steps);\n\t\t\tthis.path.terminal = this.end.terminal;\n\t\t}\n\n\t}\n}\n\nexport default EpubCFI;\n","/**\n * Hooks allow for injecting functions that must all complete in order before finishing\n * They will execute in parallel but all must finish before continuing\n * Functions may return a promise if they are asycn.\n * @param {any} context scope of this\n * @example this.content = new EPUBJS.Hook(this);\n */\nclass Hook {\n\tconstructor(context){\n\t\tthis.context = context || this;\n\t\tthis.hooks = [];\n\t}\n\n\t/**\n\t * Adds a function to be run before a hook completes\n\t * @example this.content.register(function(){...});\n\t */\n\tregister(){\n\t\tfor(var i = 0; i < arguments.length; ++i) {\n\t\t\tif (typeof arguments[i]  === \"function\") {\n\t\t\t\tthis.hooks.push(arguments[i]);\n\t\t\t} else {\n\t\t\t\t// unpack array\n\t\t\t\tfor(var j = 0; j < arguments[i].length; ++j) {\n\t\t\t\t\tthis.hooks.push(arguments[i][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Removes a function\n\t * @example this.content.deregister(function(){...});\n\t */\n\tderegister(func){\n\t\tlet hook;\n\t\tfor (let i = 0; i < this.hooks.length; i++) {\n\t\t\thook = this.hooks[i];\n\t\t\tif (hook === func) {\n\t\t\t\tthis.hooks.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Triggers a hook to run all functions\n\t * @example this.content.trigger(args).then(function(){...});\n\t */\n\ttrigger(){\n\t\tvar args = arguments;\n\t\tvar context = this.context;\n\t\tvar promises = [];\n\n\t\tthis.hooks.forEach(function(task) {\n\t\t\tvar executing = task.apply(context, args);\n\n\t\t\tif(executing && typeof executing[\"then\"] === \"function\") {\n\t\t\t\t// Task is a function that returns a promise\n\t\t\t\tpromises.push(executing);\n\t\t\t}\n\t\t\t// Otherwise Task resolves immediately, continue\n\t\t});\n\n\n\t\treturn Promise.all(promises);\n\t}\n\n\t// Adds a function to be run before a hook completes\n\tlist(){\n\t\treturn this.hooks;\n\t}\n\n\tclear(){\n\t\treturn this.hooks = [];\n\t}\n}\nexport default Hook;\n","import { qs, qsa } from \"./core\";\nimport Url from \"./url\";\nimport Path from \"./path\";\n\nexport function replaceBase(doc, section){\n\tvar base;\n\tvar head;\n\tvar url = section.url;\n\tvar absolute = (url.indexOf(\"://\") > -1);\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tbase = qs(head, \"base\");\n\n\tif(!base) {\n\t\tbase = doc.createElement(\"base\");\n\t\thead.insertBefore(base, head.firstChild);\n\t}\n\n\t// Fix for Safari crashing if the url doesn't have an origin\n\tif (!absolute && window && window.location) {\n\t\turl = window.location.origin + url;\n\t}\n\n\tbase.setAttribute(\"href\", url);\n}\n\nexport function replaceCanonical(doc, section){\n\tvar head;\n\tvar link;\n\tvar url = section.canonical;\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tlink = qs(head, \"link[rel='canonical']\");\n\n\tif (link) {\n\t\tlink.setAttribute(\"href\", url);\n\t} else {\n\t\tlink = doc.createElement(\"link\");\n\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\tlink.setAttribute(\"href\", url);\n\t\thead.appendChild(link);\n\t}\n}\n\nexport function replaceMeta(doc, section){\n\tvar head;\n\tvar meta;\n\tvar id = section.idref;\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tmeta = qs(head, \"link[property='dc.identifier']\");\n\n\tif (meta) {\n\t\tmeta.setAttribute(\"content\", id);\n\t} else {\n\t\tmeta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.identifier\");\n\t\tmeta.setAttribute(\"content\", id);\n\t\thead.appendChild(meta);\n\t}\n}\n\n// TODO: move me to Contents\nexport function replaceLinks(contents, fn) {\n\n\tvar links = contents.querySelectorAll(\"a[href]\");\n\n\tif (!links.length) {\n\t\treturn;\n\t}\n\n\tvar base = qs(contents.ownerDocument, \"base\");\n\tvar location = base ? base.getAttribute(\"href\") : undefined;\n\tvar replaceLink = function(link){\n\t\tvar href = link.getAttribute(\"href\");\n\n\t\tif(href.indexOf(\"mailto:\") === 0){\n\t\t\treturn;\n\t\t}\n\n\t\tvar absolute = (href.indexOf(\"://\") > -1);\n\t\tvar linkUrl = new Url(href, location);\n\n\t\tif(absolute){\n\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\n\n\t\t}else{\n\t\t\tlink.onclick = function(){\n\n\t\t\t\tif(linkUrl && linkUrl.hash) {\n\t\t\t\t\tfn(linkUrl.Path.path + linkUrl.hash);\n\t\t\t\t} else if(linkUrl){\n\t\t\t\t\tfn(linkUrl.Path.path);\n\t\t\t\t} else {\n\t\t\t\t\tfn(href);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t}.bind(this);\n\n\tfor (var i = 0; i < links.length; i++) {\n\t\treplaceLink(links[i]);\n\t}\n\n\n}\n\nexport function substitute(content, urls, replacements) {\n\turls.forEach(function(url, i){\n\t\tif (url && replacements[i]) {\n\t\t\tcontent = content.replace(new RegExp(url, \"g\"), replacements[i]);\n\t\t}\n\t});\n\treturn content;\n}\n","import { defer } from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Hook from \"./utils/hook\";\nimport { sprint } from \"./utils/core\";\nimport { replaceBase } from \"./utils/replacements\";\n\n/**\n * Represents a Section of the Book\n *\n * In most books this is equivelent to a Chapter\n * @param {object} item  The spine item representing the section\n * @param {object} hooks hooks for serialize and content\n */\nclass Section {\n\tconstructor(item, hooks){\n\t\tthis.idref = item.idref;\n\t\tthis.linear = item.linear === \"yes\";\n\t\tthis.properties = item.properties;\n\t\tthis.index = item.index;\n\t\tthis.href = item.href;\n\t\tthis.url = item.url;\n\t\tthis.canonical = item.canonical;\n\t\tthis.next = item.next;\n\t\tthis.prev = item.prev;\n\n\t\tthis.cfiBase = item.cfiBase;\n\n\t\tif (hooks) {\n\t\t\tthis.hooks = hooks;\n\t\t} else {\n\t\t\tthis.hooks = {};\n\t\t\tthis.hooks.serialize = new Hook(this);\n\t\t\tthis.hooks.content = new Hook(this);\n\t\t}\n\n\t\tthis.document = undefined;\n\t\tthis.contents = undefined;\n\t\tthis.output = undefined;\n\t}\n\n\t/**\n\t * Load the section from its url\n\t * @param  {method} [_request] a request method to use for loading\n\t * @return {document} a promise with the xml document\n\t */\n\tload(_request){\n\t\tvar request = _request || this.request || require(\"./utils/request\");\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(this.contents) {\n\t\t\tloading.resolve(this.contents);\n\t\t} else {\n\t\t\trequest(this.url)\n\t\t\t\t.then(function(xml){\n\t\t\t\t\t// var directory = new Url(this.url).directory;\n\n\t\t\t\t\tthis.document = xml;\n\t\t\t\t\tthis.contents = xml.documentElement;\n\n\t\t\t\t\treturn this.hooks.content.trigger(this.document, this);\n\t\t\t\t}.bind(this))\n\t\t\t\t.then(function(){\n\t\t\t\t\tloading.resolve(this.contents);\n\t\t\t\t}.bind(this))\n\t\t\t\t.catch(function(error){\n\t\t\t\t\tloading.reject(error);\n\t\t\t\t});\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\t/**\n\t * Adds a base tag for resolving urls in the section\n\t * @private\n\t */\n\tbase(){\n\t\treturn replaceBase(this.document, this);\n\t}\n\n\t/**\n\t * Render the contents of a section\n\t * @param  {method} [_request] a request method to use for loading\n\t * @return {string} output a serialized XML Document\n\t */\n\trender(_request){\n\t\tvar rendering = new defer();\n\t\tvar rendered = rendering.promise;\n\t\tthis.output; // TODO: better way to return this from hooks?\n\n\t\tthis.load(_request).\n\t\t\tthen(function(contents){\n\t\t\t\tvar userAgent = (typeof navigator !== 'undefined' && navigator.userAgent) || '';\n\t\t\t\tvar isIE = userAgent.indexOf('Trident') >= 0;\n\t\t\t\tvar Serializer;\n\t\t\t\tif (typeof XMLSerializer === \"undefined\" || isIE) {\n\t\t\t\t\tSerializer = require(\"xmldom/dom-parser\").XMLSerializer;\n\t\t\t\t} else {\n\t\t\t\t\tSerializer = XMLSerializer;\n\t\t\t\t}\n\t\t\t\tvar serializer = new Serializer();\n\t\t\t\tthis.output = serializer.serializeToString(contents);\n\t\t\t\treturn this.output;\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\treturn this.hooks.serialize.trigger(this.output, this);\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\trendering.resolve(this.output);\n\t\t\t}.bind(this))\n\t\t\t.catch(function(error){\n\t\t\t\trendering.reject(error);\n\t\t\t});\n\n\t\treturn rendered;\n\t}\n\n\t/**\n\t * Find a string in a section\n\t * @param  {string} _query The query string to find\n\t * @return {object[]} A list of matches, with form {cfi, excerpt}\n\t */\n\tfind(_query){\n\t\tvar section = this;\n\t\tvar matches = [];\n\t\tvar query = _query.toLowerCase();\n\t\tvar find = function(node){\n\t\t\tvar text = node.textContent.toLowerCase();\n\t\t\tvar range = section.document.createRange();\n\t\t\tvar cfi;\n\t\t\tvar pos;\n\t\t\tvar last = -1;\n\t\t\tvar excerpt;\n\t\t\tvar limit = 150;\n\n\t\t\twhile (pos != -1) {\n\t\t\t\t// Search for the query\n\t\t\t\tpos = text.indexOf(query, last + 1);\n\n\t\t\t\tif (pos != -1) {\n\t\t\t\t\t// We found it! Generate a CFI\n\t\t\t\t\trange = section.document.createRange();\n\t\t\t\t\trange.setStart(node, pos);\n\t\t\t\t\trange.setEnd(node, pos + query.length);\n\n\t\t\t\t\tcfi = section.cfiFromRange(range);\n\n\t\t\t\t\t// Generate the excerpt\n\t\t\t\t\tif (node.textContent.length < limit) {\n\t\t\t\t\t\texcerpt = node.textContent;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\texcerpt = node.textContent.substring(pos - limit/2, pos + limit/2);\n\t\t\t\t\t\texcerpt = \"...\" + excerpt + \"...\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add the CFI to the matches list\n\t\t\t\t\tmatches.push({\n\t\t\t\t\t\tcfi: cfi,\n\t\t\t\t\t\texcerpt: excerpt\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlast = pos;\n\t\t\t}\n\t\t};\n\n\t\tsprint(section.document, function(node) {\n\t\t\tfind(node);\n\t\t});\n\n\t\treturn matches;\n\t};\n\n\t/**\n\t* Reconciles the current chapters layout properies with\n\t* the global layout properities.\n\t* @param {object} globalLayout  The global layout settings object, chapter properties string\n\t* @return {object} layoutProperties Object with layout properties\n\t*/\n\treconcileLayoutSettings(globalLayout){\n\t\t//-- Get the global defaults\n\t\tvar settings = {\n\t\t\tlayout : globalLayout.layout,\n\t\t\tspread : globalLayout.spread,\n\t\t\torientation : globalLayout.orientation\n\t\t};\n\n\t\t//-- Get the chapter's display type\n\t\tthis.properties.forEach(function(prop){\n\t\t\tvar rendition = prop.replace(\"rendition:\", \"\");\n\t\t\tvar split = rendition.indexOf(\"-\");\n\t\t\tvar property, value;\n\n\t\t\tif(split != -1){\n\t\t\t\tproperty = rendition.slice(0, split);\n\t\t\t\tvalue = rendition.slice(split+1);\n\n\t\t\t\tsettings[property] = value;\n\t\t\t}\n\t\t});\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Get a CFI from a Range in the Section\n\t * @param  {range} _range\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromRange(_range) {\n\t\treturn new EpubCFI(_range, this.cfiBase).toString();\n\t}\n\n\t/**\n\t * Get a CFI from an Element in the Section\n\t * @param  {element} el\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromElement(el) {\n\t\treturn new EpubCFI(el, this.cfiBase).toString();\n\t}\n\n\t/**\n\t * Unload the section document\n\t */\n\tunload() {\n\t\tthis.document = undefined;\n\t\tthis.contents = undefined;\n\t\tthis.output = undefined;\n\t}\n\n\tdestroy() {\n\t\tthis.unload();\n\t\tthis.hooks.serialize.clear();\n\t\tthis.hooks.content.clear();\n\n\t\tthis.hooks = undefined;\n\t\tthis.idref = undefined;\n\t\tthis.linear = undefined;\n\t\tthis.properties = undefined;\n\t\tthis.index = undefined;\n\t\tthis.href = undefined;\n\t\tthis.url = undefined;\n\t\tthis.next = undefined;\n\t\tthis.prev = undefined;\n\n\t\tthis.cfiBase = undefined;\n\t}\n}\n\nexport default Section;\n","import EpubCFI from \"./epubcfi\";\nimport Hook from \"./utils/hook\";\nimport Section from \"./section\";\nimport {replaceBase, replaceCanonical, replaceMeta} from \"./utils/replacements\";\n\n/**\n * A collection of Spine Items\n */\nclass Spine {\n\tconstructor() {\n\t\tthis.spineItems = [];\n\t\tthis.spineByHref = {};\n\t\tthis.spineById = {};\n\n\t\tthis.hooks = {};\n\t\tthis.hooks.serialize = new Hook();\n\t\tthis.hooks.content = new Hook();\n\n\t\t// Register replacements\n\t\tthis.hooks.content.register(replaceBase);\n\t\tthis.hooks.content.register(replaceCanonical);\n\t\tthis.hooks.content.register(replaceMeta);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.loaded = false;\n\n\t\tthis.items = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.baseUrl = undefined;\n\t\tthis.length = undefined;\n\t}\n\n\t/**\n\t * Unpack items from a opf into spine items\n\t * @param  {Packaging} _package\n\t * @param  {method} resolver URL resolver\n\t * @param  {method} canonical Resolve canonical url\n\t */\n\tunpack(_package, resolver, canonical) {\n\n\t\tthis.items = _package.spine;\n\t\tthis.manifest = _package.manifest;\n\t\tthis.spineNodeIndex = _package.spineNodeIndex;\n\t\tthis.baseUrl = _package.baseUrl || _package.basePath || \"\";\n\t\tthis.length = this.items.length;\n\n\t\tthis.items.forEach( (item, index) => {\n\t\t\tvar manifestItem = this.manifest[item.idref];\n\t\t\tvar spineItem;\n\n\t\t\titem.index = index;\n\t\t\titem.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\n\n\t\t\tif (item.href) {\n\t\t\t\titem.url = resolver(item.href, true);\n\t\t\t\titem.canonical = canonical(item.href);\n\t\t\t}\n\n\t\t\tif(manifestItem) {\n\t\t\t\titem.href = manifestItem.href;\n\t\t\t\titem.url = resolver(item.href, true);\n\t\t\t\titem.canonical = canonical(item.href);\n\n\t\t\t\tif(manifestItem.properties.length){\n\t\t\t\t\titem.properties.push.apply(item.properties, manifestItem.properties);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.linear === \"yes\") {\n\t\t\t\titem.prev = function() {\n\t\t\t\t\tlet prevIndex = item.index;\n\t\t\t\t\twhile (prevIndex > 0) {\n\t\t\t\t\t\tlet prev = this.get(prevIndex-1);\n\t\t\t\t\t\tif (prev && prev.linear) {\n\t\t\t\t\t\t\treturn prev;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprevIndex -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}.bind(this);\n\t\t\t\titem.next = function() {\n\t\t\t\t\tlet nextIndex = item.index;\n\t\t\t\t\twhile (nextIndex < this.spineItems.length-1) {\n\t\t\t\t\t\tlet next = this.get(nextIndex+1);\n\t\t\t\t\t\tif (next && next.linear) {\n\t\t\t\t\t\t\treturn next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}.bind(this);\n\t\t\t} else {\n\t\t\t\titem.prev = function() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\titem.next = function() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tspineItem = new Section(item, this.hooks);\n\n\t\t\tthis.append(spineItem);\n\n\n\t\t});\n\n\t\tthis.loaded = true;\n\t}\n\n\t/**\n\t * Get an item from the spine\n\t * @param  {string|number} [target]\n\t * @return {Section} section\n\t * @example spine.get();\n\t * @example spine.get(1);\n\t * @example spine.get(\"chap1.html\");\n\t * @example spine.get(\"#id1234\");\n\t */\n\tget(target) {\n\t\tvar index = 0;\n\n\t\tif (typeof target === \"undefined\") {\n\t\t\twhile (index < this.spineItems.length) {\n\t\t\t\tlet next = this.spineItems[index];\n\t\t\t\tif (next && next.linear) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tindex += 1;\n\t\t\t}\n\t\t} else if(this.epubcfi.isCfiString(target)) {\n\t\t\tlet cfi = new EpubCFI(target);\n\t\t\tindex = cfi.spinePos;\n\t\t} else if(typeof target === \"number\" || isNaN(target) === false){\n\t\t\tindex = target;\n\t\t} else if(typeof target === \"string\" && target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.spineById[target.substring(1)];\n\t\t} else if(typeof target === \"string\") {\n\t\t\t// Remove fragments\n\t\t\ttarget = target.split(\"#\")[0];\n\t\t\tindex = this.spineByHref[target] || this.spineByHref[encodeURI(target)];\n\t\t}\n\n\t\treturn this.spineItems[index] || null;\n\t}\n\n\t/**\n\t * Append a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tappend(section) {\n\t\tvar index = this.spineItems.length;\n\t\tsection.index = index;\n\n\t\tthis.spineItems.push(section);\n\n\t\t// Encode and Decode href lookups\n\t\t// see pr for details: https://github.com/futurepress/epub.js/pull/358\n\t\tthis.spineByHref[decodeURI(section.href)] = index;\n\t\tthis.spineByHref[encodeURI(section.href)] = index;\n\t\tthis.spineByHref[section.href] = index;\n\n\t\tthis.spineById[section.idref] = index;\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Prepend a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tprepend(section) {\n\t\t// var index = this.spineItems.unshift(section);\n\t\tthis.spineByHref[section.href] = 0;\n\t\tthis.spineById[section.idref] = 0;\n\n\t\t// Re-index\n\t\tthis.spineItems.forEach(function(item, index){\n\t\t\titem.index = index;\n\t\t});\n\n\t\treturn 0;\n\t}\n\n\t// insert(section, index) {\n\t//\n\t// };\n\n\t/**\n\t * Remove a Section from the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tremove(section) {\n\t\tvar index = this.spineItems.indexOf(section);\n\n\t\tif(index > -1) {\n\t\t\tdelete this.spineByHref[section.href];\n\t\t\tdelete this.spineById[section.idref];\n\n\t\t\treturn this.spineItems.splice(index, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Loop over the Sections in the Spine\n\t * @return {method} forEach\n\t */\n\teach() {\n\t\treturn this.spineItems.forEach.apply(this.spineItems, arguments);\n\t}\n\n\t/**\n\t * Find the first Section in the Spine\n\t * @return {Section} first section\n\t */\n\tfirst() {\n\t\tlet index = 0;\n\n\t\tdo {\n\t\t\tlet next = this.get(index);\n\n\t\t\tif (next && next.linear) {\n\t\t\t\treturn next;\n\t\t\t}\n\t\t\tindex += 1;\n\t\t} while (index < this.spineItems.length) ;\n\t}\n\n\t/**\n\t * Find the last Section in the Spine\n\t * @return {Section} last section\n\t */\n\tlast() {\n\t\tlet index = this.spineItems.length-1;\n\n\t\tdo {\n\t\t\tlet prev = this.get(index);\n\t\t\tif (prev && prev.linear) {\n\t\t\t\treturn prev;\n\t\t\t}\n\t\t\tindex -= 1;\n\t\t} while (index >= 0);\n\t}\n\n\tdestroy() {\n\t\tthis.each((section) => section.destroy());\n\n\t\tthis.spineItems = undefined\n\t\tthis.spineByHref = undefined\n\t\tthis.spineById = undefined\n\n\t\tthis.hooks.serialize.clear();\n\t\tthis.hooks.content.clear();\n\t\tthis.hooks = undefined;\n\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.loaded = false;\n\n\t\tthis.items = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.baseUrl = undefined;\n\t\tthis.length = undefined;\n\t}\n}\n\nexport default Spine;\n","import {defer, requestAnimationFrame} from \"./core\";\n\n/**\n * Queue for handling tasks one at a time\n * @class\n * @param {scope} context what this will resolve to in the tasks\n */\nclass Queue {\n\tconstructor(context){\n\t\tthis._q = [];\n\t\tthis.context = context;\n\t\tthis.tick = requestAnimationFrame;\n\t\tthis.running = false;\n\t\tthis.paused = false;\n\t}\n\n\t/**\n\t * Add an item to the queue\n\t * @return {Promise}\n\t */\n\tenqueue() {\n\t\tvar deferred, promise;\n\t\tvar queued;\n\t\tvar task = [].shift.call(arguments);\n\t\tvar args = arguments;\n\n\t\t// Handle single args without context\n\t\t// if(args && !Array.isArray(args)) {\n\t\t//   args = [args];\n\t\t// }\n\t\tif(!task) {\n\t\t\tthrow new Error(\"No Task Provided\");\n\t\t}\n\n\t\tif(typeof task === \"function\"){\n\n\t\t\tdeferred = new defer();\n\t\t\tpromise = deferred.promise;\n\n\t\t\tqueued = {\n\t\t\t\t\"task\" : task,\n\t\t\t\t\"args\"     : args,\n\t\t\t\t//\"context\"  : context,\n\t\t\t\t\"deferred\" : deferred,\n\t\t\t\t\"promise\" : promise\n\t\t\t};\n\n\t\t} else {\n\t\t\t// Task is a promise\n\t\t\tqueued = {\n\t\t\t\t\"promise\" : task\n\t\t\t};\n\n\t\t}\n\n\t\tthis._q.push(queued);\n\n\t\t// Wait to start queue flush\n\t\tif (this.paused == false && !this.running) {\n\t\t\t// setTimeout(this.flush.bind(this), 0);\n\t\t\t// this.tick.call(window, this.run.bind(this));\n\t\t\tthis.run();\n\t\t}\n\n\t\treturn queued.promise;\n\t}\n\n\t/**\n\t * Run one item\n\t * @return {Promise}\n\t */\n\tdequeue(){\n\t\tvar inwait, task, result;\n\n\t\tif(this._q.length && !this.paused) {\n\t\t\tinwait = this._q.shift();\n\t\t\ttask = inwait.task;\n\t\t\tif(task){\n\t\t\t\t// console.log(task)\n\n\t\t\t\tresult = task.apply(this.context, inwait.args);\n\n\t\t\t\tif(result && typeof result[\"then\"] === \"function\") {\n\t\t\t\t\t// Task is a function that returns a promise\n\t\t\t\t\treturn result.then(function(){\n\t\t\t\t\t\tinwait.deferred.resolve.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this), function() {\n\t\t\t\t\t\tinwait.deferred.reject.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else {\n\t\t\t\t\t// Task resolves immediately\n\t\t\t\t\tinwait.deferred.resolve.apply(this.context, result);\n\t\t\t\t\treturn inwait.promise;\n\t\t\t\t}\n\n\n\n\t\t\t} else if(inwait.promise) {\n\t\t\t\t// Task is a promise\n\t\t\t\treturn inwait.promise;\n\t\t\t}\n\n\t\t} else {\n\t\t\tinwait = new defer();\n\t\t\tinwait.deferred.resolve();\n\t\t\treturn inwait.promise;\n\t\t}\n\n\t}\n\n\t// Run All Immediately\n\tdump(){\n\t\twhile(this._q.length) {\n\t\t\tthis.dequeue();\n\t\t}\n\t}\n\n\t/**\n\t * Run all tasks sequentially, at convince\n\t * @return {Promise}\n\t */\n\trun(){\n\n\t\tif(!this.running){\n\t\t\tthis.running = true;\n\t\t\tthis.defered = new defer();\n\t\t}\n\n\t\tthis.tick.call(window, () => {\n\n\t\t\tif(this._q.length) {\n\n\t\t\t\tthis.dequeue()\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tthis.run();\n\t\t\t\t\t}.bind(this));\n\n\t\t\t} else {\n\t\t\t\tthis.defered.resolve();\n\t\t\t\tthis.running = undefined;\n\t\t\t}\n\n\t\t});\n\n\t\t// Unpause\n\t\tif(this.paused == true) {\n\t\t\tthis.paused = false;\n\t\t}\n\n\t\treturn this.defered.promise;\n\t}\n\n\t/**\n\t * Flush all, as quickly as possible\n\t * @return {Promise}\n\t */\n\tflush(){\n\n\t\tif(this.running){\n\t\t\treturn this.running;\n\t\t}\n\n\t\tif(this._q.length) {\n\t\t\tthis.running = this.dequeue()\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.running = undefined;\n\t\t\t\t\treturn this.flush();\n\t\t\t\t}.bind(this));\n\n\t\t\treturn this.running;\n\t\t}\n\n\t}\n\n\t/**\n\t * Clear all items in wait\n\t */\n\tclear(){\n\t\tthis._q = [];\n\t}\n\n\t/**\n\t * Get the number of tasks in the queue\n\t * @return {number} tasks\n\t */\n\tlength(){\n\t\treturn this._q.length;\n\t}\n\n\t/**\n\t * Pause a running queue\n\t */\n\tpause(){\n\t\tthis.paused = true;\n\t}\n\n\t/**\n\t * End the queue\n\t */\n\tstop(){\n\t\tthis._q = [];\n\t\tthis.running = false;\n\t\tthis.paused = true;\n\t}\n}\n\n\n/**\n * Create a new task from a callback\n * @class\n * @private\n * @param {function} task\n * @param {array} args\n * @param {scope} context\n * @return {function} task\n */\nclass Task {\n\tconstructor(task, args, context){\n\n\t\treturn function(){\n\t\t\tvar toApply = arguments || [];\n\n\t\t\treturn new Promise( (resolve, reject) => {\n\t\t\t\tvar callback = function(value, err){\n\t\t\t\t\tif (!value && err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t// Add the callback to the arguments list\n\t\t\t\ttoApply.push(callback);\n\n\t\t\t\t// Apply all arguments to the functions\n\t\t\t\ttask.apply(context || this, toApply);\n\n\t\t\t});\n\n\t\t};\n\n\t}\n}\n\n\nexport default Queue;\nexport { Task };\n","export const EPUBJS_VERSION = \"0.3\";\n\n// Dom events to listen for\nexport const DOM_EVENTS = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\", \"touchmove\"];\n\nexport const EVENTS = {\n  BOOK : {\n    OPEN_FAILED : \"openFailed\"\n  },\n  CONTENTS : {\n    EXPAND : \"expand\",\n    RESIZE : \"resize\",\n    SELECTED : \"selected\",\n    SELECTED_RANGE : \"selectedRange\",\n    LINK_CLICKED : \"linkClicked\"\n  },\n  LOCATIONS : {\n    CHANGED : \"changed\"\n  },\n  MANAGERS : {\n    RESIZE : \"resize\",\n    RESIZED : \"resized\",\n    ORIENTATION_CHANGE : \"orientationchange\",\n    ADDED : \"added\",\n    SCROLL : \"scroll\",\n    SCROLLED : \"scrolled\",\n    REMOVED : \"removed\",\n  },\n  VIEWS : {\n    AXIS : \"axis\",\n    LOAD_ERROR : \"loaderror\",\n    RENDERED : \"rendered\",\n    RESIZED : \"resized\",\n    DISPLAYED : \"displayed\",\n    SHOWN : \"shown\",\n    HIDDEN : \"hidden\",\n    MARK_CLICKED : \"markClicked\"\n  },\n  RENDITION : {\n    STARTED : \"started\",\n    ATTACHED : \"attached\",\n    DISPLAYED : \"displayed\",\n    DISPLAY_ERROR : \"displayerror\",\n    RENDERED : \"rendered\",\n    REMOVED : \"removed\",\n    RESIZED : \"resized\",\n    ORIENTATION_CHANGE : \"orientationchange\",\n    LOCATION_CHANGED : \"locationChanged\",\n    RELOCATED : \"relocated\",\n    MARK_CLICKED : \"markClicked\",\n    SELECTED : \"selected\",\n    LAYOUT: \"layout\"\n  },\n  LAYOUT : {\n    UPDATED : \"updated\"\n  }\n}\n","import {qs, sprint, locationOf, defer} from \"./utils/core\";\nimport Queue from \"./utils/queue\";\nimport EpubCFI from \"./epubcfi\";\nimport { EVENTS } from \"./utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Find Locations for a Book\n * @param {Spine} spine\n * @param {request} request\n * @param {number} [pause=100]\n */\nclass Locations {\n\tconstructor(spine, request, pause) {\n\t\tthis.spine = spine;\n\t\tthis.request = request;\n\t\tthis.pause = pause || 100;\n\n\t\tthis.q = new Queue(this);\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis._locations = [];\n\t\tthis.total = 0;\n\n\t\tthis.break = 150;\n\n\t\tthis._current = 0;\n\n\t\tthis.currentLocation = '';\n\t\tthis._currentCfi ='';\n\t\tthis.processingTimeout = undefined;\n\t}\n\n\t/**\n\t * Load all of sections in the book to generate locations\n\t * @param  {int} chars how many chars to split on\n\t * @return {object} locations\n\t */\n\tgenerate(chars) {\n\n\t\tif (chars) {\n\t\t\tthis.break = chars;\n\t\t}\n\n\t\tthis.q.pause();\n\n\t\tthis.spine.each(function(section) {\n\t\t\tif (section.linear) {\n\t\t\t\tthis.q.enqueue(this.process.bind(this), section);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn this.q.run().then(function() {\n\t\t\tthis.total = this._locations.length - 1;\n\n\t\t\tif (this._currentCfi) {\n\t\t\t\tthis.currentLocation = this._currentCfi;\n\t\t\t}\n\n\t\t\treturn this._locations;\n\t\t\t// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\n\t\t}.bind(this));\n\n\t}\n\n\tcreateRange () {\n\t\treturn {\n\t\t\tstartContainer: undefined,\n\t\t\tstartOffset: undefined,\n\t\t\tendContainer: undefined,\n\t\t\tendOffset: undefined\n\t\t};\n\t}\n\n\tprocess(section) {\n\n\t\treturn section.load(this.request)\n\t\t\t.then(function(contents) {\n\t\t\t\tvar completed = new defer();\n\t\t\t\tvar locations = this.parse(contents, section.cfiBase);\n\t\t\t\tthis._locations = this._locations.concat(locations);\n\n\t\t\t\tsection.unload();\n\n\t\t\t\tthis.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\n\t\t\t\treturn completed.promise;\n\t\t\t}.bind(this));\n\n\t}\n\n\tparse(contents, cfiBase, chars) {\n\t\tvar locations = [];\n\t\tvar range;\n\t\tvar doc = contents.ownerDocument;\n\t\tvar body = qs(doc, \"body\");\n\t\tvar counter = 0;\n\t\tvar prev;\n\t\tvar _break = chars || this.break;\n\t\tvar parser = function(node) {\n\t\t\tvar len = node.length;\n\t\t\tvar dist;\n\t\t\tvar pos = 0;\n\n\t\t\tif (node.textContent.trim().length === 0) {\n\t\t\t\treturn false; // continue\n\t\t\t}\n\n\t\t\t// Start range\n\t\t\tif (counter == 0) {\n\t\t\t\trange = this.createRange();\n\t\t\t\trange.startContainer = node;\n\t\t\t\trange.startOffset = 0;\n\t\t\t}\n\n\t\t\tdist = _break - counter;\n\n\t\t\t// Node is smaller than a break,\n\t\t\t// skip over it\n\t\t\tif(dist > len){\n\t\t\t\tcounter += len;\n\t\t\t\tpos = len;\n\t\t\t}\n\n\n\t\t\twhile (pos < len) {\n\t\t\t\tdist = _break - counter;\n\n\t\t\t\tif (counter === 0) {\n\t\t\t\t\t// Start new range\n\t\t\t\t\tpos += 1;\n\t\t\t\t\trange = this.createRange();\n\t\t\t\t\trange.startContainer = node;\n\t\t\t\t\trange.startOffset = pos;\n\t\t\t\t}\n\n\t\t\t\t// pos += dist;\n\n\t\t\t\t// Gone over\n\t\t\t\tif(pos + dist >= len){\n\t\t\t\t\t// Continue counter for next node\n\t\t\t\t\tcounter += len - pos;\n\t\t\t\t\t// break\n\t\t\t\t\tpos = len;\n\t\t\t\t// At End\n\t\t\t\t} else {\n\t\t\t\t\t// Advance pos\n\t\t\t\t\tpos += dist;\n\n\t\t\t\t\t// End the previous range\n\t\t\t\t\trange.endContainer = node;\n\t\t\t\t\trange.endOffset = pos;\n\t\t\t\t\t// cfi = section.cfiFromRange(range);\n\t\t\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\t\t\tlocations.push(cfi);\n\t\t\t\t\tcounter = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprev = node;\n\t\t};\n\n\t\tsprint(body, parser.bind(this));\n\n\t\t// Close remaining\n\t\tif (range && range.startContainer && prev) {\n\t\t\trange.endContainer = prev;\n\t\t\trange.endOffset = prev.length;\n\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\tlocations.push(cfi);\n\t\t\tcounter = 0;\n\t\t}\n\n\t\treturn locations;\n\t}\n\n\t/**\n\t * Get a location from an EpubCFI\n\t * @param {EpubCFI} cfi\n\t * @return {number}\n\t */\n\tlocationFromCfi(cfi){\n\t\tlet loc;\n\t\tif (EpubCFI.prototype.isCfiString(cfi)) {\n\t\t\tcfi = new EpubCFI(cfi);\n\t\t}\n\t\t// Check if the location has not been set yet\n\t\tif(this._locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tloc = locationOf(cfi, this._locations, this.epubcfi.compare);\n\n\t\tif (loc > this.total) {\n\t\t\treturn this.total;\n\t\t}\n\n\t\treturn loc;\n\t}\n\n\t/**\n\t * Get a percentage position in locations from an EpubCFI\n\t * @param {EpubCFI} cfi\n\t * @return {number}\n\t */\n\tpercentageFromCfi(cfi) {\n\t\tif(this._locations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\t\t// Find closest cfi\n\t\tvar loc = this.locationFromCfi(cfi);\n\t\t// Get percentage in total\n\t\treturn this.percentageFromLocation(loc);\n\t}\n\n\t/**\n\t * Get a percentage position from a location index\n\t * @param {number} location\n\t * @return {number}\n\t */\n\tpercentageFromLocation(loc) {\n\t\tif (!loc || !this.total) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn (loc / this.total);\n\t}\n\n\t/**\n\t * Get an EpubCFI from location index\n\t * @param {number} loc\n\t * @return {EpubCFI} cfi\n\t */\n\tcfiFromLocation(loc){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof loc != \"number\"){\n\t\t\tloc = parseInt(loc);\n\t\t}\n\n\t\tif(loc >= 0 && loc < this._locations.length) {\n\t\t\tcfi = this._locations[loc];\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Get an EpubCFI from location percentage\n\t * @param {number} percentage\n\t * @return {EpubCFI} cfi\n\t */\n\tcfiFromPercentage(percentage){\n\t\tlet loc;\n\t\tif (percentage > 1) {\n\t\t\tconsole.warn(\"Normalize cfiFromPercentage value to between 0 - 1\");\n\t\t}\n\n\t\t// Make sure 1 goes to very end\n\t\tif (percentage >= 1) {\n\t\t\tlet cfi = new EpubCFI(this._locations[this.total]);\n\t\t\tcfi.collapse();\n\t\t\treturn cfi.toString();\n\t\t}\n\n\t\tloc = Math.ceil(this.total * percentage);\n\t\treturn this.cfiFromLocation(loc);\n\t}\n\n\t/**\n\t * Load locations from JSON\n\t * @param {json} locations\n\t */\n\tload(locations){\n\t\tif (typeof locations === \"string\") {\n\t\t\tthis._locations = JSON.parse(locations);\n\t\t} else {\n\t\t\tthis._locations = locations;\n\t\t}\n\t\tthis.total = this._locations.length - 1;\n\t\treturn this._locations;\n\t}\n\n\t/**\n\t * Save locations to JSON\n\t * @return {json}\n\t */\n\tsave(){\n\t\treturn JSON.stringify(this._locations);\n\t}\n\n\tgetCurrent(){\n\t\treturn this._current;\n\t}\n\n\tsetCurrent(curr){\n\t\tvar loc;\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tthis._currentCfi = curr;\n\t\t} else if (typeof curr == \"number\") {\n\t\t\tthis._current = curr;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._locations.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tloc = this.locationFromCfi(curr);\n\t\t\tthis._current = loc;\n\t\t} else {\n\t\t\tloc = curr;\n\t\t}\n\n\t\tthis.emit(EVENTS.LOCATIONS.CHANGED, {\n\t\t\tpercentage: this.percentageFromLocation(loc)\n\t\t});\n\t}\n\n\t/**\n\t * Get the current location\n\t */\n\tget currentLocation() {\n\t\treturn this._current;\n\t}\n\n\t/**\n\t * Set the current location\n\t */\n\tset currentLocation(curr) {\n\t\tthis.setCurrent(curr);\n\t}\n\n\t/**\n\t * Locations length\n\t */\n\tlength () {\n\t\treturn this._locations.length;\n\t}\n\n\tdestroy () {\n\t\tthis.spine = undefined;\n\t\tthis.request = undefined;\n\t\tthis.pause = undefined;\n\n\t\tthis.q.stop();\n\t\tthis.q = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis._locations = undefined\n\t\tthis.total = undefined;\n\n\t\tthis.break = undefined;\n\t\tthis._current = undefined;\n\n\t\tthis.currentLocation = undefined;\n\t\tthis._currentCfi = undefined;\n\t\tclearTimeout(this.processingTimeout);\n\t}\n}\n\nEventEmitter(Locations.prototype);\n\nexport default Locations;\n","import path from \"path-webpack\";\nimport {qs} from \"./utils/core\";\n\n/**\n * Handles Parsing and Accessing an Epub Container\n * @class\n * @param {document} [containerDocument] xml document\n */\nclass Container {\n\tconstructor(containerDocument) {\n\t\tthis.packagePath = '';\n\t\tthis.directory = '';\n\t\tthis.encoding = '';\n\n\t\tif (containerDocument) {\n\t\t\tthis.parse(containerDocument);\n\t\t}\n\t}\n\n\t/**\n\t * Parse the Container XML\n\t * @param  {document} containerDocument\n\t */\n\tparse(containerDocument){\n\t\t//-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\n\t\tvar rootfile;\n\n\t\tif(!containerDocument) {\n\t\t\tthrow new Error(\"Container File Not Found\");\n\t\t}\n\n\t\trootfile = qs(containerDocument, \"rootfile\");\n\n\t\tif(!rootfile) {\n\t\t\tthrow new Error(\"No RootFile Found\");\n\t\t}\n\n\t\tthis.packagePath = rootfile.getAttribute(\"full-path\");\n\t\tthis.directory = path.dirname(this.packagePath);\n\t\tthis.encoding = containerDocument.xmlEncoding;\n\t}\n\n\tdestroy() {\n\t\tthis.packagePath = undefined;\n\t\tthis.directory = undefined;\n\t\tthis.encoding = undefined;\n\t}\n}\n\nexport default Container;\n","import {qs, qsa, qsp, indexOfElementNode} from \"./utils/core\";\n\n/**\n * Open Packaging Format Parser\n * @class\n * @param {document} packageDocument OPF XML\n */\nclass Packaging {\n\tconstructor(packageDocument) {\n\t\tthis.manifest = {};\n\t\tthis.navPath = '';\n\t\tthis.ncxPath = '';\n\t\tthis.coverPath = '';\n\t\tthis.spineNodeIndex = 0;\n\t\tthis.spine = [];\n\t\tthis.metadata = {};\n\n\t\tif (packageDocument) {\n\t\t\tthis.parse(packageDocument);\n\t\t}\n\t}\n\n\t/**\n\t * Parse OPF XML\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tparse(packageDocument){\n\t\tvar metadataNode, manifestNode, spineNode;\n\n\t\tif(!packageDocument) {\n\t\t\tthrow new Error(\"Package File Not Found\");\n\t\t}\n\n\t\tmetadataNode = qs(packageDocument, \"metadata\");\n\t\tif(!metadataNode) {\n\t\t\tthrow new Error(\"No Metadata Found\");\n\t\t}\n\n\t\tmanifestNode = qs(packageDocument, \"manifest\");\n\t\tif(!manifestNode) {\n\t\t\tthrow new Error(\"No Manifest Found\");\n\t\t}\n\n\t\tspineNode = qs(packageDocument, \"spine\");\n\t\tif(!spineNode) {\n\t\t\tthrow new Error(\"No Spine Found\");\n\t\t}\n\n\t\tthis.manifest = this.parseManifest(manifestNode);\n\t\tthis.navPath = this.findNavPath(manifestNode);\n\t\tthis.ncxPath = this.findNcxPath(manifestNode, spineNode);\n\t\tthis.coverPath = this.findCoverPath(packageDocument);\n\n\t\tthis.spineNodeIndex = indexOfElementNode(spineNode);\n\n\t\tthis.spine = this.parseSpine(spineNode, this.manifest);\n\n\t\tthis.uniqueIdentifier = this.findUniqueIdentifier(packageDocument);\n\t\tthis.metadata = this.parseMetadata(metadataNode);\n\n\t\tthis.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\n\n\n\t\treturn {\n\t\t\t\"metadata\" : this.metadata,\n\t\t\t\"spine\"    : this.spine,\n\t\t\t\"manifest\" : this.manifest,\n\t\t\t\"navPath\"  : this.navPath,\n\t\t\t\"ncxPath\"  : this.ncxPath,\n\t\t\t\"coverPath\": this.coverPath,\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex\n\t\t};\n\t}\n\n\t/**\n\t * Parse Metadata\n\t * @private\n\t * @param  {node} xml\n\t * @return {object} metadata\n\t */\n\tparseMetadata(xml){\n\t\tvar metadata = {};\n\n\t\tmetadata.title = this.getElementText(xml, \"title\");\n\t\tmetadata.creator = this.getElementText(xml, \"creator\");\n\t\tmetadata.description = this.getElementText(xml, \"description\");\n\n\t\tmetadata.pubdate = this.getElementText(xml, \"date\");\n\n\t\tmetadata.publisher = this.getElementText(xml, \"publisher\");\n\n\t\tmetadata.identifier = this.getElementText(xml, \"identifier\");\n\t\tmetadata.language = this.getElementText(xml, \"language\");\n\t\tmetadata.rights = this.getElementText(xml, \"rights\");\n\n\t\tmetadata.modified_date = this.getPropertyText(xml, \"dcterms:modified\");\n\n\t\tmetadata.layout = this.getPropertyText(xml, \"rendition:layout\");\n\t\tmetadata.orientation = this.getPropertyText(xml, \"rendition:orientation\");\n\t\tmetadata.flow = this.getPropertyText(xml, \"rendition:flow\");\n\t\tmetadata.viewport = this.getPropertyText(xml, \"rendition:viewport\");\n\t\tmetadata.media_active_class = this.getPropertyText(xml, \"media:active-class\");\n\t\t// metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\n\n\t\treturn metadata;\n\t}\n\n\t/**\n\t * Parse Manifest\n\t * @private\n\t * @param  {node} manifestXml\n\t * @return {object} manifest\n\t */\n\tparseManifest(manifestXml){\n\t\tvar manifest = {};\n\n\t\t//-- Turn items into an array\n\t\t// var selected = manifestXml.querySelectorAll(\"item\");\n\t\tvar selected = qsa(manifestXml, \"item\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t//-- Create an object with the id as key\n\t\titems.forEach(function(item){\n\t\t\tvar id = item.getAttribute(\"id\"),\n\t\t\t\t\thref = item.getAttribute(\"href\") || \"\",\n\t\t\t\t\ttype = item.getAttribute(\"media-type\") || \"\",\n\t\t\t\t\toverlay = item.getAttribute(\"media-overlay\") || \"\",\n\t\t\t\t\tproperties = item.getAttribute(\"properties\") || \"\";\n\n\t\t\tmanifest[id] = {\n\t\t\t\t\"href\" : href,\n\t\t\t\t// \"url\" : href,\n\t\t\t\t\"type\" : type,\n\t\t\t\t\"overlay\" : overlay,\n\t\t\t\t\"properties\" : properties.length ? properties.split(\" \") : []\n\t\t\t};\n\n\t\t});\n\n\t\treturn manifest;\n\n\t}\n\n\t/**\n\t * Parse Spine\n\t * @private\n\t * @param  {node} spineXml\n\t * @param  {Packaging.manifest} manifest\n\t * @return {object} spine\n\t */\n\tparseSpine(spineXml, manifest){\n\t\tvar spine = [];\n\n\t\tvar selected = qsa(spineXml, \"itemref\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t// var epubcfi = new EpubCFI();\n\n\t\t//-- Add to array to mantain ordering and cross reference with manifest\n\t\titems.forEach(function(item, index){\n\t\t\tvar idref = item.getAttribute(\"idref\");\n\t\t\t// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\n\t\t\tvar props = item.getAttribute(\"properties\") || \"\";\n\t\t\tvar propArray = props.length ? props.split(\" \") : [];\n\t\t\t// var manifestProps = manifest[Id].properties;\n\t\t\t// var manifestPropArray = manifestProps.length ? manifestProps.split(\" \") : [];\n\n\t\t\tvar itemref = {\n\t\t\t\t\"idref\" : idref,\n\t\t\t\t\"linear\" : item.getAttribute(\"linear\") || \"yes\",\n\t\t\t\t\"properties\" : propArray,\n\t\t\t\t// \"href\" : manifest[Id].href,\n\t\t\t\t// \"url\" :  manifest[Id].url,\n\t\t\t\t\"index\" : index\n\t\t\t\t// \"cfiBase\" : cfiBase\n\t\t\t};\n\t\t\tspine.push(itemref);\n\t\t});\n\n\t\treturn spine;\n\t}\n\n\t/**\n\t * Find Unique Identifier\n\t * @private\n\t * @param  {node} packageXml\n\t * @return {string} Unique Identifier text\n\t */\n\tfindUniqueIdentifier(packageXml){\n\t\tvar uniqueIdentifierId = packageXml.documentElement.getAttribute(\"unique-identifier\");\n\t\tif (! uniqueIdentifierId) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar identifier = packageXml.getElementById(uniqueIdentifierId);\n\t\tif (! identifier) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (identifier.localName === \"identifier\" && identifier.namespaceURI === \"http://purl.org/dc/elements/1.1/\") {\n\t\t\treturn identifier.childNodes[0].nodeValue.trim();\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Find TOC NAV\n\t * @private\n\t * @param {element} manifestNode\n\t * @return {string}\n\t */\n\tfindNavPath(manifestNode){\n\t\t// Find item with property \"nav\"\n\t\t// Should catch nav irregardless of order\n\t\t// var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"properties\":\"nav\"});\n\t\treturn node ? node.getAttribute(\"href\") : false;\n\t}\n\n\t/**\n\t * Find TOC NCX\n\t * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\n\t * @private\n\t * @param {element} manifestNode\n\t * @param {element} spineNode\n\t * @return {string}\n\t */\n\tfindNcxPath(manifestNode, spineNode){\n\t\t// var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"media-type\":\"application/x-dtbncx+xml\"});\n\t\tvar tocId;\n\n\t\t// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\n\t\t// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\n\t\t// \"The item that describes the NCX must be referenced by the spine toc attribute.\"\n\t\tif (!node) {\n\t\t\ttocId = spineNode.getAttribute(\"toc\");\n\t\t\tif(tocId) {\n\t\t\t\t// node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\n\t\t\t\tnode = manifestNode.querySelector(`#${tocId}`);\n\t\t\t}\n\t\t}\n\n\t\treturn node ? node.getAttribute(\"href\") : false;\n\t}\n\n\t/**\n\t * Find the Cover Path\n\t * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\n\t * Fallback for Epub 2.0\n\t * @private\n\t * @param  {node} packageXml\n\t * @return {string} href\n\t */\n\tfindCoverPath(packageXml){\n\t\tvar pkg = qs(packageXml, \"package\");\n\t\tvar epubVersion = pkg.getAttribute(\"version\");\n\n\t\tif (epubVersion === \"2.0\") {\n\t\t\tvar metaCover = qsp(packageXml, \"meta\", {\"name\":\"cover\"});\n\t\t\tif (metaCover) {\n\t\t\t\tvar coverId = metaCover.getAttribute(\"content\");\n\t\t\t\t// var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\n\t\t\t\tvar cover = packageXml.getElementById(coverId);\n\t\t\t\treturn cover ? cover.getAttribute(\"href\") : \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// var node = packageXml.querySelector(\"item[properties='cover-image']\");\n\t\t\tvar node = qsp(packageXml, \"item\", {\"properties\":\"cover-image\"});\n\t\t\treturn node ? node.getAttribute(\"href\") : \"\";\n\t\t}\n\t}\n\n\t/**\n\t * Get text of a namespaced element\n\t * @private\n\t * @param  {node} xml\n\t * @param  {string} tag\n\t * @return {string} text\n\t */\n\tgetElementText(xml, tag){\n\t\tvar found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag);\n\t\tvar el;\n\n\t\tif(!found || found.length === 0) return \"\";\n\n\t\tel = found[0];\n\n\t\tif(el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn \"\";\n\n\t}\n\n\t/**\n\t * Get text by property\n\t * @private\n\t * @param  {node} xml\n\t * @param  {string} property\n\t * @return {string} text\n\t */\n\tgetPropertyText(xml, property){\n\t\tvar el = qsp(xml, \"meta\", {\"property\":property});\n\n\t\tif(el && el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Load JSON Manifest\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tload(json) {\n\t\tthis.metadata = json.metadata;\n\n\t\tlet spine = json.readingOrder || json.spine;\n\t\tthis.spine = spine.map((item, index) =>{\n\t\t\titem.index = index;\n\t\t\treturn item;\n\t\t});\n\n\t\tjson.resources.forEach((item, index) => {\n\t\t\tthis.manifest[index] = item;\n\n\t\t\tif (item.rel && item.rel[0] === \"cover\") {\n\t\t\t\tthis.coverPath = item.href;\n\t\t\t}\n\t\t});\n\n\t\tthis.spineNodeIndex = 0;\n\n\t\tthis.toc = json.toc.map((item, index) =>{\n\t\t\titem.label = item.title;\n\t\t\treturn item;\n\t\t});\n\n\t\treturn {\n\t\t\t\"metadata\" : this.metadata,\n\t\t\t\"spine\"    : this.spine,\n\t\t\t\"manifest\" : this.manifest,\n\t\t\t\"navPath\"  : this.navPath,\n\t\t\t\"ncxPath\"  : this.ncxPath,\n\t\t\t\"coverPath\": this.coverPath,\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex,\n\t\t\t\"toc\" : this.toc\n\t\t};\n\t}\n\n\tdestroy() {\n\t\tthis.manifest = undefined;\n\t\tthis.navPath = undefined;\n\t\tthis.ncxPath = undefined;\n\t\tthis.coverPath = undefined;\n\t\tthis.spineNodeIndex = undefined;\n\t\tthis.spine = undefined;\n\t\tthis.metadata = undefined;\n\t}\n}\n\nexport default Packaging;\n","import {qs, qsa, querySelectorByType, filterChildren, getParentByTagName} from \"./utils/core\";\n\n/**\n * Navigation Parser\n * @param {document} xml navigation html / xhtml / ncx\n */\nclass Navigation {\n\tconstructor(xml) {\n\t\tthis.toc = [];\n\t\tthis.tocByHref = {};\n\t\tthis.tocById = {};\n\n\t\tthis.landmarks = [];\n\t\tthis.landmarksByType = {};\n\n\t\tthis.length = 0;\n\t\tif (xml) {\n\t\t\tthis.parse(xml);\n\t\t}\n\t}\n\n\t/**\n\t * Parse out the navigation items\n\t * @param {document} xml navigation html / xhtml / ncx\n\t */\n\tparse(xml) {\n\t\tlet isXml = xml.nodeType;\n\t\tlet html;\n\t\tlet ncx;\n\n\t\tif (isXml) {\n\t\t\thtml = qs(xml, \"html\");\n\t\t\tncx = qs(xml, \"ncx\");\n\t\t}\n\n\t\tif (!isXml) {\n\t\t\tthis.toc = this.load(xml);\n\t\t} else if(html) {\n\t\t\tthis.toc = this.parseNav(xml);\n\t\t\tthis.landmarks = this.parseLandmarks(xml);\n\t\t} else if(ncx){\n\t\t\tthis.toc = this.parseNcx(xml);\n\t\t}\n\n\t\tthis.length = 0;\n\n\t\tthis.unpack(this.toc);\n\t}\n\n\t/**\n\t * Unpack navigation items\n\t * @private\n\t * @param  {array} toc\n\t */\n\tunpack(toc) {\n\t\tvar item;\n\n\t\tfor (var i = 0; i < toc.length; i++) {\n\t\t\titem = toc[i];\n\n\t\t\tif (item.href) {\n\t\t\t\tthis.tocByHref[item.href] = i;\n\t\t\t}\n\n\t\t\tif (item.id) {\n\t\t\t\tthis.tocById[item.id] = i;\n\t\t\t}\n\n\t\t\tthis.length++;\n\n\t\t\tif (item.subitems.length) {\n\t\t\t\tthis.unpack(item.subitems);\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/**\n\t * Get an item from the navigation\n\t * @param  {string} target\n\t * @return {object} navItem\n\t */\n\tget(target) {\n\t\tvar index;\n\n\t\tif(!target) {\n\t\t\treturn this.toc;\n\t\t}\n\n\t\tif(target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.tocById[target.substring(1)];\n\t\t} else if(target in this.tocByHref){\n\t\t\tindex = this.tocByHref[target];\n\t\t}\n\n\t\treturn this.toc[index];\n\t}\n\n\t/**\n\t * Get a landmark by type\n\t * List of types: https://idpf.github.io/epub-vocabs/structure/\n\t * @param  {string} type\n\t * @return {object} landmarkItem\n\t */\n\tlandmark(type) {\n\t\tvar index;\n\n\t\tif(!type) {\n\t\t\treturn this.landmarks;\n\t\t}\n\n\t\tindex = this.landmarksByType[type];\n\n\t\treturn this.landmarks[index];\n\t}\n\n\t/**\n\t * Parse toc from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"toc\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.navItem(navItems[i]);\n\t\t\tif (item) {\n\t\t\t\ttoc[item.id] = item;\n\t\t\t\tif(!item.parent) {\n\t\t\t\t\tlist.push(item);\n\t\t\t\t} else {\n\t\t\t\t\tparent = toc[item.parent];\n\t\t\t\t\tparent.subitems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a navItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} navItem\n\t */\n\tnavItem(item){\n\t\tlet id = item.getAttribute(\"id\") || undefined;\n\t\tlet content = filterChildren(item, \"a\", true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet src = content.getAttribute(\"href\") || \"\";\n\t\t\n\t\tif (!id) {\n\t\t\tid = src;\n\t\t}\n\t\tlet text = content.textContent || \"\";\n\t\tlet subitems = [];\n\t\tlet parentItem = getParentByTagName(item, \"li\");\n\t\tlet parent;\n\n\t\tif (parentItem) {\n\t\t\tparent = parentItem.getAttribute(\"id\");\n\t\t\tif (!parent) {\n\t\t\t\tconst parentContent = filterChildren(parentItem, \"a\", true);\n\t\t\t\tparent = parentContent && parentContent.getAttribute(\"href\");\n      \t\t\t}\n\t\t}\n\n\t\twhile (!parent && parentItem) {\n\t\t\tparentItem = getParentByTagName(parentItem, \"li\");\n\t\t\tif (parentItem) {\n\t\t\t\tparent = parentItem.getAttribute(\"id\");\n\t\t\t\tif (!parent) {\n\t\t\t\t\tconst parentContent = filterChildren(parentItem, \"a\", true);\n          \t\t\t\tparent = parentContent && parentContent.getAttribute(\"href\");\n        \t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t}\n\n\t/**\n\t * Parse landmarks from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} landmarks list\n\t */\n\tparseLandmarks(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"landmarks\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.landmarkItem(navItems[i]);\n\t\t\tif (item) {\n\t\t\t\tlist.push(item);\n\t\t\t\tthis.landmarksByType[item.type] = i;\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a landmarkItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} landmarkItem\n\t */\n\tlandmarkItem(item){\n\t\tlet content = filterChildren(item, \"a\", true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet type = content.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") || undefined;\n\t\tlet href = content.getAttribute(\"href\") || \"\";\n\t\tlet text = content.textContent || \"\";\n\n\t\treturn {\n\t\t\t\"href\": href,\n\t\t\t\"label\": text,\n\t\t\t\"type\" : type\n\t\t};\n\t}\n\n\t/**\n\t * Parse from a Epub > 3.0 NC\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNcx(tocXml){\n\t\tvar navPoints = qsa(tocXml, \"navPoint\");\n\t\tvar length = navPoints.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navPoints || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.ncxItem(navPoints[i]);\n\t\t\ttoc[item.id] = item;\n\t\t\tif(!item.parent) {\n\t\t\t\tlist.push(item);\n\t\t\t} else {\n\t\t\t\tparent = toc[item.parent];\n\t\t\t\tparent.subitems.push(item);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Create a ncxItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} ncxItem\n\t */\n\tncxItem(item){\n\t\tvar id = item.getAttribute(\"id\") || false,\n\t\t\t\tcontent = qs(item, \"content\"),\n\t\t\t\tsrc = content.getAttribute(\"src\"),\n\t\t\t\tnavLabel = qs(item, \"navLabel\"),\n\t\t\t\ttext = navLabel.textContent ? navLabel.textContent : \"\",\n\t\t\t\tsubitems = [],\n\t\t\t\tparentNode = item.parentNode,\n\t\t\t\tparent;\n\n\t\tif(parentNode && (parentNode.nodeName === \"navPoint\" || parentNode.nodeName.split(':').slice(-1)[0] === \"navPoint\")) {\n\t\t\tparent = parentNode.getAttribute(\"id\");\n\t\t}\n\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t}\n\n\t/**\n\t * Load Spine Items\n\t * @param  {object} json the items to be loaded\n\t * @return {Array} navItems\n\t */\n\tload(json) {\n\t\treturn json.map(item => {\n\t\t\titem.label = item.title;\n\t\t\titem.subitems = item.children ? this.load(item.children) : [];\n\t\t\treturn item;\n\t\t});\n\t}\n\n\t/**\n\t * forEach pass through\n\t * @param  {Function} fn function to run on each item\n\t * @return {method} forEach loop\n\t */\n\tforEach(fn) {\n\t\treturn this.toc.forEach(fn);\n\t}\n}\n\nexport default Navigation;\n","/*\n From Zip.js, by Gildas Lormeau\nedited down\n */\n\nvar table = {\n\t\"application\" : {\n\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\n\t\t\"javascript\" : \"js\",\n\t\t\"ogg\" : \"ogx\",\n\t\t\"pdf\" : \"pdf\",\n\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\n\t\t\"rdf+xml\" : \"rdf\",\n\t\t\"smil\" : [ \"smi\", \"smil\" ],\n\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\n\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\" ],\n\t\t\"zip\" : \"zip\",\n\t\t\"x-httpd-eruby\" : \"rhtml\",\n\t\t\"x-latex\" : \"latex\",\n\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\n\t\t\"x-object\" : \"o\",\n\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\n\t\t\"x-silverlight\" : \"scr\",\n\t\t\"epub+zip\" : \"epub\",\n\t\t\"font-tdpfr\" : \"pfr\",\n\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\n\t\t\"json\" : \"json\",\n\t\t\"jsonml+json\" : \"jsonml\",\n\t\t\"mathml+xml\" : \"mathml\",\n\t\t\"metalink+xml\" : \"metalink\",\n\t\t\"mp4\" : \"mp4s\",\n\t\t// \"oebps-package+xml\" : \"opf\",\n\t\t\"omdoc+xml\" : \"omdoc\",\n\t\t\"oxps\" : \"oxps\",\n\t\t\"vnd.amazon.ebook\" : \"azw\",\n\t\t\"widget\" : \"wgt\",\n\t\t// \"x-dtbncx+xml\" : \"ncx\",\n\t\t\"x-dtbook+xml\" : \"dtb\",\n\t\t\"x-dtbresource+xml\" : \"res\",\n\t\t\"x-font-bdf\" : \"bdf\",\n\t\t\"x-font-ghostscript\" : \"gsf\",\n\t\t\"x-font-linux-psf\" : \"psf\",\n\t\t\"x-font-otf\" : \"otf\",\n\t\t\"x-font-pcf\" : \"pcf\",\n\t\t\"x-font-snf\" : \"snf\",\n\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\n\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\n\t\t\"x-font-woff\" : \"woff\",\n\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\n\t\t\"x-mspublisher\" : \"pub\",\n\t\t\"x-nzb\" : \"nzb\",\n\t\t\"x-tgif\" : \"obj\",\n\t\t\"xaml+xml\" : \"xaml\",\n\t\t\"xml-dtd\" : \"dtd\",\n\t\t\"xproc+xml\" : \"xpl\",\n\t\t\"xslt+xml\" : \"xslt\",\n\t\t\"internet-property-stream\" : \"acx\",\n\t\t\"x-compress\" : \"z\",\n\t\t\"x-compressed\" : \"tgz\",\n\t\t\"x-gzip\" : \"gz\",\n\t},\n\t\"audio\" : {\n\t\t\"flac\" : \"flac\",\n\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\n\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\n\t\t\"mpegurl\" : \"m3u\",\n\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\n\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\n\t\t\"x-ms-wma\" : \"wma\",\n\t\t\"x-wav\" : \"wav\",\n\t\t\"adpcm\" : \"adp\",\n\t\t\"mp4\" : \"mp4a\",\n\t\t\"webm\" : \"weba\",\n\t\t\"x-aac\" : \"aac\",\n\t\t\"x-caf\" : \"caf\",\n\t\t\"x-matroska\" : \"mka\",\n\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\n\t\t\"xm\" : \"xm\",\n\t\t\"mid\" : [ \"mid\", \"rmi\" ]\n\t},\n\t\"image\" : {\n\t\t\"gif\" : \"gif\",\n\t\t\"ief\" : \"ief\",\n\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\n\t\t\"pcx\" : \"pcx\",\n\t\t\"png\" : \"png\",\n\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\n\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\n\t\t\"x-icon\" : \"ico\",\n\t\t\"bmp\" : \"bmp\",\n\t\t\"webp\" : \"webp\",\n\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\n\t\t\"x-tga\" : \"tga\",\n\t\t\"cis-cod\" : \"cod\"\n\t},\n\t\"text\" : {\n\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\n\t\t\"css\" : \"css\",\n\t\t\"csv\" : \"csv\",\n\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\n\t\t\"mathml\" : \"mml\",\n\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\n\t\t\"richtext\" : \"rtx\",\n\t\t\"tab-separated-values\" : \"tsv\",\n\t\t\"x-bibtex\" : \"bib\"\n\t},\n\t\"video\" : {\n\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\n\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\n\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\n\t\t\"ogg\" : \"ogv\",\n\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\n\t\t\"x-flv\" : \"flv\",\n\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\n\t\t\"x-mng\" : \"mng\",\n\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\n\t\t\"x-ms-wm\" : \"wm\",\n\t\t\"x-ms-wmv\" : \"wmv\",\n\t\t\"x-ms-wmx\" : \"wmx\",\n\t\t\"x-ms-wvx\" : \"wvx\",\n\t\t\"x-msvideo\" : \"avi\",\n\t\t\"x-sgi-movie\" : \"movie\",\n\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\n\t\t\"3gpp2\" : \"3g2\",\n\t\t\"h261\" : \"h261\",\n\t\t\"h263\" : \"h263\",\n\t\t\"h264\" : \"h264\",\n\t\t\"jpeg\" : \"jpgv\",\n\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\n\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\n\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\n\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\n\t\t\"vnd.vivo\" : \"viv\",\n\t\t\"webm\" : \"webm\",\n\t\t\"x-f4v\" : \"f4v\",\n\t\t\"x-m4v\" : \"m4v\",\n\t\t\"x-ms-vob\" : \"vob\",\n\t\t\"x-smv\" : \"smv\"\n\t}\n};\n\nvar mimeTypes = (function() {\n\tvar type, subtype, val, index, mimeTypes = {};\n\tfor (type in table) {\n\t\tif (table.hasOwnProperty(type)) {\n\t\t\tfor (subtype in table[type]) {\n\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\n\t\t\t\t\tval = table[type][subtype];\n\t\t\t\t\tif (typeof val == \"string\") {\n\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\n\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn mimeTypes;\n})();\n\nvar defaultValue = \"text/plain\";//\"application/octet-stream\";\n\nfunction lookup(filename) {\n\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\n};\n\nmodule.exports = {\n\t'lookup': lookup\n}\n","import {substitute} from \"./utils/replacements\";\nimport {createBase64Url, createBlobUrl, blob2base64} from \"./utils/core\";\nimport Url from \"./utils/url\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\nimport path from \"path-webpack\";\n\n/**\n * Handle Package Resources\n * @class\n * @param {Manifest} manifest\n * @param {object} [options]\n * @param {string} [options.replacements=\"base64\"]\n * @param {Archive} [options.archive]\n * @param {method} [options.resolver]\n */\nclass Resources {\n\tconstructor(manifest, options) {\n\t\tthis.settings = {\n\t\t\treplacements: (options && options.replacements) || \"base64\",\n\t\t\tarchive: (options && options.archive),\n\t\t\tresolver: (options && options.resolver),\n\t\t\trequest: (options && options.request)\n\t\t};\n\n\t\tthis.process(manifest);\n\t}\n\n\t/**\n\t * Process resources\n\t * @param {Manifest} manifest\n\t */\n\tprocess(manifest){\n\t\tthis.manifest = manifest;\n\t\tthis.resources = Object.keys(manifest).\n\t\t\tmap(function (key){\n\t\t\t\treturn manifest[key];\n\t\t\t});\n\n\t\tthis.replacementUrls = [];\n\n\t\tthis.html = [];\n\t\tthis.assets = [];\n\t\tthis.css = [];\n\n\t\tthis.urls = [];\n\t\tthis.cssUrls = [];\n\n\t\tthis.split();\n\t\tthis.splitUrls();\n\t}\n\n\t/**\n\t * Split resources by type\n\t * @private\n\t */\n\tsplit(){\n\n\t\t// HTML\n\t\tthis.html = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"application/xhtml+xml\" ||\n\t\t\t\t\t\titem.type === \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Exclude HTML\n\t\tthis.assets = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type !== \"application/xhtml+xml\" &&\n\t\t\t\t\t\titem.type !== \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Only CSS\n\t\tthis.css = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"text/css\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Convert split resources into Urls\n\t * @private\n\t */\n\tsplitUrls(){\n\n\t\t// All Assets Urls\n\t\tthis.urls = this.assets.\n\t\t\tmap(function(item) {\n\t\t\t\treturn item.href;\n\t\t\t}.bind(this));\n\n\t\t// Css Urls\n\t\tthis.cssUrls = this.css.map(function(item) {\n\t\t\treturn item.href;\n\t\t});\n\n\t}\n\n\t/**\n\t * Create a url to a resource\n\t * @param {string} url\n\t * @return {Promise<string>} Promise resolves with url string\n\t */\n\tcreateUrl (url) {\n\t\tvar parsedUrl = new Url(url);\n\t\tvar mimeType = mime.lookup(parsedUrl.filename);\n\n\t\tif (this.settings.archive) {\n\t\t\treturn this.settings.archive.createUrl(url, {\"base64\": (this.settings.replacements === \"base64\")});\n\t\t} else {\n\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\treturn this.settings.request(url, 'blob')\n\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\treturn blob2base64(blob);\n\t\t\t\t\t})\n\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\treturn createBase64Url(blob, mimeType);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn this.settings.request(url, 'blob').then((blob) => {\n\t\t\t\t\treturn createBlobUrl(blob, mimeType);\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Create blob urls for all the assets\n\t * @return {Promise}         returns replacement urls\n\t */\n\treplacements(){\n\t\tif (this.settings.replacements === \"none\") {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve(this.urls);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tvar replacements = this.urls.\n\t\t\tmap( (url) => {\n\t\t\t\tvar absolute = this.settings.resolver(url);\n\n\t\t\t\treturn this.createUrl(absolute).\n\t\t\t\t\tcatch((err) => {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t});\n\n\t\treturn Promise.all(replacements)\n\t\t\t.then( (replacementUrls) => {\n\t\t\t\tthis.replacementUrls = replacementUrls.filter((url) => {\n\t\t\t\t\treturn (typeof(url) === \"string\");\n\t\t\t\t});\n\t\t\t\treturn replacementUrls;\n\t\t\t});\n\t}\n\n\t/**\n\t * Replace URLs in CSS resources\n\t * @private\n\t * @param  {Archive} [archive]\n\t * @param  {method} [resolver]\n\t * @return {Promise}\n\t */\n\treplaceCss(archive, resolver){\n\t\tvar replaced = [];\n\t\tarchive = archive || this.settings.archive;\n\t\tresolver = resolver || this.settings.resolver;\n\t\tthis.cssUrls.forEach(function(href) {\n\t\t\tvar replacement = this.createCssFile(href, archive, resolver)\n\t\t\t\t.then(function (replacementUrl) {\n\t\t\t\t\t// switch the url in the replacementUrls\n\t\t\t\t\tvar indexInUrls = this.urls.indexOf(href);\n\t\t\t\t\tif (indexInUrls > -1) {\n\t\t\t\t\t\tthis.replacementUrls[indexInUrls] = replacementUrl;\n\t\t\t\t\t}\n\t\t\t\t}.bind(this))\n\n\n\t\t\treplaced.push(replacement);\n\t\t}.bind(this));\n\t\treturn Promise.all(replaced);\n\t}\n\n\t/**\n\t * Create a new CSS file with the replaced URLs\n\t * @private\n\t * @param  {string} href the original css file\n\t * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\n\t */\n\tcreateCssFile(href){\n\t\tvar newUrl;\n\n\t\tif (path.isAbsolute(href)) {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tvar absolute = this.settings.resolver(href);\n\n\t\t// Get the text of the css file from the archive\n\t\tvar textResponse;\n\n\t\tif (this.settings.archive) {\n\t\t\ttextResponse = this.settings.archive.getText(absolute);\n\t\t} else {\n\t\t\ttextResponse = this.settings.request(absolute, \"text\");\n\t\t}\n\n\t\t// Get asset links relative to css file\n\t\tvar relUrls = this.urls.map( (assetHref) => {\n\t\t\tvar resolved = this.settings.resolver(assetHref);\n\t\t\tvar relative = new Path(absolute).relative(resolved);\n\n\t\t\treturn relative;\n\t\t});\n\n\t\tif (!textResponse) {\n\t\t\t// file not found, don't replace\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\treturn textResponse.then( (text) => {\n\t\t\t// Replacements in the css text\n\t\t\ttext = substitute(text, relUrls, this.replacementUrls);\n\n\t\t\t// Get the new url\n\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\tnewUrl = createBase64Url(text, \"text/css\");\n\t\t\t} else {\n\t\t\t\tnewUrl = createBlobUrl(text, \"text/css\");\n\t\t\t}\n\n\t\t\treturn newUrl;\n\t\t}, (err) => {\n\t\t\t// handle response errors\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t}\n\n\t/**\n\t * Resolve all resources URLs relative to an absolute URL\n\t * @param  {string} absolute to be resolved to\n\t * @param  {resolver} [resolver]\n\t * @return {string[]} array with relative Urls\n\t */\n\trelativeTo(absolute, resolver){\n\t\tresolver = resolver || this.settings.resolver;\n\n\t\t// Get Urls relative to current sections\n\t\treturn this.urls.\n\t\t\tmap(function(href) {\n\t\t\t\tvar resolved = resolver(href);\n\t\t\t\tvar relative = new Path(absolute).relative(resolved);\n\t\t\t\treturn relative;\n\t\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get a URL for a resource\n\t * @param  {string} path\n\t * @return {string} url\n\t */\n\tget(path) {\n\t\tvar indexInUrls = this.urls.indexOf(path);\n\t\tif (indexInUrls === -1) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.replacementUrls.length) {\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tresolve(this.replacementUrls[indexInUrls]);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\treturn this.createUrl(path);\n\t\t}\n\t}\n\n\t/**\n\t * Substitute urls in content, with replacements,\n\t * relative to a url if provided\n\t * @param  {string} content\n\t * @param  {string} [url]   url to resolve to\n\t * @return {string}         content with urls substituted\n\t */\n\tsubstitute(content, url) {\n\t\tvar relUrls;\n\t\tif (url) {\n\t\t\trelUrls = this.relativeTo(url);\n\t\t} else {\n\t\t\trelUrls = this.urls;\n\t\t}\n\t\treturn substitute(content, relUrls, this.replacementUrls);\n\t}\n\n\tdestroy() {\n\t\tthis.settings = undefined;\n\t\tthis.manifest = undefined;\n\t\tthis.resources = undefined;\n\t\tthis.replacementUrls = undefined;\n\t\tthis.html = undefined;\n\t\tthis.assets = undefined;\n\t\tthis.css = undefined;\n\n\t\tthis.urls = undefined;\n\t\tthis.cssUrls = undefined;\n\t}\n}\n\nexport default Resources;\n","import EpubCFI from \"./epubcfi\";\nimport {\n\tqs,\n\tqsa,\n\tquerySelectorByType,\n\tindexOfSorted,\n\tlocationOf\n} from \"./utils/core\";\n\n/**\n * Page List Parser\n * @param {document} [xml]\n */\nclass PageList {\n\tconstructor(xml) {\n\t\tthis.pages = [];\n\t\tthis.locations = [];\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.firstPage = 0;\n\t\tthis.lastPage = 0;\n\t\tthis.totalPages = 0;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\n\t\tif (xml) {\n\t\t\tthis.pageList = this.parse(xml);\n\t\t}\n\n\t\tif(this.pageList && this.pageList.length) {\n\t\t\tthis.process(this.pageList);\n\t\t}\n\t}\n\n\t/**\n\t * Parse PageList Xml\n\t * @param  {document} xml\n\t */\n\tparse(xml) {\n\t\tvar html = qs(xml, \"html\");\n\t\tvar ncx = qs(xml, \"ncx\");\n\n\t\tif(html) {\n\t\t\treturn this.parseNav(xml);\n\t\t} else if(ncx){ // Not supported\n\t\t\t// return this.parseNcx(xml);\n\t\t\treturn;\n\t\t}\n\n\t}\n\n\t/**\n\t * Parse a Nav PageList\n\t * @private\n\t * @param  {node} navHtml\n\t * @return {PageList.item[]} list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"page-list\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.item(navItems[i]);\n\t\t\tlist.push(item);\n\t\t}\n\n\t\treturn list;\n\t}\n\n\t/**\n\t * Page List Item\n\t * @private\n\t * @param  {node} item\n\t * @return {object} pageListItem\n\t */\n\titem(item){\n\t\tvar content = qs(item, \"a\"),\n\t\t\t\thref = content.getAttribute(\"href\") || \"\",\n\t\t\t\ttext = content.textContent || \"\",\n\t\t\t\tpage = parseInt(text),\n\t\t\t\tisCfi = href.indexOf(\"epubcfi\"),\n\t\t\t\tsplit,\n\t\t\t\tpackageUrl,\n\t\t\t\tcfi;\n\n\t\tif(isCfi != -1) {\n\t\t\tsplit = href.split(\"#\");\n\t\t\tpackageUrl = split[0];\n\t\t\tcfi = split.length > 1 ? split[1] : false;\n\t\t\treturn {\n\t\t\t\t\"cfi\" : cfi,\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"packageUrl\" : packageUrl,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Process pageList items\n\t * @private\n\t * @param  {array} pageList\n\t */\n\tprocess(pageList){\n\t\tpageList.forEach(function(item){\n\t\t\tthis.pages.push(item.page);\n\t\t\tif (item.cfi) {\n\t\t\t\tthis.locations.push(item.cfi);\n\t\t\t}\n\t\t}, this);\n\t\tthis.firstPage = parseInt(this.pages[0]);\n\t\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\n\t\tthis.totalPages = this.lastPage - this.firstPage;\n\t}\n\n\t/**\n\t * Get a PageList result from a EpubCFI\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} page\n\t */\n\tpageFromCfi(cfi){\n\t\tvar pg = -1;\n\n\t\t// Check if the pageList has not been set yet\n\t\tif(this.locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// TODO: check if CFI is valid?\n\n\t\t// check if the cfi is in the location list\n\t\t// var index = this.locations.indexOf(cfi);\n\t\tvar index = indexOfSorted(cfi, this.locations, this.epubcfi.compare);\n\t\tif(index != -1) {\n\t\t\tpg = this.pages[index];\n\t\t} else {\n\t\t\t// Otherwise add it to the list of locations\n\t\t\t// Insert it in the correct position in the locations page\n\t\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\n\t\t\tindex = locationOf(cfi, this.locations, this.epubcfi.compare);\n\t\t\t// Get the page at the location just before the new one, or return the first\n\t\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\n\t\t\tif(pg !== undefined) {\n\t\t\t\t// Add the new page in so that the locations and page array match up\n\t\t\t\t//this.pages.splice(index, 0, pg);\n\t\t\t} else {\n\t\t\t\tpg = -1;\n\t\t\t}\n\n\t\t}\n\t\treturn pg;\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Page List Item\n\t * @param  {string | number} pg\n\t * @return {string} cfi\n\t */\n\tcfiFromPage(pg){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof pg != \"number\"){\n\t\t\tpg = parseInt(pg);\n\t\t}\n\n\t\t// check if the cfi is in the page list\n\t\t// Pages could be unsorted.\n\t\tvar index = this.pages.indexOf(pg);\n\t\tif(index != -1) {\n\t\t\tcfi = this.locations[index];\n\t\t}\n\t\t// TODO: handle pages not in the list\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Get a Page from Book percentage\n\t * @param  {number} percent\n\t * @return {number} page\n\t */\n\tpageFromPercentage(percent){\n\t\tvar pg = Math.round(this.totalPages * percent);\n\t\treturn pg;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a page\n\t * @param  {number} pg the page\n\t * @return {number} percentage\n\t */\n\tpercentageFromPage(pg){\n\t\tvar percentage = (pg - this.firstPage) / this.totalPages;\n\t\treturn Math.round(percentage * 1000) / 1000;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a cfi\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} percentage\n\t */\n\tpercentageFromCfi(cfi){\n\t\tvar pg = this.pageFromCfi(cfi);\n\t\tvar percentage = this.percentageFromPage(pg);\n\t\treturn percentage;\n\t}\n\n\t/**\n\t * Destroy\n\t */\n\tdestroy() {\n\t\tthis.pages = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.pageList = undefined;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\t}\n}\n\nexport default PageList;\n","import { extend } from \"./utils/core\";\nimport { EVENTS } from \"./utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Figures out the CSS values to apply for a layout\n * @class\n * @param {object} settings\n * @param {string} [settings.layout='reflowable']\n * @param {string} [settings.spread]\n * @param {number} [settings.minSpreadWidth=800]\n * @param {boolean} [settings.evenSpreads=false]\n */\nclass Layout {\n\tconstructor(settings) {\n\t\tthis.settings = settings;\n\t\tthis.name = settings.layout || \"reflowable\";\n\t\tthis._spread = (settings.spread === \"none\") ? false : true;\n\t\tthis._minSpreadWidth = settings.minSpreadWidth || 800;\n\t\tthis._evenSpreads = settings.evenSpreads || false;\n\n\t\tif (settings.flow === \"scrolled\" ||\n\t\t\t\tsettings.flow === \"scrolled-continuous\" ||\n\t\t\t\tsettings.flow === \"scrolled-doc\") {\n\t\t\tthis._flow = \"scrolled\";\n\t\t} else {\n\t\t\tthis._flow = \"paginated\";\n\t\t}\n\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.spreadWidth = 0;\n\t\tthis.delta = 0;\n\n\t\tthis.columnWidth = 0;\n\t\tthis.gap = 0;\n\t\tthis.divisor = 1;\n\n\t\tthis.props = {\n\t\t\tname: this.name,\n\t\t\tspread: this._spread,\n\t\t\tflow: this._flow,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tspreadWidth: 0,\n\t\t\tdelta: 0,\n\t\t\tcolumnWidth: 0,\n\t\t\tgap: 0,\n\t\t\tdivisor: 1\n\t\t};\n\n\t}\n\n\t/**\n\t * Switch the flow between paginated and scrolled\n\t * @param  {string} flow paginated | scrolled\n\t * @return {string} simplified flow\n\t */\n\tflow(flow) {\n\t\tif (typeof(flow) != \"undefined\") {\n\t\t\tif (flow === \"scrolled\" ||\n\t\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\t\tflow === \"scrolled-doc\") {\n\t\t\t\tthis._flow = \"scrolled\";\n\t\t\t} else {\n\t\t\t\tthis._flow = \"paginated\";\n\t\t\t}\n\t\t\t// this.props.flow = this._flow;\n\t\t\tthis.update({flow: this._flow});\n\t\t}\n\t\treturn this._flow;\n\t}\n\n\t/**\n\t * Switch between using spreads or not, and set the\n\t * width at which they switch to single.\n\t * @param  {string} spread \"none\" | \"always\" | \"auto\"\n\t * @param  {number} min integer in pixels\n\t * @return {boolean} spread true | false\n\t */\n\tspread(spread, min) {\n\n\t\tif (spread) {\n\t\t\tthis._spread = (spread === \"none\") ? false : true;\n\t\t\t// this.props.spread = this._spread;\n\t\t\tthis.update({spread: this._spread});\n\t\t}\n\n\t\tif (min >= 0) {\n\t\t\tthis._minSpreadWidth = min;\n\t\t}\n\n\t\treturn this._spread;\n\t}\n\n\t/**\n\t * Calculate the dimensions of the pagination\n\t * @param  {number} _width  width of the rendering\n\t * @param  {number} _height height of the rendering\n\t * @param  {number} _gap    width of the gap between columns\n\t */\n\tcalculate(_width, _height, _gap){\n\n\t\tvar divisor = 1;\n\t\tvar gap = _gap || 0;\n\n\t\t//-- Check the width and create even width columns\n\t\t// var fullWidth = Math.floor(_width);\n\t\tvar width = _width;\n\t\tvar height = _height;\n\n\t\tvar section = Math.floor(width / 12);\n\n\t\tvar columnWidth;\n\t\tvar spreadWidth;\n\t\tvar pageWidth;\n\t\tvar delta;\n\n\t\tif (this._spread && width >= this._minSpreadWidth) {\n\t\t\tdivisor = 2;\n\t\t} else {\n\t\t\tdivisor = 1;\n\t\t}\n\n\t\tif (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\n\t\t\tgap = ((section % 2 === 0) ? section : section - 1);\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" ) {\n\t\t\tgap = 0;\n\t\t}\n\n\t\t//-- Double Page\n\t\tif(divisor > 1) {\n\t\t\t// width = width - gap;\n\t\t\t// columnWidth = (width - gap) / divisor;\n\t\t\t// gap = gap / divisor;\n\t\t\tcolumnWidth = (width / divisor) - gap;\n\t\t\tpageWidth = columnWidth + gap;\n\t\t} else {\n\t\t\tcolumnWidth = width;\n\t\t\tpageWidth = width;\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" && divisor > 1) {\n\t\t\twidth = columnWidth;\n\t\t}\n\n\t\tspreadWidth = (columnWidth * divisor) + gap;\n\n\t\tdelta = width;\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.spreadWidth = spreadWidth;\n\t\tthis.pageWidth = pageWidth;\n\t\tthis.delta = delta;\n\n\t\tthis.columnWidth = columnWidth;\n\t\tthis.gap = gap;\n\t\tthis.divisor = divisor;\n\n\t\t// this.props.width = width;\n\t\t// this.props.height = _height;\n\t\t// this.props.spreadWidth = spreadWidth;\n\t\t// this.props.pageWidth = pageWidth;\n\t\t// this.props.delta = delta;\n\t\t//\n\t\t// this.props.columnWidth = colWidth;\n\t\t// this.props.gap = gap;\n\t\t// this.props.divisor = divisor;\n\n\t\tthis.update({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tspreadWidth,\n\t\t\tpageWidth,\n\t\t\tdelta,\n\t\t\tcolumnWidth,\n\t\t\tgap,\n\t\t\tdivisor\n\t\t});\n\n\t}\n\n\t/**\n\t * Apply Css to a Document\n\t * @param  {Contents} contents\n\t * @return {Promise}\n\t */\n\tformat(contents){\n\t\tvar formating;\n\n\t\tif (this.name === \"pre-paginated\") {\n\t\t\tformating = contents.fit(this.columnWidth, this.height);\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tformating = contents.columns(this.width, this.height, this.columnWidth, this.gap);\n\t\t} else { // scrolled\n\t\t\tformating = contents.size(this.width, null);\n\t\t}\n\n\t\treturn formating; // might be a promise in some View Managers\n\t}\n\n\t/**\n\t * Count number of pages\n\t * @param  {number} totalLength\n\t * @param  {number} pageLength\n\t * @return {{spreads: Number, pages: Number}}\n\t */\n\tcount(totalLength, pageLength) {\n\n\t\tlet spreads, pages;\n\n\t\tif (this.name === \"pre-paginated\") {\n\t\t\tspreads = 1;\n\t\t\tpages = 1;\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tpageLength = pageLength || this.delta;\n\t\t\tspreads = Math.ceil( totalLength / pageLength);\n\t\t\tpages = spreads * this.divisor;\n\t\t} else { // scrolled\n\t\t\tpageLength = pageLength || this.height;\n\t\t\tspreads = Math.ceil( totalLength / pageLength);\n\t\t\tpages = spreads;\n\t\t}\n\n\t\treturn {\n\t\t\tspreads,\n\t\t\tpages\n\t\t};\n\n\t}\n\n\t/**\n\t * Update props that have changed\n\t * @private\n\t * @param  {object} props\n\t */\n\tupdate(props) {\n\t\t// Remove props that haven't changed\n\t\tObject.keys(props).forEach((propName) => {\n\t\t\tif (this.props[propName] === props[propName]) {\n\t\t\t\tdelete props[propName];\n\t\t\t}\n\t\t});\n\n\t\tif(Object.keys(props).length > 0) {\n\t\t\tlet newProps = extend(this.props, props);\n\t\t\tthis.emit(EVENTS.LAYOUT.UPDATED, newProps, props);\n\t\t}\n\t}\n}\n\nEventEmitter(Layout.prototype);\n\nexport default Layout;\n","import Url from \"./utils/url\";\n\n/**\n * Themes to apply to displayed content\n * @class\n * @param {Rendition} rendition\n */\nclass Themes {\n\tconstructor(rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis._themes = {\n\t\t\t\"default\" : {\n\t\t\t\t\"rules\" : {},\n\t\t\t\t\"url\" : \"\",\n\t\t\t\t\"serialized\" : \"\"\n\t\t\t}\n\t\t};\n\t\tthis._overrides = {};\n\t\tthis._current = \"default\";\n\t\tthis._injected = [];\n\t\tthis.rendition.hooks.content.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.content.register(this.overrides.bind(this));\n\n\t}\n\n\t/**\n\t * Add themes to be used by a rendition\n\t * @param {object | Array<object> | string}\n\t * @example themes.register(\"light\", \"http://example.com/light.css\")\n\t * @example themes.register(\"light\", { \"body\": { \"color\": \"purple\"}})\n\t * @example themes.register({ \"light\" : {...}, \"dark\" : {...}})\n\t */\n\tregister () {\n\t\tif (arguments.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"object\") {\n\t\t\treturn this.registerThemes(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"string\") {\n\t\t\treturn this.default(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"string\") {\n\t\t\treturn this.registerUrl(arguments[0], arguments[1]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"object\") {\n\t\t\treturn this.registerRules(arguments[0], arguments[1]);\n\t\t}\n\t}\n\n\t/**\n\t * Add a default theme to be used by a rendition\n\t * @param {object | string} theme\n\t * @example themes.register(\"http://example.com/default.css\")\n\t * @example themes.register({ \"body\": { \"color\": \"purple\"}})\n\t */\n\tdefault (theme) {\n\t\tif (!theme) {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof(theme) === \"string\") {\n\t\t\treturn this.registerUrl(\"default\", theme);\n\t\t}\n\t\tif (typeof(theme) === \"object\") {\n\t\t\treturn this.registerRules(\"default\", theme);\n\t\t}\n\t}\n\n\t/**\n\t * Register themes object\n\t * @param {object} themes\n\t */\n\tregisterThemes (themes) {\n\t\tfor (var theme in themes) {\n\t\t\tif (themes.hasOwnProperty(theme)) {\n\t\t\t\tif (typeof(themes[theme]) === \"string\") {\n\t\t\t\t\tthis.registerUrl(theme, themes[theme]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.registerRules(theme, themes[theme]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Register a url\n\t * @param {string} name\n\t * @param {string} input\n\t */\n\tregisterUrl (name, input) {\n\t\tvar url = new Url(input);\n\t\tthis._themes[name] = { \"url\": url.toString() };\n\t\tif (this._injected[name]) {\n\t\t\tthis.update(name);\n\t\t}\n\t}\n\n\t/**\n\t * Register rule\n\t * @param {string} name\n\t * @param {object} rules\n\t */\n\tregisterRules (name, rules) {\n\t\tthis._themes[name] = { \"rules\": rules };\n\t\t// TODO: serialize css rules\n\t\tif (this._injected[name]) {\n\t\t\tthis.update(name);\n\t\t}\n\t}\n\n\t/**\n\t * Select a theme\n\t * @param {string} name\n\t */\n\tselect (name) {\n\t\tvar prev = this._current;\n\t\tvar contents;\n\n\t\tthis._current = name;\n\t\tthis.update(name);\n\n\t\tcontents = this.rendition.getContents();\n\t\tcontents.forEach( (content) => {\n\t\t\tcontent.removeClass(prev);\n\t\t\tcontent.addClass(name);\n\t\t});\n\t}\n\n\t/**\n\t * Update a theme\n\t * @param {string} name\n\t */\n\tupdate (name) {\n\t\tvar contents = this.rendition.getContents();\n\t\tcontents.forEach( (content) => {\n\t\t\tthis.add(name, content);\n\t\t});\n\t}\n\n\t/**\n\t * Inject all themes into contents\n\t * @param {Contents} contents\n\t */\n\tinject (contents) {\n\t\tvar links = [];\n\t\tvar themes = this._themes;\n\t\tvar theme;\n\n\t\tfor (var name in themes) {\n\t\t\tif (themes.hasOwnProperty(name) && (name === this._current || name === \"default\")) {\n\t\t\t\ttheme = themes[name];\n\t\t\t\tif((theme.rules && Object.keys(theme.rules).length > 0) || (theme.url && links.indexOf(theme.url) === -1)) {\n\t\t\t\t\tthis.add(name, contents);\n\t\t\t\t}\n\t\t\t\tthis._injected.push(name);\n\t\t\t}\n\t\t}\n\n\t\tif(this._current != \"default\") {\n\t\t\tcontents.addClass(this._current);\n\t\t}\n\t}\n\n\t/**\n\t * Add Theme to contents\n\t * @param {string} name\n\t * @param {Contents} contents\n\t */\n\tadd (name, contents) {\n\t\tvar theme = this._themes[name];\n\n\t\tif (!theme || !contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (theme.url) {\n\t\t\tcontents.addStylesheet(theme.url);\n\t\t} else if (theme.serialized) {\n\t\t\t// TODO: handle serialized\n\t\t} else if (theme.rules) {\n\t\t\tcontents.addStylesheetRules(theme.rules);\n\t\t\ttheme.injected = true;\n\t\t}\n\t}\n\n\t/**\n\t * Add override\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {boolean} priority\n\t */\n\toverride (name, value, priority) {\n\t\tvar contents = this.rendition.getContents();\n\n\t\tthis._overrides[name] = {\n\t\t\tvalue: value,\n\t\t\tpriority: priority === true\n\t\t};\n\n\t\tcontents.forEach( (content) => {\n\t\t\tcontent.css(name, this._overrides[name].value, this._overrides[name].priority);\n\t\t});\n\t}\n\n\t/**\n\t * Add all overrides\n\t * @param {Content} content\n\t */\n\toverrides (contents) {\n\t\tvar overrides = this._overrides;\n\n\t\tfor (var rule in overrides) {\n\t\t\tif (overrides.hasOwnProperty(rule)) {\n\t\t\t\tcontents.css(rule, overrides[rule].value, overrides[rule].priority);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the font size of a rendition\n\t * @param {number} size\n\t */\n\tfontSize (size) {\n\t\tthis.override(\"font-size\", size);\n\t}\n\n\t/**\n\t * Adjust the font-family of a rendition\n\t * @param {string} f\n\t */\n\tfont (f) {\n\t\tthis.override(\"font-family\", f, true);\n\t}\n\n\tdestroy() {\n\t\tthis.rendition = undefined;\n\t\tthis._themes = undefined;\n\t\tthis._overrides = undefined;\n\t\tthis._current = undefined;\n\t\tthis._injected = undefined;\n\t}\n\n}\n\nexport default Themes;\n","import EpubCFI from \"./epubcfi\";\nimport { nodeBounds } from \"./utils/core\";\n\n/**\n * Map text locations to CFI ranges\n * @class\n * @param {Layout} layout Layout to apply\n * @param {string} [direction=\"ltr\"] Text direction\n * @param {string} [axis=\"horizontal\"] vertical or horizontal axis\n * @param {boolean} [dev] toggle developer highlighting\n */\nclass Mapping {\n\tconstructor(layout, direction, axis, dev) {\n\t\tthis.layout = layout;\n\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\n\t\tthis.direction = direction || \"ltr\";\n\t\tthis._dev = dev;\n\t}\n\n\t/**\n\t * Find CFI pairs for entire section at once\n\t */\n\tsection(view) {\n\t\tvar ranges = this.findRanges(view);\n\t\tvar map = this.rangeListToCfiList(view.section.cfiBase, ranges);\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Find CFI pairs for a page\n\t * @param {Contents} contents Contents from view\n\t * @param {string} cfiBase string of the base for a cfi\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t */\n\tpage(contents, cfiBase, start, end) {\n\t\tvar root = contents && contents.document ? contents.document.body : false;\n\t\tvar result;\n\n\t\tif (!root) {\n\t\t\treturn;\n\t\t}\n\n\t\tresult = this.rangePairToCfiPair(cfiBase, {\n\t\t\tstart: this.findStart(root, start, end),\n\t\t\tend: this.findEnd(root, start, end)\n\t\t});\n\n\t\tif (this._dev === true) {\n\t\t\tlet doc = contents.document;\n\t\t\tlet startRange = new EpubCFI(result.start).toRange(doc);\n\t\t\tlet endRange = new EpubCFI(result.end).toRange(doc);\n\n\t\t\tlet selection = doc.defaultView.getSelection();\n\t\t\tlet r = doc.createRange();\n\t\t\tselection.removeAllRanges();\n\t\t\tr.setStart(startRange.startContainer, startRange.startOffset);\n\t\t\tr.setEnd(endRange.endContainer, endRange.endOffset);\n\t\t\tselection.addRange(r);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Walk a node, preforming a function on each node it finds\n\t * @private\n\t * @param {Node} root Node to walkToNode\n\t * @param {function} func walk function\n\t * @return {*} returns the result of the walk function\n\t */\n\twalk(root, func) {\n\t\t// IE11 has strange issue, if root is text node IE throws exception on\n\t\t// calling treeWalker.nextNode(), saying\n\t\t// Unexpected call to method or property access instead of returing null value\n\t\tif(root && root.nodeType === Node.TEXT_NODE) {\n\t\t\treturn;\n\t\t}\n\t\t// safeFilter is required so that it can work in IE as filter is a function for IE\n\t\t// and for other browser filter is an object.\n\t\tvar filter = {\n\t\t\tacceptNode: function(node) {\n\t\t\t\tif (node.data.trim().length > 0) {\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\n\t\t\t\t} else {\n\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tvar safeFilter = filter.acceptNode;\n\t\tsafeFilter.acceptNode = filter.acceptNode;\n\n\t\tvar treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, safeFilter, false);\n\t\tvar node;\n\t\tvar result;\n\t\twhile ((node = treeWalker.nextNode())) {\n\t\t\tresult = func(node);\n\t\t\tif(result) break;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfindRanges(view){\n\t\tvar columns = [];\n\t\tvar scrollWidth = view.contents.scrollWidth();\n\t\tvar spreads = Math.ceil( scrollWidth / this.layout.spreadWidth);\n\t\tvar count = spreads * this.layout.divisor;\n\t\tvar columnWidth = this.layout.columnWidth;\n\t\tvar gap = this.layout.gap;\n\t\tvar start, end;\n\n\t\tfor (var i = 0; i < count.pages; i++) {\n\t\t\tstart = (columnWidth + gap) * i;\n\t\t\tend = (columnWidth * (i+1)) + (gap * i);\n\t\t\tcolumns.push({\n\t\t\t\tstart: this.findStart(view.document.body, start, end),\n\t\t\t\tend: this.findEnd(view.document.body, start, end)\n\t\t\t});\n\t\t}\n\n\t\treturn columns;\n\t}\n\n\t/**\n\t * Find Start Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindStart(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar found;\n\t\tvar $prev = root;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, (node) => {\n\t\t\t\tvar left, right, top, bottom;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\n\t\t\t\telPos = nodeBounds(node);\n\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\t\tleft = this.horizontal ? elPos.left : elPos.top;\n\t\t\t\t\tright = this.horizontal ? elPos.right : elPos.bottom;\n\n\t\t\t\t\tif( left >= start && left <= end ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (right > start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\t\tleft = elPos.left;\n\t\t\t\t\tright = elPos.right;\n\n\t\t\t\t\tif( right <= end && right >= start ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (left < end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttop = elPos.top;\n\t\t\t\t\tbottom = elPos.bottom;\n\n\t\t\t\t\tif( top >= start && top <= end ) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else if (bottom > start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\n\t\t\t});\n\n\t\t\tif(found) {\n\t\t\t\treturn this.findTextStartRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// Return last element\n\t\treturn this.findTextStartRange($prev, start, end);\n\t}\n\n\t/**\n\t * Find End Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindEnd(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar $prev = root;\n\t\tvar found;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, (node) => {\n\n\t\t\t\tvar left, right, top, bottom;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\t\t\t\telPos = nodeBounds(node);\n\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\t\tleft = Math.round(elPos.left);\n\t\t\t\t\tright = Math.round(elPos.right);\n\n\t\t\t\t\tif(left > end && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(right > end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\t\tleft = Math.round(this.horizontal ? elPos.left : elPos.top);\n\t\t\t\t\tright = Math.round(this.horizontal ? elPos.right : elPos.bottom);\n\n\t\t\t\t\tif(right < start && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(left < start) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttop = Math.round(elPos.top);\n\t\t\t\t\tbottom = Math.round(elPos.bottom);\n\n\t\t\t\t\tif(top > end && $prev) {\n\t\t\t\t\t\treturn $prev;\n\t\t\t\t\t} else if(bottom > end) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$prev = node;\n\t\t\t\t\t\tstack.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t});\n\n\n\t\t\tif(found){\n\t\t\t\treturn this.findTextEndRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// end of chapter\n\t\treturn this.findTextEndRange($prev, start, end);\n\t}\n\n\t/**\n\t * Find Text Start Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindTextStartRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar range;\n\t\tvar pos;\n\t\tvar left, top, right;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\tleft = pos.left;\n\t\t\t\tif( left >= start ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\tright = pos.right;\n\t\t\t\tif( right <= end ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\ttop = pos.top;\n\t\t\t\tif( top >= start ) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// prev = range;\n\n\t\t}\n\n\t\treturn ranges[0];\n\t}\n\n\t/**\n\t * Find Text End Range\n\t * @private\n\t * @param {Node} root root node\n\t * @param {number} start position to start at\n\t * @param {number} end position to end at\n\t * @return {Range}\n\t */\n\tfindTextEndRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar prev;\n\t\tvar range;\n\t\tvar pos;\n\t\tvar left, right, top, bottom;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\n\n\t\t\t\tleft = pos.left;\n\t\t\t\tright = pos.right;\n\n\t\t\t\tif(left > end && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(right > end) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\n\n\t\t\t\tleft = pos.left\n\t\t\t\tright = pos.right;\n\n\t\t\t\tif(right < start && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(left < start) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\ttop = pos.top;\n\t\t\t\tbottom = pos.bottom;\n\n\t\t\t\tif(top > end && prev) {\n\t\t\t\t\treturn prev;\n\t\t\t\t} else if(bottom > end) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t}\n\n\n\t\t\tprev = range;\n\n\t\t}\n\n\t\t// Ends before limit\n\t\treturn ranges[ranges.length-1];\n\n\t}\n\n\t/**\n\t * Split up a text node into ranges for each word\n\t * @private\n\t * @param {Node} root root node\n\t * @param {string} [_splitter] what to split on\n\t * @return {Range[]}\n\t */\n\tsplitTextNodeIntoRanges(node, _splitter){\n\t\tvar ranges = [];\n\t\tvar textContent = node.textContent || \"\";\n\t\tvar text = textContent.trim();\n\t\tvar range;\n\t\tvar doc = node.ownerDocument;\n\t\tvar splitter = _splitter || \" \";\n\n\t\tvar pos = text.indexOf(splitter);\n\n\t\tif(pos === -1 || node.nodeType != Node.TEXT_NODE) {\n\t\t\trange = doc.createRange();\n\t\t\trange.selectNodeContents(node);\n\t\t\treturn [range];\n\t\t}\n\n\t\trange = doc.createRange();\n\t\trange.setStart(node, 0);\n\t\trange.setEnd(node, pos);\n\t\tranges.push(range);\n\t\trange = false;\n\n\t\twhile ( pos != -1 ) {\n\n\t\t\tpos = text.indexOf(splitter, pos + 1);\n\t\t\tif(pos > 0) {\n\n\t\t\t\tif(range) {\n\t\t\t\t\trange.setEnd(node, pos);\n\t\t\t\t\tranges.push(range);\n\t\t\t\t}\n\n\t\t\t\trange = doc.createRange();\n\t\t\t\trange.setStart(node, pos+1);\n\t\t\t}\n\t\t}\n\n\t\tif(range) {\n\t\t\trange.setEnd(node, text.length);\n\t\t\tranges.push(range);\n\t\t}\n\n\t\treturn ranges;\n\t}\n\n\n\t/**\n\t * Turn a pair of ranges into a pair of CFIs\n\t * @private\n\t * @param {string} cfiBase base string for an EpubCFI\n\t * @param {object} rangePair { start: Range, end: Range }\n\t * @return {object} { start: \"epubcfi(...)\", end: \"epubcfi(...)\" }\n\t */\n\trangePairToCfiPair(cfiBase, rangePair){\n\n\t\tvar startRange = rangePair.start;\n\t\tvar endRange = rangePair.end;\n\n\t\tstartRange.collapse(true);\n\t\tendRange.collapse(false);\n\n\t\tlet startCfi = new EpubCFI(startRange, cfiBase).toString();\n\t\tlet endCfi = new EpubCFI(endRange, cfiBase).toString();\n\n\t\treturn {\n\t\t\tstart: startCfi,\n\t\t\tend: endCfi\n\t\t};\n\n\t}\n\n\trangeListToCfiList(cfiBase, columns){\n\t\tvar map = [];\n\t\tvar cifPair;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tcifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\n\n\t\t\tmap.push(cifPair);\n\n\t\t}\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Set the axis for mapping\n\t * @param {string} axis horizontal | vertical\n\t * @return {boolean} is it horizontal?\n\t */\n\taxis(axis) {\n\t\tif (axis) {\n\t\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\n\t\t}\n\t\treturn this.horizontal;\n\t}\n}\n\nexport default Mapping;\n","import EventEmitter from \"event-emitter\";\nimport {isNumber, prefixed, borders, defaults} from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport {replaceLinks} from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\nconst hasNavigator = typeof (navigator) !== \"undefined\";\n\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nclass Contents {\n\tconstructor(doc, content, cfiBase, sectionIndex) {\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.document = doc;\n\t\tthis.documentElement =  this.document.documentElement;\n\t\tthis.content = content || this.document.body;\n\t\tthis.window = this.document.defaultView;\n\n\t\tthis._size = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\tthis.sectionIndex = sectionIndex || 0;\n\t\tthis.cfiBase = cfiBase || \"\";\n\n\t\tthis.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n\n\t\tthis.listeners();\n\t}\n\n\t/**\n\t\t* Get DOM events that are listened for and passed along\n\t\t*/\n\tstatic get listenedEvents() {\n\t\treturn DOM_EVENTS;\n\t}\n\n\t/**\n\t\t* Get or Set width\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\twidth(w) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tframe.style.width = w;\n\t\t\t// this.content.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)[\"width\"];\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\theight(h) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tframe.style.height = h;\n\t\t\t// this.content.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)[\"height\"];\n\n\t}\n\n\t/**\n\t\t* Get or Set width of the contents\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\tcontentWidth(w) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tcontent.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[\"width\"];\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height of the contents\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\tcontentHeight(h) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tcontent.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[\"height\"];\n\n\t}\n\n\t/**\n\t\t* Get the width of the text using Range\n\t\t* @returns {number} width\n\t\t*/\n\ttextWidth() {\n\t\tlet rect;\n\t\tlet width;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\t// Select the contents of frame\n\t\trange.selectNodeContents(content);\n\n\t\t// get the width of the text content\n\t\trect = range.getBoundingClientRect();\n\t\twidth = rect.width;\n\n\t\tif (border && border.width) {\n\t\t\twidth += border.width;\n\t\t}\n\n\t\treturn Math.round(width);\n\t}\n\n\t/**\n\t\t* Get the height of the text using Range\n\t\t* @returns {number} height\n\t\t*/\n\ttextHeight() {\n\t\tlet rect;\n\t\tlet height;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\trange.selectNodeContents(content);\n\n\t\trect = range.getBoundingClientRect();\n\t\theight = rect.height;\n\n\t\tif (height && border.height) {\n\t\t\theight += border.height;\n\t\t}\n\n\t\tif (height && rect.top) {\n\t\t\theight += rect.top;\n\t\t}\n\n\t\treturn Math.round(height);\n\t}\n\n\t/**\n\t\t* Get documentElement scrollWidth\n\t\t* @returns {number} width\n\t\t*/\n\tscrollWidth() {\n\t\tvar width = this.documentElement.scrollWidth;\n\n\t\treturn width;\n\t}\n\n\t/**\n\t\t* Get documentElement scrollHeight\n\t\t* @returns {number} height\n\t\t*/\n\tscrollHeight() {\n\t\tvar height = this.documentElement.scrollHeight;\n\n\t\treturn height;\n\t}\n\n\t/**\n\t\t* Set overflow css style of the contents\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflow(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflow = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n\t}\n\n\t/**\n\t\t* Set overflowX css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowX(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowX = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n\t}\n\n\t/**\n\t\t* Set overflowY css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowY(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowY = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n\t}\n\n\t/**\n\t\t* Set Css styles on the contents element (typically Body)\n\t\t* @param {string} property\n\t\t* @param {string} value\n\t\t* @param {boolean} [priority] set as \"important\"\n\t\t*/\n\tcss(property, value, priority) {\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (value) {\n\t\t\tcontent.style.setProperty(property, value, priority ? \"important\" : \"\");\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[property];\n\t}\n\n\t/**\n\t\t* Get or Set the viewport element\n\t\t* @param {object} [options]\n\t\t* @param {string} [options.width]\n\t\t* @param {string} [options.height]\n\t\t* @param {string} [options.scale]\n\t\t* @param {string} [options.minimum]\n\t\t* @param {string} [options.maximum]\n\t\t* @param {string} [options.scalable]\n\t\t*/\n\tviewport(options) {\n\t\tvar _width, _height, _scale, _minimum, _maximum, _scalable;\n\t\t// var width, height, scale, minimum, maximum, scalable;\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar parsed = {\n\t\t\t\"width\": undefined,\n\t\t\t\"height\": undefined,\n\t\t\t\"scale\": undefined,\n\t\t\t\"minimum\": undefined,\n\t\t\t\"maximum\": undefined,\n\t\t\t\"scalable\": undefined\n\t\t};\n\t\tvar newContent = [];\n\t\tvar settings = {};\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tlet content = $viewport.getAttribute(\"content\");\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\n\t\t\t\tparsed.width = _width[1];\n\t\t\t}\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\n\t\t\t\tparsed.height = _height[1];\n\t\t\t}\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\n\t\t\t\tparsed.scale = _scale[1];\n\t\t\t}\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\n\t\t\t\tparsed.minimum = _minimum[1];\n\t\t\t}\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\n\t\t\t\tparsed.maximum = _maximum[1];\n\t\t\t}\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\n\t\t\t\tparsed.scalable = _scalable[1];\n\t\t\t}\n\t\t}\n\n\t\tsettings = defaults(options || {}, parsed);\n\n\t\tif (options) {\n\t\t\tif (settings.width) {\n\t\t\t\tnewContent.push(\"width=\" + settings.width);\n\t\t\t}\n\n\t\t\tif (settings.height) {\n\t\t\t\tnewContent.push(\"height=\" + settings.height);\n\t\t\t}\n\n\t\t\tif (settings.scale) {\n\t\t\t\tnewContent.push(\"initial-scale=\" + settings.scale);\n\t\t\t}\n\n\t\t\tif (settings.scalable === \"no\") {\n\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"maximum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t} else {\n\n\t\t\t\tif (settings.scalable) {\n\t\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t\t}\n\n\t\t\t\tif (settings.minimum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.minimum);\n\t\t\t\t}\n\n\t\t\t\tif (settings.maximum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.maximum);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!$viewport) {\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\n\t\t\t\tthis.document.querySelector(\"head\").appendChild($viewport);\n\t\t\t}\n\n\t\t\t$viewport.setAttribute(\"content\", newContent.join(\", \"));\n\n\t\t\tthis.window.scrollTo(0, 0);\n\t\t}\n\n\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Event emitter for when the contents has expanded\n\t * @private\n\t */\n\texpand() {\n\t\tthis.emit(EVENTS.CONTENTS.EXPAND);\n\t}\n\n\t/**\n\t * Add DOM listeners\n\t * @private\n\t */\n\tlisteners() {\n\n\t\tthis.imageLoadListeners();\n\n\t\tthis.mediaQueryListeners();\n\n\t\t// this.fontLoadListeners();\n\n\t\tthis.addEventListeners();\n\n\t\tthis.addSelectionListeners();\n\n\t\t// this.transitionListeners();\n\n\t\tthis.resizeListeners();\n\n\t\t// this.resizeObservers();\n\n\t\tthis.linksHandler();\n\t}\n\n\t/**\n\t * Remove DOM listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.removeSelectionListeners();\n\n\t\tclearTimeout(this.expanding);\n\t}\n\n\t/**\n\t * Check if size of contents has changed and\n\t * emit 'resize' event if it has.\n\t * @private\n\t */\n\tresizeCheck() {\n\t\tlet width = this.textWidth();\n\t\tlet height = this.textHeight();\n\n\t\tif (width != this._size.width || height != this._size.height) {\n\n\t\t\tthis._size = {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\n\t\t\tthis.onResize && this.onResize(this._size);\n\t\t\tthis.emit(EVENTS.CONTENTS.RESIZE, this._size);\n\t\t}\n\t}\n\n\t/**\n\t * Poll for resize detection\n\t * @private\n\t */\n\tresizeListeners() {\n\t\tvar width, height;\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\n\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n\t}\n\n\t/**\n\t * Use css transitions to detect resize\n\t * @private\n\t */\n\ttransitionListeners() {\n\t\tlet body = this.content;\n\n\t\tbody.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n\t\tbody.style['transitionDuration'] = \"0.001ms\";\n\t\tbody.style['transitionTimingFunction'] = \"linear\";\n\t\tbody.style['transitionDelay'] = \"0\";\n\n\t\tthis._resizeCheck = this.resizeCheck.bind(this);\n\t\tthis.document.addEventListener('transitionend', this._resizeCheck);\n\t}\n\n\t/**\n\t * Listen for media query changes and emit 'expand' event\n\t * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n\t * @private\n\t */\n\tmediaQueryListeners() {\n\t\tvar sheets = this.document.styleSheets;\n\t\tvar mediaChangeHandler = function(m){\n\t\t\tif(m.matches && !this._expanding) {\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\n\t\t\tvar rules;\n\t\t\t// Firefox errors if we access cssRules cross-domain\n\t\t\ttry {\n\t\t\t\trules = sheets[i].cssRules;\n\t\t\t} catch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(!rules) return; // Stylesheets changed\n\t\t\tfor (var j = 0; j < rules.length; j += 1) {\n\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\n\t\t\t\tif(rules[j].media){\n\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\n\t\t\t\t\tmql.addListener(mediaChangeHandler);\n\t\t\t\t\t//mql.onchange = mediaChangeHandler;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Use MutationObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tresizeObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new MutationObserver((mutations) => {\n\t\t\tthis.resizeCheck();\n\t\t});\n\n\t\t// configuration of the observer:\n\t\tlet config = { attributes: true, childList: true, characterData: true, subtree: true };\n\n\t\t// pass in the target node, as well as the observer options\n\t\tthis.observer.observe(this.document, config);\n\t}\n\n\t/**\n\t * Test if images are loaded or add listener for when they load\n\t * @private\n\t */\n\timageLoadListeners() {\n\t\tvar images = this.document.querySelectorAll(\"img\");\n\t\tvar img;\n\t\tfor (var i = 0; i < images.length; i++) {\n\t\t\timg = images[i];\n\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\n\t\t\t\t\timg.naturalWidth === 0) {\n\t\t\t\timg.onload = this.expand.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Listen for font load and check for resize when loaded\n\t * @private\n\t */\n\tfontLoadListeners() {\n\t\tif (!this.document || !this.document.fonts) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.document.fonts.ready.then(function () {\n\t\t\tthis.resizeCheck();\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Get the documentElement\n\t * @returns {element} documentElement\n\t */\n\troot() {\n\t\tif(!this.document) return null;\n\t\treturn this.document.documentElement;\n\t}\n\n\t/**\n\t * Get the location offset of a EpubCFI or an #id\n\t * @param {string | EpubCFI} target\n\t * @param {string} [ignoreClass] for the cfi\n\t * @returns { {left: Number, top: Number }\n\t */\n\tlocationOf(target, ignoreClass) {\n\t\tvar position;\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\n\n\t\tif(!this.document) return targetPos;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\tlet range = new EpubCFI(target).toRange(this.document, ignoreClass);\n\n\t\t\tif(range) {\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t} else {\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\n\n\t\t\t\t\t// Construct a new non-collapsed range\n\t\t\t\t\tif (isWebkit) {\n\t\t\t\t\t\tlet container = range.startContainer;\n\t\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (container.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\t\t\tposition = container.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset + 2 < container.length) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset + 2);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset - 2 > 0) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset - 2);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else { // empty, return the parent element\n\t\t\t\t\t\t\t\tposition = container.parentNode.getBoundingClientRect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if(typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\n\t\t\tlet id = target.substring(target.indexOf(\"#\")+1);\n\t\t\tlet el = this.document.getElementById(id);\n\n\t\t\tif(el) {\n\t\t\t\tposition = el.getBoundingClientRect();\n\t\t\t}\n\t\t}\n\n\t\tif (position) {\n\t\t\ttargetPos.left = position.left;\n\t\t\ttargetPos.top = position.top;\n\t\t}\n\n\t\treturn targetPos;\n\t}\n\n\t/**\n\t * Append a stylesheet link to the document head\n\t * @param {string} src url\n\t */\n\taddStylesheet(src) {\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $stylesheet;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if link already exists\n\t\t\t$stylesheet = this.document.querySelector(\"link[href='\"+src+\"']\");\n\t\t\tif ($stylesheet) {\n\t\t\t\tresolve(true);\n\t\t\t\treturn; // already present\n\t\t\t}\n\n\t\t\t$stylesheet = this.document.createElement(\"link\");\n\t\t\t$stylesheet.type = \"text/css\";\n\t\t\t$stylesheet.rel = \"stylesheet\";\n\t\t\t$stylesheet.href = src;\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\t// Let apply\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($stylesheet);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Append stylesheet rules to a generate stylesheet\n\t * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n\t * Object: https://github.com/desirable-objects/json-to-css\n\t * @param {array | object} rules\n\t */\n\taddStylesheetRules(rules) {\n\t\tvar styleEl;\n\t\tvar styleSheet;\n\t\tvar key = \"epubjs-inserted-css\";\n\n\t\tif(!this.document || !rules || rules.length === 0) return;\n\n\t\t// Check if link already exists\n\t\tstyleEl = this.document.getElementById(\"#\"+key);\n\t\tif (!styleEl) {\n\t\t\tstyleEl = this.document.createElement(\"style\");\n\t\t\tstyleEl.id = key;\n\t\t}\n\n\t\t// Append style element to head\n\t\tthis.document.head.appendChild(styleEl);\n\n\t\t// Grab style sheet\n\t\tstyleSheet = styleEl.sheet;\n\n\t\tif (Object.prototype.toString.call(rules) === \"[object Array]\") {\n\t\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\n\t\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = \"\";\n\t\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\n\t\t\t\tif (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n\t\t\t\t\trule = rule[1];\n\t\t\t\t\tj = 0;\n\t\t\t\t}\n\n\t\t\t\tfor (var pl = rule.length; j < pl; j++) {\n\t\t\t\t\tvar prop = rule[j];\n\t\t\t\t\tpropStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n\t\t\t\t}\n\n\t\t\t\t// Insert CSS Rule\n\t\t\t\tstyleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n\t\t\t}\n\t\t} else {\n\t\t\tconst selectors = Object.keys(rules);\n\t\t\tselectors.forEach((selector) => {\n\t\t\t\tconst definition = rules[selector];\n\t\t\t\tif (Array.isArray(definition)) {\n\t\t\t\t\tdefinition.forEach((item) => {\n\t\t\t\t\t\tconst _rules = Object.keys(item);\n\t\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\t\treturn `${rule}:${item[rule]}`;\n\t\t\t\t\t\t}).join(';');\n\t\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst _rules = Object.keys(definition);\n\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\treturn `${rule}:${definition[rule]}`;\n\t\t\t\t\t}).join(';');\n\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Append a script tag to the document head\n\t * @param {string} src url\n\t * @returns {Promise} loaded\n\t */\n\taddScript(src) {\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $script;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$script = this.document.createElement(\"script\");\n\t\t\t$script.type = \"text/javascript\";\n\t\t\t$script.async = true;\n\t\t\t$script.src = src;\n\t\t\t$script.onload = $script.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($script);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Add a class to the contents container\n\t * @param {string} className\n\t */\n\taddClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.add(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Remove a class from the contents container\n\t * @param {string} removeClass\n\t */\n\tremoveClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.remove(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Add DOM event listeners\n\t * @private\n\t */\n\taddEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._triggerEvent = this.triggerEvent.bind(this);\n\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.addEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\n\t}\n\n\t/**\n\t * Remove DOM event listeners\n\t * @private\n\t */\n\tremoveEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.removeEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\t\tthis._triggerEvent = undefined;\n\t}\n\n\t/**\n\t * Emit passed browser events\n\t * @private\n\t */\n\ttriggerEvent(e){\n\t\tthis.emit(e.type, e);\n\t}\n\n\t/**\n\t * Add listener for text selection\n\t * @private\n\t */\n\taddSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectionChange = this.onSelectionChange.bind(this);\n\t\tthis.document.addEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t}\n\n\t/**\n\t * Remove listener for text selection\n\t * @private\n\t */\n\tremoveSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.removeEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t\tthis._onSelectionChange = undefined;\n\t}\n\n\t/**\n\t * Handle getting text on selection\n\t * @private\n\t */\n\tonSelectionChange(e){\n\t\tif (this.selectionEndTimeout) {\n\t\t\tclearTimeout(this.selectionEndTimeout);\n\t\t}\n\t\tthis.selectionEndTimeout = setTimeout(function() {\n\t\t\tvar selection = this.window.getSelection();\n\t\t\tthis.triggerSelectedEvent(selection);\n\t\t}.bind(this), 250);\n\t}\n\n\t/**\n\t * Emit event on text selection\n\t * @private\n\t */\n\ttriggerSelectedEvent(selection){\n\t\tvar range, cfirange;\n\n\t\tif (selection && selection.rangeCount > 0) {\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed) {\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get a Dom Range from EpubCFI\n\t * @param {EpubCFI} _cfi\n\t * @param {string} [ignoreClass]\n\t * @returns {Range} range\n\t */\n\trange(_cfi, ignoreClass){\n\t\tvar cfi = new EpubCFI(_cfi);\n\t\treturn cfi.toRange(this.document, ignoreClass);\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom Range\n\t * @param {Range} range\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromRange(range, ignoreClass){\n\t\treturn new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom node\n\t * @param {node} node\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromNode(node, ignoreClass){\n\t\treturn new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t// TODO: find where this is used - remove?\n\tmap(layout){\n\t\tvar map = new Mapping(layout);\n\t\treturn map.section();\n\t}\n\n\t/**\n\t * Size the contents to a given width and height\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tsize(width, height){\n\t\tvar viewport = { scale: 1.0, scalable: \"no\" };\n\n\t\tthis.layoutStyle(\"scrolling\");\n\n\t\tif (width >= 0) {\n\t\t\tthis.width(width);\n\t\t\tviewport.width = width;\n\t\t\tthis.css(\"padding\", \"0 \"+(width/12)+\"px\");\n\t\t}\n\n\t\tif (height >= 0) {\n\t\t\tthis.height(height);\n\t\t\tviewport.height = height;\n\t\t}\n\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\n\n\t\tthis.viewport(viewport);\n\t}\n\n\t/**\n\t * Apply columns to the contents for pagination\n\t * @param {number} width\n\t * @param {number} height\n\t * @param {number} columnWidth\n\t * @param {number} gap\n\t */\n\tcolumns(width, height, columnWidth, gap){\n\t\tlet COLUMN_AXIS = prefixed(\"column-axis\");\n\t\tlet COLUMN_GAP = prefixed(\"column-gap\");\n\t\tlet COLUMN_WIDTH = prefixed(\"column-width\");\n\t\tlet COLUMN_FILL = prefixed(\"column-fill\");\n\n\t\tlet writingMode = this.writingMode();\n\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// Fix body width issues if rtl is only set on body element\n\t\tif (this.content.dir === \"rtl\") {\n\t\t\tthis.direction(\"rtl\");\n\t\t}\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ width: width, height: height, scale: 1.0, scalable: \"no\" });\n\n\t\t// TODO: inline-block needs more testing\n\t\t// Fixes Safari column cut offs, but causes RTL issues\n\t\t// this.css(\"display\", \"inline-block\");\n\n\t\tthis.css(\"overflow-y\", \"hidden\");\n\t\tthis.css(\"margin\", \"0\", true);\n\n\t\tif (axis === \"vertical\") {\n\t\t\tthis.css(\"padding-top\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-bottom\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-left\", \"20px\");\n\t\t\tthis.css(\"padding-right\", \"20px\");\n\t\t} else {\n\t\t\tthis.css(\"padding-top\", \"20px\");\n\t\t\tthis.css(\"padding-bottom\", \"20px\");\n\t\t\tthis.css(\"padding-left\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-right\", (gap / 2) + \"px\", true);\n\t\t}\n\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\t\tthis.css(\"max-width\", \"inherit\");\n\n\t\tthis.css(COLUMN_AXIS, \"horizontal\");\n\t\tthis.css(COLUMN_FILL, \"auto\");\n\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\n\t}\n\n\t/**\n\t * Scale contents from center\n\t * @param {number} scale\n\t * @param {number} offsetX\n\t * @param {number} offsetY\n\t */\n\tscaler(scale, offsetX, offsetY){\n\t\tvar scaleStr = \"scale(\" + scale + \")\";\n\t\tvar translateStr = \"\";\n\t\t// this.css(\"position\", \"absolute\"));\n\t\tthis.css(\"transform-origin\", \"top left\");\n\n\t\tif (offsetX >= 0 || offsetY >= 0) {\n\t\t\ttranslateStr = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\n\t\t}\n\n\t\tthis.css(\"transform\", scaleStr + translateStr);\n\t}\n\n\t/**\n\t * Fit contents into a fixed width and height\n\t * @param {number} width\n\t * @param {number} height\n\t */\n\tfit(width, height){\n\t\tvar viewport = this.viewport();\n\t\tvar widthScale = width / parseInt(viewport.width);\n\t\tvar heightScale = height / parseInt(viewport.height);\n\t\tvar scale = widthScale < heightScale ? widthScale : heightScale;\n\n\t\tvar offsetY = (height - (viewport.height * scale)) / 2;\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\t\tthis.overflow(\"hidden\");\n\n\t\t// Scale to the correct size\n\t\tthis.scaler(scale, 0, offsetY);\n\n\t\tthis.css(\"background-color\", \"transparent\");\n\t}\n\n\t/**\n\t * Set the direction of the text\n\t * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n\t */\n\tdirection(dir) {\n\t\tif (this.documentElement) {\n\t\t\tthis.documentElement.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\tmapPage(cfiBase, layout, start, end, dev) {\n\t\tvar mapping = new Mapping(layout, dev);\n\n\t\treturn mapping.page(this, cfiBase, start, end);\n\t}\n\n\t/**\n\t * Emit event when link in content is clicked\n\t * @private\n\t */\n\tlinksHandler() {\n\t\treplaceLinks(this.content, (href) => {\n\t\t\tthis.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n\t\t});\n\t}\n\n\t/**\n\t * Set the writingMode of the text\n\t * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n\t */\n\twritingMode(mode) {\n\t\tlet WRITING_MODE = prefixed(\"writing-mode\");\n\n\t\tif (mode && this.documentElement) {\n\t\t\tthis.documentElement.style[WRITING_MODE] = mode;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n\t}\n\n\t/**\n\t * Set the layoutStyle of the content\n\t * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n\t * @private\n\t */\n\tlayoutStyle(style) {\n\n\t\tif (style) {\n\t\t\tthis._layoutStyle = style;\n\t\t\tnavigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n\t\t}\n\n\t\treturn this._layoutStyle || \"paginated\";\n\t}\n\n\t/**\n\t * Add the epubReadingSystem object to the navigator\n\t * @param {string} name\n\t * @param {string} version\n\t * @private\n\t */\n\tepubReadingSystem(name, version) {\n\t\tnavigator.epubReadingSystem = {\n\t\t\tname: name,\n\t\t\tversion: version,\n\t\t\tlayoutStyle: this.layoutStyle(),\n\t\t\thasFeature: function (feature) {\n\t\t\t\tswitch (feature) {\n\t\t\t\t\tcase \"dom-manipulation\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"layout-changes\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"touch-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"mouse-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"keyboard-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"spine-scripting\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn navigator.epubReadingSystem;\n\t}\n\n\tdestroy() {\n\t\t// Stop observing\n\t\tif(this.observer) {\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tthis.document.removeEventListener('transitionend', this._resizeCheck);\n\n\t\tthis.removeListeners();\n\n\t}\n}\n\nEventEmitter(Contents.prototype);\n\nexport default Contents;\n","import EventEmitter from \"event-emitter\";\nimport EpubCFI from \"./epubcfi\";\n\n/**\n\t* Handles managing adding & removing Annotations\n\t* @param {Rendition} rendition\n\t* @class\n\t*/\nclass Annotations {\n\n\tconstructor (rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis.highlights = [];\n\t\tthis.underlines = [];\n\t\tthis.marks = [];\n\t\tthis._annotations = {};\n\t\tthis._annotationsBySectionIndex = {};\n\n\t\tthis.rendition.hooks.render.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.unloaded.register(this.clear.bind(this));\n\t}\n\n\t/**\n\t * Add an annotation to store\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} [cb] Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t * @returns {Annotation} annotation\n\t */\n\tadd (type, cfiRange, data, cb, className, styles) {\n\t\tlet hash = encodeURI(cfiRange);\n\t\tlet cfi = new EpubCFI(cfiRange);\n\t\tlet sectionIndex = cfi.spinePos;\n\t\tlet annotation = new Annotation({\n\t\t\ttype,\n\t\t\tcfiRange,\n\t\t\tdata,\n\t\t\tsectionIndex,\n\t\t\tcb,\n\t\t\tclassName,\n\t\t\tstyles\n\t\t});\n\n\t\tthis._annotations[hash] = annotation;\n\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tthis._annotationsBySectionIndex[sectionIndex].push(hash);\n\t\t} else {\n\t\t\tthis._annotationsBySectionIndex[sectionIndex] = [hash];\n\t\t}\n\n\t\tlet views = this.rendition.views();\n\n\t\tviews.forEach( (view) => {\n\t\t\tif (annotation.sectionIndex === view.index) {\n\t\t\t\tannotation.attach(view);\n\t\t\t}\n\t\t});\n\n\t\treturn annotation;\n\t}\n\n\t/**\n\t * Remove an annotation from store\n\t * @param {EpubCFI} cfiRange EpubCFI range the annotation is attached to\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n\t */\n\tremove (cfiRange, type) {\n\t\tlet hash = encodeURI(cfiRange);\n\n\t\tif (hash in this._annotations) {\n\t\t\tlet annotation = this._annotations[hash];\n\n\t\t\tif (type && annotation.type !== type) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet views = this.rendition.views();\n\t\t\tviews.forEach( (view) => {\n\t\t\t\tthis._removeFromAnnotationBySectionIndex(annotation.sectionIndex, hash);\n\t\t\t\tif (annotation.sectionIndex === view.index) {\n\t\t\t\t\tannotation.detach(view);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete this._annotations[hash];\n\t\t}\n\t}\n\n\t/**\n\t * Remove an annotations by Section Index\n\t * @private\n\t */\n\t_removeFromAnnotationBySectionIndex (sectionIndex, hash) {\n\t\tthis._annotationsBySectionIndex[sectionIndex] = this._annotationsAt(sectionIndex).filter(h => h !== hash);\n\t}\n\n\t/**\n\t * Get annotations by Section Index\n\t * @private\n\t */\n\t_annotationsAt (index) {\n\t\treturn this._annotationsBySectionIndex[index];\n\t}\n\n\n\t/**\n\t * Add a highlight to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t */\n\thighlight (cfiRange, data, cb, className, styles) {\n\t\tthis.add(\"highlight\", cfiRange, data, cb, className, styles);\n\t}\n\n\t/**\n\t * Add a underline to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t * @param {string} className CSS class to assign to annotation\n\t * @param {object} styles CSS styles to assign to annotation\n\t */\n\tunderline (cfiRange, data, cb, className, styles) {\n\t\tthis.add(\"underline\", cfiRange, data, cb, className, styles);\n\t}\n\n\t/**\n\t * Add a mark to the store\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n\t * @param {object} data Data to assign to annotation\n\t * @param {function} cb Callback after annotation is added\n\t */\n\tmark (cfiRange, data, cb) {\n\t\tthis.add(\"mark\", cfiRange, data, cb);\n\t}\n\n\t/**\n\t * iterate over annotations in the store\n\t */\n\teach () {\n\t\treturn this._annotations.forEach.apply(this._annotations, arguments);\n\t}\n\n\t/**\n\t * Hook for injecting annotation into a view\n\t * @param {View} view\n\t * @private\n\t */\n\tinject (view) {\n\t\tlet sectionIndex = view.index;\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\n\t\t\tannotations.forEach((hash) => {\n\t\t\t\tlet annotation = this._annotations[hash];\n\t\t\t\tannotation.attach(view);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook for removing annotation from a view\n\t * @param {View} view\n\t * @private\n\t */\n\tclear (view) {\n\t\tlet sectionIndex = view.index;\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\n\t\t\tannotations.forEach((hash) => {\n\t\t\t\tlet annotation = this._annotations[hash];\n\t\t\t\tannotation.detach(view);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * [Not Implemented] Show annotations\n\t * @TODO: needs implementation in View\n\t */\n\tshow () {\n\n\t}\n\n\t/**\n\t * [Not Implemented] Hide annotations\n\t * @TODO: needs implementation in View\n\t */\n\thide () {\n\n\t}\n\n}\n\n/**\n * Annotation object\n * @class\n * @param {object} options\n * @param {string} options.type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n * @param {EpubCFI} options.cfiRange EpubCFI range to attach annotation to\n * @param {object} options.data Data to assign to annotation\n * @param {int} options.sectionIndex Index in the Spine of the Section annotation belongs to\n * @param {function} [options.cb] Callback after annotation is added\n * @param {string} className CSS class to assign to annotation\n * @param {object} styles CSS styles to assign to annotation\n * @returns {Annotation} annotation\n */\nclass Annotation {\n\n\tconstructor ({\n\t\ttype,\n\t\tcfiRange,\n\t\tdata,\n\t\tsectionIndex,\n\t\tcb,\n\t\tclassName,\n\t\tstyles\n\t}) {\n\t\tthis.type = type;\n\t\tthis.cfiRange = cfiRange;\n\t\tthis.data = data;\n\t\tthis.sectionIndex = sectionIndex;\n\t\tthis.mark = undefined;\n\t\tthis.cb = cb;\n\t\tthis.className = className;\n\t\tthis.styles = styles;\n\t}\n\n\t/**\n\t * Update stored data\n\t * @param {object} data\n\t */\n\tupdate (data) {\n\t\tthis.data = data;\n\t}\n\n\t/**\n\t * Add to a view\n\t * @param {View} view\n\t */\n\tattach (view) {\n\t\tlet {cfiRange, data, type, mark, cb, className, styles} = this;\n\t\tlet result;\n\n\t\tif (type === \"highlight\") {\n\t\t\tresult = view.highlight(cfiRange, data, cb, className, styles);\n\t\t} else if (type === \"underline\") {\n\t\t\tresult = view.underline(cfiRange, data, cb, className, styles);\n\t\t} else if (type === \"mark\") {\n\t\t\tresult = view.mark(cfiRange, data, cb);\n\t\t}\n\n\t\tthis.mark = result;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Remove from a view\n\t * @param {View} view\n\t */\n\tdetach (view) {\n\t\tlet {cfiRange, type} = this;\n\t\tlet result;\n\n\t\tif (view) {\n\t\t\tif (type === \"highlight\") {\n\t\t\t\tresult = view.unhighlight(cfiRange);\n\t\t\t} else if (type === \"underline\") {\n\t\t\t\tresult = view.ununderline(cfiRange);\n\t\t\t} else if (type === \"mark\") {\n\t\t\t\tresult = view.unmark(cfiRange);\n\t\t\t}\n\t\t}\n\n\t\tthis.mark = undefined;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * [Not Implemented] Get text of an annotation\n\t * @TODO: needs implementation in contents\n\t */\n\ttext () {\n\n\t}\n\n}\n\nEventEmitter(Annotation.prototype);\n\n\nexport default Annotations\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.createElement = createElement;\nfunction createElement(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nexports.default = {\n    createElement: createElement\n};\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.proxyMouse = proxyMouse;\nexports.clone = clone;\n// import 'babelify/polyfill'; // needed for Object.assign\n\nexports.default = {\n    proxyMouse: proxyMouse\n};\n\n/**\n * Start proxying all mouse events that occur on the target node to each node in\n * a set of tracked nodes.\n *\n * The items in tracked do not strictly have to be DOM Nodes, but they do have\n * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.\n *\n * @param target {Node} The node on which to listen for mouse events.\n * @param tracked {Node[]} A (possibly mutable) array of nodes to which to proxy\n *                         events.\n */\n\nfunction proxyMouse(target, tracked) {\n    function dispatch(e) {\n        // We walk through the set of tracked elements in reverse order so that\n        // events are sent to those most recently added first.\n        //\n        // This is the least surprising behaviour as it simulates the way the\n        // browser would work if items added later were drawn \"on top of\"\n        // earlier ones.\n        for (var i = tracked.length - 1; i >= 0; i--) {\n            var t = tracked[i];\n            var x = e.clientX;\n            var y = e.clientY;\n\n            if (e.touches && e.touches.length) {\n                x = e.touches[0].clientX;\n                y = e.touches[0].clientY;\n            }\n\n            if (!contains(t, target, x, y)) {\n                continue;\n            }\n\n            // The event targets this mark, so dispatch a cloned event:\n            t.dispatchEvent(clone(e));\n            // We only dispatch the cloned event to the first matching mark.\n            break;\n        }\n    }\n\n    if (target.nodeName === \"iframe\" || target.nodeName === \"IFRAME\") {\n\n        try {\n            // Try to get the contents if same domain\n            this.target = target.contentDocument;\n        } catch (err) {\n            this.target = target;\n        }\n    } else {\n        this.target = target;\n    }\n\n    var _arr = ['mouseup', 'mousedown', 'click', 'touchstart'];\n    for (var _i = 0; _i < _arr.length; _i++) {\n        var ev = _arr[_i];\n        this.target.addEventListener(ev, function (e) {\n            return dispatch(e);\n        }, false);\n    }\n}\n\n/**\n * Clone a mouse event object.\n *\n * @param e {MouseEvent} A mouse event object to clone.\n * @returns {MouseEvent}\n */\nfunction clone(e) {\n    var opts = Object.assign({}, e, { bubbles: false });\n    try {\n        return new MouseEvent(e.type, opts);\n    } catch (err) {\n        // compat: webkit\n        var copy = document.createEvent('MouseEvents');\n        copy.initMouseEvent(e.type, false, opts.cancelable, opts.view, opts.detail, opts.screenX, opts.screenY, opts.clientX, opts.clientY, opts.ctrlKey, opts.altKey, opts.shiftKey, opts.metaKey, opts.button, opts.relatedTarget);\n        return copy;\n    }\n}\n\n/**\n * Check if the item contains the point denoted by the passed coordinates\n * @param item {Object} An object with getBoundingClientRect and getClientRects\n *                      methods.\n * @param x {Number}\n * @param y {Number}\n * @returns {Boolean}\n */\nfunction contains(item, target, x, y) {\n    // offset\n    var offset = target.getBoundingClientRect();\n\n    function rectContains(r, x, y) {\n        var top = r.top - offset.top;\n        var left = r.left - offset.left;\n        var bottom = top + r.height;\n        var right = left + r.width;\n        return top <= y && left <= x && bottom > y && right > x;\n    }\n\n    // Check overall bounding box first\n    var rect = item.getBoundingClientRect();\n    if (!rectContains(rect, x, y)) {\n        return false;\n    }\n\n    // Then continue to check each child rect\n    var rects = item.getClientRects();\n    for (var i = 0, len = rects.length; i < len; i++) {\n        if (rectContains(rects[i], x, y)) {\n            return true;\n        }\n    }\n    return false;\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Underline = exports.Highlight = exports.Mark = exports.Pane = undefined;\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _svg = require('./svg');\n\nvar _svg2 = _interopRequireDefault(_svg);\n\nvar _events = require('./events');\n\nvar _events2 = _interopRequireDefault(_events);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Pane = exports.Pane = function () {\n    function Pane(target) {\n        var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n\n        _classCallCheck(this, Pane);\n\n        this.target = target;\n        this.element = _svg2.default.createElement('svg');\n        this.marks = [];\n\n        // Match the coordinates of the target element\n        this.element.style.position = 'absolute';\n        // Disable pointer events\n        this.element.setAttribute('pointer-events', 'none');\n\n        // Set up mouse event proxying between the target element and the marks\n        _events2.default.proxyMouse(this.target, this.marks);\n\n        this.container = container;\n        this.container.appendChild(this.element);\n\n        this.render();\n    }\n\n    _createClass(Pane, [{\n        key: 'addMark',\n        value: function addMark(mark) {\n            var g = _svg2.default.createElement('g');\n            this.element.appendChild(g);\n            mark.bind(g, this.container);\n\n            this.marks.push(mark);\n\n            mark.render();\n            return mark;\n        }\n    }, {\n        key: 'removeMark',\n        value: function removeMark(mark) {\n            var idx = this.marks.indexOf(mark);\n            if (idx === -1) {\n                return;\n            }\n            var el = mark.unbind();\n            this.element.removeChild(el);\n            this.marks.splice(idx, 1);\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            setCoords(this.element, coords(this.target, this.container));\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = this.marks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var m = _step.value;\n\n                    m.render();\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n        }\n    }]);\n\n    return Pane;\n}();\n\nvar Mark = exports.Mark = function () {\n    function Mark() {\n        _classCallCheck(this, Mark);\n\n        this.element = null;\n    }\n\n    _createClass(Mark, [{\n        key: 'bind',\n        value: function bind(element, container) {\n            this.element = element;\n            this.container = container;\n        }\n    }, {\n        key: 'unbind',\n        value: function unbind() {\n            var el = this.element;\n            this.element = null;\n            return el;\n        }\n    }, {\n        key: 'render',\n        value: function render() {}\n    }, {\n        key: 'dispatchEvent',\n        value: function dispatchEvent(e) {\n            if (!this.element) return;\n            this.element.dispatchEvent(e);\n        }\n    }, {\n        key: 'getBoundingClientRect',\n        value: function getBoundingClientRect() {\n            return this.element.getBoundingClientRect();\n        }\n    }, {\n        key: 'getClientRects',\n        value: function getClientRects() {\n            var rects = [];\n            var el = this.element.firstChild;\n            while (el) {\n                rects.push(el.getBoundingClientRect());\n                el = el.nextSibling;\n            }\n            return rects;\n        }\n    }, {\n        key: 'filteredRanges',\n        value: function filteredRanges() {\n            var rects = Array.from(this.range.getClientRects());\n\n            // De-duplicate the boxes\n            return rects.filter(function (box) {\n                for (var i = 0; i < rects.length; i++) {\n                    if (rects[i] === box) {\n                        return true;\n                    }\n                    var contained = contains(rects[i], box);\n                    if (contained) {\n                        return false;\n                    }\n                }\n                return true;\n            });\n        }\n    }]);\n\n    return Mark;\n}();\n\nvar Highlight = exports.Highlight = function (_Mark) {\n    _inherits(Highlight, _Mark);\n\n    function Highlight(range, className, data, attributes) {\n        _classCallCheck(this, Highlight);\n\n        var _this = _possibleConstructorReturn(this, (Highlight.__proto__ || Object.getPrototypeOf(Highlight)).call(this));\n\n        _this.range = range;\n        _this.className = className;\n        _this.data = data || {};\n        _this.attributes = attributes || {};\n        return _this;\n    }\n\n    _createClass(Highlight, [{\n        key: 'bind',\n        value: function bind(element, container) {\n            _get(Highlight.prototype.__proto__ || Object.getPrototypeOf(Highlight.prototype), 'bind', this).call(this, element, container);\n\n            for (var attr in this.data) {\n                if (this.data.hasOwnProperty(attr)) {\n                    this.element.dataset[attr] = this.data[attr];\n                }\n            }\n\n            for (var attr in this.attributes) {\n                if (this.attributes.hasOwnProperty(attr)) {\n                    this.element.setAttribute(attr, this.attributes[attr]);\n                }\n            }\n\n            if (this.className) {\n                this.element.classList.add(this.className);\n            }\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            // Empty element\n            while (this.element.firstChild) {\n                this.element.removeChild(this.element.firstChild);\n            }\n\n            var docFrag = this.element.ownerDocument.createDocumentFragment();\n            var filtered = this.filteredRanges();\n            var offset = this.element.getBoundingClientRect();\n            var container = this.container.getBoundingClientRect();\n\n            for (var i = 0, len = filtered.length; i < len; i++) {\n                var r = filtered[i];\n                var el = _svg2.default.createElement('rect');\n                el.setAttribute('x', r.left - offset.left + container.left);\n                el.setAttribute('y', r.top - offset.top + container.top);\n                el.setAttribute('height', r.height);\n                el.setAttribute('width', r.width);\n                docFrag.appendChild(el);\n            }\n\n            this.element.appendChild(docFrag);\n        }\n    }]);\n\n    return Highlight;\n}(Mark);\n\nvar Underline = exports.Underline = function (_Highlight) {\n    _inherits(Underline, _Highlight);\n\n    function Underline(range, className, data, attributes) {\n        _classCallCheck(this, Underline);\n\n        return _possibleConstructorReturn(this, (Underline.__proto__ || Object.getPrototypeOf(Underline)).call(this, range, className, data, attributes));\n    }\n\n    _createClass(Underline, [{\n        key: 'render',\n        value: function render() {\n            // Empty element\n            while (this.element.firstChild) {\n                this.element.removeChild(this.element.firstChild);\n            }\n\n            var docFrag = this.element.ownerDocument.createDocumentFragment();\n            var filtered = this.filteredRanges();\n            var offset = this.element.getBoundingClientRect();\n            var container = this.container.getBoundingClientRect();\n\n            for (var i = 0, len = filtered.length; i < len; i++) {\n                var r = filtered[i];\n\n                var rect = _svg2.default.createElement('rect');\n                rect.setAttribute('x', r.left - offset.left + container.left);\n                rect.setAttribute('y', r.top - offset.top + container.top);\n                rect.setAttribute('height', r.height);\n                rect.setAttribute('width', r.width);\n                rect.setAttribute('fill', 'none');\n\n                var line = _svg2.default.createElement('line');\n                line.setAttribute('x1', r.left - offset.left + container.left);\n                line.setAttribute('x2', r.left - offset.left + container.left + r.width);\n                line.setAttribute('y1', r.top - offset.top + container.top + r.height - 1);\n                line.setAttribute('y2', r.top - offset.top + container.top + r.height - 1);\n\n                line.setAttribute('stroke-width', 1);\n                line.setAttribute('stroke', 'black'); //TODO: match text color?\n                line.setAttribute('stroke-linecap', 'square');\n\n                docFrag.appendChild(rect);\n\n                docFrag.appendChild(line);\n            }\n\n            this.element.appendChild(docFrag);\n        }\n    }]);\n\n    return Underline;\n}(Highlight);\n\nfunction coords(el, container) {\n    var offset = container.getBoundingClientRect();\n    var rect = el.getBoundingClientRect();\n\n    return {\n        top: rect.top - offset.top,\n        left: rect.left - offset.left,\n        height: el.scrollHeight,\n        width: el.scrollWidth\n    };\n}\n\nfunction setCoords(el, coords) {\n    el.style.setProperty('top', coords.top + 'px', 'important');\n    el.style.setProperty('left', coords.left + 'px', 'important');\n    el.style.setProperty('height', coords.height + 'px', 'important');\n    el.style.setProperty('width', coords.width + 'px', 'important');\n}\n\nfunction contains(rect1, rect2) {\n    return rect2.right <= rect1.right && rect2.left >= rect1.left && rect2.top >= rect1.top && rect2.bottom <= rect1.bottom;\n}\n","import EventEmitter from \"event-emitter\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : \"\",\n\t\t\taxis: options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n\t\t\tdirection: undefined,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t\tmethod: undefined\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\t// this.width  = this.settings.width;\n\t\t// this.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis.pane = undefined;\n\t\tthis.highlights = {};\n\t\tthis.underlines = {};\n\t\tthis.marks = {};\n\n\t}\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement(\"div\");\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\t\telement.style.position = \"relative\";\n\t\telement.style.display = \"block\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.flex = \"none\";\n\t\t} else {\n\t\t\telement.style.flex = \"initial\";\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement(\"iframe\");\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.setAttribute(\"ref\", this.index);\n\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\n\t\tif((\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\tif (!this.settings.method) {\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n\t\t}\n\n\t\treturn this.iframe;\n\t}\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\tthis.layout.format(this.contents);\n\n\t\t\t\t// find and report the writingMode axis\n\t\t\t\tlet writingMode = this.contents.writingMode();\n\t\t\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\t\t\tthis.setAxis(axis);\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\n\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\t\tthis.expand();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t}.bind(this), function(e){\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.then(function() {\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\n\t\t\t}.bind(this));\n\n\t}\n\n\treset () {\n\t\tif (this.iframe) {\n\t\t\tthis.iframe.style.width = \"0\";\n\t\t\tthis.iframe.style.height = \"0\";\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._textWidth = undefined;\n\t\t\tthis._contentWidth = undefined;\n\t\t\tthis._textHeight = undefined;\n\t\t\tthis._contentHeight = undefined;\n\t\t}\n\t\tthis._needsReframe = true;\n\t}\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t\tthis.settings.width = width;\n\t\tthis.settings.height = height;\n\t}\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t// this.contents.layout();\n\t\t\tthis.expand();\n\t\t}\n\n\n\n\t}\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\twidth = this.layout.columnWidth;\n\t\t\theight = this.layout.height;\n\t\t}\n\t\t// Expand Horizontally\n\t\telse if(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\twidth = this.contents.textWidth();\n\n\t\t\tif (width % this.layout.pageWidth > 0) {\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n\t\t\t}\n\n\t\t\tif (this.settings.forceEvenPages) {\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\n\t\t\t\tif ( this.layout.divisor > 1 &&\n\t\t\t\t\t\t this.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t// add a blank page\n\t\t\t\t\twidth += this.layout.pageWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\theight = this.contents.textHeight();\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.reframe(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t}\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n\t\tsize = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\twidthDelta: widthDelta,\n\t\t\theightDelta: heightDelta,\n\t\t};\n\n\t\tthis.pane && this.pane.render();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tlet mark;\n\t\t\tfor (let m in this.marks) {\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\n\t\t\t\t\tmark = this.marks[m];\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\n\n\t\tthis.prevBounds = size;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t}\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif (this.settings.method === \"blobUrl\") {\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n\t\t\tthis.iframe.src = this.blobUrl;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else if(this.settings.method === \"srcdoc\"){\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else {\n\n\t\t\tthis.element.appendChild(this.iframe);\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\tonLoad(event, promise) {\n\n\t\tthis.window = this.iframe.contentWindow;\n\t\tthis.document = this.iframe.contentDocument;\n\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n\n\t\tthis.rendering = false;\n\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\tif (link) {\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t} else {\n\t\t\tlink = this.document.createElement(\"link\");\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t}\n\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpromise.resolve(this.contents);\n\t}\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\n\t\tif (this.contents) {\n\t\t\tthis.layout.format(this.contents);\n\t\t\tthis.expand();\n\t\t}\n\t}\n\n\tsetAxis(axis) {\n\n\t\t// Force vertical for scrolled\n\t\tif (this.layout.props.flow === \"scrolled\") {\n\t\t\taxis = \"vertical\";\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tif(axis == \"horizontal\"){\n\t\t\tthis.element.style.flex = \"none\";\n\t\t} else {\n\t\t\tthis.element.style.flex = \"initial\";\n\t\t}\n\n\t\tthis.size();\n\n\t}\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t}\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t}\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\n\t\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\t\tthis.displayed = true;\n\t\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t\t}.bind(this), function (err) {\n\t\t\t\t\tdisplayed.reject(err, this);\n\t\t\t\t});\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t}\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\n\t\t\t// Remind Safari to redraw the iframe\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\n\t\t\tthis.iframe.offsetWidth;\n\t\t\tthis.iframe.style.transform = null;\n\t\t}\n\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\n\t}\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\n\t}\n\n\toffset() {\n\t\treturn {\n\t\t\ttop: this.element.offsetTop,\n\t\t\tleft: this.element.offsetLeft\n\t\t}\n\t}\n\n\twidth() {\n\t\treturn this._width;\n\t}\n\n\theight() {\n\t\treturn this._height;\n\t}\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t}\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": targetPos.left,\n\t\t\t\"top\": targetPos.top\n\t\t};\n\t}\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tbounds(force) {\n\t\tif(force || !this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\n\t\treturn this.elementBounds;\n\t}\n\n\thighlight(cfiRange, data={}, cb, className = \"epubjs-hl\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"fill\": \"yellow\", \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Highlight(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tunderline(cfiRange, data={}, cb, className = \"epubjs-ul\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Underline(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tmark(cfiRange, data={}, cb) {\n\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cfiRange in this.marks) {\n\t\t\tlet item = this.marks[cfiRange];\n\t\t\treturn item;\n\t\t}\n\n\t\tlet range = this.contents.range(cfiRange);\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = range.commonAncestorContainer;\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\n\n\t\tlet emitter = (e) => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tif (range.collapsed && container.nodeType === 1) {\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(container);\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(parent);\n\t\t}\n\n\t\tlet mark = this.document.createElement(\"a\");\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\n\t\tmark.style.position = \"absolute\";\n\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\n\n\t\tif (data) {\n\t\t\tObject.keys(data).forEach((key) => {\n\t\t\t\tmark.dataset[key] = data[key];\n\t\t\t});\n\t\t}\n\n\t\tif (cb) {\n\t\t\tmark.addEventListener(\"click\", cb);\n\t\t\tmark.addEventListener(\"touchstart\", cb);\n\t\t}\n\n\t\tmark.addEventListener(\"click\", emitter);\n\t\tmark.addEventListener(\"touchstart\", emitter);\n\n\t\tthis.placeMark(mark, range);\n\n\t\tthis.element.appendChild(mark);\n\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\n\n\t\treturn parent;\n\t}\n\n\tplaceMark(element, range) {\n\t\tlet top, right, left;\n\n\t\tif(this.layout.name === \"pre-paginated\" ||\n\t\t\tthis.settings.axis !== \"horizontal\") {\n\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\ttop = pos.top;\n\t\t\tright = pos.right;\n\t\t} else {\n\t\t\t// Element might break columns, so find the left most element\n\t\t\tlet rects = range.getClientRects();\n\n\t\t\tlet rect;\n\t\t\tfor (var i = 0; i != rects.length; i++) {\n\t\t\t\trect = rects[i];\n\t\t\t\tif (!left || rect.left < left) {\n\t\t\t\t\tleft = rect.left;\n\t\t\t\t\tright = left + this.layout.columnWidth - this.layout.gap;\n\t\t\t\t\ttop = rect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.style.top = `${top}px`;\n\t\telement.style.left = `${right}px`;\n\t}\n\n\tunhighlight(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.highlights) {\n\t\t\titem = this.highlights[cfiRange];\n\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) { item.element.removeEventListener(\"click\", l) };\n\t\t\t});\n\t\t\tdelete this.highlights[cfiRange];\n\t\t}\n\t}\n\n\tununderline(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.underlines) {\n\t\t\titem = this.underlines[cfiRange];\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) { item.element.removeEventListener(\"click\", l) };\n\t\t\t});\n\t\t\tdelete this.underlines[cfiRange];\n\t\t}\n\t}\n\n\tunmark(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.marks) {\n\t\t\titem = this.marks[cfiRange];\n\t\t\tthis.element.removeChild(item.element);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) { item.element.removeEventListener(\"click\", l) };\n\t\t\t});\n\t\t\tdelete this.marks[cfiRange];\n\t\t}\n\t}\n\n\tdestroy() {\n\n\t\tfor (let cfiRange in this.highlights) {\n\t\t\tthis.unhighlight(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.underlines) {\n\t\t\tthis.ununderline(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.marks) {\n\t\t\tthis.unmark(cfiRange);\n\t\t}\n\n\t\tif (this.blobUrl) {\n\t\t\trevokeBlobUrl(this.blobUrl);\n\t\t}\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\n\t\t\tthis.iframe = undefined;\n\t\t\tthis.contents = undefined;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t}\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","var debounce = require('./debounce'),\n    isObject = require('./isObject');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nmodule.exports = throttle;\n","import {uuid, isNumber, isElement, windowBounds} from \"../../utils/core\";\nimport throttle from 'lodash/throttle'\n\nclass Stage {\n\tconstructor(_options) {\n\t\tthis.settings = _options || {};\n\t\tthis.id = \"epubjs-container-\" + uuid();\n\n\t\tthis.container = this.create(this.settings);\n\n\t\tif(this.settings.hidden) {\n\t\t\tthis.wrapper = this.wrap(this.container);\n\t\t}\n\n\t}\n\n\t/*\n\t* Creates an element to render to.\n\t* Resizes to passed width and height or to the elements size\n\t*/\n\tcreate(options){\n\t\tlet height  = options.height;// !== false ? options.height : \"100%\";\n\t\tlet width   = options.width;// !== false ? options.width : \"100%\";\n\t\tlet overflow  = options.overflow || false;\n\t\tlet axis = options.axis || \"vertical\";\n\t\tlet direction = options.direction;\n\n\t\tif(options.height && isNumber(options.height)) {\n\t\t\theight = options.height + \"px\";\n\t\t}\n\n\t\tif(options.width && isNumber(options.width)) {\n\t\t\twidth = options.width + \"px\";\n\t\t}\n\n\t\t// Create new container element\n\t\tlet container = document.createElement(\"div\");\n\n\t\tcontainer.id = this.id;\n\t\tcontainer.classList.add(\"epub-container\");\n\n\t\t// Style Element\n\t\t// container.style.fontSize = \"0\";\n\t\tcontainer.style.wordSpacing = \"0\";\n\t\tcontainer.style.lineHeight = \"0\";\n\t\tcontainer.style.verticalAlign = \"top\";\n\t\tcontainer.style.position = \"relative\";\n\n\t\tif(axis === \"horizontal\") {\n\t\t\t// container.style.whiteSpace = \"nowrap\";\n\t\t\tcontainer.style.display = \"flex\";\n\t\t\tcontainer.style.flexDirection = \"row\";\n\t\t\tcontainer.style.flexWrap = \"nowrap\";\n\t\t}\n\n\t\tif(width){\n\t\t\tcontainer.style.width = width;\n\t\t}\n\n\t\tif(height){\n\t\t\tcontainer.style.height = height;\n\t\t}\n\n\t\tif (overflow) {\n\t\t\tcontainer.style.overflow = overflow;\n\t\t}\n\n\t\tif (direction) {\n\t\t\tcontainer.dir = direction;\n\t\t\tcontainer.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (direction && this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = direction;\n\t\t}\n\n\t\treturn container;\n\t}\n\n\twrap(container) {\n\t\tvar wrapper = document.createElement(\"div\");\n\n\t\twrapper.style.visibility = \"hidden\";\n\t\twrapper.style.overflow = \"hidden\";\n\t\twrapper.style.width = \"0\";\n\t\twrapper.style.height = \"0\";\n\n\t\twrapper.appendChild(container);\n\t\treturn wrapper;\n\t}\n\n\n\tgetElement(_element){\n\t\tvar element;\n\n\t\tif(isElement(_element)) {\n\t\t\telement = _element;\n\t\t} else if (typeof _element === \"string\") {\n\t\t\telement = document.getElementById(_element);\n\t\t}\n\n\t\tif(!element){\n\t\t\tthrow new Error(\"Not an Element\");\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tattachTo(what){\n\n\t\tvar element = this.getElement(what);\n\t\tvar base;\n\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.hidden) {\n\t\t\tbase = this.wrapper;\n\t\t} else {\n\t\t\tbase = this.container;\n\t\t}\n\n\t\telement.appendChild(base);\n\n\t\tthis.element = element;\n\n\t\treturn element;\n\n\t}\n\n\tgetContainer() {\n\t\treturn this.container;\n\t}\n\n\tonResize(func){\n\t\t// Only listen to window for resize event if width and height are not fixed.\n\t\t// This applies if it is set to a percent or auto.\n\t\tif(!isNumber(this.settings.width) ||\n\t\t\t !isNumber(this.settings.height) ) {\n\t\t\tthis.resizeFunc = throttle(func, 50);\n\t\t\twindow.addEventListener(\"resize\", this.resizeFunc, false);\n\t\t}\n\n\t}\n\n\tonOrientationChange(func){\n\t\tthis.orientationChangeFunc = func;\n\t\twindow.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\n\t}\n\n\tsize(width, height){\n\t\tvar bounds;\n\t\tlet _width = width || this.settings.width;\n\t\tlet _height = height || this.settings.height;\n\n\t\t// If width or height are set to false, inherit them from containing element\n\t\tif(width === null) {\n\t\t\tbounds = this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.width) {\n\t\t\t\twidth = Math.floor(bounds.width);\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.width = width;\n\t\t\t}\n\t\t}\n\n\t\tif(height === null) {\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.height) {\n\t\t\t\theight = bounds.height;\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.height = height;\n\t\t\t}\n\t\t}\n\n\t\tif(!isNumber(width)) {\n\t\t\tbounds = this.container.getBoundingClientRect();\n\t\t\twidth = Math.floor(bounds.width);\n\t\t\t//height = bounds.height;\n\t\t}\n\n\t\tif(!isNumber(height)) {\n\t\t\tbounds = bounds || this.container.getBoundingClientRect();\n\t\t\t//width = bounds.width;\n\t\t\theight = bounds.height;\n\t\t}\n\n\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\n\n\t\tthis.containerPadding = {\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\t// Bounds not set, get them from window\n\t\tlet _windowBounds = windowBounds();\n\t\tlet bodyStyles = window.getComputedStyle(document.body);\n\t\tlet bodyPadding = {\n\t\t\tleft: parseFloat(bodyStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(bodyStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(bodyStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\tif (!_width) {\n\t\t\twidth = _windowBounds.width -\n\t\t\t\t\t\t\t\tbodyPadding.left -\n\t\t\t\t\t\t\t\tbodyPadding.right;\n\t\t}\n\n\t\tif ((this.settings.fullsize && !_height) || !_height) {\n\t\t\theight = _windowBounds.height -\n\t\t\t\t\t\t\t\tbodyPadding.top -\n\t\t\t\t\t\t\t\tbodyPadding.bottom;\n\t\t}\n\n\t\treturn {\n\t\t\twidth: width -\n\t\t\t\t\t\t\tthis.containerPadding.left -\n\t\t\t\t\t\t\tthis.containerPadding.right,\n\t\t\theight: height -\n\t\t\t\t\t\t\tthis.containerPadding.top -\n\t\t\t\t\t\t\tthis.containerPadding.bottom\n\t\t};\n\n\t}\n\n\tbounds(){\n\t\tlet box;\n\t\tif (this.container.style.overflow !== \"visible\") {\n\t\t\tbox = this.container && this.container.getBoundingClientRect();\n\t\t}\n\n\t\tif(!box || !box.width || !box.height) {\n\t\t\treturn windowBounds();\n\t\t} else {\n\t\t\treturn box;\n\t\t}\n\n\t}\n\n\tgetSheet(){\n\t\tvar style = document.createElement(\"style\");\n\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\t\tstyle.appendChild(document.createTextNode(\"\"));\n\n\t\tdocument.head.appendChild(style);\n\n\t\treturn style.sheet;\n\t}\n\n\taddStyleRules(selector, rulesArray){\n\t\tvar scope = \"#\" + this.id + \" \";\n\t\tvar rules = \"\";\n\n\t\tif(!this.sheet){\n\t\t\tthis.sheet = this.getSheet();\n\t\t}\n\n\t\trulesArray.forEach(function(set) {\n\t\t\tfor (var prop in set) {\n\t\t\t\tif(set.hasOwnProperty(prop)) {\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n\t}\n\n\taxis(axis) {\n\t\tif(axis === \"horizontal\") {\n\t\t\tthis.container.style.display = \"flex\";\n\t\t\tthis.container.style.flexDirection = \"row\";\n\t\t\tthis.container.style.flexWrap = \"nowrap\";\n\t\t} else {\n\t\t\tthis.container.style.display = \"block\";\n\t\t}\n\t}\n\n\t// orientation(orientation) {\n\t// \tif (orientation === \"landscape\") {\n\t//\n\t// \t} else {\n\t//\n\t// \t}\n\t//\n\t// \tthis.orientation = orientation;\n\t// }\n\n\tdirection(dir) {\n\t\tif (this.container) {\n\t\t\tthis.container.dir = dir;\n\t\t\tthis.container.style[\"direction\"] = dir;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\toverflow(overflow) {\n\t\tif (this.container) {\n\t\t\tthis.container.style[\"overflow\"] = overflow;\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tvar base;\n\n\t\tif (this.element) {\n\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tbase = this.wrapper;\n\t\t\t} else {\n\t\t\t\tbase = this.container;\n\t\t\t}\n\n\t\t\tif(this.element.contains(this.container)) {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\n\t\t\twindow.removeEventListener(\"resize\", this.resizeFunc);\n\t\t\twindow.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\n\n\t\t}\n\t}\n}\n\nexport default Stage;\n","class Views {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t}\n\n\tall() {\n\t\treturn this._views;\n\t}\n\n\tfirst() {\n\t\treturn this._views[0];\n\t}\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t}\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t}\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t}\n\n\tget(i) {\n\t\treturn this._views[i];\n\t}\n\n\tappend(view){\n\t\tthis._views.push(view);\n\t\tif(this.container){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t}\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\tif(this.container){\n\t\t\t this.container.removeChild(view.element);\n\t\t}\n\t\tview = null;\n\t}\n\n\t// Iterators\n\n\tforEach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t}\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t}\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t}\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t}\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t}\n}\n\nexport default Views;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber} from \"../../utils/core\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.optsSettings = options.settings;\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\taxis: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\tignoreClass: \"\",\n\t\t\tfullsize: undefined\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: true\n\t\t};\n\n\t\tthis.rendered = false;\n\n\t}\n\n\trender(element, size){\n\t\tlet tag = element.tagName;\n\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\n\t\t\t\ttag && (tag.toLowerCase() == \"body\" ||\n\t\t\t\ttag.toLowerCase() == \"html\")) {\n\t\t\t\tthis.settings.fullsize = true;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tthis.settings.overflow = \"visible\";\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.settings.size = size;\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis,\n\t\t\tfullsize: this.settings.fullsize,\n\t\t\tdirection: this.settings.direction\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\n\t\tthis.rendered = true;\n\n\t}\n\n\taddEventListeners(){\n\t\tvar scroller;\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tdestroy(){\n\t\tclearTimeout(this.orientationTimeout);\n\t\tclearTimeout(this.resizeTimeout);\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.clear();\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.stage.destroy();\n\n\t\tthis.rendered = false;\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t}\n\n\tonOrientationChange(e) {\n\t\tlet {orientation} = window;\n\n\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\tthis.resize();\n\t\t}\n\n\t\t// Per ampproject:\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\n\t\t// element size depends on window size directly and the measurement\n\t\t// happens in window.resize event. Adding a timeout for correct\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\n\t\tclearTimeout(this.orientationTimeout);\n\t\tthis.orientationTimeout = setTimeout(function(){\n\t\t\tthis.orientationTimeout = undefined;\n\n\t\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\t\tthis.resize();\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n\t\t}.bind(this), 500);\n\n\t}\n\n\tonResized(e) {\n\t\tthis.resize();\n\t}\n\n\tresize(width, height){\n\t\tlet stageSize = this.stage.size(width, height);\n\n\t\t// For Safari, wait for orientation to catch up\n\t\t// if the window is a square\n\t\tthis.winBounds = windowBounds();\n\t\tif (this.orientationTimeout &&\n\t\t\t\tthis.winBounds.width === this.winBounds.height) {\n\t\t\t// reset the stage size for next resize\n\t\t\tthis._stageSize = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._stageSize &&\n\t\t\t\tthis._stageSize.width === stageSize.width &&\n\t\t\t\tthis._stageSize.height === stageSize.height ) {\n\t\t\t// Size is the same, no need to resize\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = stageSize;\n\n\t\tthis._bounds = this.bounds();\n\n\t\t// Clear current views\n\t\tthis.clear();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\n\t\t\twidth: this._stageSize.width,\n\t\t\theight: this._stageSize.height\n\t\t});\n\t}\n\n\tcreateView(section) {\n\t\treturn new this.View(section, this.viewSettings);\n\t}\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check if moving to target is needed\n\t\tif (target === section.href || isNumber(target)) {\n\t\t\ttarget = undefined;\n\t\t}\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location in view\n\t\tif(visible && section) {\n\t\t\tlet offset = visible.offset();\n\n\t\t\tif (this.settings.direction === \"ltr\") {\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\n\t\t\t} else {\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\n\t\t\t}\n\n\t\t\tif(target) {\n\t\t\t\tlet offset = visible.locationOf(target);\n\t\t\t\tthis.moveTo(offset);\n\t\t\t}\n\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.clear();\n\n\t\tthis.add(section)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\tlet offset = view.locationOf(target);\n\t\t\t\t\tthis.moveTo(offset);\n\t\t\t\t}\n\n\t\t\t}.bind(this), (err) => {\n\t\t\t\tdisplaying.reject(err);\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tvar next;\n\t\t\t\tif (this.layout.name === \"pre-paginated\" &&\n\t\t\t\t\t\tthis.layout.divisor > 1) {\n\t\t\t\t\tnext = section.next();\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\treturn this.add(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this));\n\t\t// .then(function(){\n\t\t// \treturn this.hooks.display.trigger(view);\n\t\t// }.bind(this))\n\t\t// .then(function(){\n\t\t// \tthis.views.show();\n\t\t// }.bind(this));\n\t\treturn displayed;\n\t}\n\n\tafterDisplayed(view){\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\tmoveTo(offset){\n\t\tvar distX = 0,\n\t\t\t  distY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\t\t}\n\t\tthis.scrollTo(distX, distY, true);\n\t}\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\n\t}\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar left;\n\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top  = this.container.scrollTop + this.container.offsetHeight;\n\n\t\t\tif(top < this.container.scrollHeight) {\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else {\n\t\t\tnext = this.views.last().section.next();\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.clear();\n\n\t\t\treturn this.append(next)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar right;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tright = next.next();\n\t\t\t\t\t\tif (right) {\n\t\t\t\t\t\t\treturn this.append(right);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t}\n\n\tprev(){\n\t\tvar prev;\n\t\tvar left;\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top = this.container.scrollTop;\n\n\t\t\tif(top > 0) {\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.clear();\n\n\t\t\treturn this.prepend(prev)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear () {\n\n\t\t// this.q.clear();\n\n\t\tif (this.views) {\n\t\t\tthis.views.hide();\n\t\t\tthis.scrollTo(0,0, true);\n\t\t\tthis.views.clear();\n\t\t}\n\t}\n\n\tcurrentLocation(){\n\n\t\tif (this.settings.axis === \"vertical\") {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t} else {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t}\n\t\treturn this.location;\n\t}\n\n\tscrolledLocation() {\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\t\tlet pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\n\t\tlet offset = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\toffset = window.scrollY;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet position = view.position();\n\t\t\tlet height = view.height();\n\n\t\t\tlet startPos = offset + container.top - position.top + used;\n\t\t\tlet endPos = startPos + pageHeight - used;\n\t\t\tif (endPos > height) {\n\t\t\t\tendPos = height;\n\t\t\t\tused = (endPos - startPos);\n\t\t\t}\n\n\t\t\tlet totalPages = this.layout.count(height, pageHeight).pages;\n\n\t\t\tlet currPage = Math.ceil(startPos / pageHeight);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.ceil(endPos / pageHeight);\n\n\t\t\tpages = [];\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\n\t\t\t\tlet pg = i + 1;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tpaginatedLocation(){\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\n\t\tlet left = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\tleft = window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet offset = view.offset().left;\n\t\t\tlet position = view.position().left;\n\t\t\tlet width = view.width();\n\n\t\t\t// Find mapping\n\t\t\tlet start = left + container.left - position + used;\n\t\t\tlet end = start + this.layout.width - used;\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n\n\t\t\t// Find displayed pages\n\t\t\t//console.log(\"pre\", end, offset + width);\n\t\t\t// if (end > offset + width) {\n\t\t\t// \tend = offset + width;\n\t\t\t// \tused = this.layout.pageWidth;\n\t\t\t// }\n\t\t\t// console.log(\"post\", end);\n\n\t\t\tlet totalPages = this.layout.count(width).pages;\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\n\n\t\t\t// start page should not be negative\n\t\t\tif (startPage < 0) {\n\t\t\t\tstartPage = 0;\n\t\t\t\tendPage = endPage + 1;\n\t\t\t}\n\n\t\t\t// Reverse page counts for rtl\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\tlet tempStartPage = startPage;\n\t\t\t\tstartPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\n\t\t\t\tlet pg = i;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvisible(){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t}\n\n\tscrollBy(x, y, silent){\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tif(x) this.container.scrollLeft += x * dir;\n\t\t\tif(y) this.container.scrollTop += y;\n\t\t} else {\n\t\t\twindow.scrollBy(x * dir, y * dir);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY;\n\t\t\tscrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\t\ttop: scrollTop,\n\t\t\t\tleft: scrollLeft\n\t\t\t});\n\n\t\t\tclearTimeout(this.afterScrolled);\n\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t});\n\t\t\t}.bind(this), 20);\n\n\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t}\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t}\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\t\t // this.manager.layout(this.layout.format);\n\t}\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(!this.isPaginated) {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta;\n\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\t}\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.forEach(function(view){\n\t\t\t\tif (view) {\n\t\t\t\t\tview.setLayout(layout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tupdateAxis(axis, forceUpdate){\n\n\t\tif (!this.isPaginated) {\n\t\t\taxis = \"vertical\";\n\t\t}\n\n\t\tif (!forceUpdate && axis === this.settings.axis) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.stage && this.stage.axis(axis);\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tif (this.mapping) {\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n\t\t}\n\n\t\tif (this.layout) {\n\t\t\tif (axis === \"vertical\") {\n\t\t\t\tthis.layout.spread(\"none\");\n\t\t\t} else {\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFlow(flow){\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\n\n\t\tthis.isPaginated = isPaginated;\n\n\t\tif (flow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\tflow === \"scrolled\") {\n\t\t\tthis.updateAxis(\"vertical\");\n\t\t} else {\n\t\t\tthis.updateAxis(\"horizontal\");\n\t\t}\n\n\t\tthis.viewSettings.flow = flow;\n\n\t\tif (!this.settings.overflow) {\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : \"auto\";\n\t\t} else {\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.stage && this.stage.overflow(this.overflow);\n\n\t\tthis.updateLayout();\n\n\t}\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tif (!this.views) {\n\t\t\treturn contents;\n\t\t}\n\t\tthis.views.forEach(function(view){\n\t\t\tconst viewContents = view && view.contents;\n\t\t\tif (viewContents) {\n\t\t\t\tcontents.push(viewContents);\n\t\t\t}\n\t\t});\n\t\treturn contents;\n\t}\n\n\tdirection(dir=\"ltr\") {\n\t\tthis.settings.direction = dir;\n\n\t\tthis.stage && this.stage.direction(dir);\n\n\t\tthis.viewSettings.direction = dir;\n\n\t\tthis.updateLayout();\n\t}\n\n\tisRendered() {\n\t\treturn this.rendered;\n\t}\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n","import {extend, defer, requestAnimationFrame, prefixed} from \"../../utils/core\";\nimport { EVENTS, DOM_EVENTS } from \"../../utils/constants\";\nimport EventEmitter from \"event-emitter\";\n\n// easing equations from https://github.com/danro/easing-js/blob/master/easing.js\nconst PI_D2 = (Math.PI / 2);\nconst EASING_EQUATIONS = {\n\t\teaseOutSine: function (pos) {\n\t\t\t\treturn Math.sin(pos * PI_D2);\n\t\t},\n\t\teaseInOutSine: function (pos) {\n\t\t\t\treturn (-0.5 * (Math.cos(Math.PI * pos) - 1));\n\t\t},\n\t\teaseInOutQuint: function (pos) {\n\t\t\t\tif ((pos /= 0.5) < 1) {\n\t\t\t\t\t\treturn 0.5 * Math.pow(pos, 5);\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (Math.pow((pos - 2), 5) + 2);\n\t\t},\n\t\teaseInCubic: function(pos) {\n\t\t\treturn Math.pow(pos, 3);\n  \t}\n};\n\nclass Snap {\n\tconstructor(manager, options) {\n\n\t\tthis.settings = extend({\n\t\t\tduration: 80,\n\t\t\tminVelocity: 0.2,\n\t\t\tminDistance: 10,\n\t\t\teasing: EASING_EQUATIONS['easeInCubic']\n\t\t}, options || {});\n\n\t\tthis.supportsTouch = this.supportsTouch();\n\n\t\tif (this.supportsTouch) {\n\t\t\tthis.setup(manager);\n\t\t}\n\t}\n\n\tsetup(manager) {\n\t\tthis.manager = manager;\n\n\t\tthis.layout = this.manager.layout;\n\n\t\tthis.fullsize = this.manager.settings.fullsize;\n\t\tif (this.fullsize) {\n\t\t\tthis.element = this.manager.stage.element;\n\t\t\tthis.scroller = window;\n\t\t\tthis.disableScroll();\n\t\t} else {\n\t\t\tthis.element = this.manager.stage.container;\n\t\t\tthis.scroller = this.element;\n\t\t\tthis.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\n\t\t}\n\n\t\t// this.overflow = this.manager.overflow;\n\n\t\t// set lookahead offset to page width\n\t\tthis.manager.settings.offset = this.layout.width;\n\t\tthis.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\n\n\t\tthis.isVertical = this.manager.settings.axis === \"vertical\";\n\n\t\t// disable snapping if not paginated or axis in not horizontal\n\t\tif (!this.manager.isPaginated || this.isVertical) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.touchCanceler = false;\n\t\tthis.resizeCanceler = false;\n\t\tthis.snapping = false;\n\n\n\t\tthis.scrollLeft;\n\t\tthis.scrollTop;\n\n\t\tthis.startTouchX = undefined;\n\t\tthis.startTouchY = undefined;\n\t\tthis.startTime = undefined;\n\t\tthis.endTouchX = undefined;\n\t\tthis.endTouchY = undefined;\n\t\tthis.endTime = undefined;\n\n\t\tthis.addListeners();\n\t}\n\n\tsupportsTouch() {\n\t\tif (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tdisableScroll() {\n\t\tthis.element.style.overflow = \"hidden\";\n\t}\n\n\tenableScroll() {\n\t\tthis.element.style.overflow = \"\";\n\t}\n\n\taddListeners() {\n\t\tthis._onResize = this.onResize.bind(this);\n\t\twindow.addEventListener('resize', this._onResize);\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tthis.scroller.addEventListener('scroll', this._onScroll);\n\n\t\tthis._onTouchStart = this.onTouchStart.bind(this);\n\t\tthis.scroller.addEventListener('touchstart', this._onTouchStart, { passive: true });\n\t\tthis.on('touchstart', this._onTouchStart);\n\n\t\tthis._onTouchMove = this.onTouchMove.bind(this);\n\t\tthis.scroller.addEventListener('touchmove', this._onTouchMove, { passive: true });\n\t\tthis.on('touchmove', this._onTouchMove);\n\n\t\tthis._onTouchEnd = this.onTouchEnd.bind(this);\n\t\tthis.scroller.addEventListener('touchend', this._onTouchEnd, { passive: true });\n\t\tthis.on('touchend', this._onTouchEnd);\n\n\t\tthis._afterDisplayed = this.afterDisplayed.bind(this);\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n\t}\n\n\tremoveListeners() {\n\t\twindow.removeEventListener('resize', this._onResize);\n\t\tthis._onResize = undefined;\n\n\t\tthis.scroller.removeEventListener('scroll', this._onScroll);\n\t\tthis._onScroll = undefined;\n\n\t\tthis.scroller.removeEventListener('touchstart', this._onTouchStart, { passive: true });\n\t\tthis.off('touchstart', this._onTouchStart);\n\t\tthis._onTouchStart = undefined;\n\n\t\tthis.scroller.removeEventListener('touchmove', this._onTouchMove, { passive: true });\n\t\tthis.off('touchmove', this._onTouchMove);\n\t\tthis._onTouchMove = undefined;\n\n\t\tthis.scroller.removeEventListener('touchend', this._onTouchEnd, { passive: true });\n\t\tthis.off('touchend', this._onTouchEnd);\n\t\tthis._onTouchEnd = undefined;\n\n\t\tthis.manager.off(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n\t\tthis._afterDisplayed = undefined;\n\t}\n\n\tafterDisplayed(view) {\n\t\tlet contents = view.contents;\n\t\t[\"touchstart\", \"touchmove\", \"touchend\"].forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\t}\n\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\tonScroll(e) {\n\t\tthis.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\n\t\tthis.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\n\t}\n\n\tonResize(e) {\n\t\tthis.resizeCanceler = true;\n\t}\n\n\tonTouchStart(e) {\n\t\tlet { screenX, screenY } = e.touches[0];\n\n\t\tif (this.fullsize) {\n\t\t\tthis.enableScroll();\n\t\t}\n\n\t\tthis.touchCanceler = true;\n\n\t\tif (!this.startTouchX) {\n\t\t\tthis.startTouchX = screenX;\n\t\t\tthis.startTouchY = screenY;\n\t\t\tthis.startTime = this.now();\n\t\t}\n\n\t\tthis.endTouchX = screenX;\n\t\tthis.endTouchY = screenY;\n\t\tthis.endTime = this.now();\n\t}\n\n\tonTouchMove(e) {\n\t\tlet { screenX, screenY } = e.touches[0];\n\t\tlet deltaY = Math.abs(screenY - this.endTouchY);\n\n\t\tthis.touchCanceler = true;\n\n\n\t\tif (!this.fullsize && deltaY < 10) {\n\t\t\tthis.element.scrollLeft -= screenX - this.endTouchX;\n\t\t}\n\n\t\tthis.endTouchX = screenX;\n\t\tthis.endTouchY = screenY;\n\t\tthis.endTime = this.now();\n\t}\n\n\tonTouchEnd(e) {\n\t\tif (this.fullsize) {\n\t\t\tthis.disableScroll();\n\t\t}\n\n\t\tthis.touchCanceler = false;\n\n\t\tlet swipped = this.wasSwiped();\n\n\t\tif (swipped !== 0) {\n\t\t\tthis.snap(swipped);\n\t\t} else {\n\t\t\tthis.snap();\n\t\t}\n\n\t\tthis.startTouchX = undefined;\n\t\tthis.startTouchY = undefined;\n\t\tthis.startTime = undefined;\n\t\tthis.endTouchX = undefined;\n\t\tthis.endTouchY = undefined;\n\t\tthis.endTime = undefined;\n\t}\n\n\twasSwiped() {\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\tlet distance = (this.endTouchX - this.startTouchX);\n\t\tlet absolute = Math.abs(distance);\n\t\tlet time = this.endTime - this.startTime;\n\t\tlet velocity = (distance / time);\n\t\tlet minVelocity = this.settings.minVelocity;\n\n\t\tif (absolute <= this.settings.minDistance || absolute >= snapWidth) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (velocity > minVelocity) {\n\t\t\t// previous\n\t\t\treturn -1;\n\t\t} else if (velocity < -minVelocity) {\n\t\t\t// next\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\tneedsSnap() {\n\t\tlet left = this.scrollLeft;\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\treturn (left % snapWidth) !== 0;\n\t}\n\n\tsnap(howMany=0) {\n\t\tlet left = this.scrollLeft;\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\n\t\tlet snapTo = Math.round(left / snapWidth) * snapWidth;\n\n\t\tif (howMany) {\n\t\t\tsnapTo += (howMany * snapWidth);\n\t\t}\n\n\t\treturn this.smoothScrollTo(snapTo);\n\t}\n\n\tsmoothScrollTo(destination) {\n\t\tconst deferred = new defer();\n\t\tconst start = this.scrollLeft;\n\t\tconst startTime = this.now();\n\n\t\tconst duration = this.settings.duration;\n\t\tconst easing = this.settings.easing;\n\n\t\tthis.snapping = true;\n\n\t\t// add animation loop\n\t\tfunction tick() {\n\t\t\tconst now = this.now();\n\t\t\tconst time = Math.min(1, ((now - startTime) / duration));\n\t\t\tconst timeFunction = easing(time);\n\n\n\t\t\tif (this.touchCanceler || this.resizeCanceler) {\n\t\t\t\tthis.resizeCanceler = false;\n\t\t\t\tthis.snapping = false;\n\t\t\t\tdeferred.resolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (time < 1) {\n\t\t\t\t\twindow.requestAnimationFrame(tick.bind(this));\n\t\t\t\t\tthis.scrollTo(start + ((destination - start) * time), 0);\n\t\t\t} else {\n\t\t\t\t\tthis.scrollTo(destination, 0);\n\t\t\t\t\tthis.snapping = false;\n\t\t\t\t\tdeferred.resolve();\n\t\t\t}\n\t\t}\n\n\t\ttick.call(this);\n\n\t\treturn deferred.promise;\n\t}\n\n\tscrollTo(left=0, top=0) {\n\t\tif (this.fullsize) {\n\t\t\twindow.scroll(left, top);\n\t\t} else {\n\t\t\tthis.scroller.scrollLeft = left;\n\t\t\tthis.scroller.scrollTop = top;\n\t\t}\n\t}\n\n\tnow() {\n\t\treturn ('now' in window.performance) ? performance.now() : new Date().getTime();\n\t}\n\n\tdestroy() {\n\t\tif (!this.scroller) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.fullsize) {\n\t\t\tthis.enableScroll();\n\t\t}\n\n\t\tthis.removeListeners();\n\n\t\tthis.scroller = undefined;\n\t}\n}\n\nEventEmitter(Snap.prototype);\n\nexport default Snap;\n","import {extend, defer, requestAnimationFrame} from \"../../utils/core\";\nimport DefaultViewManager from \"../default\";\nimport Snap from \"../helpers/snap\";\nimport { EVENTS } from \"../../utils/constants\";\nimport debounce from \"lodash/debounce\";\n\nclass ContinuousViewManager extends DefaultViewManager {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.name = \"continuous\";\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\toverflow: undefined,\n\t\t\taxis: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\toffset: 500,\n\t\t\toffsetDelta: 250,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsnap: false,\n\t\t\tafterScrolledTimeout: 10\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\t// Gap can be 0, but defaults doesn't handle that\n\t\tif (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\n\t\t\tthis.settings.gap = options.settings.gap;\n\t\t}\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: false\n\t\t};\n\n\t\tthis.scrollTop = 0;\n\t\tthis.scrollLeft = 0;\n\t}\n\n\tdisplay(section, target){\n\t\treturn DefaultViewManager.prototype.display.call(this, section, target)\n\t\t\t.then(function () {\n\t\t\t\treturn this.fill();\n\t\t\t}.bind(this));\n\t}\n\n\tfill(_full){\n\t\tvar full = _full || new defer();\n\n\t\tthis.q.enqueue(() => {\n\t\t\treturn this.check();\n\t\t}).then((result) => {\n\t\t\tif (result) {\n\t\t\t\tthis.fill(full);\n\t\t\t} else {\n\t\t\t\tfull.resolve();\n\t\t\t}\n\t\t});\n\n\t\treturn full.promise;\n\t}\n\n\tmoveTo(offset){\n\t\t// var bounds = this.stage.bounds();\n\t\t// var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tvar offsetX = 0,\n\t\t\t\toffsetY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t\toffsetY = offset.top+this.settings.offsetDelta;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\t\t\toffsetX = distX+this.settings.offsetDelta;\n\t\t}\n\n\t\tif (distX > 0 || distY > 0) {\n\t\t\tthis.scrollBy(distX, distY, true);\n\t\t}\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\t// Remove Previous Listeners if present\n\tremoveShownListeners(view){\n\n\t\t// view.off(\"shown\", this.afterDisplayed);\n\t\t// view.off(\"shown\", this.afterDisplayedAbove);\n\t\tview.onDisplayed = function(){};\n\n\t}\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\treturn view.display(this.request);\n\t}\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\n\t\treturn view;\n\t}\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t\tview.expanded = true;\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\n\t\treturn view;\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\tupdate(_offset){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.all();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tvar updating = new defer();\n\t\tvar promises = [];\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\n\t\t\tisVisible = this.isVisible(view, offset, offset, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\t// console.log(\"visible \" + view.index);\n\n\t\t\t\tif (!view.displayed) {\n\t\t\t\t\tlet displayed = view.display(this.request)\n\t\t\t\t\t\t.then(function (view) {\n\t\t\t\t\t\t\tview.show();\n\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\tview.hide();\n\t\t\t\t\t\t});\n\t\t\t\t\tpromises.push(displayed);\n\t\t\t\t} else {\n\t\t\t\t\tview.show();\n\t\t\t\t}\n\t\t\t\tvisible.push(view);\n\t\t\t} else {\n\t\t\t\tthis.q.enqueue(view.destroy.bind(view));\n\t\t\t\t// console.log(\"hidden \" + view.index);\n\n\t\t\t\tclearTimeout(this.trimTimeout);\n\t\t\t\tthis.trimTimeout = setTimeout(function(){\n\t\t\t\t\tthis.q.enqueue(this.trim.bind(this));\n\t\t\t\t}.bind(this), 250);\n\t\t\t}\n\n\t\t}\n\n\t\tif(promises.length){\n\t\t\treturn Promise.all(promises)\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tupdating.reject(err);\n\t\t\t\t});\n\t\t} else {\n\t\t\tupdating.resolve();\n\t\t\treturn updating.promise;\n\t\t}\n\n\t}\n\n\tcheck(_offsetLeft, _offsetTop){\n\t\tvar checking = new defer();\n\t\tvar newViews = [];\n\n\t\tvar horizontal = (this.settings.axis === \"horizontal\");\n\t\tvar delta = this.settings.offset || 0;\n\n\t\tif (_offsetLeft && horizontal) {\n\t\t\tdelta = _offsetLeft;\n\t\t}\n\n\t\tif (_offsetTop && !horizontal) {\n\t\t\tdelta = _offsetTop;\n\t\t}\n\n\t\tvar bounds = this._bounds; // bounds saved this until resize\n\n\t\tlet rtl = this.settings.direction === \"rtl\";\n\t\tlet dir = horizontal && rtl ? -1 : 1; //RTL reverses scrollTop\n\n\t\tvar offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n\t\tvar visibleLength = horizontal ? Math.floor(bounds.width) : bounds.height;\n\t\tvar contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n\t\tlet prepend = () => {\n\t\t\tlet first = this.views.first();\n\t\t\tlet prev = first && first.section.prev();\n\n\t\t\tif(prev) {\n\t\t\t\tnewViews.push(this.prepend(prev));\n\t\t\t}\n\t\t};\n\n\t\tlet append = () => {\n\t\t\tlet last = this.views.last();\n\t\t\tlet next = last && last.section.next();\n\n\t\t\tif(next) {\n\t\t\t\tnewViews.push(this.append(next));\n\t\t\t}\n\n\t\t};\n\n\t\tif (offset + visibleLength + delta >= contentLength) {\n\t\t\tif (horizontal && rtl) {\n\t\t\t\tprepend();\n\t\t\t} else {\n\t\t\t\tappend();\n\t\t\t}\n\t\t}\n\n\t\tif (offset - delta < 0 ) {\n\t\t\tif (horizontal && rtl) {\n\t\t\t\tappend();\n\t\t\t} else {\n\t\t\t\tprepend();\n\t\t\t}\n\t\t}\n\n\t\tlet promises = newViews.map((view) => {\n\t\t\treturn view.displayed;\n\t\t});\n\n\t\tif(newViews.length){\n\t\t\treturn Promise.all(promises)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.props.spread) {\n\t\t\t\t\t\treturn this.check();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\t// Check to see if anything new is on screen after rendering\n\t\t\t\t\treturn this.update(delta);\n\t\t\t\t}, (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.q.enqueue(function(){\n\t\t\t\tthis.update();\n\t\t\t}.bind(this));\n\t\t\tchecking.resolve(false);\n\t\t\treturn checking.promise;\n\t\t}\n\n\n\t}\n\n\ttrim(){\n\t\tvar task = new defer();\n\t\tvar displayed = this.views.displayed();\n\t\tvar first = displayed[0];\n\t\tvar last = displayed[displayed.length-1];\n\t\tvar firstIndex = this.views.indexOf(first);\n\t\tvar lastIndex = this.views.indexOf(last);\n\t\tvar above = this.views.slice(0, firstIndex);\n\t\tvar below = this.views.slice(lastIndex+1);\n\n\t\t// Erase all but last above\n\t\tfor (var i = 0; i < above.length-1; i++) {\n\t\t\tthis.erase(above[i], above);\n\t\t}\n\n\t\t// Erase all except first below\n\t\tfor (var j = 1; j < below.length; j++) {\n\t\t\tthis.erase(below[j]);\n\t\t}\n\n\t\ttask.resolve();\n\t\treturn task.promise;\n\t}\n\n\terase(view, above){ //Trim\n\n\t\tvar prevTop;\n\t\tvar prevLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tprevTop = this.container.scrollTop;\n\t\t\tprevLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tprevTop = window.scrollY;\n\t\t\tprevLeft = window.scrollX;\n\t\t}\n\n\t\tvar bounds = view.bounds();\n\n\t\tthis.views.remove(view);\n\n\t\tif(above) {\n\t\t\tif(this.settings.axis === \"vertical\") {\n\t\t\t\tthis.scrollTo(0, prevTop - bounds.height, true);\n\t\t\t} else {\n\t\t\t\tthis.scrollTo(prevLeft - Math.floor(bounds.width), 0, true);\n\t\t\t}\n\t\t}\n\n\t}\n\n\taddEventListeners(stage){\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.ignore = true;\n\t\t\t// this.scrollTo(0,0);\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tthis.addScrollListeners();\n\n\t\tif (this.isPaginated && this.settings.snap) {\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\n\t\t}\n\t}\n\n\taddScrollListeners() {\n\t\tvar scroller;\n\n\t\tthis.tick = requestAnimationFrame;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.prevScrollTop = this.container.scrollTop;\n\t\t\tthis.prevScrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tthis.prevScrollTop = window.scrollY;\n\t\t\tthis.prevScrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollDeltaVert = 0;\n\t\tthis.scrollDeltaHorz = 0;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t\tthis.scrollTop = window.scrollY;\n\t\t\tthis.scrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t\tthis._scrolled = debounce(this.scrolled.bind(this), 30);\n\t\t// this.tick.call(window, this.onScroll.bind(this));\n\n\t\tthis.didScroll = false;\n\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY * dir;\n\t\t\tscrollLeft = window.scrollX * dir;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\n\t\t\tthis._scrolled();\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t\tthis.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n\t\tthis.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n\t\tthis.prevScrollTop = scrollTop;\n\t\tthis.prevScrollLeft = scrollLeft;\n\n\t\tclearTimeout(this.scrollTimeout);\n\t\tthis.scrollTimeout = setTimeout(function(){\n\t\t\tthis.scrollDeltaVert = 0;\n\t\t\tthis.scrollDeltaHorz = 0;\n\t\t}.bind(this), 150);\n\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.didScroll = false;\n\n\t}\n\n\tscrolled() {\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\n\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\ttop: this.scrollTop,\n\t\t\tleft: this.scrollLeft\n\t\t});\n\n\t\tclearTimeout(this.afterScrolled);\n\t\tthis.afterScrolled = setTimeout(function () {\n\n\t\t\t// Don't report scroll if we are about the snap\n\t\t\tif (this.snapper && this.snapper.supportsTouch && this.snapper.needsSnap()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\ttop: this.scrollTop,\n\t\t\t\tleft: this.scrollLeft\n\t\t\t});\n\n\t\t}.bind(this), this.settings.afterScrolledTimeout);\n\t}\n\n\tnext(){\n\n\t\tlet dir = this.settings.direction;\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\n\t\t\t\t\t\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollBy(delta, 0, true);\n\n\t\t} else {\n\n\t\t\tthis.scrollBy(0, this.layout.height, true);\n\n\t\t}\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\t}\n\n\tprev(){\n\n\t\tlet dir = this.settings.direction;\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\n\t\t\t\t\t\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollBy(-delta, 0, true);\n\n\t\t} else {\n\n\t\t\tthis.scrollBy(0, -this.layout.height, true);\n\n\t\t}\n\n\t\tthis.q.enqueue(function() {\n\t\t\tthis.check();\n\t\t}.bind(this));\n\t}\n\n\t// updateAxis(axis, forceUpdate){\n\t//\n\t// \tsuper.updateAxis(axis, forceUpdate);\n\t//\n\t// \tif (axis === \"vertical\") {\n\t// \t\tthis.settings.infinite = true;\n\t// \t} else {\n\t// \t\tthis.settings.infinite = false;\n\t// \t}\n\t// }\n\n\tupdateFlow(flow){\n\t\tif (this.rendered && this.snapper) {\n\t\t\tthis.snapper.destroy();\n\t\t\tthis.snapper = undefined;\n\t\t}\n\n\t\tsuper.updateFlow(flow);\n\n\t\tif (this.rendered && this.isPaginated && this.settings.snap) {\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\n\t\t}\n\t}\n\n\tdestroy(){\n\t\tsuper.destroy();\n\n\t\tif (this.snapper) {\n\t\t\tthis.snapper.destroy();\n\t\t}\n\t}\n\n}\n\nexport default ContinuousViewManager;\n","import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: \"\",\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800,\n\t\t\tstylesheet: null,\n\t\t\tresizeOnOrientationChange: true,\n\t\t\tscript: null,\n\t\t\tsnap: false\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.book = book;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @member {object} hooks\n\t\t * @property {Hook} hooks.content\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.unloaded = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\n\n\t\tthis.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n\n\t\tif (this.settings.stylesheet) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n\t\t}\n\n\t\tif (this.settings.script) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectScript.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * @member {Themes} themes\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.themes = new Themes(this);\n\n\t\t/**\n\t\t * @member {Annotations} annotations\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.annotations = new Annotations(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\t/**\n\t\t * A Rendered Location Range\n\t\t * @typedef location\n\t\t * @type {Object}\n\t\t * @property {object} start\n\t\t * @property {string} start.index\n\t\t * @property {string} start.href\n\t\t * @property {object} start.displayed\n\t\t * @property {EpubCFI} start.cfi\n\t\t * @property {number} start.location\n\t\t * @property {number} start.percentage\n\t\t * @property {number} start.displayed.page\n\t\t * @property {number} start.displayed.total\n\t\t * @property {object} end\n\t\t * @property {string} end.index\n\t\t * @property {string} end.href\n\t\t * @property {object} end.displayed\n\t\t * @property {EpubCFI} end.cfi\n\t\t * @property {number} end.location\n\t\t * @property {number} end.percentage\n\t\t * @property {number} end.displayed.page\n\t\t * @property {number} end.displayed.total\n\t\t * @property {boolean} atStart\n\t\t * @property {boolean} atEnd\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.location = undefined;\n\n\t\t// Hold queue until book is opened\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\tthis.starting = new defer();\n\t\t/**\n\t\t * @member {promise} started returns after the rendition has started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.started = this.starting.promise;\n\t\t// Block the queue until rendering is started\n\t\tthis.q.enqueue(this.start);\n\t}\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t}\n\n\t/**\n\t * Require the manager from passed string, or as a class function\n\t * @param  {string|object} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from imported managers\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\n\t\t\tviewManager = DefaultViewManager;\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\n\t\t\tviewManager = ContinuousViewManager;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tviewManager = manager;\n\t\t}\n\n\t\treturn viewManager;\n\t}\n\n\t/**\n\t * Require the view from passed string, or as a class function\n\t * @param  {string|object} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\t// If view is a string, try to load from imported views,\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\n\t\t\tView = IframeView;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tView = view;\n\t\t}\n\n\t\treturn View;\n\t}\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\tthis.direction(this.book.package.metadata.direction);\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n\t\t// Listen for rotation\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n\t\t/**\n\t\t * Emit that rendering has started\n\t\t * @event started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t}\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Emit that rendering has attached to an element\n\t\t\t * @event attached\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\n\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\t\tif (this.displaying) {\n\t\t\tthis.displaying.resolve();\n\t\t}\n\t\treturn this.q.enqueue(this._display, target);\n\t}\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tif (!this.book) {\n\t\t\treturn;\n\t\t}\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\tthis.displaying = displaying;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length() && isFloat(target)) {\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\tthis.manager.display(section, target)\n\t\t\t.then(() => {\n\t\t\t\tdisplaying.resolve(section);\n\t\t\t\tthis.displaying = undefined;\n\n\t\t\t\t/**\n\t\t\t\t * Emit that a section has been displayed\n\t\t\t\t * @event displayed\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\n\t\t\t\tthis.reportLocation();\n\t\t\t}, (err) => {\n\t\t\t\t/**\n\t\t\t\t * Emit that has been an error displaying\n\t\t\t\t * @event displayError\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n\t\t\t});\n\n\t\treturn displayed;\n\t}\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t}\n\t*/\n\n\t/**\n\t * Report what section has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view));\n\n\t\tthis.hooks.render.trigger(view, this)\n\t\t\t.then(() => {\n\t\t\t\tif (view.contents) {\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Emit that a section has been rendered\n\t\t\t\t\t\t * @event rendered\n\t\t\t\t\t\t * @param {Section} section\n\t\t\t\t\t\t * @param {View} view\n\t\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t\t */\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Report what has been removed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterRemoved(view){\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\n\t\t\t/**\n\t\t\t * Emit that a section has been removed\n\t\t\t * @event removed\n\t\t\t * @param {Section} section\n\t\t\t * @param {View} view\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n\t\t});\n\t}\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size){\n\n\t\t/**\n\t\t * Emit that the rendition has been resized\n\t\t * @event resized\n\t\t * @param {number} width\n\t\t * @param {height} height\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t});\n\n\t\tif (this.location && this.location.start) {\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\n\t}\n\n\t/**\n\t * Report orientation events and display the last seen location\n\t * @private\n\t */\n\tonOrientationChange(orientation){\n\t\t/**\n\t\t * Emit that the rendition has been rotated\n\t\t * @event orientationchange\n\t\t * @param {string} orientation\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n\t}\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t}\n\n\t/**\n\t * Trigger a resize of the views\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tresize(width, height){\n\t\tif (width) {\n\t\t\tthis.settings.width = width;\n\t\t}\n\t\tif (height) {\n\t\t\tthis.settings.height = height;\n\t\t}\n\t\tthis.manager.resize(width, height);\n\t}\n\n\t/**\n\t * Clear all rendered views\n\t */\n\tclear(){\n\t\tthis.manager.clear();\n\t}\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\n\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\n\t\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth,\n\t\t\tdirection: direction\n\t\t};\n\n\t\treturn properties;\n\t}\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled\" ||\n\t\t\t\tflow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tthis.settings.flow = flow;\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\t// this.mapping = new Mapping(this._layout.props);\n\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n\t\t\t})\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t}\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} [min] min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis.settings.spread = spread;\n\n\t\tif (min) {\n\t\t\tthis.settings.minSpreadWidth = min;\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.spread(spread, min);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the direction of the rendition\n\t * @param  {string} dir\n\t */\n\tdirection(dir){\n\n\t\tthis.settings.direction = dir || \"ltr\";\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.direction(this.settings.direction);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Report the current location\n\t * @fires relocated\n\t * @fires locationChanged\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function reportedLocation(){\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\n\t\t\t\tvar location = this.manager.currentLocation();\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\t\tlet located = this.located(result);\n\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else if (location) {\n\t\t\t\t\tlet located = this.located(location);\n\n\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event locationChanged\n\t\t\t\t\t * @deprecated\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t * @property {number} index\n\t\t\t\t\t * @property {string} href\n\t\t\t\t\t * @property {EpubCFI} start\n\t\t\t\t\t * @property {EpubCFI} end\n\t\t\t\t\t * @property {number} percentage\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t});\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event relocated\n\t\t\t\t\t * @type {displayedLocation}\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get the Current Location object\n\t * @return {displayedLocation | promise} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tlet located = this.located(result);\n\t\t\t\treturn located;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tlet located = this.located(location);\n\t\t\treturn located;\n\t\t}\n\t}\n\n\t/**\n\t * Creates a Rendition#locationRange from location\n\t * passed by the Manager\n\t * @returns {displayedLocation}\n\t * @private\n\t */\n\tlocated(location){\n\t\tif (!location.length) {\n\t\t\treturn {};\n\t\t}\n\t\tlet start = location[0];\n\t\tlet end = location[location.length-1];\n\n\t\tlet located = {\n\t\t\tstart: {\n\t\t\t\tindex: start.index,\n\t\t\t\thref: start.href,\n\t\t\t\tcfi: start.mapping.start,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: start.pages[0] || 1,\n\t\t\t\t\ttotal: start.totalPages\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tindex: end.index,\n\t\t\t\thref: end.href,\n\t\t\t\tcfi: end.mapping.end,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: end.pages[end.pages.length-1] || 1,\n\t\t\t\t\ttotal: end.totalPages\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n\t\tif (locationStart != null) {\n\t\t\tlocated.start.location = locationStart;\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n\t\t}\n\t\tif (locationEnd != null) {\n\t\t\tlocated.end.location = locationEnd;\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n\t\t}\n\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n\t\tif (pageStart != -1) {\n\t\t\tlocated.start.page = pageStart;\n\t\t}\n\t\tif (pageEnd != -1) {\n\t\t\tlocated.end.page = pageEnd;\n\t\t}\n\n\t\tif (end.index === this.book.spine.last().index &&\n\t\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\n\t\t\tlocated.atEnd = true;\n\t\t}\n\n\t\tif (start.index === this.book.spine.first().index &&\n\t\t\t\tlocated.start.displayed.page === 1) {\n\t\t\tlocated.atStart = true;\n\t\t}\n\n\t\treturn located;\n\t}\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\t// this.q.clear();\n\t\t// this.q = undefined;\n\n\t\tthis.manager && this.manager.destroy();\n\n\t\tthis.book = undefined;\n\n\t\t// this.views = null;\n\n\t\t// this.hooks.display.clear();\n\t\t// this.hooks.serialize.clear();\n\t\t// this.hooks.content.clear();\n\t\t// this.hooks.layout.clear();\n\t\t// this.hooks.render.clear();\n\t\t// this.hooks.show.clear();\n\t\t// this.hooks = {};\n\n\t\t// this.themes.destroy();\n\t\t// this.themes = undefined;\n\n\t\t// this.epubcfi = undefined;\n\n\t\t// this.starting = undefined;\n\t\t// this.started = undefined;\n\n\n\t}\n\n\t/**\n\t * Pass the events from a view's Contents\n\t * @private\n\t * @param  {Contents} view contents\n\t */\n\tpassEvents(contents){\n\t\tDOM_EVENTS.forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\n\t}\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange, contents){\n\t\t/**\n\t\t * Emit that a text selection has occured\n\t\t * @event selected\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n\t}\n\n\t/**\n\t * Emit a markClicked event with the cfiRange and data from a mark\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerMarkEvent(cfiRange, data, contents){\n\t\t/**\n\t\t * Emit that a mark was clicked\n\t\t * @event markClicked\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {object} data\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n\t}\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\tgetRange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.manager.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\n\t\t}\n\t}\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\tadjustImages(contents) {\n\n\t\tif (this._layout.name === \"pre-paginated\") {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n\n\t\tcontents.addStylesheetRules({\n\t\t\t\"img\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"object-fit\": \"contain\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\",\n\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t},\n\t\t\t\"svg\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\"\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Get the Contents object of each rendered view\n\t * @returns {Contents[]}\n\t */\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t}\n\n\t/**\n\t * Get the views member from the manager\n\t * @returns {Views}\n\t */\n\tviews () {\n\t\tlet views = this.manager ? this.manager.views : undefined;\n\t\treturn views || [];\n\t}\n\n\t/**\n\t * Hook to handle link clicks in rendered content\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\thandleLinks(contents) {\n\t\tif (contents) {\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\n\t\t\t\tlet relative = this.book.path.relative(href);\n\t\t\t\tthis.display(relative);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook to handle injecting stylesheet before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectStylesheet(doc, section) {\n\t\tlet style = doc.createElement(\"link\");\n\t\tstyle.setAttribute(\"type\", \"text/css\");\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\n\t}\n\n\t/**\n\t * Hook to handle injecting scripts before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectScript(doc, section) {\n\t\tlet script = doc.createElement(\"script\");\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", this.settings.script);\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n\t/**\n\t * Hook to handle the document identifier before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectIdentifier(doc, section) {\n\t\tlet ident = this.book.packaging.metadata.identifier;\n\t\tlet meta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\t\tif (ident) {\n\t\t\tmeta.setAttribute(\"content\", ident);\n\t\t}\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\n\t}\n\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n","import {defer, isXml, parse} from \"./core\";\nimport Path from \"./path\";\n\nfunction request(url, type, withCredentials, headers) {\n\tvar supportsURL = (typeof window != \"undefined\") ? window.URL : false; // TODO: fallback for url if window isn't defined\n\tvar BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\n\n\tvar deferred = new defer();\n\n\tvar xhr = new XMLHttpRequest();\n\n\t//-- Check from PDF.js:\n\t//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\n\tvar xhrPrototype = XMLHttpRequest.prototype;\n\n\tvar header;\n\n\tif (!(\"overrideMimeType\" in xhrPrototype)) {\n\t\t// IE10 might have response, but not overrideMimeType\n\t\tObject.defineProperty(xhrPrototype, \"overrideMimeType\", {\n\t\t\tvalue: function xmlHttpRequestOverrideMimeType() {}\n\t\t});\n\t}\n\n\tif(withCredentials) {\n\t\txhr.withCredentials = true;\n\t}\n\n\txhr.onreadystatechange = handler;\n\txhr.onerror = err;\n\n\txhr.open(\"GET\", url, true);\n\n\tfor(header in headers) {\n\t\txhr.setRequestHeader(header, headers[header]);\n\t}\n\n\tif(type == \"json\") {\n\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\n\t}\n\n\t// If type isn\"t set, determine it from the file extension\n\tif(!type) {\n\t\ttype = new Path(url).extension;\n\t}\n\n\tif(type == \"blob\"){\n\t\txhr.responseType = BLOB_RESPONSE;\n\t}\n\n\n\tif(isXml(type)) {\n\t\t// xhr.responseType = \"document\";\n\t\txhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n\t}\n\n\tif(type == \"xhtml\") {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == \"html\" || type == \"htm\") {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == \"binary\") {\n\t\txhr.responseType = \"arraybuffer\";\n\t}\n\n\txhr.send();\n\n\tfunction err(e) {\n\t\tdeferred.reject(e);\n\t}\n\n\tfunction handler() {\n\t\tif (this.readyState === XMLHttpRequest.DONE) {\n\t\t\tvar responseXML = false;\n\n\t\t\tif(this.responseType === \"\" || this.responseType === \"document\") {\n\t\t\t\tresponseXML = this.responseXML;\n\t\t\t}\n\n\t\t\tif (this.status === 200 || this.status === 0 || responseXML) { //-- Firefox is reporting 0 for blob urls\n\t\t\t\tvar r;\n\n\t\t\t\tif (!this.response && !responseXML) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tmessage : \"Empty Response\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tif (this.status === 403) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tresponse: this.response,\n\t\t\t\t\t\tmessage : \"Forbidden\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\t\t\t\tif(responseXML){\n\t\t\t\t\tr = this.responseXML;\n\t\t\t\t} else\n\t\t\t\tif(isXml(type)){\n\t\t\t\t\t// xhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n\t\t\t\t\t// If this.responseXML wasn't set, try to parse using a DOMParser from text\n\t\t\t\t\tr = parse(this.response, \"text/xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"xhtml\"){\n\t\t\t\t\tr = parse(this.response, \"application/xhtml+xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"html\" || type == \"htm\"){\n\t\t\t\t\tr = parse(this.response, \"text/html\");\n\t\t\t\t}else\n\t\t\t\tif(type == \"json\"){\n\t\t\t\t\tr = JSON.parse(this.response);\n\t\t\t\t}else\n\t\t\t\tif(type == \"blob\"){\n\n\t\t\t\t\tif(supportsURL) {\n\t\t\t\t\t\tr = this.response;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//-- Safari doesn't support responseType blob, so create a blob from arraybuffer\n\t\t\t\t\t\tr = new Blob([this.response]);\n\t\t\t\t\t}\n\n\t\t\t\t}else{\n\t\t\t\t\tr = this.response;\n\t\t\t\t}\n\n\t\t\t\tdeferred.resolve(r);\n\t\t\t} else {\n\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tstatus: this.status,\n\t\t\t\t\tmessage : this.response,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t}\n\n\treturn deferred.promise;\n}\n\nexport default request;\n","import {defer, isXml, parse} from \"./utils/core\";\nimport request from \"./utils/request\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\n\n/**\n * Handles Unzipping a requesting files from an Epub Archive\n * @class\n */\nclass Archive {\n\n\tconstructor() {\n\t\tthis.zip = undefined;\n\t\tthis.urlCache = {};\n\n\t\tthis.checkRequirements();\n\n\t}\n\n\t/**\n\t * Checks to see if JSZip exists in global namspace,\n\t * Requires JSZip if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tif (typeof JSZip === \"undefined\") {\n\t\t\t\tlet JSZip = require(\"jszip\");\n\t\t\t\tthis.zip = new JSZip();\n\t\t\t} else {\n\t\t\t\tthis.zip = new JSZip();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"JSZip lib not loaded\");\n\t\t}\n\t}\n\n\t/**\n\t * Open an archive\n\t * @param  {binary} input\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topen(input, isBase64){\n\t\treturn this.zip.loadAsync(input, {\"base64\": isBase64});\n\t}\n\n\t/**\n\t * Load and Open an archive\n\t * @param  {string} zipUrl\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topenUrl(zipUrl, isBase64){\n\t\treturn request(zipUrl, \"binary\")\n\t\t\t.then(function(data){\n\t\t\t\treturn this.zip.loadAsync(data, {\"base64\": isBase64});\n\t\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Request a url from the archive\n\t * @param  {string} url  a url to request from the archive\n\t * @param  {string} [type] specify the type of the returned result\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\trequest(url, type){\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == \"blob\"){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\t\tif (response) {\n\t\t\tresponse.then(function (r) {\n\t\t\t\tlet result = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {string} [type]\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"xhtml\") {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"html\" || type == \"htm\") {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t}\n\n\t/**\n\t * Get a Blob from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"uint8array\").then(function(uint8array) {\n\t\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get Text from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [encoding]\n\t * @return {string}\n\t */\n\tgetText(url, encoding){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\treturn entry.async(\"string\").then(function(text) {\n\t\t\t\treturn text;\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get a base64 encoded result from Archive by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"base64\").then(function(data) {\n\t\t\t\treturn \"data:\" + mimeType + \";base64,\" + data;\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Create a Url from an unarchived item\n\t * @param  {string} url\n\t * @param  {object} [options.base64] use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the archive\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t}\n\n\tdestroy() {\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tfor (let fromCache in this.urlCache) {\n\t\t\t_URL.revokeObjectURL(fromCache);\n\t\t}\n\t\tthis.zip = undefined;\n\t\tthis.urlCache = {};\n\t}\n}\n\nexport default Archive;\n","import {defer, isXml, parse} from \"./utils/core\";\nimport httpRequest from \"./utils/request\";\nimport mime from \"../libs/mime/mime\";\nimport Path from \"./utils/path\";\nimport EventEmitter from \"event-emitter\";\n\n/**\n * Handles saving and requesting files from local storage\n * @class\n * @param {string} name This should be the name of the application for modals\n * @param {function} [requester]\n * @param {function} [resolver]\n */\nclass Store {\n\n\tconstructor(name, requester, resolver) {\n\t\tthis.urlCache = {};\n\n\t\tthis.storage = undefined;\n\n\t\tthis.name = name;\n\t\tthis.requester = requester || httpRequest;\n\t\tthis.resolver = resolver;\n\n\t\tthis.online = true;\n\n\t\tthis.checkRequirements();\n\n\t\tthis.addListeners();\n\t}\n\n\t/**\n\t * Checks to see if localForage exists in global namspace,\n\t * Requires localForage if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tlet store;\n\t\t\tif (typeof localforage === \"undefined\") {\n\t\t\t\tstore = require(\"localforage\");\n\t\t\t} else {\n\t\t\t\tstore = localforage;\n\t\t\t}\n\t\t\tthis.storage = store.createInstance({\n\t\t\t\t\tname: this.name\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"localForage lib not loaded\");\n\t\t}\n\t}\n\n\t/**\n\t * Add online and offline event listeners\n\t * @private\n\t */\n\taddListeners() {\n\t\tthis._status = this.status.bind(this);\n\t\twindow.addEventListener('online',  this._status);\n\t  window.addEventListener('offline', this._status);\n\t}\n\n\t/**\n\t * Remove online and offline event listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\t\twindow.removeEventListener('online',  this._status);\n\t  window.removeEventListener('offline', this._status);\n\t\tthis._status = undefined;\n\t}\n\n\t/**\n\t * Update the online / offline status\n\t * @private\n\t */\n\tstatus(event) {\n\t\tlet online = navigator.onLine;\n\t\tthis.online = online;\n\t\tif (online) {\n\t\t\tthis.emit(\"online\", this);\n\t\t} else {\n\t\t\tthis.emit(\"offline\", this);\n\t\t}\n\t}\n\n\t/**\n\t * Add all of a book resources to the store\n\t * @param  {Resources} resources  book resources\n\t * @param  {boolean} [force] force resaving resources\n\t * @return {Promise<object>} store objects\n\t */\n\tadd(resources, force) {\n\t\tlet mapped = resources.resources.map((item) => {\n\t\t\tlet { href } = item;\n\t\t\tlet url = this.resolver(href);\n\t\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\t\treturn this.storage.getItem(encodedUrl).then((item) => {\n\t\t\t\tif (!item || force) {\n\t\t\t\t\treturn this.requester(url, \"binary\")\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t\treturn Promise.all(mapped);\n\t}\n\n\t/**\n\t * Put binary data from a url to storage\n\t * @param  {string} url  a url to request from storage\n\t * @param  {boolean} [withCredentials]\n\t * @param  {object} [headers]\n\t * @return {Promise<Blob>}\n\t */\n\tput(url, withCredentials, headers) {\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then((result) => {\n\t\t\tif (!result) {\n\t\t\t\treturn this.requester(url, \"binary\", withCredentials, headers).then((data) => {\n\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t/**\n\t * Request a url\n\t * @param  {string} url  a url to request from storage\n\t * @param  {string} [type] specify the type of the returned result\n\t * @param  {boolean} [withCredentials]\n\t * @param  {object} [headers]\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\trequest(url, type, withCredentials, headers){\n\t\tif (this.online) {\n\t\t\t// From network\n\t\t\treturn this.requester(url, type, withCredentials, headers).then((data) => {\n\t\t\t\t// save to store if not present\n\t\t\t\tthis.put(url);\n\t\t\t\treturn data;\n\t\t\t})\n\t\t} else {\n\t\t\t// From store\n\t\t\treturn this.retrieve(url, type);\n\t\t}\n\n\t}\n\n\t/**\n\t * Request a url from storage\n\t * @param  {string} url  a url to request from storage\n\t * @param  {string} [type] specify the type of the returned result\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n\t */\n\tretrieve(url, type) {\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == \"blob\"){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\n\t\treturn response.then((r) => {\n\t\t\tvar deferred = new defer();\n\t\t\tvar result;\n\t\t\tif (r) {\n\t\t\t\tresult = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t} else {\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tmessage : \"File not found in storage: \" + url,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {string} [type]\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"xhtml\") {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == \"html\" || type == \"htm\") {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t}\n\n\t/**\n\t * Get a Blob from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\n\t\t\tif(!uint8array) return;\n\n\t\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t});\n\n\t}\n\n\t/**\n\t * Get Text from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string}\n\t */\n\tgetText(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\n\t\t\tvar deferred = new defer();\n\t\t\tvar reader = new FileReader();\n\t\t\tvar blob;\n\n\t\t\tif(!uint8array) return;\n\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\n\n\t\t\treader.addEventListener(\"loadend\", () => {\n\t\t\t\tdeferred.resolve(reader.result);\n\t\t\t});\n\n\t\t\treader.readAsText(blob, mimeType);\n\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Get a base64 encoded result from Storage by Url\n\t * @param  {string} url\n\t * @param  {string} [mimeType]\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tlet encodedUrl = window.encodeURIComponent(url);\n\n\t\tmimeType = mimeType || mime.lookup(url);\n\n\t\treturn this.storage.getItem(encodedUrl).then((uint8array) => {\n\t\t\tvar deferred = new defer();\n\t\t\tvar reader = new FileReader();\n\t\t\tvar blob;\n\n\t\t\tif(!uint8array) return;\n\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\n\n\t\t\treader.addEventListener(\"loadend\", () => {\n\t\t\t\tdeferred.resolve(reader.result);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob, mimeType);\n\n\t\t\treturn deferred.promise;\n\t\t});\n\t}\n\n\t/**\n\t * Create a Url from a stored item\n\t * @param  {string} url\n\t * @param  {object} [options.base64] use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in storage: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the store\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t}\n\n\tdestroy() {\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tfor (let fromCache in this.urlCache) {\n\t\t\t_URL.revokeObjectURL(fromCache);\n\t\t}\n\t\tthis.urlCache = {};\n\t\tthis.removeListeners();\n\t}\n}\n\nEventEmitter(Store.prototype);\n\nexport default Store;\n","import EventEmitter from \"event-emitter\";\nimport {extend, defer} from \"./utils/core\";\nimport Url from \"./utils/url\";\nimport Path from \"./utils/path\";\nimport Spine from \"./spine\";\nimport Locations from \"./locations\";\nimport Container from \"./container\";\nimport Packaging from \"./packaging\";\nimport Navigation from \"./navigation\";\nimport Resources from \"./resources\";\nimport PageList from \"./pagelist\";\nimport Rendition from \"./rendition\";\nimport Archive from \"./archive\";\nimport request from \"./utils/request\";\nimport EpubCFI from \"./epubcfi\";\nimport Store from \"./store\";\nimport { EPUBJS_VERSION, EVENTS } from \"./utils/constants\";\n\nconst CONTAINER_PATH = \"META-INF/container.xml\";\n\nconst INPUT_TYPE = {\n\tBINARY: \"binary\",\n\tBASE64: \"base64\",\n\tEPUB: \"epub\",\n\tOPF: \"opf\",\n\tMANIFEST: \"json\",\n\tDIRECTORY: \"directory\"\n};\n\n/**\n * An Epub representation with methods for the loading, parsing and manipulation\n * of its contents.\n * @class\n * @param {string} [url]\n * @param {object} [options]\n * @param {method} [options.requestMethod] a request function to use instead of the default\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\n * @param {string} [options.replacements=none] use base64, blobUrl, or none for replacing assets in archived Epubs\n * @param {method} [options.canonical] optional function to determine canonical urls for a path\n * @param {string} [options.openAs] optional string to determine the input type\n * @param {string} [options.store=false] cache the contents in local storage, value should be the name of the reader\n * @returns {Book}\n * @example new Book(\"/path/to/book.epub\", {})\n * @example new Book({ replacements: \"blobUrl\" })\n */\nclass Book {\n\tconstructor(url, options) {\n\t\t// Allow passing just options to the Book\n\t\tif (typeof(options) === \"undefined\" &&\n\t\t\t  typeof(url) !== \"string\" &&\n\t\t    url instanceof Blob === false) {\n\t\t\toptions = url;\n\t\t\turl = undefined;\n\t\t}\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\trequestMethod: undefined,\n\t\t\trequestCredentials: undefined,\n\t\t\trequestHeaders: undefined,\n\t\t\tencoding: undefined,\n\t\t\treplacements: undefined,\n\t\t\tcanonical: undefined,\n\t\t\topenAs: undefined,\n\t\t\tstore: undefined\n\t\t});\n\n\t\textend(this.settings, options);\n\n\n\t\t// Promises\n\t\tthis.opening = new defer();\n\t\t/**\n\t\t * @member {promise} opened returns after the book is loaded\n\t\t * @memberof Book\n\t\t */\n\t\tthis.opened = this.opening.promise;\n\t\tthis.isOpen = false;\n\n\t\tthis.loading = {\n\t\t\tmanifest: new defer(),\n\t\t\tspine: new defer(),\n\t\t\tmetadata: new defer(),\n\t\t\tcover: new defer(),\n\t\t\tnavigation: new defer(),\n\t\t\tpageList: new defer(),\n\t\t\tresources: new defer()\n\t\t};\n\n\t\tthis.loaded = {\n\t\t\tmanifest: this.loading.manifest.promise,\n\t\t\tspine: this.loading.spine.promise,\n\t\t\tmetadata: this.loading.metadata.promise,\n\t\t\tcover: this.loading.cover.promise,\n\t\t\tnavigation: this.loading.navigation.promise,\n\t\t\tpageList: this.loading.pageList.promise,\n\t\t\tresources: this.loading.resources.promise\n\t\t};\n\n\t\t/**\n\t\t * @member {promise} ready returns after the book is loaded and parsed\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.ready = Promise.all([\n\t\t\tthis.loaded.manifest,\n\t\t\tthis.loaded.spine,\n\t\t\tthis.loaded.metadata,\n\t\t\tthis.loaded.cover,\n\t\t\tthis.loaded.navigation,\n\t\t\tthis.loaded.resources\n\t\t]);\n\n\n\t\t// Queue for methods used before opening\n\t\tthis.isRendered = false;\n\t\t// this._q = queue(this);\n\n\t\t/**\n\t\t * @member {method} request\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.request = this.settings.requestMethod || request;\n\n\t\t/**\n\t\t * @member {Spine} spine\n\t\t * @memberof Book\n\t\t */\n\t\tthis.spine = new Spine();\n\n\t\t/**\n\t\t * @member {Locations} locations\n\t\t * @memberof Book\n\t\t */\n\t\tthis.locations = new Locations(this.spine, this.load.bind(this));\n\n\t\t/**\n\t\t * @member {Navigation} navigation\n\t\t * @memberof Book\n\t\t */\n\t\tthis.navigation = undefined;\n\n\t\t/**\n\t\t * @member {PageList} pagelist\n\t\t * @memberof Book\n\t\t */\n\t\tthis.pageList = undefined;\n\n\t\t/**\n\t\t * @member {Url} url\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.url = undefined;\n\n\t\t/**\n\t\t * @member {Path} path\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.path = undefined;\n\n\t\t/**\n\t\t * @member {boolean} archived\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.archived = false;\n\n\t\t/**\n\t\t * @member {Archive} archive\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.archive = undefined;\n\n\t\t/**\n\t\t * @member {Store} storage\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.storage = undefined;\n\n\t\t/**\n\t\t * @member {Resources} resources\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.resources = undefined;\n\n\t\t/**\n\t\t * @member {Rendition} rendition\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.rendition = undefined;\n\n\t\t/**\n\t\t * @member {Container} container\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.container = undefined;\n\n\t\t/**\n\t\t * @member {Packaging} packaging\n\t\t * @memberof Book\n\t\t * @private\n\t\t */\n\t\tthis.packaging = undefined;\n\n\t\t// this.toc = undefined;\n\t\tif (this.settings.store) {\n\t\t\tthis.store(this.settings.store);\n\t\t}\n\n\t\tif(url) {\n\t\t\tthis.open(url, this.settings.openAs).catch((error) => {\n\t\t\t\tvar err = new Error(\"Cannot load book at \"+ url );\n\t\t\t\tthis.emit(EVENTS.BOOK.OPEN_FAILED, err);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Open a epub or url\n\t * @param {string | ArrayBuffer} input Url, Path or ArrayBuffer\n\t * @param {string} [what=\"binary\", \"base64\", \"epub\", \"opf\", \"json\", \"directory\"] force opening as a certain type\n\t * @returns {Promise} of when the book has been loaded\n\t * @example book.open(\"/path/to/book.epub\")\n\t */\n\topen(input, what) {\n\t\tvar opening;\n\t\tvar type = what || this.determineType(input);\n\n\t\tif (type === INPUT_TYPE.BINARY) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input);\n\t\t} else if (type === INPUT_TYPE.BASE64) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input, type);\n\t\t} else if (type === INPUT_TYPE.EPUB) {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.request(input, \"binary\", this.settings.requestCredentials)\n\t\t\t\t.then(this.openEpub.bind(this));\n\t\t} else if(type == INPUT_TYPE.OPF) {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openPackaging(this.url.Path.toString());\n\t\t} else if(type == INPUT_TYPE.MANIFEST) {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openManifest(this.url.Path.toString());\n\t\t} else {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openContainer(CONTAINER_PATH)\n\t\t\t\t.then(this.openPackaging.bind(this));\n\t\t}\n\n\t\treturn opening;\n\t}\n\n\t/**\n\t * Open an archived epub\n\t * @private\n\t * @param  {binary} data\n\t * @param  {string} [encoding]\n\t * @return {Promise}\n\t */\n\topenEpub(data, encoding) {\n\t\treturn this.unarchive(data, encoding || this.settings.encoding)\n\t\t\t.then(() => {\n\t\t\t\treturn this.openContainer(CONTAINER_PATH);\n\t\t\t})\n\t\t\t.then((packagePath) => {\n\t\t\t\treturn this.openPackaging(packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the epub container\n\t * @private\n\t * @param  {string} url\n\t * @return {string} packagePath\n\t */\n\topenContainer(url) {\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.container = new Container(xml);\n\t\t\t\treturn this.resolve(this.container.packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the Open Packaging Format Xml\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenPackaging(url) {\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.packaging = new Packaging(xml);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the manifest JSON\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenManifest(url) {\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((json) => {\n\t\t\t\tthis.packaging = new Packaging();\n\t\t\t\tthis.packaging.load(json);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Load a resource from the Book\n\t * @param  {string} path path to the resource to load\n\t * @return {Promise}     returns a promise with the requested resource\n\t */\n\tload(path) {\n\t\tvar resolved = this.resolve(path);\n\t\tif(this.archived) {\n\t\t\treturn this.archive.request(resolved);\n\t\t} else {\n\t\t\treturn this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\n\t\t}\n\t}\n\n\t/**\n\t * Resolve a path to it's absolute position in the Book\n\t * @param  {string} path\n\t * @param  {boolean} [absolute] force resolving the full URL\n\t * @return {string}          the resolved path string\n\t */\n\tresolve(path, absolute) {\n\t\tif (!path) {\n\t\t\treturn;\n\t\t}\n\t\tvar resolved = path;\n\t\tvar isAbsolute = (path.indexOf(\"://\") > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (this.path) {\n\t\t\tresolved = this.path.resolve(path);\n\t\t}\n\n\t\tif(absolute != false && this.url) {\n\t\t\tresolved = this.url.resolve(resolved);\n\t\t}\n\n\t\treturn resolved;\n\t}\n\n\t/**\n\t * Get a canonical link to a path\n\t * @param  {string} path\n\t * @return {string} the canonical path string\n\t */\n\tcanonical(path) {\n\t\tvar url = path;\n\n\t\tif (!path) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (this.settings.canonical) {\n\t\t\turl = this.settings.canonical(path);\n\t\t} else {\n\t\t\turl = this.resolve(path, true);\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t/**\n\t * Determine the type of they input passed to open\n\t * @private\n\t * @param  {string} input\n\t * @return {string}  binary | directory | epub | opf\n\t */\n\tdetermineType(input) {\n\t\tvar url;\n\t\tvar path;\n\t\tvar extension;\n\n\t\tif (this.settings.encoding === \"base64\") {\n\t\t\treturn INPUT_TYPE.BASE64;\n\t\t}\n\n\t\tif(typeof(input) != \"string\") {\n\t\t\treturn INPUT_TYPE.BINARY;\n\t\t}\n\n\t\turl = new Url(input);\n\t\tpath = url.path();\n\t\textension = path.extension;\n\n\t\tif (!extension) {\n\t\t\treturn INPUT_TYPE.DIRECTORY;\n\t\t}\n\n\t\tif(extension === \"epub\"){\n\t\t\treturn INPUT_TYPE.EPUB;\n\t\t}\n\n\t\tif(extension === \"opf\"){\n\t\t\treturn INPUT_TYPE.OPF;\n\t\t}\n\n\t\tif(extension === \"json\"){\n\t\t\treturn INPUT_TYPE.MANIFEST;\n\t\t}\n\t}\n\n\n\t/**\n\t * unpack the contents of the Books packaging\n\t * @private\n\t * @param {Packaging} packaging object\n\t */\n\tunpack(packaging) {\n\t\tthis.package = packaging; //TODO: deprecated this\n\n\t\tthis.spine.unpack(this.packaging, this.resolve.bind(this), this.canonical.bind(this));\n\n\t\tthis.resources = new Resources(this.packaging.manifest, {\n\t\t\tarchive: this.archive,\n\t\t\tresolver: this.resolve.bind(this),\n\t\t\trequest: this.request.bind(this),\n\t\t\treplacements: this.settings.replacements || (this.archived ? \"blobUrl\" : \"base64\")\n\t\t});\n\n\t\tthis.loadNavigation(this.packaging).then(() => {\n\t\t\t// this.toc = this.navigation.toc;\n\t\t\tthis.loading.navigation.resolve(this.navigation);\n\t\t});\n\n\t\tif (this.packaging.coverPath) {\n\t\t\tthis.cover = this.resolve(this.packaging.coverPath);\n\t\t}\n\t\t// Resolve promises\n\t\tthis.loading.manifest.resolve(this.packaging.manifest);\n\t\tthis.loading.metadata.resolve(this.packaging.metadata);\n\t\tthis.loading.spine.resolve(this.spine);\n\t\tthis.loading.cover.resolve(this.cover);\n\t\tthis.loading.resources.resolve(this.resources);\n\t\tthis.loading.pageList.resolve(this.pageList);\n\n\t\tthis.isOpen = true;\n\n\t\tif(this.archived || this.settings.replacements && this.settings.replacements != \"none\") {\n\t\t\tthis.replacements().then(() => {\n\t\t\t\tthis.opening.resolve(this);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\t} else {\n\t\t\t// Resolve book opened promise\n\t\t\tthis.opening.resolve(this);\n\t\t}\n\n\t}\n\n\t/**\n\t * Load Navigation and PageList from package\n\t * @private\n\t * @param {Packaging} packaging\n\t */\n\tloadNavigation(packaging) {\n\t\tlet navPath = packaging.navPath || packaging.ncxPath;\n\t\tlet toc = packaging.toc;\n\n\t\t// From json manifest\n\t\tif (toc) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.navigation = new Navigation(toc);\n\n\t\t\t\tif (packaging.pageList) {\n\t\t\t\t\tthis.pageList = new PageList(packaging.pageList); // TODO: handle page lists from Manifest\n\t\t\t\t}\n\n\t\t\t\tresolve(this.navigation);\n\t\t\t});\n\t\t}\n\n\t\tif (!navPath) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.navigation = new Navigation();\n\t\t\t\tthis.pageList = new PageList();\n\n\t\t\t\tresolve(this.navigation);\n\t\t\t});\n\t\t}\n\n\t\treturn this.load(navPath, \"xml\")\n\t\t\t.then((xml) => {\n\t\t\t\tthis.navigation = new Navigation(xml);\n\t\t\t\tthis.pageList = new PageList(xml);\n\t\t\t\treturn this.navigation;\n\t\t\t});\n\t}\n\n\t/**\n\t * Gets a Section of the Book from the Spine\n\t * Alias for `book.spine.get`\n\t * @param {string} target\n\t * @return {Section}\n\t */\n\tsection(target) {\n\t\treturn this.spine.get(target);\n\t}\n\n\t/**\n\t * Sugar to render a book to an element\n\t * @param  {element | string} element element or string to add a rendition to\n\t * @param  {object} [options]\n\t * @return {Rendition}\n\t */\n\trenderTo(element, options) {\n\t\tthis.rendition = new Rendition(this, options);\n\t\tthis.rendition.attachTo(element);\n\n\t\treturn this.rendition;\n\t}\n\n\t/**\n\t * Set if request should use withCredentials\n\t * @param {boolean} credentials\n\t */\n\tsetRequestCredentials(credentials) {\n\t\tthis.settings.requestCredentials = credentials;\n\t}\n\n\t/**\n\t * Set headers request should use\n\t * @param {object} headers\n\t */\n\tsetRequestHeaders(headers) {\n\t\tthis.settings.requestHeaders = headers;\n\t}\n\n\t/**\n\t * Unarchive a zipped epub\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {string} [encoding]\n\t * @return {Archive}\n\t */\n\tunarchive(input, encoding) {\n\t\tthis.archive = new Archive();\n\t\treturn this.archive.open(input, encoding);\n\t}\n\n\t/**\n\t * Store the epubs contents\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {string} [encoding]\n\t * @return {Store}\n\t */\n\tstore(name) {\n\t\t// Use \"blobUrl\" or \"base64\" for replacements\n\t\tlet replacementsSetting = this.settings.replacements && this.settings.replacements !== \"none\";\n\t\t// Save original url\n\t\tlet originalUrl = this.url;\n\t\t// Save original request method\n\t\tlet requester = this.settings.requestMethod || request.bind(this);\n\t\t// Create new Store\n\t\tthis.storage = new Store(name, requester, this.resolve.bind(this));\n\t\t// Replace request method to go through store\n\t\tthis.request = this.storage.request.bind(this.storage);\n\n\t\tthis.opened.then(() => {\n\t\t\tif (this.archived) {\n\t\t\t\tthis.storage.requester = this.archive.request.bind(this.archive);\n\t\t\t}\n\t\t\t// Substitute hook\n\t\t\tlet substituteResources = (output, section) => {\n\t\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t\t};\n\n\t\t\t// Set to use replacements\n\t\t\tthis.resources.settings.replacements = replacementsSetting || \"blobUrl\";\n\t\t\t// Create replacement urls\n\t\t\tthis.resources.replacements().\n\t\t\t\tthen(() => {\n\t\t\t\t\treturn this.resources.replaceCss();\n\t\t\t\t});\n\n\t\t\tthis.storage.on(\"offline\", () => {\n\t\t\t\t// Remove url to use relative resolving for hrefs\n\t\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\t\t// Add hook to replace resources in contents\n\t\t\t\tthis.spine.hooks.serialize.register(substituteResources);\n\t\t\t});\n\n\t\t\tthis.storage.on(\"online\", () => {\n\t\t\t\t// Restore original url\n\t\t\t\tthis.url = originalUrl;\n\t\t\t\t// Remove hook\n\t\t\t\tthis.spine.hooks.serialize.deregister(substituteResources);\n\t\t\t});\n\n\t\t});\n\n\t\treturn this.storage;\n\t}\n\n\t/**\n\t * Get the cover url\n\t * @return {string} coverUrl\n\t */\n\tcoverUrl() {\n\t\tvar retrieved = this.loaded.cover.\n\t\t\tthen((url) => {\n\t\t\t\tif(this.archived) {\n\t\t\t\t\t// return this.archive.createUrl(this.cover);\n\t\t\t\t\treturn this.resources.get(this.cover);\n\t\t\t\t}else{\n\t\t\t\t\treturn this.cover;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn retrieved;\n\t}\n\n\t/**\n\t * Load replacement urls\n\t * @private\n\t * @return {Promise} completed loading urls\n\t */\n\treplacements() {\n\t\tthis.spine.hooks.serialize.register((output, section) => {\n\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t});\n\n\t\treturn this.resources.replacements().\n\t\t\tthen(() => {\n\t\t\t\treturn this.resources.replaceCss();\n\t\t\t});\n\t}\n\n\t/**\n\t * Find a DOM Range for a given CFI Range\n\t * @param  {EpubCFI} cfiRange a epub cfi range\n\t * @return {Range}\n\t */\n\tgetRange(cfiRange) {\n\t\tvar cfi = new EpubCFI(cfiRange);\n\t\tvar item = this.spine.get(cfi.spinePos);\n\t\tvar _request = this.load.bind(this);\n\t\tif (!item) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\treject(\"CFI could not be found\");\n\t\t\t});\n\t\t}\n\t\treturn item.load(_request).then(function (contents) {\n\t\t\tvar range = cfi.toRange(item.document);\n\t\t\treturn range;\n\t\t});\n\t}\n\n\t/**\n\t * Generates the Book Key using the identifer in the manifest or other string provided\n\t * @param  {string} [identifier] to use instead of metadata identifier\n\t * @return {string} key\n\t */\n\tkey(identifier) {\n\t\tvar ident = identifier || this.packaging.metadata.identifier || this.url.filename;\n\t\treturn `epubjs:${EPUBJS_VERSION}:${ident}`;\n\t}\n\n\t/**\n\t * Destroy the Book and all associated objects\n\t */\n\tdestroy() {\n\t\tthis.opened = undefined;\n\t\tthis.loading = undefined;\n\t\tthis.loaded = undefined;\n\t\tthis.ready = undefined;\n\n\t\tthis.isOpen = false;\n\t\tthis.isRendered = false;\n\n\t\tthis.spine && this.spine.destroy();\n\t\tthis.locations && this.locations.destroy();\n\t\tthis.pageList && this.pageList.destroy();\n\t\tthis.archive && this.archive.destroy();\n\t\tthis.resources && this.resources.destroy();\n\t\tthis.container && this.container.destroy();\n\t\tthis.packaging && this.packaging.destroy();\n\t\tthis.rendition && this.rendition.destroy();\n\n\t\tthis.spine = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.pageList = undefined;\n\t\tthis.archive = undefined;\n\t\tthis.resources = undefined;\n\t\tthis.container = undefined;\n\t\tthis.packaging = undefined;\n\t\tthis.rendition = undefined;\n\n\t\tthis.navigation = undefined;\n\t\tthis.url = undefined;\n\t\tthis.path = undefined;\n\t\tthis.archived = false;\n\t}\n\n}\n\n//-- Enable binding events to book\nEventEmitter(Book.prototype);\n\nexport default Book;\n","/* From https://github.com/webcomponents/URL/blob/master/url.js\n * Added UMD, file link handling */\n\n/* Any copyright is dedicated to the Public Domain.\n * http://creativecommons.org/publicdomain/zero/1.0/ */\n'use strict';\n(function (root, factory) {\n    // Fix for this being undefined in modules\n    if (!root) {\n      root = window || global;\n    }\n    if (typeof module === 'object' && module.exports) {\n        // Node\n        module.exports = factory(root);\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else {\n        // Browser globals (root is window)\n        root.URL = factory(root);\n  }\n}(this, function (scope) {\n  // feature detect for URL constructor\n  var hasWorkingUrl = false;\n  if (!scope.forceJURL) {\n    try {\n      var u = new URL('b', 'http://a');\n      u.pathname = 'c%20d';\n      hasWorkingUrl = u.href === 'http://a/c%20d';\n    } catch(e) {}\n  }\n\n  if (hasWorkingUrl)\n    return scope.URL;\n\n  var relative = Object.create(null);\n  relative['ftp'] = 21;\n  relative['file'] = 0;\n  relative['gopher'] = 70;\n  relative['http'] = 80;\n  relative['https'] = 443;\n  relative['ws'] = 80;\n  relative['wss'] = 443;\n\n  var relativePathDotMapping = Object.create(null);\n  relativePathDotMapping['%2e'] = '.';\n  relativePathDotMapping['.%2e'] = '..';\n  relativePathDotMapping['%2e.'] = '..';\n  relativePathDotMapping['%2e%2e'] = '..';\n\n  function isRelativeScheme(scheme) {\n    return relative[scheme] !== undefined;\n  }\n\n  function invalid() {\n    clear.call(this);\n    this._isInvalid = true;\n  }\n\n  function IDNAToASCII(h) {\n    if ('' == h) {\n      invalid.call(this)\n    }\n    // XXX\n    return h.toLowerCase()\n  }\n\n  function percentEscape(c) {\n    var unicode = c.charCodeAt(0);\n    if (unicode > 0x20 &&\n       unicode < 0x7F &&\n       // \" # < > ? `\n       [0x22, 0x23, 0x3C, 0x3E, 0x3F, 0x60].indexOf(unicode) == -1\n      ) {\n      return c;\n    }\n    return encodeURIComponent(c);\n  }\n\n  function percentEscapeQuery(c) {\n    // XXX This actually needs to encode c using encoding and then\n    // convert the bytes one-by-one.\n\n    var unicode = c.charCodeAt(0);\n    if (unicode > 0x20 &&\n       unicode < 0x7F &&\n       // \" # < > ` (do not escape '?')\n       [0x22, 0x23, 0x3C, 0x3E, 0x60].indexOf(unicode) == -1\n      ) {\n      return c;\n    }\n    return encodeURIComponent(c);\n  }\n\n  var EOF = undefined,\n      ALPHA = /[a-zA-Z]/,\n      ALPHANUMERIC = /[a-zA-Z0-9\\+\\-\\.]/;\n\n  function parse(input, stateOverride, base) {\n    function err(message) {\n      errors.push(message)\n    }\n\n    var state = stateOverride || 'scheme start',\n        cursor = 0,\n        buffer = '',\n        seenAt = false,\n        seenBracket = false,\n        errors = [];\n\n    loop: while ((input[cursor - 1] != EOF || cursor == 0) && !this._isInvalid) {\n      var c = input[cursor];\n      switch (state) {\n        case 'scheme start':\n          if (c && ALPHA.test(c)) {\n            buffer += c.toLowerCase(); // ASCII-safe\n            state = 'scheme';\n          } else if (!stateOverride) {\n            buffer = '';\n            state = 'no scheme';\n            continue;\n          } else {\n            err('Invalid scheme.');\n            break loop;\n          }\n          break;\n\n        case 'scheme':\n          if (c && ALPHANUMERIC.test(c)) {\n            buffer += c.toLowerCase(); // ASCII-safe\n          } else if (':' == c) {\n            this._scheme = buffer;\n            buffer = '';\n            if (stateOverride) {\n              break loop;\n            }\n            if (isRelativeScheme(this._scheme)) {\n              this._isRelative = true;\n            }\n            if ('file' == this._scheme) {\n              state = 'relative';\n            } else if (this._isRelative && base && base._scheme == this._scheme) {\n              state = 'relative or authority';\n            } else if (this._isRelative) {\n              state = 'authority first slash';\n            } else {\n              state = 'scheme data';\n            }\n          } else if (!stateOverride) {\n            buffer = '';\n            cursor = 0;\n            state = 'no scheme';\n            continue;\n          } else if (EOF == c) {\n            break loop;\n          } else {\n            err('Code point not allowed in scheme: ' + c)\n            break loop;\n          }\n          break;\n\n        case 'scheme data':\n          if ('?' == c) {\n            this._query = '?';\n            state = 'query';\n          } else if ('#' == c) {\n            this._fragment = '#';\n            state = 'fragment';\n          } else {\n            // XXX error handling\n            if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n              this._schemeData += percentEscape(c);\n            }\n          }\n          break;\n\n        case 'no scheme':\n          if (!base || !(isRelativeScheme(base._scheme))) {\n            err('Missing scheme.');\n            invalid.call(this);\n          } else {\n            state = 'relative';\n            continue;\n          }\n          break;\n\n        case 'relative or authority':\n          if ('/' == c && '/' == input[cursor+1]) {\n            state = 'authority ignore slashes';\n          } else {\n            err('Expected /, got: ' + c);\n            state = 'relative';\n            continue\n          }\n          break;\n\n        case 'relative':\n          this._isRelative = true;\n          if ('file' != this._scheme)\n            this._scheme = base._scheme;\n          if (EOF == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = base._query;\n            this._username = base._username;\n            this._password = base._password;\n            break loop;\n          } else if ('/' == c || '\\\\' == c) {\n            if ('\\\\' == c)\n              err('\\\\ is an invalid code point.');\n            state = 'relative slash';\n          } else if ('?' == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = '?';\n            this._username = base._username;\n            this._password = base._password;\n            state = 'query';\n          } else if ('#' == c) {\n            this._host = base._host;\n            this._port = base._port;\n            this._path = base._path.slice();\n            this._query = base._query;\n            this._fragment = '#';\n            this._username = base._username;\n            this._password = base._password;\n            state = 'fragment';\n          } else {\n            var nextC = input[cursor+1]\n            var nextNextC = input[cursor+2]\n            if (\n              'file' != this._scheme || !ALPHA.test(c) ||\n              (nextC != ':' && nextC != '|') ||\n              (EOF != nextNextC && '/' != nextNextC && '\\\\' != nextNextC && '?' != nextNextC && '#' != nextNextC)) {\n              this._host = base._host;\n              this._port = base._port;\n              this._username = base._username;\n              this._password = base._password;\n              this._path = base._path.slice();\n              this._path.pop();\n            }\n            state = 'relative path';\n            continue;\n          }\n          break;\n\n        case 'relative slash':\n          if ('/' == c || '\\\\' == c) {\n            if ('\\\\' == c) {\n              err('\\\\ is an invalid code point.');\n            }\n            if ('file' == this._scheme) {\n              state = 'file host';\n            } else {\n              state = 'authority ignore slashes';\n            }\n          } else {\n            if ('file' != this._scheme) {\n              this._host = base._host;\n              this._port = base._port;\n              this._username = base._username;\n              this._password = base._password;\n            }\n            state = 'relative path';\n            continue;\n          }\n          break;\n\n        case 'authority first slash':\n          if ('/' == c) {\n            state = 'authority second slash';\n          } else {\n            err(\"Expected '/', got: \" + c);\n            state = 'authority ignore slashes';\n            continue;\n          }\n          break;\n\n        case 'authority second slash':\n          state = 'authority ignore slashes';\n          if ('/' != c) {\n            err(\"Expected '/', got: \" + c);\n            continue;\n          }\n          break;\n\n        case 'authority ignore slashes':\n          if ('/' != c && '\\\\' != c) {\n            state = 'authority';\n            continue;\n          } else {\n            err('Expected authority, got: ' + c);\n          }\n          break;\n\n        case 'authority':\n          if ('@' == c) {\n            if (seenAt) {\n              err('@ already seen.');\n              buffer += '%40';\n            }\n            seenAt = true;\n            for (var i = 0; i < buffer.length; i++) {\n              var cp = buffer[i];\n              if ('\\t' == cp || '\\n' == cp || '\\r' == cp) {\n                err('Invalid whitespace in authority.');\n                continue;\n              }\n              // XXX check URL code points\n              if (':' == cp && null === this._password) {\n                this._password = '';\n                continue;\n              }\n              var tempC = percentEscape(cp);\n              (null !== this._password) ? this._password += tempC : this._username += tempC;\n            }\n            buffer = '';\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            cursor -= buffer.length;\n            buffer = '';\n            state = 'host';\n            continue;\n          } else {\n            buffer += c;\n          }\n          break;\n\n        case 'file host':\n          if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            if (buffer.length == 2 && ALPHA.test(buffer[0]) && (buffer[1] == ':' || buffer[1] == '|')) {\n              state = 'relative path';\n            } else if (buffer.length == 0) {\n              state = 'relative path start';\n            } else {\n              this._host = IDNAToASCII.call(this, buffer);\n              buffer = '';\n              state = 'relative path start';\n            }\n            continue;\n          } else if ('\\t' == c || '\\n' == c || '\\r' == c) {\n            err('Invalid whitespace in file host.');\n          } else {\n            buffer += c;\n          }\n          break;\n\n        case 'host':\n        case 'hostname':\n          if (':' == c && !seenBracket) {\n            // XXX host parsing\n            this._host = IDNAToASCII.call(this, buffer);\n            buffer = '';\n            state = 'port';\n            if ('hostname' == stateOverride) {\n              break loop;\n            }\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c) {\n            this._host = IDNAToASCII.call(this, buffer);\n            buffer = '';\n            state = 'relative path start';\n            if (stateOverride) {\n              break loop;\n            }\n            continue;\n          } else if ('\\t' != c && '\\n' != c && '\\r' != c) {\n            if ('[' == c) {\n              seenBracket = true;\n            } else if (']' == c) {\n              seenBracket = false;\n            }\n            buffer += c;\n          } else {\n            err('Invalid code point in host/hostname: ' + c);\n          }\n          break;\n\n        case 'port':\n          if (/[0-9]/.test(c)) {\n            buffer += c;\n          } else if (EOF == c || '/' == c || '\\\\' == c || '?' == c || '#' == c || stateOverride) {\n            if ('' != buffer) {\n              var temp = parseInt(buffer, 10);\n              if (temp != relative[this._scheme]) {\n                this._port = temp + '';\n              }\n              buffer = '';\n            }\n            if (stateOverride) {\n              break loop;\n            }\n            state = 'relative path start';\n            continue;\n          } else if ('\\t' == c || '\\n' == c || '\\r' == c) {\n            err('Invalid code point in port: ' + c);\n          } else {\n            invalid.call(this);\n          }\n          break;\n\n        case 'relative path start':\n          if ('\\\\' == c)\n            err(\"'\\\\' not allowed in path.\");\n          state = 'relative path';\n          if ('/' != c && '\\\\' != c) {\n            continue;\n          }\n          break;\n\n        case 'relative path':\n          if (EOF == c || '/' == c || '\\\\' == c || (!stateOverride && ('?' == c || '#' == c))) {\n            if ('\\\\' == c) {\n              err('\\\\ not allowed in relative path.');\n            }\n            var tmp;\n            if (tmp = relativePathDotMapping[buffer.toLowerCase()]) {\n              buffer = tmp;\n            }\n            if ('..' == buffer) {\n              this._path.pop();\n              if ('/' != c && '\\\\' != c) {\n                this._path.push('');\n              }\n            } else if ('.' == buffer && '/' != c && '\\\\' != c) {\n              this._path.push('');\n            } else if ('.' != buffer) {\n              if ('file' == this._scheme && this._path.length == 0 && buffer.length == 2 && ALPHA.test(buffer[0]) && buffer[1] == '|') {\n                buffer = buffer[0] + ':';\n              }\n              this._path.push(buffer);\n            }\n            buffer = '';\n            if ('?' == c) {\n              this._query = '?';\n              state = 'query';\n            } else if ('#' == c) {\n              this._fragment = '#';\n              state = 'fragment';\n            }\n          } else if ('\\t' != c && '\\n' != c && '\\r' != c) {\n            buffer += percentEscape(c);\n          }\n          break;\n\n        case 'query':\n          if (!stateOverride && '#' == c) {\n            this._fragment = '#';\n            state = 'fragment';\n          } else if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n            this._query += percentEscapeQuery(c);\n          }\n          break;\n\n        case 'fragment':\n          if (EOF != c && '\\t' != c && '\\n' != c && '\\r' != c) {\n            this._fragment += c;\n          }\n          break;\n      }\n\n      cursor++;\n    }\n  }\n\n  function clear() {\n    this._scheme = '';\n    this._schemeData = '';\n    this._username = '';\n    this._password = null;\n    this._host = '';\n    this._port = '';\n    this._path = [];\n    this._query = '';\n    this._fragment = '';\n    this._isInvalid = false;\n    this._isRelative = false;\n  }\n\n  // Does not process domain names or IP addresses.\n  // Does not handle encoding for the query parameter.\n  function jURL(url, base /* , encoding */) {\n    if (base !== undefined && !(base instanceof jURL))\n      base = new jURL(String(base));\n\n    this._url = url;\n    clear.call(this);\n\n    var input = url.replace(/^[ \\t\\r\\n\\f]+|[ \\t\\r\\n\\f]+$/g, '');\n    // encoding = encoding || 'utf-8'\n\n    parse.call(this, input, null, base);\n  }\n\n  jURL.prototype = {\n    toString: function() {\n      return this.href;\n    },\n    get href() {\n      if (this._isInvalid)\n        return this._url;\n\n      var authority = '';\n      if ('' != this._username || null != this._password) {\n        authority = this._username +\n            (null != this._password ? ':' + this._password : '') + '@';\n      }\n\n      return this.protocol +\n          (this._isRelative ? '//' + authority + this.host : '') +\n          this.pathname + this._query + this._fragment;\n    },\n    set href(href) {\n      clear.call(this);\n      parse.call(this, href);\n    },\n\n    get protocol() {\n      return this._scheme + ':';\n    },\n    set protocol(protocol) {\n      if (this._isInvalid)\n        return;\n      parse.call(this, protocol + ':', 'scheme start');\n    },\n\n    get host() {\n      return this._isInvalid ? '' : this._port ?\n          this._host + ':' + this._port : this._host;\n    },\n    set host(host) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, host, 'host');\n    },\n\n    get hostname() {\n      return this._host;\n    },\n    set hostname(hostname) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, hostname, 'hostname');\n    },\n\n    get port() {\n      return this._port;\n    },\n    set port(port) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      parse.call(this, port, 'port');\n    },\n\n    get pathname() {\n      return this._isInvalid ? '' : this._isRelative ?\n          '/' + this._path.join('/') : this._schemeData;\n    },\n    set pathname(pathname) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      this._path = [];\n      parse.call(this, pathname, 'relative path start');\n    },\n\n    get search() {\n      return this._isInvalid || !this._query || '?' == this._query ?\n          '' : this._query;\n    },\n    set search(search) {\n      if (this._isInvalid || !this._isRelative)\n        return;\n      this._query = '?';\n      if ('?' == search[0])\n        search = search.slice(1);\n      parse.call(this, search, 'query');\n    },\n\n    get hash() {\n      return this._isInvalid || !this._fragment || '#' == this._fragment ?\n          '' : this._fragment;\n    },\n    set hash(hash) {\n      if (this._isInvalid)\n        return;\n      this._fragment = '#';\n      if ('#' == hash[0])\n        hash = hash.slice(1);\n      parse.call(this, hash, 'fragment');\n    },\n\n    get origin() {\n      var host;\n      if (this._isInvalid || !this._scheme) {\n        return '';\n      }\n      // javascript: Gecko returns String(\"\"), WebKit/Blink String(\"null\")\n      // Gecko throws error for \"data://\"\n      // data: Gecko returns \"\", Blink returns \"data://\", WebKit returns \"null\"\n      // Gecko returns String(\"\") for file: mailto:\n      // WebKit/Blink returns String(\"SCHEME://\") for file: mailto:\n      switch (this._scheme) {\n        case 'file':\n          return 'file://' // EPUBJS Added\n        case 'data':\n        case 'javascript':\n        case 'mailto':\n          return 'null';\n      }\n      host = this.host;\n      if (!host) {\n        return '';\n      }\n      return this._scheme + '://' + host;\n    }\n  };\n\n  // Copy over the static methods\n  var OriginalURL = scope.URL;\n  if (OriginalURL) {\n    jURL.createObjectURL = function(blob) {\n      // IE extension allows a second optional options argument.\n      // http://msdn.microsoft.com/en-us/library/ie/hh772302(v=vs.85).aspx\n      return OriginalURL.createObjectURL.apply(OriginalURL, arguments);\n    };\n    jURL.revokeObjectURL = function(url) {\n      OriginalURL.revokeObjectURL(url);\n    };\n  }\n\n  return jURL;\n}));\n","import Book from \"./book\";\nimport Rendition from \"./rendition\";\nimport CFI from \"./epubcfi\";\nimport Contents from \"./contents\";\nimport * as utils from \"./utils/core\";\nimport { EPUBJS_VERSION } from \"./utils/constants\";\nimport '../libs/url/url-polyfill'\n\nimport IframeView from \"./managers/views/iframe\";\nimport DefaultViewManager from \"./managers/default\";\nimport ContinuousViewManager from \"./managers/continuous\";\n\n/**\n * Creates a new Book\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\n * @param {object} options to pass to the book\n * @returns {Book} a new Book object\n * @example ePub(\"/path/to/book.epub\", {})\n */\nfunction ePub(url, options) {\n\treturn new Book(url, options);\n}\n\nePub.VERSION = EPUBJS_VERSION;\n\nif (typeof(global) !== \"undefined\") {\n\tglobal.EPUBJS_VERSION = EPUBJS_VERSION;\n}\n\nePub.Book = Book;\nePub.Rendition = Rendition;\nePub.Contents = Contents;\nePub.CFI = CFI;\nePub.utils = utils;\n\nexport default ePub;\n","'use strict';\n\nif (!process) {\n  var process = {\n    \"cwd\" : function () { return '/' }\n  };\n}\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n","class PrefabViews {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t}\n\n\tall() {\n\t\treturn this._views;\n\t}\n\n\tfirst() {\n\t\treturn this._views[0];\n\t}\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t}\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t}\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t}\n\n\tget(i) {\n\t\treturn this._views[i];\n\t}\n\n\tappend(view){\n\t\tvar check = false;\n\t\tthis.forEach(function(v) {\n\t\t\tif ( v.section.href == view.section.href ) { check = true; }\n\t\t})\n\t\tif ( check ) { return view; }\n\t\t// if ( check ) { console.log(\"AHOY views.append WUT\", view.section.href)}\n\t\tthis._views.push(view);\n\t\tthis._views.sort(function(a,b) {return (a.section.href > b.section.href) ? 1 : ((b.section.href > a.section.href) ? -1 : 0);});\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tdump() {\n\t\treturn this._views.map(function(v) { return v.section.href });\n\t}\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container && view.element.dataset.reused != 'true'){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t}\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t}\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\t// if(this.container && view.element.dataset.reused != 'true'){\n\t\t// \t this.container.removeChild(view.element);\n\t\t// }\n\t\tview = null;\n\t}\n\n\t// Iterators\n\n\tforEach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t}\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t}\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t}\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t}\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t}\n}\n\nexport default PrefabViews;\n","import {extend, defer, requestAnimationFrame} from \"epubjs/src/utils/core\";\nimport DefaultViewManager from \"epubjs/src/managers/default\";\nimport ContinuousViewManager from \"epubjs/src/managers/continuous/index\" ;\nimport PrefabViews from \"../helpers/prefab\";\n\nimport { EVENTS } from \"epubjs/src/utils/constants\";\nimport debounce from \"lodash/debounce\";\n\nclass PrePaginatedContinuousViewManager extends ContinuousViewManager {\n    constructor(options) {\n    super(options);\n\n    this.name = \"prepaginated\";\n\n    this._manifest = null;\n    this._spine = [];\n    this.settings.scale = this.settings.scale || 1.0;\n  }\n\n  render(element, size){\n    var scale = this.settings.scale;\n    this.settings.scale = null; // we don't want the stage to scale\n    ContinuousViewManager.prototype.render.call(this, element, size);\n    // Views array methods\n    // use prefab views\n    this.settings.scale = scale;\n    this.views = new PrefabViews(this.container);\n  }\n\n  onResized(e) {\n    if (this.resizeTimeout) {\n      clearTimeout(this.resizeTimeout);\n    }\n    console.log(\"AHOY PREPAGINATED onResized queued\");\n    this.resizeTimeout = setTimeout(function() {\n      this.resize();\n      console.log(\"AHOY PREPAGINATED onResized actual\");\n      this.resizeTimeout = null;\n    }.bind(this), 500);\n    // this.resize();\n  }\n\n  resize(width, height) {\n    var self = this;\n\n    ContinuousViewManager.prototype.resize.call(this, width, height);\n    this._redrawViews();\n  }\n\n  _redrawViews() {\n    var self = this;\n    for(var i = 0; i < self._spine.length; i++) {\n      var href = self._spine[i];\n      // // console.log(\"AHOY DRAWING\", href);\n      var section_ = self._manifest[href];\n      // // var r = self.container.offsetWidth / section_.viewport.width;\n      // // var h = Math.floor(dim.height * r);\n      // var w = self.layout.columnWidth + ( self.layout.columnWidth * 0.10 );\n      // var r = w / section_.viewport.width;\n      // var h = Math.floor(section_.viewport.height * r);\n\n      var h, w;\n      [ w, h ] = self.sizeToViewport(section_);\n\n      var div = self.container.querySelector(`div.epub-view[ref=\"${section_.index}\"]`);\n      div.style.width = `${w}px`;\n      div.style.height = `${h}px`;\n      div.setAttribute('original-height', h);\n      div.setAttribute('layout-height', h);\n\n      var view = this.views.find(section_);\n      if ( view ) {\n          view.size(w, h);\n      }\n    }\n  }\n\n  // RRE - debugging\n  createView(section) {\n\n    var view = this.views.find(section);\n    if ( view ) {\n      return view;\n    }\n\n    var w, h;\n    [ w, h ] = this.sizeToViewport(section);\n    var viewSettings = Object.assign({}, this.viewSettings);\n    viewSettings.layout = Object.assign( Object.create( Object.getPrototypeOf(this.viewSettings.layout)), this.viewSettings.layout);\n    viewSettings.layout.height = h;\n    viewSettings.layout.columnWidth = w;\n    var view = new this.View(section, viewSettings);\n    return view;\n  }\n\n  display(section, target){\n    var self = this;\n    var promises = [];\n\n    this.q.clear();\n    var display = new defer();\n    var promises = [];\n    this.faking = {};\n\n    if ( ! this._manifest ) {\n      this.emit(\"building\");\n      self._manifest = {};\n      var _buildManifest = function(section_) {\n        self._manifest[section_.href] = false;\n        if ( self.settings.viewports && self.settings.viewports[section_.href] ) {\n          section_.viewport = self.settings.viewports[section_.href];\n          self._manifest[section_.href] = section_;\n        } else {\n          self.q.enqueue(() => {\n            section_.load(self.request).then(function(contents) {\n              var meta = contents.querySelector('meta[name=\"viewport\"]');\n              var value = meta.getAttribute('content');\n              var tmp = value.split(\",\");\n              var key = section_.href;\n              var idx = self._spine.indexOf(key);\n              self.emit(\"building\", { index: idx + 1, total: self._spine.length });\n              section_.viewport = {};\n              self._manifest[key] = section_;\n              // self._manifest[key] = { viewport : {} };\n              // self._manifest[key].index = section_.index;\n              // self._manifest[key].href = section_.href;\n              var viewport_width = tmp[0].replace('width=','');\n              var viewport_height = tmp[1].replace('height=','');\n              if ( ! viewport_height.match(/^\\d+$/) ) {\n                viewport_width = viewport_height = 'auto';\n              } else {\n                viewport_width = parseInt(viewport_width, 10);\n                viewport_height = parseInt(viewport_height, 10);\n              }\n              self._manifest[key].viewport.width = viewport_width;\n              self._manifest[key].viewport.height = viewport_height;\n              self.faking[key] = self._manifest[key].viewport;\n            })\n          });\n        }\n      }\n\n      // can we build a manifest here?\n      var prev_ = section.prev();\n      while ( prev_ ) {\n        self._spine.unshift(prev_.href);\n        _buildManifest(prev_);\n        prev_ = prev_.prev();\n      }\n\n      self._spine.push(section.href);\n      _buildManifest(section);\n\n      var next_ = section.next();\n      while ( next_ ) {\n        self._spine.push(next_.href);\n        _buildManifest(next_);\n        next_ = next_.next();\n      }\n\n      console.log(\"AHOY PRE-PAGINATED\", promises.length);\n    }\n\n    var _display = function() {\n\n      var check = document.querySelector('.epub-view');\n      if ( ! check ) {\n        self._max_height = self._max_viewport_height = 0;\n        self._max_width = self._max_viewport_width = 0;\n        console.log(\"AHOY DRAWING\", self._spine.length);\n        for(var i = 0; i < self._spine.length; i++) {\n          var href = self._spine[i];\n          var section_ = self._manifest[href];\n          var w, h;\n          [w, h] = self.sizeToViewport(section_);\n\n          self.container.innerHTML += `<div class=\"epub-view\" ref=\"${section_.index}\" data-href=\"${section_.href}\" style=\"width: ${w}px; height: ${h}px; text-align: center; margin-left: auto; margin-right: auto\"></div>`;\n          var div = self.container.querySelector(`div.epub-view[ref=\"${section_.index}\"]`);\n          // div.setAttribute('use-')\n          div.setAttribute('original-height', h);\n          div.setAttribute('layout-height', h);\n\n          if ( window.debugManager ) {\n            div.style.backgroundImage = `url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 32' width='300' height='32'%3e%3cstyle%3e.small %7b fill: rgba(0,0,0,0.3);%7d%3c/style%3e%3ctext x='0' y='25' class='small'%3e${section_.href}%3c/text%3e%3c/svg%3e\")`;\n            var colorR = Math.floor(Math.random() * 100).toString();\n            var colorG = Math.floor(Math.random() * 100).toString();\n            var colorB = Math.floor(Math.random() * 100).toString();\n            div.style.backgroundColor = `#${colorR}${colorG}${colorB}`;\n          }\n        }\n      }\n\n      // find the <div> with this section\n      // console.log(\"AHOY continuous.display START\", section.href);\n      var div = self.container.querySelector(`div.epub-view[ref=\"${section.index}\"]`);\n      div.scrollIntoView();\n\n      // this.q.clear();\n      // return check ? this.update() : this.check();\n      // var retval = check ? this.update() : this.check();\n      var retval = this.check();\n            console.log(\"AHOY DISPLAY\", check ? \"UPDATE\" : \"CHECK\", retval);\n      retval.then(function() {\n        this.q.clear();\n                console.log(\"AHOY MANAGER BUILT\");\n        this.emit(\"built\");\n        return display.resolve();\n      }.bind(this));\n\n      // return DefaultViewManager.prototype.display.call(this, section, target)\n      //  .then(function () {\n      //    return this.fill();\n      //  }.bind(this));\n\n            return retval;\n    }.bind(this);\n\n    // // promises.push(_display);\n    // while(promises.length) {\n    //  this.q.enqueue(promises.shift);\n    // }\n\n    // console.log(\"AHOY PREPAGINATED\", this.q._q.length);\n    // this.q.enqueue().then((result) => {\n    //  display.resolve();\n    // })\n\n    var q = function() {\n      return this.q.enqueue((result) => {\n        var waiting = 0;\n        for(var i = 0; i < self._spine.length; i++) {\n          var href = self._spine[i];\n          var has_section = self._manifest[href];\n          if ( has_section == false ) { waiting += 1; }\n        }\n        // console.log(\"AHOY PRE-PAGINATED WAITING\", waiting);\n        if ( waiting == 0 ) {\n          return _display();\n        } else {\n          q();\n        }\n      })\n    }.bind(this);\n\n    return q();\n\n    return display.promise;\n\n  }\n\n  _checkStillLoading() {\n    this.q.enqueue((result) => {\n      var waiting = 0;\n      for(var i = 0; i < self._spine.length; i++) {\n        var href = self._spine[i];\n        var has_section = self._manifest[href];\n        if ( has_section == false ) { waiting += 1; }\n      }\n      console.log(\"AHOY PRE-PAGINATED WAITING\", waiting);\n      if ( waiting == 0 ) {\n        return _display();\n      } else {\n        q();\n      }\n    })\n  }\n\n  fill(_full) {\n    var full = _full || new defer();\n\n    this.q.enqueue(() => {\n      return this._checkStillLoading();\n    }).then((result) => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n\n    return full.promise;\n  }\n\n  fillXX(_full){\n    var full = _full || new defer();\n\n    this.q.enqueue(() => {\n      return this.check();\n    }).then((result) => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n\n    return full.promise;\n  }\n\n  moveTo(offset){\n    // var bounds = this.stage.bounds();\n    // var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n    var distX = 0,\n        distY = 0;\n\n    var offsetX = 0,\n        offsetY = 0;\n\n    if(!this.isPaginated) {\n      distY = offset.top;\n      offsetY = offset.top+this.settings.offset;\n    } else {\n      distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n      offsetX = distX+this.settings.offset;\n    }\n\n    if (distX > 0 || distY > 0) {\n      this.scrollBy(distX, distY, true);\n    }\n  }\n\n  afterResized(view){\n    this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n  }\n\n  // Remove Previous Listeners if present\n  removeShownListeners(view){\n\n    // view.off(\"shown\", this.afterDisplayed);\n    // view.off(\"shown\", this.afterDisplayedAbove);\n    view.onDisplayed = function(){};\n\n  }\n\n  add(section){\n    var view = this.createView(section);\n\n    this.views.append(view);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      view.expanded = true;\n    });\n\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n\n    // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n\n    return view.display(this.request);\n  }\n\n  append(section){\n\n    var view = this.createView(section);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      view.expanded = true;\n      // do not do this\n      // this.counter(bounds); // RRE\n    });\n\n    /*\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n    */\n\n    this.views.append(view);\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n\n    return view;\n  }\n\n  prepend(section){\n    var view = this.createView(section);\n\n    view.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n      this.counter(bounds);\n      view.expanded = true;\n    });\n\n    /*\n    view.on(EVENTS.VIEWS.AXIS, (axis) => {\n      this.updateAxis(axis);\n    });\n    */\n\n    this.views.prepend(view);\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n\n    return view;\n  }\n\n  counter(bounds){\n    // return;\n    if(this.settings.axis === \"vertical\") {\n      // if ( ! this._timer ) {\n      //  this._timer = setTimeout(function() {\n      //    this._timer = null;\n      //    console.log(\"AHOY USING counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      //    this.scrollBy(0, bounds.heightDelta, true);\n      //    this.x1(`COUNTER ${bounds.heightDelta}`);\n      //  }.bind(this), 500);\n      // } else {\n      //  console.log(\"AHOY SKIPPING counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      // }\n      // console.log(\"AHOY counter.scrollBy : top was =\", this.__top, \"/ top is =\", this.container.scrollTop, \"/ delta =\", bounds.heightDelta);\n      this.scrollBy(0, bounds.heightDelta, true);\n    } else {\n      this.scrollBy(bounds.widthDelta, 0, true);\n    }\n\n  }\n\n  updateXXX(_offset) {\n    var offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n    var visibleLength = horizontal ? bounds.width : bounds.height;\n    var contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n    var divs = document.querySelectorAll('.epub-view');\n    var visible = [];\n    for(var i = 0; i < divs.length; i++) {\n      var div = divs[i];\n      var rect = div.getBoundingClientRect();\n      var marker = '';\n      // if ( rect.top > offset + bounds.height && ( rect.top + rect.height ) <= offset ) {\n      // if ( adjusted_top < ( div.offsetTop + rect.height ) && adjusted_end > div.offsetTop ) {\n      if ( offset < ( div.offsetTop + rect.height ) && ( offset + bounds.height ) > div.offsetTop ) {\n        marker = '**';\n        var section = this._manifest[div.dataset.href];\n        visible.push(section);\n        // if ( ! div.querySelector('iframe') ) {\n        //  newViews.push(this.append(section))\n        // }\n        // var idx = this._spine.indexOf(section.href);\n        // if ( idx > 0 ) {\n        //  visible.push(this._manifest[this._spine[idx - 1]]);\n        // }\n        // if ( idx < this._spine.length - 1 ) {\n        //  visible.push(this._manifest[this._spine[idx + 1]]);\n        // }\n      }\n      // console.log(\"AHOY\", div.dataset.href, rect.top, rect.height, \"/\", div.offsetTop, div.offsetHeight, \"/\", offset, bounds.height, marker);\n    }\n\n  }\n\n  update(_offset){\n    var container = this.bounds();\n    var views = this.views.all();\n    var viewsLength = views.length;\n    var visible = [];\n    var offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n    var isVisible;\n    var view;\n\n    var updating = new defer();\n    var promises = [];\n    var queued = {};\n    for (var i = 0; i < viewsLength; i++) {\n      view = views[i];\n\n      isVisible = this.isVisible(view, offset, offset, container);\n      if ( isVisible === true ) {\n        queued[i] = true;\n      }\n    }\n\n    for(var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      var isVisible = queued[i];\n      if(isVisible === true) {\n        // console.log(\"visible \" + view.index);\n\n        if (!view.displayed) {\n          // console.log(\"AHOY continuous.update !displayed\", view.section.href);\n          let displayed = view.display(this.request)\n            .then(function (view) {\n              view.show();\n            }, (err) => {\n              // console.log(\"AHOY continuous.update ERROR\", err);\n              view.hide();\n            });\n          promises.push(displayed);\n        } else {\n          // console.log(\"AHOY continuous.update show\", view.section.href);\n          view.show();\n        }\n        visible.push(view);\n      } else {\n        this.q.enqueue(view.destroy.bind(view));\n        // console.log(\"hidden \" + view.index);\n\n        clearTimeout(this.trimTimeout);\n        this.trimTimeout = setTimeout(function(){\n          this.q.enqueue(this.trim.bind(this));\n        }.bind(this), 250);\n      }\n\n    }\n\n    if(promises.length){\n      return Promise.all(promises)\n        .catch((err) => {\n          updating.reject(err);\n        });\n    } else {\n      updating.resolve();\n      return updating.promise;\n    }\n\n  }\n\n  check(_offsetLeft, _offsetTop){\n    var checking = new defer();\n    var newViews = [];\n\n    var horizontal = (this.settings.axis === \"horizontal\");\n    var delta = this.settings.offset || 0;\n\n    if (_offsetLeft && horizontal) {\n      delta = _offsetLeft;\n    }\n\n    if (_offsetTop && !horizontal) {\n      delta = _offsetTop;\n    }\n\n    var bounds = this._bounds; // bounds saved this until resize\n\n    let rtl = this.settings.direction === \"rtl\";\n    let dir = horizontal && rtl ? -1 : 1; //RTL reverses scrollTop\n\n    var offset = horizontal ? this.scrollLeft : this.scrollTop * dir;\n    var visibleLength = horizontal ? bounds.width : bounds.height;\n    var contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n    var prePaginated = this.layout.props.name == 'pre-paginated';\n\n    // console.log(\"continuous.check prePaginated =\", prePaginated, \"offset=\",\n    //  offset, \"visibleLength =\", visibleLength, \"delta=\", delta, ` (${offset + visibleLength + delta})`, \" >= contentLength =\", contentLength,\n    //  \" == \", offset + visibleLength + delta >= contentLength,\n    //  \" || \", offset - delta, \"<\", 0, \" == \", offset - delta < 0 );\n\n    let prepend = () => {\n      let first = this.views.first();\n      let prev = first && first.section.prev();\n\n      if(prev) {\n        newViews.push(this.prepend(prev));\n      }\n    };\n\n    let append = () => {\n      let last = this.views.last();\n      let next = last && last.section.next();\n\n      if(next) {\n        newViews.push(this.append(next));\n      }\n\n    };\n\n    var adjusted_top = offset - ( bounds.height * 8 );\n    var adjusted_end = offset + ( bounds.height * 8 );\n    // console.log(\"AHOY check\", offset, \"-\", offset + bounds.height, \"/\", adjusted_top, \"-\", adjusted_end);\n\n    // need to figure out which divs are viewable\n    var divs = document.querySelectorAll('.epub-view');\n    var visible = [];\n    for(var i = 0; i < divs.length; i++) {\n      var div = divs[i];\n      var rect = div.getBoundingClientRect();\n      var marker = '';\n      // if ( rect.top > offset + bounds.height && ( rect.top + rect.height ) <= offset ) {\n      // if ( adjusted_top < ( div.offsetTop + rect.height ) && adjusted_end > div.offsetTop ) {\n      if ( offset < ( div.offsetTop + rect.height ) && ( offset + bounds.height ) > div.offsetTop ) {\n        marker = '**';\n        var section = this._manifest[div.dataset.href];\n        visible.push(section);\n        // if ( ! div.querySelector('iframe') ) {\n        //  newViews.push(this.append(section))\n        // }\n        // var idx = this._spine.indexOf(section.href);\n        // if ( idx > 0 ) {\n        //  visible.push(this._manifest[this._spine[idx - 1]]);\n        // }\n        // if ( idx < this._spine.length - 1 ) {\n        //  visible.push(this._manifest[this._spine[idx + 1]]);\n        // }\n      }\n      // console.log(\"AHOY\", div.dataset.href, rect.top, rect.height, \"/\", div.offsetTop, div.offsetHeight, \"/\", offset, bounds.height, marker);\n    }\n\n    this.__check_visible = visible;\n\n    var section = visible[0];\n    if ( section && section.index > 0 ) {\n      visible.unshift(this._manifest[this._spine[section.index - 1]]);\n    }\n    if ( section ) {\n      var tmp = this._spine[section.index + 1];\n      if ( tmp ) {\n        visible.push(this._manifest[tmp]);\n      }\n    }\n    // if ( section && section.prev() ) {\n    //  visible.unshift(section.prev());\n    // }\n    // section = visible[visible.length - 1];\n    // if (section && section.next() ) {\n    //  visible.push(section.next());\n    // }\n\n    for(var i = 0; i < visible.length; i++) {\n      var section = visible[i];\n      // var div = document.querySelector(`.epub-view[ref=\"${section.index}\"]`);\n      // if ( div.querySelector('iframe') ) {\n      //  continue;\n      // }\n      newViews.push(this.append(section));\n    }\n\n    // let promises = newViews.map((view) => {\n    //  return view.displayed;\n    // });\n\n    var promises = [];\n    for(var i = 0; i < newViews.length; i++) {\n      if ( newViews[i] ) {\n        promises.push(newViews[i]);\n      }\n    }\n\n    if(newViews.length){\n      return Promise.all(promises)\n        .then(() => {\n          // return this.check();\n          // if (this.layout.name === \"pre-paginated\" && this.layout.props.spread && this.layout.flow() != 'scrolled') {\n          //   // console.log(\"AHOY check again\");\n          //   return this.check();\n          // }\n        })\n        .then(() => {\n          // Check to see if anything new is on screen after rendering\n          // console.log(\"AHOY update again\");\n          return this.update(delta);\n        }, (err) => {\n          return err;\n        });\n    } else {\n      this.q.enqueue(function(){\n        this.update();\n      }.bind(this));\n      checking.resolve(false);\n      return checking.promise;\n    }\n\n\n  }\n\n  trim(){\n    var task = new defer();\n    var displayed = this.views.displayed();\n    var first = displayed[0];\n    var last = displayed[displayed.length-1];\n    var firstIndex = this.views.indexOf(first);\n    var lastIndex = this.views.indexOf(last);\n    var above = this.views.slice(0, firstIndex);\n    var below = this.views.slice(lastIndex+1);\n\n    // Erase all but last above\n    for (var i = 0; i < above.length-3; i++) {\n      if ( above[i] ) {\n        // console.log(\"AHOY trim > above\", first.section.href, \":\", above[i].section.href);\n        this.erase(above[i], above);\n      }\n    }\n\n    // Erase all except first below\n    for (var j = 3; j < below.length; j++) {\n      if ( below[j] ) {\n        // console.log(\"AHOY trim > below\", last.section.href, \":\", below[j].section.href);\n        this.erase(below[j]);\n      }\n    }\n\n    task.resolve();\n    return task.promise;\n  }\n\n  erase(view, above){ //Trim\n\n    var prevTop;\n    var prevLeft;\n\n    if(this.settings.height) {\n      prevTop = this.container.scrollTop;\n      prevLeft = this.container.scrollLeft;\n    } else {\n      prevTop = window.scrollY;\n      prevLeft = window.scrollX;\n    }\n\n    var bounds = view.bounds();\n\n    // console.log(\"AHOY erase\", view.section.href, above);\n    this.views.remove(view);\n\n    if(above) {\n      if(this.settings.axis === \"vertical\") {\n        // this.scrollTo(0, prevTop - bounds.height, true);\n      } else {\n        this.scrollTo(prevLeft - bounds.width, 0, true);\n      }\n    }\n\n  }\n\n  addEventListeners(stage){\n\n    window.addEventListener(\"unload\", function(e){\n      this.ignore = true;\n      // this.scrollTo(0,0);\n      this.destroy();\n    }.bind(this));\n\n    this.addScrollListeners();\n  }\n\n  addScrollListeners() {\n    var scroller;\n\n    this.tick = requestAnimationFrame;\n\n    if(this.settings.height) {\n      this.prevScrollTop = this.container.scrollTop;\n      this.prevScrollLeft = this.container.scrollLeft;\n    } else {\n      this.prevScrollTop = window.scrollY;\n      this.prevScrollLeft = window.scrollX;\n    }\n\n    this.scrollDeltaVert = 0;\n    this.scrollDeltaHorz = 0;\n\n    if(this.settings.height) {\n      scroller = this.container;\n      this.scrollTop = this.container.scrollTop;\n      this.scrollLeft = this.container.scrollLeft;\n    } else {\n      scroller = window;\n      this.scrollTop = window.scrollY;\n      this.scrollLeft = window.scrollX;\n    }\n\n    scroller.addEventListener(\"scroll\", this.onScroll.bind(this));\n    this._scrolled = debounce(this.scrolled.bind(this), 30);\n    // this.tick.call(window, this.onScroll.bind(this));\n\n    this.didScroll = false;\n\n  }\n\n  removeEventListeners(){\n    var scroller;\n\n    if(this.settings.height) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this.onScroll.bind(this));\n  }\n\n  onScroll(){\n    let scrollTop;\n    let scrollLeft;\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n    if(this.settings.height) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY * dir;\n      scrollLeft = window.scrollX * dir;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if(!this.ignore) {\n\n      this._scrolled();\n\n    } else {\n      this.ignore = false;\n    }\n\n    this.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n    this.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n    this.prevScrollTop = scrollTop;\n    this.prevScrollLeft = scrollLeft;\n\n    clearTimeout(this.scrollTimeout);\n    this.scrollTimeout = setTimeout(function(){\n      this.scrollDeltaVert = 0;\n      this.scrollDeltaHorz = 0;\n    }.bind(this), 150);\n\n\n    this.didScroll = false;\n\n  }\n\n  scrolled() {\n    this.q.enqueue(function() {\n      this.check();\n      this.recenter();\n      setTimeout(function() {\n        this.emit(EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 500);\n    }.bind(this));\n\n    this.emit(EVENTS.MANAGERS.SCROLL, {\n      top: this.scrollTop,\n      left: this.scrollLeft\n    });\n\n    clearTimeout(this.afterScrolled);\n    this.afterScrolled = setTimeout(function () {\n      this.emit(EVENTS.MANAGERS.SCROLLED, {\n        top: this.scrollTop,\n        left: this.scrollLeft\n      });\n    }.bind(this));\n  }\n\n  next(){\n\n    let dir = this.settings.direction;\n    let delta = this.layout.props.name === \"pre-paginated\" &&\n                this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n    delta = this.container.offsetHeight / this.settings.scale;\n\n    if(!this.views.length) return;\n\n    if(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n      this.scrollBy(delta, 0, true);\n\n    } else {\n\n      // this.scrollBy(0, this.layout.height, true);\n      this.scrollBy(0, delta, true);\n\n    }\n\n    this.q.enqueue(function() {\n      this.check();\n    }.bind(this));\n  }\n\n  prev(){\n\n    let dir = this.settings.direction;\n    let delta = this.layout.props.name === \"pre-paginated\" &&\n                this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n\n    if(!this.views.length) return;\n\n    if(this.isPaginated && this.settings.axis === \"horizontal\") {\n\n      this.scrollBy(-delta, 0, true);\n\n    } else {\n\n      this.scrollBy(0, -this.layout.height, true);\n\n    }\n\n    this.q.enqueue(function() {\n      this.check();\n    }.bind(this));\n  }\n\n  updateAxis(axis, forceUpdate){\n\n    if (!this.isPaginated) {\n      axis = \"vertical\";\n    }\n\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n\n    this.settings.axis = axis;\n\n    this.stage && this.stage.axis(axis);\n\n    this.viewSettings.axis = axis;\n\n    if (this.mapping) {\n      this.mapping.axis(axis);\n    }\n\n    if (this.layout) {\n      if (axis === \"vertical\") {\n        this.layout.spread(\"none\");\n      } else {\n        this.layout.spread(this.layout.settings.spread);\n      }\n    }\n\n    if (axis === \"vertical\") {\n      this.settings.infinite = true;\n    } else {\n      this.settings.infinite = false;\n    }\n  }\n\n  recenter() {\n    var wrapper = this.container.parentElement;\n    var w3 = ( wrapper.scrollWidth / 2 ) - ( wrapper.offsetWidth / 2 );\n    wrapper.scrollLeft = w3;\n  }\n\n  sizeToViewport(section) {\n    var h = this.layout.height;\n    var w = this.layout.columnWidth * this.settings.scale;\n    if ( section.viewport.height != 'auto' ) {\n      if ( this.layout.columnWidth > section.viewport.width ) {\n        w = section.viewport.width * this.settings.scale;\n      }\n      var r = w / section.viewport.width;\n      h = Math.floor(section.viewport.height * r);\n    }\n    return [w, h];\n  }\n\n  sizeToViewport_X(section) {\n    var h = this.layout.height;\n    var w = this.layout.columnWidth * 0.80;\n\n    if ( section.viewport.height != 'auto' ) {\n\n      var r = w / section.viewport.width;\n      h = section.viewport.height * r;\n      var f = 1 / 0.60;\n      var m = Math.min(( f * this.layout.height ) / h, 1.0);\n      console.log(\"AHOY SHRINKING\", `( ${f} * ${this.layout.height} ) / ${h} = ${m} :: ${h * m}`);\n      h *= m;\n\n      h *= this.settings.scale;\n      if ( h > section.viewport.height ) {\n        h = section.viewport.height;\n      }\n\n      r = h / section.viewport.height;\n      w = section.viewport.width * r;\n\n      h = Math.floor(h);\n      w = Math.floor(w);\n    }\n    return [w, h];\n  }\n\n  scale(scale) {\n    var self = this;\n    this.settings.scale = scale;\n    var current = this.currentLocation();\n    var index = -1;\n    if ( current[0] ) {\n      index = current[0].index; \n    }\n\n    this.views.hide();\n    this.views.clear();\n    this._redrawViews();\n    this.views.show();\n    setTimeout(function() {\n      console.log(\"AHOY JUMPING TO\", index);\n      if ( index > -1 ) {\n        var div = self.container.querySelector(`div.epub-view[ref=\"${index}\"]`);\n        div.scrollIntoView(true);\n      }\n      this.check().then(function() {\n        this.onScroll();\n      }.bind(this))\n    }.bind(this), 0);\n  }\n\n  resetScale() {\n    // NOOP\n  }\n\n}\n\nPrePaginatedContinuousViewManager.toString = function() { return 'prepaginated'; }\n\nexport default PrePaginatedContinuousViewManager;\n\n","import IframeView from \"epubjs/src/managers/views/iframe\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"epubjs/src/utils/core\";\n\nclass ReusableIframeView extends IframeView {\n    constructor(section, options) {\n        super(section, options);\n        // this._layout.height = null;\n    }\n\n    container(axis) {\n        var check = document.querySelector(`div[ref='${this.index}']`);\n        if ( check ) {\n            check.dataset.reused = 'true';\n            return check;\n        }\n\n        var element = document.createElement(\"div\");\n\n        element.classList.add(\"epub-view\");\n\n        // this.element.style.minHeight = \"100px\";\n        element.style.height = \"0px\";\n        element.style.width = \"0px\";\n        element.style.overflow = \"hidden\";\n        element.style.position = \"relative\";\n        element.style.display = \"block\";\n\n        if(axis && axis == \"horizontal\"){\n            element.style.flex = \"none\";\n        } else {\n            element.style.flex = \"initial\";\n        }\n\n        return element;\n    }\n\n    create() {\n\n        if(this.iframe) {\n            return this.iframe;\n        }\n\n        if(!this.element) {\n            this.element = this.createContainer();\n        }\n\n        if ( this.element.hasAttribute('layout-height') ) {\n            var height = parseInt(this.element.getAttribute('layout-height'), 10);\n            this._layout_height = height;\n        }\n\n        this.iframe = this.element.querySelector(\"iframe\");\n        if ( this.iframe ) {\n            return this.iframe;\n        }\n\n        this.iframe = document.createElement(\"iframe\");\n        this.iframe.id = this.id;\n        this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n        this.iframe.style.overflow = \"hidden\";\n        this.iframe.seamless = \"seamless\";\n        // Back up if seamless isn't supported\n        this.iframe.style.border = \"none\";\n\n        this.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n        this.resizing = true;\n\n        // this.iframe.style.display = \"none\";\n        this.element.style.visibility = \"hidden\";\n        this.iframe.style.visibility = \"hidden\";\n\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n\n        this.element.setAttribute(\"ref\", this.index);\n        this.element.setAttribute(\"data-href\", this.section.href);\n\n        // this.element.appendChild(this.iframe);\n        this.added = true;\n\n        this.elementBounds = bounds(this.element);\n\n        // if(width || height){\n        //   this.resize(width, height);\n        // } else if(this.width && this.height){\n        //   this.resize(this.width, this.height);\n        // } else {\n        //   this.iframeBounds = bounds(this.iframe);\n        // }\n\n\n        if((\"srcdoc\" in this.iframe)) {\n            this.supportsSrcdoc = true;\n        } else {\n            this.supportsSrcdoc = false;\n        }\n\n        if (!this.settings.method) {\n            this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n        }\n\n        return this.iframe;\n    }\n\n}\n\nexport default ReusableIframeView;\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport ePub from 'epubjs';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as Browser from '../core/Browser';\n\nimport path from \"path-webpack\";\n\nimport PrePaginatedContinuousViewManager from '../epubjs/managers/continuous/prepaginated';\nimport ReusableIframeView from '../epubjs/managers/views/iframe';\n\nReader.EpubJS = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n    this._epubjs_ready = false;\n    window.xpath = path;\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    if ( typeof(target) == 'function' ) {\n      callback = target;\n      target = undefined;\n    }\n    if ( callback == null ) {\n      callback = function() { };\n    }\n\n    self.rootfiles = [];\n\n    this.options.rootfilePath = this.options.rootfilePath || sessionStorage.getItem('rootfilePath');\n\n    var book_href = this.options.href;\n    var book_options = { packagePath: this.options.rootfilePath };\n    if ( this.options.useArchive ) {\n      book_href = book_href.replace(/\\/(\\w+)\\/$/, '/$1/$1.sm.epub');\n      book_options.openAs = 'epub';\n    }\n    this._book = ePub(book_href, book_options);\n    sessionStorage.removeItem('rootfilePath');\n\n    this._book.loaded.navigation.then(function(toc) {\n      self._contents = toc;\n      self.metadata = self._book.package.metadata;\n      self.fire('updateContents', toc);\n      self.fire('updateTitle', self._book.package.metadata);\n    })\n    this._book.ready.then(function() {\n      self.parseRootfiles();\n\n      self.draw(target, callback);\n\n      if ( self.metadata.layout == 'pre-paginated' ) {\n        // fake it with the spine\n        var locations = [];\n        self._book.spine.each(function(item) {\n          locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n          self.locations._locations.push(`epubcfi(${item.cfiBase}!/4/2)`);\n        });\n        self.locations.total = locations.length;\n        var t;\n        var f = function() {\n          if ( self._rendition && self._rendition.manager && self._rendition.manager.stage ) {\n            var location = self._rendition.currentLocation();\n            if ( location && location.start) {\n              self.fire('updateLocations', locations);\n              clearTimeout(t);\n              return;\n            }\n          }\n          t = setTimeout(f, 100);\n        }\n\n        t = setTimeout(f, 100);\n      } else {\n        self._book.locations.generate(1600).then(function(locations) {\n          // console.log(\"AHOY WUT\", locations);\n          self.fire('updateLocations', locations);\n        })\n      }\n    })\n    // .then(callback);\n  },\n\n  parseRootfiles: function() {\n    var self = this;\n    self._book.load(self._book.url.resolve(\"META-INF/container.xml\")).then(function(containerDoc) {\n        var rootfiles = containerDoc.querySelectorAll(\"rootfile\");\n        if ( rootfiles.length > 1 ) {\n          console.log(\"AHOY ROOTFILES MULTIPLE RENDITIONS\", rootfiles.length);\n          for(var i = 0; i < rootfiles.length; i++) {\n            var rootfile = rootfiles[i];\n            var rootfilePath = rootfile.getAttribute('full-path');\n            var label = rootfile.getAttribute('rendition:label');\n            var layout = rootfile.getAttribute('rendition:layout');\n            self.rootfiles.push({\n              rootfilePath: rootfilePath,\n              label: label,\n              layout: layout\n            })\n          }\n        }\n    })\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n\n    if ( self._rendition ) {\n      // self._unbindEvents();\n      var container = self._rendition.manager.container;\n      Object.keys(self._rendition.hooks).forEach(function(key) {\n        console.log(\"AHOY draw clearing\", key);\n        self._rendition.hooks[key].clear();\n      })\n      self._rendition.destroy();\n      self._rendition = null;\n    }\n\n    this.settings = { flow: this.options.flow };\n    this.settings.manager = this.options.manager || 'default';\n\n    if ( this.settings.flow == 'auto' && this.metadata.layout == 'pre-paginated' ) {\n      // dumb check to see if the window is _tall_ enough to put\n      // two pages side by side\n      if ( this._container.offsetHeight <= this.options.forceScrolledDocHeight ) {\n        this.settings.flow = 'scrolled-doc';\n        this.settings.manager = PrePaginatedContinuousViewManager;\n        this.settings.view = ReusableIframeView;\n      }\n    }\n\n    if ( this.settings.flow == 'auto' || this.settings.flow == 'paginated' ) {\n      this._panes['epub'].style.overflow = this.metadata.layout == 'pre-paginated' ? 'auto' : 'hidden';\n      this.settings.manager = 'default';\n    } else {\n      this._panes['epub'].style.overflow = 'auto';\n      if ( this.settings.manager == 'default' ) {\n        this.settings.manager = 'continuous';\n      }\n    }\n\n    if ( ! callback ) {\n      callback = function() { };\n    }\n\n    if ( this.metadata.layout == 'pre-paginated' && this.settings.manager == 'continuous' ) {\n        // this.settings.manager = 'prepaginated';\n        this.settings.manager = PrePaginatedContinuousViewManager;\n        this.settings.view = ReusableIframeView;\n    }\n\n    if ( this.settings.manager == PrePaginatedContinuousViewManager ) {\n      this.settings.spread = 'none';\n    }\n\n    // would pre-paginated work better if we scaled the default view from the start? maybe?\n    if ( false && this.metadata.layout == 'pre-paginated' && this.settings.manager == 'default' ) {\n      this.settings.spread = 'none';\n      this._panes['epub'].style.overflow = 'auto';\n    }\n\n    self.settings.height = '100%';\n    self.settings.width = '100%';\n    self.settings['ignoreClass'] = 'annotator-hl';\n\n    if ( self.options.scale != '100' ) {\n      self.settings.scale = parseInt(self.options.scale, 10) / 100;\n    }\n\n    self._panes['book'].dataset.manager = this.settings.manager + ( this.settings.spread ? `-${this.settings.spread}` : '');\n    self._panes['book'].dataset.layout = this.metadata.layout || 'reflowable';\n\n    self._drawRendition(target, callback);\n  },\n\n  _drawRendition: function(target, callback) {\n    var self = this;\n\n    self._rendition = self._book.renderTo(self._panes['epub'], self.settings);\n    self._updateFontSize();\n    self._bindEvents();\n    self._drawn = true;\n\n    if ( target && target.start ) { target = target.start; }\n    if ( ! target && window.location.hash ) {\n      if ( window.location.hash.substr(1, 3) == '/6/' ) {\n        target = decodeURIComponent(window.location.hash.substr(1));\n        if ( target.match(/\\]$/ ) ) {\n          // target += '/2';\n          target += '/1:0';\n        }\n        target = \"epubcfi(\" + target + \")\";\n      } else {\n        target = window.location.hash.substr(2);\n        target = self._book.url.path().resolve(target);\n      }\n    }\n\n    var status_index = 0;\n    self._rendition.on('started', function() {\n\n      self._rendition.manager.on(\"building\", function(status) {\n        if ( status ) {\n          status_index += 1;\n          self._panes['loader-status'].innerHTML = `<span>${Math.round((status_index / status.total) * 100.0)}%</span>`;\n        } else {\n          self._enableBookLoader(-1);\n        }\n      })\n      self._rendition.manager.on(\"built\", function() {\n        console.log(\"AHOY manager built\");\n        self._disableBookLoader(true);\n      })\n    })\n\n    self._rendition.hooks.content.register(function(contents) {\n      self.fire('ready:contents', contents);\n      self.fire('readyContents', contents);\n      contents.document.addEventListener('keydown', (event) => {\n        const keyName = event.key;\n        self.fire('keyDown', { keyName: keyName, shiftKey: event.shiftKey, inner: true });\n        console.log('inner keydown event: ', keyName);\n      });\n    })\n\n    self.gotoPage(target, function() {\n      window._loaded = true;\n      self._initializeReaderStyles();\n\n      if ( callback ) { callback(); }\n\n      self._epubjs_ready = true;\n\n      setTimeout(function() {\n        self.fire('opened');\n        self.fire('ready');\n        clearTimeout(self._queueTimeout);\n        self.tracking.event(\"openBook\", {\n          rootFilePath: self.options.rootFilePath,\n          flow: self.settings.flow,\n          manager: self.settings.manager\n        });\n      }, 100);\n    })\n  },\n\n  _scroll: function(delta) {\n    var self = this;\n    if ( self.options.flow == 'XXscrolled-doc' ) {\n      var container = self._rendition.manager.container;\n      var rect = container.getBoundingClientRect();\n      var scrollTop = container.scrollTop;\n      var newScrollTop = scrollTop;\n      var scrollBy = ( rect.height * 0.98 );\n      switch(delta) {\n        case 'PREV':\n          newScrollTop = -( scrollTop + scrollBy );\n          break;\n        case 'NEXT':\n          newScrollTop = ( scrollTop + scrollBy );\n          break;\n        case 'HOME':\n          newScrollTop = 0;\n          break;\n        case 'END':\n          newScrollTop = container.scrollHeight - scrollBy;\n          break;\n      }\n      container.scrollTop = newScrollTop;\n      return ( Math.floor(container.scrollTop) != Math.floor(scrollTop) );\n    }\n    return false;\n  },\n\n  _navigate: function(promise, callback) {\n    var self = this;\n    self._enableBookLoader(100);\n    promise.then(function() {\n      console.log(\"AHOY NAVIGATE FIN\");\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n    }).catch(function(e) {\n      self._disableBookLoader();\n      if ( callback ) { callback(); }\n      console.log(\"AHOY NAVIGATE ERROR\", e);\n      throw(e);\n    })\n  },\n\n  next: function() {\n    var self = this;\n    this.tracking.action('reader/go/next');\n    self._scroll('NEXT') || self._navigate(this._rendition.next());\n  },\n\n  prev: function() {\n    this.tracking.action('reader/go/previous');\n    this._scroll('PREV') || this._navigate(this._rendition.prev());\n  },\n\n  first: function() {\n    this.tracking.action('reader/go/first');\n    this._navigate(this._rendition.display(0), undefined);\n  },\n\n  last: function() {\n    var self = this;\n    this.tracking.action('reader/go/last');\n    var target = this._book.spine.length - 1;\n    this._navigate(this._rendition.display(target), undefined);\n  },\n\n  gotoPage: function(target, callback) {\n    var hash;\n    if ( target != null ) {\n      var section = this._book.spine.get(target);\n      if ( ! section) {\n        // maybe it needs to be resolved\n        var guessed = target;\n        if ( guessed.indexOf(\"://\") < 0 ) {\n          var path1 = path.resolve(this._book.path.directory, this._book.package.navPath);\n          var path2 = path.resolve(path.dirname(path1), target);\n          guessed = this._book.canonical(path2);\n        }\n        if ( guessed.indexOf(\"#\") !== 0 ) {\n          hash = guessed.split('#')[1];\n          guessed = guessed.split('#')[0];\n        }\n\n        this._book.spine.each(function(item) {\n          if ( item.canonical == guessed ) {\n            section = item;\n            target = section.href;\n            return;\n          }\n        })\n\n        if ( hash ) {\n          target = target + '#' + hash;\n        }\n\n        console.log(\"AHOY GUESSED\", target);\n      } else if ( target.toString().match(/^\\d+$/) ) {\n        console.log(\"AHOY USING\", section.href);\n        target = section.href;\n      }\n\n      if ( ! section ) {\n        if ( ! this._epubjs_ready ) {\n          target = 0;\n        } else {\n          return;\n        }\n      }\n    }\n\n    console.log(\"AHOY gotoPage\", target);\n\n    // this.__hash = hash;\n    var navigating = this._rendition.display(target).then(function() {\n      this._rendition.display(target);\n    }.bind(this));\n    this._navigate(navigating, callback);\n  },\n\n  percentageFromCfi: function(cfi) {\n    return this._book.percentageFromCfi(cfi);\n  },\n\n  destroy: function() {\n    if ( this._rendition ) {\n      try {\n        this._rendition.destroy();\n      } catch(e) {}\n    }\n    this._rendition = null;\n    this._drawn = false;\n  },\n\n  reopen: function(options, target) {\n    // different per reader?\n    var target = target || this.currentLocation();\n    if( target.start ) { target = target.start ; }\n    if ( target.cfi ) { target = target.cfi ; }\n\n    var doUpdate = false;\n    if ( options === true ) { doUpdate = true; options = {}; }\n    var changed = {};\n    Object.keys(options).forEach(function(key) {\n      if ( options[key] != this.options[key] ) {\n        doUpdate = true;\n        changed[key] = true;\n      }\n      // doUpdate = doUpdate || ( options[key] != this.options[key] );\n    }.bind(this));\n\n    if ( ! doUpdate ) {\n      return;\n    }\n\n    // performance hack\n    if ( Object.keys(changed).length == 1 && changed.scale ) {\n      reader.options.scale = options.scale;\n      this._updateScale();\n      return;\n    }\n\n    if ( options.rootfilePath && options.rootfilePath != this.options.rootfilePath ) {\n      // we need to REOPEN THE DANG BOOK\n      sessionStorage.setItem('rootfilePath', options.rootfilePath);\n      location.reload();\n      return;\n    }\n\n    Util.extend(this.options, options);\n\n    this.draw(target, function() {\n      this._updateFontSize();\n      this._updateScale();\n      this._updateTheme();\n      this._selectTheme(true);\n    }.bind(this))\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) {\n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    // add a stylesheet to stop images from breaking their columns\n    var add_max_img_styles = false;\n    if ( this._book.package.metadata.layout == 'pre-paginated' ) {\n      // NOOP\n    } else if ( this.options.flow == 'auto' || this.options.flow == 'paginated' ) {\n      add_max_img_styles = true;\n    }\n\n    var custom_stylesheet_rules = [];\n\n    // force 90% height instead of default 60%\n    if ( this.metadata.layout != 'pre-paginated' ) {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n            \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n            \"object-fit\": \"contain\",\n            \"page-break-inside\": \"avoid\"\n          },\n          \"svg\" : {\n            \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth + \"px\" : \"100%\") + \"!important\",\n            \"max-height\": (this._layout.height ? (this._layout.height * 0.9) + \"px\" : \"90%\") + \"!important\",\n            \"page-break-inside\": \"avoid\"\n          }\n        });\n      }.bind(this._rendition))\n    } else {\n      this._rendition.hooks.content.register(function(contents) {\n        contents.addStylesheetRules({\n          \"img\" : {\n            // \"border\": \"64px solid black !important\",\n            \"box-sizing\": \"border-box !important\"\n          },\n          \"figure\": {\n            \"box-sizing\": \"border-box !important\",\n            \"margin\": \"0 !important\"\n          },\n          \"body\": {\n            \"margin\": \"0\"\n          }\n        });\n      }.bind(this._rendition));\n    }\n\n    this._updateFontSize();\n\n    if ( custom_stylesheet_rules.length ) {\n      this._rendition.hooks.content.register(function(view) {\n        view.addStylesheetRules(custom_stylesheet_rules);\n      })\n    }\n\n    this._rendition.on('resized', function(box) {\n      self.fire('resized', box);\n    })\n\n    this._rendition.on('relocated', function(location) {\n      if ( self._fired ) { self._fired = false; return ; }\n      self.fire('relocated', location);\n      if ( Browser.safari && self._last_location_start && self._last_location_start != location.start.href ) {\n        console.log(\"AHOY RELOCATED\", self._last_location_start, location.start.href);\n        self._fired = true;\n        console.log(\"AHOY RENDITION Q\", self._rendition.q.length());\n        setTimeout(function() {\n          // self._rendition.display(location.start.cfi);\n        }, 0);\n      }\n      self._last_location_start = location.start.href;\n    })\n\n    this._rendition.on('displayerror', function(err) {\n      console.log(\"AHOY RENDITION DISPLAY ERROR\", err);\n    })\n\n    this._rendition.on(\"locationChanged\", function(location) {\n      var view = this.manager.current();\n      var section = view.section;\n      var current = this.book.navigation.get(section.href);\n\n      // if ( self.__hash && view.contents ) {\n      //   var check = section.contents.querySelector(`#${self.__hash}`);\n      //   if ( check ) {\n      //     var new_target = section.cfiFromElement(check);\n      //     this.display(new_target);\n      //     self.__hash = null;\n      //     return;\n      //   }\n      // }\n\n      self.fire(\"updateSection\", current);\n      self.fire(\"updateLocation\", location);\n      // self.fire(\"relocated\", location);\n    });\n\n    this._rendition.on(\"rendered\", function(section, view) {\n\n      if ( view.contents ) {\n        // view.contents.on(\"xxlinkClicked\", function(href) {\n        //   console.log(\"AHOY CLICKED\", href);\n        //   var tmp = href.split(\"#\");\n        //   href = tmp[0];\n        //   var hash = tmp[1]\n        //   // var current = self.currentLocation().start.href;\n        //   // var section = self._book.spine.get(current.href);\n        //   console.log(\"AHOY CLICKED CHECK\", section.canonical, href);\n        //   if ( section.canonical.indexOf(href) < 0 ) {\n        //     self.gotoPage(href);\n        //     // self._rendition.display(href);\n\n        //   } else if ( hash ) {\n        //     // we're already on this page, so we need to scroll to this location\n        //     var node = view.contents.content.querySelector('#' + hash);\n        //     console.log(\"AHOY INTERNAL\", hash, view.contents, node);\n        //   }\n        //   // self._rendition.display(href);\n        // })\n      }\n\n      if(false) {\n        if ( ! self._rendition.manager.container.dataset.__scroll ) {\n          var ticking;\n          self._rendition.manager.container.addEventListener(\"scroll\", function(event) {\n            if ( self._rendition && self._rendition.manager ) {\n              var container = self._rendition.manager.container;\n              var mod = container.scrollLeft % parseInt(self._rendition.manager.layout.delta, 10);\n              console.log(\"AHOY DETECTED SCROLL\", mod, mod / self._rendition.manager.layout.delta);\n            }\n          });\n          self._rendition.manager.container.dataset.__scroll = true;\n        }\n      }\n\n      self.on('keyDown', function(data) {\n        if ( data.keyName == 'Tab' && data.inner ) {\n          var container = self._rendition.manager.container;\n          var mod;\n          var delta;\n          var x; var xyz;\n          setTimeout(function() {\n            var scrollLeft = container.scrollLeft;\n            mod = scrollLeft % parseInt(self._rendition.manager.layout.delta, 10);\n            if ( mod > 0 && ( mod / self._rendition.manager.layout.delta ) < 0.99 ) {\n              // var x = Math.floor(event.target.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10)) + 1;\n              // var delta = ( x * self._rendition.manager.layout.delta) - event.target.scrollLeft;\n              x = Math.floor(container.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10));\n              if ( data.shiftKey ) { x -= 0 ; }\n              else { x += 1; }\n              var y = container.scrollLeft;\n              delta = ( x * self._rendition.manager.layout.delta ) - y;\n              xyz = ( x * self._rendition.manager.layout.delta );\n              // if ( data.shiftKey ) { delta *= -1 ; }\n              if ( true || ! data.shiftKey ) {\n                self._rendition.manager.scrollBy(delta);\n              }\n            }\n            console.log(\"AHOY DOING THE SCROLLING\", data.shiftKey, scrollLeft, mod, x, xyz, delta);\n          }, 0);\n        }\n      })\n\n\n    })\n  },\n\n  _initializeReaderStyles: function() {\n    var self = this;\n    var themes = this.options.themes;\n    if ( themes ) {\n      themes.forEach(function(theme) {\n        self._rendition.themes.register(theme['klass'], theme.href ? theme.href : theme.rules);\n      })\n    }\n\n    // base for highlights\n    this._rendition.themes.override('.epubjs-hl', \"fill: yellow; fill-opacity: 0.3; mix-blend-mode: multiply;\");\n  },\n\n  _selectTheme: function(refresh) {\n    var theme = this.options.theme || 'default';\n    this._rendition.themes.select(theme);\n    if ( 0 && refresh ) {\n      var cfi = this.currentLocation().end.cfi;\n      this._rendition.manager.clear();\n      console.log(\"AHOY\", cfi);\n      this._rendition.display(cfi);\n    }\n  },\n\n  _updateFontSize: function() {\n    if ( this.metadata.layout == 'pre-paginated') {\n      // we're not doing font changes for pre-paginted\n      return;\n    }\n\n    var text_size = this.options.text_size == 'auto' ? 100 : this.options.text_size;\n    this._rendition.themes.fontSize(`${text_size}%`);\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    var scale = this.options.scale;\n    if ( scale ) {\n      this.settings.scale = parseInt(scale, 10) / 100.0;\n      this._queueScale();\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        console.log(\"AHOY SCALING\", this.settings.scale);\n        this._rendition.scale(this.settings.scale);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  _updateScale: function() {\n    if ( this.metadata.layout != 'pre-paginated') {\n      // we're not scaling for reflowable\n      return;\n    }\n    var scale = this.options.scale;\n    if ( scale ) {\n      scale = parseInt(scale, 10) / 100.0;\n      this._rendition.scale(scale);\n    }\n  },\n\n  _queueScale: function(scale) {\n    this._queueTimeout = setTimeout(function() {\n      if ( this._rendition.manager && this._rendition.manager.stage ) {\n        console.log(\"AHOY SCALING\", this.settings.scale);\n        this._rendition.scale(this.settings.scale);\n      } else {\n        this._queueScale();\n      }\n    }.bind(this), 100);\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.EpubJS.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'annotations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    if ( Browser.ie ) {\n      return {\n        reset: function() { /* NOOP */ },\n        highlight: function(cfiRange) { /* NOOP */ }\n      }\n    }\n    if ( ! this._rendition.annotations.reset ) {\n      this._rendition.annotations.reset = function(){\n        for(var hash in this._annotations) {\n            var cfiRange = decodeURI(hash);\n            this.remove(cfiRange);\n        }\n        this._annotationsBySectionIndex = {};\n      }.bind(this._rendition.annotations);\n    }\n    return this._rendition.annotations;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._book.locations;\n  }\n});\n\nwindow.Reader = Reader;\n\nexport function createReader(id, options) {\n  return new Reader.EpubJS(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.Mock = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(target, callback) {\n    var self = this;\n    this._book = {\n      metadata: {\n        title: 'The Mock Life',\n        creator: 'Alex Mock',\n        publisher: 'University Press',\n        location: 'Ann Arbor, MI',\n        pubdate: '2017-05-23'\n      },\n      contents: {\n        toc: [\n          {id: 1, href: \"/epubs/mock/ops/xhtml/TitlePage.xhtml\", label: \"Title\", parent: null},\n          {id: 2, href: \"/epubs/mock/ops/xhtml/Chapter01.xhtml\", label: \"Chapter 1\", parent: null},\n          {id: 3, href: \"/epubs/mock/ops/xhtml/Chapter02.xhtml\", label: \"Chapter 2\", parent: null},\n          {id: 4, href: \"/epubs/mock/ops/xhtml/Chapter03.xhtml\", label: \"Chapter 3\", parent: null},\n          {id: 5, href: \"/epubs/mock/ops/xhtml/Chapter04.xhtml\", label: \"Chapter 4\", parent: null},\n          {id: 6, href: \"/epubs/mock/ops/xhtml/Chapter05.xhtml\", label: \"Chapter 5\", parent: null},\n          {id: 7, href: \"/epubs/mock/ops/xhtml/Chapter06.xhtml\", label: \"Chapter 6\", parent: null},\n          {id: 8, href: \"/epubs/mock/ops/xhtml/Chapter07.xhtml\", label: \"Chapter 7\", parent: null},\n          {id: 9, href: \"/epubs/mock/ops/xhtml/Index.xhtml\", label: \"Index\", parent: null},\n        ]\n      }\n    };\n\n    this._locations = [\n      'epubcfi(/6/4[TitlePage.xhtml])',\n      'epubcfi(/6/4[Chapter01.xhtml])',\n      'epubcfi(/6/4[Chapter02.xhtml])',\n      'epubcfi(/6/4[Chapter03.xhtml])',\n      'epubcfi(/6/4[Chapter04.xhtml])',\n      'epubcfi(/6/4[Chapter05.xhtml])',\n      'epubcfi(/6/4[Chapter06.xhtml])',\n      'epubcfi(/6/4[Chapter07.xhtml])',\n      'epubcfi(/6/4[Chapter08.xhtml])',\n      'epubcfi(/6/4[Index.xhtml])',\n    ];\n\n    this.__currentIndex = 0;\n\n    this.metadata = this._book.metadata;\n    this.fire('updateContents', this._book.contents);\n    this.fire('updateTitle', this._metadata);\n    this.fire('updateLocations', this._locations);\n    this.draw(target, callback);\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n    this.settings = { flow: this.options.flow };\n    this.settings.height = '100%';\n    this.settings.width = '99%';\n    // this.settings.width = '100%';\n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      callback = target;\n      target = undefined;\n    }\n    callback();\n    self.fire('ready');\n  },\n\n  next: function() {\n    // this._rendition.next();\n  },\n\n  prev: function() {\n    // this._rendition.prev();\n  },\n\n  first: function() {\n    // this._rendition.display(0);\n  },\n\n  last: function() {\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" ) {\n      this.__currentIndex = this._locations.indexOf(target);\n    } else {\n      this.__currentIndex = target;\n    }\n    this.fire(\"relocated\", this.currentLocation());\n  },\n\n  destroy: function() {\n    // if ( this._rendition ) {\n    //   this._rendition.destroy();\n    // }\n    // this._rendition = null;\n  },\n\n  currentLocation: function() {\n    var cfi = this._locations[this.__currentIndex];\n    return {\n      start: { cfi: cfi, href: cfi },\n      end: { cfi: cfi, href: cfi }\n    }\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n  },\n\n  _updateTheme: function() {\n\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.Mock.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    var self = this;\n    return {\n      total: self._locations.length,\n      locationFromCfi: function(cfi) {\n        return self._locations.indexOf(cfi);\n      },\n      percentageFromCfi: function(cfi) {\n        var index = self.locations.locationFromCfi(cfi);\n        return ( index / self.locations.total );\n      },\n      cfiFromPercentage: function(percentage) {\n        var index = Math.ceil(percentage * 10);\n        return self._locations[index];\n      }\n    }\n  }\n});\n\nObject.defineProperty(Reader.Mock.prototype, 'annotations', {\n  get: function() {\n    return {\n      reset: function() {},\n      highlight: function() {}\n    }\n  }\n})\n\nexport function createReader(id, options) {\n  return new Reader.Mock(id, options);\n}\n","import {Reader} from './Reader';\nimport * as EpubJS from './Reader.EpubJS';\nimport * as Mock from './Reader.Mock';\n\nvar engines = {\n  epubjs: EpubJS.createReader,\n  mock: Mock.createReader\n}\n\nexport var reader = function(id, options) {\n  options = options || {};\n  var engine = options.engine || window.COZY_EPUB_ENGINE || 'epubjs';\n  var engine_href = options.engine_href || window.COZY_EPUB_ENGINE_HREF;\n  var _this = this;\n  var _arguments = arguments;\n\n  options.engine = engine;\n  options.engine_href = engine_href;\n\n  return engines[engine].apply(_this, [id, options]);\n}"],"names":["global","this","extend","dest","i","j","len","src","arguments","length","create","Object","F","proto","prototype","bind","fn","obj","slice","Array","apply","call","args","concat","lastId","stamp","_cozy_id","throttle","time","context","lock","wrapperFn","later","setTimeout","wrapNum","x","range","includeMax","max","min","d","falseFn","formatNum","num","digits","pow","Math","round","isNumeric","isNaN","parseFloat","isFinite","trim","str","replace","splitWords","split","setOptions","options","hasOwnProperty","getParamString","existingUrl","uppercase","params","push","encodeURIComponent","toUpperCase","indexOf","join","templateRe","template","data","key","value","undefined","Error","isArray","toString","array","el","emptyImageUrl","getPrefixed","name","window","lastTime","timeoutDefer","Date","timeToCall","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","id","clearTimeout","requestAnimFrame","immediate","cancelAnimFrame","loader","js","url","handler","_resolved","callbacks","error","then","cb","resolve","catch","reject","_argv","shift","e","console","log","trace","element","document","createElement","onload","onerror","async","parent","attr","appendChild","Class","props","NewClass","initialize","callInitHooks","parentProto","__super__","Util","constructor","statics","includes","checkDeprecatedMixinEvents","_initHooks","_initHooksCalled","include","mergeOptions","addInitHook","init","cozy","Mixin","Evented","on","types","type","_on","off","_events","_off","typeListeners","newListener","ctx","listeners","l","_firingCount","splice","fire","propagate","listens","event","target","_propagateEvent","_eventParents","once","addEventParent","removeEventParent","layer","addEventListener","removeEventListener","clearAllEventListeners","addOneTimeEventListener","fireEvent","hasEventListeners","style","documentElement","ie","ielt9","edge","navigator","webkit","userAgentContains","android","android23","opera","chrome","gecko","safari","phantom","opera12","win","platform","ie3d","webkit3d","WebKitCSSMatrix","gecko3d","any3d","L_DISABLE_3D","mobile","orientation","mobileWebkit","mobileWebkit3d","msPointer","PointerEvent","MSPointerEvent","pointer","touch","L_NO_TOUCH","DocumentTouch","mobileOpera","mobileGecko","retina","devicePixelRatio","screen","deviceXDPI","logicalXDPI","canvas","getContext","svg","vml","div","innerHTML","shape","firstChild","behavior","adj","columnCount","classList","userAgent","toLowerCase","Point","y","clone","add","point","_add","toPoint","subtract","_subtract","divideBy","_divideBy","multiplyBy","_multiplyBy","scaleBy","unscaleBy","_round","floor","_floor","ceil","_ceil","distanceTo","sqrt","equals","contains","abs","POINTER_DOWN","Browser","POINTER_MOVE","POINTER_UP","POINTER_CANCEL","TAG_WHITE_LIST","_pointers","_pointerDocListener","_pointersCount","addPointerListener","_addPointerStart","_addPointerMove","_addPointerEnd","removePointerListener","onDown","pointerType","MSPOINTER_TYPE_MOUSE","tagName","DomEvent","_handlePointer","_globalPointerDown","_globalPointerMove","_globalPointerUp","pointerId","touches","changedTouches","onMove","buttons","onUp","_touchstart","_touchend","_pre","addDoubleTapListener","last","doubleTap","delay","onTouchStart","count","now","delta","onTouchEnd","cancelBubble","newTouch","prop","removeDoubleTapListener","touchstart","touchend","dblclick","addOne","eventsKey","removeOne","originalHandler","isExternalTarget","filterClick","attachEvent","detachEvent","stopPropagation","originalEvent","_stopped","skipped","disableScrollPropagation","disableClickPropagation","fakeStop","preventDefault","returnValue","stop","getMousePosition","container","clientX","clientY","rect","getBoundingClientRect","left","clientLeft","top","clientTop","wheelPxFactor","getWheelDelta","wheelDeltaY","deltaY","deltaMode","deltaX","deltaZ","wheelDelta","detail","skipEvents","events","related","relatedTarget","parentNode","err","lastClick","timeStamp","elapsed","_simulatedClick","_simulated","Element","matches","ep","webkitMatchesSelector","msMatchesSelector","mozMatchesSelector","TRANSFORM","testProp","TRANSITION","TRANSITION_END","get","getElementById","getStyle","currentStyle","defaultView","css","getComputedStyle","className","remove","removeChild","empty","toFront","toBack","insertBefore","hasClass","getClass","RegExp","test","addClass","classes","setClass","removeClass","baseVal","setOpacity","opacity","_setOpacityIE","filter","filterName","filters","item","Enabled","Opacity","isPropertySupported","setTransform","offset","scale","pos","setPosition","_leaflet_pos","getPosition","disableTextSelection","enableTextSelection","_userSelect","userSelectProperty","disableImageDrag","enableImageDrag","_outlineElement","_outlineStyle","preventOutline","tabIndex","restoreOutline","outline","freeGlobal","root","Symbol","objectProto","nativeObjectToString","symToStringTag","getRawTag","objectToString","isObjectLike","baseGetTag","isSymbol","isObject","toNumber","coreJsData","funcProto","funcToString","isMasked","isFunction","toSource","getValue","baseIsNative","getNative","defineProperty","eq","baseAssignValue","assignValue","nativeMax","identity","constant","shortOut","baseSetToString","setToString","overRest","isLength","MAX_SAFE_INTEGER","isArrayLike","isIndex","baseRest","isIterateeCall","baseIsArguments","stubFalse","argsTag","funcTag","nodeUtil","baseUnary","baseIsTypedArray","isArguments","isBuffer","isTypedArray","baseTimes","overArg","isPrototype","nativeKeys","arrayLikeKeys","baseKeys","createAssigner","copyObject","keys","keyboardAllowed","val","fnMap","ret","eventNameMap","change","fullscreenchange","fullscreenerror","screenfull","request","elem","requestFullscreen","ALLOW_KEYBOARD_INPUT","exit","exitFullscreen","toggle","isFullscreen","onchange","callback","eventName","raw","defineProperties","Boolean","fullscreenElement","enumerable","enabled","fullscreenEnabled","Reader","regions","metadata","flow","engine","fontSizeLarge","fontSizeSmall","fontSizeDefault","trackResize","text_size","mobileMediaQuery","forceScrolledDocHeight","theme","rootfilePath","themes","self","_original_document_title","title","localStorage","getItem","assign","JSON","parse","_checkFeatureCompatibility","_initContainer","_initLayout","forEach","href","klass","rules","rule","new_rule","_updateTheme","_initEvents","_mode","mode","start","_start","open","reopen","saveOptions","saved_options","setItem","stringify","DomUtil","_container","dataset","draw","next","prev","display","index","gotoPage","goBack","history","back","goForward","forward","_preResize","_onScroll","_containerId","_fadeAnimated","fadeAnimation","position","_initPanes","panes","_panes","prefix","_initBookLoader","_checkIfLoaded","_loaded","_targets","tracking","reader","_action","_last_location_start","_reader","action","v","pop","pageview","location","cfi","transform3DLimit","_onMoveEnd","location_href","_ignoreHistory","tmp_href","substr","pushState","percentage","p","isTrusted","state","keyName","check","activeElement","localName","parentElement","IGNORE_TARGETS","shiftKey","_scroll","scrollTop","scrollLeft","_handleDOMEvent","keyCode","srcElement","_fireDOMEvent","targets","synth","_findEventTargets","isMarker","containerPoint","latLngToContainerPoint","getLatLng","mouseEventToContainerPoint","layerPoint","containerPointToLayerPoint","latlng","layerPointToLatLng","nonBubblingEvents","getFixedBookPanelSize","h","clientHeight","paddingTop","paddingBottom","w","clientWidth","paddingRight","paddingLeft","height","width","invalidateSize","_drawn","_resizeRequest","_resizeBookPane","_setupHooks","_checkMobileDevice","_isMobile","matchMedia","_enableBookLoader","_clearBookLoaderTimeout","_force_progress","_loader_timeout","_disableBookLoader","force","loader_template","loaderTemplate","body","DOMParser","parseFromString","children","EOT","Control","_locked","_id","getTime","parseInt","random","getRegion","region","setRegion","removeControl","addControl","getContainer","addTo","onAdd","area","getControlRegion","onRemove","_refocusOnMap","screenX","screenY","focus","_className","widget","direction","control","getControlContainer","_controlContainer","parts","tmp","slug","panel","getControlRegion_1","slot","childElement","_classify","_clearControlRegion","_controlRegions","PageControl","_control","querySelector","_createButton","_fill","html","label","_bindEvents","link","setAttribute","_unit","s","unit","_label","PagePrevious","PageNext","PageFirst","first","PageLast","pageNext","pagePrevious","pageFirst","pageLast","activeModal","FOCUSABLE_ELEMENTS","ACTIONABLE_ELEMENTS","Modal","fraction","actions","onShow","onClose","handlers","_initializedEvents","panelHTML","main","button_cls","modal","onClick","onKeydown","onModalTransition","button_id","button","close","closeModal","deactivate","removeEventListeners","showModal","_resize","setFocusToFirstNode","addEventListeners","activate","offsetHeight","offsetWidth","header","footer","getFocusableNodes","nodes","querySelectorAll","map","focusableNodes","getActionableNodes","maintainFocus","closeAfterAction","hasAttribute","actionableNodes","click","selector","getAttribute","focusedItemIndex","Contents","defaultTemplate","_modal","_setupSkipLink","_process","items","tabindex","option","_createOption","subitems","toc","chapter","anchor","textContent","span","skipLink","ul","contents","Title","h1","_title","_divider","_section","bookTitle","PublicationMetadata","_publisher","_rights","publisher","rights","publicationMetadata","Preferences","hasThemes","_activated","updatePreferences","initializeForm","_createPanel","possible_fieldsets","layout","rootfiles","_fieldsets","cls","fieldset","fields","hasFields","field","inputs","input","checked","hint","_form","new_options","saveable_options","updateForm","Fieldset","_current","TextSize","form","_input","_output","_preview","_actionReset","_updatePreview","saveable","fontSize","Display","scrolled_help","Theme","Rendition","expr","rootfile","accessMode","Scale","transform","preferences","Widget","_onAddExtra","_updateTemplate","_updateClass","node","Button","Panel","Toggle","states","stateName","_resetState","_state","Citation","designMode","formatted","createRange","selectNode","sel","getSelection","removeAllRanges","addRange","flag","execCommand","_message","detach","citations","citation","format","text","createTextNode","_formatted","_initializeForm","_formatCitation","selected","Search","_data","_canceled","_processing","_article","searchString","openModalResults","openModalWaiting","submitQuery","_emptyArticle","_buildResults","searchUrl","XMLHttpRequest","status","response","send","hasChildNodes","lastChild","content","annotations","reset","highlight","highlight_off","search_results","result","cfiRange","snippet","chapterTitle","search","BibliographicInformation","dl","metadata_fields","idx","_formatDate","metadata_fields_seen","dt","dd","match","bibliographicInformation","Download","_configureDownloadForm","submit","download_links","size","download","Navigator","_setup","locations","_initializeNavigator","_createControl","_background","_status","_spanCurrentPercentage","_spanCurrentLocation","_spanTotalLocations","_update","_mouseDown","_initiated","percentageFromCfi","currentLocation","cfiFromPercentage","current","rangeBg","current_location","locationFromCfi","_last_delta","_last_value","_total","total","Bus","instance","bus","Events","module","foo","bar","trzy","_undefined","require","object","isValue","TypeError","process","opts1","String","dscr","c","desc","configurable","writable","normalizeOpts","gs","set","isCallable","Function","descriptor","emit","methods","descriptors","base","listener","__ee__","__eeOnceListener__","candidate","exports","o","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","ELEMENT_NODE","TEXT_NODE","_URL","URL","webkitURL","mozURL","uuid","r","documentHeight","scrollHeight","isElement","nodeType","isNumber","n","isFloat","f","prefixed","unprefixed","vendors","prefixes","upper","defaults","source","sources","getOwnPropertyNames","propName","getOwnPropertyDescriptor","insert","compareFunction","locationOf","_end","end","pivot","compared","a","b","indexOfSorted","bounds","widthProps","heightProps","borders","nodeBounds","elPos","doc","ownerDocument","Node","elRange","selectNodeContents","windowBounds","innerWidth","innerHeight","right","bottom","indexOfNode","typeId","childNodes","sib","indexOfTextNode","textNode","indexOfElementNode","elementNode","isXml","ext","createBlob","mime","Blob","createBlobUrl","tempUrl","blob","createObjectURL","revokeBlobUrl","revokeObjectURL","createBase64Url","datauri","btoa","markup","forceXMLDom","Parser","charCodeAt","qs","elements","getElementsByTagName","qsa","qsp","q","filtered","sprint","func","createTreeWalker","treeWalker","NodeFilter","SHOW_TEXT","walk","nextNode","walked","nextSibling","blob2base64","Promise","FileReader","readAsDataURL","onloadend","defer","promise","freeze","querySelectorByType","query","getAttributeNS","findChildren","parents","unshift","filterChildren","nodeName","single","getParentByTagName","tagname","RangeObject","collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset","setStart","startNode","collapse","_commonAncestorContainer","_checkCollapsed","setEnd","endNode","toStart","referenceNode","endIndex","startParents","endParents","assertPath","path","normalizeStringPosix","allowAboveRoot","res","lastSlash","dots","code","_format","sep","pathObject","dir","posix","resolvedPath","resolvedAbsolute","cwd","normalize","isAbsolute","trailingSeparator","joined","arg","relative","from","to","fromStart","fromEnd","fromLen","toEnd","toLen","lastCommonSep","fromCode","toCode","out","_makeLong","dirname","hasRoot","matchedSlash","basename","extIdx","firstNonSlashEnd","extname","startDot","startPart","preDotState","Path","pathString","protocol","parsed","pathname","isDirectory","directory","filename","extension","what","charAt","splitPath","splitPathRe","exec","Url","urlString","baseString","absolute","basePath","origin","hash","fullpath","DOCUMENT_NODE","EpubCFI","cfiFrom","ignoreClass","spinePos","parseComponent","steps","checkType","fromRange","fromNode","isCfiString","cfiStr","baseComponent","pathComponent","getChapterComponent","getPathComponent","getRange","componentStr","component","terminal","assertion","parseTerminal","step","parseStep","stepStr","has_brackets","termialStr","characterOffset","textLocationAssertion","indirection","ranges","getCharecterOffsetComponent","splitStr","joinSteps","part","segment","segmentString","cfiString","compare","cfiOne","cfiTwo","stepsA","stepsB","terminalA","terminalB","filteredStep","filteredNode","filteredPosition","pathTo","currentNode","equalStep","stepA","stepB","needsIgnoring","patchOffset","sibling","previousSibling","isText","curr","totalOffset","normalizedMap","output","prevIndex","currNodeType","prevNodeType","textNodes","stepsToXpath","xpath","stepsToQuerySelector","walkToNode","_doc","findNode","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","fixMiss","child","lastStepIndex","childIndex","toRange","startSteps","endSteps","missed","generateChapterComponent","_spineNodeIndex","_pos","spineNodeIndex","Hook","hooks","register","deregister","hook","trigger","promises","task","executing","all","list","clear","replaceBase","section","head","replaceCanonical","canonical","replaceMeta","meta","idref","replaceLinks","links","replaceLink","linkUrl","onclick","substitute","urls","replacements","Section","linear","properties","cfiBase","serialize","load","_request","loading","loaded","xml","render","rendering","rendered","isIE","Serializer","XMLSerializer","serializer","serializeToString","find","_query","excerpt","limit","cfiFromRange","substring","reconcileLayoutSettings","globalLayout","settings","spread","rendition","property","_range","cfiFromElement","unload","destroy","Spine","spineItems","spineByHref","spineById","epubcfi","manifest","baseUrl","unpack","_package","resolver","spine","manifestItem","spineItem","nextIndex","append","encodeURI","decodeURI","prepend","each","Queue","_q","tick","running","paused","enqueue","deferred","queued","run","dequeue","inwait","dump","defered","flush","pause","EPUBJS_VERSION","DOM_EVENTS","EVENTS","BOOK","OPEN_FAILED","CONTENTS","EXPAND","RESIZE","SELECTED","SELECTED_RANGE","LINK_CLICKED","LOCATIONS","CHANGED","MANAGERS","RESIZED","ORIENTATION_CHANGE","ADDED","SCROLL","SCROLLED","REMOVED","VIEWS","AXIS","LOAD_ERROR","RENDERED","DISPLAYED","SHOWN","HIDDEN","MARK_CLICKED","RENDITION","STARTED","ATTACHED","DISPLAY_ERROR","LOCATION_CHANGED","RELOCATED","LAYOUT","UPDATED","Locations","_locations","break","_currentCfi","processingTimeout","generate","chars","completed","counter","_break","parser","dist","loc","percentageFromLocation","cfiFromLocation","warn","save","getCurrent","setCurrent","EventEmitter","Container","containerDocument","packagePath","encoding","xmlEncoding","Packaging","packageDocument","navPath","ncxPath","coverPath","metadataNode","manifestNode","spineNode","parseManifest","findNavPath","findNcxPath","findCoverPath","parseSpine","uniqueIdentifier","findUniqueIdentifier","parseMetadata","getElementText","creator","description","pubdate","identifier","language","modified_date","getPropertyText","viewport","media_active_class","manifestXml","overlay","spineXml","propArray","itemref","packageXml","uniqueIdentifierId","namespaceURI","nodeValue","tocId","pkg","epubVersion","metaCover","coverId","cover","tag","found","getElementsByTagNameNS","json","readingOrder","resources","rel","Navigation","tocByHref","tocById","landmarks","landmarksByType","ncx","parseNav","parseLandmarks","parseNcx","landmark","navHtml","navElement","navItems","navItem","parentItem","parentContent","landmarkItem","tocXml","navPoints","ncxItem","navLabel","table","mimeTypes","subtype","defaultValue","lookup","Resources","archive","replacementUrls","assets","cssUrls","splitUrls","createUrl","parsedUrl","mimeType","replaceCss","replaced","replacement","createCssFile","replacementUrl","indexInUrls","newUrl","textResponse","getText","relUrls","assetHref","resolved","relativeTo","PageList","pages","firstPage","lastPage","totalPages","pageList","page","isCfi","packageUrl","pageFromCfi","pg","cfiFromPage","pageFromPercentage","percent","percentageFromPage","Layout","_spread","_minSpreadWidth","minSpreadWidth","_evenSpreads","evenSpreads","_flow","spreadWidth","columnWidth","gap","divisor","update","calculate","_width","_height","_gap","pageWidth","formating","fit","columns","totalLength","pageLength","spreads","newProps","Themes","_themes","_overrides","_injected","inject","overrides","registerThemes","default","registerUrl","registerRules","select","getContents","addStylesheet","serialized","addStylesheetRules","injected","override","priority","font","Mapping","axis","dev","horizontal","_dev","view","findRanges","rangeListToCfiList","rangePairToCfiPair","findStart","findEnd","startRange","endRange","selection","acceptNode","FILTER_ACCEPT","FILTER_REJECT","safeFilter","scrollWidth","stack","$el","$prev","findTextStartRange","findTextEndRange","splitTextNodeIntoRanges","_splitter","splitter","rangePair","startCfi","endCfi","cifPair","hasNavigator","isChrome","isWebkit","sectionIndex","_size","epubReadingSystem","listenedEvents","frame","contentWidth","contentHeight","textWidth","border","textHeight","overflow","overflowX","overflowY","setProperty","$viewport","newContent","_scale","_minimum","_maximum","_scalable","minimum","maximum","scalable","scrollTo","expand","imageLoadListeners","mediaQueryListeners","addSelectionListeners","resizeListeners","linksHandler","removeListeners","removeSelectionListeners","expanding","resizeCheck","onResize","transitionListeners","_resizeCheck","sheets","styleSheets","mediaChangeHandler","m","_expanding","cssRules","media","mql","mediaText","addListener","resizeObservers","observer","MutationObserver","mutations","config","attributes","childList","characterData","subtree","observe","images","img","naturalWidth","fontLoadListeners","fonts","ready","targetPos","newRange","Range","$stylesheet","onreadystatechange","readyState","styleEl","styleSheet","sheet","rl","propStr","pl","insertRule","selectors","definition","_rules","addScript","$script","_triggerEvent","triggerEvent","passive","_onSelectionChange","onSelectionChange","selectionEndTimeout","triggerSelectedEvent","cfirange","rangeCount","getRangeAt","_cfi","cfiFromNode","layoutStyle","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","writingMode","scaler","offsetX","offsetY","scaleStr","translateStr","widthScale","heightScale","mapPage","mapping","WRITING_MODE","_layoutStyle","version","hasFeature","feature","disconnect","Annotations","highlights","underlines","marks","_annotations","_annotationsBySectionIndex","unloaded","styles","annotation","Annotation","views","attach","_removeFromAnnotationBySectionIndex","_annotationsAt","underline","mark","show","hide","unhighlight","ununderline","unmark","createElementNS","proxyMouse","tracked","dispatch","t","dispatchEvent","contentDocument","_arr","_i","ev","opts","bubbles","MouseEvent","copy","createEvent","initMouseEvent","cancelable","ctrlKey","altKey","metaKey","rectContains","rects","getClientRects","_get","receiver","getPrototypeOf","getter","_createClass","Constructor","protoProps","staticProps","_svg2","_interopRequireDefault","_svg","_events2","__esModule","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","setPrototypeOf","__proto__","_classCallCheck","Pane","addMark","g","removeMark","unbind","coords","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","iterator","_step","done","return","Mark","filteredRanges","box","contained","Highlight","_Mark","_this","docFrag","createDocumentFragment","Underline","_Highlight","line","setCoords","rect1","rect2","IframeView","globalLayoutProperties","method","added","displayed","fixedWidth","fixedHeight","pane","flex","iframe","createContainer","scrolling","seamless","resizing","visibility","elementBounds","supportsSrcdoc","sectionRender","setAxis","addListeners","_textWidth","_contentWidth","_textHeight","_contentHeight","_needsReframe","elBorders","iframeBorders","lockedWidth","lockedHeight","forceEvenPages","reframe","widthDelta","prevBounds","heightDelta","placeMark","onLoad","blobUrl","srcdoc","write","contentWindow","setLayout","layoutFunc","onDisplayed","stopExpanding","offsetTop","offsetLeft","parentPos","emitter","freeSelf","toStringTag","isOwn","nullTag","undefinedTag","symbolTag","NAN","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","other","valueOf","isBinary","FUNC_ERROR_TEXT","nativeMin","debounce","wait","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","thisArg","leadingEdge","timerExpired","remainingWait","timeSinceLastCall","timeSinceLastInvoke","timeWaiting","shouldInvoke","trailingEdge","cancel","debounced","isInvoking","Stage","_options","hidden","wrapper","wrap","wordSpacing","lineHeight","verticalAlign","flexDirection","flexWrap","fullsize","getElement","_element","attachTo","resizeFunc","onOrientationChange","orientationChangeFunc","containerStyles","containerPadding","_windowBounds","bodyStyles","bodyPadding","getSheet","addStyleRules","rulesArray","scope","Views","_views","DefaultViewManager","optsSettings","View","renditionQueue","queue","infinite","viewSettings","stage","_bounds","_stageSize","onResized","updateLayout","scroller","onScroll","orientationTimeout","resizeTimeout","afterScrolled","resizeOnOrientationChange","resize","stageSize","winBounds","createView","displaying","visible","moveTo","afterDisplayed","afterResized","distX","distY","isPaginated","updateAxis","scrollBy","scrolledLocation","paginatedLocation","pageHeight","used","scrollY","sections","startPos","endPos","currPage","endPage","scrollX","startPage","tempStartPage","isVisible","offsetPrev","offsetNext","viewsLength","silent","ignore","scrolled","applyLayout","forceUpdate","updateFlow","viewContents","isRendered","PI_D2","PI","EASING_EQUATIONS","easeOutSine","sin","easeInOutSine","cos","easeInOutQuint","easeInCubic","Snap","manager","duration","minVelocity","minDistance","easing","supportsTouch","setup","disableScroll","afterScrolledTimeout","isVertical","touchCanceler","resizeCanceler","snapping","startTouchX","startTouchY","startTime","endTouchX","endTouchY","endTime","enableScroll","_onResize","_onTouchStart","_onTouchMove","onTouchMove","_onTouchEnd","_afterDisplayed","triggerViewEvent","swipped","wasSwiped","snap","snapWidth","distance","velocity","needsSnap","howMany","snapTo","smoothScrollTo","destination","timeFunction","scroll","performance","ContinuousViewManager","offsetDelta","fill","_full","full","removeShownListeners","expanded","_offset","updating","trimTimeout","_offsetLeft","_offsetTop","checking","newViews","rtl","visibleLength","contentLength","firstIndex","lastIndex","above","below","erase","prevTop","prevLeft","addScrollListeners","snapper","prevScrollTop","prevScrollLeft","scrollDeltaVert","scrollDeltaHorz","_scrolled","didScroll","scrollTimeout","book","stylesheet","script","handleLinks","passEvents","adjustImages","injectIdentifier","injectStylesheet","injectScript","opened","starting","started","setManager","requireManager","viewManager","requireView","ViewManager","package","determineLayoutProperties","afterRemoved","reportLocation","_display","triggerMarkEvent","_layout","changed","reportedLocation","reportedLocationAfterRAF","located","locationStart","locationEnd","pageStart","pageEnd","atEnd","atStart","computed","ident","packaging","withCredentials","headers","supportsURL","BLOB_RESPONSE","xhr","xhrPrototype","xmlHttpRequestOverrideMimeType","setRequestHeader","responseType","overrideMimeType","DONE","responseXML","message","Archive","zip","urlCache","checkRequirements","JSZip","isBase64","loadAsync","openUrl","zipUrl","getBlob","handleResponse","decodededUrl","decodeURIComponent","entry","file","uint8array","getBase64","useBase64","base64","revokeUrl","fromCache","Store","requester","storage","httpRequest","online","store","localforage","createInstance","onLine","mapped","encodedUrl","put","retrieve","readAsText","CONTAINER_PATH","INPUT_TYPE","BINARY","BASE64","EPUB","OPF","MANIFEST","DIRECTORY","Book","requestMethod","requestCredentials","requestHeaders","openAs","opening","isOpen","navigation","archived","determineType","openEpub","openPackaging","openManifest","openContainer","unarchive","loadNavigation","renderTo","setRequestCredentials","credentials","setRequestHeaders","replacementsSetting","originalUrl","substituteResources","coverUrl","retrieved","factory","hasWorkingUrl","forceJURL","u","relativePathDotMapping","isRelativeScheme","scheme","invalid","_isInvalid","IDNAToASCII","percentEscape","unicode","percentEscapeQuery","EOF","ALPHA","ALPHANUMERIC","stateOverride","cursor","buffer","seenAt","seenBracket","loop","_scheme","_isRelative","_fragment","_schemeData","_host","_port","_path","_username","_password","nextC","nextNextC","cp","tempC","temp","jURL","_url","authority","host","hostname","port","OriginalURL","ePub","VERSION","CFI","utils","PrefabViews","sort","reused","PrePaginatedContinuousViewManager","_manifest","_spine","_redrawViews","section_","sizeToViewport","faking","_buildManifest","viewports","viewport_width","viewport_height","prev_","next_","_max_height","_max_viewport_height","_max_width","_max_viewport_width","debugManager","backgroundImage","colorR","colorG","colorB","backgroundColor","scrollIntoView","retval","waiting","has_section","_checkStillLoading","fillXX","updateXXX","divs","marker","prePaginated","adjusted_top","adjusted_end","__check_visible","recenter","w3","sizeToViewport_X","resetScale","ReusableIframeView","_layout_height","EpubJS","_epubjs_ready","sessionStorage","book_href","book_options","useArchive","_book","removeItem","_contents","parseRootfiles","_rendition","containerDoc","_drawRendition","_updateFontSize","status_index","inner","_initializeReaderStyles","_queueTimeout","rootFilePath","newScrollTop","_navigate","guessed","path1","path2","navigating","doUpdate","_updateScale","reload","_selectTheme","_cached_location","custom_stylesheet_rules","_fired","mod","xyz","refresh","_queueScale","_metadata","createReader","Mock","__currentIndex","engines","epubjs","mock","COZY_EPUB_ENGINE","engine_href","COZY_EPUB_ENGINE_HREF"],"mappings":"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"}
>>>>>>> d739dde... initial use import epub.js
