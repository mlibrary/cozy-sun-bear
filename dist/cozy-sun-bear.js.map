{"version":3,"file":"cozy-sun-bear.js","sources":["../src/core/Util.js","../src/core/Class.js","../src/core/Events.js","../src/core/Browser.js","../src/geometry/Point.js","../src/dom/DomEvent.Pointer.js","../src/dom/DomEvent.DoubleTap.js","../src/dom/DomEvent.js","../src/dom/DomUtil.js","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../src/screenfull.js","../src/reader/Reader.js","../src/control/Control.js","../src/control/Control.Paging.js","../src/control/Modal.js","../src/control/Control.Contents.js","../src/control/Control.Title.js","../src/control/Control.PublicationMetadata.js","../src/control/Control.Preferences.js","../src/control/Control.Widget.js","../node_modules/parse-full-name/index.js","../src/control/Control.Citation.js","../src/control/Control.Search.js","../src/control/Control.CitationOptions.js","../src/control/Control.BibliographicInformation.js","../src/control/Control.Download.js","../src/control/Control.Navigator.js","../src/control/index.js","../src/core/Bus.js","../src/core/index.js","../src/epubjs.js","../src/reader/Reader.EpubJS.js","../src/reader/Reader.Mock.js","../src/reader/Reader.EpubJSv2.js","../src/reader/Reader.Readium.js","../src/reader/index.js","../src/cozy.js"],"sourcesContent":["/*\n * @namespace Util\n *\n * Various utility functions, used by Leaflet internally.\n */\n\n// @function extend(dest: Object, src?: Object): Object\n// Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.\nexport function extend(dest) {\n    var i, j, len, src;\n\n    for (j = 1, len = arguments.length; j < len; j++) {\n        src = arguments[j];\n        for (i in src) {\n            dest[i] = src[i];\n        }\n    }\n    return dest;\n}\n\n// @function create(proto: Object, properties?: Object): Object\n// Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\nexport var create = Object.create || (function () {\n    function F() {}\n    return function (proto) {\n        F.prototype = proto;\n        return new F();\n    };\n})();\n\n// @function bind(fn: Function, …): Function\n// Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n// Has a `L.bind()` shortcut.\nexport function bind(fn, obj) {\n    var slice = Array.prototype.slice;\n\n    if (fn.bind) {\n        return fn.bind.apply(fn, slice.call(arguments, 1));\n    }\n\n    var args = slice.call(arguments, 2);\n\n    return function () {\n        return fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\n    };\n}\n\n// @property lastId: Number\n// Last unique ID used by [`stamp()`](#util-stamp)\nexport var lastId = 0;\n\n// @function stamp(obj: Object): Number\n// Returns the unique ID of an object, assiging it one if it doesn't have it.\nexport function stamp(obj) {\n    /*eslint-disable */\n    obj._cozy_id = obj._cozy_id || ++lastId;\n    return obj._cozy_id; /* not leaflet */\n    /*eslint-enable */\n}\n\n// @function throttle(fn: Function, time: Number, context: Object): Function\n// Returns a function which executes function `fn` with the given scope `context`\n// (so that the `this` keyword refers to `context` inside `fn`'s code). The function\n// `fn` will be called no more than one time per given amount of `time`. The arguments\n// received by the bound function will be any arguments passed when binding the\n// function, followed by any arguments passed when invoking the bound function.\n// Has an `L.throttle` shortcut.\nexport function throttle(fn, time, context) {\n    var lock, args, wrapperFn, later;\n\n    later = function () {\n        // reset lock and call if queued\n        lock = false;\n        if (args) {\n            wrapperFn.apply(context, args);\n            args = false;\n        }\n    };\n\n    wrapperFn = function () {\n        if (lock) {\n            // called too soon, queue to call later\n            args = arguments;\n\n        } else {\n            // call and lock until later\n            fn.apply(context, arguments);\n            setTimeout(later, time);\n            lock = true;\n        }\n    };\n\n    return wrapperFn;\n}\n\n// @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number\n// Returns the number `num` modulo `range` in such a way so it lies within\n// `range[0]` and `range[1]`. The returned value will be always smaller than\n// `range[1]` unless `includeMax` is set to `true`.\nexport function wrapNum(x, range, includeMax) {\n    var max = range[1],\n        min = range[0],\n        d = max - min;\n    return x === max && includeMax ? x : ((x - min) % d + d) % d + min;\n}\n\n// @function falseFn(): Function\n// Returns a function which always returns `false`.\nexport function falseFn() { return false; }\n\n// @function formatNum(num: Number, digits?: Number): Number\n// Returns the number `num` rounded to `digits` decimals, or to 5 decimals by default.\nexport function formatNum(num, digits) {\n    var pow = Math.pow(10, digits || 5);\n    return Math.round(num * pow) / pow;\n}\n\n// @function isNumeric(num: Number): Boolean\n// Returns whether num is actually numeric\nexport function isNumeric(num) {\n  return !isNaN(parseFloat(num)) && isFinite(num);\n}\n\n// @function trim(str: String): String\n// Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)\nexport function trim(str) {\n    return str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\n}\n\n// @function splitWords(str: String): String[]\n// Trims and splits the string on whitespace and returns the array of parts.\nexport function splitWords(str) {\n    return trim(str).split(/\\s+/);\n}\n\n// @function setOptions(obj: Object, options: Object): Object\n// Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.\nexport function setOptions(obj, options) {\n    if (!obj.hasOwnProperty('options')) {\n        obj.options = obj.options ? create(obj.options) : {};\n    }\n    for (var i in options) {\n        obj.options[i] = options[i];\n    }\n    return obj.options;\n}\n\n// @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\n// Converts an object into a parameter URL string, e.g. `{a: \"foo\", b: \"bar\"}`\n// translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will\n// be appended at the end. If `uppercase` is `true`, the parameter names will\n// be uppercased (e.g. `'?A=foo&B=bar'`)\nexport function getParamString(obj, existingUrl, uppercase) {\n    var params = [];\n    for (var i in obj) {\n        params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\n    }\n    return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\n}\n\nvar templateRe = /\\{ *([\\w_\\-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values — they will be evaluated passing `data` as an argument.\nexport function template(str, data) {\n    return str.replace(templateRe, function (str, key) {\n        var value = data[key];\n\n        if (value === undefined) {\n            throw new Error('No value provided for variable ' + str);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n}\n\n// @function isArray(obj): Boolean\n// Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)\nexport var isArray = Array.isArray || function (obj) {\n    return (Object.prototype.toString.call(obj) === '[object Array]');\n};\n\n// @function indexOf(array: Array, el: Object): Number\n// Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)\nexport function indexOf(array, el) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i] === el) { return i; }\n    }\n    return -1;\n}\n\n// @property emptyImageUrl: String\n// Data URI string containing a base64-encoded empty GIF image.\n// Used as a hack to free memory from unused images on WebKit-powered\n// mobile devices (by setting image `src` to this string).\nexport var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n\nfunction getPrefixed(name) {\n    return window['webkit' + name] || window['moz' + name] || window['ms' + name];\n}\n\nvar lastTime = 0;\n\n// fallback for IE 7-8\nfunction timeoutDefer(fn) {\n    var time = +new Date(),\n        timeToCall = Math.max(0, 16 - (time - lastTime));\n\n    lastTime = time + timeToCall;\n    return window.setTimeout(fn, timeToCall);\n}\n\nexport var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\nexport var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\n        getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\n\n// @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number\n// Schedules `fn` to be executed when the browser repaints. `fn` is bound to\n// `context` if given. When `immediate` is set, `fn` is called immediately if\n// the browser doesn't have native support for\n// [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\n// otherwise it's delayed. Returns a request ID that can be used to cancel the request.\nexport function requestAnimFrame(fn, context, immediate) {\n    if (immediate && requestFn === timeoutDefer) {\n        fn.call(context);\n    } else {\n        return requestFn.call(window, bind(fn, context));\n    }\n}\n\n// @function cancelAnimFrame(id: Number): undefined\n// Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\nexport function cancelAnimFrame(id) {\n    if (id) {\n        cancelFn.call(window, id);\n    }\n}\n","import * as Util from './Util';\r\n\r\n// @class Class\r\n// @aka L.Class\r\n\r\n// @section\r\n// @uninheritable\r\n\r\n// Thanks to John Resig and Dean Edwards for inspiration!\r\n\r\nexport function Class() {}\r\n\r\nClass.extend = function (props) {\r\n\r\n\t// @function extend(props: Object): Function\r\n\t// [Extends the current class](#class-inheritance) given the properties to be included.\r\n\t// Returns a Javascript function that is a class constructor (to be called with `new`).\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tthis.callInitHooks();\r\n\t};\r\n\r\n\tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n\tvar proto = Util.create(parentProto);\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t// inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tUtil.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tcheckDeprecatedMixinEvents(props.includes);\r\n\t\tUtil.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (proto.options) {\r\n\t\tprops.options = Util.extend(Util.create(proto.options), props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tUtil.extend(proto, props);\r\n\t\r\n\tproto._initHooks = [];\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parentProto.callInitHooks) {\r\n\t\t\tparentProto.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// @function include(properties: Object): this\r\n// [Includes a mixin](#class-includes) into the current class.\r\nClass.include = function (props) {\r\n\tUtil.extend(this.prototype, props);\r\n\treturn this;\r\n};\r\n\r\n// @function mergeOptions(options: Object): this\r\n// [Merges `options`](#class-options) into the defaults of the class.\r\nClass.mergeOptions = function (options) {\r\n\tUtil.extend(this.prototype.options, options);\r\n\treturn this;\r\n};\r\n\r\n// @function addInitHook(fn: Function): this\r\n// Adds a [constructor hook](#class-constructor-hooks) to the class.\r\nClass.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n\treturn this;\r\n};\r\n\r\nfunction checkDeprecatedMixinEvents(includes) {\r\n\tif (!cozy || !cozy.Mixin) { return; }\r\n\r\n\tincludes = cozy.Util.isArray(includes) ? includes : [includes];\r\n\r\n\t// for (var i = 0; i < includes.length; i++) {\r\n\t// \tif (includes[i] === cozy.Mixin.Events) {\r\n\t// \t\tconsole.warn('Deprecated include of cozy.Mixin.Events: ' +\r\n\t// \t\t\t'this property will be removed in future releases, ' +\r\n\t// \t\t\t'please inherit from cozy.Evented instead.', new Error().stack);\r\n\t// \t}\r\n\t// }\r\n}\r\n","import {Class} from './Class';\r\nimport * as Util from './Util';\r\n\r\n/*\r\n * @class Evented\r\n * @aka L.Evented\r\n * @inherits Class\r\n *\r\n * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * map.on('click', function(e) {\r\n * \talert(e.latlng);\r\n * } );\r\n * ```\r\n *\r\n * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:\r\n *\r\n * ```js\r\n * function onClick(e) { ... }\r\n *\r\n * map.on('click', onClick);\r\n * map.off('click', onClick);\r\n * ```\r\n */\r\n\r\nexport var Evented = Class.extend({\r\n\r\n\t/* @method on(type: String, fn: Function, context?: Object): this\r\n\t * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).\r\n\t *\r\n\t * @alternative\r\n\t * @method on(eventMap: Object): this\r\n\t * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\t */\r\n\ton: function (types, fn, context) {\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\t// we don't process space-separated events here for performance;\r\n\t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n\t\t\t\tthis._on(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._on(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/* @method off(type: String, fn?: Function, context?: Object): this\r\n\t * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.\r\n\t *\r\n\t * @alternative\r\n\t * @method off(eventMap: Object): this\r\n\t * Removes a set of type/listener pairs.\r\n\t *\r\n\t * @alternative\r\n\t * @method off: this\r\n\t * Removes all listeners to all events on the object.\r\n\t */\r\n\toff: function (types, fn, context) {\r\n\r\n\t\tif (!types) {\r\n\t\t\t// clear all listeners if called without arguments\r\n\t\t\tdelete this._events;\r\n\r\n\t\t} else if (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis._off(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\ttypes = Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._off(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// attach listener (without syntactic sugar now)\r\n\t_on: function (type, fn, context) {\r\n\t\tthis._events = this._events || {};\r\n\r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._events[type];\r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._events[type] = typeListeners;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\t// Less memory footprint.\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\t\tvar newListener = {fn: fn, ctx: context},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if fn already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].fn === fn && listeners[i].ctx === context) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlisteners.push(newListener);\r\n\t},\r\n\r\n\t_off: function (type, fn, context) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n\r\n\t\tif (!this._events) { return; }\r\n\r\n\t\tlisteners = this._events[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!fn) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].fn = Util.falseFn;\r\n\t\t\t}\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._events[type];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\tcontext = undefined;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find fn and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.ctx !== context) { continue; }\r\n\t\t\t\tif (l.fn === fn) {\r\n\r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\tl.fn = Util.falseFn;\r\n\r\n\t\t\t\t\tif (this._firingCount) {\r\n\t\t\t\t\t\t/* copy array in case events are being fired */\r\n\t\t\t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners.splice(i, 1);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// @method fire(type: String, data?: Object, propagate?: Boolean): this\r\n\t// Fires an event of the specified type. You can optionally provide an data\r\n\t// object — the first argument of the listener function will contain its\r\n\t// properties. The event can optionally be propagated to event parents.\r\n\tfire: function (type, data, propagate) {\r\n\t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n\t\tvar event = Util.extend({}, data, {type: type, target: this});\r\n\r\n\t\tif (this._events) {\r\n\t\t\tvar listeners = this._events[type];\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n\t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tvar l = listeners[i];\r\n\t\t\t\t\tl.fn.call(l.ctx || this, event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._firingCount--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// propagate the event to parents (set with addEventParent)\r\n\t\t\tthis._propagateEvent(event);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method listens(type: String): Boolean\r\n\t// Returns `true` if a particular event type has any listeners attached to it.\r\n\tlistens: function (type, propagate) {\r\n\t\tvar listeners = this._events && this._events[type];\r\n\t\tif (listeners && listeners.length) { return true; }\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// also check parents for listeners if event propagates\r\n\t\t\tfor (var id in this._eventParents) {\r\n\t\t\t\tif (this._eventParents[id].listens(type, propagate)) { return true; }\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// @method once(…): this\r\n\t// Behaves as [`on(…)`](#evented-on), except the listener will only get fired once and then removed.\r\n\tonce: function (types, fn, context) {\r\n\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis.once(type, types[type], fn);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar handler = Util.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .off(types, fn, context)\r\n\t\t\t    .off(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\t// add a listener that's executed once and removed after that\r\n\t\treturn this\r\n\t\t    .on(types, fn, context)\r\n\t\t    .on(types, handler, context);\r\n\t},\r\n\r\n\t// @method addEventParent(obj: Evented): this\r\n\t// Adds an event parent - an `Evented` that will receive propagated events\r\n\taddEventParent: function (obj) {\r\n\t\tthis._eventParents = this._eventParents || {};\r\n\t\tthis._eventParents[Util.stamp(obj)] = obj;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method removeEventParent(obj: Evented): this\r\n\t// Removes an event parent, so it will stop receiving propagated events\r\n\tremoveEventParent: function (obj) {\r\n\t\tif (this._eventParents) {\r\n\t\t\tdelete this._eventParents[Util.stamp(obj)];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\tfor (var id in this._eventParents) {\r\n\t\t\tthis._eventParents[id].fire(e.type, Util.extend({layer: e.target}, e), true);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nvar proto = Evented.prototype;\r\n\r\n// aliases; we should ditch those eventually\r\n\r\n// @method addEventListener(…): this\r\n// Alias to [`on(…)`](#evented-on)\r\nproto.addEventListener = proto.on;\r\n\r\n// @method removeEventListener(…): this\r\n// Alias to [`off(…)`](#evented-off)\r\n\r\n// @method clearAllEventListeners(…): this\r\n// Alias to [`off()`](#evented-off)\r\nproto.removeEventListener = proto.clearAllEventListeners = proto.off;\r\n\r\n// @method addOneTimeEventListener(…): this\r\n// Alias to [`once(…)`](#evented-once)\r\nproto.addOneTimeEventListener = proto.once;\r\n\r\n// @method fireEvent(…): this\r\n// Alias to [`fire(…)`](#evented-fire)\r\nproto.fireEvent = proto.fire;\r\n\r\n// @method hasEventListeners(…): Boolean\r\n// Alias to [`listens(…)`](#evented-listens)\r\nproto.hasEventListeners = proto.listens;\r\n","\n/*\n * @namespace Browser\n * @aka L.Browser\n *\n * A namespace with static properties for browser/feature detection used by Leaflet internally.\n *\n * @example\n *\n * ```js\n * if (L.Browser.ielt9) {\n *   alert('Upgrade your browser, dude!');\n * }\n * ```\n */\n\nvar style = document.documentElement.style;\n\n// @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).\nexport var ie = 'ActiveXObject' in window;\n\n// @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.\nexport var ielt9 = ie && !document.addEventListener;\n\n// @property edge: Boolean; `true` for the Edge web browser.\nexport var edge = 'msLaunchUri' in navigator && !('documentMode' in document);\n\n// @property webkit: Boolean;\n// `true` for webkit-based browsers like Chrome and Safari (including mobile versions).\nexport var webkit = userAgentContains('webkit');\n\n// @property android: Boolean\n// `true` for any browser running on an Android platform.\nexport var android = userAgentContains('android');\n\n// @property android23: Boolean; `true` for browsers running on Android 2 or Android 3.\nexport var android23 = userAgentContains('android 2') || userAgentContains('android 3');\n\n// @property opera: Boolean; `true` for the Opera browser\nexport var opera = !!window.opera;\n\n// @property chrome: Boolean; `true` for the Chrome browser.\nexport var chrome = userAgentContains('chrome');\n\n// @property gecko: Boolean; `true` for gecko-based browsers like Firefox.\nexport var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;\n\n// @property safari: Boolean; `true` for the Safari browser.\nexport var safari = !chrome && userAgentContains('safari');\n\nexport var phantom = userAgentContains('phantom');\n\n// @property opera12: Boolean\n// `true` for the Opera browser supporting CSS transforms (version 12 or later).\nexport var opera12 = 'OTransition' in style;\n\n// @property win: Boolean; `true` when the browser is running in a Windows platform\nexport var win = navigator.platform.indexOf('Win') === 0;\n\n// @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.\nexport var ie3d = ie && ('transition' in style);\n\n// @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.\nexport var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;\n\n// @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.\nexport var gecko3d = 'MozPerspective' in style;\n\n// @property any3d: Boolean\n// `true` for all browsers supporting CSS transforms.\nexport var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;\n\n// @property mobile: Boolean; `true` for all browsers running in a mobile device.\nexport var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');\n\n// @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.\nexport var mobileWebkit = mobile && webkit;\n\n// @property mobileWebkit3d: Boolean\n// `true` for all webkit-based browsers in a mobile device supporting CSS transforms.\nexport var mobileWebkit3d = mobile && webkit3d;\n\n// @property msPointer: Boolean\n// `true` for browsers implementing the Microsoft touch events model (notably IE10).\nexport var msPointer = !window.PointerEvent && window.MSPointerEvent;\n\n// @property pointer: Boolean\n// `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\nexport var pointer = !!(window.PointerEvent || msPointer);\n\n// @property touch: Boolean\n// `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).\n// This does not necessarily mean that the browser is running in a computer with\n// a touchscreen, it only means that the browser is capable of understanding\n// touch events.\nexport var touch = !window.L_NO_TOUCH && (pointer || 'ontouchstart' in window ||\n        (window.DocumentTouch && document instanceof window.DocumentTouch));\n\n// @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.\nexport var mobileOpera = mobile && opera;\n\n// @property mobileGecko: Boolean\n// `true` for gecko-based browsers running in a mobile device.\nexport var mobileGecko = mobile && gecko;\n\n// @property retina: Boolean\n// `true` for browsers on a high-resolution \"retina\" screen.\nexport var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;\n\n\n// @property canvas: Boolean\n// `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\nexport var canvas = (function () {\n    return !!document.createElement('canvas').getContext;\n}());\n\n// @property svg: Boolean\n// `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).\n// export var svg = !!(document.createElementNS && svgCreate('svg').createSVGRect);\nexport var svg = true;\n\n// @property vml: Boolean\n// `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).\nexport var vml = !svg && (function () {\n    try {\n        var div = document.createElement('div');\n        div.innerHTML = '<v:shape adj=\"1\"/>';\n\n        var shape = div.firstChild;\n        shape.style.behavior = 'url(#default#VML)';\n\n        return shape && (typeof shape.adj === 'object');\n\n    } catch (e) {\n        return false;\n    }\n}());\n\n\nfunction userAgentContains(str) {\n    return navigator.userAgent.toLowerCase().indexOf(str) >= 0;\n}\n","import {isArray, formatNum} from '../core/Util';\r\n\r\n/*\r\n * @class Point\r\n * @aka L.Point\r\n *\r\n * Represents a point with `x` and `y` coordinates in pixels.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * var point = L.point(200, 300);\r\n * ```\r\n *\r\n * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:\r\n *\r\n * ```js\r\n * map.panBy([200, 300]);\r\n * map.panBy(L.point(200, 300));\r\n * ```\r\n */\r\n\r\nexport function Point(x, y, round) {\r\n\t// @property x: Number; The `x` coordinate of the point\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\t// @property y: Number; The `y` coordinate of the point\r\n\tthis.y = (round ? Math.round(y) : y);\r\n}\r\n\r\nPoint.prototype = {\r\n\r\n\t// @method clone(): Point\r\n\t// Returns a copy of the current point.\r\n\tclone: function () {\r\n\t\treturn new Point(this.x, this.y);\r\n\t},\r\n\r\n\t// @method add(otherPoint: Point): Point\r\n\t// Returns the result of addition of the current and the given points.\r\n\tadd: function (point) {\r\n\t\t// non-destructive, returns a new point\r\n\t\treturn this.clone()._add(toPoint(point));\r\n\t},\r\n\r\n\t_add: function (point) {\r\n\t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method subtract(otherPoint: Point): Point\r\n\t// Returns the result of subtraction of the given point from the current.\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(toPoint(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method divideBy(num: Number): Point\r\n\t// Returns the result of division of the current point by the given number.\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method multiplyBy(num: Number): Point\r\n\t// Returns the result of multiplication of the current point by the given number.\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method scaleBy(scale: Point): Point\r\n\t// Multiply each coordinate of the current point by each coordinate of\r\n\t// `scale`. In linear algebra terms, multiply the point by the\r\n\t// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)\r\n\t// defined by `scale`.\r\n\tscaleBy: function (point) {\r\n\t\treturn new Point(this.x * point.x, this.y * point.y);\r\n\t},\r\n\r\n\t// @method unscaleBy(scale: Point): Point\r\n\t// Inverse of `scaleBy`. Divide each coordinate of the current point by\r\n\t// each coordinate of `scale`.\r\n\tunscaleBy: function (point) {\r\n\t\treturn new Point(this.x / point.x, this.y / point.y);\r\n\t},\r\n\r\n\t// @method round(): Point\r\n\t// Returns a copy of the current point with rounded coordinates.\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method floor(): Point\r\n\t// Returns a copy of the current point with floored coordinates (rounded down).\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method ceil(): Point\r\n\t// Returns a copy of the current point with ceiled coordinates (rounded up).\r\n\tceil: function () {\r\n\t\treturn this.clone()._ceil();\r\n\t},\r\n\r\n\t_ceil: function () {\r\n\t\tthis.x = Math.ceil(this.x);\r\n\t\tthis.y = Math.ceil(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method distanceTo(otherPoint: Point): Number\r\n\t// Returns the cartesian distance between the current and the given points.\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\t// @method equals(otherPoint: Point): Boolean\r\n\t// Returns `true` if the given point has the same coordinates.\r\n\tequals: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\t// @method contains(otherPoint: Point): Boolean\r\n\t// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).\r\n\tcontains: function (point) {\r\n\t\tpoint = toPoint(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// Returns a string representation of the point for debugging purposes.\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        formatNum(this.x) + ', ' +\r\n\t\t        formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\n// @factory L.point(x: Number, y: Number, round?: Boolean)\r\n// Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Number[])\r\n// Expects an array of the form `[x, y]` instead.\r\n\r\n// @alternative\r\n// @factory L.point(coords: Object)\r\n// Expects a plain object of the form `{x: Number, y: Number}` instead.\r\nexport function toPoint(x, y, round) {\r\n\tif (x instanceof Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (isArray(x)) {\r\n\t\treturn new Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\tif (typeof x === 'object' && 'x' in x && 'y' in x) {\r\n\t\treturn new Point(x.x, x.y);\r\n\t}\r\n\treturn new Point(x, y, round);\r\n}\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport * as Browser from '../core/Browser';\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\n\nvar POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown',\n    POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove',\n    POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup',\n    POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n    TAG_WHITE_LIST = ['INPUT', 'SELECT', 'OPTION'],\n\n    _pointers = {},\n    _pointerDocListener = false;\n\n// DomEvent.DoubleTap needs to know about this\nexport var _pointersCount = 0;\n\n// Provides a touch events wrapper for (ms)pointer events.\n// ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\nexport function addPointerListener(obj, type, handler, id) {\n\tif (type === 'touchstart') {\n\t\t_addPointerStart(obj, handler, id);\n\n\t} else if (type === 'touchmove') {\n\t\t_addPointerMove(obj, handler, id);\n\n\t} else if (type === 'touchend') {\n\t\t_addPointerEnd(obj, handler, id);\n\t}\n\n\treturn this;\n}\n\nexport function removePointerListener(obj, type, id) {\n\tvar handler = obj['_leaflet_' + type + id];\n\n\tif (type === 'touchstart') {\n\t\tobj.removeEventListener(POINTER_DOWN, handler, false);\n\n\t} else if (type === 'touchmove') {\n\t\tobj.removeEventListener(POINTER_MOVE, handler, false);\n\n\t} else if (type === 'touchend') {\n\t\tobj.removeEventListener(POINTER_UP, handler, false);\n\t\tobj.removeEventListener(POINTER_CANCEL, handler, false);\n\t}\n\n\treturn this;\n}\n\nfunction _addPointerStart(obj, handler, id) {\n\tvar onDown = Util.bind(function (e) {\n\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\n\t\t\t// In IE11, some touch events needs to fire for form controls, or\n\t\t\t// the controls will stop working. We keep a whitelist of tag names that\n\t\t\t// need these events. For other target tags, we prevent default on the event.\n\t\t\tif (TAG_WHITE_LIST.indexOf(e.target.tagName) < 0) {\n\t\t\t\tDomEvent.preventDefault(e);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t_handlePointer(e, handler);\n\t});\n\n\tobj['_leaflet_touchstart' + id] = onDown;\n\tobj.addEventListener(POINTER_DOWN, onDown, false);\n\n\t// need to keep track of what pointers and how many are active to provide e.touches emulation\n\tif (!_pointerDocListener) {\n\t\t// we listen documentElement as any drags that end by moving the touch off the screen get fired there\n\t\tdocument.documentElement.addEventListener(POINTER_DOWN, _globalPointerDown, true);\n\t\tdocument.documentElement.addEventListener(POINTER_MOVE, _globalPointerMove, true);\n\t\tdocument.documentElement.addEventListener(POINTER_UP, _globalPointerUp, true);\n\t\tdocument.documentElement.addEventListener(POINTER_CANCEL, _globalPointerUp, true);\n\n\t\t_pointerDocListener = true;\n\t}\n}\n\nfunction _globalPointerDown(e) {\n\t_pointers[e.pointerId] = e;\n\t_pointersCount++;\n}\n\nfunction _globalPointerMove(e) {\n\tif (_pointers[e.pointerId]) {\n\t\t_pointers[e.pointerId] = e;\n\t}\n}\n\nfunction _globalPointerUp(e) {\n\tdelete _pointers[e.pointerId];\n\t_pointersCount--;\n}\n\nfunction _handlePointer(e, handler) {\n\te.touches = [];\n\tfor (var i in _pointers) {\n\t\te.touches.push(_pointers[i]);\n\t}\n\te.changedTouches = [e];\n\n\thandler(e);\n}\n\nfunction _addPointerMove(obj, handler, id) {\n\tvar onMove = function (e) {\n\t\t// don't fire touch moves when mouse isn't down\n\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchmove' + id] = onMove;\n\tobj.addEventListener(POINTER_MOVE, onMove, false);\n}\n\nfunction _addPointerEnd(obj, handler, id) {\n\tvar onUp = function (e) {\n\t\t_handlePointer(e, handler);\n\t};\n\n\tobj['_leaflet_touchend' + id] = onUp;\n\tobj.addEventListener(POINTER_UP, onUp, false);\n\tobj.addEventListener(POINTER_CANCEL, onUp, false);\n}\n\n","import * as Browser from '../core/Browser';\r\nimport {_pointersCount} from './DomEvent.Pointer';\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nvar _touchstart = Browser.msPointer ? 'MSPointerDown' : Browser.pointer ? 'pointerdown' : 'touchstart',\r\n    _touchend = Browser.msPointer ? 'MSPointerUp' : Browser.pointer ? 'pointerup' : 'touchend',\r\n    _pre = '_leaflet_';\r\n\r\n// inspired by Zepto touch code by Thomas Fuchs\r\nexport function addDoubleTapListener(obj, handler, id) {\r\n\tvar last, touch,\r\n\t    doubleTap = false,\r\n\t    delay = 250;\r\n\r\n\tfunction onTouchStart(e) {\r\n\t\tvar count;\r\n\r\n\t\tif (Browser.pointer) {\r\n\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\tcount = _pointersCount;\r\n\t\t} else {\r\n\t\t\tcount = e.touches.length;\r\n\t\t}\r\n\r\n\t\tif (count > 1) { return; }\r\n\r\n\t\tvar now = Date.now(),\r\n\t\t    delta = now - (last || now);\r\n\r\n\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\tlast = now;\r\n\t}\r\n\r\n\tfunction onTouchEnd(e) {\r\n\t\tif (doubleTap && !touch.cancelBubble) {\r\n\t\t\tif (Browser.pointer) {\r\n\t\t\t\tif ((!Browser.edge) || e.pointerType === 'mouse') { return; }\r\n\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\tvar newTouch = {},\r\n\t\t\t\t    prop, i;\r\n\r\n\t\t\t\tfor (i in touch) {\r\n\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\tnewTouch[i] = prop && prop.bind ? prop.bind(touch) : prop;\r\n\t\t\t\t}\r\n\t\t\t\ttouch = newTouch;\r\n\t\t\t}\r\n\t\t\ttouch.type = 'dblclick';\r\n\t\t\thandler(touch);\r\n\t\t\tlast = null;\r\n\t\t}\r\n\t}\r\n\r\n\tobj[_pre + _touchstart + id] = onTouchStart;\r\n\tobj[_pre + _touchend + id] = onTouchEnd;\r\n\tobj[_pre + 'dblclick' + id] = handler;\r\n\r\n\tobj.addEventListener(_touchstart, onTouchStart, false);\r\n\tobj.addEventListener(_touchend, onTouchEnd, false);\r\n\r\n\t// On some platforms (notably, chrome<55 on win10 + touchscreen + mouse),\r\n\t// the browser doesn't fire touchend/pointerup events but does fire\r\n\t// native dblclicks. See #4127.\r\n\t// Edge 14 also fires native dblclicks, but only for pointerType mouse, see #5180.\r\n\tobj.addEventListener('dblclick', handler, false);\r\n\r\n\treturn this;\r\n}\r\n\r\nexport function removeDoubleTapListener(obj, id) {\r\n\tvar touchstart = obj[_pre + _touchstart + id],\r\n\t    touchend = obj[_pre + _touchend + id],\r\n\t    dblclick = obj[_pre + 'dblclick' + id];\r\n\r\n\tobj.removeEventListener(_touchstart, touchstart, false);\r\n\tobj.removeEventListener(_touchend, touchend, false);\r\n\tif (!Browser.edge) {\r\n\t\tobj.removeEventListener('dblclick', dblclick, false);\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n","import {Point} from '../geometry/Point';\r\nimport * as Util from '../core/Util';\r\nimport * as Browser from '../core/Browser';\r\nimport {addPointerListener, removePointerListener} from './DomEvent.Pointer';\r\nimport {addDoubleTapListener, removeDoubleTapListener} from './DomEvent.DoubleTap';\r\n\r\n/*\r\n * @namespace DomEvent\r\n * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.\r\n */\r\n\r\n// Inspired by John Resig, Dean Edwards and YUI addEvent implementations.\r\n\r\n// @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Adds a listener function (`fn`) to a particular DOM event type of the\r\n// element `el`. You can optionally specify the context of the listener\r\n// (object the `this` keyword will point to). You can also pass several\r\n// space-separated types (e.g. `'click dblclick'`).\r\n\r\n// @alternative\r\n// @function on(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\nexport function on(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\taddOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\taddOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n}\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\n// @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n// Removes a previously added listener function. If no function is specified,\r\n// it will remove all the listeners of that particular DOM event from the element.\r\n// Note that if you passed a custom context to on, you must pass the same\r\n// context to `off` in order to remove the listener.\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement, eventMap: Object, context?: Object): this\r\n// Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\r\n// @alternative\r\n// @function off(el: HTMLElement): this\r\n// Removes all known event listeners\r\nexport function off(obj, types, fn, context) {\r\n\r\n\tif (typeof types === 'object') {\r\n\t\tfor (var type in types) {\r\n\t\t\tremoveOne(obj, type, types[type], fn);\r\n\t\t}\r\n\t} else if (types) {\r\n\t\ttypes = Util.splitWords(types);\r\n\r\n\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\tremoveOne(obj, types[i], fn, context);\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var j in obj[eventsKey]) {\r\n\t\t\tremoveOne(obj, j, obj[eventsKey][j]);\r\n\t\t}\r\n\t\tdelete obj[eventsKey];\r\n\t}\r\n}\r\n\r\nfunction addOne(obj, type, fn, context) {\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : '');\r\n\r\n\tif (obj[eventsKey] && obj[eventsKey][id]) { return this; }\r\n\r\n\tvar handler = function (e) {\r\n\t\treturn fn.call(context || obj, e || window.event);\r\n\t};\r\n\r\n\tvar originalHandler = handler;\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t// Needs DomEvent.Pointer.js\r\n\t\taddPointerListener(obj, type, handler, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && addDoubleTapListener &&\r\n\t           !(Browser.pointer && Browser.chrome)) {\r\n\t\t// Chrome >55 does not need the synthetic dblclicks from addDoubleTapListener\r\n\t\t// See #5180\r\n\t\taddDoubleTapListener(obj, handler, id);\r\n\r\n\t} else if ('addEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.addEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\thandler = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif (isExternalTarget(obj, e)) {\r\n\t\t\t\t\toriginalHandler(e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tobj.addEventListener(type === 'mouseenter' ? 'mouseover' : 'mouseout', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tif (type === 'click' && Browser.android) {\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tfilterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('attachEvent' in obj) {\r\n\t\tobj.attachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey] = obj[eventsKey] || {};\r\n\tobj[eventsKey][id] = handler;\r\n}\r\n\r\nfunction removeOne(obj, type, fn, context) {\r\n\r\n\tvar id = type + Util.stamp(fn) + (context ? '_' + Util.stamp(context) : ''),\r\n\t    handler = obj[eventsKey] && obj[eventsKey][id];\r\n\r\n\tif (!handler) { return this; }\r\n\r\n\tif (Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\tremovePointerListener(obj, type, id);\r\n\r\n\t} else if (Browser.touch && (type === 'dblclick') && removeDoubleTapListener) {\r\n\t\tremoveDoubleTapListener(obj, id);\r\n\r\n\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\tif (type === 'mousewheel') {\r\n\t\t\tobj.removeEventListener('onwheel' in obj ? 'wheel' : 'mousewheel', handler, false);\r\n\r\n\t\t} else {\r\n\t\t\tobj.removeEventListener(\r\n\t\t\t\ttype === 'mouseenter' ? 'mouseover' :\r\n\t\t\t\ttype === 'mouseleave' ? 'mouseout' : type, handler, false);\r\n\t\t}\r\n\r\n\t} else if ('detachEvent' in obj) {\r\n\t\tobj.detachEvent('on' + type, handler);\r\n\t}\r\n\r\n\tobj[eventsKey][id] = null;\r\n}\r\n\r\n// @function stopPropagation(ev: DOMEvent): this\r\n// Stop the given event from propagation to parent elements. Used inside the listener functions:\r\n// ```js\r\n// L.DomEvent.on(div, 'click', function (ev) {\r\n// \tL.DomEvent.stopPropagation(ev);\r\n// });\r\n// ```\r\nexport function stopPropagation(e) {\r\n\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else if (e.originalEvent) {  // In case of Leaflet event.\r\n\t\te.originalEvent._stopped = true;\r\n\t} else {\r\n\t\te.cancelBubble = true;\r\n\t}\r\n\tskipped(e);\r\n\r\n\treturn this;\r\n}\r\n\r\n// @function disableScrollPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'mousewheel'` events (plus browser variants).\r\nexport function disableScrollPropagation(el) {\r\n\treturn addOne(el, 'mousewheel', stopPropagation);\r\n}\r\n\r\n// @function disableClickPropagation(el: HTMLElement): this\r\n// Adds `stopPropagation` to the element's `'click'`, `'doubleclick'`,\r\n// `'mousedown'` and `'touchstart'` events (plus browser variants).\r\nexport function disableClickPropagation(el) {\r\n\ton(el, 'mousedown touchstart dblclick', stopPropagation);\r\n\taddOne(el, 'click', fakeStop);\r\n\treturn this;\r\n}\r\n\r\n// @function preventDefault(ev: DOMEvent): this\r\n// Prevents the default action of the DOM Event `ev` from happening (such as\r\n// following a link in the href of the a element, or doing a POST request\r\n// with page reload when a `<form>` is submitted).\r\n// Use it inside listener functions.\r\nexport function preventDefault(e) {\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// @function stop(ev): this\r\n// Does `stopPropagation` and `preventDefault` at the same time.\r\nexport function stop(e) {\r\n\tpreventDefault(e);\r\n\tstopPropagation(e);\r\n\treturn this;\r\n}\r\n\r\n// @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point\r\n// Gets normalized mouse position from a DOM event relative to the\r\n// `container` or to the whole page if not specified.\r\nexport function getMousePosition(e, container) {\r\n\tif (!container) {\r\n\t\treturn new Point(e.clientX, e.clientY);\r\n\t}\r\n\r\n\tvar rect = container.getBoundingClientRect();\r\n\r\n\treturn new Point(\r\n\t\te.clientX - rect.left - container.clientLeft,\r\n\t\te.clientY - rect.top - container.clientTop);\r\n}\r\n\r\n// Chrome on Win scrolls double the pixels as in other platforms (see #4538),\r\n// and Firefox scrolls device pixels, not CSS pixels\r\nvar wheelPxFactor =\r\n\t(Browser.win && Browser.chrome) ? 2 :\r\n\tBrowser.gecko ? window.devicePixelRatio : 1;\r\n\r\n// @function getWheelDelta(ev: DOMEvent): Number\r\n// Gets normalized wheel delta from a mousewheel DOM event, in vertical\r\n// pixels scrolled (negative if scrolling down).\r\n// Events from pointing devices without precise scrolling are mapped to\r\n// a best guess of 60 pixels.\r\nexport function getWheelDelta(e) {\r\n\treturn (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta\r\n\t       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels\r\n\t       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines\r\n\t       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages\r\n\t       (e.deltaX || e.deltaZ) ? 0 :\t// Skip horizontal/depth wheel events\r\n\t       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels\r\n\t       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines\r\n\t       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages\r\n\t       0;\r\n}\r\n\r\nvar skipEvents = {};\r\n\r\nexport function fakeStop(e) {\r\n\t// fakes stopPropagation by setting a special event flag, checked/reset with skipped(e)\r\n\tskipEvents[e.type] = true;\r\n}\r\n\r\nexport function skipped(e) {\r\n\tvar events = skipEvents[e.type];\r\n\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\tskipEvents[e.type] = false;\r\n\treturn events;\r\n}\r\n\r\n// check if element really left/entered the event target (for mouseenter/mouseleave)\r\nexport function isExternalTarget(el, e) {\r\n\r\n\tvar related = e.relatedTarget;\r\n\r\n\tif (!related) { return true; }\r\n\r\n\ttry {\r\n\t\twhile (related && (related !== el)) {\r\n\t\t\trelated = related.parentNode;\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn false;\r\n\t}\r\n\treturn (related !== el);\r\n}\r\n\r\nvar lastClick;\r\n\r\n// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\nfunction filterClick(e, handler) {\r\n\tvar timeStamp = (e.timeStamp || (e.originalEvent && e.originalEvent.timeStamp)),\r\n\t    elapsed = lastClick && (timeStamp - lastClick);\r\n\r\n\t// are they closer together than 500ms yet more than 100ms?\r\n\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t// on the same event should be triggered far faster;\r\n\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\tstop(e);\r\n\t\treturn;\r\n\t}\r\n\tlastClick = timeStamp;\r\n\r\n\thandler(e);\r\n}\r\n\r\n// @function addListener(…): this\r\n// Alias to [`L.DomEvent.on`](#domevent-on)\r\nexport {on as addListener};\r\n\r\n// @function removeListener(…): this\r\n// Alias to [`L.DomEvent.off`](#domevent-off)\r\nexport {off as removeListener};\r\n","import * as DomEvent from './DomEvent';\nimport * as Util from '../core/Util';\nimport {Point} from '../geometry/Point';\nimport * as Browser from '../core/Browser';\n\n/*\n * @namespace DomUtil\n *\n * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\n * tree, used by Leaflet internally.\n *\n * Most functions expecting or returning a `HTMLElement` also work for\n * SVG elements. The only difference is that classes refer to CSS classes\n * in HTML and SVG classes in SVG.\n */\n\n\n// @property TRANSFORM: String\n// Vendor-prefixed fransform style name (e.g. `'webkitTransform'` for WebKit).\nexport var TRANSFORM = testProp(\n    ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\n\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\n// the same for the transitionend event, in particular the Android 4.1 stock browser\n\n// @property TRANSITION: String\n// Vendor-prefixed transform style name.\nexport var TRANSITION = testProp(\n    ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\n\nexport var TRANSITION_END =\n    TRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';\n\n\n// @function get(id: String|HTMLElement): HTMLElement\n// Returns an element given its DOM id, or returns the element itself\n// if it was passed directly.\nexport function get(id) {\n    return typeof id === 'string' ? document.getElementById(id) : id;\n}\n\n// @function getStyle(el: HTMLElement, styleAttrib: String): String\n// Returns the value for a certain style attribute on an element,\n// including computed values or values set through CSS.\nexport function getStyle(el, style) {\n    var value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\n\n    if ((!value || value === 'auto') && document.defaultView) {\n        var css = document.defaultView.getComputedStyle(el, null);\n        value = css ? css[style] : null;\n    }\n    return value === 'auto' ? null : value;\n}\n\n// @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\n// Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\nexport function create(tagName, className, container) {\n    var el = document.createElement(tagName);\n    el.className = className || '';\n\n    if (container) {\n        container.appendChild(el);\n    }\n    return el;\n}\n\n// @function remove(el: HTMLElement)\n// Removes `el` from its parent element\nexport function remove(el) {\n    var parent = el.parentNode;\n    if (parent) {\n        parent.removeChild(el);\n    }\n}\n\n// @function empty(el: HTMLElement)\n// Removes all of `el`'s children elements from `el`\nexport function empty(el) {\n    while (el.firstChild) {\n        el.removeChild(el.firstChild);\n    }\n}\n\n// @function toFront(el: HTMLElement)\n// Makes `el` the last child of its parent, so it renders in front of the other children.\nexport function toFront(el) {\n    el.parentNode.appendChild(el);\n}\n\n// @function toBack(el: HTMLElement)\n// Makes `el` the first child of its parent, so it renders behind the other children.\nexport function toBack(el) {\n    var parent = el.parentNode;\n    parent.insertBefore(el, parent.firstChild);\n}\n\n// @function hasClass(el: HTMLElement, name: String): Boolean\n// Returns `true` if the element's class attribute contains `name`.\nexport function hasClass(el, name) {\n    if (el.classList !== undefined) {\n        return el.classList.contains(name);\n    }\n    var className = getClass(el);\n    return className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\n}\n\n// @function addClass(el: HTMLElement, name: String)\n// Adds `name` to the element's class attribute.\nexport function addClass(el, name) {\n    if (el.classList !== undefined) {\n        var classes = Util.splitWords(name);\n        for (var i = 0, len = classes.length; i < len; i++) {\n            el.classList.add(classes[i]);\n        }\n    } else if (!hasClass(el, name)) {\n        var className = getClass(el);\n        setClass(el, (className ? className + ' ' : '') + name);\n    }\n}\n\n// @function removeClass(el: HTMLElement, name: String)\n// Removes `name` from the element's class attribute.\nexport function removeClass(el, name) {\n    if (el.classList !== undefined) {\n        el.classList.remove(name);\n    } else {\n        setClass(el, Util.trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\n    }\n}\n\n// @function setClass(el: HTMLElement, name: String)\n// Sets the element's class.\nexport function setClass(el, name) {\n    if (el.className.baseVal === undefined) {\n        el.className = name;\n    } else {\n        // in case of SVG element\n        el.className.baseVal = name;\n    }\n}\n\n// @function getClass(el: HTMLElement): String\n// Returns the element's class.\nexport function getClass(el) {\n    return el.className.baseVal === undefined ? el.className : el.className.baseVal;\n}\n\n// @function setOpacity(el: HTMLElement, opacity: Number)\n// Set the opacity of an element (including old IE support).\n// `opacity` must be a number from `0` to `1`.\nexport function setOpacity(el, value) {\n    if ('opacity' in el.style) {\n        el.style.opacity = value;\n    } else if ('filter' in el.style) {\n        _setOpacityIE(el, value);\n    }\n}\n\nfunction _setOpacityIE(el, value) {\n    var filter = false,\n        filterName = 'DXImageTransform.Microsoft.Alpha';\n\n    // filters collection throws an error if we try to retrieve a filter that doesn't exist\n    try {\n        filter = el.filters.item(filterName);\n    } catch (e) {\n        // don't set opacity to 1 if we haven't already set an opacity,\n        // it isn't needed and breaks transparent pngs.\n        if (value === 1) { return; }\n    }\n\n    value = Math.round(value * 100);\n\n    if (filter) {\n        filter.Enabled = (value !== 100);\n        filter.Opacity = value;\n    } else {\n        el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\n    }\n}\n\n// @function testProp(props: String[]): String|false\n// Goes through the array of style names and returns the first name\n// that is a valid style name for an element. If no such name is found,\n// it returns false. Useful for vendor-prefixed styles like `transform`.\nexport function testProp(props) {\n    var style = document.documentElement.style;\n\n    for (var i = 0; i < props.length; i++) {\n        if (props[i] in style) {\n            return props[i];\n        }\n    }\n    return false;\n}\n\nexport function isPropertySupported(prop) {\n    var style = document.documentElement.style;\n    return prop in style;\n}\n\n// @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\n// Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\n// and optionally scaled by `scale`. Does not have an effect if the\n// browser doesn't support 3D CSS transforms.\nexport function setTransform(el, offset, scale) {\n    var pos = offset || new Point(0, 0);\n\n    el.style[TRANSFORM] =\n        (Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n}\n\n// @function setPosition(el: HTMLElement, position: Point)\n// Sets the position of `el` to coordinates specified by `position`,\n// using CSS translate or top/left positioning depending on the browser\n// (used by Leaflet internally to position its layers).\nexport function setPosition(el, point) {\n\n    /*eslint-disable */\n    el._leaflet_pos = point;\n    /*eslint-enable */\n\n    if (Browser.any3d) {\n        setTransform(el, point);\n    } else {\n        el.style.left = point.x + 'px';\n        el.style.top = point.y + 'px';\n    }\n}\n\n// @function getPosition(el: HTMLElement): Point\n// Returns the coordinates of an element previously positioned with setPosition.\nexport function getPosition(el) {\n    // this method is only used for elements previously positioned using setPosition,\n    // so it's safe to cache the position for performance\n\n    return el._leaflet_pos || new Point(0, 0);\n}\n\n// @function disableTextSelection()\n// Prevents the user from generating `selectstart` DOM events, usually generated\n// when the user drags the mouse through a page with text. Used internally\n// by Leaflet to override the behaviour of any click-and-drag interaction on\n// the map. Affects drag interactions on the whole document.\n\n// @function enableTextSelection()\n// Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).\nexport var disableTextSelection;\nexport var enableTextSelection;\nvar _userSelect;\nif ('onselectstart' in document) {\n    disableTextSelection = function () {\n        DomEvent.on(window, 'selectstart', DomEvent.preventDefault);\n    };\n    enableTextSelection = function () {\n        DomEvent.off(window, 'selectstart', DomEvent.preventDefault);\n    };\n} else {\n    var userSelectProperty = testProp(\n        ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\n\n    disableTextSelection = function () {\n        if (userSelectProperty) {\n            var style = document.documentElement.style;\n            _userSelect = style[userSelectProperty];\n            style[userSelectProperty] = 'none';\n        }\n    };\n    enableTextSelection = function () {\n        if (userSelectProperty) {\n            document.documentElement.style[userSelectProperty] = _userSelect;\n            _userSelect = undefined;\n        }\n    };\n}\n\n// @function disableImageDrag()\n// As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\n// for `dragstart` DOM events, usually generated when the user drags an image.\nexport function disableImageDrag() {\n    DomEvent.on(window, 'dragstart', DomEvent.preventDefault);\n}\n\n// @function enableImageDrag()\n// Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).\nexport function enableImageDrag() {\n    DomEvent.off(window, 'dragstart', DomEvent.preventDefault);\n}\n\nvar _outlineElement, _outlineStyle;\n// @function preventOutline(el: HTMLElement)\n// Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\n// of the element `el` invisible. Used internally by Leaflet to prevent\n// focusable elements from displaying an outline when the user performs a\n// drag interaction on them.\nexport function preventOutline(element) {\n    while (element.tabIndex === -1) {\n        element = element.parentNode;\n    }\n    if (!element || !element.style) { return; }\n    restoreOutline();\n    _outlineElement = element;\n    _outlineStyle = element.style.outline;\n    element.style.outline = 'none';\n    DomEvent.on(window, 'keydown', restoreOutline);\n}\n\n// @function restoreOutline()\n// Cancels the effects of a previous [`L.DomUtil.preventOutline`]().\nexport function restoreOutline() {\n    if (!_outlineElement) { return; }\n    _outlineElement.style.outline = _outlineStyle;\n    _outlineElement = undefined;\n    _outlineStyle = undefined;\n    DomEvent.off(window, 'keydown', restoreOutline);\n}\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","var document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\nvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\nvar fn = (function () {\n  var val;\n\n  var fnMap = [\n    [\n      'requestFullscreen',\n      'exitFullscreen',\n      'fullscreenElement',\n      'fullscreenEnabled',\n      'fullscreenchange',\n      'fullscreenerror'\n    ],\n    // New WebKit\n    [\n      'webkitRequestFullscreen',\n      'webkitExitFullscreen',\n      'webkitFullscreenElement',\n      'webkitFullscreenEnabled',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    // Old WebKit (Safari 5.1)\n    [\n      'webkitRequestFullScreen',\n      'webkitCancelFullScreen',\n      'webkitCurrentFullScreenElement',\n      'webkitCancelFullScreen',\n      'webkitfullscreenchange',\n      'webkitfullscreenerror'\n\n    ],\n    [\n      'mozRequestFullScreen',\n      'mozCancelFullScreen',\n      'mozFullScreenElement',\n      'mozFullScreenEnabled',\n      'mozfullscreenchange',\n      'mozfullscreenerror'\n    ],\n    [\n      'msRequestFullscreen',\n      'msExitFullscreen',\n      'msFullscreenElement',\n      'msFullscreenEnabled',\n      'MSFullscreenChange',\n      'MSFullscreenError'\n    ]\n  ];\n\n  var i = 0;\n  var l = fnMap.length;\n  var ret = {};\n\n  for (; i < l; i++) {\n    val = fnMap[i];\n    if (val && val[1] in document) {\n      for (i = 0; i < val.length; i++) {\n        ret[fnMap[0][i]] = val[i];\n      }\n      return ret;\n    }\n  }\n\n  return false;\n})();\n\nvar eventNameMap = {\n  change: fn.fullscreenchange,\n  error: fn.fullscreenerror\n};\n\nvar screenfull = {\n  request: function (elem) {\n    var request = fn.requestFullscreen;\n\n    elem = elem || document.documentElement;\n\n    // Work around Safari 5.1 bug: reports support for\n    // keyboard in fullscreen even though it doesn't.\n    // Browser sniffing, since the alternative with\n    // setTimeout is even worse.\n    if (/5\\.1[.\\d]* Safari/.test(navigator.userAgent)) {\n      elem[request]();\n    } else {\n      elem[request](keyboardAllowed && Element.ALLOW_KEYBOARD_INPUT);\n    }\n  },\n  exit: function () {\n    document[fn.exitFullscreen]();\n  },\n  toggle: function (elem) {\n    if (this.isFullscreen) {\n      this.exit();\n    } else {\n      this.request(elem);\n    }\n  },\n  onchange: function (callback) {\n    this.on('change', callback);\n  },\n  onerror: function (callback) {\n    this.on('error', callback);\n  },\n  on: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.addEventListener(eventName, callback, false);\n    }\n  },\n  off: function (event, callback) {\n    var eventName = eventNameMap[event];\n    if (eventName) {\n      document.removeEventListener(eventName, callback, false);\n    }\n  },\n  raw: fn\n};\n\nObject.defineProperties(screenfull, {\n  isFullscreen: {\n    get: function () {\n      return Boolean(document[fn.fullscreenElement]);\n    }\n  },\n  element: {\n    enumerable: true,\n    get: function () {\n      return document[fn.fullscreenElement];\n    }\n  },\n  enabled: {\n    enumerable: true,\n    get: function () {\n      // Coerce to boolean in case of old WebKit\n      return Boolean(document[fn.fullscreenEnabled]);\n    }\n  }\n});\n\nexport {screenfull};","import * as Util from '../core/Util';\nimport {Evented} from '../core/Events';\n// import {Class} from '../core/Class';\nimport * as Browser from '../core/Browser';\nimport * as DomEvent from '../dom/DomEvent';\nimport * as DomUtil from '../dom/DomUtil';\n\nimport debounce from 'lodash/debounce';\n\nimport {screenfull} from '../screenfull';\n\n/*\n * @class Reader\n * @aka cozy.Map\n * @inherits Evented\n *\n * The central class of the API — it is used to create a book on a page and manipulate it.\n *\n * @example\n *\n * ```js\n * // initialize the map on the \"map\" div with a given center and zoom\n * var map = L.map('map', {\n *  center: [51.505, -0.09],\n *  zoom: 13\n * });\n * ```\n *\n */\n\nvar _padding = 1.0;\nexport var Reader = Evented.extend({\n  options: {\n    regions: [\n      'header',\n      'toolbar.top',\n      'toolbar.left',\n      'main',\n      'toolbar.right',\n      'toolbar.bottom',\n      'footer'\n    ],\n    metadata: {},\n    flow: 'auto',\n    engine: 'epubjs',\n    fontSizeLarge: '140%',\n    fontSizeSmall: '90%',\n    fontSizeDefault: '100%',\n    trackResize: true,\n    mobileMediaQuery: '(min-device-width : 300px) and (max-device-width : 600px)',\n    theme: 'default',\n    themes: []\n  },\n\n  initialize: function(id, options) {\n    var self = this\n\n    options = Util.setOptions(this, options);\n    this._checkFeatureCompatibility();\n\n    this.metadata = this.options.metadata; // initial seed\n\n    this._initContainer(id);\n    this._initLayout();\n\n    if ( this.options.themes && this.options.themes.length > 0 ) {\n        this.options.themes.forEach(function(theme) {\n            if ( theme.href ) { return; }\n            var klass = theme.klass;\n            var rules = {};\n            for(var rule in theme.rules) {\n                var new_rule = '.' + klass;\n                if ( rule == 'body' ) { new_rule = 'body' + new_rule; }\n                else { new_rule += ' ' + rule ; }\n                rules[new_rule] = theme.rules[rule];\n            }\n            theme.rules = rules;\n        });\n    }\n\n    this._updateTheme();\n\n    // hack for https://github.com/Leaflet/Leaflet/issues/1980\n    this._onResize = Util.bind(this._onResize, this);\n\n    this._initEvents();\n\n    this.callInitHooks();\n\n    this._mode = this.options.mode;\n  },\n\n  start: function(target, cb) {\n    var self = this;\n\n    if ( typeof(target) == 'function' && cb === undefined ) {\n      cb = target;\n      target = undefined;\n    }\n\n    self._start(target, cb);\n\n    this._loaded = true;\n  },\n\n  _start: function(target, cb) {\n    var self = this;\n    target = target || 0;\n\n    self.open(function() {\n      self.setBookPanelSize();\n      self.draw(target, function() {\n        self._panes['loader'].style.display = 'none';\n        if ( cb ) {\n          cb();\n        }\n      });\n    });\n\n  },\n\n  switch: function(flow, target) {\n    var target = target || this.currentLocation();\n    if ( flow === undefined ) {\n      flow = ( this.options.flow == 'auto' ) ? 'scrolled-doc' : 'auto';\n    }\n    this.options.flow = flow;\n    this.destroy();\n    this.draw(target);\n  },\n\n  reopen: function(options, target) {\n    var target = target || this.currentLocation();\n    Util.extend(this.options, options);\n    this.destroy();\n    console.log(\"AHOY REOPENED?\");\n    return;\n    this.draw(target);\n    this.fire('reopen');\n  },\n\n  _updateTheme: function() {\n    DomUtil.removeClass(this._container, 'cozy-theme-' + ( this._container.dataset.theme || 'default' ));\n    DomUtil.addClass(this._container, 'cozy-theme-' + this.options.theme);\n    this._container.dataset.theme = this.options.theme;\n  },\n\n  draw: function(target) {\n    // NOOP\n  },\n\n  next: function() {\n    // NOOP\n  },\n\n  prev: function() {\n    // NOOP\n  },\n\n  display: function(index) {\n    // NOOP\n  },\n\n  gotoPage: function(target) {\n    // NOOP\n  },\n\n  requestFullscreen: function() {\n    if ( screenfull.enabled ) {\n      // this._preResize();\n      screenfull.toggle(this._container);\n    }\n  },\n\n  _preResize: function() {\n\n  },\n\n  _initContainer: function (id) {\n    var container = this._container = DomUtil.get(id);\n\n    if (!container) {\n      throw new Error('Reader container not found.');\n    } else if (container._cozy_id) {\n      throw new Error('Reader container is already initialized.');\n    }\n\n    DomEvent.on(container, 'scroll', this._onScroll, this);\n    this._containerId = Util.stamp(container);\n  },\n\n  _initLayout: function () {\n    var container = this._container;\n\n    this._fadeAnimated = this.options.fadeAnimation && Browser.any3d;\n\n    DomUtil.addClass(container, 'cozy-container' +\n      (Browser.touch ? ' cozy-touch' : '') +\n      (Browser.retina ? ' cozy-retina' : '') +\n      (Browser.ielt9 ? ' cozy-oldie' : '') +\n      (Browser.safari ? ' cozy-safari' : '') +\n      (this._fadeAnimated ? ' cozy-fade-anim' : '') +\n      ' cozy-engine-' + this.options.engine + \n      ' cozy-theme-' + this.options.theme);\n\n    var position = DomUtil.getStyle(container, 'position');\n\n    this._initPanes();\n\n    if ( ! ( 'columnCount' in container.style ) ) {\n      this.options.flow = 'scrolled-doc';\n    }\n  },\n\n  _initPanes: function () {\n    var self = this;\n\n    var panes = this._panes = {};\n\n    var l = 'cozy-';\n    var container = this._container;\n\n    var prefix = 'cozy-module-';\n\n    DomUtil.addClass(container, 'cozy-container');\n    panes['top'] = DomUtil.create('div', prefix + 'top', container);\n    panes['main'] = DomUtil.create('div', prefix + 'main', container);\n    panes['bottom'] = DomUtil.create('div', prefix + 'bottom', container);\n\n    panes['left'] = DomUtil.create('div', prefix + 'left', panes['main']);\n    panes['book-cover'] = DomUtil.create('div', prefix + 'book-cover', panes['main']);\n    panes['right'] = DomUtil.create('div', prefix + 'right', panes['main']);\n    panes['book'] = DomUtil.create('div', prefix + 'book', panes['book-cover']);\n    panes['loader'] = DomUtil.create('div', prefix + 'book-loading', panes['book']);\n    this._initLoader();\n  },\n\n  _checkIfLoaded: function () {\n    if (!this._loaded) {\n      throw new Error('Set map center and zoom first.');\n    }\n  },\n\n  // DOM event handling\n\n  // @section Interaction events\n  _initEvents: function (remove) {\n    this._targets = {};\n    this._targets[Util.stamp(this._container)] = this;\n\n    var onOff = remove ? DomEvent.off : DomEvent.on;\n\n    // @event click: MouseEvent\n    // Fired when the user clicks (or taps) the map.\n    // @event dblclick: MouseEvent\n    // Fired when the user double-clicks (or double-taps) the map.\n    // @event mousedown: MouseEvent\n    // Fired when the user pushes the mouse button on the map.\n    // @event mouseup: MouseEvent\n    // Fired when the user releases the mouse button on the map.\n    // @event mouseover: MouseEvent\n    // Fired when the mouse enters the map.\n    // @event mouseout: MouseEvent\n    // Fired when the mouse leaves the map.\n    // @event mousemove: MouseEvent\n    // Fired while the mouse moves over the map.\n    // @event contextmenu: MouseEvent\n    // Fired when the user pushes the right mouse button on the map, prevents\n    // default browser context menu from showing if there are listeners on\n    // this event. Also fired on mobile when the user holds a single touch\n    // for a second (also called long press).\n    // @event keypress: KeyboardEvent\n    // Fired when the user presses a key from the keyboard while the map is focused.\n    // onOff(this._container, 'click dblclick mousedown mouseup ' +\n    //   'mouseover mouseout mousemove contextmenu keypress', this._handleDOMEvent, this);\n\n    if (this.options.trackResize) {\n      var self = this;\n      var fn = debounce(function(){ self.invalidateSize({}); }, 150);\n      onOff(window, 'resize', fn, this);\n    }\n\n    if (Browser.any3d && this.options.transform3DLimit) {\n      (remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);\n    }\n\n    var self = this;\n    if (screenfull.enabled) {\n      screenfull.on('change', function() {\n        setTimeout(function() {\n          self.invalidateSize({});\n        }, 100);\n        console.log('AHOY: Am I fullscreen?', screenfull.isFullscreen ? 'YES' : 'NO');\n      });\n    }\n  },\n\n  _onResize: function() {\n    if ( ! this._resizeRequest ) {\n      this._resizeRequest = Util.requestAnimFrame(function() {\n        this.invalidateSize({})\n      }, this);\n    }\n  },\n\n  _onScroll: function () {\n    this._container.scrollTop  = 0;\n    this._container.scrollLeft = 0;\n  },\n\n  _handleDOMEvent: function (e) {\n    if (!this._loaded || DomEvent.skipped(e)) { return; }\n\n    var type = e.type === 'keypress' && e.keyCode === 13 ? 'click' : e.type;\n\n    if (type === 'mousedown') {\n      // prevents outline when clicking on keyboard-focusable element\n      DomUtil.preventOutline(e.target || e.srcElement);\n    }\n\n    this._fireDOMEvent(e, type);\n  },\n\n  _fireDOMEvent: function (e, type, targets) {\n\n    if (e.type === 'click') {\n      // Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).\n      // @event preclick: MouseEvent\n      // Fired before mouse click on the map (sometimes useful when you\n      // want something to happen on click before any existing click\n      // handlers start running).\n      var synth = Util.extend({}, e);\n      synth.type = 'preclick';\n      this._fireDOMEvent(synth, synth.type, targets);\n    }\n\n    if (e._stopped) { return; }\n\n    // Find the layer the event is propagating from and its parents.\n    targets = (targets || []).concat(this._findEventTargets(e, type));\n\n    if (!targets.length) { return; }\n\n    var target = targets[0];\n    if (type === 'contextmenu' && target.listens(type, true)) {\n      DomEvent.preventDefault(e);\n    }\n\n    var data = {\n      originalEvent: e\n    };\n\n    if (e.type !== 'keypress') {\n      var isMarker = (target.options && 'icon' in target.options);\n      data.containerPoint = isMarker ?\n          this.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\n      data.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\n      data.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);\n    }\n\n    for (var i = 0; i < targets.length; i++) {\n      targets[i].fire(type, data, true);\n      if (data.originalEvent._stopped ||\n        (targets[i].options.nonBubblingEvents && Util.indexOf(targets[i].options.nonBubblingEvents, type) !== -1)) { return; }\n    }\n  },\n\n  setBookPanelSize: function() {\n    var panes = this._panes;\n\n    // panes['book'].style.height = (panes['book-cover'].offsetHeight * _padding * 0.99) + 'px';\n    // panes['book'].style.width = (panes['book-cover'].offsetWidth * _padding) + 'px';\n    // panes['book'].style.width = '100%';\n    // panes['book'].style.height = '100%';\n    // panes['book'].style.display = 'block';\n  },\n\n  getFixedBookPanelSize: function() {\n    // have to make the book \n    var style = window.getComputedStyle(this._panes['book']);\n    var h = this._panes['book'].clientHeight - parseFloat(style.paddingTop) - parseFloat(style.paddingBottom);\n    var w = this._panes['book'].clientWidth - parseFloat(style.paddingRight) - parseFloat(style.paddingLeft);\n    return { height: Math.floor(h * 1.00), width: Math.floor(w * 1.00) };\n  },\n\n  invalidateSize: function(options) {\n    var self = this;\n\n    if ( ! self._drawn ) { return; }\n\n    Util.cancelAnimFrame(this._resizeRequest);\n\n    if (! this._loaded) { return this; }\n\n    if ( ! this._resizeTarget ) {\n      this._resizeTarget = this.currentLocation();\n    }\n    // self.destroy();\n\n    var panes = this._panes;\n    // panes['book'].style.display = 'none';\n\n    setTimeout(function() {\n      self.setBookPanelSize();\n\n      if ( self._triggerRedraw ) {\n        clearTimeout(self._triggerRedraw);\n      }\n\n      self._triggerRedraw = setTimeout(function() {\n        // self.destroy();\n        // self.draw(self._resizeTarget);\n        self._resizeBookPane();\n        self._resizeRequest = null;\n        self._resizeTarget = null;\n      }, 150);\n\n\n    }, 0);\n    \n\n\n  },\n\n  _resizeBookPane: function() {\n\n  },\n\n  _setupHooks: function() {\n\n  },\n\n  _checkFeatureCompatibility: function() {\n    if ( ! DomUtil.isPropertySupported('columnCount') || this._checkMobileDevice() ) {\n      // force\n      this.options.flow = 'scrolled-doc';\n    }\n    if ( this._checkMobileDevice() ) {\n      this.options.fontSizeLarge = '160%';\n      this.options.fontSizeSmall ='100%';\n      this.options.fontSizeDefault = '120%';\n    }\n  },\n\n  _checkMobileDevice: function() {\n    if ( this._isMobile === undefined ) {\n      this._isMobile = false;\n      if ( this.options.mobileMediaQuery ) {\n        this._isMobile = window.matchMedia(this.options.mobileMediaQuery).matches;\n      }\n    }\n    return this._isMobile;\n  },\n\n  _initLoader: function() {\n    // is this not awesome?\n    var template = `<div class=\"socket\">\n      <div class=\"gel center-gel\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c1 r1\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c2 r1\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c3 r1\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c4 r1\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c5 r1\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c6 r1\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      \n      <div class=\"gel c7 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      \n      <div class=\"gel c8 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c9 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c10 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c11 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c12 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c13 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c14 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c15 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c16 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c17 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c18 r2\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c19 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c20 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c21 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c22 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c23 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c24 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c25 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c26 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c28 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c29 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c30 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c31 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c32 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c33 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c34 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c35 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c36 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n      <div class=\"gel c37 r3\">\n        <div class=\"hex-brick h1\"></div>\n        <div class=\"hex-brick h2\"></div>\n        <div class=\"hex-brick h3\"></div>\n      </div>\n    </div>`;\n\n    var body = new DOMParser().parseFromString(template, \"text/html\").body;\n    while ( body.children.length ) {\n      this._panes['loader'].appendChild(body.children[0]);\n    }\n  },\n\n  EOT: true\n});\n\nexport function createReader(id, options) {\n  return new Reader(id, options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\n\n/*\n * @class Control\n * @aka L.Control\n * @inherits Class\n *\n * L.Control is a base class for implementing reader controls. Handles regioning.\n * All other controls extend from this class.\n */\n\nexport var Control = Class.extend({\n    // @section\n    // @aka Control options\n    options: {\n        // @option region: String = 'topright'\n        // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n        // `'topright'`, `'bottomleft'` or `'bottomright'`\n    },\n\n    initialize: function (options) {\n        Util.setOptions(this, options);\n        if ( options.container ) {\n            this._container = options.container;\n            this._locked = true;\n        }\n    },\n\n    /* @section\n     * Classes extending L.Control will inherit the following methods:\n     *\n     * @method getRegion: string\n     * Returns the region of the control.\n     */\n    getRegion: function () {\n        return this.options.region;\n    },\n\n    // @method setRegion(region: string): this\n    // Sets the region of the control.\n    setRegion: function (region) {\n        var reader = this._reader;\n\n        if (reader) {\n            reader.removeControl(this);\n        }\n\n        this.options.region = region;\n\n        if (reader) {\n            reader.addControl(this);\n        }\n\n        return this;\n    },\n\n    // @method getContainer: HTMLElement\n    // Returns the HTMLElement that contains the control.\n    getContainer: function () {\n        return this._container;\n    },\n\n    // @method addTo(reader: Map): this\n    // Adds the control to the given reader.\n    addTo: function (reader) {\n        this.remove();\n        this._reader = reader;\n\n        var container = this._container = this.onAdd(reader);\n\n        DomUtil.addClass(container, 'cozy-control');\n\n        if ( ! this._locked ) {\n            var region = this.getRegion();\n            var area = reader.getControlRegion(region);\n            area.appendChild(container);\n        }\n\n        return this;\n    },\n\n    // @method remove: this\n    // Removes the control from the reader it is currently active on.\n    remove: function () {\n        if (!this._reader) {\n            return this;\n        }\n\n        if (! this._container) {\n            return this;\n        }\n\nconsole.log(\"AHOY REMOVE\", this._locked);\n        if ( ! this._locked ) {\n            DomUtil.remove(this._container);\n        }\n\n        if (this.onRemove) {\n            this.onRemove(this._reader);\n        }\n\n        this._reader = null;\n\n        return this;\n    },\n\n    _refocusOnMap: function (e) {\n        // if reader exists and event is not a keyboard event\n        if (this._reader && e && e.screenX > 0 && e.screenY > 0) {\n            this._reader.getContainer().focus();\n        }\n    },\n\n    _className: function(widget) {\n        var className = [ 'cozy-control' ];\n        if ( this.options.direction ) {\n            className.push('cozy-control-' + this.options.direction);\n        }\n        if ( widget ) {\n            className.push('cozy-control-' + widget);\n        }\n        return className.join(' ');\n    }\n});\n\nexport var control = function (options) {\n    return new Control(options);\n};\n\n/* @section Extension methods\n * @uninheritable\n *\n * Every control should extend from `L.Control` and (re-)implement the following methods.\n *\n * @method onAdd(reader: Map): HTMLElement\n * Should return the container DOM element for the control and add listeners on relevant reader events. Called on [`control.addTo(reader)`](#control-addTo).\n *\n * @method onRemove(reader: Map)\n * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).\n */\n\n/* @namespace Map\n * @section Methods for Layers and Controls\n */\nReader.include({\n    // @method addControl(control: Control): this\n    // Adds the given control to the reader\n    addControl: function (control) {\n        control.addTo(this);\n        return this;\n    },\n\n    // @method removeControl(control: Control): this\n    // Removes the given control from the reader\n    removeControl: function (control) {\n        control.remove();\n        return this;\n    },\n\n    getControlContainer: function() {\n        var l = 'cozy-';\n        if ( ! this._controlContainer ) {\n            this._controlContainer =\n                DomUtil.create('div', l + 'control-container', this._container);\n        }\n        return this._controlContainer;\n    },\n\n    getControlRegion: function (target) {\n\n        if ( ! this._panes[target] ) {\n            // target is dot-delimited string\n            // first dot is the panel\n            var parts = target.split('.');\n            var tmp = [];\n            var parent = this._container;\n            var x = 0;\n            while ( parts.length ) {\n                var slug = parts.shift();\n                tmp.push(slug);\n                var panel = tmp.join(\".\");\n                var className = 'cozy-panel-' + slug;\n                if ( ! this._panes[panel] ) {\n                    this._panes[panel] = DomUtil.create('div', className, parent);\n                }\n                parent = this._panes[panel];\n                x += 1;\n                if ( x > 100 ) { break; }\n            }\n        }\n        return this._panes[target];\n    },\n\n    getControlRegion_1: function (target) {\n\n        var tmp = target.split('.');\n        var region = tmp.shift();\n        var slot = tmp.pop() || '-slot';\n\n        var container = this._panes[region];\n        if ( ! this._panes[target] ) {\n            var className = 'cozy-' + region + '--item cozy-slot-' + slot\n            if ( ! this._panes[region + '.' + slot] ) {\n                var div = DomUtil.create('div', className);\n                if ( slot == 'left' || slot == 'bottom' ) {\n                    var childElement = this._panes[region].firstChild;\n                    this._panes[region].insertBefore(div, childElement);\n                } else {\n                    this._panes[region].appendChild(div);\n                }\n                this._panes[region + '.' + slot] = div;\n            }\n            className = this._classify(tmp);\n            this._panes[target] = DomUtil.create('div', className, this._panes[region + '.' + slot]);\n        }\n\n        return this._panes[target];\n    },\n\n    _classify: function(tmp) {\n        var l = 'cozy-';\n        var className = [];\n        for(var i in tmp) {\n            className.push(l + tmp[i]);\n        }\n        className = className.join(' ');\n        return className;\n    },\n\n    _clearControlRegion: function () {\n        for (var i in this._controlRegions) {\n            DomUtil.remove(this._controlRegions[i]);\n        }\n        DomUtil.remove(this._controlContainer);\n        delete this._controlRegions;\n        delete this._controlContainer;\n    }\n});\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nvar PageControl = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n      container = DomUtil.create('div', className),\n\n      this._control  = this._createButton(this._fill(options.html || options.label), this._fill(options.label),\n              className, container);\n    }\n    this._bindEvents();\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    return link;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    DomEvent.disableClickPropagation(this._control);\n    DomEvent.on(this._control, 'click', DomEvent.stop);\n    DomEvent.on(this._control, 'click', this._action, this);\n\n    this._reader.on('reopen', function(data) {\n      // update the button text / titles\n      var html = self.options.html || self.options.label;\n      self._control.innerHTML = self._fill(html);\n      self._control.setAttribute('title', self._fill(self.options.label));\n      self._control.setAttribute('aria-label', self._fill(self.options.label));\n    });\n\n  },\n\n  _unit: function() {\n    return ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  _fill: function(s) {\n    var unit = this._unit();\n    return s.replace(/\\$\\{unit\\}/g, unit);\n  },\n\n  _label: function() {\n    return this.options.label + \" \" + ( this._reader.options.flow == 'scrolled-doc' ) ? 'Section' : 'Page';\n  },\n\n  EOT: true\n});\n\nexport var PagePrevious = PageControl.extend({\n  options: {\n    region: 'edge.left',\n    direction: 'previous',\n    label: 'Previous ${unit}',\n    html: '<i class=\"icon-chevron-left oi\" data-glyph=\"chevron-left\" title=\"Previous ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.prev();\n  }\n});\n\nexport var PageNext = PageControl.extend({\n  options: {\n    region: 'edge.right',\n    direction: 'next',\n    label: 'Next ${unit}',\n    html: '<i class=\"icon-chevron-right oi\" data-glyph=\"chevron-right\" title=\"Next ${unit}\" aria-hidden=\"true\"></i>'\n  },\n\n  _action: function(e) {\n    this._reader.next();\n  }\n});\n\nexport var PageFirst = PageControl.extend({\n  options: {\n    direction: 'first',\n    label: 'First ${unit}'\n  },\n  _action: function(e) {\n      this._reader.first();\n  }\n});\n\nexport var PageLast = PageControl.extend({\n  options: {\n    direction: 'last',\n    label: 'Last ${unit}'\n  },\n  _action: function(e) {\n      this._reader.last();\n  }\n});\n\nexport var pageNext = function(options) {\n  return new PageNext(options);\n}\n\nexport var pagePrevious = function(options) {\n  return new PagePrevious(options);\n}\n\nexport var pageFirst = function(options) {\n  return new PageFirst(options);\n}\n\nexport var pageLast = function(options) {\n  return new PageLast(options);\n}\n","import {Class} from '../core/Class';\nimport {Reader} from '../reader/Reader';\nimport * as Util from '../core/Util';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n\nvar activeModal;\nvar dismissModalListener = false;\n\n// from https://github.com/ghosh/micromodal/blob/master/src/index.js\nconst FOCUSABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'iframe',\n    'object',\n    'embed',\n    '[contenteditable]',\n    '[tabindex]:not([tabindex^=\"-\"])'\n  ];\n\nconst ACTIONABLE_ELEMENTS = [\n    'a[href]',\n    'area[href]',\n    'input[type=\"submit\"]:not([disabled])',\n    'button:not([disabled])'\n  ];\n\nexport var Modal = Class.extend({\n  options: {\n    // @option region: String = 'topright'\n    // The region of the control (one of the reader edges). Possible values are `'left' ad 'right'`\n    region: 'left',\n    fraction: 0,\n    width: null,\n    className: {},\n    actions: null,\n    callbacks: { onShow: function() {}, onClose: function() {} },\n    handlers: {}\n  },\n\n  initialize: function (options) {\n    options = Util.setOptions(this, options);\n    this._id = (new Date()).getTime() + '-' + parseInt(Math.random((new Date()).getTime()) * 1000, 10);\n    this._initializedEvents = false;\n    this.callbacks = this.options.callbacks;\n    this.actions = this.options.actions;\n    this.handlers = this.options.handlers;\n    if ( typeof(this.options.className) == 'string' ) {\n      this.options.className = { container: this.options.className };\n    }\n  },\n\n  addTo: function(reader) {\n    var self = this;\n    this._reader = reader;\n    var template = this.options.template;\n\n    var panelHTML = `<div class=\"cozy-modal modal-slide ${this.options.region || 'left'}\" id=\"modal-${this._id} aria-labelledby=\"modal-${this._id}-title\" role=\"dialog\" aria-describedby=\"modal-${this._id}-content\" aria-hidden=\"true\">\n      <div class=\"modal__overlay\" tabindex=\"-1\" data-modal-close>\n        <div class=\"modal__container ${this.options.className.container ? this.options.className.container : ''}\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-${this._id}-title\" aria-describedby=\"modal-${this._id}-content\" id=\"modal-${this._id}-container\">\n          <div role=\"document\">\n            <header class=\"modal__header\">\n              <h3 class=\"modal__title\" id=\"modal-${this._id}-title\">${this.options.title}</h3>\n              <button class=\"modal__close\" aria-label=\"Close modal\" aria-controls=\"modal-${this._id}-container\" data-modal-close></button>\n            </header>\n            <main class=\"modal__content ${this.options.className.main ? this.options.className.main : ''}\" id=\"modal-${this._id}-content\">\n              ${template}\n            </main>`;\n\n    if ( this.options.actions ) {\n      panelHTML += '<footer class=\"modal__footer\">'\n      for(var i in this.options.actions) {\n        var action = this.options.actions[i];\n        var button_cls = action.className || 'button--default';\n        panelHTML += `<button id=\"action-${this._id}-${i}\" class=\"button button--lg ${button_cls}\">${action.label}</button>`;\n      }\n      panelHTML += '</footer>';\n    }\n\n    panelHTML += '</div></div></div></div>';\n\n    var body = new DOMParser().parseFromString(panelHTML, \"text/html\").body;\n\n    this.modal = reader._container.appendChild(body.children[0]);\n    this._container = this.modal; // compatibility\n\n    this.container = this.modal.querySelector('.modal__container');\n    this._bindEvents();\n    return this;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    this.onClick = this.onClick.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n    this.onModalTransition = this.onModalTransition.bind(this);\n\n    this.modal.addEventListener('transitionend', function() {\n    }.bind(this));\n\n    // bind any actions\n    if ( this.actions ) {\n      for(var i in this.actions) {\n        let action = this.actions[i];\n        let button_id = '#action-' + this._id + '-' + i;\n        let button = this.modal.querySelector(button_id);\n        if ( button ) {\n          DomEvent.on(button, 'click', function(event) {\n            event.preventDefault();\n            action.callback(event);\n            if ( action.close ) {\n              self.closeModal();\n            }\n          })\n        }\n      }\n    }\n  },\n\n  deactivate: function() {\n    this.closeModal();\n  },\n\n  closeModal: function() {\n    var self = this;\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.removeEventListeners();\n    this.activeElement.focus();\n    this.callbacks.onClose(this.modal);\n  },\n\n  showModal: function() {\n    this.activeElement = document.activeElement\n    this._resize();\n    this.modal.setAttribute('aria-hidden', 'false')\n    this.setFocusToFirstNode()\n    this.addEventListeners()\n    this.callbacks.onShow(this.modal)\n  },\n\n  activate: function() {\n    return this.showModal();\n    var self = this;\n    activeModal = this;\n    DomUtil.addClass(self._reader._container, 'st-modal-activating');\n    this._resize();\n    DomUtil.addClass(this._reader._container, 'st-modal-open');\n    setTimeout(function() {\n      DomUtil.addClass(self._container, 'active');\n      DomUtil.removeClass(self._reader._container, 'st-modal-activating');\n      self._container.setAttribute('aria-hidden', 'false');\n      self.setFocusToFirstNode();\n    }, 25);\n  },\n\n  addEventListeners: function () {\n    // --- do we need touch listeners?\n    // this.modal.addEventListener('touchstart', this.onClick)\n    // this.modal.addEventListener('touchend', this.onClick)\n    this.modal.addEventListener('click', this.onClick)\n    document.addEventListener('keydown', this.onKeydown)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.addEventListener(event, this.onModalTransition);\n    }.bind(this))\n  },\n\n  removeEventListeners: function () {\n    this.modal.removeEventListener('touchstart', this.onClick)\n    this.modal.removeEventListener('click', this.onClick)\n    'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend'.split(' ').forEach(function(event) {\n      this.modal.removeEventListener(event, this.onModalTransition);\n    }.bind(this))\n    document.removeEventListener('keydown', this.onKeydown)\n  },\n\n  _resize: function() {\n    var container = this._reader._container;\n    this.container.style.height = container.offsetHeight + 'px';\n    if ( ! this.options.className.container  ) {\n      this.container.style.width = this.options.width || parseInt(container.offsetWidth * this.options.fraction) + 'px';\n    }\n\n    var header = this.container.querySelector('header');\n    var footer = this.container.querySelector('footer');\n    var main = this.container.querySelector('main');\n    var height = this.container.clientHeight - header.clientHeight;\n    if ( footer ) {\n      height -= footer.clientHeight;\n    }\n    main.style.height = height + 'px';\n  },\n\n  getFocusableNodes: function() {\n    const nodes = this.modal.querySelectorAll(FOCUSABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  setFocusToFirstNode: function() {\n    var focusableNodes = this.getFocusableNodes();\n    if ( focusableNodes.length ) {\n      focusableNodes[0].focus();\n    } else {\n      activeModal._container.focus();\n    }\n  },\n\n  getActionableNodes: function() {\n    const nodes = this.modal.querySelectorAll(ACTIONABLE_ELEMENTS);\n    return Object.keys(nodes).map((key) => nodes[key]);\n  },\n\n  onKeydown: function(event) {\n    if ( event.keyCode == 27 ) { this.closeModal(); }\n    if ( event.keyCode == 9 ) { \n      this.maintainFocus(event); \n    }\n  },\n\n  onClick: function(event) {\n\n    var closeAfterAction = false;\n    if (this.handlers.click) {\n      var target = event.target;\n      for(var selector in this.handlers.click) {\n        if ( target.matches(selector) ) {\n          closeAfterAction = this.handlers.click[selector](this, target);\n        }\n      }\n    }\n\n    if (closeAfterAction || event.target.hasAttribute('data-modal-close')) this.closeModal();\n\n    const actionableNodes = this.getActionableNodes();\n    if ( actionableNodes.indexOf(event.target) < 0 ) {\n      return;\n    }\n\n    event.preventDefault();\n  },\n\n  onModalTransition: function(event) {\n    if ( this.modal.getAttribute('aria-hidden') == 'true' ) {\n      this._reader.fire('modal-closed');\n    } else {\n      this._reader.fire('modal-opened');\n    }\n  },\n\n  on: function(event, selector, handler) {\n    if (! this.handlers[event] ) {\n      this.handlers[event] = {};\n    }\n    this.handlers[event][selector] = handler;\n  },\n\n  maintainFocus: function(event) {\n    var focusableNodes = this.getFocusableNodes();\n    var focusedItemIndex = focusableNodes.indexOf(document.activeElement);\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableNodes[focusableNodes.length - 1].focus()\n      event.preventDefault()\n    }\n\n    if (!event.shiftKey && focusedItemIndex === focusableNodes.length - 1) {\n      focusableNodes[0].focus()\n      event.preventDefault()\n    }\n  },\n\n  EOT: true\n});\n\nReader.include({\n  modal: function (options) {\n    var modal = new Modal(options);\n    return modal.addTo(this);\n    // return this;\n  },\n\n  EOT: true\n});","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport {Modal} from './Modal';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Contents = Control.extend({\n\n  defaultTemplate: `<button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Table of Contents\"><i class=\"icon-menu oi\" data-glyph=\"menu\" title=\"Table of Contents\" aria-hidden=\"true\"></i></button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._modal = this._reader.modal({\n      template: '<ul></ul>',\n      title: 'Contents',\n      region: 'left',\n      className: 'cozy-modal-contents'\n    });\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    container.style.position = 'relative';\n\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    this._modal.on('click', 'a[href]', function(modal, target) {\n      target = target.getAttribute('href');\n      this._reader.gotoPage(target);\n      return true;\n    }.bind(this))\n\n    this._reader.on('update-contents', function(data) {\n      var parent = self._modal._container.querySelector('ul');\n      var s = data.toc.filter(function(value) { return value.parent == null }).map(function(value) { return [ value, 0, parent ] });\n      while ( s.length ) {\n        var tuple = s.shift();\n        var chapter = tuple[0];\n        var tabindex = tuple[1];\n        var parent = tuple[2];\n\n        var option = self._createOption(chapter, tabindex, parent);\n        data.toc.filter(function(value) { return value.parent == chapter.id }).reverse().forEach(function(chapter_) {\n          s.unshift([chapter_, tabindex + 1, option]);\n        });\n      }\n    })\n\n\n    return container;\n  },\n\n  _createOption(chapter, tabindex, parent) {\n\n    function pad(value, length) {\n        return (value.toString().length < length) ? pad(\"-\"+value, length):value;\n    }\n    var option = DomUtil.create('li');\n    var anchor = DomUtil.create('a', null, option);\n    anchor.textContent = chapter.label;\n    // var tab = pad('', tabindex); tab = tab.length ? tab + ' ' : '';\n    // option.textContent = tab + chapter.label;\n    anchor.setAttribute('href', chapter.href);\n\n    if ( parent.tagName == 'LI' ) {\n      // need to nest\n      var tmp = parent.querySelector('ul');\n      if ( ! tmp ) {\n        tmp = DomUtil.create('ul', null, parent);\n      }\n      parent = tmp;\n    }\n\n    parent.appendChild(option);\n    return option;\n  },\n\n  EOT: true\n});\n\nexport var contents = function(options) {\n  return new Contents(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var Title = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    var h1 = DomUtil.create('h1', 'cozy-h1', container);\n    this._title = DomUtil.create('span', 'cozy-title', h1);\n    this._divider = DomUtil.create('span', 'cozy-divider', h1);\n    this._divider.textContent = \" · \";\n    this._section = DomUtil.create('span', 'cozy-section', h1);\n\n    this._reader.on('update-section', function(data) {\n      if ( data && data.label ) {\n        self._section.textContent = data.label;\n        DomUtil.setOpacity(self._section, 1.0);\n        DomUtil.setOpacity(self._divider, 1.0);\n      } else {\n        DomUtil.setOpacity(self._section, 0);\n        DomUtil.setOpacity(self._divider, 0);\n      }\n    })\n\n    this._reader.on('update-title', function(data) {\n      console.log(\"UPDATE TITLE\", data);\n      if ( data ) {\n        self._title.textContent = data.title || data.bookTitle;\n        DomUtil.setOpacity(self._section, 0);\n        DomUtil.setOpacity(self._divider, 0);\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var title = function(options) {\n  return new Title(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var PublicationMetadata = Control.extend({\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className(),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    // var template = '<h1><span class=\"cozy-title\">Contents: </span><select size=\"1\" name=\"contents\"></select></label>';\n    // var control = new DOMParser().parseFromString(template, \"text/html\").body.firstChild;\n\n    this._publisher = DomUtil.create('div', 'cozy-publisher', container);\n    this._rights = DomUtil.create('div', 'cozy-rights', container);\n\n    this._reader.on('update-title', function(data) {\n      if ( data ) {\n        self._publisher.textContent = data.publisher;\n        self._rights.textContent = data.rights;\n      }\n    })\n\n    return container;\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('a', className, container);\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n    // DomEvent.on(link, 'click', this._refocusOnMap, this);\n\n    return link;\n  },\n\n  EOT: true\n});\n\nexport var publicationMetadata = function(options) {\n  return new PublicationMetadata(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Preferences = Control.extend({\n  options: {\n    label: 'Preferences',\n    hasThemes: false,\n    html: '<i class=\"icon-cog oi\" data-glyph=\"cog\" title=\"Preferences and Settings\" aria-hidden=\"true\"></i>'\n  },\n\n  onAdd: function(reader) {\n    var self = this;\n    var className = this._className('preferences'),\n        container = DomUtil.create('div', className),\n        options = this.options;\n\n    this._activated = false;\n    this._control = this._createButton(options.html || options.label, options.label,\n            className, container, this._action)\n\n    this._createPanel();\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    /*\n     * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\n     */\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n    var template = `<fieldset>\n        <legend>Text Size</legend>\n        <label><input name=\"text_size\" type=\"radio\" id=\"preferences-input-size-small\" value=\"small\" />Small</label>\n        <label><input name=\"text_size\" type=\"radio\" id=\"preferences-input-size-auto\" value=\"auto\" />Default</label>\n        <label><input name=\"text_size\" type=\"radio\" id=\"preferences-input-size-large\" value=\"large\" />Large</label>\n      </fieldset>          \n      <fieldset>\n        <legend>Text Display</legend>\n        <label><input name=\"flow\" type=\"radio\" id=\"preferences-input-paginated\" value=\"paginated\" />Page-by-Page</label>\n        <label><input name=\"flow\" type=\"radio\" id=\"preferences-input-scrolled-doc\" value=\"scrolled-doc\" />Scroll</label>\n      </fieldset>`;\n\n    if ( this._reader.options.themes && this._reader.options.themes.length > 0 ) {\n      self.options.hasThemes = true;\n      template += `<fieldset>\n        <legend>Theme</legend>\n        <label><input name=\"theme\" type=\"radio\" id=\"preferences-input-theme-default\" value=\"default\" />Default</label>`;\n      \n      this._reader.options.themes.forEach(function(theme) {\n        template += `<label><input name=\"theme\" type=\"radio\" id=\"preferences-input-theme-${theme.klass}\" value=\"${theme.klass}\" />${theme.name}</label>`\n      })\n\n      template += '</fieldset>';\n    }\n\n    template = '<form>' + template + '</form>';\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Preferences',\n      className: 'cozy-modal-preferences',\n      actions: [\n        {\n          label: 'Save Changes',\n          callback: function(event) {\n            self._updatePreferences(event);\n          }\n        }\n      ],\n      region: 'right'\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    this._initializeForm();\n\n    window.xmodal = this._modal;\n  },\n\n  _initializeForm: function() {\n    var input, input_id;\n    /// input_id = \"preferences-input-\" + ( this._reader.options.flow == 'scrolled-doc' ? 'scrollable' : 'reflowable' );\n    input_id = \"preferences-input-\" + ( this._reader.options.flow == 'auto' ? 'paginated' : 'scrolled-doc' );\n    input = this._form.querySelector(\"#\" + input_id);\n    input.checked = true;\n\n    input_id = \"preferences-input-size-\" + ( this._reader.options.text_size || 'auto' );\n    input = this._form.querySelector(\"#\" + input_id);\n    input.checked = true;\n\n    if ( this.options.hasThemes ) {\n      input_id = \"preferences-input-theme-\" + ( this._reader.options.theme || 'default' );\n      input = this._form.querySelector(\"#\" + input_id);\n      input.checked = true;\n    }\n  },\n\n  _updatePreferences: function(event) {\n    var self = this;\n    event.preventDefault();\n\n    var options = {};\n    var input = this._form.querySelector(\"input[name='flow']:checked\");\n    options.flow = input.value;\n    input = this._form.querySelector(\"input[name='text_size']:checked\");\n    options.text_size = input.value;\n    if ( this.options.hasThemes ) {\n      input = this._form.querySelector(\"input[name='theme']:checked\");\n      options.theme = input.value;\n    }\n    this._modal.deactivate();\n    setTimeout(function() {\n      self._reader.reopen(options);\n    }, 100);\n  },\n\n  EOT: true\n});\n\nexport var preferences = function(options) {\n  return new Preferences(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Widget = Control.extend({\n\n\n  options: {\n      // @option region: String = 'topright'\n      // The region of the control (one of the reader corners). Possible values are `'topleft'`,\n      // `'topright'`, `'bottomleft'` or `'bottomright'`\n  },\n\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      // NOOP\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n\n    }\n\n    this._onAddExtra(container);\n    this._updateTemplate(container);\n    this._updateClass(container);\n    this._bindEvents(container);\n\n    return container;\n  },\n\n  _updateTemplate: function(container) {\n    var data = this.data();\n    for(var slot in data) {\n      if ( data.hasOwnProperty(slot) ) {\n        var value = data[slot];\n        if ( typeof(value) == \"function\" ) { value = value(); }\n        var node = container.querySelector(`[data-slot=${slot}]`);\n        if ( node ) {\n          if ( node.hasAttribute('value') ) {\n            node.setAttribute('value', value);\n          } else {\n            node.innerHTML = value;\n          }\n        }\n      }\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this.options.className ) {\n      DomUtil.addClass(container, this.options.className);\n    }\n  },\n\n  _onAddExtra: function() { },\n\n  _bindEvents: function(container) {\n    var control = container.querySelector(\"[data-toggle=button]\");\n    if ( ! control ) { return ; }\n    DomEvent.disableClickPropagation(control);\n    DomEvent.on(control, 'click', DomEvent.stop);\n    DomEvent.on(control, 'click', this._action, this);\n  },\n\n  _action: function() {\n  },\n\n  data: function() {\n    return this.options.data || {};\n  },\n\n  EOT: true\n});\n\nWidget.Button = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _action: function() {\n    this.options.onClick(this, this._reader);\n  },\n\n  EOT: true\n});\n\nWidget.Panel = Widget.extend({\n  defaultTemplate: `<div><span data-slot=\"text\"></span></div>`,\n\n\n  EOT: true\n});\n\nWidget.Toggle = Widget.extend({\n  defaultTemplate: `<button data-toggle=\"button\" data-slot=\"label\"></button>`,\n\n  _onAddExtra: function(container) {\n    this.state(this.options.states[0].stateName, container);\n\n    return container;\n  },\n\n  state: function(stateName, container) {\n    container = container || this._container;\n    this._resetState(container);\n    this._state = this.options.states.filter(function(s) { return s.stateName == stateName })[0];\n    this._updateClass(container);\n    this._updateTemplate(container);\n  },\n\n  _resetState: function(container) {\n    if ( ! this._state ) { return; }\n    if ( this._state.className ) {\n      DomUtil.removeClass(container, this._state.className);\n    }\n  },\n\n  _updateClass: function(container) {\n    if ( this._state.className ) {\n      DomUtil.addClass(container, this._state.className);\n    }\n  },\n\n  _action: function() {\n    this._state.onClick(this, this._reader);\n  },\n\n  data: function() {\n    return this._state.data || {};\n  },\n\n  EOT: true\n});\n\n// export var widget = function(options) {\n//   return new Widget(options);\n// }\n\nexport var widget = {\n  button: function(options) { return new Widget.Button(options); },\n  panel: function(options) { return new Widget.Panel(options); },\n  toggle: function(options) { return new Widget.Toggle(options); }\n}\n","exports.parseFullName = function parseFullName(\n    nameToParse, partToReturn, fixCase, stopOnError, useLongLists\n) {\n  \"use strict\";\n\n  var i, j, k, l, m, n, part, comma, titleList, suffixList, prefixList, regex,\n    partToCheck, partFound, partsFoundCount, firstComma, remainingCommas,\n    nameParts = [], nameCommas = [null], partsFound = [],\n    conjunctionList = ['&','and','et','e','of','the','und','y'],\n    parsedName = {\n      title: '', first: '', middle: '', last: '', nick: '', suffix: '', error: []\n    };\n\n  // Validate inputs, or set to defaults\n  partToReturn = partToReturn && ['title','first','middle','last','nick',\n    'suffix','error'].indexOf(partToReturn.toLowerCase()) > -1 ?\n    partToReturn.toLowerCase() : 'all';\n    // 'all' = return object with all parts, others return single part\n  if ( fixCase === false ) fixCase = 0;\n  if ( fixCase === true ) fixCase = 1;\n  fixCase = fixCase !== 'undefined' && ( fixCase === 0 || fixCase === 1 ) ?\n    fixCase : -1; // -1 = fix case only if input is all upper or lowercase\n  if ( stopOnError === true ) stopOnError = 1;\n  stopOnError = stopOnError && stopOnError === 1 ? 1 : 0;\n    // false = output warnings on parse error, but don't stop\n  if ( useLongLists === true ) useLongLists = 1;\n  useLongLists = useLongLists && useLongLists === 1 ? 1 : 0; // 0 = short lists\n\n  // If stopOnError = 1, throw error, otherwise return error messages in array\n  function handleError( errorMessage ) {\n    if ( stopOnError ) {\n      throw 'Error: ' + errorMessage;\n    } else {\n      parsedName.error.push('Error: ' + errorMessage);\n    }\n  }\n\n  // If fixCase = 1, fix case of parsedName parts before returning\n  function fixParsedNameCase ( fixedCaseName, fixCaseNow ) {\n    var forceCaseList = ['e','y','av','af','da','dal','de','del','der','di',\n      'la','le','van','der','den','vel','von','II','III','IV','J.D.','LL.M.',\n      'M.D.','D.O.','D.C.','Ph.D.'];\n    var forceCaseListIndex;\n    var namePartLabels = [];\n    var namePartWords;\n    if (fixCaseNow) {\n      namePartLabels = Object.keys(parsedName)\n        .filter( function(v) { return v !== 'error'; } );\n      for ( i = 0, l = namePartLabels.length; i < l; i++ ) {\n        if ( fixedCaseName[namePartLabels[i]] ) {\n          namePartWords = ( fixedCaseName[namePartLabels[i]] + '' ).split(' ');\n          for ( j = 0, m = namePartWords.length; j < m; j++ ) {\n            forceCaseListIndex = forceCaseList\n              .map( function(v) { return v.toLowerCase(); } )\n              .indexOf(namePartWords[j].toLowerCase());\n            if ( forceCaseListIndex > -1 ) { // Set case of words in forceCaseList\n              namePartWords[j] = forceCaseList[forceCaseListIndex];\n            } else if ( namePartWords[j].length === 1 ) { // Uppercase initials\n              namePartWords[j] = namePartWords[j].toUpperCase();\n            } else if (\n                namePartWords[j].length > 2 &&\n                namePartWords[j].slice(0,1)  ===\n                  namePartWords[j].slice(0,1).toUpperCase() &&\n                namePartWords[j].slice(1,2) ===\n                  namePartWords[j].slice(1,2).toLowerCase() &&\n                namePartWords[j].slice(2) ===\n                  namePartWords[j].slice(2).toUpperCase()\n              ) { // Detect McCASE and convert to McCase\n              namePartWords[j] = namePartWords[j].slice(0,3) +\n                namePartWords[j].slice(3).toLowerCase();\n            } else if (\n                namePartLabels[j] === 'suffix' &&\n                nameParts[j].slice(-1) !== '.' &&\n                !suffixList.indexOf(nameParts[j].toLowerCase())\n              ) { // Convert suffix abbreviations to UPPER CASE\n              if ( namePartWords[j] === namePartWords[j].toLowerCase() ) {\n                namePartWords[j] = namePartWords[j].toUpperCase();\n              }\n            } else { // Convert to Title Case\n              namePartWords[j] = namePartWords[j].slice(0,1).toUpperCase() +\n                namePartWords[j].slice(1).toLowerCase();\n            }\n          }\n          fixedCaseName[namePartLabels[i]] = namePartWords.join(' ');\n        }\n      }\n    }\n    return fixedCaseName;\n  }\n\n  // If no input name, or input name is not a string, abort\n  if ( !nameToParse || typeof nameToParse !== 'string' ) {\n    handleError('No input');\n    parsedName = fixParsedNameCase(parsedName, fixCase);\n    return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n  }\n\n  // Auto-detect fixCase: fix if nameToParse is all upper or all lowercase\n  if ( fixCase === -1 ) {\n    fixCase = (\n      nameToParse === nameToParse.toUpperCase() ||\n      nameToParse === nameToParse.toLowerCase() ? 1 : 0\n    );\n  }\n\n  // Initilize lists of prefixs, suffixs, and titles to detect\n  // Note: These list entries must be all lowercase\n  if ( useLongLists ) {\n    suffixList = ['esq','esquire','jr','jnr','sr','snr','2','ii','iii','iv',\n      'v','clu','chfc','cfp','md','phd','j.d.','ll.m.','m.d.','d.o.','d.c.',\n      'p.c.','ph.d.'];\n    prefixList = ['a','ab','antune','ap','abu','al','alm','alt','bab','bäck',\n      'bar','bath','bat','beau','beck','ben','berg','bet','bin','bint','birch',\n      'björk','björn','bjur','da','dahl','dal','de','degli','dele','del',\n      'della','der','di','dos','du','e','ek','el','escob','esch','fleisch',\n      'fitz','fors','gott','griff','haj','haug','holm','ibn','kauf','kil',\n      'koop','kvarn','la','le','lind','lönn','lund','mac','mhic','mic','mir',\n      'na','naka','neder','nic','ni','nin','nord','norr','ny','o','ua','ui\\'',\n      'öfver','ost','över','öz','papa','pour','quarn','skog','skoog','sten',\n      'stor','ström','söder','ter','ter','tre','türk','van','väst','väster',\n      'vest','von'];\n    titleList = ['mr','mrs','ms','miss','dr','herr','monsieur','hr','frau',\n      'a v m','admiraal','admiral','air cdre','air commodore','air marshal',\n      'air vice marshal','alderman','alhaji','ambassador','baron','barones',\n      'brig','brig gen','brig general','brigadier','brigadier general',\n      'brother','canon','capt','captain','cardinal','cdr','chief','cik','cmdr',\n      'coach','col','col dr','colonel','commandant','commander','commissioner',\n      'commodore','comte','comtessa','congressman','conseiller','consul',\n      'conte','contessa','corporal','councillor','count','countess',\n      'crown prince','crown princess','dame','datin','dato','datuk',\n      'datuk seri','deacon','deaconess','dean','dhr','dipl ing','doctor',\n      'dott','dott sa','dr','dr ing','dra','drs','embajador','embajadora','en',\n      'encik','eng','eur ing','exma sra','exmo sr','f o','father',\n      'first lieutient','first officer','flt lieut','flying officer','fr',\n      'frau','fraulein','fru','gen','generaal','general','governor','graaf',\n      'gravin','group captain','grp capt','h e dr','h h','h m','h r h','hajah',\n      'haji','hajim','her highness','her majesty','herr','high chief',\n      'his highness','his holiness','his majesty','hon','hr','hra','ing','ir',\n      'jonkheer','judge','justice','khun ying','kolonel','lady','lcda','lic',\n      'lieut','lieut cdr','lieut col','lieut gen','lord','m','m l','m r',\n      'madame','mademoiselle','maj gen','major','master','mevrouw','miss',\n      'mlle','mme','monsieur','monsignor','mr','mrs','ms','mstr','nti','pastor',\n      'president','prince','princess','princesse','prinses','prof','prof dr',\n      'prof sir','professor','puan','puan sri','rabbi','rear admiral','rev',\n      'rev canon','rev dr','rev mother','reverend','rva','senator','sergeant',\n      'sheikh','sheikha','sig','sig na','sig ra','sir','sister','sqn ldr','sr',\n      'sr d','sra','srta','sultan','tan sri','tan sri dato','tengku','teuku',\n      'than puying','the hon dr','the hon justice','the hon miss','the hon mr',\n      'the hon mrs','the hon ms','the hon sir','the very rev','toh puan','tun',\n      'vice admiral','viscount','viscountess','wg cdr'];\n  } else {\n    suffixList = ['esq','esquire','jr','jnr','sr','snr','2','ii','iii','iv',\n      'md','phd','j.d.','ll.m.','m.d.','d.o.','d.c.','p.c.','ph.d.'];\n    prefixList = ['ab','bar','bin','da','dal','de','de la','del','della','der',\n      'di','du','ibn','l\\'','la','le','san','st','st.','ste','ter','van',\n      'van de','van der','van den','vel','ver','vere','von'];\n    titleList = ['dr','miss','mr','mrs','ms','prof','sir','frau','herr','hr',\n      'monsieur','captain','doctor','judge','officer','professor'];\n  }\n\n  // Nickname: remove and store parts with surrounding punctuation as nicknames\n  regex = /\\s(?:[‘’']([^‘’']+)[‘’']|[“”\"]([^“”\"]+)[“”\"]|\\[([^\\]]+)\\]|\\(([^\\)]+)\\)),?\\s/g;\n  partFound = (' '+nameToParse+' ').match(regex);\n  if ( partFound ) partsFound = partsFound.concat(partFound);\n  partsFoundCount = partsFound.length;\n  if ( partsFoundCount === 1 ) {\n    parsedName.nick = partsFound[0].slice(2).slice(0,-2);\n    if ( parsedName.nick.slice(-1) === ',' ) {\n      parsedName.nick = parsedName.nick.slice(0,-1);\n    }\n    nameToParse = (' '+nameToParse+' ').replace(partsFound[0], ' ').trim();\n    partsFound = [];\n  } else if ( partsFoundCount > 1 ) {\n    handleError( partsFoundCount + ' nicknames found' );\n    for ( i = 0; i < partsFoundCount; i++ ) {\n      nameToParse = ( ' ' + nameToParse + ' ' )\n        .replace(partsFound[i], ' ').trim();\n      partsFound[i] = partsFound[i].slice(2).slice(0,-2);\n      if ( partsFound[i].slice(-1) === ',' ) {\n        partsFound[i] = partsFound[i].slice(0,-1);\n      }\n    }\n    parsedName.nick = partsFound.join(', ');\n    partsFound = [];\n  }\n  if ( !nameToParse.trim().length ) {\n    parsedName = fixParsedNameCase(parsedName, fixCase);\n    return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n  }\n\n  // Split remaining nameToParse into parts, remove and store preceding commas\n  for ( i = 0, n = nameToParse.split(' '), l = n.length; i < l; i++ ) {\n    part = n[i];\n    comma = null;\n    if ( part.slice(-1) === ',' ) {\n      comma = ',';\n      part = part.slice(0,-1);\n    }\n    nameParts.push(part);\n    nameCommas.push(comma);\n  }\n\n  // Suffix: remove and store matching parts as suffixes\n  for ( l = nameParts.length, i = l-1; i > 0; i-- ) {\n    partToCheck = (nameParts[i].slice(-1) === '.' ?\n      nameParts[i].slice(0,-1).toLowerCase() : nameParts[i].toLowerCase());\n    if (\n        suffixList.indexOf(partToCheck) > -1 ||\n        suffixList.indexOf(partToCheck+'.') > -1\n      ) {\n      partsFound = nameParts.splice(i,1).concat(partsFound);\n      if ( nameCommas[i] === ',' ) { // Keep comma, either before or after\n        nameCommas.splice(i+1,1);\n      } else {\n        nameCommas.splice(i,1);\n      }\n    }\n  }\n  partsFoundCount = partsFound.length;\n  if ( partsFoundCount === 1 ) {\n    parsedName.suffix = partsFound[0];\n    partsFound = [];\n  } else if ( partsFoundCount > 1 ) {\n    handleError(partsFoundCount + ' suffixes found');\n    parsedName.suffix = partsFound.join(', ');\n    partsFound = [];\n  }\n  if ( !nameParts.length ) {\n    parsedName = fixParsedNameCase(parsedName, fixCase);\n    return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n  }\n\n  // Title: remove and store matching parts as titles\n  for( l = nameParts.length, i = l-1; i >= 0; i--) {\n    partToCheck = (nameParts[i].slice(-1) === '.' ?\n      nameParts[i].slice(0,-1).toLowerCase() : nameParts[i].toLowerCase());\n    if (\n        titleList.indexOf(partToCheck) > -1 ||\n        titleList.indexOf(partToCheck+'.') > -1\n      ) {\n      partsFound = nameParts.splice(i,1).concat(partsFound);\n      if ( nameCommas[i] === ',' ) { // Keep comma, either before or after\n        nameCommas.splice(i+1,1);\n      } else {\n        nameCommas.splice(i,1);\n      }\n    }\n  }\n  partsFoundCount = partsFound.length;\n  if ( partsFoundCount === 1 ) {\n    parsedName.title = partsFound[0];\n    partsFound = [];\n  } else if ( partsFoundCount > 1 ) {\n    handleError(partsFoundCount + ' titles found');\n    parsedName.title = partsFound.join(', ');\n    partsFound = [];\n  }\n  if ( !nameParts.length ) {\n    parsedName = fixParsedNameCase(parsedName, fixCase);\n    return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n  }\n\n  // Join name prefixes to following names\n  if ( nameParts.length > 1 ) {\n    for ( i = nameParts.length-2; i >= 0; i-- ) {\n      if ( prefixList.indexOf(nameParts[i].toLowerCase()) > -1 ) {\n        nameParts[i] = nameParts[i] + ' ' + nameParts[i+1];\n        nameParts.splice(i+1,1);\n        nameCommas.splice(i+1,1);\n      }\n    }\n  }\n\n  // Join conjunctions to surrounding names\n  if ( nameParts.length > 2 ) {\n    for ( i = nameParts.length-3; i >= 0; i-- ) {\n      if ( conjunctionList.indexOf(nameParts[i+1].toLowerCase()) > -1 ) {\n        nameParts[i] = nameParts[i] + ' ' + nameParts[i+1] + ' ' + nameParts[i+2];\n        nameParts.splice(i+1,2);\n        nameCommas.splice(i+1,2);\n        i--;\n      }\n    }\n  }\n\n  // Suffix: remove and store items after extra commas as suffixes\n  nameCommas.pop();\n  firstComma = nameCommas.indexOf(',');\n  remainingCommas = nameCommas.filter(function(v) { return v !== null; }).length;\n  if ( firstComma > 1 || remainingCommas > 1 ) {\n    for ( i = nameParts.length-1; i >= 2; i-- ) {\n      if ( nameCommas[i] === ',' ) {\n        partsFound = nameParts.splice(i,1).concat(partsFound);\n        nameCommas.splice(i,1);\n        remainingCommas--;\n      } else {\n        break;\n      }\n    }\n  }\n  if ( partsFound.length ) {\n    if ( parsedName.suffix ) {\n      partsFound = [parsedName.suffix].concat(partsFound);\n    }\n    parsedName.suffix = partsFound.join(', ');\n    partsFound = [];\n  }\n\n  // Last name: remove and store last name\n  if ( remainingCommas > 0 ) {\n    if ( remainingCommas > 1 ) {\n      handleError( (remainingCommas-1) + ' extra commas found' );\n    }\n    // Remove and store all parts before first comma as last name\n    if ( nameCommas.indexOf(',') ) {\n      parsedName.last = nameParts.splice(0,nameCommas.indexOf(',')).join(' ');\n      nameCommas.splice(0,nameCommas.indexOf(','));\n    }\n  } else {\n    // Remove and store last part as last name\n    parsedName.last = nameParts.pop();\n  }\n  if ( !nameParts.length ) {\n    parsedName = fixParsedNameCase(parsedName, fixCase);\n    return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n  }\n\n  // First name: remove and store first part as first name\n  parsedName.first = nameParts.shift();\n  if ( !nameParts.length ) {\n    parsedName = fixParsedNameCase(parsedName, fixCase);\n    return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n  }\n\n  // Middle name: store all remaining parts as middle name\n  if ( nameParts.length > 2 ) {\n    handleError(nameParts.length + ' middle names');\n  }\n  parsedName.middle = nameParts.join(' ');\n\n  parsedName = fixParsedNameCase(parsedName, fixCase);\n  return partToReturn === 'all' ? parsedName : parsedName[partToReturn];\n};\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\nimport {parseFullName} from 'parse-full-name';\n\n// for debugging\nwindow.parseFullName = parseFullName;\n\nexport var Citation = Control.extend({\n  options: {\n    label: 'Citation',\n    html: '<span>Get Citation</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-citation\" data-toggle=\"open\">Get Citation</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('update-contents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Select Citation Format</legend>\n        <label><input name=\"format\" type=\"radio\" value=\"MLA\" checked=\"checked\" /> MLA</label>\n        <label><input name=\"format\" type=\"radio\" value=\"APA\" /> APA</label>\n        <label><input name=\"format\" type=\"radio\" value=\"Chicago\" /> Chicago</label>\n      </fieldset>\n    </form>\n    <blockquote id=\"formatted\" style=\"padding: 8px; border-left: 4px solid black; background-color: #fff\"></blockquote>\n    <div class=\"alert alert-info\" id=\"message\" style=\"display: none\"></div>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Copy Citation to Clipboard',\n      className: 'cozy-modal-citation',\n      actions: [\n        {\n          label: 'Copy Citation',\n          callback: function(event) {\n            document.designMode = \"on\";\n            var formatted = self._modal._container.querySelector(\"#formatted\");\n            // formatted.style.backgroundColor = 'rgba(255,255,255,1.0)';\n\n            var range = document.createRange();\n            range.selectNode(formatted);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // formatted.select();\n\n            try {\n              var flag = document.execCommand('copy');\n            } catch(err) {\n              console.log(\"AHOY COPY FAILED\", err);\n            }\n\n            self._message.innerHTML = 'Success! Citation copied to your clipboard.';\n            self._message.style.display = 'block';\n            sel.removeAllRanges();\n            range.detach();\n            document.designMode = \"off\";\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    this._formatted = this._modal._container.querySelector(\"#formatted\");\n    this._message = this._modal._container.querySelector(\"#message\");\n    DomEvent.on(this._form, 'change', function(event) {\n      var target = event.target;\n      if ( target.tagName == 'INPUT' ) {\n        this._initializeForm();\n      }\n    }, this);\n\n    this._initializeForm();\n  },\n\n  _initializeForm: function() {\n    var formatted = this._formatCitation();\n    this._formatted.innerHTML = formatted;\n    // this._formatted.value = formatted;\n    this._message.style.display = 'none';\n    this._message.innerHTML = '';\n  },\n\n  _formatCitation: function(format) {\n    if ( format == null ) {\n      var selected = this._form.querySelector(\"input:checked\");\n      format = selected.value;\n    }\n    var fn = \"_formatCitationAs\" + format;\n    return this[fn](this._reader.metadata);\n  },\n\n  _formatCitationAsMLA: function(metadata) {\n\n    var _formatNames = function(names, suffix) {\n      var name = names.shift()\n      var tmp = name.last;\n      if ( name.first ) { tmp += \", \" + name.first ; }\n      if ( name.middle ) { tmp += \" \" + name.middle ; }\n      if ( names.length == 1 ) {\n        name = names.shift();\n        tmp += \", and \";\n        if ( name.first ) { tmp += name.first + \" \" ; }\n        if ( name.middle ) { tmp += name.middle + \" \" ; }\n        tmp += name.last;\n      } else if ( names.length > 1 ) {\n        tmp += \", et al\";\n      }\n      if ( suffix ) {\n        tmp += suffix;\n      }\n      return tmp + \".\";\n    };\n\n    var parts = [];\n    var creator = this._parseCreator(metadata.creator);\n    var editor = this._parseEditor(metadata.editor);\n    if ( creator.length ) {\n      parts.push(_formatNames(creator));\n    }\n    if ( editor.length ) {\n      parts.push(_formatNames(editor, editor.length > 1 ? ', editors' : ', editor'));\n    }\n    if ( metadata.title ) { parts.push(\"<em>\" + metadata.title + \"</em>\" + \".\"); }\n    if ( metadata.publisher ) {\n      var part = metadata.publisher;\n      if ( metadata.pubdate ) {\n        var d = new Date(metadata.pubdate);\n        part += `, ${d.getYear() + 1900}`;\n      }\n      if ( metadata.number_of_volumes ) {\n        part += `. ${metadata.number_of_volumes} vols`;\n      }\n      if ( metadata.doi ) {\n        part += `, ${metadata.doi}`;\n      }\n      parts.push(part + '.');\n    }\n    return parts.join(' ');\n  },\n\n  _formatCitationAsAPA: function(metadata) {\n\n    var _formatNames = function(names, suffix) {\n      var name = names.shift()\n      var tmp = name.last;\n      if ( name.first ) { tmp += \", \" + name.first.substr(0, 1) + \".\" ; }\n      if ( name.middle ) { tmp += name.middle.substr(0, 1) + \".\" ; }\n      if ( names.length == 1 ) {\n        name = names.shift();\n        tmp += \", &amp; \";\n        tmp += name.last;\n        if ( name.first ) { tmp += \", \" + name.first.substr(0, 1) + \".\" ; }\n        if ( name.middle ) { tmp += name.middle.substr(0, 1) + \".\" ; }\n      } else if ( names.length > 1 ) {\n        tmp += \", et al.\";\n      }\n      if ( suffix ) {\n        tmp += suffix + \".\";\n      }\n      return tmp;\n    }\n\n    var parts = [];\n    var creator = this._parseCreator(metadata.creator);\n    var editor = this._parseEditor(metadata.editor);\n    if ( creator.length ) {\n      parts.push(_formatNames(creator));\n    }\n    if ( editor.length ) {\n      parts.push(_formatNames(editor, editor.length > 1 ? ' (Eds.)' : ' (Ed.)'));\n    }\n    if ( metadata.pubdate ) {\n      var d = new Date(metadata.pubdate);\n      parts.push(\"(\" + ( d.getYear() + 1900 ) + \").\");\n    }\n    if ( metadata.title ) {\n      var part = \"<em>\" + metadata.title + \"</em>\";\n      if ( metadata.number_of_volumes ) {\n        part += ` (Vols. 1-${metadata.number_of_volumes})`;\n      }\n      part += \".\";\n      parts.push(part);\n    }\n    if ( metadata.location ) {\n      parts.push(metadata.location + \":\");\n    }\n    if ( metadata.publisher ) {\n      parts.push(metadata.publisher + \".\");\n    }\n    if ( metadata.doi ) {\n      parts.push(metadata.doi + \".\");\n    }\n    return parts.join(' ');\n  },\n\n  _formatCitationAsChicago: function(metadata) {\n\n    var _formatNames = function(names, suffix) {\n      var name = names.shift()\n      var tmp = name.last;\n      if ( name.first ) { tmp += \", \" + name.first ; }\n      if ( name.middle ) { tmp += \" \" + name.middle ; }\n      if ( names.length == 1 ) {\n        name = names.shift();\n        tmp += \", and \";\n        if ( name.first ) { tmp += name.first + \" \" ; }\n        if ( name.middle ) { tmp += name.middle + \" \" ; }\n        tmp += name.last;\n      } else if ( names.length > 1 ) {\n        tmp += \", et al\";\n      }\n      if ( suffix ) {\n        tmp += suffix;\n      }\n      tmp += \".\";\n      return tmp;\n    }\n\n    var parts = [];\n    var creator = this._parseCreator(metadata.creator);\n    var editor = this._parseEditor(metadata.editor);\n    if ( creator.length ) {\n      parts.push(_formatNames(creator));\n    }\n    if ( editor.length ) {\n      parts.push(_formatNames(editor, editor.length > 1 ? ', eds' : ', ed'));\n    }\n    if ( metadata.title ) { parts.push(\"<em>\" + metadata.title + \"</em>\" + \".\"); }\n    if ( metadata.location ) {\n      parts.push(metadata.location + \":\");\n    }\n    if ( metadata.publisher ) {\n      var part = metadata.publisher;\n      if ( metadata.pubdate ) {\n        var d = new Date(metadata.pubdate);\n        part += `, ${d.getYear() + 1900}`;\n      }\n      parts.push(part + '.');\n    }\n    if ( metadata.doi ) {\n      parts.push(metadata.doi + \".\");\n    }\n    return parts.join(' ');\n  },\n\n  // possibly more magic than is good for the soul\n  _parseCreator: function(creator) {\n    var retval = [];\n    if ( creator ) {\n      if ( creator.constructor != Array ) {\n        // make an array?\n        creator = creator.split(\"; \");\n      }\n      for(var i in creator) {\n        retval.push(parseFullName(creator[i]));\n      }\n    }\n    return retval;\n  },\n\n  _parseEditor: function(editor) {\n    var retval = [];\n    if ( editor ) {\n      if ( editor.constructor != Array ) {\n        // make an array?\n        editor = editor.split(\"; \");\n      }\n      for(var i in editor) {\n        retval.push(parseFullName(editor[i]));\n      }\n    }\n    return retval;\n  },\n\n  EOT: true\n});\n\nexport var citation = function(options) {\n  return new Citation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\nimport {parseFullName} from 'parse-full-name';\n\n// for debugging\nwindow.parseFullName = parseFullName;\n\nexport var Search = Control.extend({\n  options: {\n    label: 'Search',\n    html: '<span>Search</span>'\n  },\n\n  defaultTemplate: `<form class=\"search\">\n    <label class=\"u-screenreader\" for=\"cozy-search-string\">Search</label>\n    <input id=\"cozy-search-string\" name=\"search\" type=\"text\" placeholder=\"Enter Search...\"/>\n    <button class=\"button--sm\" data-toggle=\"open\" aria-label=\"Search\"><i class=\"icon-magnifying-glass oi\" data-glyph=\"magnifying-glass\" title=\"Search\" aria-hidden=\"true\"></i></button>\n  </form>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    container.style.position = 'relative';\n\n    this._modal = this._reader.modal({\n      template: '<ul></ul>',\n      title: 'Search Results',\n      className: 'cozy-modal-search',\n      region: 'left'\n    });\n\n    this._modal.on('click', 'a[href]', function(modal, target) {\n      target = target.getAttribute('href');\n      this._reader.gotoPage(target);\n      return true;\n    }.bind(this));\n\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n\n      var searchString = this._container.querySelector(\"#cozy-search-string\");\n      var url = this.options.searchUrl + searchString.value;\n      var parent = this._modal._container.querySelector('ul');\n\n      // remove old search results and annotations\n      while (parent.hasChildNodes()) {\n        parent.removeChild(parent.lastChild);\n      }\n      reader.annotations.reset();\n\n      $.getJSON(url, function(data) {\n        console.log(\"SEARCH DATA\", data);\n\n        data.search_results.forEach(function(result) {\n          var option = DomUtil.create('li');\n          var anchor = DomUtil.create('a', null, option);\n          var cfiRange = \"epubcfi(\" + result.cfi + \")\";\n\n          anchor.textContent = result.snippet;\n          anchor.setAttribute(\"href\", cfiRange);\n          parent.appendChild(option);\n\n          reader.annotations.highlight(cfiRange);\n        });\n      })\n      .fail(function(jqxhr, textStatus, error) {\n        console.log(textStatus);\n        console.log(error);\n      })\n      .always(function() {\n        self._modal.activate();\n      });\n\n    }, this);\n\n    // DomEvent.on(this._modal._container, 'click', function(event) {\n    //   event.preventDefault();\n    //   var target = event.target;\n    //   if ( target.tagName == 'A' ) {\n    //     target = target.getAttribute('href');\n    //     this._reader.gotoPage(target);\n    //   }\n    //   this._modal.deactivate();\n    // }, this);\n\n    return container;\n  },\n\n  EOT: true\n});\n\nexport var search = function(options) {\n  return new Search(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var CitationOptions = Control.extend({\n  options: {\n    label: 'Citation',\n    html: '<span>Get Citation</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-citation\" data-toggle=\"open\">Get Citation</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('update-contents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _action: function() {\n    var self = this;\n    self._modal.activate();\n  },\n\n  _createButton: function (html, title, className, container, fn) {\n    var link = DomUtil.create('button', className, container);\n    link.innerHTML = html;\n    link.title = title;\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    DomEvent.disableClickPropagation(link);\n    DomEvent.on(link, 'click', DomEvent.stop);\n    DomEvent.on(link, 'click', fn, this);\n\n    return link;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Select Citation Format</legend>\n      </fieldset>\n    </form>\n    <blockquote id=\"formatted\" style=\"padding: 8px; border-left: 4px solid black; background-color: #fff\"></blockquote>\n    <div class=\"alert alert-info\" id=\"message\" style=\"display: none\"></div>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Copy Citation to Clipboard',\n      className: 'cozy-modal-citatation',\n      actions: [\n        {\n          label: 'Copy Citation',\n          callback: function(event) {\n            document.designMode = \"on\";\n            var formatted = self._modal._container.querySelector(\"#formatted\");\n\n            var range = document.createRange();\n            range.selectNode(formatted);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // formatted.select();\n\n            try {\n              var flag = document.execCommand('copy');\n            } catch(err) {\n              console.log(\"AHOY COPY FAILED\", err);\n            }\n\n            self._message.innerHTML = 'Success! Citation copied to your clipboard.';\n            self._message.style.display = 'block';\n            sel.removeAllRanges();\n            range.detach();\n            document.designMode = \"off\";\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');\n    var fieldset = this._form.querySelector('fieldset');\n    this._reader.metadata.citations.forEach(function(citation, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', citation.format);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = document.createTextNode(\" \" + citation.format);\n      label.appendChild(text);\n      input.setAttribute('data-text', citation.text);\n    });\n\n    this._formatted = this._modal._container.querySelector(\"#formatted\");\n    this._message = this._modal._container.querySelector(\"#message\");\n    DomEvent.on(this._form, 'change', function(event) {\n      var target = event.target;\n      if ( target.tagName == 'INPUT' ) {\n        this._initializeForm();\n      }\n    }, this);\n\n    this._initializeForm();\n  },\n\n  _initializeForm: function() {\n    var formatted = this._formatCitation();\n    this._formatted.innerHTML = formatted;\n    this._message.style.display = 'none';\n    this._message.innerHTML = '';\n  },\n\n  _formatCitation: function(format) {\n    if ( format == null ) {\n      var selected = this._form.querySelector(\"input:checked\");\n      format = selected.value;\n    }\n    var selected = this._form.querySelector(\"input[value=\" + format + \"]\");\n    return selected.getAttribute('data-text');\n    // return selected.dataset.text;\n  },\n\n  EOT: true\n});\n\nexport var citationOptions = function(options) {\n  return new CitationOptions(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\n// Title + Chapter\n\nexport var BibliographicInformation = Control.extend({\n  options: {\n    label: 'Info',\n    direction: 'left',\n    html: '<span class=\"oi\" data-glyph=\"info\">Info</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-bib-info oi\" data-glyph=\"info\" data-toggle=\"open\" aria-label=\"Bibliographic Information\"> Info</button>`,\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('update-contents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<dl>\n    </dl>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Info',\n      region: 'left',\n      fraction: 1.0\n    });\n\n    var dl = this._modal._container.querySelector('dl');\n\n    var metadata_fields = [\n      [ 'title', 'Title' ],\n      [ 'creator', 'Author' ],\n      [ 'pubdate', 'Publication Date' ],\n      [ 'modified_date', 'Modified Date' ],\n      [ 'publisher', 'Publisher' ],\n      [ 'rights', 'Rights' ],\n      [ 'doi', 'DOI' ],\n      [ 'description', 'Description' ],\n    ];\n\n    var metadata_fields_seen = {};\n\n    var metadata = this._reader.metadata;\n\n    var dateFormat = new Intl.DateTimeFormat('en-US', {\n      year: 'numeric', month: '2-digit', day: '2-digit'\n    });\n\n    for(var idx in metadata_fields) {\n      var key = metadata_fields[idx][0];\n      var label = metadata_fields[idx][1];\n      if ( metadata[key] ) {\n        metadata_fields_seen[key] = true;\n        var dt = DomUtil.create('dt', 'cozy-bib-info-label', dl);\n        dt.innerHTML = label;\n        var dd = DomUtil.create('dd', 'cozy-bib-info-value cozy-bib-info-value-' + key, dl);\n        var value = metadata[key];\n        if ( key == 'pubdate' || key == 'modified_date' ) {\n          var d = new Date(value);\n          value = dateFormat.format(d);\n          // value = d.toISOString().slice(0,10); // for YYYY-MM-DD\n        }\n        dd.innerHTML = value;\n      }\n    }\n\n  },\n\n  EOT: true\n});\n\nexport var bibliographicInformation = function(options) {\n  return new BibliographicInformation(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Download = Control.extend({\n  options: {\n    label: 'Download Book',\n    html: '<span>Download Book</span>'\n  },\n\n  defaultTemplate: `<button class=\"button--sm cozy-download oi\" data-toggle=\"open\" data-glyph=\"data-transfer-download\"> Download Book</button>`,\n\n\n  onAdd: function(reader) {\n    var self = this;\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=\" + this.options.direction + \"]\");\n    } else {\n\n      var className = this._className(),\n          options = this.options;\n\n      container = DomUtil.create('div', className);\n\n      var template = this.options.template || this.defaultTemplate;\n\n      var body = new DOMParser().parseFromString(template, \"text/html\").body;\n      while ( body.children.length ) {\n        container.appendChild(body.children[0]);\n      }\n    }\n\n    this._reader.on('update-contents', function(data) {\n      self._createPanel();\n    });\n\n\n    this._control = container.querySelector(\"[data-toggle=open]\");\n    DomEvent.on(this._control, 'click', function(event) {\n      event.preventDefault();\n      self._modal.activate();\n    }, this)\n\n    return container;\n  },\n\n  _createPanel: function() {\n    var self = this;\n\n    var template = `<form>\n      <fieldset>\n        <legend>Choose File Format</legend>\n      </fieldset>\n    </form>`;\n\n    this._modal = this._reader.modal({\n      template: template,\n      title: 'Download Book',\n      className: 'cozy-modal-download',\n      actions: [\n        {\n          label: 'Download',\n          callback: function(event) {\n            var selected = self._form.querySelector(\"input:checked\");\n            var href = selected.getAttribute('data-href');\n            self._configureDownloadForm(href);\n            self._form.submit();\n          }\n        }\n      ],\n      region: 'left',\n      fraction: 1.0\n    });\n\n    this._form = this._modal._container.querySelector('form');    \n    var fieldset = this._form.querySelector('fieldset');\n    this._reader.options.download_links.forEach(function(link, index) {\n      var label = DomUtil.create('label', null, fieldset);\n      var input = DomUtil.create('input', null, label);\n      input.setAttribute('name', 'format');\n      input.setAttribute('value', link.format);\n      input.setAttribute('data-href', link.href);\n      input.setAttribute('type', 'radio');\n      if ( index == 0 ) {\n        input.setAttribute('checked', 'checked');\n      }\n      var text = link.format;\n      if ( link.size ) {\n        text += \" (\" + link.size + \")\";\n      }\n      var text = document.createTextNode(\" \" + text);\n      label.appendChild(text);\n    });\n\n  },\n\n  _configureDownloadForm: function(href) {\n    var self = this;\n    self._form.setAttribute('method', 'GET');\n    self._form.setAttribute('action', href);\n    self._form.setAttribute('target', '_blank');\n  },\n\n\n  EOT: true\n});\n\nexport var download = function(options) {\n  return new Download(options);\n}\n","import {Control} from './Control';\nimport {Reader} from '../reader/Reader';\nimport * as DomUtil from '../dom/DomUtil';\nimport * as DomEvent from '../dom/DomEvent';\n\nexport var Navigator = Control.extend({\n  onAdd: function(reader) {\n    var container = this._container;\n    if ( container ) {\n      this._control = container.querySelector(\"[data-target=navigator]\");\n    } else {\n\n      var className = this._className('navigator'),\n          options = this.options;\n      container = DomUtil.create('div', className),\n\n      this._control  = this._createControl(className, container);\n    }\n    this._bindEvents();\n\n    return container;\n  },\n\n  _createControl: function (className, container) {\n    var input = DomUtil.create('input', className, container);\n    input.setAttribute('type', 'range');\n    input.setAttribute('min', 0);\n    input.setAttribute('max', 100);\n    input.setAttribute('step', 1);\n    input.setAttribute('value', 0);\n    input.setAttribute('aria-label','Slider navigator');\n\n    return input;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    // DomEvent.disableClickPropagation(this._control);\n    // DomEvent.on(this._control, 'click', DomEvent.stop);\n    // DomEvent.on(this._control, 'click', this._action, this);\n\n    this._control.addEventListener(\"change\", function() { self._action(); }, false);\n    this._control.addEventListener(\"mousedown\", function(){\n        this._mouseDown = true;\n    }, false);\n    this._control.addEventListener(\"mouseup\", function(){\n        this._mouseDown = false;\n    }, false);\n\n    this._reader.on('relocated', function(location) {\n      var percent = self._reader.locations.percentageFromCfi(location.start.cfi);\n      var percentage = Math.floor(percent * 100);\n      if ( ! self._mouseDown ) {\n        self._control.value = percentage;\n      }\n    })\n\n  },\n\n  _action: function() {\n    var cfi = this._reader.locations.cfiFromPercentage(this._control.value / 100);\n    this._reader.gotoPage(cfi);\n  },\n\n  EOT: true\n});\n\nexport var navigator = function(options) {\n  return new Navigator(options);\n}\n","import {Control, control} from './Control';\nimport {PageNext, PagePrevious, pageNext, pagePrevious, PageFirst, pageFirst, PageLast, pageLast} from './Control.Paging';\nimport {Contents, contents} from './Control.Contents';\nimport {Title, title} from './Control.Title';\nimport {PublicationMetadata, publicationMetadata} from './Control.PublicationMetadata';\nimport {Preferences, preferences} from './Control.Preferences';\nimport {Widget, widget} from './Control.Widget';\nimport {Citation, citation} from './Control.Citation';\nimport {Search, search} from './Control.Search';\nimport {CitationOptions, citationOptions} from './Control.CitationOptions';\nimport {BibliographicInformation, bibliographicInformation} from './Control.BibliographicInformation';\nimport {Download, download} from './Control.Download';\nimport {Navigator, navigator} from './Control.Navigator';\n\n// import {Zoom, zoom} from './Control.Zoom';\n// import {Attribution, attribution} from './Control.Attribution';\n\nControl.PageNext = PageNext;\nControl.PagePrevious = PagePrevious;\nControl.PageFirst = PageFirst;\nControl.PageLast = PageLast;\ncontrol.pagePrevious = pagePrevious;\ncontrol.pageNext = pageNext;\ncontrol.pageFirst = pageFirst;\ncontrol.pageLast = pageLast;\n\nControl.Contents = Contents;\ncontrol.contents = contents;\n\nControl.Title = Title;\ncontrol.title = title;\n\nControl.PublicationMetadata = PublicationMetadata;\ncontrol.publicationMetadata = publicationMetadata;\n\nControl.Preferences = Preferences;\ncontrol.preferences = preferences;\n\nControl.Widget = Widget;\ncontrol.widget = widget;\n\nControl.Citation = Citation;\ncontrol.citation = citation;\n\nControl.Search = Search;\ncontrol.search = search;\n\nControl.CitationOptions = CitationOptions;\ncontrol.citationOptions = citationOptions;\n\nControl.BibliographicInformation = BibliographicInformation;\ncontrol.bibliographicInformation = bibliographicInformation;\n\nControl.Download = Download;\ncontrol.download = download;\n\nControl.Navigator = Navigator;\ncontrol.navigator = navigator;\n\nexport {Control, control};\n","import {Evented} from './Events';\n\nvar Bus = Evented.extend({\n});\n\nvar instance;\nexport var bus = function() {\n  return instance || ( instance = new Bus() );\n}\n","import * as Browser from './Browser';\nexport {Browser};\n\nexport {Class} from './Class';\n\nimport {Evented} from './Events';\nexport {Evented};\nexport var Mixin = {Events: Evented.prototype};\n\nimport * as Util from './Util';\nexport {Util};\nexport {extend, bind, stamp, setOptions} from './Util';\nexport {bus} from './Bus';\n","\n// var ePub = window.ePub;\n// export {ePub};\n\nexport function ePub(options) {\n  return window.ePub(options);\n}","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as epubjs from '../epubjs';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.EpubJS = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(callback) {\n    var self = this;\n    this._book = epubjs.ePub(this.options.href);\n    this._book.loaded.navigation.then(function(toc) {\n      self._contents = toc;\n      self.metadata = self._book.package.metadata;\n      self.fire('update-contents', toc);\n      self.fire('update-title', self._book.package.metadata);\n    })\n    this._book.ready.then(function() {\n      return self._book.locations.generate(1600);\n    })\n    .then(callback);\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n    this.settings = { flow: this.options.flow };\n\n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n\n    // start the rendition after all the epub parts \n    // have been loaded\n    window._loaded = false;\n    this._book.ready.then(function() {\n\n      // have to set fixed dimensions to avoid edge clipping\n      var size = self.getFixedBookPanelSize();\n      self.settings.height = size.height; //  + 'px';\n      self.settings.width = size.width; //  + 'px';\n      self.settings.height = '100%';\n      self.settings.width = '100%';\n\n      self.settings['ignoreClass'] = 'annotator-hl';\n      self._rendition = self._book.renderTo(self._panes['book'], self.settings);\n      self._updateFontSize();\n      self._bindEvents();\n      self._drawn = true;\n\n      if ( target && target.start ) { target = target.start; }\n      if ( ! target && window.location.hash ) {\n        // target = \"epubcfi(\" + window.location.hash.substr(2) + \")\";\n        target = window.location.hash.substr(2);\n        target = self._book.url.path().resolve(target);\n        console.log(\"AHOY\", target);\n      }\n      self._rendition.display(target).then(function() {\n        if ( callback ) { callback(); }\n        console.log(\"AHOY DRAW DISPLAY\", self.getFixedBookPanelSize());\n        window._loaded = true;\n        self._initializeReaderStyles();\n\n        self.fire('relocated', self._rendition.currentLocation());\n        self.fire('opened');\n      });\n    })\n  },\n\n  _navigate: function(promise) {\n    var self = this;\n    var t = setTimeout(function() {\n      self._panes['loader'].style.display = 'block';\n    }, 100);\n    // promise.call(this._rendition).then(function() {\n    promise.then(function() {\n      clearTimeout(t);\n      self._panes['loader'].style.display = 'none';\n    });    \n  },\n\n  next: function() {\n    var self = this;\n    self._navigate(this._rendition.next());\n  },\n\n  prev: function() {\n    this._navigate(this._rendition.prev());\n  },\n\n  first: function() {\n    this._navigate(this._rendition.display(0));\n  },\n\n  last: function() {\n    var self = this;\n    var target = this._book.spine.length - 1;\n    this._navigate(this._rendition.display(target));\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" && target.substr(0, 3) == '../' ) {\n      while ( target.substr(0, 3) == '../' ) {\n        target = target.substr(3);\n      }\n    }\n    if ( typeof(target) == \"string\" ) {\n      if ( ! this._book.spine.spineByHref[target] ) {\n        if ( this._book.spine.spineByHref[\"Text/\" + target] ) {\n          target = \"Text/\" + target;\n        }\n      }\n    }\n    this._navigate(this._rendition.display(target));\n  },\n\n  percentageFromCfi: function(cfi) {\n    return this._book.percentageFromCfi(cfi);\n  },\n\n  destroy: function() {\n    if ( this._rendition ) {\n      try {\n        this._rendition.destroy();\n      } catch(e) {}\n    }\n    this._rendition = null;\n    this._drawn = false;\n  },\n\n  reopen: function(options, target) {\n    // different per reader?\n    var _this = this;\n    var target = target || this.currentLocation();\n    if( target.start ) { target = target.start ; }\n    if ( target.cfi ) { target = target.cfi ; }\n\n    Util.extend(this.options, options);\n\n    if ( this._rendition.settings.flow != options.flow ) {\n      if ( this.options.flow == 'auto' ) {\n        this._panes['book'].style.overflow = 'hidden';\n      } else {\n        this._panes['book'].style.overflow = 'auto';\n      }\n      this._rendition.flow(this.options.flow);\n    }\n\n    this._updateFontSize();\n    this._updateTheme();\n    this._selectTheme(true);\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) { \n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n    // add a stylesheet to stop images from breaking their columns\n    var add_max_img_styles = false;\n    if ( this._book.package.metadata.layout == 'pre-paginated' ) {\n      // NOOP\n    } else if ( this.options.flow == 'auto' || this.options.flow == 'paginated' ) {\n      add_max_img_styles = true;\n    }\n\n    var custom_stylesheet_rules = [];\n\n    // if ( add_max_img_styles ) {\n    //   // WHY IN HEAVENS NAME?\n    //   // var style = window.getComputedStyle(this._panes['book']);\n    //   var style = window.getComputedStyle(this._rendition.manager.container);\n    //   var height = parseInt(style.getPropertyValue('height'));\n    //   height -= parseInt(style.getPropertyValue('padding-top'));\n    //   height -= parseInt(style.getPropertyValue('padding-bottom'));\n    //   // height -= 100;\n    //   console.log(\"AHOY\", height, style);\n    //   custom_stylesheet_rules.push([ 'img', [ 'max-height', height + 'px !important' ], [ 'max-width', '100% !important'], [ 'height', 'auto' ], [ 'width', 'auto' ]]);\n    // }\n\n    this._updateFontSize();\n\n    if ( custom_stylesheet_rules.length ) {\n      this._rendition.hooks.content.register(function(view) {\n        view.addStylesheetRules(custom_stylesheet_rules);\n      })\n    }\n\n    this._rendition.on('relocated', function(location) {\n      self.fire('relocated', location);\n    })\n\n    this._rendition.on(\"locationChanged\", function(location) {\n      var view = this.manager.current();\n      var section = view.section;\n      var current = this.book.navigation.get(section.href);\n      self.fire(\"update-section\", current);\n    });\n\n    this._rendition.on(\"rendered\", function(section, view) {\n      if ( view.contents ) {\n        view.contents.on(\"linkClicked\", function(href) {\n          self._rendition.display(href);\n        })\n      }\n      if ( ! self._rendition.manager.__scroll ) {\n        var ticking;\n        self._rendition.manager.container.addEventListener(\"scroll\", function(event) {\n          if ( ! ticking ) {\n            var mod = event.target.scrollLeft % parseInt(self._rendition.manager.layout.delta, 10);\n            if ( mod > 0 ) {\n              ticking = true;\n              var x = Math.floor(event.target.scrollLeft / parseInt(self._rendition.manager.layout.delta, 10)) + 1;\n              var delta = ( x * self._rendition.manager.layout.delta) - event.target.scrollLeft;\n              self._rendition.manager.scrollBy(delta);\n              setTimeout(function() { ticking = false; }, 100);\n            }\n          }\n        })\n        self._rendition.manager.views.__scroll = true;\n      }\n      window.location.hash = \"#/\"+self._book.url.path().relative(section.href);\n    })\n  },\n\n  _initializeReaderStyles: function() {\n    var self = this;\n    var themes = this.options.themes;\n    if ( themes ) {\n      themes.forEach(function(theme) {\n        self._rendition.themes.register(theme['klass'], theme.href ? theme.href : theme.rules);\n      })\n    }\n\n    // base for highlights\n    this._rendition.themes.override('.epubjs-hl', \"fill: yellow; fill-opacity: 0.3; mix-blend-mode: multiply;\");\n  },\n\n  _selectTheme: function(refresh) {\n    var theme = this.options.theme || 'default';\n    this._rendition.themes.select(theme);\n    if ( 0 && refresh ) {\n      var cfi = this.currentLocation().end.cfi;\n      this._rendition.manager.clear();\n      console.log(\"AHOY\", cfi);\n      this._rendition.display(cfi);\n    }\n  },\n\n  _updateFontSize: function() {\n    if ( this.options.text_size == 'large' ) {\n      this._rendition.themes.fontSize(this.options.fontSizeLarge);\n    } else if ( this.options.text_size == 'small' ) {\n      this._rendition.themes.fontSize(this.options.fontSizeSmall);\n    } else {\n      this._rendition.themes.fontSize(this.options.fontSizeDefault);\n    }\n  },\n\n  _resizeBookPane: function() {\n    var self = this;\n    return;\n    setTimeout(function() {\n      var size = self.getFixedBookPanelSize();\n      self.settings.height = size.height + 'px';\n      self.settings.width = size.width + 'px';\n      console.log(\"AHOY RESIZING?\", size, self._panes['book'].getBoundingClientRect());\n      self._rendition.manager.resize(size.width, size.height);\n    }, 150);\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.EpubJS.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'annotations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._rendition.annotations;\n  }\n});\n\nObject.defineProperty(Reader.EpubJS.prototype, 'locations', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._book.locations;\n  }\n});\n\nwindow.Reader = Reader;\n\nexport function createReader(id, options) {\n  return new Reader.EpubJS(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.Mock = Reader.extend({\n\n  initialize: function(id, options) {\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(callback) {\n    var self = this;\n    this._book = {\n      metadata: {\n        title: 'The Mock Life',\n        creator: 'Alex Mock',\n        publisher: 'University Press',\n        location: 'Ann Arbor, MI',\n        pubdate: '2017-05-23'\n      },\n      contents: [\n      ]\n    };\n\n    this.metadata = this._book.metadata;\n    this.fire('update-contents', this._book.contents);\n    this.fire('update-title', this._metadata);\n    callback();\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n    this.settings = { flow: this.options.flow };\n    this.settings.height = '100%';\n    this.settings.width = '99%';\n    // this.settings.width = '100%';\n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n    // have to set this to prevent scrolling issues\n    // this.settings.height = this._panes['book'].clientHeight;\n    // this.settings.width = this._panes['book'].clientWidth;\n\n    // // start the rendition after all the epub parts \n    // // have been loaded\n    // this._book.ready.then(function() {\n    //   self._rendition = self._book.renderTo(self._panes['book'], self.settings);\n    //   self._bindEvents();\n\n    //   if ( target && target.start ) { target = target.start; }\n    //   self._rendition.display(target).then(function() {\n    //     if ( callback ) { callback(); }\n    //   });\n    // })\n  },\n\n  next: function() {\n    // this._rendition.next();\n  },\n\n  prev: function() {\n    // this._rendition.prev();\n  },\n\n  first: function() {\n    // this._rendition.display(0);\n  },\n\n  last: function() {\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" && target.substr(0, 3) == '../' ) {\n      while ( target.substr(0, 3) == '../' ) {\n        target = target.substr(3);\n      }\n    }\n    // this._rendition.display(target);\n  },\n\n  destroy: function() {\n    // if ( this._rendition ) {\n    //   this._rendition.destroy();\n    // }\n    // this._rendition = null;\n  },\n\n  currentLocation: function() {\n    if ( this._rendition ) { \n      return this._rendition.currentLocation();\n    }\n    return null;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n\n  },\n\n  _updateTheme: function() {\n\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.Mock.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nexport function createReader(id, options) {\n  return new Reader.Mock(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\nimport * as epubjs from '../epubjs';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.EpubJSv2 = Reader.extend({\n\n  initialize: function(id, options) {\n    this._setupHooks();\n\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(callback) {\n    var self = this;\n\n    this.settings = { flow: this.options.flow };\n\n    var style = window.getComputedStyle(this._panes['book']);\n    var h = this._panes['book'].clientHeight - parseInt(style.paddingTop) - parseInt(style.paddingBottom);\n    // this.settings.height = '100%'; // Math.ceil(h * 1.00) + 'px';\n    // this.settings.width = '100%'; // Math.ceil(this._panes['book'].clientWidth * 0.99) + 'px';\n\n    // this.settings.width = '100%';\n    \n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n\n    this._book = epubjs.ePub(this.options.href, { restore: false, height: this.settings.height, width: this.settings.width });\n    this._book.getMetadata().then(function(meta) {\n      self.metadata = meta;\n      self.fire('update-title', self.metadata);\n    })\n    this._book.getToc().then(function(toc) {\n      var data = { toc : [] };\n      var toc_idx = 0;\n      var tmp = toc.slice(0);\n      while(tmp.length) {\n        var item = tmp.shift();\n        toc_idx += 1;\n        item.id = toc_idx;\n        data.toc.push(item);\n        if ( item.subitems && item.subitems.length ) {\n          item.subitems.reverse().forEach(function(item_) {\n            item_.parent = item.id;\n            tmp.unshift(item_);\n          })\n        }\n      }\n      self._contents = data;\n      self.fire('update-contents', data);\n    })\n    this._book.ready.all.then(callback);\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n\n    // start the rendition after all the epub parts \n    // have been loaded\n    this._book.ready.all.then(function() {\n      // self._rendition = self._book.renderTo(self._panes['book'], self.settings);\n      var promise = self._book.renderTo(self._panes['book']);\n      self._bindEvents();\n      self._drawn = true;\n\n      promise.then(function(renderer) {\n        console.log(\"AHOY WHAT RENDITION\", arguments);\n        self._rendition = renderer;\n        if ( target && target.start ) { target = target.start; }\n        if ( target === undefined ) { console.log(\"AHOY UNDEFINED START\"); target = 0; }\n        if ( typeof(target) == 'number' ) { console.log(\"AHOY NUMBER\", target); target = self._book.toc[target].cfi; }\n        self._book.goto(target);\n        if ( callback ) {\n          setTimeout(callback, 100);\n        }\n      })\n    })\n  },\n\n  _navigate: function(promise) {\n    var self = this;\n    console.log(\"AHOY NAVIGATING\");\n    var t = setTimeout(function() {\n      self._panes['loader'].style.display = 'block';\n    }, 100);\n    // promise.call(this._rendition).then(function() {\n    promise.then(function() {\n      clearTimeout(t);\n      self._panes['loader'].style.display = 'none';\n    });    \n  },\n\n  _preResize: function() {\n    var self = this;\n    // self._rendition.render.window.removeEventListener(\"resize\", self._rendition.resized);\n  },\n\n  next: function() {\n    var self = this;\n    this._navigate(self._book.nextPage());\n  },\n\n  prev: function() {\n    this._navigate(this._book.prevPage());\n  },\n\n  first: function() {\n    this._navigate(this._book.goto(0));\n  },\n\n  last: function() {\n    var self = this;\n    var target = this._contents.toc.length - 1;\n    this._navigate(this._book.goto(target.cfi));\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" && target.substr(0, 3) == '../' ) {\n      while ( target.substr(0, 3) == '../' ) {\n        target = target.substr(3);\n      }\n    }\n    if ( typeof(target) == \"string\" ) {\n      if ( ! this._book.spineIndexByURL[target] ) {\n        if ( this._book.spineIndexByURL[\"Text/\" + target] ) {\n          target = \"Text/\" + target;\n        }\n      }\n    }\n    this._navigate(this._book.goto(target));\n  },\n\n  destroy: function() {\n    this._drawn = false;\n    this._reader.unload();\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) { \n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    var custom_stylesheet_rules = [];\n    this.custom_stylesheet_rules = custom_stylesheet_rules;\n\n\n    // EPUBJS.Hooks.register(\"beforeChapterDisplay\").styles = function(callback, renderer) {\n    //   console.log(\"AHOY RENDERING\", custom_stylesheet_rules.length);\n    //   var s = document.createElement(\"style\");\n    //   s.type = \"text/css\";\n    //   var innerHTML = '';\n    //   custom_stylesheet_rules.forEach(function(rule) {\n    //     var css = rule[0] + '{ ';\n    //     for(var i = 1; i < rule.length; i++) {\n    //       css += rule[i][0] + \": \" + rule[i][1] + \";\";\n    //     }\n    //     innerHTML += css + \"}\\n\";\n    //   })\n    //   renderer.doc.head.appendChild(s);\n    //   if (callback) { callback(); }\n\n    // }\n\n    // add a stylesheet to stop images from breaking their columns\n    var add_max_img_styles = false;\n    if ( this._book.metadata.layout == 'pre-paginated' ) {\n      // NOOP\n    } else if ( this.options.flow == 'auto' || this.options.flow == 'paginated' ) {\n      add_max_img_styles = true;\n    }\n\n    if ( add_max_img_styles ) {\n      // WHY IN HEAVENS NAME?\n      var style = window.getComputedStyle(this._panes['book']);\n      var height = parseInt(style.getPropertyValue('height'));\n      height -= parseInt(style.getPropertyValue('padding-top'));\n      height -= parseInt(style.getPropertyValue('padding-bottom'));\n      custom_stylesheet_rules.push([ 'img', [ 'max-height', height + 'px' ], [ 'max-width', '100%'], [ 'height', 'auto' ]]);\n    }\n\n    if ( this.options.text_size == 'large' ) {\n      this._book.setStyle('fontSize', this.options.fontSizeLarge);\n    }\n    if ( this.options.text_size == 'small' ) {\n      this._book.setStyle('fontSize', this.options.fontSizeSmall);\n    }\n    if ( this.options.theme == 'dark' ) {\n      DomUtil.addClass(this._container, 'cozy-theme-dark');\n      custom_stylesheet_rules.push([ 'img', [ 'filter', 'invert(100%)' ] ]);\n      // custom_stylesheet_rules.push([ 'body', [ 'background-color', '#191919' ], [ 'color', '#fff' ] ]);\n      // custom_stylesheet_rules.push([ 'a', [ 'color', '#d1d1d1' ] ]);\n    } else {\n      DomUtil.removeClass(this._container, 'cozy-theme-dark');\n    }\n\n    // -- this does not work\n    if ( custom_stylesheet_rules.length ) {\n      console.log(\"AHOY RENDITION\", this._rendition);\n      // this._rendition.hooks.content.register(function(view) {\n      //   view.addStylesheetRules(custom_stylesheet_rules);\n      // })\n    }\n\n    this._book.on(\"renderer:locationChanged\", function(location) {\n      // var view = this.manager.current();\n      // var section = view.section;\n      // var current = this.book.navigation.get(section.href);\n      var epubjs = new EPUBJS.EpubCFI();\n      var parts = epubjs.parse(location);\n      var spine = self._book.spine[parts.spinePos];\n      var checked = self._contents.toc.filter(function(value) { return value.href == spine.href });\n      if ( checked.length ) {\n        var current = checked[0];\n        self.fire('update-section', current);\n      }\n    });\n  },\n\n  _setupHooks: function() {\n    // hooks have to be configured before any EPUBJS object is instantiated\n    EPUBJS.Hooks.register(\"beforeChapterDisplay\").smartimages = function(callback, renderer){\n            var images = renderer.contents.querySelectorAll('img'),\n                items = Array.prototype.slice.call(images),\n                iheight = renderer.height,//chapter.bodyEl.clientHeight,//chapter.doc.body.getBoundingClientRect().height,\n                oheight;\n\n            if(renderer.layoutSettings.layout != \"reflowable\") {\n                callback();\n                return; //-- Only adjust images for reflowable text\n            }\n\n            items.forEach(function(item){\n\n                var size = function() {\n                    var itemRect = item.getBoundingClientRect(),\n                        rectHeight = itemRect.height,\n                        top = itemRect.top,\n                        oHeight = item.getAttribute('data-height'),\n                        height = oHeight || rectHeight,\n                        newHeight,\n                        fontSize = Number(getComputedStyle(item, \"\").fontSize.match(/(\\d*(\\.\\d*)?)px/)[1]),\n                        fontAdjust = fontSize ? fontSize / 2 : 0;\n\n                    iheight = renderer.contents.clientHeight;\n                    if(top < 0) top = 0;\n\n                    item.style.maxWidth =  \"100%\";\n\n                    if(height + top >= iheight) {\n\n                        if(top < iheight/2) {\n                            // Remove top and half font-size from height to keep container from overflowing\n                            newHeight = iheight - top - fontAdjust;\n                            item.style.maxHeight = newHeight + \"px\";\n                            item.style.width= \"auto\";\n                        }else{\n                            if(height > iheight) {\n                                item.style.maxHeight = iheight + \"px\";\n                                item.style.width= \"auto\";\n                                itemRect = item.getBoundingClientRect();\n                                height = itemRect.height;\n                            }\n                            item.style.display = \"block\";\n                            item.style[\"WebkitColumnBreakBefore\"] = \"always\";\n                            item.style[\"breakBefore\"] = \"column\";\n\n                        }\n\n                        item.setAttribute('data-height', newHeight);\n\n                    }else{\n                        item.style.removeProperty('max-height');\n                        item.style.removeProperty('margin-top');\n                    }\n                }\n\n                var unloaded = function(){\n                    // item.removeEventListener('load', size); // crashes in IE\n                    renderer.off(\"renderer:resized\", size);\n                    renderer.off(\"renderer:chapterUnload\", this);\n                };\n\n                item.addEventListener('load', size, false);\n\n                renderer.on(\"renderer:resized\", size);\n\n                renderer.on(\"renderer:chapterUnload\", unloaded);\n\n                size();\n\n            });\n\n            if(callback) callback();\n\n    }\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.EpubJSv2.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nexport function createReader(id, options) {\n  return new Reader.EpubJSv2(id, options);\n}\n","import * as Util from '../core/Util';\nimport {Reader} from './Reader';\n// import {Readium} from '../readium';\nimport * as DomUtil from '../dom/DomUtil';\n\nReader.Readium = Reader.extend({\n\n  initialize: function(id, options) {\n    this._setupHooks();\n\n    Reader.prototype.initialize.apply(this, arguments);\n  },\n\n  open: function(callback) {\n    var self = this;\n\n    this.settings = { flow: this.options.flow };\n    \n    if ( this.options.flow == 'auto' ) {\n      this._panes['book'].style.overflow = 'hidden';\n    } else {\n      this._panes['book'].style.overflow = 'auto';\n    }\n\n    var readiumOptions = { useSimpleLoader: true };\n    require([\"readium_shared_js/globalsSetup\", \"readium_shared_js/globals\"], function (GlobalsSetup, Globals) {\n      require(['jquery', 'readium_js/Readium'], function ($, Readium) {\n        self.Readium = Readium;\n        callback();\n      });\n    });\n  },\n\n  draw: function(target, callback) {\n    var self = this;\n\n    var readiumOptions = { useSimpleLoader: true };\n    self._book = new self.Readium(readiumOptions, { el: '.cozy-module-book' });\n    self._book.openPackageDocument(\n      self.options.href,\n      function(packageDocument, options) {\n        if ( callback ) {\n          setTimeout(callback, 100);\n        }\n        self.metadata = options.metadata;\n        self.fire('update-title', self.metadata);\n        packageDocument.generateTocListDOM(function(dom) {\n            var data = { toc : [] };\n            var toc_idx = 0;\n            var __walk = function(items, parent) {\n              items.forEach(function(item) {\n                toc_idx += 1;\n                var link = item.querySelector(\"a[href]\");\n                var chapter = { href: link.getAttribute('href'), label: link.innerText, id: toc_idx, parent: parent };\n                data.toc.push(chapter);\n                var subitems = item.querySelectorAll(\"ol > li\");\n                if ( subitems ) {\n                  __walk(subitems, chapter.id);\n                }\n              })\n            }\n            __walk(dom.querySelectorAll(\"nav > ol > li\"));\n            self._contents = data;\n            self.fire('update-contents', data);\n            self._book.reader.updateSettings({ columnGap: 60 });\n        })\n      }\n    )\n\n  },\n\n  _navigate: function(target) {\n    var self = this;\n    if (parseInt(target) == target) {\n      self._book.reader.openPageIndex(target);\n    } else {\n      self._book.reader.openSpineItemPage(target);\n    }\n  },\n\n  _preResize: function() {\n    var self = this;\n  },\n\n  next: function() {\n    var self = this;\n    // this._navigate(self._book.nextPage());\n    this._book.reader.openPageRight();\n  },\n\n  prev: function() {\n    // this._navigate(this._book.prevPage());\n    this._book.reader.openPageLeft();\n  },\n\n  first: function() {\n    this._navigate(this._book.goto(0));\n  },\n\n  last: function() {\n    var self = this;\n    var target = this._contents.toc.length - 1;\n    this._navigate(this._book.goto(target.cfi));\n  },\n\n  gotoPage: function(target) {\n    if ( typeof(target) == \"string\" && target.substr(0, 3) == '../' ) {\n      while ( target.substr(0, 3) == '../' ) {\n        target = target.substr(3);\n      }\n    }\n    if ( typeof(target) == \"string\" ) {\n      var spine = this._book.reader.spine();\n      if ( ! spine.getItemByHref(target) ) {\n        if ( spine.getItemByHref(\"Text/\" + target) ) {\n          target = \"Text/\" + target;\n        }\n      }\n      target = spine.getItemByHref(target).idref;\n    }\n    this._navigate(target);\n  },\n\n  destroy: function() {\n    this._drawn = false;\n    this._book.closePackageDocument();\n  },\n\n  reopen: function(options) {\n    // different per reader?\n    var target = target || this.currentLocation();\n    Util.extend(this.options, options);\n    var readerSettings = {}; // this._book.reader.viewerSettings();\n\n    readerSettings.scroll = ( options.flow == 'scrolled-doc' ? 'scroll-doc' : 'auto' );\n    readerSettings.fontSize = 100;\n    if ( options.text_size == 'large' ) { readerSettings.fontSize = parseInt(this.options.fontSizeLarge); }\n    else if ( options.text_size == 'small' ) { readerSettings.fontSize = this.options.fontSizeSmall; }\n    this._book.reader.updateSettings(readerSettings);\n    this._updateTheme();\n    this._updateReaderStyles();\n  },\n\n  currentLocation: function() {\n    if ( this._rendition && this._rendition.manager ) { \n      this._cached_location = this._rendition.currentLocation();\n    }\n    return this._cached_location;\n  },\n\n  _updateReaderStyles: function() {\n    var isAuthorTheme = false;\n\n    var styles = this._getThemeStyles();\n    var bookStyles = [];\n    for(var selector in styles) {\n      bookStyles.push({\n        selector: selector,\n        declarations: styles[selector]\n      });\n      if ( selector == 'a' ) {\n        bookStyles.push({\n          selector: selector + ' *',\n          declarations: styles[selector]\n        });\n      }\n    }\n    this._book.reader.setBookStyles(bookStyles);\n  },\n\n  _bindEvents: function() {\n    var self = this;\n    var custom_stylesheet_rules = [];\n    this.custom_stylesheet_rules = custom_stylesheet_rules;\n    // TODO - bind page change to update section\n  },\n\n  EOT: true\n\n})\n\nObject.defineProperty(Reader.Readium.prototype, 'metadata', {\n  get: function() {\n    // return the combined metadata of configured + book metadata\n    return this._metadata;\n  },\n\n  set: function(data) {\n    this._metadata = Util.extend({}, data, this.options.metadata);\n  }\n});\n\nexport function createReader(id, options) {\n  return new Reader.Readium(id, options);\n}\n","import {Reader} from './Reader';\nimport * as EpubJS from './Reader.EpubJS';\nimport * as Mock from './Reader.Mock';\nimport * as EpubJSv2 from './Reader.EpubJSv2';\nimport * as Readium from './Reader.Readium';\n\nvar engines = {\n  epubjs: EpubJS.createReader,\n  epubjsv2: EpubJSv2.createReader,\n  readium: Readium.createReader,\n  mock: Mock.createReader\n}\n\nexport var reader = function(id, options) {\n  var engine = options.engine || window.COZY_EPUB_ENGINE || 'epubjs';\n  return engines[engine].apply(this, arguments);\n}","\nimport {version} from '../package.json';\nexport {version};\n\n// control\nexport * from './control/index';\n\n// core\nexport * from './core/index';\n\n// dom\nexport * from './dom/index';\n\n// reader\nexport * from './reader/index';\n\n// misc\n\nvar oldCozy = window.cozy;\nexport function noConflict() {\n  window.cozy = oldCozy;\n  return this;\n}\n"],"names":["extend","dest","i","j","len","src","arguments","length","create","Object","F","proto","prototype","bind","fn","obj","slice","Array","apply","call","args","concat","lastId","stamp","_cozy_id","throttle","time","context","lock","wrapperFn","later","wrapNum","x","range","includeMax","max","min","d","falseFn","formatNum","num","digits","pow","Math","round","isNumeric","isNaN","parseFloat","isFinite","trim","str","replace","splitWords","split","setOptions","options","hasOwnProperty","getParamString","existingUrl","uppercase","params","push","encodeURIComponent","toUpperCase","indexOf","join","templateRe","template","data","key","value","undefined","Error","isArray","toString","array","el","emptyImageUrl","getPrefixed","name","window","lastTime","timeoutDefer","Date","timeToCall","setTimeout","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","id","clearTimeout","requestAnimFrame","immediate","cancelAnimFrame","Class","props","NewClass","initialize","callInitHooks","parentProto","__super__","Util","constructor","statics","includes","_initHooks","_initHooksCalled","include","mergeOptions","addInitHook","init","checkDeprecatedMixinEvents","cozy","Mixin","Evented","types","type","_on","_events","_off","typeListeners","newListener","ctx","listeners","l","_firingCount","splice","propagate","listens","event","target","_propagateEvent","_eventParents","once","handler","off","on","e","fire","layer","addEventListener","removeEventListener","clearAllEventListeners","addOneTimeEventListener","fireEvent","hasEventListeners","style","document","documentElement","ie","ielt9","edge","navigator","webkit","userAgentContains","android","android23","opera","chrome","gecko","safari","phantom","opera12","win","platform","ie3d","webkit3d","WebKitCSSMatrix","gecko3d","any3d","L_DISABLE_3D","mobile","orientation","mobileWebkit","mobileWebkit3d","msPointer","PointerEvent","MSPointerEvent","pointer","touch","L_NO_TOUCH","DocumentTouch","mobileOpera","mobileGecko","retina","devicePixelRatio","screen","deviceXDPI","logicalXDPI","canvas","createElement","getContext","svg","vml","div","innerHTML","shape","firstChild","behavior","babelHelpers.typeof","adj","userAgent","toLowerCase","Point","y","point","clone","_add","toPoint","_subtract","_divideBy","_multiplyBy","_round","_floor","floor","_ceil","ceil","sqrt","abs","POINTER_DOWN","Browser","POINTER_MOVE","POINTER_UP","POINTER_CANCEL","TAG_WHITE_LIST","_pointers","_pointerDocListener","_pointersCount","addPointerListener","removePointerListener","_addPointerStart","onDown","pointerType","MSPOINTER_TYPE_MOUSE","tagName","_globalPointerDown","_globalPointerMove","_globalPointerUp","pointerId","_handlePointer","touches","changedTouches","_addPointerMove","onMove","buttons","_addPointerEnd","onUp","_touchstart","_touchend","_pre","addDoubleTapListener","last","doubleTap","delay","onTouchStart","count","now","delta","onTouchEnd","cancelBubble","newTouch","prop","removeDoubleTapListener","touchstart","touchend","dblclick","eventsKey","addOne","originalHandler","isExternalTarget","attachEvent","removeOne","detachEvent","stopPropagation","originalEvent","_stopped","disableScrollPropagation","disableClickPropagation","fakeStop","preventDefault","returnValue","stop","getMousePosition","container","clientX","clientY","rect","getBoundingClientRect","left","clientLeft","top","clientTop","wheelPxFactor","getWheelDelta","wheelDeltaY","deltaY","deltaMode","deltaX","deltaZ","wheelDelta","detail","skipEvents","skipped","events","related","relatedTarget","parentNode","err","lastClick","filterClick","timeStamp","elapsed","_simulatedClick","_simulated","TRANSFORM","testProp","TRANSITION","TRANSITION_END","get","getElementById","getStyle","currentStyle","defaultView","css","getComputedStyle","className","appendChild","remove","parent","removeChild","empty","toFront","toBack","insertBefore","hasClass","classList","contains","getClass","RegExp","test","addClass","classes","add","removeClass","setClass","baseVal","setOpacity","opacity","_setOpacityIE","filter","filterName","filters","item","Enabled","Opacity","isPropertySupported","setTransform","offset","scale","pos","setPosition","_leaflet_pos","getPosition","disableTextSelection","enableTextSelection","_userSelect","DomEvent","userSelectProperty","disableImageDrag","enableImageDrag","_outlineElement","_outlineStyle","preventOutline","element","tabIndex","outline","restoreOutline","global","freeGlobal","root","Symbol","symToStringTag","objectProto","nativeObjectToString","getRawTag","objectToString","isObjectLike","baseGetTag","isSymbol","isObject","toNumber","keyboardAllowed","Element","val","fnMap","ret","eventNameMap","fullscreenchange","fullscreenerror","screenfull","elem","request","requestFullscreen","ALLOW_KEYBOARD_INPUT","exitFullscreen","isFullscreen","exit","callback","eventName","defineProperties","Boolean","fullscreenElement","fullscreenEnabled","Reader","self","_checkFeatureCompatibility","metadata","_initContainer","_initLayout","themes","forEach","theme","href","klass","rules","rule","new_rule","_updateTheme","_onResize","_initEvents","_mode","mode","cb","_start","_loaded","open","setBookPanelSize","draw","_panes","display","flow","currentLocation","destroy","log","_container","dataset","index","enabled","toggle","DomUtil","_onScroll","_containerId","_fadeAnimated","fadeAnimation","engine","position","_initPanes","panes","prefix","_initLoader","_targets","onOff","trackResize","debounce","invalidateSize","transform3DLimit","_onMoveEnd","_resizeRequest","scrollTop","scrollLeft","keyCode","srcElement","_fireDOMEvent","targets","synth","_findEventTargets","isMarker","containerPoint","latLngToContainerPoint","getLatLng","mouseEventToContainerPoint","layerPoint","containerPointToLayerPoint","latlng","layerPointToLatLng","nonBubblingEvents","h","clientHeight","paddingTop","paddingBottom","w","clientWidth","paddingRight","paddingLeft","height","width","_drawn","_resizeTarget","_triggerRedraw","_resizeBookPane","_checkMobileDevice","fontSizeLarge","fontSizeSmall","fontSizeDefault","_isMobile","mobileMediaQuery","matchMedia","matches","body","DOMParser","parseFromString","children","Control","_locked","region","reader","_reader","removeControl","addControl","onAdd","getRegion","area","getControlRegion","onRemove","screenX","screenY","getContainer","focus","widget","direction","control","addTo","_controlContainer","parts","tmp","slug","shift","panel","slot","pop","childElement","_classify","_controlRegions","PageControl","_control","querySelector","_className","_createButton","_fill","html","label","_bindEvents","title","link","setAttribute","_action","s","unit","_unit","PagePrevious","prev","PageNext","next","PageFirst","first","PageLast","pageNext","pagePrevious","pageFirst","pageLast","activeModal","FOCUSABLE_ELEMENTS","ACTIONABLE_ELEMENTS","Modal","onShow","onClose","_id","getTime","parseInt","random","_initializedEvents","callbacks","actions","handlers","panelHTML","main","action","button_cls","modal","onClick","onKeydown","onModalTransition","button_id","button","close","closeModal","removeEventListeners","activeElement","_resize","setFocusToFirstNode","addEventListeners","showModal","offsetHeight","offsetWidth","fraction","header","footer","nodes","querySelectorAll","keys","map","focusableNodes","getFocusableNodes","maintainFocus","closeAfterAction","click","selector","hasAttribute","actionableNodes","getActionableNodes","getAttribute","focusedItemIndex","shiftKey","Contents","defaultTemplate","_modal","activate","gotoPage","toc","tuple","chapter","tabindex","option","_createOption","reverse","chapter_","unshift","anchor","textContent","contents","Title","h1","_title","_divider","_section","bookTitle","PublicationMetadata","_publisher","_rights","publisher","rights","publicationMetadata","Preferences","_activated","_createPanel","hasThemes","_updatePreferences","_form","_initializeForm","xmodal","input","input_id","checked","text_size","deactivate","reopen","preferences","Widget","_onAddExtra","_updateTemplate","_updateClass","node","Button","Panel","Toggle","state","states","stateName","_resetState","_state","parseFullName","Citation","designMode","formatted","createRange","selectNode","sel","getSelection","removeAllRanges","addRange","flag","execCommand","_message","detach","_formatted","_formatCitation","format","selected","_formatNames","names","suffix","middle","creator","_parseCreator","editor","_parseEditor","part","pubdate","getYear","number_of_volumes","doi","substr","location","retval","citation","Search","searchString","url","searchUrl","hasChildNodes","lastChild","annotations","reset","getJSON","search_results","result","cfiRange","cfi","snippet","highlight","fail","jqxhr","textStatus","error","always","search","CitationOptions","fieldset","citations","text","createTextNode","citationOptions","BibliographicInformation","dl","metadata_fields","metadata_fields_seen","dateFormat","Intl","DateTimeFormat","month","day","idx","dt","dd","bibliographicInformation","Download","_configureDownloadForm","submit","download_links","size","download","Navigator","_createControl","_mouseDown","percent","locations","percentageFromCfi","start","percentage","cfiFromPercentage","Bus","instance","bus","Events","ePub","EpubJS","_book","epubjs","loaded","navigation","then","_contents","package","ready","generate","settings","overflow","getFixedBookPanelSize","_rendition","renderTo","_updateFontSize","hash","path","resolve","_initializeReaderStyles","promise","t","_navigate","spine","spineByHref","_this","_selectTheme","manager","_cached_location","add_max_img_styles","layout","custom_stylesheet_rules","hooks","content","register","view","addStylesheetRules","current","section","book","__scroll","ticking","mod","scrollBy","views","relative","override","refresh","select","end","clear","fontSize","resize","defineProperty","_metadata","createReader","Mock","EpubJSv2","_setupHooks","restore","getMetadata","meta","getToc","toc_idx","subitems","item_","all","renderer","goto","nextPage","prevPage","spineIndexByURL","unload","getPropertyValue","setStyle","EPUBJS","EpubCFI","parse","spinePos","Hooks","smartimages","images","items","iheight","layoutSettings","itemRect","rectHeight","oHeight","newHeight","Number","match","fontAdjust","maxWidth","maxHeight","removeProperty","unloaded","Readium","readiumOptions","useSimpleLoader","GlobalsSetup","Globals","$","openPackageDocument","packageDocument","generateTocListDOM","dom","__walk","innerText","updateSettings","columnGap","openPageIndex","openSpineItemPage","openPageRight","openPageLeft","getItemByHref","idref","closePackageDocument","readerSettings","scroll","_updateReaderStyles","isAuthorTheme","styles","_getThemeStyles","bookStyles","setBookStyles","engines","COZY_EPUB_ENGINE","oldCozy","noConflict"],"mappings":"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"}